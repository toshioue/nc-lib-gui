const __vite__fileDeps=["./CJNyL6pj.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css","./DpDIhxXu.js","./D7yS5JAk.js","./VirtualCell.DaTWCMZu.css","./CBOrWF0V.js","./Dqwep-0C.js","./BBXMuneh.js","./Cell.CE2XxAOg.css","./Dn4WscrN.js","./JP8ePeTV.js","./S1x-kZdE.js","./DeleteModal.SEMJ_gSK.css","./DuIfwTrz.js","./C0xV_Bo1.js","./Bcy-XIkn.js","./DPaOlBFV.js","./BQQOEPN4.js","./hvq8FVej.js","./C8c9012h.js","./BIsWr_mR.js","./BZz6iAla.js","./Cj4l15BV.js","./ChdiWx0E.js","./CiTH7PYd.js","./DCaZaUH5.js","./DpYA1Dpy.js","./dmcxUY_0.js","./BcZAlRJW.js","./LSbsNkd9.js","./F-dFAGVG.js","./tqKkZMzS.js","./BRorwQ1i.js","./SelectOptions.JaHDUZhn.css","./Dzlf0Q89.js","./toggleHighContrast.wojAGmRG.css","./Dxcud087.js","./DCR3b-PJ.js","./DBJzESM9.js","./D8rpj5Lr.js","./BohSct8s.js","./D933wnC7.js","./CgtJdY-6.js","./DQEz7g1o.js","./BiBN5Lxt.js","./Switch.CEh6YzqD.css","./BttyO-T4.js","./CitraFSq.js","./CAuyt8bq.js","./Tabs.DaLSLYpn.css","./BcpeJQoi.js","./CO8XXsKl.js","./C9Sjn86N.js","./CpJUN2HL.js","./BLvTi2Ht.js","./CJBRTPd8.js","./Select.C8Fy0-eI.css","./5xpACL64.js","./ListWithSearch.PmKyjXoQ.css","./Dsqwjc9N.js","./P9ghmVPN.js","./ahvdY77A.js","./index.E0_BHHK8.css","./VVwMOds3.js","./Ciml79M9.js","./DbRkwnd8.js","./EditOrAddProvider.K7iYHan9.css","./D51uA4Lq.js","./VirtualCell.BYk4C8Tn.css","./DQfYvTkb.js","./r2PN1Hfg.js","./vIgbYHAs.js","./boyBAVNN.js","./Cell.DUBzJZSm.css","./Bys73o5q.js","./5JSD4rKf.js","./CZSp73nk.js","./Pagination.D7qN7qzC.css","./BR5dm4Ez.js","./CHLXm8Ls.js","./cCmEAZwU.js","./JRGWYtLw.js","./Pagination.Sdu4RSaT.css","./Ihzp3hON.js","./DBOeGHNL.js","./MenuItem.C7h59s4s.css","./Bxm040c6.js","./Menu.CQ8GNWeI.css","./DAGD02vG.js","./SubMenu.wOiIU45B.css","./CEBaEII4.js","./C1WkfNyL.js","./C6pQ4eSP.js","./Divider.DqtSqZhb.css","./H9SMaBKT.js","./DivDataCell.1yCNpUg3.css","./Do1LnTan.js","./UserIcon.DEVmGavY.css","./DRVKgtZT.js","./Cw6_lRNR.js","./Badge.D0-UrqG9.css","./DGBAbsZ-.js","./Cy50pBgZ.js","./links.C8uCzV-l.css","./Dwil3It4.js","./DgdUBGGc.js","./DzMG5wJt.js","./DvfxijkH.js","./BtFqRdSP.js","./BPivYv4D.js","./BK3iCpwL.js","./DFiWgQ57.js","./WttlrBnq.js","./CnN16FGu.js","./index.MCJqUXFi.css","./CrH1vpRf.js","./DpOBhFIe.js","./jRd57Mtb.js","./hzkm8p6q.js","./CwIyc8pv.js","./KNudlHpk.js","./BBFld1ZO.js","./C2g4bvWC.js","./PaginationV2.DYFSvB0K.css","./BvjMlSBH.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Vl=Object.defineProperty;var Fl=(f,y,i)=>y in f?Vl(f,y,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[y]=i;var va=(f,y,i)=>(Fl(f,typeof y!="symbol"?y+"":y,i),i);import{bN as Ge,r as h,hh as oa,dB as aa,L as xa,gA as zl,hq as Gn,g as j,hu as Hn,d2 as $,i0 as Vn,f_ as na,d7 as ha,aj as Ve,gk as Pl,A as Un,f as So,aB as Et,i1 as Nl,gW as Ol,o as n,c as M,a8 as Il,P as e,dK as Lo,ai as Ho,df as Lt,hy as Tl,i2 as Wn,cs as St,hg as Bl,fC as Gl,as as Hl,cZ as Yn,N as Ra,cN as Fn,az as Vo,ar as jn,c_ as $a,at as ma,aG as Jt,cq as xo,aM as Bo,du as Go,ak as Ul,gL as Wl,i3 as Yl,fP as Xt,d3 as ya,ct as Kn,cu as _a,a as _,cR as Sa,dy as jl,hk as co,ad as Da,a7 as io,da as la,d9 as Aa,hr as qn,db as Kl,i4 as Xn,M as ql,gD as Ma,ho as Xl,i5 as Jn,go as Jl,i6 as Ql,af as Zl,H as Ro,i as ta,l as Qn,cr as er,i7 as tr,ae as Qo,O as zn,aa as Ye,T as Q,U as De,R as Se,aH as To,b as Y,w as E,X as wa,S as k,V as ro,W as bo,d as Le,t as J,fs as ba,aq as qe,av as Ut,Q as Ot,Y as $t,co as Pn,i8 as Nn,Z as ht,a6 as yt,hR as or,hS as ar,b1 as Eo,hT as wo,aN as nr,$ as Zn,a2 as lr,ag as rr,ds as ir,a0 as el,i9 as sr,p as ur,e as dr,_ as tl,u as ol,dI as ka,hw as $o,ia as cr,dj as Zo,ib as On,aF as pr,hM as fr,hL as vr,hU as mr,hK as wr,ic as gr,bc as hr}from"./Cgw6cdOy.js";import al from"./C1WkfNyL.js";import{a as Uo}from"./DFiWgQ57.js";import{u as yr}from"./CO8XXsKl.js";import{a as ra}from"./BcpeJQoi.js";import{u as _r,a as br}from"./CrH1vpRf.js";import{a as In,e as ct,c as kr,d as xr}from"./D7yS5JAk.js";import{a as Rr}from"./DpOBhFIe.js";import{u as nl}from"./DvfxijkH.js";import{_ as ll}from"./DBOeGHNL.js";import{_ as rl}from"./Bxm040c6.js";import{_ as $r}from"./C6pQ4eSP.js";import{_ as il}from"./CiTH7PYd.js";import{u as Sr}from"./DzMG5wJt.js";import{u as Dr}from"./F-dFAGVG.js";import{a as Ar}from"./vIgbYHAs.js";import{u as Mr}from"./jRd57Mtb.js";import{c as so,d as uo,e as go,i as Cr,a as Er,g as Lr}from"./DpDIhxXu.js";import{H as mo,C as Vr}from"./BBXMuneh.js";import{p as Fr}from"./hzkm8p6q.js";import{_ as zr}from"./CwIyc8pv.js";import{S as Pr}from"./BR5dm4Ez.js";import{C as Nr}from"./KNudlHpk.js";import{T as Or}from"./BBFld1ZO.js";import{_ as Ir,C as Tr}from"./C2g4bvWC.js";const[Br,Gr]=yr((f,y,i)=>{const{$api:L}=Un(),a=Ge(oa,h([])),K=Ge(aa,h(!1)),{gridViewCols:z,updateGridViewColumn:V}=ra(),{nestedFilters:Xe}=Uo(),{isUIAllowed:x}=xa(),{fetchAggregatedData:Ne}=zl(),v=h({}),te=Ge(Gn),Z=j(()=>a.value.map((C,ce)=>({field:C,index:ce})).filter(C=>C.index!==0).map(C=>{const ce=z.value[C.field.id];return ce?{value:v.value[C.field.title]??null,field:ce,column:C.field,index:C.index,width:`${Number((ce.width??"").replace("px",""))}px`||"180px"}:{field:null,index:C.index}})),xe=j(()=>{var A;return!((A=a.value)!=null&&A.length)||!z.value?{field:null,width:"180px"}:{value:v.value[a.value[0].title]??null,column:a.value[0],field:z.value[a.value[0].id],width:`${Number((z.value[a.value[0].id].width??"").replace("px",""))+64}px`||"244px"}}),H=A=>{var C,ce;return A.uidt===$.Formula&&((ce=(C=A.colOptions)==null?void 0:C.parsed_tree)!=null&&ce.dataType)?Vn(A.uidt,A.colOptions.parsed_tree):Vn(A.uidt)},W=async A=>{await na(()=>!!y.value).toBeTruthy({timeout:1e4}).then(async()=>{var C,ce;if(!(!((C=f.value)!=null&&C.type)||((ce=f.value)==null?void 0:ce.type)!==ha.GRID))try{const le=K.value?await Ne({where:i==null?void 0:i.value,filtersArr:Xe.value,...A?{aggregation:A}:{}}):await L.dbDataTableAggregate.dbDataTableAggregate(y.value.id,{viewId:f.value.id,where:i==null?void 0:i.value,...x("filterSync")?{}:{filterArrJson:JSON.stringify(Xe.value)},...A?{aggregation:A}:{}});Object.assign(v.value,le)}catch(le){console.log(le),Ve.error(await Pl(le))}})},b=async(A,C)=>{var ce;await(te==null?void 0:te.trigger({fields:[{title:((ce=a.value.find(le=>le.id===A))==null?void 0:ce.title)??"",aggregation:C}]})),await V(A,{aggregation:C})};return te==null||te.on(async A=>{if((!A||!(A!=null&&A.fields.length))&&await W(),A!=null&&A.fields){const C=A.fields.reduce((ce,le)=>{const q=a.value.find(oe=>oe.title===le.title);return q!=null&&q.id&&(ce[q.id]=le.aggregation??z.value[q.id].aggregation??Hn.None),ce},{});await W(Object.entries(C).map(([ce,le])=>({field:ce,type:le})))}}),{loadViewAggregate:W,isPublic:K,updateAggregate:b,getAggregations:H,displayFieldComputed:xe,visibleFieldsComputed:Z}});function Hr(){const f=Gr();if(f==null)throw new Error("Please call `useProvideViewAggregate` on the appropriate parent component");return f}const Ur=So({__name:"TableDataCell",setup(f){const y=h(),i=Lo();return Et(Nl,i),Et(Ol,y),(L,a)=>(n(),M("td",{ref_key:"el",ref:y,class:"select-none",onClick:a[0]||(a[0]=K=>e(i).trigger(K))},[Il(L.$slots,"default")],512))}}),Wr=()=>{const{t:f}=Ho();return{paste:async()=>{try{if(!navigator.clipboard)throw new Error(f("msg.error.pasteFromClipboardError"));const i=await navigator.clipboard.readText(),L=new Event("paste",{bubbles:!1,cancelable:!0});return Object.defineProperty(L,"clipboardData",{value:{getData:()=>i||""}}),document.dispatchEvent(L),!0}catch{return Ve.error(f("msg.error.pasteFromClipboardError")),!1}}}};class Tn{constructor(y=null,i=null){va(this,"_start");va(this,"_end");this._start=y,this._end=i??this._start}isEmpty(){return this._start==null||this._end==null}isSingleCell(){var y,i,L,a;return!this.isEmpty()&&((y=this._start)==null?void 0:y.col)===((i=this._end)==null?void 0:i.col)&&((L=this._start)==null?void 0:L.row)===((a=this._end)==null?void 0:a.row)}isSingleRow(){var y,i;return!this.isEmpty()&&((y=this._start)==null?void 0:y.row)===((i=this._end)==null?void 0:i.row)}isCellInRange(y){return!this.isEmpty()&&y.row>=this.start.row&&y.row<=this.end.row&&y.col>=this.start.col&&y.col<=this.end.col}isRowInRange(y){return!this.isEmpty()&&y>=this.start.row&&y<=this.end.row}isColInRange(y){return!this.isEmpty()&&y>=this.start.col&&y<=this.end.col}get start(){var y,i,L,a;return{row:Math.min(((y=this._start)==null?void 0:y.row)??NaN,((i=this._end)==null?void 0:i.row)??NaN),col:Math.min(((L=this._start)==null?void 0:L.col)??NaN,((a=this._end)==null?void 0:a.col)??NaN)}}get end(){var y,i,L,a;return{row:Math.max(((y=this._start)==null?void 0:y.row)??NaN,((i=this._end)==null?void 0:i.row)??NaN),col:Math.max(((L=this._start)==null?void 0:L.col)??NaN,((a=this._end)==null?void 0:a.col)??NaN)}}startRange(y){this._start=y,this._end=y}endRange(y){this._end=y}clear(){this._start=null,this._end=null}}function ko(f,y=!1,i=!1){var x,Ne;const{to:L,value:a,column:K,files:z=[],oldValue:V}=f,Xe=y?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";if(a===""&&L!==$.Attachment)return null;switch(L){case $.SingleLineText:case $.LongText:return a.match(/^".*"$/)?a.slice(1,-1):a;case $.Number:{const v=Number(a);if(isNaN(v)){if(i)return null;throw new TypeError(`Cannot convert '${a}' to number`)}return v}case $.Rating:{const v=Number(a??0);if(isNaN(v)){if(i)return null;throw new TypeError(`Cannot convert '${a}' to rating`)}return v}case $.Checkbox:if(typeof a=="boolean")return a;if(typeof a=="string"){const v=a.trim().toLowerCase();if(v==="true"||v==="1")return!0;if(v==="false"||v==="0"||v==="")return!1}return null;case $.Date:case $.DateTime:{let v=St(a,Bl(a));if(v.isValid()||(v=St(a,Gl(a))),!v.isValid()){if(i)return null;throw new Error(`Not a valid '${L}' value`)}return L===$.Date?v.format("YYYY-MM-DD"):v.utc().format("YYYY-MM-DD HH:mm:ssZ")}case $.Time:{let v=St(a);if(v.isValid()||(v=St(a,"HH:mm:ss")),v.isValid()||(v=St(`1999-01-01 ${a}`)),!v.isValid()){if(i)return null;throw new Error("Not a valid time value")}return v.format(Xe)}case $.Year:{if(/^\d+$/.test(a))return+a;const v=St(a);if(v.isValid())return v.format("YYYY");if(i)return null;throw new Error("Not a valid year value")}case $.Attachment:{const v=Lt(V),te=v&&Array.isArray(v)?v:[];if(!a&&!z.length)return te.length?void 0:null;let Z=[];if(a){try{Z=Lt(a),Z=Array.isArray(Z)?Z:typeof Z=="object"&&Object.keys(Z).length?[Z]:[]}catch{if(i)return null;throw new Error("Invalid attachment data")}if(Z.some(b=>b&&!(b.url||b.data||b.path)))return null}const H={...{...f.appInfo.ee&&{maxNumberOfAttachments:Math.max(1,+f.appInfo.ncMaxAttachmentsAllowed||50)||50,maxAttachmentSize:Math.max(1,+f.appInfo.ncAttachmentFieldSize||20)||20,supportedAttachmentMimeTypes:["*"]}},...Lt(K==null?void 0:K.meta)},W=[];for(const b of a?Z:z){if(f.appInfo.ee){if(Z.length>H.maxNumberOfAttachments){Ve.error(`You can only upload at most ${H.maxNumberOfAttachments} file${H.maxNumberOfAttachments>1?"s":""} to this cell.`);return}if(b.size>H.maxAttachmentSize*1024*1024){Ve.error(`The size of ${b.name} exceeds the maximum file size ${H.maxAttachmentSize} MB.`);continue}if(!H.supportedAttachmentMimeTypes.includes("*")&&!H.supportedAttachmentMimeTypes.includes(b.type)&&!H.supportedAttachmentMimeTypes.includes(b.type.split("/")[0])){Ve.error(`${b.name} has the mime type ${b.type} which is not allowed in this column.`);continue}}W.push(b)}if(te.length&&!W.length)return;if(a&&W.length){const b=[];for(const A of W)b.push({...A,title:Wn(A==null?void 0:A.title,[...te,...b].map(C=>(C==null?void 0:C.title)||(C==null?void 0:C.fileName)),A==null?void 0:A.mimetype)});return JSON.stringify([...te,...b])}else return z.length&&W.length?W:null}case $.SingleSelect:case $.MultiSelect:{if(a==="")return null;const v=(((x=K.colOptions)==null?void 0:x.options)||[]).map(xe=>xe.title),Z=a.split(",").filter(xe=>v.includes(xe));return Z.length===0?null:Z.join(",")}case $.User:case $.CreatedBy:case $.LastModifiedBy:{let v;try{try{v=typeof a=="string"?JSON.parse(a):a}catch{v=a}}catch{if(i)return null;throw new Error("Invalid user data")}return v||a}case $.LinkToAnotherRecord:{if(i)return;if(uo(K)||go(K)){const v=typeof a=="string"?JSON.parse(a):a;if(!(v&&typeof v=="object"&&!Array.isArray(v)&&Object.keys(v))||(v==null?void 0:v.fk_related_model_id)!==((Ne=K.colOptions)==null?void 0:Ne.fk_related_model_id))throw new Error(`Unsupported conversion for ${L}`);return v}else throw new Error(`Unsupported conversion for ${L}`)}case $.Links:{if(i)return;if(so(K)){const v=typeof a=="string"?JSON.parse(a):a;if(!(v&&typeof v=="object"&&!Array.isArray(v)&&["rowId","columnId","fk_related_model_id","value"].every(te=>v.hasOwnProperty(te)))||(v==null?void 0:v.fk_related_model_id)!==K.colOptions.fk_related_model_id)throw new Error(`Unsupported conversion for ${L}`);return v}else throw new Error(`Unsupported conversion for ${L}`)}case $.Email:return Lt(K.meta).validate&&Tl(a)||a;case $.Lookup:case $.Rollup:case $.Formula:case $.QrCode:{if(i)return;throw new Error(`Unsupported conversion for ${L}`)}default:return a}}const ga=0;function Yr(f,y,i,L,a,K,z,V,Xe,x,Ne,v,te,Z,xe,H,W){const b=h(f),{t:A}=Ho(),{copy:C}=Hl(),{getMeta:ce}=Yn(),{appInfo:le}=Ra(),{isMysql:q,isPg:oe}=Fn(),{base:me}=Vo(Fn()),{api:ie}=jn(),{addUndo:fe,clone:re,defineViewScope:m}=$a(),{isDataReadOnly:we}=xa(),se=h(L),Re=h(!1),_e=h(!1),$e=h(xe),He=h(H),u=ma(new Tn),T=ma(new Tn),c=ma({row:null,col:null}),r=j(()=>{var l;return(l=e(y))==null?void 0:l.length}),N=j(()=>!(c.row===null||c.col===null||isNaN(c.row)||isNaN(c.col)));function g(l,d){c.row===l&&c.col===d||(se.value=!1,c.row=l,c.col=d)}function P(l){const d=B(l),p=I(l);return`${d} ${p}`}function B(l){var d;return((d=Lt(l==null?void 0:l.meta))==null?void 0:d.date_format)??Kn[0]}function I(l){var d;return((d=Lt(l==null?void 0:l.meta))==null?void 0:d.time_format)??_a[0]}const ae=(l,d)=>{var ue,Fe;let p=d.title&&l.row[d.title]||"";if(d.uidt===$.Checkbox&&(p=!!p),[$.User,$.CreatedBy,$.LastModifiedBy].includes(d.uidt)&&p&&(p=Array.isArray(p)?p:[p].map(O=>O.email).join(", ")),(uo(d)||go(d))&&(p={fk_related_model_id:d.colOptions.fk_related_model_id,value:p||null}),so(d)&&(p={rowId:ct(l.row,(ue=b.value)==null?void 0:ue.columns),columnId:d.id,fk_related_model_id:d.colOptions.fk_related_model_id,value:isNaN(+p)?0:+p}),typeof p=="object"?p=JSON.stringify(p):p=p.toString(),d.uidt===$.Formula&&(p=p.replace(/\b(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}[+-]\d{2}:\d{2})\b/g,O=>St(O).utc().local().format("YYYY-MM-DD HH:mm"))),[$.DateTime,$.CreatedTime,$.LastModifiedTime].includes(d.uidt)){p=p.replace(/["']/g,"");const O=q(d.source_id);let ge=St(p);if(ge.isValid()||(ge=St(p,O?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),p=ge.format(P(d)),!ge.isValid())return""}if(d.uidt===$.Date){const O=(Fe=Lt(d.meta))==null?void 0:Fe.date_format;O&&Yl(O)?p=St(p,O).format(O):p=St(p,"YYYY-MM-DD").format(O)}if(d.uidt===$.Time){p=p.replace(/["']/g,"");const O=q(d.source_id),ge=oe(d.source_id);let ve=St(p);if(ve.isValid()||(ve=St(p,O?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),ve.isValid()||(ve=O||ge?St(p,"HH:mm:ss"):St(p)),!ve.isValid())return"";p=ve.format(I(d))}return d.uidt===$.LongText&&(p=`"${p.replace(/"/g,'\\"')}"`),p},X=(l,d)=>{let p="<table>",ue="";const Fe=[];return l.forEach((O,ge)=>{let ve="<tr>";const lt=[];d.forEach((Ft,ut)=>{const pt=ae(O,Ft);ve+=`<td>${pt}</td>`,ue=`${ue}${pt}${d.length-1!==ut?"	":""}`,lt.push(pt)}),p+=`${ve}</tr>`,l.length-1!==ge&&(ue=`${ue}
`),Fe.push(lt)}),p+="</table>",{html:p,text:ue,json:Fe}},Je=async(l,d)=>{var ge;const{html:p,text:ue}=X(l,d),Fe=new Blob([p],{type:"text/html"}),O=new Blob([ue],{type:"text/plain"});return((ge=navigator.clipboard)==null?void 0:ge.write([new ClipboardItem({[Fe.type]:Fe,[O.type]:O})]))??C(ue)};async function _t(l){try{if(u.start!==null&&u.end!==null&&!u.isSingleCell()){const d=e(i).slice(u.start.row,u.end.row+1),p=e(y).slice(u.start.col,u.end.col+1);await Je(d,p),Ve.success(A("msg.info.copiedToClipboard"))}else{const d=(l==null?void 0:l.row)??c.row,p=(l==null?void 0:l.col)??c.col;if(d!=null&&p!=null){const ue=e(i)[d],Fe=e(y)[p],O=ae(ue,Fe);await C(O),Ve.success(A("msg.info.copiedToClipboard"))}}}catch{Ve.error(A("msg.error.copyToClipboardError"))}}const Vt=j(()=>{const l={};if(T._start===null||T._end===null)return l;for(let d=T.start.row;d<=T.end.row;d++)for(let p=T.start.col;p<=T.end.col;p++)l[`${d}-${p}`]=!0;return l}),tt=j(()=>{const l={};if(c.row!==null&&c.col!==null&&(l[`${c.row}-${c.col}`]=!0),u._start===null||u._end===null)return l;for(let d=u.start.row;d<=u.end.row;d++)for(let p=u.start.col;p<=u.end.col;p++)l[`${d}-${p}`]=!0;return l}),Wt=(l,d,p=!1)=>!l||!d?(p&&Ve.info("Please select a cell to paste"),!1):Xt(d)||ya(d)?(p&&Ve.info(A("msg.info.pasteNotSupported")),!1):d.ai?(p&&Ve.info(A("msg.info.autoIncFieldNotEditable")),!1):d.pk&&!l.rowMeta.new?(p&&Ve.info(A("msg.info.editingPKnotSupported")),!1):!0;function st(l,d,p){if(_e.value){const ue=e(i)[d];if(!u._start||!u._end||ue.rowMeta.new)return;T.endRange({row:d,col:u._end.col}),x==null||x(d,p);return}Re.value&&(u.endRange({row:d,col:p}),x==null||x(d,p),l.preventDefault())}function Do(l,d,p){if(!(((l==null?void 0:l.button)!==ga||(l==null?void 0:l.button)===ga&&l.ctrlKey)&&tt.value[`${d}-${p}`])){if(se.value||(Re.value=!0),K.value=!1,l.preventDefault(),l.shiftKey){(c.col===null||c.row===null)&&u.startRange({row:d,col:p}),u.endRange({row:d,col:p});return}u.startRange({row:d,col:p}),(c.row!==d||c.col!==p)&&(c.row=null,c.col=null)}}const F=(l,d,p)=>{(!l.shiftKey||c.col===null||c.row===null)&&g(d,p),x==null||x(d,p)},it=l=>{var d;if(_e.value){if(_e.value=!1,T._start===null||T._end===null)return;if(u._start!==null&&u._end!==null){const p={row:u._start.row,col:u._start.col},ue=e(i).slice(u.start.row,u.end.row+1),Fe=e(y).slice(u.start.col,u.end.col+1),O=X(ue,Fe).json,ge=T._start.row<=T._end.row?1:-1;let ve=ge===1?0:O.length-1;const lt=[],Ft=[];for(let ut=T._start.row;ge===1?ut<=T._end.row:ut>=T._end.row;ut+=ge){if(tt.value[`${ut}-${u.start.col}`])continue;const pt=e(i)[ut];let Gt=0;for(let jt=T.start.col;jt<=T.end.col;jt++){const ft=e(y)[jt];if(!Wt(pt,ft)){Gt++;continue}Ft.push(ft.title);const zt=ko({value:O[ve][Gt],to:ft.uidt,column:ft,appInfo:e(le)},q((d=b.value)==null?void 0:d.source_id),!0);zt!==void 0&&(pt.row[ft.title]=zt,lt.push(pt)),Gt++}ge===1?ve=ve<O.length-1?ve+1:0:ve=ve>=1?ve-1:O.length-1}te==null||te(lt,Ft).then(()=>{T._start===null||T._end===null||(u.startRange(p),u.endRange(T._end),g(p.row,p.col),T.clear())})}else T.clear();return}Re.value&&(Re.value=!1,setTimeout(()=>{u._start&&(c.row!==u._start.row||c.col!==u._start.col)&&g(u._start.row,u._start.col)},0))},Dt=async l=>{var p,ue,Fe,O,ge,ve,lt,Ft,ut,pt,Gt,jt,ft,zt,Qt,vt,Ue,Kt,po,de,G,rt,Ae,ot,bt,Oe,at,mt,ze,Me,nt,Ce;if(await(Ne==null?void 0:Ne(l)))return!0;if(xo()||!N.value||c.row===null||c.col===null)return;const d=Bo()?l.metaKey:l.ctrlKey;switch(l.key){case"Tab":l.preventDefault(),u.clear(),l.shiftKey?c.col>0?(c.col--,se.value=!1):c.row>0&&(c.row--,c.col=e(r.value)-1,se.value=!1):c.col<e(r.value)-1?(c.col++,se.value=!1):c.row<e(i).length-1&&(c.row++,c.col=0,se.value=!1),x==null||x();break;case"Enter":l.preventDefault(),u.clear(),Xe(e(i)[c.row],e(y)[c.col]);break;case"Delete":case"Backspace":if(l.preventDefault(),we.value)return;u.isSingleCell()?(u.clear(),await z(c)):await V();break;case"ArrowRight":l.preventDefault(),l.shiftKey?d?(se.value=!1,u.endRange({row:((p=u._end)==null?void 0:p.row)??c.row,col:e(r.value)-1}),x==null||x((ue=u._end)==null?void 0:ue.row,(Fe=u._end)==null?void 0:Fe.col)):(((O=u._end)==null?void 0:O.col)??c.col)<e(r.value)-1&&(se.value=!1,u.endRange({row:((ge=u._end)==null?void 0:ge.row)??c.row,col:(((ve=u._end)==null?void 0:ve.col)??c.col)+1}),x==null||x((lt=u._end)==null?void 0:lt.row,(Ft=u._end)==null?void 0:Ft.col)):(u.clear(),c.col<e(r.value)-1&&(c.col++,u.startRange({row:c.row,col:c.col}),x==null||x(),se.value=!1));break;case"ArrowLeft":l.preventDefault(),l.shiftKey?d?(se.value=!1,u.endRange({row:((ut=u._end)==null?void 0:ut.row)??c.row,col:0}),x==null||x((pt=u._end)==null?void 0:pt.row,(Gt=u._end)==null?void 0:Gt.col)):(((jt=u._end)==null?void 0:jt.col)??c.col)>0&&(se.value=!1,u.endRange({row:((ft=u._end)==null?void 0:ft.row)??c.row,col:(((zt=u._end)==null?void 0:zt.col)??c.col)-1}),x==null||x((Qt=u._end)==null?void 0:Qt.row,(vt=u._end)==null?void 0:vt.col)):(u.clear(),c.col>0&&(c.col--,u.startRange({row:c.row,col:c.col}),x==null||x(),se.value=!1));break;case"ArrowUp":l.preventDefault(),l.shiftKey?d?(se.value=!1,u.endRange({row:0,col:((Ue=u._end)==null?void 0:Ue.col)??c.col}),x==null||x((Kt=u._end)==null?void 0:Kt.row,(po=u._end)==null?void 0:po.col)):(((de=u._end)==null?void 0:de.row)??c.row)>0&&(se.value=!1,u.endRange({row:(((G=u._end)==null?void 0:G.row)??c.row)-1,col:((rt=u._end)==null?void 0:rt.col)??c.col}),x==null||x((Ae=u._end)==null?void 0:Ae.row,(ot=u._end)==null?void 0:ot.col)):(u.clear(),c.row>0&&(c.row--,u.startRange({row:c.row,col:c.col}),x==null||x(),se.value=!1));break;case"ArrowDown":l.preventDefault(),l.shiftKey?d?(se.value=!1,u.endRange({row:e(i).length-1,col:((bt=u._end)==null?void 0:bt.col)??c.col}),x==null||x((Oe=u._end)==null?void 0:Oe.row,(at=u._end)==null?void 0:at.col)):(((mt=u._end)==null?void 0:mt.row)??c.row)<e(i).length-1&&(se.value=!1,u.endRange({row:(((ze=u._end)==null?void 0:ze.row)??c.row)+1,col:((Me=u._end)==null?void 0:Me.col)??c.col}),x==null||x((nt=u._end)==null?void 0:nt.row,(Ce=u._end)==null?void 0:Ce.col)):(u.clear(),c.row<e(i).length-1&&(c.row++,u.startRange({row:c.row,col:c.col}),x==null||x(),se.value=!1));break;default:{const U=e(i)[c.row],ke=e(y)[c.col];if((!e(se)||!In(ke))&&!Go()&&(Bo()?l.metaKey:l.ctrlKey))switch(l.keyCode){case 67:await _t();break;case 65:u.startRange({row:0,col:0}),u.endRange({row:e(i).length-1,col:e(r.value)-1});break}if(e(se)||l.ctrlKey||l.altKey||l.metaKey)return!0;if(l.key.length===1){if(!e(a)&&!U.rowMeta.new)return Ve.info(A("msg.info.updateNotAllowedWithoutPK"));In(ke)&&Xe(U,ke)&&ke.title&&(ke.uidt===$.LongText?U.row[ke.title]==="<br />"?U.row[ke.title]=l.key:Lt(ke.meta).richMode&&(U.row[ke.title]=U.row[ke.title]?U.row[ke.title]+l.key:l.key):U.row[ke.title]="")}}break}},Fo=()=>u.clear(),zo=u.clear.bind(u),Yt=async l=>{var p,ue,Fe,O,ge,ve,lt,Ft,ut,pt,Gt,jt,ft,zt,Qt,vt,Ue,Kt,po;if(we.value||Go()||xo()||!N.value||e(se)||c.row===null||c.row===void 0||c.col===null||c.col===void 0)return;l.preventDefault();let d=((p=l.clipboardData)==null?void 0:p.getData("text/plain"))||"";d!=null&&d.endsWith(`
`)&&(d=d.replace(/\n$/,""));try{if(d!=null&&d.includes(`
`)||d!=null&&d.includes("	")){const de=Fr.parse(d,{delimiter:"	",escapeChar:"\\"});if(de.errors.length>0)throw new Error(de.errors[0].message);const G=de.data,rt=Math.max(G.length,u.end.row-u.start.row+1),Ae=rt,ot=G[0].length,bt=e(y).slice(c.col,c.col+ot),Oe=e(i).slice(c.row,c.row+rt),at=[];let mt=0,ze=!1;for(let Me=0;Me<Ae;Me++){const nt=Oe[Me];if(!nt||nt.rowMeta.new)break;mt++;for(let Ce=0;Ce<ot;Ce++){const U=bt[Ce];if(!Wt(nt,U)){(uo(U)||go(U)||so(U))&&!ze&&(Ve.info(A("msg.info.groupPasteIsNotSupportedOnLinksColumn")),ze=!0);continue}at.push(U.title);const ke=ko({value:G[Me%G.length][Ce],to:U.uidt,column:U,appInfo:e(le),oldValue:U.uidt===$.Attachment?nt.row[U.title]:void 0},q((ue=b.value)==null?void 0:ue.source_id),!0);ke!==void 0&&(nt.row[U.title]=ke)}}await(te==null?void 0:te(Oe,at)),mt>0&&(u.startRange({row:c.row,col:c.col}),u.endRange({row:c.row+mt-1,col:c.col+ot-1}))}else if(u.isSingleCell()){const de=e(i)[c.row],G=e(y)[c.col];if(uo(G)&&!((Fe=G.meta)!=null&&Fe.custom)){const Ae=ko({value:d,to:G.uidt,column:G,appInfo:e(le)},q((O=b.value)==null?void 0:O.source_id));if(Ae===void 0)return;const ot=(ve=(ge=b.value)==null?void 0:ge.columns)==null?void 0:ve.find(Oe=>{var at;return Oe.id===((at=G.colOptions)==null?void 0:at.fk_child_column_id)});if(!ot)return;const bt=await ce(G.colOptions.fk_related_model_id);return de.oldRow[G.title]=de.row[G.title],de.oldRow[ot.title]=de.row[G.title]?ct(de.row[G.title],bt.columns):null,de.row[G.title]=Ae==null?void 0:Ae.value,de.row[ot.title]=Ae!=null&&Ae.value?ct(Ae.value,bt.columns):null,await(v==null?void 0:v({...c,updatedColumnTitle:ot.title}))}if(so(G)){const Ae=ko({value:d,to:G.uidt,column:G,appInfo:e(le)},q((lt=b.value)==null?void 0:lt.source_id));if(Ae===void 0)return;const ot=ct(de.row,(Ft=b.value)==null?void 0:Ft.columns);if(!ot)return;const bt=de.row[G.title];de.row[G.title]=Ae.value;let Oe;try{Oe=await ie.dbDataTableRow.nestedListCopyPasteOrDeleteAll((ut=b.value)==null?void 0:ut.id,G.id,[{operation:"copy",rowId:Ae.rowId,columnId:Ae.columnId,fk_related_model_id:Ae.fk_related_model_id},{operation:"paste",rowId:ot,columnId:G.id,fk_related_model_id:G.colOptions.fk_related_model_id||Ae.fk_related_model_id}],{viewId:(pt=$e==null?void 0:$e.value)==null?void 0:pt.id})}catch{de.row[G.title]=bt;return}if(Oe&&(Oe!=null&&Oe.link)&&(Oe!=null&&Oe.unlink)&&Array.isArray(Oe.link)&&Array.isArray(Oe.unlink)){if(!Oe.link.length&&!Oe.unlink.length){de.row[G.title]=bt;return}fe({redo:{fn:async(at,mt,ze,Me,nt,Ce)=>{var U,ke,Pt,Zt,Pe,eo,to,At;if(((U=He.value)==null?void 0:U.pageSize)===(Me==null?void 0:Me.pageSize)){((ke=He.value)==null?void 0:ke.page)!==(Me==null?void 0:Me.page)&&await(W==null?void 0:W(Me==null?void 0:Me.page));const Mt=ct(ze.row,(Pt=b.value)==null?void 0:Pt.columns),Qe=e(i)[at.row],fo=e(y)[at.col];if(Mt===ct(Qe.row,(Zt=b.value)==null?void 0:Zt.columns)&&fo.id===mt.id)await Promise.all([Ce.link.length&&ie.dbDataTableRow.nestedLink((Pe=b.value)==null?void 0:Pe.id,fo.id,encodeURIComponent(Mt),Ce.link,{viewId:(eo=$e==null?void 0:$e.value)==null?void 0:eo.id}),Ce.unlink.length&&ie.dbDataTableRow.nestedUnlink((to=b.value)==null?void 0:to.id,fo.id,encodeURIComponent(Mt),Ce.unlink,{viewId:(At=$e==null?void 0:$e.value)==null?void 0:At.id})]),Qe.row[fo.title]=nt,await(v==null?void 0:v(at));else throw new Error(A("msg.recordCouldNotBeFound"))}else throw new Error(A("msg.pageSizeChanged"))},args:[re(c),re(G),re(de),re(He.value),re(Ae.value),Oe]},undo:{fn:async(at,mt,ze,Me,nt,Ce)=>{var U,ke,Pt,Zt,Pe,eo;if(((U=He.value)==null?void 0:U.pageSize)===Me.pageSize){((ke=He.value)==null?void 0:ke.page)!==Me.page&&await(W==null?void 0:W(Me.page));const to=ct(ze.row,(Pt=b.value)==null?void 0:Pt.columns),At=e(i)[at.row],Mt=e(y)[at.col];if(to===ct(At.row,(Zt=b.value)==null?void 0:Zt.columns)&&Mt.id===mt.id)await Promise.all([Ce.unlink.length&&ie.dbDataTableRow.nestedLink((Pe=b.value)==null?void 0:Pe.id,Mt.id,encodeURIComponent(to),Ce.unlink),Ce.link.length&&ie.dbDataTableRow.nestedUnlink((eo=b.value)==null?void 0:eo.id,Mt.id,encodeURIComponent(to),Ce.link)]),At.row[Mt.title]=nt,await(v==null?void 0:v(at));else throw new Error(A("msg.recordCouldNotBeFound"))}else throw new Error(A("msg.pageSizeChanged"))},args:[re(c),re(G),re(de),re(He.value),re(bt),Oe]},scope:m({view:$e==null?void 0:$e.value})})}return await(v==null?void 0:v(c))}if(!Wt(de,G,!0))return;const rt=ko({value:d,to:G.uidt,column:G,appInfo:e(le),files:G.uidt===$.Attachment&&((jt=(Gt=l.clipboardData)==null?void 0:Gt.files)!=null&&jt.length)?(ft=l.clipboardData)==null?void 0:ft.files:void 0,oldValue:de.row[G.title]},q((zt=b.value)==null?void 0:zt.source_id));if(G.uidt===$.Attachment&&((vt=(Qt=l.clipboardData)==null?void 0:Qt.files)!=null&&vt.length)&&(rt!=null&&rt.length)){const Ae=await ho(rt,G.id,de.row[G.title]);de.row[G.title]=Ae?JSON.stringify(Ae):null}else rt!==void 0&&(de.row[G.title]=rt);await(v==null?void 0:v(c))}else{const de=u.start,G=u.end,rt=Math.min(de.row,G.row),Ae=Math.max(de.row,G.row),ot=Math.min(de.col,G.col),bt=Math.max(de.col,G.col),Oe=e(y).slice(ot,bt+1),at=e(i).slice(rt,Ae+1),mt=[];let ze,Me=!1;const nt=(Ue=l.clipboardData)==null?void 0:Ue.files;for(const Ce of at)if(!(!Ce||Ce.rowMeta.new))for(const U of Oe){if(!U.title||!Wt(Ce,U)){(uo(U)||go(U)||so(U))&&!Me&&(Ve.info(A("msg.info.groupPasteIsNotSupportedOnLinksColumn")),Me=!0);continue}if(nt!=null&&nt.length){if(U.uidt!==$.Attachment)continue;if(ze===void 0){const ke=ko({value:"",to:U.uidt,column:U,appInfo:e(le),files:nt,oldValue:Ce.row[U.title]},q((Kt=b.value)==null?void 0:Kt.source_id),!0);if(ke!=null&&ke.length){const Pt=await ho(ke,U.id,Ce.row[U.title]);ze=Pt?JSON.stringify(Pt):null}}}else ze=ko({value:d,to:U.uidt,column:U,appInfo:e(le),oldValue:Ce.row[U.title]},q((po=b.value)==null?void 0:po.source_id),!0);mt.push(U.title),ze!==void 0&&(Ce.row[U.title]=ze)}if(!mt.length)return;await(te==null?void 0:te(at,mt))}}catch(de){console.error(de),Ve.error(await Ul(de))}};function Po(l){var d,p;(l==null?void 0:l.button)===ga&&(_e.value=!0,u._start&&u._end&&(T.startRange({row:(d=u._start)==null?void 0:d.row,col:u._start.col}),T.endRange({row:(p=u._end)==null?void 0:p.row,col:u._end.col})),l.preventDefault())}async function ho(l,d,p){var Fe;const ue=[];try{const O=await ie.storage.upload({path:[Wl,me.value.id,(Fe=b.value)==null?void 0:Fe.id,d].join("/")},{files:l});for(const ge of O)ue.push({...ge,title:Wn(ge==null?void 0:ge.title,[...be(p),...ue].map(ve=>(ve==null?void 0:ve.title)||(ve==null?void 0:ve.fileName)),ge==null?void 0:ge.mimetype)});return ue}catch(O){Ve.error(O.message||A("msg.error.internalError"))}}function be(l){const d=Lt(l);return d&&Array.isArray(d)?d:[]}return Jt(document,"keydown",Dt),Jt(document,"mouseup",it),Jt(document,"paste",Yt),Jt(Z,"mousedown",Po),{isCellActive:N,handleMouseDown:Do,handleMouseOver:st,clearSelectedRange:zo,copyValue:_t,activeCell:c,handleCellClick:F,resetSelectedRange:Fo,selectedRange:u,makeActive:g,isMouseDown:Re,isFillMode:_e,selectRangeMap:tt,fillRangeMap:Vt}}const jr={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Kr=_("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16z"},null,-1),qr=[Kr];function Xr(f,y){return n(),M("svg",jr,[...qr])}const Jr={name:"mdi-message-outline",render:Xr},Qr={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Zr=_("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 4.1L14.1 6l1.4 1.4L16.9 6L18 7.1l-1.4 1.4L18 9.9L16.9 11l-1.4-1.4l-1.4 1.4L13 9.9l1.4-1.4zm-6.8.6h5v1.5h-5zm5.3 8.3h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2zm6.5 1.2h-5v-1.5h5zm0-2.4h-5v-1.5h5z"},null,-1),ei=[Zr];function ti(f,y){return n(),M("svg",Qr,[...ei])}const oi={name:"mdi-calculator-variant",render:ti},ai={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ni=_("path",{fill:"currentColor",d:"M2 12a9 9 0 0 0 9 9c2.39 0 4.68-.94 6.4-2.6l-1.5-1.5A6.7 6.7 0 0 1 11 19c-6.24 0-9.36-7.54-4.95-11.95S18 5.77 18 12h-3l4 4h.1l3.9-4h-3a9 9 0 0 0-18 0"},null,-1),li=[ni];function ri(f,y){return n(),M("svg",ai,[...li])}const ii={name:"mdi-reload",render:ri},si={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ui=_("path",{fill:"currentColor",d:"M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2zm-7 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm11 7h3V8h2v3h3v2h-3v3h-2v-3h-3z"},null,-1),di=[ui];function ci(f,y){return n(),M("svg",si,[...di])}const pi={name:"mdi-table-column-plus-after",render:ci},fi=({fields:f,tableBodyEl:y,gridWrapper:i})=>{const{eventBus:L,isDefaultView:a,meta:K}=Uo(),{addUndo:z,defineViewScope:V}=$a(),{activeView:Xe}=Vo(Sa()),{gridViewCols:x,updateGridViewColumn:Ne}=ra(),{leftSidebarWidth:v}=Vo(nl()),{width:te}=jl(),Z=h(!1),xe=h(null),H=h(null),W=h(null),b=(oe,me)=>{var fe,re,m,we,se;if(!((fe=K.value)!=null&&fe.columns))return;const ie=K.value.columns.findIndex(Re=>Re.id===oe);ie!==-1&&(K.value.columns[ie].meta={...Lt(((re=K.value.columns[ie])==null?void 0:re.meta)||{}),defaultViewColOrder:me},K.value.columns=(K.value.columns||[]).map(Re=>(Re.id!==oe||(Re.meta={...Lt(Re.meta||{}),defaultViewColOrder:me}),Re))),(we=(m=K.value)==null?void 0:m.columnsById)!=null&&we[oe]&&(K.value.columnsById[oe].meta={...Lt((se=K.value.columns[ie])==null?void 0:se.meta),defaultViewColOrder:me})},A=async(oe,me)=>{const ie=x.value[oe],fe=x.value[me];if(!ie||!fe)return;const re=f.value.findIndex(He=>He.id===me),m=re<f.value.length-1?f.value[re+1]:null,we=m?x.value[m.id]:null,se=f.value[f.value.length-1],Re=x.value[se.id];if(we===null&&Re===null)return;const _e=we?fe.order+(we.order-fe.order)/2:Re.order+1,$e=ie.order;ie.order=_e,a.value&&ie.fk_column_id&&b(ie.fk_column_id,_e),z({undo:{fn:async()=>{f.value&&(ie.order=$e,a.value&&b(ie.fk_column_id,$e),await Ne(oe,{order:$e}),L.emit(co.FIELD_RELOAD))},args:[]},redo:{fn:async()=>{f.value&&(ie.order=_e,a.value&&b(ie.fk_column_id,_e),await Ne(oe,{order:_e}),L.emit(co.FIELD_RELOAD))},args:[]},scope:V({view:Xe.value})}),await Ne(oe,{order:_e},!0),L.emit(co.FIELD_RELOAD)},C=async()=>{Z.value=!0;try{if(!H.value)return;H.value.style.left="0px",H.value.style.height="0px",await A(xe.value.id,W.value)}catch(oe){console.error("Failed to reorder column: ",oe)}finally{Z.value=!1}xe.value=null,W.value=null};return{onDrag:oe=>{if(oe.preventDefault(),!oe.dataTransfer||!xe.value||!H.value)return;if(oe.clientX===0){C();return}const me=H.value.getBoundingClientRect().top,fe=document.elementsFromPoint(oe.clientX,me).find(we=>we.classList.contains("nc-grid-column-header"));fe&&(W.value=(fe==null?void 0:fe.getAttribute("data-col"))??null);const re=oe.clientX-v.value;re>=0&&(H.value.style.left=`${re.toString()}px`);const m=parseFloat(getComputedStyle(document.documentElement).fontSize);re<v.value+1*m?setTimeout(()=>{i.value.scrollLeft-=2.5},250):te.value-re-v.value<15*m&&setTimeout(()=>{i.value.scrollLeft+=2.5},250)},onDragStart:(oe,me)=>{var we;if(!me.dataTransfer)return;const ie=document.querySelector('[data-testid="drag-icon-placeholder"]');if(!ie||!H.value)return;me.dataTransfer.dropEffect="none",me.dataTransfer.effectAllowed="none",me.dataTransfer.setDragImage(ie,10,10),me.dataTransfer.clearData(),me.dataTransfer.setData("text/plain",oe),xe.value=f.value.find(se=>se.id===oe)??null;const fe=parseFloat(getComputedStyle(document.documentElement).fontSize),re=((we=y.value)==null?void 0:we.getBoundingClientRect().height)??6.1*fe;H.value.style.height=`${re}px`;const m=me.clientX-v.value;m>=0&&H.value&&(H.value.style.left=`${m.toString()}px`)},onDragEnd:async oe=>{oe.preventDefault(),await na(()=>!Z.value).toBeTruthy(),!(!oe.dataTransfer||!xe.value||!W.value)&&C()},draggedCol:xe,dragColPlaceholderDomRef:H,toBeDroppedColId:W}},vi=ht(()=>yt(()=>import("./CJNyL6pj.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(f=>f.default||f)),mi=ht(()=>yt(()=>import("./CBOrWF0V.js"),__vite__mapDeps([6,1,2,7,8,9]),import.meta.url).then(f=>f.default||f)),wi=ht(()=>yt(()=>import("./Dn4WscrN.js"),__vite__mapDeps([10,11,1,2,12,13,14,15,16,17,18,19,20,21,22,23,3,7,8,24,25,26,27,28,29,30,31,32,33,34,4,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67]),import.meta.url).then(f=>f.default||f)),gi=ht(()=>yt(()=>import("./D51uA4Lq.js"),__vite__mapDeps([68,1,2,3,8,69]),import.meta.url).then(f=>f.default||f)),hi=ht(()=>yt(()=>import("./DQfYvTkb.js"),__vite__mapDeps([70,1,2,71,52,72,3,73,4,8,74]),import.meta.url).then(f=>f.default||f)),yi=ht(()=>yt(()=>import("./Bys73o5q.js"),__vite__mapDeps([75,71,52,1,2,72,3,73,4]),import.meta.url).then(f=>f.default||f)),_i=ht(()=>yt(()=>import("./5JSD4rKf.js"),__vite__mapDeps([76,77,1,2,40,29,18,41,20,19,78,79,80,81,82,16,17,21,22,83]),import.meta.url).then(f=>f.default||f)),bi=ht(()=>yt(()=>import("./Ihzp3hON.js"),__vite__mapDeps([84,1,2,85,86,87,88,25,89,90,91,53,79,80,81,82,92,93,64,94,95,96,97,98,99,100,101,102,103,16,17,18,19,20,21,22,104,105,106,107,108,109,52,4,110,71,72,3,73,111,112,49,50,113,12,13,54,51,114,62,115,116,117,31,118,8,119,120,121,48,122,123,124]),import.meta.url).then(f=>f.default||f)),Ca=f=>(ur("data-v-57f1be7f"),f=f(),dr(),f),ki=Ca(()=>_("div",{"data-testid":"drag-icon-placeholder",class:"absolute w-1 h-1 pointer-events-none opacity-0"},null,-1)),xi={class:"flex items-center justify-center bg-white/80 absolute l-0 t-0 w-full h-full z-10 pb-10 pointer-events-none"},Ri={class:"flex flex-col items-center justify-center gap-2"},$i=["innerHTML"],Si={key:0},Di={class:"nc-grid-header"},Ai={class:"w-full h-full flex pl-2 pr-1 items-center","data-testid":"nc-check-all"},Mi=Ca(()=>_("span",{class:"flex-1"},null,-1)),Ci={key:1,class:"text-gray-500"},Ei=["data-col","data-title"],Li=["data-col","data-title","onXcstartresizing","onXcresize","onXcresizing","onClick"],Vi=["draggable","onDragstart"],Fi={class:"absolute top-0 left-0 h-8 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},zi={class:"h-full w-[60px] flex items-center justify-center"},Pi={class:"flex flex-row items-center py-3"},Ni={class:"text-xs pl-2"},Oi=["onClick"],Ii={class:"text-xs pl-2"},Ti={class:"text-red-500 text-xs pl-2"},Bi={class:"text-xs pl-2"},Gi={class:"flex flex-row items-center py-3"},Hi={class:"text-xs pl-2"},Ui=["onClick"],Wi={class:"text-xs pl-2"},Yi={class:"text-xs pl-2"},ji={class:"nc-edit-or-add-provider-wrapper"},Ki={class:"!border-0 relative !xs:hidden",style:{borderWidth:"0px !important"}},qi=["data-testid"],Xi=["data-testid"],Ji={class:"w-[60px] pl-2 pr-1 items-center flex gap-1"},Qi=Ca(()=>_("span",{class:"flex-1"},null,-1)),Zi=["data-testid"],es=["onClick"],ts={key:2,class:"cursor-pointer flex items-center border-1 border-gray-100 active:ring rounded p-1 hover:bg-gray-50"},os={key:0,class:"w-full"},as={key:0,class:"w-full"},ns=["colspan"],ls={class:"flex gap-2 items-center"},rs={key:0,class:"flex gap-2 items-center"},is={key:1,class:"flex gap-2 items-center"},ss={class:"flex gap-2 items-center"},us={class:"flex gap-2 items-center"},ds={class:"flex gap-2 items-center"},cs={class:"flex gap-2 items-center"},ps={class:"flex gap-2 items-center"},fs={class:"flex gap-2 items-center"},vs={class:"flex gap-2 items-center"},ms={class:"relative"},ws={class:"flex ml-1"},gs={"data-testid":"nc-pagination-add-record",class:"flex items-center px-2 text-gray-600 hover:text-black"},hs={class:"relative overflow-visible min-h-17 w-10"},ys={class:"flex flex-row items-center justify-between w-full"},_s={class:"flex flex-row items-center justify-start gap-x-3"},bs={class:"flex flex-row text-xs text-gray-400 ml-7.25"},ks={class:"flex flex-row items-center justify-between w-full"},xs={class:"flex flex-row items-center justify-start gap-x-2.5"},Rs={class:"flex flex-row text-xs text-gray-400 ml-7.05"},$s={key:0,class:"absolute bottom-12 left-2"},Ss={class:"flex"},Ds={class:"flex items-center gap-2"},As={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},Ms={class:"flex flex-row items-center justify-start gap-x-3"},Cs={class:"flex flex-row items-center justify-start gap-x-3"},Bn=!1,ea=10,Es=So({__name:"Table",props:{data:{},vGroup:{},paginationData:{},loadData:{type:Function},changePage:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},selectedAllRecords:{type:Boolean},deleteRangeOfRows:{type:Function},rowHeight:{},expandForm:{type:Function},deleteSelectedRows:{type:Function},removeRowIfNew:{type:Function},bulkUpdateRows:{type:Function},headerOnly:{type:Boolean},hideHeader:{type:Boolean},hideCheckbox:{type:Boolean},pagination:{},disableSkeleton:{type:Boolean},disableVirtualX:{type:Boolean},disableVirtualY:{type:Boolean}},emits:["update:selectedAllRecords","bulkUpdateDlg","toggleOptimisedQuery"],setup(f,{expose:y,emit:i}){const L=f,a=i,K=Da(L,"selectedAllRecords",a),z=io(L,"paginationData"),V=io(L,"data"),Xe=io(L,"pagination"),x=io(L,"headerOnly"),Ne=io(L,"hideHeader"),v=io(L,"disableSkeleton"),te=io(L,"disableVirtualX"),Z=io(L,"disableVirtualY"),{api:xe}=jn(),{vGroup:H,loadData:W,changePage:b,callAddEmptyRow:A,updateOrSaveRow:C,deleteRow:ce,expandForm:le,deleteSelectedRows:q,deleteRangeOfRows:oe,removeRowIfNew:me,bulkUpdateRows:ie}=L,fe=Ge(la,h()),re=Ge(Aa,h()),m=Ge(oa,h([])),we=Ge(qn,h(!1)),se=Ge(Kl,h(!1)),Re=Ge(aa,h(!1)),_e=Ge(Xn,h(!1)),$e=ql(),He=Ge(Ma,Lo()),u=Ge(Xl,Lo()),{isMobileMode:T,isAddNewRecordGridMode:c,setAddNewRecordGridMode:r}=Ra(),N=Ge(Jn,h()),{isPkAvail:g,isSqlView:P,eventBus:B}=Uo(),{isViewDataLoading:I,isPaginationLoading:ae}=Vo(Sa()),{$e:X}=Un(),{t:Je}=Ho(),{getMeta:_t}=Yn(),{addUndo:Vt,clone:tt,defineViewScope:Wt}=$a(),{isViewColumnsLoading:st,updateGridViewColumn:Do,gridViewCols:F,metaColumnById:it,resizingColOldWith:Dt}=ra(),{isExpandedFormCommentMode:Fo}=Vo(Sr()),{predictingNextColumn:zo,predictedNextColumn:Yt,predictingNextFormulas:Po,predictedNextFormulas:ho,predictNextColumn:be,predictNextFormulas:l}=Dr().table,{paste:d}=Wr(),{addLTARRef:p,syncLTARRefs:ue,clearLTARCell:Fe,cleaMMCell:O}=Ar(),{loadViewAggregate:ge}=Hr(),ve=h(null),lt=h(),Ft=h(),ut=h(),pt=h(),{height:Gt,width:jt}=Jl(Ft),ft=j(()=>st.value||!fe.value),zt=h(!1),{isUIAllowed:Qt,isDataReadOnly:vt}=xa(),Ue=j(()=>Qt("dataEdit")),Kt=j(()=>!we.value&&!se.value&&Qt("fieldAdd")&&!P.value),{onDrag:po,onDragStart:de,onDragEnd:G,draggedCol:rt,dragColPlaceholderDomRef:Ae,toBeDroppedColId:ot}=fi({fields:m,tableBodyEl:ut,gridWrapper:lt}),{onLeft:bt,onRight:Oe,onUp:at,onDown:mt}=Mr({paginationDataRef:z,changePage:b,isViewDataLoading:I}),ze=h(!1),Me=h(!1),nt=h(!1),Ce=h(!1),U=h(),ke=h(!1),Pt=h(!1),Zt=h(null),Pe=h(!1),eo=h(!1),to=h(!1),At=j({get:()=>{var t;return(t=L.data)!=null&&t.some(o=>o.rowMeta.selected)&&vt.value?!1:to.value},set:t=>{to.value=t}}),Mt=h(!1),Qe=h(null),fo=(t,o)=>{P.value||(t.preventDefault(),o&&(Qe.value=o))},La=h(!1);Et(Ql,La);const Wo=h(!1);async function Va(t,o=!1){if(vt.value||!t||!Ue.value||!ba(m.value[t.col])&&Xt(m.value[t.col])||oo.value[t.col].isReadonly)return;const s=V.value[t.row],R=m.value[t.col];if(Xt(R)){let Ee;so(R)&&s&&(Ee=await O(s,R)),Vt({undo:{fn:async(ee,xt,he,Te,je)=>{var ye,Be,Ct,qt,Tt;if(((ye=z.value)==null?void 0:ye.pageSize)===Te.pageSize){((Be=z.value)==null?void 0:Be.page)!==Te.page&&await(b==null?void 0:b(Te.page));const wt=ct(he.row,(Ct=fe.value)==null?void 0:Ct.columns),Ht=V.value[ee.row],Nt=m.value[ee.col];if(Nt.title&&wt===ct(Ht.row,(qt=fe.value)==null?void 0:qt.columns)&&Nt.id===xt.id)uo(Nt)||go(Nt)?(Ht.row[Nt.title]=he.row[Nt.title],await p(Ht,Ht.row[Nt.title],Nt),await ue(Ht,Ht.row)):so(Nt)&&(await xe.dbDataTableRow.nestedLink((Tt=fe.value)==null?void 0:Tt.id,Nt.id,encodeURIComponent(wt),je),Ht.row[Nt.title]=je!=null&&je.length?je==null?void 0:je.length:null),w.col=ee.col,w.row=ee.row,Ie==null||Ie();else throw new Error(Je("msg.recordCouldNotBeFound"))}else throw new Error(Je("msg.pageSizeChanged"))},args:[tt(t),tt(R),tt(s),tt(z.value),Ee]},redo:{fn:async(ee,xt,he,Te)=>{var je,ye,Be,Ct;if(((je=z.value)==null?void 0:je.pageSize)===Te.pageSize){((ye=z.value)==null?void 0:ye.page)!==Te.page&&await(b==null?void 0:b(Te.page));const qt=ct(he.row,(Be=fe.value)==null?void 0:Be.columns),Tt=V.value[ee.row],wt=m.value[ee.col];if(qt===ct(Tt.row,(Ct=fe.value)==null?void 0:Ct.columns)&&wt.id===xt.id)uo(wt)||go(wt)?await Fe(Tt,wt):so(wt)&&await O(Tt,wt),w.col=ee.col,w.row=ee.row,Ie==null||Ie();else throw new Error(Je("msg.recordCouldNotBeFound"))}else throw new Error(Je("msg.pageSizeChanged"))},args:[tt(t),tt(R),tt(s),tt(z.value)]},scope:Wt({view:re.value})}),(uo(R)||go(R))&&await Fe(s,R);return}if(R.title)switch(R.uidt){case $.Checkbox:s.row[R.title]=!1;break;case $.Rating:s.row[R.title]=0;break;default:s.row[R.title]=null;break}o||await(C==null?void 0:C(s,R.title))}function ia(t,o){if(!(!Ue.value||Pe.value||Bn||we.value||ya(o))){if(!g.value&&!t.rowMeta.new){Ve.info(Je("msg.info.updateNotAllowedWithoutPK"));return}if(o.ai){Ve.info(Je("msg.info.autoIncFieldNotEditable"));return}if(o.pk&&!t.rowMeta.new){Ve.info(Je("msg.info.editingPKnotSupported"));return}if(![$.SingleSelect,$.MultiSelect].includes(o.uidt))return Pe.value=!0}}const vo=j(()=>!Bn&&Ue.value&&!P.value&&!Re.value),Fa=j(()=>{var t;return(t=m.value)==null?void 0:t.length}),ul=j(()=>{const t=[];return x.value!==!0?N.value||t.push("nc-scrollbar-x-lg !overflow-auto"):t.push("overflow-visible"),I.value&&t.push("!overflow-hidden"),t.join(" ")}),za=j(()=>{var o;let t=((o=m.value)==null?void 0:o.length)??40;return t=t||40,Array.from({length:t+1}).map(()=>({}))}),dl=j(()=>Array.from({length:40}).map(()=>({}))),Ao=j(()=>v.value!==!0&&(I.value||ae.value||ft.value)||!fe.value),sa=j(()=>V.value.map(t=>m.value.map(o=>({isColumnRequiredAndNull:kr(o,t.row)})))),Pa=t=>ya(t)||Cr(t)||Er(t)||Lr(t)||Vr(t)||Xt(t)||or(t)||ar(t),oo=j(()=>m.value.map(t=>({isVirtualCol:Xt(t),isReadonly:Pa(t)})));function cl(t){fa("smooth"),setTimeout(()=>{ze.value=!0,U.value=t},500)}const Na=(t=!1)=>{Zt.value=null,ze.value=!1,U.value={},t&&setTimeout(()=>{fa("smooth")},200)};async function Oa(t){if(t&&t!==(H==null?void 0:H.key))return;const o=ao(V.value.length,!0);o&&(le==null||le(o,void 0,!0,t))}const pl=()=>{u.trigger(H==null?void 0:H.key)},Ia=()=>{r(!0),ao()},Mo=()=>{r(!1),pl()},fl=(t,o,s)=>{var ye,Be;const R=o.getBoundingClientRect(),Ee=15,ee=((ye=o.querySelector("thead th:nth-child(1)"))==null?void 0:ye.getBoundingClientRect().width)??0,xt=((Be=o.querySelector("thead th:nth-child(2)"))==null?void 0:Be.getBoundingClientRect().width)??0,he=ee+xt,Te={right:t.right+ee-R.width-o.scrollLeft,left:t.left+ee-o.scrollLeft-he,bottom:t.bottom-R.height-o.scrollTop,top:t.top-o.scrollTop},je={top:0,left:0};return je.left=Te.right+((s==null?void 0:s.right)||0)>0?o.scrollLeft+Te.right+((s==null?void 0:s.right)||0)+Ee:Te.left-((s==null?void 0:s.left)||0)<0?o.scrollLeft+Te.left-((s==null?void 0:s.left)||0)-Ee:o.scrollLeft,je.top=Te.bottom+((s==null?void 0:s.bottom)||0)>0?o.scrollTop+Te.bottom+((s==null?void 0:s.bottom)||0)+Ee:Te.top-((s==null?void 0:s.top)||0)<0?o.scrollTop+Te.top-((s==null?void 0:s.top)||0)-Ee:o.scrollTop,je},{selectRangeMap:Yo,fillRangeMap:Ta,activeCell:w,handleMouseDown:Ba,handleMouseOver:Ga,handleCellClick:vl,clearSelectedRange:It,copyValue:ml,isCellActive:Ha,resetSelectedRange:wl,makeActive:jo,selectedRange:pe,isFillMode:Ua}=Yr(fe,m,V,Pe,g,At,Va,ja,ia,Ie,async t=>{var Ee,ee,xt,he,Te,je,ye,Be,Ct,qt,Tt;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return t.preventDefault(),!0;if(xo())return;if(Go())return!0;const s=Bo()?t.metaKey:t.ctrlKey,R=t.altKey;if(t.key===" "){const wt=xo();if(Ha.value&&!Pe.value&&Ue.value&&w.row!==null&&!wt){t.preventDefault();const Ht=V.value[w.row];return le==null||le(Ht),!0}}else if(t.key==="Escape"){if(Pe.value)return Pe.value=!1,!0}else if(t.key==="Enter"){if(t.shiftKey)return!0;if(Pe.value)return Pe.value=!1,!0}else if(t.key==="Tab"){if(t.shiftKey&&w.row===0&&w.col===0&&!((Ee=z.value)!=null&&Ee.isFirstPage))return t.preventDefault(),await No((((ee=z.value)==null?void 0:ee.pageSize)??25)-1,((xt=m.value)==null?void 0:xt.length)-1,-1),!0;if(!t.shiftKey&&w.row===V.value.length-1&&w.col===((he=m.value)==null?void 0:he.length)-1){if(t.preventDefault(),(Te=z.value)!=null&&Te.isLastPage&&vo.value)return Wo.value=!0,!0;if(!((je=z.value)!=null&&je.isLastPage))return await No(0,0,1),!0}}else if(!s&&!t.shiftKey&&t.key==="ArrowUp"){if(w.row===0&&!((ye=z.value)!=null&&ye.isFirstPage))return t.preventDefault(),await No((((Be=z.value)==null?void 0:Be.pageSize)??25)-1,w.col,-1),!0}else if(!s&&!t.shiftKey&&t.key==="ArrowDown"&&w.row===V.value.length-1){if(t.preventDefault(),(Ct=z.value)!=null&&Ct.isLastPage&&vo.value)return Wo.value=!0,!0;if(!((qt=z.value)!=null&&qt.isLastPage))return await No(0,w.col,1),!0}if(s){if(!Ha.value||t.shiftKey)return;switch(t.key){case"ArrowUp":return t.preventDefault(),It(),w.row=0,w.col=w.col??0,Ie==null||Ie(),Pe.value=!1,!0;case"ArrowDown":return t.preventDefault(),It(),w.row=V.value.length-1,w.col=w.col??0,Ie==null||Ie(),Pe.value=!1,!0;case"ArrowRight":return t.preventDefault(),It(),w.row=w.row??0,w.col=((Tt=m.value)==null?void 0:Tt.length)-1,Ie==null||Ie(),Pe.value=!1,!0;case"ArrowLeft":return t.preventDefault(),It(),w.row=w.row??0,w.col=0,Ie==null||Ie(),Pe.value=!1,!0}}if(R)switch(t.keyCode){case 82:{vo.value&&(X("c:shortcut",{key:"ALT + R"}),ao(),w.row=V.value.length-1,w.col=0,wl(),Eo(()=>{var wt;(wt=document.querySelector("td.cell.active"))==null||wt.scrollIntoView({behavior:"smooth"})}));break}case 67:{Kt.value&&(X("c:shortcut",{key:"ALT + C"}),fa(void 0),setTimeout(()=>{ze.value=!0},250));break}}},async t=>{const o=V.value[t.row],s=t.col!==void 0?m.value[t.col]:null;!o||!s||!t.updatedColumnTitle&&Xt(s)||(V.value[t.row].rowMeta.isUpdatedFromCopyNPaste={...V.value[t.row].rowMeta.isUpdatedFromCopyNPaste,[t.updatedColumnTitle||s.title]:!0},await(C==null?void 0:C(o,t.updatedColumnTitle||s.title)))},ie,pt,re,z,b);function Wa(t){It(),jo(t??V.value.length-1,0),pe.startRange({row:w.row,col:w.col}),Ie==null||Ie()}async function gl(t){await(C==null?void 0:C(t))}function ao(t,o=!1){const s=A==null?void 0:A(t);return!o&&s&&gl(s),Eo().then(()=>{Wa(t??V.value.length-1)}),s}const hl=t=>{try{ce==null||ce(t),pe.isRowInRange(t)&&It(),w.row===t&&(w.row=null,w.col=null)}catch(o){Ve.error(o.message)}},yl=t=>{try{Fo.value=!0;const o=V.value[t];le&&le(o),w.row=null,w.col=null,pe.clear()}catch(o){Ve.error(o.message)}},_l=()=>{oe==null||oe(pe).then(()=>{It(),w.row=null,w.col=null})},Ya=t=>{if(zt.value){zt.value=!1;return}const o=m.value.findIndex(s=>s.id===t);o!==-1&&(jo(0,o),pe.startRange({row:0,col:o}),pe.endRange({row:V.value.length-1,col:o}))};Zl(ut,t=>{if(ke.value||zt.value||At.value||w.row===null||w.col===null||xo())return;const s=m.value[w.col];if(Pe.value&&(Xt(s)||s.uidt===$.JSON)||Ua.value)return;const R=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-dropdown-user-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active,.nc-link-dropdown-root");t.target&&R&&(R===t.target||R!=null&&R.contains(t.target))||Go()||(It(),w.row=null,w.col=null)});const Ko=t=>{if(!(w.row===null||w.col===null)){switch(Pe.value=!1,It(),t){case wo.NEXT:w.row<V.value.length-1||ao(),w.row++;break;case wo.PREV:w.row>0&&w.row--;break}Eo(()=>{Ie()})}};async function ja(){if(!Ue.value||vt.value)return;const t=pe.start,o=pe.end,s=Math.min(t.row,o.row),R=Math.max(t.row,o.row),Ee=Math.min(t.col,o.col),ee=Math.max(t.col,o.col),xt=m.value.slice(Ee,ee+1),he=V.value.slice(s,R+1),Te=[];let je=!1;for(const ye of he)for(const Be of xt)if(!(!ye||!Be||!Be.title)){if(Xt(Be)){(uo(Be)||go(Be)||so(Be))&&!je&&(Ve.info(Je("msg.info.groupClearIsNotSupportedOnLinksColumn")),je=!0);continue}Pa(Be)||(ye.row[Be.title]=null,Te.push(Be.title))}await(ie==null?void 0:ie(he,Te))}const kt=j(()=>m.value.filter(t=>t.id&&F.value[t.id]&&F.value[t.id].width&&F.value[t.id].show).map(t=>+F.value[t.id].width.replace("px","")||200).reduce((t,o,s)=>(t.push(t[s]+o),t),[0])),We=j(()=>N.value||lt.value),Ka=h();function Ie(t,o){if(t=t??w.row,o=o??w.col,t!==null&&o!==null&&We.value){const s={top:t*mo[`${L.rowHeight}`],left:kt.value[o],right:o===m.value.length-1?kt.value[kt.value.length-1]+200:kt.value[o+1],bottom:(t+1)*mo[`${L.rowHeight}`]},R=fl(s,We.value,{top:9,bottom:(Gt.value||40)+9,right:9});if(_e.value&&(R.top=We.value.scrollTop),o===0&&(R.left=0),t===V.value.length-1){We.value.scrollTo({top:_e.value?We.value.scrollTop:We.value.scrollHeight,left:o===m.value.length-1?We.value.scrollWidth:R.left,behavior:"smooth"});return}if(o===m.value.length-1){We.value.scrollTo({top:R.top,left:We.value.scrollWidth,behavior:"smooth"});return}We.value.scrollTo({top:R.top,left:R.left,behavior:"smooth"})}}async function No(t,o,s){var R;It(),s!==void 0&&((R=z.value)!=null&&R.page)?(await(b==null?void 0:b(z.value.page+s)),await Eo(),jo(t,o)):(jo(t,o),await Eo()),Ie==null||Ie()}const qo=h([]),ua=async(t={})=>{var o;for(const s of t.data||V.value)if(!s.rowMeta.fromExpandedForm){if(s.rowMeta.new){const R=tt(s);await(C==null?void 0:C(s,"",s.rowMeta.ltarState||{},t))?s.rowMeta.changed=!1:t.keepNewRecords&&R.rowMeta.new&&Object.keys(R.row).length&&qo.value.push(R);continue}if(s.rowMeta.changed){s.rowMeta.changed=!1;for(const R of((o=t.metaValue||fe.value)==null?void 0:o.columns)??[])Xt(R)||R.uidt===$.Attachment||R.title in s.row&&s.row[R.title]!==s.oldRow[R.title]&&await(C==null?void 0:C(s,R.title,{},t))}}},qa={[$.Attachment]:{minWidth:80,maxWidth:Number.POSITIVE_INFINITY},[$.Button]:{minWidth:100,maxWidth:320}},Xa=(t,o)=>{if(t.uidt in qa){const{minWidth:s,maxWidth:R}=qa[t.uidt];if(s<o&&o<R)return o;if(o<s)return s;if(o>R)return R}return o},Ja=(t,o)=>{if(!t)return;const s=o.detail.split("px")[0];Do(t,{width:`${Xa(it.value[t],s)}px`})},Qa=(t,o)=>{if(!t)return;const s=o.detail.split("px")[0];F.value[t].width=`${Xa(it.value[t],s)}px`},Za=(t,o)=>{t&&(Dt.value=o.detail,zt.value=!0)},en=(t,o,s)=>{U.value={title:t,uidt:o,colOptions:s},nt.value=!1},tn=h(),bl=()=>{var t;ze.value=!0,(t=tn.value)!=null&&t.isWebHookModalOpen()||(ze.value=!1)},kl=j(()=>kt.value[kt.value.length-1]+64),xl=j(()=>V.value.length*(T.value?56:mo[`${L.rowHeight}`])),yo=h({start:0,end:0}),Co=h({start:0,end:0}),_o=()=>{if(!We.value||!lt.value){yo.value={start:0,end:0},Co.value={start:0,end:0},setTimeout(_o,100);return}let t=0;if(te.value!==!0){let o=0,s=kt.value.length-1;for(;s!==o;){const ee=Math.floor((s-o)/2+o);if(kt.value[ee]<=We.value.scrollLeft&&kt.value[ee+1]>We.value.scrollLeft){t=ee;break}if(ee===o){t=s;break}else kt.value[ee]<=We.value.scrollLeft?o=ee:s=ee}let R=0,Ee=!1;for(let ee=t;ee<kt.value.length;ee++)if(kt.value[ee]>lt.value.clientWidth+We.value.scrollLeft){R=ee,Ee=!0;break}yo.value={start:Math.max(0,t-ea),end:Ee?Math.min(m.value.length,R+ea):m.value.length}}if(Z.value!==!0){const o=mo[`${L.rowHeight}`],s=Math.max(0,Math.floor(We.value.scrollTop/o)-ea),R=Math.min(V.value.length,s+Math.ceil(lt.value.clientHeight/o)+ea);Co.value={start:s,end:R}}},on=j(()=>te.value?m.value.map((o,s)=>({field:o,index:s})).filter(o=>o.index!==0):m.value.slice(yo.value.start,yo.value.end).map((o,s)=>({field:o,index:s+yo.value.start})).filter(o=>o.index!==0)),Rl=j(()=>Z.value?V.value.map((t,o)=>({row:t,index:o})):V.value.slice(Co.value.start,Co.value.end).map((t,o)=>({row:t,index:o+Co.value.start}))),no=j(()=>yo.value.start>0?kt.value[yo.value.start]-kt.value[1]:0),$l=j(()=>mo[`${L.rowHeight}`]*Co.value.start),an=h(),nn=h(),da=()=>{Eo(()=>{const t=isNaN(pe.end.row)?w.row:pe.end.row,o=isNaN(pe.end.col)?w.col:pe.end.col;if(t!==null&&o!==null){if(!We.value||!lt.value)return;an.value=(t+1)*mo[`${L.rowHeight}`]+(Ne.value?0:32),nn.value=64+kt.value[o+1]+(o===0?Math.max(0,We.value.scrollLeft-lt.value.offsetLeft):0)}})},Xo=j(()=>pe.isEmpty()&&w.col&&oo.value[w.col].isReadonly||!pe.isEmpty()&&Array.from({length:pe.end.col-pe.start.col+1}).every((t,o)=>oo.value[pe.start.col+o].isReadonly)),Sl=j(()=>{var t,o;return!vt.value&&!we.value&&!Pe.value&&(!pe.isEmpty()||w.row!==null&&w.col!==null)&&!((o=(t=V.value[(isNaN(pe.end.row)?w.row:pe.end.row)??-1])==null?void 0:t.rowMeta)!=null&&o.new)&&w.col!==null&&m.value[w.col]&&!I.value&&!ae.value&&V.value.length&&!Xo.value});Ro([()=>pe.end.row,()=>pe.end.col,()=>w.row,()=>w.col],([t,o,s,R],[Ee,ee,xt,he])=>{(t!==Ee||o!==ee||s!==xt||R!==he)&&(_o(),da())}),ta(()=>{const t=new ResizeObserver(()=>{var o;da(),w.row!==null&&!((o=V.value)!=null&&o[w.row])&&(It(),w.row=null,w.col=null)});ve.value&&t.observe(ve.value),na(We).toBeTruthy().then(()=>_o())}),B.on(async(t,o)=>{t===co.FIELD_ADD&&(Zt.value=o,ze.value=!0),t===co.CLEAR_NEW_ROW&&(It(),w.row=null,w.col=null,me==null||me(o))});async function ln(t){var o,s,R;if(t!=null&&t.shouldShowLoading&&(I.value=!0),(o=Yt.value)!=null&&o.length){const Ee=(R=(s=fe.value)==null?void 0:s.columns)==null?void 0:R.map(ee=>ee.title);Yt.value=Yt.value.filter(ee=>!(Ee!=null&&Ee.includes(ee.title)))}await ua({keepNewRecords:!0}),await(W==null?void 0:W({...(t==null?void 0:t.offset)!==void 0?{offset:t.offset}:{}},t==null?void 0:t.shouldShowLoading)),qo.value.length&&(V.value.push(...qo.value),qo.value=[]),_o(),I.value=!1}let ca=null;Jt(We,"scroll",t=>{Ka.value=t.target.scrollLeft,ca&&cancelAnimationFrame(ca),ca=requestAnimationFrame(()=>{_o(),da()})}),Jt(document,"mousedown",t=>{var o,s;(t.offsetX>((o=t.target)==null?void 0:o.clientWidth)||t.offsetY>((s=t.target)==null?void 0:s.clientHeight))&&(ke.value=!0),t.target.closest(".nc-grid-cell:not(.caption)")&&(eo.value=!0)}),Jt(document,"mouseup",()=>{eo.value=!1,setTimeout(()=>{ke.value=!1},100)}),Jt(document,"keydown",async t=>{const o=xo();t.key==="Alt"&&!o&&(Me.value=!0)}),Jt(document,"keyup",async t=>{var Ee,ee;const o=xo();t.key==="Alt"&&!o&&(Me.value=!1,Ce.value=!1);const s=document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"),R=Bo()?t.metaKey:t.ctrlKey;Wo.value&&!o&&!s&&!Go()&&!R&&!t.shiftKey&&!t.altKey&&(t.key==="Tab"&&w.row===V.value.length-1&&w.col===((Ee=m.value)==null?void 0:Ee.length)-1||t.key==="ArrowDown"&&w.row===V.value.length-1&&((ee=z.value)!=null&&ee.isLastPage)&&vo.value)&&(ao(),await No(V.value.length-1,0),Wo.value=!1)}),Jt(document,"keydown",async t=>{const o=Bo()?t.metaKey:t.ctrlKey;if(t.altKey&&!t.shiftKey&&!o)switch(t.keyCode){case 78:{vo.value&&ao();break}}}),Qn(async()=>{const t=re.value,o=V.value;t&&_t(t.fk_model_id,!1,!0).then(s=>{const R=s;R&&ua({metaValue:R,viewMetaValue:t,data:o})}),He==null||He.off(ln),u==null||u.off(Oa)}),He==null||He.on(ln),u==null||u.on(Oa),Ro(At,()=>{At.value?Mt.value=!1:(Mt.value=!0,Qe.value=null)}),Ro(()=>$e.params.viewId,()=>{I.value=!0}),Ro(re,async(t,o)=>{try{if(t&&t.id!==(o==null?void 0:o.id)&&(t.fk_model_id===$e.params.viewId||Re.value)){if(Pt.value=!0,o!=null&&o.id){const s=await _t(o.fk_model_id,!1,!0);s&&await ua({viewMetaValue:o,metaValue:s,data:V.value})}I.value=!0;try{_e.value?await(W==null?void 0:W()):await Promise.allSettled([W==null?void 0:W(),ge()]),_o()}catch(s){er.isCancel(s)||(console.log(s),Ve.error(Je("msg.errorLoadingData")))}finally{I.value=!1}}}catch(s){console.log(s)}finally{Pt.value=!1}},{immediate:!0}),Ro([()=>m.value.length,()=>V.value.length],()=>{_o()}),Et(tr,Ce),y({scrollToRow:Wa,openColumnCreate:cl});const pa=(t,o)=>{le&&le(t,o),w.row=null,w.col=null,pe.clear()},rn=(t,o,s)=>{const R=V.value[o];if(T.value)return pa(R,m.value[s]);vl(t,o,s)},Dl=j(()=>{var t,o,s,R;if(ae.value)return(t=z.value)!=null&&t.totalRows&&((o=z.value)!=null&&o.pageSize)?`Loading page<br/>${z.value.page} of ${Math.ceil(((s=z.value)==null?void 0:s.totalRows)/((R=z.value)==null?void 0:R.pageSize))}`:Je("general.loading")});function fa(t){var o;We.value&&((o=We.value)==null||o.scrollTo({top:We.value.scrollTop,left:We.value.scrollWidth,behavior:t}))}return Qo("ArrowLeft",bt),Qo("ArrowRight",Oe),Qo("ArrowUp",at),Qo("ArrowDown",mt),(t,o)=>{var vn,mn,wn,gn,hn,yn;const s=nr,R=Pr,Ee=Nr,ee=vi,xt=mi,he=Zn,Te=pi,je=zr,ye=ll,Be=ii,Ct=rl,qt=lr,Tt=oi,wt=wi,Ht=rr,Nt=ir,sn=gi,un=hi,dn=Ur,Al=yi,cn=$r,Ml=Jr,pn=il,Jo=el,Cl=sr,El=_i,Ll=bi,fn=zn("xc-ver-resize"),Ze=zn("e");return n(),M("div",{class:De(["flex flex-col",`${e(x)!==!0?"h-full w-full":""}`])},[ki,_("div",{ref_key:"dragColPlaceholderDomRef",ref:Ae,class:De([{"hidden w-0 !h-0 left-0 !max-h-0 !max-w-0":!e(rt)},"absolute flex items-center z-40 top-0 h-full bg-gray-50 pointer-events-none opacity-60"])},[e(rt)?(n(),M("div",{key:0,style:Ye({"min-width":((vn=e(F)[e(rt).id])==null?void 0:vn.width)||"200px","max-width":((mn=e(F)[e(rt).id])==null?void 0:mn.width)||"200px",width:((wn=e(F)[e(rt).id])==null?void 0:wn.width)||"200px"}),class:"border-r-1 border-l-1 border-gray-200 h-full"},null,4)):Q("",!0)],2),_("div",{ref_key:"gridWrapper",ref:lt,class:De(["nc-grid-wrapper min-h-0 flex-1 relative",e(ul)])},[Se(_("div",xi,[_("div",Ri,[Y(s,{size:"xlarge"}),_("span",{class:"text-center",innerHTML:e(Dl)},null,8,$i)])],512),[[To,e(ae)&&!e(x)]]),Y(pn,{visible:e(At),"onUpdate:visible":o[34]||(o[34]=et=>Ot(At)?At.value=et:null),trigger:e(P)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:E(()=>[Y(Ct,{class:"!rounded !py-0",onClick:o[33]||(o[33]=et=>At.value=!1)},{default:E(()=>{var et;return[("isEeUI"in t?t.isEeUI:e(wa))&&!e(Mt)&&!e(Qe)&&t.data.some(gt=>gt.rowMeta.selected)&&!e(vt)?(n(),k(ye,{key:0,onClick:o[27]||(o[27]=gt=>a("bulkUpdateDlg"))},{default:E(()=>[Se((n(),M("div",ls,[(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).ncEdit))),Le(" "+J(t.$t("title.updateSelectedRows")),1)])),[[Ze,["a:row:update-bulk"]]])]),_:1})):Q("",!0),!e(Mt)&&!e(Qe)&&t.data.some(gt=>gt.rowMeta.selected)&&!e(vt)?(n(),k(ye,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50","data-testid":"nc-delete-row",onClick:e(q)},{default:E(()=>[t.data.filter(gt=>gt.rowMeta.selected).length===1?Se((n(),M("div",rs,[(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).delete))),Le(" "+J(t.$t("activity.deleteSelectedRow")),1)])),[[Ze,["a:row:delete"]]]):Se((n(),M("div",is,[(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).delete))),Le(" "+J(t.$t("activity.deleteSelectedRow")),1)])),[[Ze,["a:row:delete-bulk"]]])]),_:1},8,["onClick"])):Q("",!0),e(Qe)?(n(),k(ye,{key:2,class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:o[28]||(o[28]=gt=>e(ml)(e(Qe)))},{default:E(()=>[Se((n(),M("div",ss,[Y(he,{icon:"copy"}),Le(" "+J(t.$t("general.copy"))+" "+J(t.$t("objects.cell").toLowerCase()),1)])),[[Ze,["a:row:copy"]]])]),_:1})):Q("",!0),e(Qe)&&e(Ue)&&!e(vt)?(n(),k(ye,{key:3,class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(Xo),onClick:e(d)},{default:E(()=>[Se((n(),M("div",us,[Y(he,{icon:"paste"}),Le(" "+J(t.$t("general.paste"))+" "+J(t.$t("objects.cell").toLowerCase()),1)])),[[Ze,["a:row:paste"]]])]),_:1},8,["disabled","onClick"])):Q("",!0),e(Qe)&&e(Ue)&&e(pe).isSingleCell()&&(e(ba)(e(m)[e(Qe).col])||!((et=e(sa)[0])!=null&&et[e(Qe).col].isVirtualCol))&&!e(vt)?(n(),k(ye,{key:4,class:"nc-base-menu-item",disabled:e(Xo),"data-testid":"context-menu-item-clear",onClick:o[29]||(o[29]=gt=>Va(e(Qe)))},{default:E(()=>[Se((n(),M("div",ds,[Y(he,{icon:"close"}),Le(" "+J(t.$t("general.clear"))+" "+J(t.$t("objects.cell").toLowerCase()),1)])),[[Ze,["a:row:clear"]]])]),_:1},8,["disabled"])):e(Qe)&&e(Ue)&&!e(vt)?(n(),k(ye,{key:5,class:"nc-base-menu-item",disabled:e(Xo),"data-testid":"context-menu-item-clear",onClick:o[30]||(o[30]=gt=>ja())},{default:E(()=>[Se((n(),M("div",cs,[Y(he,{icon:"closeBox",class:"text-gray-500"}),Le(" "+J(t.$t("general.clear"))+" "+J(t.$t("objects.cell").toLowerCase()),1)])),[[Ze,["a:row:clear-range"]]])]),_:1},8,["disabled"])):Q("",!0),e(Qe)&&e(pe).isSingleCell()&&e(Qt)("commentEdit")&&!e(T)?(n(),M(qe,{key:6},[Y(cn),Y(ye,{class:"nc-base-menu-item",onClick:o[31]||(o[31]=gt=>yl(e(Qe).row))},{default:E(()=>[Se((n(),M("div",ps,[Y(Ml,{class:"h-4 w-4"}),Le(" "+J(t.$t("general.add"))+" "+J(t.$t("general.comment").toLowerCase()),1)])),[[Ze,["a:row:comment"]]])]),_:1})],64)):Q("",!0),e(Ue)&&!e(vt)?(n(),M(qe,{key:7},[!e(Mt)&&!e(Qe)&&t.data.some(gt=>gt.rowMeta.selected)?Q("",!0):(n(),k(cn,{key:0})),e(Qe)&&(e(pe).isSingleCell()||e(pe).isSingleRow())?(n(),k(ye,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:o[32]||(o[32]=gt=>hl(e(Qe).row))},{default:E(()=>[Se((n(),M("div",fs,[Y(he,{icon:"delete"}),Le(" "+J(t.$t("activity.deleteRow")),1)])),[[Ze,["a:row:delete"]]])]),_:1})):e(Qe)&&e(oe)?(n(),k(ye,{key:2,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:_l},{default:E(()=>[Se((n(),M("div",vs,[Y(he,{icon:"delete",class:"text-gray-500 text-red-600"}),Le(" "+J(t.$t("activity.deleteRows")),1)])),[[Ze,["a:row:delete"]]])]),_:1})):Q("",!0)],64)):Q("",!0)]}),_:1})]),default:E(()=>{var et,gt,_n;return[_("div",null,[_("table",{class:De(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white sticky top-0 z-5 bg-white",{mobile:e(T),desktop:!e(T)}]),style:Ye({transform:`translateX(${e(no)}px)`})},[Se(_("thead",{ref_key:"tableHeadEl",ref:Ft},[e(ft)?(n(),M("tr",Si,[(n(!0),M(qe,null,Ut(e(za),(S,D)=>(n(),M("td",{key:D,class:De(["!bg-gray-50 h-full border-b-1 border-r-1",{"min-w-45":D!==0,"min-w-16":D===0}])},[Y(R,{active:!0,title:!0,paragraph:!1,class:De(["ml-2 -mt-2",{"max-w-32":D!==0,"max-w-5 !ml-3.5":D===0}])},null,8,["class"])],2))),128))])):Q("",!0),Se(_("tr",Di,[_("th",{class:"w-[64px] min-w-[64px]","data-testid":"grid-id-column",style:Ye({left:`-${e(no)}px`})},[_("div",Ai,[!e(we)&&!t.hideCheckbox?(n(),M(qe,{key:0},[_("div",{class:De(["nc-no-label text-gray-500",{hidden:e(K)}])},"#",2),_("div",{class:De([{hidden:!e(K),flex:e(K)},"nc-check-all w-full items-center"])},[Y(Ee,{checked:e(K),"onUpdate:checked":o[0]||(o[0]=S=>Ot(K)?K.value=S:null)},null,8,["checked"]),Mi],2)],64)):(n(),M("div",Ci,"#"))])],4),e(m)[0]&&e(m)[0].id?Se((n(),M("th",{key:0,"data-col":e(m)[0].id,"data-title":e(m)[0].title,style:Ye({"min-width":((et=e(F)[e(m)[0].id])==null?void 0:et.width)||"180px","max-width":((gt=e(F)[e(m)[0].id])==null?void 0:gt.width)||"180px",width:((_n=e(F)[e(m)[0].id])==null?void 0:_n.width)||"180px",...e(no)>0?{left:`-${e(no)-64}px`}:{}}),class:De(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(ot)===e(m)[0].id}]),onXcstartresizing:o[4]||(o[4]=S=>Za(e(m)[0].id,S)),onXcresize:o[5]||(o[5]=S=>Ja(e(m)[0].id,S)),onXcresizing:o[6]||(o[6]=S=>Qa(e(m)[0].id,S)),onClick:o[7]||(o[7]=S=>Ya(e(m)[0].id))},[_("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:"false",onDragstart:o[1]||(o[1]=$t(S=>e(de)(e(m)[0].id,S),["stop"])),onDrag:o[2]||(o[2]=$t(S=>e(po)(S),["stop"])),onDragend:o[3]||(o[3]=$t(S=>e(G)(S),["stop"]))},[e(m)[0]&&e(oo)[0].isVirtualCol?(n(),k(ee,{key:0,column:e(m)[0],"hide-menu":e(we)||!!e(T)},null,8,["column","hide-menu"])):(n(),k(xt,{key:1,column:e(m)[0],"hide-menu":e(we)||!!e(T)},null,8,["column","hide-menu"]))],32)],46,Ei)),[[fn]]):Q("",!0),(n(!0),M(qe,null,Ut(e(on),({field:S,index:D})=>{var Bt,lo,Oo;return Se((n(),M("th",{key:S.id,"data-col":S.id,"data-title":S.title,style:Ye({"min-width":((Bt=e(F)[S.id])==null?void 0:Bt.width)||"180px","max-width":((lo=e(F)[S.id])==null?void 0:lo.width)||"180px",width:((Oo=e(F)[S.id])==null?void 0:Oo.width)||"180px"}),class:De(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(ot)===S.id}]),onXcstartresizing:Rt=>Za(S.id,Rt),onXcresize:Rt=>Ja(S.id,Rt),onXcresizing:Rt=>Qa(S.id,Rt),onClick:Rt=>Ya(S.id)},[_("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:e(T)||D===0||e(we)||!e(Ue)?"false":"true",onDragstart:$t(Rt=>e(de)(S.id,Rt),["stop"]),onDrag:o[8]||(o[8]=$t(Rt=>e(po)(Rt),["stop"])),onDragend:o[9]||(o[9]=$t(Rt=>e(G)(Rt),["stop"]))},[e(oo)[D].isVirtualCol?(n(),k(ee,{key:0,column:S,"hide-menu":e(we)||!!e(T)},null,8,["column","hide-menu"])):(n(),k(xt,{key:1,column:S,"hide-menu":e(we)||!!e(T)},null,8,["column","hide-menu"]))],40,Vi)],46,Li)),[[fn]])}),128)),e(Kt)?Se((n(),M("th",{key:1,class:"cursor-pointer !border-0 relative !xs:hidden",style:{borderWidth:"0px !important"},onClick:o[19]||(o[19]=$t(S=>ze.value=!0,["stop"]))},[_("div",Fi,[Y(Ht,{visible:e(ze),"onUpdate:visible":o[18]||(o[18]=S=>Ot(ze)?ze.value=S:null),trigger:["click"],"overlay-class-name":"nc-dropdown-grid-add-column",onVisibleChange:bl},Pn({default:E(()=>[_("div",zi,[("isEeUI"in t?t.isEeUI:e(wa))&&(e(Me)||e(nt))?(n(),k(he,{key:0,icon:"magic",class:"text-sm text-orange-400"})):Q("",!0),(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:2},[("isEeUI"in t?t.isEeUI:e(wa))&&e(nt)?{name:"overlay",fn:E(()=>[Y(Ct,null,{default:E(()=>{var S;return[(S=e(Yt))!=null&&S.length?(n(),k(qt,{key:"predict-column"},{title:E(()=>[_("div",Pi,[Y(Te,{class:"flex h-[1rem] text-gray-500"}),_("div",Ni,J(t.$t("activity.predictColumns")),1),Y(je,{class:"text-gray-500 ml-2"})])]),expandIcon:E(()=>[]),default:E(()=>[Y(Ct,null,{default:E(()=>[(n(!0),M(qe,null,Ut(e(Yt),D=>(n(),k(ye,{key:`predict-${D.title}-${D.type}`},{default:E(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:Bt=>en(D.title,D.type)},[_("div",Ii,J(D.title),1)],8,Oi)]),_:2},1024))),128)),Y(ye,null,{default:E(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:o[10]||(o[10]=(...D)=>e(be)&&e(be)(...D))},[_("div",Ti,[Y(Be),Le(" Generate Again ")])])]),_:1})]),_:1})]),_:1})):(n(),k(ye,{key:1},{default:E(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:o[11]||(o[11]=(...D)=>e(be)&&e(be)(...D))},[e(zo)?(n(),k(Be,{key:0,class:"animate-infinite animate-spin"})):(n(),k(Te,{key:1,class:"flex h-[1rem] text-gray-500"})),_("div",Bi,J(t.$t("activity.predictColumns")),1)])]),_:1})),e(ho)?(n(),k(qt,{key:"predict-formula"},{title:E(()=>[_("div",Gi,[Y(Tt,{class:"flex h-[1rem] text-gray-500"}),_("div",Hi,J(t.$t("activity.predictFormulas")),1),Y(je,{class:"text-gray-500 ml-2"})])]),expandIcon:E(()=>[]),default:E(()=>[Y(Ct,null,{default:E(()=>[(n(!0),M(qe,null,Ut(e(ho),D=>(n(),k(ye,{key:`predict-${D.title}-formula`},{default:E(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:Bt=>en(D.title,"Formula",{formula_raw:D.formula})},[_("div",Wi,J(D.title),1)],8,Ui)]),_:2},1024))),128))]),_:1})]),_:1})):(n(),k(ye,{key:3},{default:E(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:o[12]||(o[12]=(...D)=>e(l)&&e(l)(...D))},[e(Po)?(n(),k(Be,{key:0,class:"animate-infinite animate-spin"})):(n(),k(Tt,{key:1,class:"flex h-[1rem] text-gray-500"})),_("div",Yi,J(t.$t("activity.predictFormulas")),1)])]),_:1}))]}),_:1})]),key:"0"}:{name:"overlay",fn:E(()=>[_("div",ji,[e(ze)?(n(),k(wt,{key:0,ref_key:"editOrAddProviderRef",ref:tn,preload:e(U),"column-position":e(Zt),class:De({hidden:e(La)}),onSubmit:o[13]||(o[13]=S=>Na(!0)),onCancel:o[14]||(o[14]=S=>Na()),onClick:o[15]||(o[15]=$t(()=>{},["stop"])),onKeydown:o[16]||(o[16]=$t(()=>{},["stop"])),onMounted:o[17]||(o[17]=S=>U.value=void 0)},null,8,["preload","column-position","class"])):Q("",!0)])]),key:"1"}]),1032,["visible"])])])),[[Ze,["c:column:add"]]]):Q("",!0),_("th",Ki,[_("div",{class:De(["absolute top-0 w-45",{"left-[60px]":e(Kt),"left-0":!e(Kt)}])},"   ",2)])],512),[[To,!e(ft)]])],512),[[To,e(Ne)!==!0]])],6),e(Ao)?Q("",!0):(n(),M("div",{key:0,class:De(["table-overlay",{"nc-grid-skeleton-loader":e(Ao)}]),style:Ye({height:`${e(xl)}px`,width:`${e(kl)}px`})},[_("table",{ref_key:"smartTable",ref:ve,class:De(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white relative",{mobile:e(T),desktop:!e(T),"w-full":e(V).length===0,"pb-12":!e(x)&&!e(_e)}]),style:Ye({transform:`translateY(${e($l)}px) translateX(${e(no)}px)`}),onContextmenu:fo},[e(x)!==!0?(n(),M("tbody",{key:0,ref_key:"tableBodyEl",ref:ut},[e(Ao)?(n(!0),M(qe,{key:0},Ut(e(dl),(S,D)=>(n(),M("tr",{key:D},[(n(!0),M(qe,null,Ut(e(za),(Bt,lo)=>(n(),M("td",{key:lo,class:De(["border-b-1 border-r-1",{"min-w-45":lo!==0,"min-w-16":lo===0}])},null,2))),128))]))),128)):Q("",!0),(n(!0),M(qe,null,Ut(e(Rl),({row:S,index:D})=>(n(),k(Al,{key:D,row:S},{default:E(({state:Bt})=>{var lo,Oo,Rt,bn,kn,xn,Rn,$n,Sn,Dn;return[Se(_("tr",{class:De(["nc-grid-row !xs:h-14",{"active-row":e(w).row===D||((lo=e(pe)._start)==null?void 0:lo.row)===D,"mouse-down":e(eo)||e(Ua),"selected-row":S.rowMeta.selected}]),style:Ye({height:t.rowHeight?`${("rowHeightInPx"in t?t.rowHeightInPx:e(mo))[`${t.rowHeight}`]}px`:`${("rowHeightInPx"in t?t.rowHeightInPx:e(mo))[1]}px`}),"data-testid":`grid-row-${D}`},[_("td",{key:"row-index",class:"caption nc-grid-cell w-[64px] min-w-[64px]",style:Ye({left:`-${e(no)}px`}),"data-testid":`cell-Id-${D}`,onContextmenu:o[20]||(o[20]=ne=>Qe.value=null)},[_("div",Ji,[_("div",{class:De(["nc-row-no sm:min-w-4 text-xs text-gray-500",{toggle:!e(we),hidden:S.rowMeta.selected}])},J(((((Oo=e(z))==null?void 0:Oo.page)??1)-1)*(((Rt=e(z))==null?void 0:Rt.pageSize)??25)+D+1),3),e(we)?Q("",!0):(n(),M("div",{key:0,class:De([{hidden:!S.rowMeta.selected,flex:S.rowMeta.selected},"nc-row-expand-and-checkbox"])},[Y(Ee,{checked:S.rowMeta.selected,"onUpdate:checked":ne=>S.rowMeta.selected=ne},null,8,["checked","onUpdate:checked"])],2)),Qi,_("div",{class:De(["nc-expand",{"nc-comment":(bn=S.rowMeta)==null?void 0:bn.commentCount}]),"data-testid":`nc-expand-${D}`},[S.rowMeta.saving?(n(),k(Nt,{key:0,class:"!flex items-center","data-testid":`row-save-spinner-${D}`},null,8,["data-testid"])):Q("",!0),(kn=S.rowMeta)!=null&&kn.commentCount&&e(le)?Se((n(),M("span",{key:1,class:"px-1 rounded-md rounded-bl-none transition-all border-1 border-brand-200 text-xs cursor-pointer font-sembold select-none leading-5 text-brand-500 bg-brand-50",onClick:ne=>pa(S,Bt)},[Le(J(S.rowMeta.commentCount),1)],8,es)),[[Ze,["c:expanded-form:open"]]]):S.rowMeta.saving?Q("",!0):(n(),M("div",ts,[e(le)?Se((n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).expand),{key:0,class:"select-none transform hover:text-black hover:scale-120 nc-row-expand",onClick:ne=>pa(S,Bt)},null,8,["onClick"])),[[Ze,["c:row-expand:open"]]]):Q("",!0)]))],10,Zi)])],44,Xi),e(m)[0]?(n(),k(dn,{key:e(m)[0].id,class:De(["cell relative nc-grid-cell cursor-pointer",{active:e(Yo)[`${D}-0`],"active-cell":e(w).row===D&&e(w).col===0||((xn=e(pe)._start)==null?void 0:xn.row)===D&&((Rn=e(pe)._start)==null?void 0:Rn.col)===0,"nc-required-cell":e(sa)[D][0].isColumnRequiredAndNull&&!e(Re),"align-middle":!t.rowHeight||t.rowHeight===1,"align-top":t.rowHeight&&t.rowHeight!==1,filling:e(Ta)[`${D}-0`],readonly:e(oo)[0].isReadonly&&e(Ue)&&e(Yo)[`${D}-0`],"!border-r-blue-400 !border-r-3":e(ot)===e(m)[0].id}]),style:Ye({"min-width":(($n=e(F)[e(m)[0].id])==null?void 0:$n.width)||"180px","max-width":((Sn=e(F)[e(m)[0].id])==null?void 0:Sn.width)||"180px",width:((Dn=e(F)[e(m)[0].id])==null?void 0:Dn.width)||"180px",...e(no)>0?{left:`-${e(no)-64}px`}:{}}),"data-testid":`cell-${e(m)[0].title}-${D}`,"data-key":`data-key-${D}-${e(m)[0].id}`,"data-col":e(m)[0].id,"data-title":e(m)[0].title,"data-row-index":D,"data-col-index":0,onMousedown:ne=>e(Ba)(ne,D,0),onMouseover:ne=>e(Ga)(ne,D,0),onClick:ne=>rn(ne,D,0),onDblclick:ne=>ia(S,e(m)[0]),onContextmenu:ne=>fo(ne,{row:D,col:0})},{default:E(()=>[e(Pt)?Q("",!0):(n(),M("div",os,[e(m)[0]&&e(oo)[0].isVirtualCol&&e(m)[0].title?(n(),k(sn,{key:0,modelValue:S.row[e(m)[0].title],"onUpdate:modelValue":ne=>S.row[e(m)[0].title]=ne,column:e(m)[0],active:e(w).col===0&&e(w).row===D,row:S,"read-only":!e(Ue),onNavigate:Ko,onSave:ne=>{var Ke;return(Ke=e(C))==null?void 0:Ke(S,"",Bt)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):e(m)[0]&&e(m)[0].title?(n(),k(un,{key:1,modelValue:S.row[e(m)[0].title],"onUpdate:modelValue":ne=>S.row[e(m)[0].title]=ne,column:e(m)[0],"edit-enabled":!!e(Ue)&&!!e(Pe)&&e(w).col===0&&e(w).row===D,"row-index":D,active:e(w).col===0&&e(w).row===D,"read-only":!e(Ue),"onUpdate:editEnabled":o[21]||(o[21]=ne=>Pe.value=ne),onSave:ne=>{var Ke;return(Ke=e(C))==null?void 0:Ke(S,e(m)[0].title,Bt)},onNavigate:Ko,onCancel:o[22]||(o[22]=ne=>Pe.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):Q("",!0)]))]),_:2},1032,["class","style","data-testid","data-key","data-col","data-title","data-row-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])):Q("",!0),(n(!0),M(qe,null,Ut(e(on),({field:ne,index:Ke})=>{var An,Mn,Cn,En,Ln;return n(),k(dn,{key:`cell-${Ke}-${D}`,class:De(["cell relative nc-grid-cell cursor-pointer",{active:e(Yo)[`${D}-${Ke}`],"active-cell":e(w).row===D&&e(w).col===Ke||((An=e(pe)._start)==null?void 0:An.row)===D&&((Mn=e(pe)._start)==null?void 0:Mn.col)===Ke,"nc-required-cell":e(sa)[D][Ke].isColumnRequiredAndNull&&!e(Re),"align-middle":!t.rowHeight||t.rowHeight===1,"align-top":t.rowHeight&&t.rowHeight!==1,filling:e(Ta)[`${D}-${Ke}`],readonly:e(oo)[Ke].isReadonly&&e(Ue)&&e(Yo)[`${D}-${Ke}`],"!border-r-blue-400 !border-r-3":e(ot)===ne.id}]),style:Ye({"min-width":((Cn=e(F)[ne.id])==null?void 0:Cn.width)||"180px","max-width":((En=e(F)[ne.id])==null?void 0:En.width)||"180px",width:((Ln=e(F)[ne.id])==null?void 0:Ln.width)||"180px"}),"data-testid":`cell-${ne.title}-${D}`,"data-key":`data-key-${D}-${ne.id}`,"data-col":ne.id,"data-title":ne.title,"data-row-index":D,"data-col-index":Ke,onMousedown:dt=>e(Ba)(dt,D,Ke),onMouseover:dt=>e(Ga)(dt,D,Ke),onClick:dt=>rn(dt,D,Ke),onDblclick:dt=>ia(S,ne),onContextmenu:dt=>fo(dt,{row:D,col:Ke})},{default:E(()=>[e(Pt)?Q("",!0):(n(),M("div",as,[e(oo)[Ke].isVirtualCol&&ne.title?(n(),k(sn,{key:0,modelValue:S.row[ne.title],"onUpdate:modelValue":dt=>S.row[ne.title]=dt,column:ne,active:e(w).col===Ke&&e(w).row===D,row:S,"read-only":!e(Ue),onNavigate:Ko,onSave:dt=>{var Io;return(Io=e(C))==null?void 0:Io(S,"",Bt)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):ne.title?(n(),k(un,{key:1,modelValue:S.row[ne.title],"onUpdate:modelValue":dt=>S.row[ne.title]=dt,column:ne,"edit-enabled":!!e(Ue)&&!!e(Pe)&&e(w).col===Ke&&e(w).row===D,"row-index":D,active:e(w).col===Ke&&e(w).row===D,"read-only":!e(Ue),"onUpdate:editEnabled":o[23]||(o[23]=dt=>Pe.value=dt),onSave:dt=>{var Io;return(Io=e(C))==null?void 0:Io(S,ne.title,Bt)},onNavigate:Ko,onCancel:o[24]||(o[24]=dt=>Pe.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):Q("",!0)]))]),_:2},1032,["class","style","data-testid","data-key","data-col","data-title","data-row-index","data-col-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128))],14,qi),[[To,!e(Ao)]])]}),_:2},1032,["row"]))),128)),e(vo)&&!e(_e)?Se((n(),M("tr",{key:1,class:De(["text-left nc-grid-add-new-cell cursor-pointer group relative z-3 xs:hidden",{"!border-r-2 !border-r-gray-100":e(Fa)===1}]),onMouseup:o[25]||(o[25]=$t(()=>{},["stop"])),onClick:o[26]||(o[26]=S=>ao())},[_("div",{class:"h-8 border-b-1 border-gray-100 bg-white group-hover:bg-gray-50 absolute left-0 bottom-0 px-2 sticky z-40 w-full flex items-center text-gray-500",style:Ye({left:`-${e(no)}px`})},[e(ft)?Q("",!0):(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).plus),{key:0,class:"text-pint-500 text-base ml-2 mt-0 text-gray-600 group-hover:text-black"}))],4),_("td",{class:"!border-gray-100",colspan:e(Fa)},null,8,ns)],34)),[[Ze,["c:row:add:grid-bottom"]]]):Q("",!0)],512)):Q("",!0)],38),Se(_("div",{ref_key:"fillHandle",ref:pt,class:De(["nc-fill-handle",!e(pe).isEmpty()&&e(pe).end.col!==0||e(pe).isEmpty()&&e(w).col!==0?"z-3":"z-4"]),style:Ye({top:`${e(an)}px`,left:`${e(nn)}px`,cursor:"crosshair"})},null,6),[[To,e(Sl)]])],6))])]}),_:1},8,["visible","trigger"])],2),_("div",ms,[e(x)!==!0&&e(z)&&e(_e)?(n(),k(El,{key:`nc-pagination-${e(T)}`,"pagination-data":e(z),"onUpdate:paginationData":o[37]||(o[37]=et=>Ot(z)?z.value=et:null),"show-api-timing":!e(_e),"align-count-on-right":"","align-left":e(_e),"change-page":e(b),"hide-sidebars":((gn=e(Xe))==null?void 0:gn.hideSidebars)===!0,"fixed-size":(hn=e(Xe))==null?void 0:hn.fixedSize,"extra-style":(yn=e(Xe))==null?void 0:yn.extraStyle,"show-size-changer":!e(_e)},Pn({_:2},[e(vo)&&!e(Ao)?{name:"add-record",fn:E(()=>[_("div",ws,[e(T)?Se((n(),k(Jo,{key:0,class:"nc-grid-add-new-row",type:"secondary",disabled:e(ae),onClick:o[35]||(o[35]=$t(et=>Mo(),["stop"]))},{default:E(()=>[Le(J(t.$t("activity.newRecord")),1)]),_:1},8,["disabled"])),[[Ze,[e(c)?"c:row:add:grid":"c:row:add:form"]]]):Se((n(),k(Cl,{key:1,class:"nc-grid-add-new-row",placement:"top",disabled:e(ae),onClick:o[36]||(o[36]=$t(et=>e(c)?ao():Mo(),["stop"]))},{overlay:E(()=>{var et;return[_("div",hs,[_("div",{class:De(["absolute -top-21 flex flex-col min-h-34.5 w-70 p-1.5 bg-white rounded-lg border-1 border-gray-200 justify-start overflow-hidden",{"-left-32.5":!e(c),"-left-21.5":e(c)}]),style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},[Se((n(),M("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-grid group",onClick:Ia},[_("div",ys,[_("div",_s,[(n(),k(ro((et=("viewIcons"in t?t.viewIcons:e(Nn))[e(ha).GRID])==null?void 0:et.icon),{class:"nc-view-icon text-inherit"})),Le(" "+J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.grid")),1)]),e(c)?(n(),k(he,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):Q("",!0)]),_("div",bs,J(t.$t("labels.addRowGrid")),1)])),[[Ze,["c:row:add:grid"]]]),Se((n(),M("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-form group",onClick:Mo},[_("div",ks,[_("div",xs,[Y(he,{class:"h-4.5 w-4.5",icon:"article"}),Le(" "+J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.form")),1)]),e(c)?Q("",!0):(n(),k(he,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),_("div",Rs,J(t.$t("labels.addRowForm")),1)])),[[Ze,["c:row:add:form"]]])],2)])]}),icon:E(()=>[(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).arrowUp),{class:"text-gray-600 h-4 w-4"}))]),default:E(()=>[_("div",gs,[_("span",null,[e(c)?(n(),M(qe,{key:0},[Le(J(t.$t("activity.newRecord")),1)],64)):(n(),M(qe,{key:1},[Le(J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.form")),1)],64))])])]),_:1},8,["disabled"])),[[Ze,[e(c)?"c:row:add:grid:toggle":"c:row:add:form:toggle"]]])])]),key:"0"}:void 0]),1032,["pagination-data","show-api-timing","align-left","change-page","hide-sidebars","fixed-size","extra-style","show-size-changer"])):e(z)?(n(),k(Ll,{key:1,"pagination-data":e(z),"onUpdate:paginationData":o[38]||(o[38]=et=>Ot(z)?z.value=et:null),"change-page":e(b),"show-size-changer":!e(_e),"scroll-left":e(Ka)},null,8,["pagination-data","change-page","show-size-changer","scroll-left"])):Q("",!0)]),e(x)!==!0&&e(z)&&!e(_e)?(n(),M("div",$s,[e(vo)&&!e(Ao)?(n(),k(pn,{key:0},{overlay:E(()=>[Y(Ct,null,{default:E(()=>[Se((n(),k(ye,{class:"nc-new-record-with-grid group",onClick:Ia},{default:E(()=>{var et;return[_("div",Ms,[(n(),k(ro((et=("viewIcons"in t?t.viewIcons:e(Nn))[e(ha).GRID])==null?void 0:et.icon),{class:"nc-view-icon text-inherit"})),Le(" "+J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.grid")),1)]),e(c)?(n(),k(he,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):Q("",!0)]}),_:1})),[[Ze,["c:row:add:grid"]]]),Se((n(),k(ye,{class:"nc-new-record-with-form group",onClick:Mo},{default:E(()=>[_("div",Cs,[Y(he,{class:"h-4.5 w-4.5",icon:"article"}),Le(" "+J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.form")),1)]),e(c)?Q("",!0):(n(),k(he,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),_:1})),[[Ze,["c:row:add:form"]]])]),_:1})]),default:E(()=>[_("div",Ss,[e(T)?Se((n(),k(Jo,{key:0,disabled:e(ae),class:"nc-grid-add-new-row",size:"small",type:"secondary",onClick:o[39]||(o[39]=$t(et=>Mo(),["stop"]))},{default:E(()=>[_("div",Ds,[Y(he,{icon:"plus"}),Le(" New Record ")])]),_:1},8,["disabled"])),[[Ze,[e(c)?"c:row:add:grid":"c:row:add:form"]]]):Se((n(),k(Jo,{key:1,disabled:e(ae),class:"!rounded-r-none !border-r-0 nc-grid-add-new-row",size:"small",type:"secondary",onClick:o[40]||(o[40]=$t(et=>e(c)?ao():Mo(),["stop"]))},{default:E(()=>[_("div",As,[Y(he,{icon:"plus"}),e(c)?(n(),M(qe,{key:0},[Le(J(t.$t("activity.newRecord")),1)],64)):(n(),M(qe,{key:1},[Le(J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.form")),1)],64))])]),_:1},8,["disabled"])),[[Ze,[e(c)?"c:row:add:grid":"c:row:add:form"]]]),e(T)?Q("",!0):(n(),k(Jo,{key:2,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary"},{default:E(()=>[Y(he,{icon:"arrowUp"})]),_:1}))])]),_:1})):Q("",!0)])):Q("",!0)],2)}}}),Ea=tl(Es,[["__scopeId","data-v-57f1be7f"]]),Ls=So({__name:"Aggregation",props:{group:{},maxDepth:{},scrollLeft:{}},setup(f){return(y,i)=>(n(),M("div"))}}),Vs=ht(()=>yt(()=>import("./C1WkfNyL.js"),__vite__mapDeps([92,1,2,85,86,93,64,94,87,88,25,95,96,97,98,99,100,101,102,103,16,17,18,19,20,21,22,104,105,106,107,108,109,52,4,110,71,72,3,73,111,112,49,50,113,12,13,54,51,114,62,81,80,115]),import.meta.url).then(f=>f.default||f)),Fs=So({__name:"GroupByTable",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},depth:{},maxDepth:{},rowHeight:{},paginationFixedSize:{},paginationHideSidebars:{type:Boolean},scrollLeft:{},viewWidth:{},scrollable:{}},emits:["update:paginationData"],setup(f,{emit:y}){const i=f,a=Da(i,"group",y),{t:K}=Ho(),z=ol(),V=Ge(la,h()),Xe=Ge(Aa,h()),x=Ge(aa,h(!1)),Ne=h(!1),{eventBus:v}=Uo(),te=z.currentRoute,Z=j(()=>te.value.query),xe=h(!1),H=h(),W=h(),b=j(()=>Z.value.group),A=j({get(){return!!Z.value.rowId},set(g){g||(z.push({query:{...Z.value,rowId:void 0,group:void 0}}),H.value={},W.value={})}});function C(g,P,B=!1,I){var X;const ae=ct(g.row,(X=V.value)==null?void 0:X.columns);if(W.value=P,ae&&!x.value)z.push({query:{...Z.value,group:a.value.key,rowId:ae}});else{if(I&&I!==a.value.key)return;H.value=g,xe.value=!0,Ne.value=!B}}const ce=g=>{v.emit(co.CLEAR_NEW_ROW,g)};function le(g,P,B=V.value){if(g.nested||!g.rows)return;P=P??g.rows.length;const I=g.nestedIn.reduce((ae,X)=>(X.key!=="__nc_null__"&&!ba(X.column_uidt)&&![$.Rollup,$.Lookup,$.Formula,$.Barcode,$.QrCode].includes(X.column_uidt)&&(ae[X.title]=X.key,X.column_uidt===$.Checkbox&&(ae[X.title]=ae[X.title]===$o.TRUE?!0:ae[X.title]===$o.FALSE?!1:!!ae[X.title])),ae),{});return g.count=g.count+1,g.rows.splice(P,0,{row:{...xr(B==null?void 0:B.columns),...I},oldRow:{},rowMeta:{new:!0}}),g.rows[P]}const q=j(()=>!a.value.nested&&a.value.rows?a.value.rows:[]),{deleteRow:oe,deleteSelectedRows:me,deleteRangeOfRows:ie,updateOrSaveRow:fe,bulkUpdateRows:re,selectedAllRecords:m,removeRowIfNew:we}=_r({meta:V,viewMeta:Xe,formattedData:q,paginationData:h(a.value.paginationData),callbacks:{changePage:g=>i.loadGroupPage(a.value,g),loadData:()=>i.loadGroupData(a.value,!0),globalCallback:()=>{var g;return(g=i.redistributeRows)==null?void 0:g.call(i)}}}),se=async g=>{a.value.count=a.value.count-1,await oe(g)},Re=async g=>{await i.loadGroupData(a.value,!0,{...(g==null?void 0:g.offset)!==void 0?{offset:g.offset}:{}})};Et(Xn,h(!0));const _e=j(()=>({fixedSize:i.paginationFixedSize?i.paginationFixedSize-2:void 0,hideSidebars:i.paginationHideSidebars,extraStyle:"background: transparent !important; border-top: 0px;"}));function $e(){return q.value.findIndex(g=>{var P;return Z.value.rowId===ct(g.row,(P=V.value)==null?void 0:P.columns)})}const He=async g=>{var X,Je,_t,Vt,tt;let B=$e()+(g===wo.NEXT?1:-1);for(;(Je=(X=q.value[B])==null?void 0:X.rowMeta)!=null&&Je.new;)B=B+(g===wo.NEXT?1:-1);const I=((_t=a.value.paginationData)==null?void 0:_t.page)||1;if(B<0){if(I===1)return Ve.info(K("msg.info.noMoreRecords"));await i.loadGroupPage(a.value,I-1),B=q.value.length-1}else if(B>=q.value.length){if((Vt=a.value.paginationData)!=null&&Vt.isLastPage)return Ve.info(K("msg.info.noMoreRecords"));await i.loadGroupPage(a.value,I+1),B=0}const ae=ct(q.value[B].row,(tt=V.value)==null?void 0:tt.columns);ae&&await z.push({query:{...Z.value,rowId:ae}})},u=async()=>{var P,B,I,ae;const g=$e();if(!((P=a.value.paginationData)!=null&&P.isLastPage)&&g===((B=a.value.paginationData)==null?void 0:B.pageSize)){const X=(I=a.value.paginationData)!=null&&I.page?((ae=a.value.paginationData)==null?void 0:ae.page)+1:1;await i.loadGroupPage(a.value,X)}He(wo.NEXT)},T=async()=>{var P,B,I;const g=$e();if(!((P=a.value.paginationData)!=null&&P.isFirstPage)&&g===1){const ae=(B=a.value.paginationData)!=null&&B.page?((I=a.value.paginationData)==null?void 0:I.page)-1:1;await i.loadGroupPage(a.value,ae)}He(wo.PREV)},c=j(()=>{var P;const g=$e();return((P=a.value.paginationData)==null?void 0:P.isLastPage)&&g===q.value.length-1}),r=j(()=>{var P;const g=$e();return((P=a.value.paginationData)==null?void 0:P.isFirstPage)&&g===0});async function N(){me&&(await me(),await Re({shouldShowLoading:!1}))}return(g,P)=>{var ae;const B=Vs,I=al;return n(),M(qe,null,[e(a).rows?(n(),k(Ea,{key:0,"selected-all-records":e(m),"onUpdate:selectedAllRecords":P[0]||(P[0]=X=>Ot(m)?m.value=X:null),class:"nc-group-table",data:e(a).rows,"v-group":e(a),"pagination-data":e(a).paginationData,"load-data":async()=>{},"change-page":X=>i.loadGroupPage(e(a),X),"call-add-empty-row":X=>le(e(a),X),"expand-form":C,"row-height":g.rowHeight,"delete-row":se,"delete-selected-rows":N,"delete-range-of-rows":e(ie),"update-or-save-row":e(fe),"remove-row-if-new":e(we),"bulk-update-rows":e(re),"hide-header":!0,pagination:e(_e),"disable-skeleton":!0,"disable-virtual-y":!0},null,8,["selected-all-records","data","v-group","pagination-data","change-page","call-add-empty-row","row-height","delete-range-of-rows","update-or-save-row","remove-row-if-new","bulk-update-rows","pagination"])):Q("",!0),(n(),k(ka,null,{default:E(()=>[e(H)&&e(xe)?(n(),k(B,{key:0,modelValue:e(xe),"onUpdate:modelValue":[P[1]||(P[1]=X=>Ot(xe)?xe.value=X:null),P[2]||(P[2]=X=>ce(e(H)))],"load-row":!e(x),row:e(H),state:e(W),meta:e(V),view:e(Xe)},null,8,["modelValue","load-row","row","state","meta","view"])):Q("",!0)]),_:1})),e(A)&&((ae=e(V))!=null&&ae.id)&&e(b)===e(a).key?(n(),k(I,{key:1,modelValue:e(A),"onUpdate:modelValue":P[3]||(P[3]=X=>Ot(A)?A.value=X:null),row:e(H)??{row:{},oldRow:{},rowMeta:{}},meta:e(V),"load-row":!e(x),state:e(W),"row-id":e(Z).rowId,view:e(Xe),"show-next-prev-icons":"","first-row":e(r),"last-row":e(c),"expand-form":C,onNext:u,onPrev:T},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):Q("",!0)],64)}}}),zs=ht(()=>yt(()=>import("./D51uA4Lq.js"),__vite__mapDeps([68,1,2,3,8,69]),import.meta.url).then(f=>f.default||f)),Ps=ht(()=>yt(()=>import("./DQfYvTkb.js"),__vite__mapDeps([70,1,2,71,52,72,3,73,4,8,74]),import.meta.url).then(f=>f.default||f)),Ns=ht(()=>yt(()=>import("./Bys73o5q.js"),__vite__mapDeps([75,71,52,1,2,72,3,73,4]),import.meta.url).then(f=>f.default||f)),Os={class:"pointer-events-none"},Is=So({__name:"GroupByLabel",props:{column:{},modelValue:{}},setup(f){return Et(qn,h(!0)),Et(cr,h(!0)),(y,i)=>{const L=zs,a=Ps,K=Ns;return n(),M("div",Os,[Y(K,{row:{row:{[y.column.title]:y.modelValue},rowMeta:{}}},{default:E(()=>[e(Xt)(y.column)?(n(),k(L,{key:0,"model-value":y.modelValue,class:"!text-gray-600",column:y.column,"read-only":!0},null,8,["model-value","column"])):(n(),k(a,{key:1,"model-value":y.modelValue,class:"!text-gray-600",column:y.column,"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"]))]),_:1},8,["row"])])}}}),Ts=ht(()=>yt(()=>import("./Ihzp3hON.js"),__vite__mapDeps([84,1,2,85,86,87,88,25,89,90,91,53,79,80,81,82,92,93,64,94,95,96,97,98,99,100,101,102,103,16,17,18,19,20,21,22,104,105,106,107,108,109,52,4,110,71,72,3,73,111,112,49,50,113,12,13,54,51,114,62,115,116,117,31,118,8,119,120,121,48,122,123,124]),import.meta.url).then(f=>f.default||f)),Bs=ht(()=>yt(()=>import("./5JSD4rKf.js"),__vite__mapDeps([76,77,1,2,40,29,18,41,20,19,78,79,80,81,82,16,17,21,22,83]),import.meta.url).then(f=>f.default||f)),Gs={key:0,class:"flex sticky top-0 z-5"},Hs={class:"flex items-center"},Us={class:"flex"},Ws={key:1,class:"flex min-w-[100px] flex-wrap"},Ys={key:1,class:"text-gray-400"},js={class:"text-xs group-hover:hidden text-gray-500 nc-group-row-count"},Ks={class:"text-[#374151] ml-2"},qs=So({__name:"GroupBy",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},loadGroupAggregation:{type:Function},redistributeRows:{type:Function},viewWidth:{},scrollLeft:{},fullPage:{type:Boolean},depth:{},maxDepth:{},rowHeight:{},expandForm:{type:Function}},emits:["update:paginationData"],setup(f,{emit:y}){const i=f,a=Da(i,"group",y),K=Ge(la,h()),z=Ge(oa,h()),{gridViewPageSize:V}=Ra(),Xe=io(i,"scrollLeft"),{isViewDataLoading:x,isPaginationLoading:Ne}=Vo(Sa()),{gridViewCols:v}=ra(),te=Ge(Gn,Lo()),Z=j(()=>{var r,N;return(N=(r=K.value)==null?void 0:r.columns)==null?void 0:N.find(g=>g.pv)}),xe=j(()=>!Z.value||!Z.value.id?{width:"100px"}:v.value[Z.value.id]),H=Ge(Ma,Lo());te==null||te.on(async r=>{var N;if((N=z.value)!=null&&N.length&&((!r||!(r!=null&&r.fields.length))&&await i.loadGroupAggregation(a.value),r!=null&&r.fields)){const g=r.fields.reduce((P,B)=>{const I=z.value.find(ae=>ae.title===B.title);return I!=null&&I.id&&(P[I.id]=B.aggregation??v.value[I.id].aggregation??Hn.None),P},{});await i.loadGroupAggregation(a.value,Object.entries(g).map(([P,B])=>({field:P,type:B})))}});const W=async(r,N,g)=>{x.value=!0,Ne.value=!0,await i.loadGroupData(r,N,g),x.value=!1,Ne.value=!1},b=i.depth??0,A=h(),C=h(),ce=h(),le=j(()=>{var r;return i.fullPage??(((r=ce.value)==null?void 0:r.offsetWidth)??0)>(i.viewWidth??0)}),q=h(),oe=j(()=>q.value?Array.isArray(q.value)?q.value.map(r=>r.replace("group-panel-","")):[q.value.replace("group-panel-","")]:[]),me=h([]),ie=async r=>{var N,g;if(r=Array.isArray(r)?r:[r],r.length>0&&a.value.children&&!me.value.includes(r[r.length-1])){await na(()=>{var I;return((I=a.value.children)==null?void 0:I.length)>0}).toBeTruthy({timeout:1e4});const P=r[r.length-1].replace("group-panel-",""),B=a.value.children.find(I=>`${I.key}`===P);B&&(B.nested?(N=B.children[0].children)!=null&&N.length||i.loadGroups({},B,{triggerChildOnly:!0}):(g=B.rows)!=null&&g.length||W(B))}me.value=r},fe=r=>{a.value.nested?i.loadGroups({...(r==null?void 0:r.offset)!==void 0?{offset:r.offset}:{}},a.value):(W(a.value,!0,{...(r==null?void 0:r.offset)!==void 0?{offset:r.offset}:{}}),i.loadGroupAggregation(a.value))};ta(async()=>{H==null||H.on(fe)}),Qn(async()=>{H==null||H.off(fe)}),Ro([()=>a.value.key],async(r,N)=>{r!==N&&(a.value.nested?a.value.nested&&await i.loadGroups({},a.value):await W(a.value,!0))}),ta(async()=>{var r,N;a.value.root===!0&&!((N=(r=a.value)==null?void 0:r.children)!=null&&N.length)&&await i.loadGroups({limit:V.value},a.value)}),a.value.root===!0&&Et(Jn,A);const re=h(),m=j(()=>{if(a.value.root===!0)return re.value??0;if(i.scrollLeft&&i.viewWidth&&C.value){const r=C.value.scrollWidth+12+12;return i.scrollLeft+i.viewWidth+20>r?r-i.viewWidth-20:Math.max(Math.min(r-i.viewWidth,(i.scrollLeft??0)-12),0)}return 0}),we=r=>{a.value.root&&(re.value=r.target.scrollLeft)},se=r=>{var g,P,B,I,ae,X,Je,_t,Vt;let N=r.key.toString();if(N&&((g=r.column)==null?void 0:g.uidt)===$.Lookup||((P=r.column)==null?void 0:P.uidt)===$.LinkToAnotherRecord)try{N=JSON.parse(N)}catch{return N.split("___")}if(N&&((B=r.column)==null?void 0:B.uidt)===$.DateTime)return[On(N,`${((ae=Lt((I=r.column)==null?void 0:I.meta))==null?void 0:ae.date_format)??Kn[0]} ${((Je=Lt((X=r.column)==null?void 0:X.meta))==null?void 0:Je.time_format)??_a[0]}`)];if(N&&((_t=r.column)==null?void 0:_t.uidt)===$.Time)return[On(N,_a[0],!1)];if(N&&[$.User,$.CreatedBy,$.LastModifiedBy].includes((Vt=r.column)==null?void 0:Vt.uidt))try{return[JSON.parse(N)]}catch{return null}return[N]},Re=r=>[$.Lookup,$.Attachment,$.Barcode,$.QrCode,$.Links,$.User,$.DateTime,$.CreatedTime,$.LastModifiedTime,$.CreatedBy,$.LongText,$.LastModifiedBy].includes(r==null?void 0:r.uidt),_e=async r=>{Array.isArray(q.value)?q.value.push(`group-panel-${r}`):q.value=[`group-panel-${r}`],await ie(`group-panel-${r}`)},$e=r=>{Array.isArray(q.value)?q.value=q.value.filter(N=>N!==`group-panel-${r}`):q.value=[]},He=()=>{q.value=[]},u=async()=>{var r;q.value=((r=a.value.children)==null?void 0:r.map(N=>`group-panel-${N.key}`))??[],a.value.children&&await Promise.all(a.value.children.map(N=>ie(`group-panel-${N.key}`)))},T=j(()=>{var B;const r=Number((((B=xe.value)==null?void 0:B.width)??"").replace("px",""))+55+i.maxDepth*9,N=i.maxDepth??1,g=a.value.root?re.value??0:Xe.value??0,P=I=>{switch(I){case 3:return`${r-18}px`;case 2:return`${r-9}px`;case 1:default:return`${r}px`}};return b===0?g<29?`${r+g-(.02*(g*g)+1.07*g)}px`:P(N):b===1?g<30?`${r+g-9-23/20*g}px`:P(N):b===2?g<=14?`${r+g-18-g}px`:P(N):`${r}px`}),c=j(()=>{if(i.maxDepth===3)switch(b){case 2:return"#F9F9FA";case 1:return"#F4F4F5";default:return"#F1F1F1"}if(i.maxDepth===2)switch(b){case 1:return"#F9F9FA";default:return"#F4F4F5"}return i.maxDepth===1,"#F9F9FA"});return(r,N)=>{const g=Zn,P=el,B=Or,I=ll,ae=rl,X=il,Je=Ls,_t=Ir,Vt=Tr,tt=Ts,Wt=Bs;return n(),M(qe,null,[_("div",{ref_key:"wrapper",ref:A,class:De([{"overflow-y-auto":e(a).root===!0},"h-full"]),style:Ye(`${!e(a).root&&e(a).nested?"padding-left: 8px; padding-right: 8px;":""}`),onScroll:we},[_("div",{ref_key:"scrollable",ref:C,style:Ye(`${e(a).root===!0?"width: fit-content":"width: 100%"}`)},[e(a).root===!0?(n(),M("div",Gs,[_("div",{class:"border-b-1 border-gray-200 mb-2",style:Ye([{"background-color":"#f4f4f5"},{"padding-left":`${(r.maxDepth||1)*9}px`}])},null,4),Y(Ea,{ref_key:"tableHeader",ref:ce,class:"mb-2",data:[],"hide-checkbox":!0,"header-only":!0},null,512)])):Q("",!0),_("div",{class:De({"pl-2":e(a).root===!0})},[Y(Vt,{activeKey:e(q),"onUpdate:activeKey":N[1]||(N[1]=st=>Ot(q)?q.value=st:null),class:"nc-group-wrapper !rounded-lg",bordered:!1,onChange:ie},{default:E(()=>{var st;return[(n(!0),M(qe,null,Ut(Object.entries(((st=e(a))==null?void 0:st.children)??[]),([Do,F])=>(n(),k(_t,{key:`group-panel-${F.key}`,class:"!border-1 border-gray-300 nc-group rounded-[8px] mb-2",style:Ye(`background: ${e(c)};`),"show-arrow":!1},{header:E(()=>[_("div",{class:De([{"!rounded-b-none":e(oe).includes(F.key.toString()),"!border-b-1":e(b)===(r.maxDepth??1)-1&&e(oe).includes(F.key.toString())},"flex !sticky w-full items-center rounded-b-lg select-none transition-all !rounded-t-[8px] !h-10"])},[_("div",{class:De([{"!rounded-bl-[8px]":!e(oe).includes(F.key.toString())},"!sticky flex z-10 justify-between !h-9.8 border-r-1 !rounded-tl-[8px] group pr-2 border-gray-300 overflow-clip items-center !left-0"]),style:Ye(`width:${e(T)};background: ${e(c)};`)},[_("div",Hs,[Y(P,{class:"!border-0 !shadow-none !bg-transparent !hover:bg-transparent",type:"secondary",size:"small"},{default:E(()=>[Y(g,{icon:"chevronDown",class:"transition-all",style:Ye(`${e(oe).includes(F.key.toString())?"transform: rotate(360deg)":"transform: rotate(270deg)"}`)},null,8,["style"])]),_:2},1024),_("div",Us,[F.column.uidt==="MultiSelect"?(n(!0),M(qe,{key:0},Ut(Object.entries(F.key.split(",")),([it,Dt])=>(n(),k(B,{key:`panel-tag-${F.column.id}-${Dt}`,class:"!py-0 !px-[12px] !rounded-[12px]",color:F.color.split(",")[+it]},{default:E(()=>[_("span",{class:"nc-group-value",style:Ye({color:e(Zo).isReadable(F.color.split(",")[+it]||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Zo).mostReadable(F.color.split(",")[+it]||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},J(Dt in("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES?("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES[Dt]:Dt),5)]),_:2},1032,["color"]))),128)):!(F.key in("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES)&&Re(F.column)?(n(),M("div",Ws,[(n(!0),M(qe,null,Ut(se(F),(it,Dt)=>(n(),M(qe,{key:Dt},[it?(n(),k(Is,{key:0,column:F.column,"model-value":it},null,8,["column","model-value"])):(n(),M("span",Ys,"No mapped value"))],64))),128))])):(n(),k(B,{key:`panel-tag-${F.column.id}-${F.key}`,class:De(["!py-0 !px-[12px]",`${F.column.uidt==="SingleSelect"?"!rounded-[12px]":"!rounded-[6px]"}`]),color:F.color},{default:E(()=>{var it;return[_("span",{class:"nc-group-value font-semibold text-[13px]",style:Ye({color:e(Zo).isReadable(F.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Zo).mostReadable(F.color||"#ccc",["#0b1d05","#fff"]).toHex8String()})},[F.key in("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES?(n(),M(qe,{key:0},[Le(J(("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES[F.key]),1)],64)):(n(),M(qe,{key:1},[Le(J((it=se(F))==null?void 0:it.join(", ")),1)],64))],4)]}),_:2},1032,["class","color"]))])]),_("div",{style:Ye(`background: linear-gradient(to right, hsla(0, 0%, 97%, 0), ${e(c)} 18%);`),class:"flex !h-10 absolute right-0 pl-8 pr-2 items-center"},[_("div",js,[_("span",null,J(r.$t("datatype.Count")),1),_("span",Ks,J(F.count),1)]),Y(X,{class:"!hidden !group-hover:block"},{overlay:E(()=>[Y(ae,null,{default:E(()=>[e(oe).includes(F.key.toString())?(n(),k(I,{key:0,onClick:it=>$e(F.key)},{default:E(()=>[Y(g,{icon:"minimize"}),Le(" Collapse group ")]),_:2},1032,["onClick"])):(n(),k(I,{key:1,onClick:it=>_e(F.key)},{default:E(()=>[Y(g,{icon:"maximize"}),Le(" Expand group ")]),_:2},1032,["onClick"])),Y(I,{onClick:u},{default:E(()=>[Y(g,{icon:"maximizeAll"}),Le(" Expand all ")]),_:1}),Y(I,{onClick:He},{default:E(()=>[Y(g,{icon:"minimizeAll"}),Le(" Collapse all ")]),_:1})]),_:2},1024)]),default:E(()=>[Y(P,{size:"small",type:"text",onClick:N[0]||(N[0]=$t(()=>{},["stop"]))},{default:E(()=>[Y(g,{icon:"threeDotVertical"})]),_:1})]),_:2},1024)],4)],6),Y(Je,{"scroll-left":i.scrollLeft||e(re),"max-depth":r.maxDepth,group:F,depth:e(b)},null,8,["scroll-left","max-depth","group","depth"])],2)]),default:E(()=>[!F.nested&&F.rows?(n(),k(Fs,{key:0,group:F,"max-depth":r.maxDepth,depth:r.depth,"load-groups":r.loadGroups,"load-group-data":W,"load-group-page":r.loadGroupPage,"group-wrapper-change-page":r.groupWrapperChangePage,"row-height":r.rowHeight,"redistribute-rows":r.redistributeRows,"pagination-fixed-size":e(le)?i.viewWidth:void 0,"pagination-hide-sidebars":!0,"scroll-left":i.scrollLeft||e(re),"view-width":r.viewWidth,scrollable:e(C)},null,8,["group","max-depth","depth","load-groups","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","pagination-fixed-size","scroll-left","view-width","scrollable"])):(n(),k(sl,{key:1,group:F,"load-groups":r.loadGroups,"load-group-data":W,"load-group-page":r.loadGroupPage,"group-wrapper-change-page":r.groupWrapperChangePage,"row-height":r.rowHeight,"load-group-aggregation":r.loadGroupAggregation,"redistribute-rows":r.redistributeRows,"view-width":r.viewWidth,depth:e(b)+1,"max-depth":r.maxDepth,"scroll-left":e(m),"full-page":e(le)},null,8,["group","load-groups","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","redistribute-rows","view-width","depth","max-depth","scroll-left","full-page"]))]),_:2},1032,["style"]))),128))]}),_:1},8,["activeKey"])],2)],4)],38),e(a).root?(n(),k(tt,{key:0,"pagination-data":e(a).paginationData,"onUpdate:paginationData":N[2]||(N[2]=st=>e(a).paginationData=st),"show-size-changer":!0,"scroll-left":e(re),"custom-label":"groups",depth:r.maxDepth,"change-page":st=>r.groupWrapperChangePage(st,e(a))},null,8,["pagination-data","scroll-left","depth","change-page"])):(n(),k(Wt,{key:1,"pagination-data":e(a).paginationData,"onUpdate:paginationData":N[3]||(N[3]=st=>e(a).paginationData=st),"align-count-on-right":"","custom-label":"groups","align-left":"","show-api-timing":"","change-page":st=>r.groupWrapperChangePage(st,e(a)),"hide-sidebars":!0,style:Ye(`${i.depth&&i.depth>0?"border-radius: 0 0 8px 8px !important; background: transparent; border-top: 0px; height: 24px; padding-bottom: 8px;":""}`),"fixed-size":void 0},null,8,["pagination-data","change-page","style"]))],64)}}}),sl=tl(qs,[["__scopeId","data-v-1b50c32d"]]),Xs=ht(()=>yt(()=>import("./C1WkfNyL.js"),__vite__mapDeps([92,1,2,85,86,93,64,94,87,88,25,95,96,97,98,99,100,101,102,103,16,17,18,19,20,21,22,104,105,106,107,108,109,52,4,110,71,72,3,73,111,112,49,50,113,12,13,54,51,114,62,81,80,115]),import.meta.url).then(f=>f.default||f)),Js=ht(()=>yt(()=>import("./BvjMlSBH.js"),__vite__mapDeps([125,1,2]),import.meta.url).then(f=>f.default||f)),Qs=So({__name:"index",setup(f,{expose:y}){const i=Ge(la,h()),L=Ge(Aa,h()),a=Ge(Ma,Lo());Ge(oa,h([]));const K=ol(),z=K.currentRoute,{xWhere:V,eventBus:Xe}=Uo(),{t:x}=Ho(),Ne=h(!1),v=j(()=>z.value.query),te=h(!1),Z=h(),xe=h(),H=h();Br(L,i,V);const{loadData:W,paginationData:b,formattedData:A,updateOrSaveRow:C,changePage:ce,addEmptyRow:le,deleteRow:q,deleteSelectedRows:oe,selectedAllRecords:me,removeRowIfNew:ie,navigateToSiblingRow:fe,getExpandedRowIndex:re,deleteRangeOfRows:m,bulkUpdateRows:we,bulkUpdateView:se,optimisedQuery:Re,islastRow:_e,isFirstRow:$e,aggCommentCount:He}=br(i,L,V),u=j(()=>{var be,l,d,p;if(((l=(be=L.value)==null?void 0:be.view)==null?void 0:l.row_height)!==void 0)switch((p=(d=L.value)==null?void 0:d.view)==null?void 0:p.row_height){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 6;default:return 1}});Et(pr,h(!1)),Et(fr,h(!1)),Et(vr,h(!0)),Et(mr,h(!1)),Et(wr,u);const T=Ge(aa,h(!1));Et(gr,a);const c=h(!1);function r(be,l,d=!1){var ue;const p=ct(be.row,(ue=i.value)==null?void 0:ue.columns);xe.value=l,p&&!T.value?(Z.value=void 0,K.push({query:{...v.value,rowId:p}})):(Z.value=be,te.value=!0,c.value=!d)}y({loadData:W,openColumnCreate:be=>{var l;(l=H.value)==null||l.openColumnCreate(be)}});const g=j({get(){return!!v.value.rowId},set(be){be||K.push({query:{...v.value,rowId:void 0}})}}),P=be=>{c.value||Xe.emit(co.CLEAR_NEW_ROW,be)},B=()=>{Re.value?(Re.value=!1,Ve.info(x("msg.optimizedQueryDisabled"))):(Re.value=!0,Ve.info(x("msg.optimizedQueryEnabled")))},{rootGroup:I,groupBy:ae,isGroupBy:X,loadGroups:Je,loadGroupData:_t,loadGroupPage:Vt,groupWrapperChangePage:tt,redistributeRows:Wt,loadGroupAggregation:st}=Rr(),Do=nl(),{windowSize:F,leftSidebarWidth:it}=hr(Do),Dt=h(0);Xe.on(be=>{(be===co.GROUP_BY_RELOAD||be===co.DATA_RELOAD)&&(a==null||a.trigger())});const Fo=()=>{var l,d;const be=re();if(!b.value.isLastPage&&be===b.value.pageSize){const p=(l=b.value)!=null&&l.page?((d=b.value)==null?void 0:d.page)+1:1;ce(p)}fe(wo.NEXT)},zo=()=>{var l,d;const be=re();if(!b.value.isFirstPage&&be===1){const p=(l=b.value)!=null&&l.page?((d=b.value)==null?void 0:d.page)-1:1;ce(p)}fe(wo.PREV)},Yt=()=>{if(T.value){Dt.value=F.value;return}Dt.value=F.value-it.value},Po=j(()=>{switch(ae.value.length){case 1:return"#F9F9FA";case 2:return"#F4F4F5";case 3:return"#E7E7E9";default:return"#F9F9FA"}}),ho=be=>{if(!v.value.rowId)return;const l=He.value.findIndex(p=>p.row_id===v.value.rowId),d=A.value.findIndex(p=>{var ue;return ct(p.row,(ue=i.value)==null?void 0:ue.columns)===v.value.rowId});l===-1||d===-1||Number(He.value[l].count)!==be&&(He.value[l].count=be,A.value[d].rowMeta.commentCount=be)};return Ro([F,it],Yt),ta(()=>{Yt()}),(be,l)=>{var Fe;const d=Xs,p=al,ue=Js;return n(),M("div",{class:"relative flex flex-col h-full min-h-0 w-full nc-grid-wrapper","data-testid":"nc-grid-wrapper",style:Ye(`background-color: ${e(X)?`${e(Po)}`:"var(--nc-grid-bg)"};`)},[e(X)?(n(),k(sl,{key:1,group:e(I),"load-groups":e(Je),"load-group-data":e(_t),"load-group-page":e(Vt),"group-wrapper-change-page":e(tt),"row-height":e(u),"load-group-aggregation":e(st),"max-depth":e(ae).length,"redistribute-rows":e(Wt),"view-width":e(Dt)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","max-depth","redistribute-rows","view-width"])):(n(),k(Ea,{key:0,ref_key:"tableRef",ref:H,"selected-all-records":e(me),"onUpdate:selectedAllRecords":l[0]||(l[0]=O=>Ot(me)?me.value=O:null),data:e(A),"pagination-data":e(b),"load-data":e(W),"change-page":e(ce),"call-add-empty-row":e(le),"delete-row":e(q),"update-or-save-row":e(C),"delete-selected-rows":e(oe),"delete-range-of-rows":e(m),"bulk-update-rows":e(we),"expand-form":r,"remove-row-if-new":e(ie),"row-height":e(u),onToggleOptimisedQuery:B,onBulkUpdateDlg:l[1]||(l[1]=O=>Ne.value=!0)},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","bulk-update-rows","remove-row-if-new","row-height"])),e(X)?Q("",!0):(n(),k(ka,{key:2},{default:E(()=>[e(Z)&&e(te)?(n(),k(d,{key:0,modelValue:e(te),"onUpdate:modelValue":[l[2]||(l[2]=O=>Ot(te)?te.value=O:null),l[3]||(l[3]=O=>P(e(Z)))],"load-row":!e(T),row:e(Z),state:e(xe),meta:e(i),view:e(L)},null,8,["modelValue","load-row","row","state","meta","view"])):Q("",!0)]),_:1})),e(g)&&((Fe=e(i))!=null&&Fe.id)&&!e(X)?(n(),k(p,{key:3,modelValue:e(g),"onUpdate:modelValue":l[4]||(l[4]=O=>Ot(g)?g.value=O:null),row:e(Z)??{row:{},oldRow:{},rowMeta:{}},meta:e(i),"load-row":!e(T),state:e(xe),"row-id":e(v).rowId,view:e(L),"show-next-prev-icons":"","first-row":e($e),"last-row":e(_e),"expand-form":r,onNext:l[5]||(l[5]=O=>Fo()),onPrev:l[6]||(l[6]=O=>zo()),onUpdateRowCommentCount:ho},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):Q("",!0),(n(),k(ka,null,{default:E(()=>[e(Ne)?(n(),k(ue,{key:0,modelValue:e(Ne),"onUpdate:modelValue":l[7]||(l[7]=O=>Ot(Ne)?Ne.value=O:null),"pagination-data":e(b),meta:e(i),view:e(L),"bulk-update-rows":e(we),"bulk-update-view":e(se),"selected-all-records":e(me),rows:e(A).filter(O=>O.rowMeta.selected)},null,8,["modelValue","pagination-data","meta","view","bulk-update-rows","bulk-update-view","selected-all-records","rows"])):Q("",!0)]),_:1}))],4)}}}),$u=Object.freeze(Object.defineProperty({__proto__:null,default:Qs},Symbol.toStringTag,{value:"Module"}));export{$u as i,Hr as u};
