import J from"./BV5EkxN-.js";import W from"./CtMydB5S.js";import{f as X,aB as ee,r as c,hM as ae,bN as m,d9 as te,d8 as se,dA as ne,da as oe,g as y,h_ as le,cZ as ie,H as ce,de as N,d1 as re,O as de,P as n,o as l,S as p,w as o,c as I,Y as D,a as s,t as i,b as _,Q as C,aq as ue,av as me,V as pe,T as f,d as T,R as _e,n as fe,fO as ge,$ as ve,a0 as we,a1 as ke}from"./3QBYHahY.js";import{_ as ye}from"./4uOUlFJU.js";import{_ as he}from"./Kma333Sh.js";import{a as be}from"./CfxEkdGP.js";import{a as xe}from"./-3s5K4B9.js";import{u as Ie}from"./BTE9xdWH.js";import{S as Ce,_ as Se}from"./BEpKpjF5.js";import"./DPqnb67u.js";import"./D4iSzjWt.js";import"./DD1BMgnW.js";import"./xnDaHwV-.js";import"./CSl6euFG.js";import"./BteOdwRG.js";import"./BYmqikBK.js";import"./boyBAVNN.js";import"./CGxepfeV.js";import"./BQQOEPN4.js";import"./3ezdMRmZ.js";import"./DPgYHC40.js";const Ve={class:"nc-kanban-btn"},Me={class:"flex items-center gap-2"},$e={key:0,class:"flex items-center gap-0.5"},Be={class:"text-capitalize !text-sm flex items-center gap-1 text-gray-700"},Ne={class:"flex items-center rounded-md transition-colors duration-0.3s bg-gray-100 group-hover:bg-gray-200 px-1 min-h-5 text-gray-600 max-w-[108px]"},De={class:"font-weight-500 text-sm truncate !leading-5"},Te={class:"flex flex-col gap-2"},je={class:"nc-fields-list"},Fe={class:"grouping-field"},Oe=["title"],Ee={class:"flex items-center gap-1 max-w-[calc(100%_-_20px)]"},Le={class:"flex items-center gap-1"},Ue={class:"text-sm text-gray-800"},ca=X({__name:"StackedBy",setup(Ke){ee(ae,c(!0));const j=m(te,c()),u=m(se,c()),F=m(ne,c(!1)),O=m(oe,c(!1)),E=m(le,y(()=>!1)),{fields:L,loadViewColumns:U,metaColumnById:S}=be(),{kanbanMetaData:g,loadKanbanMeta:V,loadKanbanData:K,updateKanbanMeta:M,groupingField:P}=xe(),{addUndo:$,defineViewScope:B}=ie(),r=c(!1);Ie(r),ce(()=>{var e;return(e=u.value)==null?void 0:e.id},async(e,a)=>{e!==a&&j.value&&await U()},{immediate:!0});const h=async e=>{var a;await M({fk_grp_col_id:e}),await V(),await K(),((a=u.value)==null?void 0:a.view).fk_grp_col_id=e},v=y({get:()=>g.value.fk_grp_col_id,set:async e=>{e&&($({undo:{fn:await h,args:[g.value.fk_grp_col_id]},redo:{fn:await h,args:[e]},scope:B({view:u.value})}),await h(e))}}),b=async e=>{var d,k;const a={...N((d=g.value)==null?void 0:d.meta),hide_empty_stack:e};await M({meta:a}),await V(),((k=u.value)==null?void 0:k.view).meta=a},x=c(null),w=y({get:()=>{var e;return N((e=g.value)==null?void 0:e.meta).hide_empty_stack||!1},set:async e=>{x.value="hideEmptyStack",$({undo:{fn:b,args:[w.value]},redo:{fn:b,args:[e]},scope:B({view:u.value})}),await b(e),x.value=null}}),z=y(()=>{var e;return(e=L.value)==null?void 0:e.filter(a=>a.fk_column_id&&S.value[a.fk_column_id].uidt===re.SingleSelect).map(a=>({value:a.fk_column_id,label:a.title}))}),G=()=>{r.value=!1},R=e=>fe(ge(e)?J:W,{columnMeta:e});return(e,a)=>{const d=ve,k=we,A=ke,H=Ce,q=Se,Q=ye,Y=he,Z=de("e");return n(F)?f("",!0):(l(),p(Y,{key:0,visible:n(r),"onUpdate:visible":a[4]||(a[4]=t=>C(r)?r.value=t:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu",class:"!xs:hidden"},{overlay:o(()=>[n(r)?(l(),I("div",{key:0,class:"p-4 w-90 bg-white nc-table-toolbar-menu rounded-lg flex flex-col gap-5",onClick:a[3]||(a[3]=D(()=>{},["stop"]))},[s("div",Te,[s("div",null,i(e.$t("general.groupingField")),1),s("div",je,[s("div",Fe,[_(q,{value:n(v),"onUpdate:value":a[0]||(a[0]=t=>C(v)?v.value=t:null),class:"nc-select-shadow w-full nc-kanban-grouping-field-select !rounded-lg","dropdown-class-name":"!rounded-lg",placeholder:"Select a Grouping Field",onChange:G,onClick:a[1]||(a[1]=D(()=>{},["stop"]))},{suffixIcon:o(()=>[_(d,{icon:"arrowDown",class:"text-gray-700"})]),default:o(()=>[(l(!0),I(ue,null,me(n(z),t=>(l(),p(H,{key:t.value,value:t.value},{default:o(()=>[s("div",{class:"w-full flex gap-2 items-center justify-between",title:t.label},[s("div",Ee,[t.value?(l(),p(pe(R(n(S)[t.value])),{key:0,class:"!w-3.5 !h-3.5 !text-gray-700 !ml-0"})):f("",!0),_(A,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:o(()=>[T(i(t.label),1)]),default:o(()=>[T(i(t.label),1)]),_:2},1024)]),n(v)===t.value?(l(),p(d,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):f("",!0)],8,Oe)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),s("div",Le,[_(Q,{checked:n(w),"onUpdate:checked":a[2]||(a[2]=t=>C(w)?w.value=t:null),size:"small",class:"nc-switch",loading:n(x)==="hideEmptyStack"},{default:o(()=>[s("div",Ue,i(e.$t("general.hide"))+" "+i(e.$t("general.empty").toLowerCase())+" "+i(e.$t("general.stack").toLowerCase()),1)]),_:1},8,["checked","loading"])])])):f("",!0)]),default:o(()=>[s("div",Ve,[_e((l(),p(k,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn !border-0 !h-7 group",size:"small",type:"secondary",disabled:n(O)},{default:o(()=>[s("div",Me,[_(d,{icon:"settings",class:"h-4 w-4"}),n(E)?f("",!0):(l(),I("div",$e,[s("span",Be,i(e.$t("activity.kanban.stackedBy")),1),s("div",Ne,[s("span",De,i(n(P)),1)])]))])]),_:1},8,["disabled"])),[[Z,["c:kanban:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{ca as default};
