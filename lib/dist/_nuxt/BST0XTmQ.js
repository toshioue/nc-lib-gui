const __vite__fileDeps=["./CjORA2Gx.js","./nEPQs079.js","./entry.B8GgT5QA.css","./Header.x-GI6b6n.css","./CDnCZW4u.js","./D8Zaht4D.js","./BNDnQ_SZ.js","./DAFLhYLz.js","./BGiMKGQu.js","./ListItem.BO1P2ool.css","./BhhdTVvF.js","./BMD-JIxU.js","./MenuItem.C7h59s4s.css","./COUq3J8q.js","./C5mABW8R.js","./Divider.DqtSqZhb.css","./C6cwFr3C.js","./Menu.CQ8GNWeI.css","./CNqbIxb7.js","./CsDrjaMN.js","./DivDataCell.1yCNpUg3.css","./DEj7mPxe.js","./UserIcon.JKLzA6N5.css","./CigpOy_T.js","./PYX8IZJE.js","./Badge.D0-UrqG9.css","./CINLm5KA.js","./Cy50pBgZ.js","./BdIpmjdG.js","./ByzT15Y-.js","./BQQOEPN4.js","./COktFmkf.js","./DKtVUO_j.js","./DzMAdbS0.js","./QHUCxglU.js","./links.C8uCzV-l.css","./BDH4PFIz.js","./Tabs.DaLSLYpn.css","./-Hb63wRq.js","./DVCdQBfZ.js","./DlJISsR5.js","./BQDKbNwe.js","./boyBAVNN.js","./uUEzSIs0.js","./vKaAFL5T.js","./B00EKCmm.js","./DQ9lOBun.js","./eSDe9FnP.js","./BThhIoag.js","./CF0GO8gh.js","./Gr6cVSxP.js","./DeleteModal.SEMJ_gSK.css","./B_7Ene6-.js","./DhnetN0h.js","./C4eCLVVw.js","./index.BSNjFO1V.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as tt,ac as ot,N as at,bL as R,fH as st,at as nt,cB as lt,r as x,ai as rt,L as it,fC as dt,az as ut,hy as ct,dS as Ie,h$ as pt,g6 as mt,H as V,g as Y,fw as Ce,fI as A,i2 as Ee,i as ft,cp as _t,O as vt,o as n,c,a as _,b as h,S as C,w as q,P as o,Y as T,al as P,am as K,U as E,aF as Q,t as G,R as yt,d as ht,Q as kt,dQ as wt,T as xt,Z as J,a5 as W,n as Z,an as gt,$ as bt,a2 as Lt,h6 as Se,cV as Rt,A as It,_ as Ct}from"./nEPQs079.js";import{_ as Et}from"./BkeU_HAH.js";import{a as St}from"./CQe3RDDB.js";import{a as Nt}from"./DVCdQBfZ.js";import{i as Ne,C as Ot}from"./C3R8onno.js";import{e as zt}from"./DAFLhYLz.js";import{_ as Vt}from"./IxiDC4n_.js";import{I as At}from"./4IZzm4r4.js";import"./BdIpmjdG.js";import{I as Tt}from"./ByzT15Y-.js";import{S as Pt}from"./BUcNRxMi.js";import{S as Bt}from"./DhnetN0h.js";import"./CFgyk-dW.js";import"./BTGvCRQH.js";import"./BQQOEPN4.js";import"./BLe4UTYD.js";import"./DKtVUO_j.js";import"./COktFmkf.js";import"./-Hb63wRq.js";import"./Q43kH38b.js";import"./DlJISsR5.js";import"./BQDKbNwe.js";import"./boyBAVNN.js";import"./vtnM0-E2.js";import"./CZJAloFU.js";import"./BzWD3wIg.js";import"./5fs2TD9N.js";import"./DYYbRAhI.js";import"./DzMAdbS0.js";import"./QHUCxglU.js";import"./C4eCLVVw.js";const Ft=J(()=>W(()=>import("./CjORA2Gx.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(v=>v.default||v)),Dt=J(()=>W(()=>import("./CDnCZW4u.js"),__vite__mapDeps([4,1,2,5,6,7,8,9]),import.meta.url).then(v=>v.default||v)),Ut=J(()=>W(()=>import("./BhhdTVvF.js"),__vite__mapDeps([10,1,2,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,7,43,44,45,46,47,48,49,50,51,52,53,54,55]),import.meta.url).then(v=>v.default||v)),Mt={class:"flex flex-col h-full"},$t={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},jt={class:"flex-1 gap-2 flex items-center"},Ht={class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center py-0.5 rounded-md"},Yt={class:"flex-1 overflow-auto nc-scrollbar-thin"},qt={class:"flex items-center"},Kt={class:"flex flex-col gap-2 flex-grow justify-center"},Qt={class:"flex flex-row gap-6 w-10/12"},Gt={key:1,class:"h-full my-auto py-2 flex flex-col gap-3 items-center justify-center text-gray-500"},Zt={key:0},Jt={key:1},Wt={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between min-h-11"},Xt={class:"flex"},eo={class:"flex items-center gap-1"},to={key:0,class:"flex items-center"},oo={key:1,class:"flex items-center"},ao=tt({__name:"UnLinkedItems",props:{modelValue:{type:Boolean},column:{},hideBackBtn:{type:Boolean}},emits:["update:modelValue","addNewRecord","attachLinkedRecord"],setup(v,{emit:Oe}){const ze=v,X=Oe,S=ot(ze,"modelValue",X),{isMobileMode:B}=at(),r=R(st),{isSharedBase:Ve}=nt(lt()),g=x(),{t:ee}=rt(),{$e:te}=It(),{isDataReadOnly:Ae}=it(),{childrenExcludedList:b,isChildrenExcludedListLinked:N,childrenExcludedOffsetCount:Te,childrenListOffsetCount:Pe,isChildrenExcludedListLoading:Be,isChildrenExcludedLoading:oe,childrenListCount:Fe,loadChildrenExcludedList:ae,loadChildrenList:se,childrenExcludedListPagination:l,relatedTableDisplayValueProp:ne,displayValueTypeAndFormatProp:De,link:Ue,relatedTableMeta:m,meta:le,unlink:Me,row:k,resetChildrenExcludedOffsetCount:F}=St(),{addLTARRef:re,isNew:O,removeLTARRef:$e,state:D}=Nt(),ie=R(dt,x(!1)),z=x(!1);oe.value=!0;const U=R(ut,x(!1)),de=R(ct,()=>{}),M=R(pt,Ie()),$=R(mt,Ie()),je=async(t,e)=>{O.value?(re(t,r==null?void 0:r.value),N.value[e]=!0,de(),te("a:links:link")):await Ue(t,{},!1,e)},He=async(t,e)=>{O.value?($e(t,r==null?void 0:r.value),N.value[e]=!1,de(),te("a:links:unlink")):await Me(t,{},!1,e)};V(S,(t,e)=>{t&&!e&&(l.query="",l.page=1,U.value||se(),ae(D.value,!0)),t||F()},{immediate:!0});const w=x(!1),I=x({}),Ye=Y(()=>{var i,d,y,f;if(O.value)return{};const t=(i=r==null?void 0:r.value)==null?void 0:i.colOptions,e=(y=(d=m==null?void 0:m.value)==null?void 0:d.columns)==null?void 0:y.find(L=>{if(!Ce(L))return!1;const p=L==null?void 0:L.colOptions;return(p==null?void 0:p.fk_related_model_id)!==le.value.id?!1:t.type===A.MANY_TO_MANY&&(p==null?void 0:p.type)===A.MANY_TO_MANY?t.fk_parent_column_id===p.fk_child_column_id&&t.fk_child_column_id===p.fk_parent_column_id:t.fk_parent_column_id===p.fk_parent_column_id&&t.fk_child_column_id===p.fk_child_column_id});if(!e)return{};const s=e==null?void 0:e.colOptions;return s?s.type===A.BELONGS_TO||s.type===A.ONE_TO_ONE?{[e.title]:(f=k==null?void 0:k.value)==null?void 0:f.row}:{[e.title]:(k==null?void 0:k.value)&&[k.value.row]}:{}}),qe=Ee(Se,t=>(m.value.columns??[]).filter(e=>Ne(e))[0]),Ke=Ee(Se,t=>(m.value.columns??[]).filter(e=>!Rt(e)&&!Ot(e)&&!Ce(e)&&!Ne(e)).sort((e,s)=>{var i,d;return((i=e.meta)==null?void 0:i.defaultViewColOrder)!==void 0&&((d=s.meta)==null?void 0:d.defaultViewColOrder)!==void 0?e.meta.defaultViewColOrder-s.meta.defaultViewColOrder:0}).slice(0,B.value?1:3)),j=Y(()=>{var t,e;return(e=(t=r.value)==null?void 0:t.colOptions)==null?void 0:e.type}),Qe=Y(()=>{var t,e,s,i,d,y,f;return U.value||O.value?((s=(e=D.value)==null?void 0:e[(t=r.value)==null?void 0:t.title])==null?void 0:s.length)??0:j.value==="bt"?(d=k.value)!=null&&d.row[(i=m.value)==null?void 0:i.title]?1:0:j.value==="oo"?(f=k.value)!=null&&f.row[(y=r.value)==null?void 0:y.title]?1:0:Fe.value??0});V(w,()=>{w.value||(z.value=!1,U.value||se(),ae(D.value)),Te.value=0,Pe.value=0}),V(g,()=>{var t;(t=g.value)==null||t.focus()});const H=(t,e)=>{Ve.value||(N.value[Number.parseInt(e)]?He(t,Number.parseInt(e)):je(t,Number.parseInt(e)))},Ge=()=>{I.value={},w.value=!0,z.value=!0},Ze=t=>{var s;re(t,r==null?void 0:r.value),M==null||M.trigger({shouldShowLoading:!1}),$==null||$.trigger({shouldShowLoading:!1});const e=Z("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[Z("span",{class:"font-semibold"},ee("activity.recordCreatedLinked")),Z("span",{class:"text-gray-500"},ee("activity.gotSavedLinkedSuccessfully",{tableName:(s=m.value)==null?void 0:s.title,recordTitle:t[ne.value]}))]);gt.success(e),S.value=!1},ue=t=>{var e,s,i,d,y;if(t.key==="Escape")S.value=!1;else if(t.key==="ArrowDown"){t.preventDefault();try{(s=(e=t.target)==null?void 0:e.nextElementSibling)==null||s.focus()}catch{}}else if(t.key==="ArrowUp"){t.preventDefault();try{(d=(i=t.target)==null?void 0:i.previousElementSibling)==null||d.focus()}catch{}}else if(!w.value&&t.key!=="Tab"&&t.key!=="Shift"&&t.key!=="Enter"&&t.key!==" ")try{(y=g.value)==null||y.focus()}catch{}},ce=x();V(l,()=>{var t;(t=ce.value)==null||t.scrollTo({top:0,behavior:"smooth"})}),ft(()=>{window.addEventListener("keydown",ue),setTimeout(()=>{var t;(t=g.value)==null||t.focus()},100)}),_t(()=>{F(),l.query="",window.removeEventListener("keydown",ue)});const Je=()=>{l.page=1,F()};return(t,e)=>{var me,fe,_e,ve,ye,he,ke,we,xe,ge,be,Le;const s=bt,i=Tt,d=Ft,y=Pt,f=Bt,L=Dt,p=Vt,We=Lt,pe=Et,Xe=Ut,et=vt("e");return n(),c("div",{class:xt(["nc-modal-link-record h-full w-full overflow-hidden",{active:o(S)}]),onKeydown:e[8]||(e[8]=Q(T(()=>{},["stop"]),["enter"]))},[_("div",Mt,[_("div",$t,[_("div",jt,[t.hideBackBtn?C("",!0):(n(),c("button",{key:0,class:"!text-brand-500 hover:!text-brand-700 p-1.5 flex",onClick:e[0]||(e[0]=a=>X("attachLinkedRecord"))},[h(s,{icon:"ncArrowLeft",class:"flex-none h-4 w-4"})])),_("div",Ht,[h(i,{ref_key:"filterQueryRef",ref:g,value:o(l).query,"onUpdate:value":e[1]||(e[1]=a=>o(l).query=a),bordered:!1,placeholder:"Search records to link...",class:"w-full nc-excluded-search min-h-4 !pl-0",size:"small",onChange:Je,onKeydownCapture:e[2]||(e[2]=T(a=>{var u;a.key==="Escape"&&((u=o(g))==null||u.blur())},["stop"]))},{prefix:q(()=>[h(s,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"])])]),h(d,{"data-testid":"nc-link-count-info","linked-records":o(Qe),"related-table-title":(me=o(m))==null?void 0:me.title,relation:o(j),"table-title":(fe=o(le))==null?void 0:fe.title},null,8,["linked-records","related-table-title","relation","table-title"])]),_("div",Yt,[(ve=(_e=o(b))==null?void 0:_e.pageInfo)!=null&&ve.totalRows?(n(),c("div",{key:0,ref_key:"childrenExcludedListRef",ref:ce},[o(oe)?(n(!0),c(P,{key:0},K(Array.from({length:10}),(a,u)=>(n(),c("div",{key:u,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:bg-gray-50"},[_("div",qt,[h(y,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),_("div",Kt,[h(f,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),_("div",Qt,[(n(),c(P,null,K([1,2,3],Re=>h(f,{key:Re,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(n(!0),c(P,{key:1},K(((ye=o(b))==null?void 0:ye.list)??[],(a,u)=>(n(),E(L,{key:u,attachment:o(qe),"display-value-type-and-format-prop":o(De),fields:o(Ke),"is-linked":o(N)[Number.parseInt(u)],"is-loading":o(Be)[Number.parseInt(u)],"related-table-display-value-prop":o(ne),row:a,"data-testid":"nc-excluded-list-item",onLinkOrUnlink:Re=>H(a,u),onExpand:()=>{I.value=a,w.value=!0},onKeydown:[Q(T(()=>H(a,u),["prevent","stop"]),["space"]),Q(T(()=>H(a,u),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"]))),128))],512)):(n(),c("div",Gt,[h(o(At),{class:"w-16 h-16 mx-auto"}),o(l).query?(n(),c("p",Zt,G(t.$t("msg.noRecordsMatchYourSearchQuery")),1)):(n(),c("p",Jt,G(t.$t("msg.noRecordsAvailForLinking")),1))]))]),_("div",Wt,[_("div",Xt,[!o(ie)&&!o(Ae)?yt((n(),E(We,{key:0,size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",onClick:Ge},{default:q(()=>[_("div",eo,[o(B)?C("",!0):(n(),E(p,{key:0})),ht(" "+G(t.$t("activity.newRecord")),1)])]),_:1})),[[et,["c:row-expand:open"]]]):C("",!0)]),(he=o(b))!=null&&he.pageInfo&&+((we=(ke=o(b))==null?void 0:ke.pageInfo)==null?void 0:we.totalRows)>o(l).size?(n(),c(P,{key:0},[o(B)?(n(),c("div",to,[h(pe,{current:o(l).page,"onUpdate:current":e[3]||(e[3]=a=>o(l).page=a),"page-size":o(l).size,"onUpdate:pageSize":e[4]||(e[4]=a=>o(l).size=a),total:+((ge=(xe=o(b))==null?void 0:xe.pageInfo)==null?void 0:ge.totalRows),"entity-name":"links-excluded-list"},null,8,["current","page-size","total"])])):(n(),c("div",oo,[h(pe,{current:o(l).page,"onUpdate:current":e[5]||(e[5]=a=>o(l).page=a),"page-size":o(l).size,"onUpdate:pageSize":e[6]||(e[6]=a=>o(l).size=a),total:+((Le=(be=o(b))==null?void 0:be.pageInfo)==null?void 0:Le.totalRows),"entity-name":"links-excluded-list",mode:"simple"},null,8,["current","page-size","total"])]))],64)):C("",!0)])]),(n(),E(wt,null,{default:q(()=>{var a;return[o(w)?(n(),E(Xe,{key:0,modelValue:o(w),"onUpdate:modelValue":e[7]||(e[7]=u=>kt(w)?w.value=u:null),"load-row":!o(ie),"close-after-save":o(z),meta:o(m),"new-record-header":o(z)?t.$t("activity.tableNameCreateNewRecord",{tableName:(a=o(m))==null?void 0:a.title}):void 0,row:{row:o(I),oldRow:{},rowMeta:Object.keys(o(I)).length>0?{}:{new:!0}},"row-id":("extractPkFromRow"in t?t.extractPkFromRow:o(zt))(o(I),o(m).columns),state:o(Ye),"use-meta-fields":"","skip-reload":!0,"new-record-submit-btn-text":"Create & Link",onCreatedRecord:Ze},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","row-id","state"])):C("",!0)]}),_:1}))],34)}}}),Po=Ct(ao,[["__scopeId","data-v-5110f571"]]);export{Po as default};
