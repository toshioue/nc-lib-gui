import{f as N,bL as S,g6 as T,r as i,c$ as U,N as W,g as k,cV as O,cU as Q,H as j,hr as E,ae as F,o as n,c as f,P as o,U as h,w as v,b as u,T as D,a as b,t as z,S as I,V as G,W as H,Q as P,Y as A,a_ as Y,$ as J,aS as K,_ as X}from"./B2hUoZAs.js";import{_ as Z}from"./DtM1gwl8.js";import{_ as ee}from"./e4fIiYA_.js";import{a as ae,b as oe}from"./Bye44sky.js";import"./BWYzyVlv.js";import{I as te}from"./CwHJfKcC.js";import"./B4WiVz4N.js";import"./CGFlARNL.js";import"./fS-pjH0A.js";import"./DSjSw5ad.js";import"./BXXS6TCz.js";import"./CGB_6kIS.js";import"./B_8aIjz8.js";import"./BGKYJ52S.js";import"./i4toF4kp.js";import"./BQQOEPN4.js";import"./C9qKCFvP.js";import"./kd0F6MQ0.js";const re={key:0,class:"w-16 text-xs font-medium text-gray-400 truncate"},se={class:"xs:text-gray-600 group-hover:text-gray-700 sm:text-gray-400"},ne=N({__name:"SearchData",setup(le){const V=S(T),{meta:$}=ae(),g=S(U,i()),{search:r,loadFieldQuery:q}=oe(),s=i(!1),c=i(!1),y=i(),_=i(),{isMobileMode:C}=W(),m=k(()=>{var e,a;return((a=(e=$.value)==null?void 0:e.columns)==null?void 0:a.filter(t=>!O(t)&&(t==null?void 0:t.uidt)!==Q.Links))??[]});j(()=>{var e;return(e=g.value)==null?void 0:e.id},(e,a)=>{var t;e!==a&&q((t=g.value)==null?void 0:t.id)},{immediate:!0});function w(){V.trigger({shouldShowLoading:!1,offset:0})}const x=k(()=>{var a,t,d;if(r.value.field)return(t=(a=m.value)==null?void 0:a.find(l=>l.id===r.value.field))==null?void 0:t.title;const e=(d=m.value)==null?void 0:d.find(l=>l.pv);return r.value.field=e==null?void 0:e.id,e==null?void 0:e.title});E(()=>r.value.query,()=>{w()},{debounce:500,maxWait:600});const B=e=>{r.value.field=e.id,s.value=!1},M=()=>{c.value=!0,Y(()=>{var e;(e=y.value)==null||e.focus()})};return F(_,e=>{const a=e.target;r.value.query||a.closest(".nc-dropdown-toolbar-search-field-option")||(c.value=!1)}),(e,a)=>{const t=J,d=K,l=Z,R=ee,L=te;return n(),f("div",{ref_key:"globalSearchWrapperRef",ref:_,class:"nc-global-search-wrapper"},[!o(r).query&&!o(c)?(n(),h(d,{key:0,class:"nc-toolbar-btn !rounded-lg !h-7 !px-1.5","data-testid":"nc-global-search-show-input",onClick:M},{default:v(()=>[u(t,{icon:"search",class:"h-4 w-4 text-gray-700 group-hover:text-black"})]),_:1})):(n(),f("div",{key:1,class:D(["flex flex-row border-1 rounded-lg h-7 xs:h-10 xs:ml-0 ml-1 border-gray-200 overflow-hidden focus-within:border-primary",{"border-primary":o(r).query.length!==0}])},[u(R,{visible:o(s),"onUpdate:visible":a[1]||(a[1]=p=>P(s)?s.value=p:null),trigger:["click"],"overlay-class-name":"nc-dropdown-toolbar-search-field-option"},{overlay:v(()=>[u(l,{"is-parent-open":o(s),"selected-option-id":o(r).field,"show-selected-option":"",options:o(m),"toolbar-menu":"globalSearch",onSelected:B},null,8,["is-parent-open","selected-option-id","options"])]),default:v(()=>[b("div",{class:D(["flex items-center group px-2 cursor-pointer border-r-1 border-gray-200 hover:bg-gray-100",{"bg-gray-50 ":o(s)}]),onClick:a[0]||(a[0]=p=>s.value=!o(s))},[u(t,{icon:"search",class:"ml-1 mr-2 h-3.5 w-3.5 text-gray-500 group-hover:text-black"}),o(C)?I("",!0):(n(),f("div",re,z(o(x)??""),1)),b("div",se,[(n(),h(G(("iconMap"in e?e.iconMap:o(H)).arrowDown),{class:"text-sm text-inherit"}))])],2)]),_:1},8,["visible"]),b("form",{class:"p-0",onSubmit:a[3]||(a[3]=A(()=>{},["prevent"]))},[o(r).query||o(c)?(n(),h(L,{key:0,ref_key:"globalSearchRef",ref:y,value:o(r).query,"onUpdate:value":a[2]||(a[2]=p=>o(r).query=p),name:"globalSearchQuery",size:"small",class:"text-xs w-40 h-full",placeholder:`${e.$t("general.searchIn")} ${o(x)??""}`,bordered:!1,"data-testid":"search-data-input",onPressEnter:w},null,8,["value","placeholder"])):I("",!0)],32)],2))],512)}}}),Ie=X(ne,[["__scopeId","data-v-72aa76e0"]]);export{Ie as default};
