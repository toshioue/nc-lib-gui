import{_ as oe}from"./BLvTi2Ht.js";import{f as ne,d1 as c,N as ie,r as g,gm as re,g as A,cs as J,d7 as ce,i as ue,o as r,c as x,a as i,U as y,P as t,b as n,w as l,aq as M,av as O,S as E,d as _,t as m,V as G,W as R,T as S,aj as V,ak as de,fG as pe,a1 as me,d8 as fe,a0 as xe,$ as _e,aN as ve,p as be,e as ye,A as he,_ as we}from"./Cgw6cdOy.js";import{_ as ge}from"./CJBRTPd8.js";import{a as Ee}from"./iEPEi51w.js";import{u as Se}from"./DBXRneGc.js";import{S as ke}from"./D8rpj5Lr.js";import"./DBOeGHNL.js";import"./C6pQ4eSP.js";import"./VVwMOds3.js";import"./Bxm040c6.js";import"./CiTH7PYd.js";import"./CO8XXsKl.js";import"./DFiWgQ57.js";import"./D7yS5JAk.js";import"./Bcy-XIkn.js";import"./DPaOlBFV.js";import"./BQQOEPN4.js";import"./hvq8FVej.js";import"./C8c9012h.js";import"./BIsWr_mR.js";import"./BZz6iAla.js";import"./ahvdY77A.js";import"./C0xV_Bo1.js";import"./Dwil3It4.js";import"./OF3g5mdA.js";import"./tqKkZMzS.js";import"./CAuyt8bq.js";import"./DvfxijkH.js";import"./DCTaz0D2.js";import"./DzMG5wJt.js";import"./BK3iCpwL.js";import"./boyBAVNN.js";import"./CGpPc2co.js";import"./CevRfOSd.js";import"./CCkm5jiV.js";import"./BcpeJQoi.js";import"./DpOBhFIe.js";import"./vIgbYHAs.js";import"./DpDIhxXu.js";import"./BcZAlRJW.js";import"./BohSct8s.js";const Ie=k=>(be("data-v-7f537fb9"),k=k(),ye(),k),De={class:"pb-3 flex items-center justify-between gap-2.5 flex-wrap"},Ce={class:"w-full flex items-center gap-2"},Le={class:"min-w-5 flex items-center justify-center"},Je={class:"w-full flex items-center gap-2"},Me={class:"min-w-5 flex items-center justify-center"},Te={class:"flex-none flex justify-end"},$e={class:"data-exporter-body flex-1 flex flex-col"},Pe=Ie(()=>i("div",{class:"data-exporter-header"},"Recent Exports",-1)),Ae={key:0,class:"flex-1 flex flex-col nc-scrollbar-thin max-h-[calc(100%_-_25px)]"},Oe={key:1,class:"h-5 flex items-center"},Ve={class:"flex-1 max-w-[calc(100%_-_28px)] flex flex-col gap-1"},Fe={class:"inline-flex gap-1 text-sm text-gray-800 -ml-[1px]"},je={class:"inline-flex items-center h-5"},Ne={key:0,class:"text-[10px] leading-4 text-gray-600"},Ye={key:0,class:"flex items-center"},Be=["href"],Ge={class:"flex items-center gap-2"},Re={class:"flex items-center"},ze={key:1,class:"px-3 py-2 flex-1 flex items-center justify-center text-gray-600"},Ue=ne({__name:"index",setup(k){const z={[c.COMPLETED]:"Export successful",[c.FAILED]:"Export failed"},{$api:U,$poller:H}=he(),{appInfo:W}=ie(),{extension:b,tables:F,fullscreen:v,getViewsForTable:q}=Ee(),{jobList:I,loadJobsForBase:K}=Se(),D=g([]),C=g([]),j=g(),{width:T}=re(j),N=A(()=>I.value.filter(e=>{var s;return e.job==="data-export"&&((s=e.result)==null?void 0:s.extension_id)===b.value.id&&!C.value.includes(e.id)}).map(e=>({...e,result:e.result||{}})).sort((e,s)=>J(s.created_at).unix()-J(e.created_at).unix())),o=g({}),Q=A(()=>F.value.map(e=>({label:e.title,value:e.id,meta:e.meta}))),X=A(()=>o.value.tableId?D.value.filter(e=>e.type===ce.GRID).map(e=>({label:e.is_default?"Default View":e.title,value:e.id,meta:e.meta,type:e.type}))||[]:[]),Y=async()=>{o.value.tableId&&(D.value=await q(o.value.tableId))},Z=async e=>{var s;o.value.tableId=e,await Y(),o.value.viewId=(s=D.value.find(d=>d.is_default))==null?void 0:s.id,await b.value.kvStore.set("exportPayload",o.value)},ee=async e=>{o.value.viewId=e,await b.value.kvStore.set("exportPayload",o.value)},f=g(!1);async function te(){try{if(f.value||!o.value.viewId)return;f.value=!0;const e=await U.export.data(o.value.viewId,"csv",{extension_id:b.value.id});I.value.unshift(e),H.subscribe({id:e.id},async s=>{var d,u,h;if(s.status!=="close"){if(s.status===c.COMPLETED){V.info("Successfully exported data!");const p=I.value.find(w=>w.id===s.id);p&&(p.status=c.COMPLETED,p.result=(d=s.data)==null?void 0:d.result),f.value=!1}else if(s.status===c.FAILED){V.error("Failed to export data!");const p=I.value.find(w=>w.id===s.id);p&&(p.status=c.FAILED,p.result=(u=s.data)==null?void 0:u.result,(h=p.result)!=null&&h.title||(p.result={...p.result||{},title:$()})),f.value=!1}}})}catch(e){V.error(await de(e))}}const ae=e=>e.startsWith("http")?e:`${W.value.ncSiteUrl||pe}/${e}`;function $(){const e=F.value.find(d=>d.id===o.value.tableId),s=D.value.find(d=>d.id===o.value.viewId);return`${e==null?void 0:e.title} (${s!=null&&s.is_default?"Default View":s==null?void 0:s.title})`}const se=async e=>{C.value.push(e),await b.value.kvStore.set("deletedExports",C.value)},B=(e,s)=>{var d,u;return(u=(d=s.key)==null?void 0:d.toLowerCase())==null?void 0:u.includes(e==null?void 0:e.toLowerCase())};return ue(()=>{o.value=b.value.kvStore.get("exportPayload")||{},C.value=b.value.kvStore.get("deletedExports")||[],Y(),K()}),(e,s)=>{const d=oe,u=me,h=ke,p=ge,w=fe,P=xe,L=_e,le=ve;return r(),x("div",{ref_key:"dataExporterRef",ref:j,class:"data-exporter"},[i("div",De,[i("div",{class:y(["flex-1 flex items-center",{"max-w-[min(350px,calc(100%-124px))]":t(f)&&!t(v)&&t(T)>325,"max-w-[min(350px,calc(100%_-_84px))]":!t(f)&&!t(v)&&t(T)>325,"max-w-full":t(T)<=325,"max-w-[900px]":t(v)}])},[n(p,{value:t(o).tableId,"onUpdate:value":s[0]||(s[0]=a=>t(o).tableId=a),placeholder:"-select table-",disabled:t(f),class:y(["nc-data-exporter-table-select",{"flex-1 max-w-[240px]":t(v),"min-w-1/2 max-w-[175px]":!t(v)}]),"filter-option":B,"dropdown-class-name":"w-[250px]","show-search":"",onChange:Z},{default:l(()=>[(r(!0),x(M,null,O(t(Q),a=>(r(),E(h,{key:a.label,value:a.value},{default:l(()=>[i("div",Ce,[i("div",Le,[n(d,{meta:{meta:a.meta},class:"text-gray-500"},null,8,["meta"])]),n(u,{class:"flex-1 truncate","show-on-truncate-only":""},{title:l(()=>[_(m(a.label),1)]),default:l(()=>[i("span",null,m(a.label),1)]),_:2},1024),t(o).tableId===a.value?(r(),E(G(("iconMap"in e?e.iconMap:t(R)).check),{key:0,id:"nc-selected-item-icon",class:"flex-none text-primary w-4 h-4"})):S("",!0)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled","class"]),n(p,{value:t(o).viewId,"onUpdate:value":s[1]||(s[1]=a=>t(o).viewId=a),placeholder:"-select view-",disabled:t(f),class:y(["nc-data-exporter-view-select",{"flex-1 max-w-[240px]":t(v),"min-w-1/2 max-w-[175px]":!t(v)}]),"dropdown-class-name":"w-[250px]","filter-option":B,"show-search":"",onChange:ee},{default:l(()=>[(r(!0),x(M,null,O(t(X),a=>(r(),E(h,{key:a.label,value:a.value},{default:l(()=>[i("div",Je,[i("div",Me,[n(w,{meta:{meta:a.meta,type:a.type},class:"flex-none text-gray-500"},null,8,["meta"])]),n(u,{class:"flex-1 truncate","show-on-truncate-only":""},{title:l(()=>[_(m(a.label),1)]),default:l(()=>[i("span",null,m(a.label),1)]),_:2},1024),t(o).viewId===a.value?(r(),E(G(("iconMap"in e?e.iconMap:t(R)).check),{key:0,id:"nc-selected-item-icon",class:"flex-none text-primary w-4 h-4"})):S("",!0)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled","class"])],2),i("div",Te,[n(u,{class:"flex",placement:"topRight",disabled:!t(f)},{title:l(()=>[_(" The CSV file is being prepared in the background. You'll be notified once it's ready. ")]),default:l(()=>{var a;return[n(P,{disabled:!((a=t(o))!=null&&a.viewId),loading:t(f),size:"xs",onClick:te},{default:l(()=>[_(m(t(f)?"Generating":"Export"),1)]),_:1},8,["disabled","loading"])]}),_:1},8,["disabled"])])]),i("div",$e,[Pe,t(N).length?(r(),x("div",Ae,[(r(!0),x(M,null,O(t(N),a=>(r(),x(M,null,[a.status!==("JobStatus"in e?e.JobStatus:t(c)).COMPLETED||a.result?(r(),x("div",{key:a.id,class:y(["px-3 py-2 flex gap-2 justify-between border-b-1 hover:bg-gray-50",{"px-4 py-3":t(v),"px-3 py-2":!t(v)}])},[i("div",{class:y(["flex-1 flex items-center gap-3",{"max-w-[calc(100%_-_74px)]":a.status===("JobStatus"in e?e.JobStatus:t(c)).COMPLETED,"max-w-[calc(100%_-_38px)]":a.status!==("JobStatus"in e?e.JobStatus:t(c)).COMPLETED}])},[[("JobStatus"in e?e.JobStatus:t(c)).COMPLETED,("JobStatus"in e?e.JobStatus:t(c)).FAILED].includes(a.status)?(r(),E(u,{key:0,class:"flex"},{title:l(()=>[_(m(z[a.status]),1)]),default:l(()=>[n(L,{icon:a.status===("JobStatus"in e?e.JobStatus:t(c)).COMPLETED?"circleCheck2":"alertTriangle",class:y(["flex-none h-4 w-4",{"!text-green-500":a.status===("JobStatus"in e?e.JobStatus:t(c)).COMPLETED,"!text-red-500":a.status===("JobStatus"in e?e.JobStatus:t(c)).FAILED}])},null,8,["icon","class"])]),_:2},1024)):(r(),x("div",Oe,[n(le,{size:"regular",class:"flex-none"})])),i("div",Ve,[i("div",Fe,[i("span",je,[n(L,{icon:"file",class:"flex-none text-gray-600/80 h-3.5 w-3.5"})]),n(u,{class:"truncate max-w-[calc(100%_-_20px)]","show-on-truncate-only":""},{title:l(()=>[_(m(a.result.title||$()),1)]),default:l(()=>[_(" "+m(a.result.title||$()),1)]),_:2},1024)]),a.result.timestamp?(r(),x("div",Ne,[n(u,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[_(m(t(J)(a.result.timestamp).format("MM/DD/YYYY [at] hh:mm A")),1)]),default:l(()=>[_(" "+m(t(J)(a.result.timestamp).format("MM/DD/YYYY [at] hh:mm A")),1)]),_:2},1024)])):S("",!0)])],2),a.status===("JobStatus"in e?e.JobStatus:t(c)).COMPLETED?(r(),x("div",Ye,[i("a",{href:ae(a.result.url),target:"_blank"},[n(u,{class:"flex items-center"},{title:l(()=>[_(m(e.$t("general.download")),1)]),default:l(()=>[n(P,{type:"secondary",size:"xs",class:"!px-[5px]"},{default:l(()=>[i("div",Ge,[n(L,{icon:"download"})])]),_:1})]),_:1})],8,Be)])):S("",!0),i("div",Re,[n(u,{class:"flex"},{title:l(()=>[_(m(e.$t("general.remove")),1)]),default:l(()=>[n(P,{type:"text",size:"xs",class:"!px-[5px]",onClick:He=>se(a.id)},{default:l(()=>[n(L,{icon:"close"})]),_:2},1032,["onClick"])]),_:2},1024)])],2)):S("",!0)],64))),256))])):(r(),x("div",ze,"No exports"))])],512)}}}),At=we(Ue,[["__scopeId","data-v-7f537fb9"]]);export{At as default};
