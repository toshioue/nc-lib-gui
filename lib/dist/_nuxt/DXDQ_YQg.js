import{_ as he}from"./3I_Awkws.js";import{f as _e,N as ge,bL as _,d0 as be,fH as xe,hf as ke,r as k,ay as Ce,aw as Ie,au as Se,at as $e,g as I,az as Ae,hp as Re,hs as Me,hv as Le,L as je,d4 as K,H as se,hO as Ee,i as Ve,cp as ze,aA as Be,o as u,c as g,P as a,U as V,w as m,al as z,am as F,V as oe,T as b,b as x,a as p,a8 as H,d9 as S,d as D,t as $,S as N,Q as ne,n as He,Y as ie,ap as Ue,$ as Te,dj as Ke,_ as De}from"./B2hUoZAs.js";import{u as re}from"./CEs-fTPr.js";import{B as Ne}from"./BXXS6TCz.js";import{M as Oe}from"./CY5huSrU.js";import{C as Pe,a as qe}from"./DMylWvyY.js";import{R as Ge,_ as Fe}from"./Df48od_3.js";import{T as Je}from"./B3nR1Eu5.js";import{S as Qe,_ as Ye}from"./CaxUP45y.js";import"./Coz9Ftud.js";import"./C9qKCFvP.js";import"./1orNHd0L.js";import"./BQQOEPN4.js";import"./R1pHeCcp.js";import"./BGKYJ52S.js";const We={key:0,class:"w-full max-w-full"},Xe={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ze={class:"flex-none"},ea={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},aa={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},la=_e({__name:"User",props:{modelValue:{},rowIndex:{},location:{},forceMulti:{type:Boolean}},emits:["update:modelValue"],setup(J,{emit:ce}){const Q=ce,{isMobileMode:de}=ge(),Y=_(be),v=_(xe),U=_(ke),W=_(Ce,k(!1)),X=_(Ie,k(!1)),ue=Se(),{basesUser:me}=$e(ue),Z=I(()=>Y.value.base_id?me.value.get(Y.value.base_id)||[]:[]),T=I(()=>X.value||W.value),O=_(Ae,k(!1)),P=_(Re,k(!1)),M=I(()=>{var e;return J.forceMulti||((e=v.value.meta)==null?void 0:e.is_multi)}),A=_(Me,k(void 0)),L=k(),c=k(!1),j=_(Le,k(!1)),ee=k(),{isUIAllowed:fe}=je(),E=I(()=>{var o,r,d;let e=1;const l=(((o=K(v.value.meta))==null?void 0:o.limitOptions)||[]).reduce((n,i)=>(e<((i==null?void 0:i.order)??0)&&(e=i.order),{...n,[i.id]:i}),{})??{},s=[];return!P.value&&O.value&&((r=K(v.value.meta))!=null&&r.isLimitOption)&&(((d=K(v.value.meta))==null?void 0:d.limitOptions)||[]).length?s.push(...(Z.value||[]).filter(n=>{var i,B;return((i=l[n.id])==null?void 0:i.show)!==void 0?(B=l[n.id])==null?void 0:B.show:!1}).map(n=>{var i;return{id:n.id,email:n.email,display_name:n.display_name,deleted:n.deleted,order:n.id&&l[n.id]?((i=l[n.id])==null?void 0:i.order)??n.order:e++}}).sort((n,i)=>n.order-i.order)):s.push(...(Z.value||[]).map(n=>({id:n.id,email:n.email,display_name:n.display_name,deleted:n.deleted,order:e++})).sort((n,i)=>n.order-i.order)),s}),ae=I(()=>fe("dataEdit")),y=I(()=>(ae.value||O.value)&&T.value),w=I({get:()=>{let e=[],l=J.modelValue;if(typeof l=="string"&&/^\s*[{[]/.test(l))try{l=JSON.parse(l)}catch{}return typeof l=="string"?e=l.split(",").map(o=>o.trim()).reduce((o,r)=>{const d=E.value.find(n=>n.id===r||n.email===r);return d&&o.push({label:(d==null?void 0:d.display_name)||(d==null?void 0:d.email),value:d.id}),o},[]):e=l?(Array.isArray(l)?l:[l]).reduce((s,o)=>{const r=(o==null?void 0:o.display_name)||(o==null?void 0:o.email);return r&&s.push({label:r,value:o.id}),s},[]):[],e},set:e=>{const l=[];e&&e.length&&e.forEach(s=>{const o=E.value.find(r=>r.id===s);o&&l.push(o.id)}),M.value?Q("update:modelValue",e!=null&&e.length?l.join(","):null):(Q("update:modelValue",e!=null&&e.length?l[l.length-1]:null),c.value=!1)}}),q=I(()=>{var e,l;return M.value?(w.value||[]).map(s=>s.value):((l=(e=w.value||[])==null?void 0:e[0])==null?void 0:l.value)||""});se(c,(e,l)=>{var s,o,r,d,n,i;e||(ee.value=""),y.value&&(e?(i=(n=(d=L.value)==null?void 0:d.$el)==null?void 0:n.querySelector("input"))==null||i.focus():(r=(o=(s=L.value)==null?void 0:s.$el)==null?void 0:o.querySelector("input"))==null||r.blur())}),se(T,(e,l)=>{e||(c.value=!1)}),re(X,e=>{var l;switch(e.key){case"Escape":c.value=!1;break;case"Enter":y.value&&T.value&&!c.value&&(c.value=!0);break;case" ":break;case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":case"Delete":break;default:if(!y.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)&&((l=e.key)==null?void 0:l.length)===1&&!Ke()&&(e.stopPropagation(),c.value=!0);break}}),re(c,e=>{e.key==="Escape"&&(c.value=!1)});const pe=()=>{var e,l,s;ee.value=(s=(l=(e=L.value)==null?void 0:e.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:s.value},ve=(e,l)=>{var s,o;((s=e.target)!=null&&s.classList.contains("ant-tag-close-icon")||(o=e.target)!=null&&o.closest(".ant-tag-close-icon"))&&(e.stopPropagation(),l())},R=_(Ee,null),ye=()=>{R||(c.value=y.value&&!c.value)},le=()=>{c.value=y.value&&!c.value};Ve(()=>{R==null||R.on(le)}),ze(()=>{R==null||R.on(le)}),Be(document,"click",e=>{var l;c.value&&L.value&&!L.value.$el.contains(e.target)&&!((l=document.querySelector(".nc-dropdown-user-select-cell.active"))!=null&&l.contains(e.target))&&(W.value=!1,c.value=!1)},!0);const we=(e,l)=>{const s=E.value.find(r=>r.id===l.value),o=(s==null?void 0:s.display_name)||(s==null?void 0:s.email);if(o)return o.toLowerCase().includes(e.toLowerCase())};return(e,l)=>{var B;const s=he,o=Ue,r=Je,d=Te,n=Qe,i=Ye;return u(),g("div",{class:b(["nc-cell-field nc-user-select h-full w-full flex items-center",{"read-only":a(U)}]),onClick:ye},[!a(P)&&a(O)&&((B=("parseProp"in e?e.parseProp:a(K))(a(v).meta))!=null&&B.isList)?(u(),g("div",We,[(u(),V(oe(a(M)?a(qe):a(Fe)),{value:a(q),"onUpdate:value":[l[0]||(l[0]=t=>ne(q)?q.value=t:null),l[1]||(l[1]=t=>{w.value=a(M)?t:[t]})],disabled:a(U)||!a(y),class:"nc-field-layout-list"},{default:m(()=>[(u(!0),g(z,null,F(a(E),t=>(u(),g(z,{key:t.id||t.email},[t.deleted?N("",!0):(u(),V(oe(a(M)?a(Pe):a(Ge)),{key:t.id||t.email,value:t.id,"data-testid":`select-option-${a(v).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:b(`nc-select-option-${a(v).title}-${t.email}`)},{default:m(()=>[x(r,{class:"rounded-tag max-w-full !pl-0",color:"'#ccc'"},{default:m(()=>{var h,C;return[p("span",{style:H({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"flex items-stretch gap-2 text-small"},[p("div",null,[x(s,{size:"auto",name:(h=t.display_name)!=null&&h.trim()?(C=t.display_name)==null?void 0:C.trim():"",email:t.email,class:"!text-[0.65rem]"},null,8,["name","email"])]),x(o,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>{var f;return[D($(((f=t.display_name)==null?void 0:f.trim())||t.email),1)]}),default:m(()=>{var f;return[p("span",Xe,$(((f=t.display_name)==null?void 0:f.trim())||t.email),1)]}),_:2},1024)],4)]}),_:2},1024)]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},40,["value","disabled"])),!a(M)&&a(w).length?(u(),g("div",{key:0,class:"inline-block px-2 pt-2 cursor-pointer text-xs text-gray-500 hover:text-gray-800",onClick:l[2]||(l[2]=t=>w.value=[])},$(e.$t("labels.clearSelection")),1)):N("",!0)])):(u(),g(z,{key:1},[a(T)?(u(),V(i,{key:1,ref_key:"aselect",ref:L,value:a(w),"onUpdate:value":l[4]||(l[4]=t=>ne(w)?w.value=t:null),mode:"multiple",class:b(["w-full overflow-hidden",{"caret-transparent":!a(ae)}]),placeholder:a(P)?e.$t("labels.optional"):"",bordered:!1,"clear-icon":"","show-search":!a(de),"show-arrow":a(y)&&!a(U),open:a(c)&&a(y),disabled:a(U)||!a(y),"dropdown-class-name":`nc-dropdown-user-select-cell !min-w-156px ${a(c)?"active":""}`,"filter-option":we,onSearch:pe,onKeydown:l[5]||(l[5]=ie(()=>{},["stop"]))},{suffixIcon:m(()=>[x(d,{icon:"arrowDown",class:"text-gray-700 nc-select-expand-btn"})]),tagRender:m(({label:t,value:h,onClose:C})=>{var f,te;return[a(E).find(G=>G.id===h)?(u(),V(r,{key:0,class:b(["rounded-tag nc-selected-option !pl-0",{"!my-0":!a(A)||a(A)===1}]),style:{display:"flex",alignItems:"center"},color:"'#ccc'",closable:a(y)&&((((f=a(w))==null?void 0:f.length)??0)>1||!((te=a(v))!=null&&te.rqd)),"close-icon":("h"in e?e.h:a(He))(a(Oe),{class:["ms-close-icon"]}),onClick:G=>ve(G,C),onClose:C},{default:m(()=>[p("span",{style:H({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:b(["flex items-stretch gap-2",{"text-sm":a(j),"text-small":!a(j)}])},[p("div",null,[x(s,{size:"auto",name:t!=null&&t.includes("@")?"":t.trim(),email:t,class:"!text-[0.65rem]"},null,8,["name","email"])]),D(" "+$(t),1)],6)]),_:2},1032,["class","closable","close-icon","onClick","onClose"])):N("",!0)]}),default:m(()=>[(u(!0),g(z,null,F(a(E),t=>(u(),g(z,{key:t.id||t.email},[t.deleted?N("",!0):(u(),V(n,{key:0,value:t.id,"data-testid":`select-option-${a(v).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:b(`nc-select-option-${a(v).title}-${t.email}`),onClick:l[3]||(l[3]=ie(()=>{},["stop"]))},{default:m(()=>[x(r,{class:b(["rounded-tag max-w-full !pl-0",{"!my-0":!a(A)||a(A)===1}]),color:"'#ccc'"},{default:m(()=>{var h,C;return[p("span",{style:H({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:b(["flex items-stretch gap-2",{"text-sm":a(j),"text-small":!a(j)}])},[p("div",null,[x(s,{size:"auto",name:(h=t.display_name)!=null&&h.trim()?(C=t.display_name)==null?void 0:C.trim():"",email:t.email,class:"!text-[0.65rem]"},null,8,["name","email"])]),x(o,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>{var f;return[D($(((f=t.display_name)==null?void 0:f.trim())||t.email),1)]}),default:m(()=>{var f;return[p("span",aa,$(((f=t.display_name)==null?void 0:f.trim())||t.email),1)]}),_:2},1024)],6)]}),_:2},1032,["class"])]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},8,["value","placeholder","show-search","show-arrow","open","disabled","class","dropdown-class-name"])):(u(),g("div",{key:0,class:"flex flex-wrap",style:H({display:"-webkit-box","max-width":"100%","-webkit-line-clamp":("rowHeightTruncateLines"in e?e.rowHeightTruncateLines:a(Ne))(a(A)),"-webkit-box-orient":"vertical",overflow:"hidden"})},[(u(!0),g(z,null,F(a(w),t=>(u(),V(r,{key:t.value,class:b(["rounded-tag max-w-full !pl-0",{"!my-0":!a(A)||a(A)===1}]),color:"'#ccc'"},{default:m(()=>{var h;return[p("span",{style:H({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:b(["flex items-stretch gap-2",{"text-sm":a(j),"text-small":!a(j)}])},[p("div",Ze,[x(s,{size:"auto",name:(h=t.label)!=null&&h.includes("@")?"":t.label.trim(),email:t.label,class:"!text-[0.65rem]"},null,8,["name","email"])]),x(o,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>[D($(t.label),1)]),default:m(()=>[p("span",ea,$(t.label),1)]),_:2},1024)],6)]}),_:2},1032,["class"]))),128))],4))],64))],2)}}}),_a=De(la,[["__scopeId","data-v-19eeebf8"]]);export{_a as default};
