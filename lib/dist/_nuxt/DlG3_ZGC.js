const __vite__fileDeps=["./BaG7jRBy.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./EmojiPicker.B3qwzTNG.css","./DwrbIntl.js","./B4q_iKR5.js","./0QUe8GCE.js","./Overlay.BGbSKdGB.css","./DNgdBwTe.js","./eX8_g88K.js","./vll-Pnjv.js","./View.B2EG4bUV.css","./B36oLxB9.js","./CZuNEiKm.js","./Cnilgdo3.js","./J1VSp1ZI.js","./D9I5yoZ0.js","./sz1d3zjm.js","./MenuItem.C7h59s4s.css","./TJfB7GlU.js","./0azk-b-q.js","./Divider.DqtSqZhb.css","./BLgccLvp.js","./Menu.CQ8GNWeI.css","./vK-WmZ7a.js","./8DEek4Fb.js","./2FgppHLC.js","./Ck-cgwga.js","./Tabs.DaLSLYpn.css","./9ZvwAtsX.js","./Menu.CgrqNPiu.css","./BNg0gwea.js","./DuJHisTB.js","./oyD85nwD.js","./Modal.Bu3vZLfr.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as ce,L as De,o as t,c as M,a as u,b as s,w as o,d as A,t as x,N as e,V as Qe,$ as Vt,_ as Ue,aw as dt,ax as ae,cO as Ze,cP as Ce,f as se,M as Ge,P as Z,Q as p,S as te,R as E,Y as Fe,Z as Be,ag as ea,ab as et,cQ as Ja,cR as Dt,ay as st,cS as ot,r as I,cT as Zt,F as Xe,a$ as ct,O as le,ah as me,ai as Ne,aM as ma,J as He,cL as qe,a6 as fa,cU as ta,aK as Ct,cV as as,cW as yt,cX as va,ar as ba,D as _a,a7 as hs,aJ as pt,W as ve,y as Le,cY as Is,cZ as Ts,ap as Kt,ac as aa,aF as ss,c_ as St,c$ as pa,g as jt,ba as Ds,a5 as at,d0 as Cs,m as Ee,d1 as Ss,z as Xt,bL as We,d2 as ya,d3 as Wt,d4 as $e,d5 as os,aL as ga,az as _t,d6 as Vs,d7 as js,d8 as Ms,d9 as sa,ao as ge,a9 as Ps,X as gt,a4 as wt,da as Es,at as wa,db as Ns,dc as Tt,aa as Ls,K as Os,aq as ns,dd as ls,T as is,U as Us,de as Bs,df as Ya,dg as Rs,dh as As,bT as zs,u as xa,di as rs,dj as Gs,cm as Fs,dk as Qa,dl as Za,dm as Ks,dn as Ws,dp as Hs,dq as qs,aT as Js,aE as Xa,dr as Ys,ds as Qs,dt as Zs,cA as Xs,du as eo,dv as es,a2 as to,a3 as ao}from"./DZZ6t_j4.js";import{_ as so}from"./D2akrV39.js";import{u as oa}from"./CMIIcM5i.js";import{S as cs}from"./BmtvKY7O.js";import"./uskrw1rV.js";import{_ as na}from"./Bdv7ru7D.js";import{b as oo,a as no}from"./C3jLTHF4.js";import"./DKN1hQ6S.js";import{I as ka}from"./BQuyMdA-.js";import{F as Ft}from"./BYINaHrJ.js";import{_ as $a}from"./dfem9Uc_.js";import{_ as lo,a as io,b as ro}from"./BGk5IibS.js";import{_ as co}from"./DGj1ycqW.js";import{u as Mt}from"./BT-ahe-O.js";import{u as ts,_ as ds}from"./DuvRsGDb.js";import{_ as Pt}from"./DgixBgIx.js";import{C as ha}from"./DNgdBwTe.js";import{_ as Ia}from"./0azk-b-q.js";import{_ as uo}from"./B4q_iKR5.js";import{_ as po,u as mo}from"./K-Jk6Xey.js";import{_ as Ht}from"./sz1d3zjm.js";import{_ as Ta}from"./TJfB7GlU.js";import{_ as fo,a as vo}from"./CxrpBWdD.js";import{_ as bo}from"./C8YpY8qO.js";import{u as ze}from"./C3XbZq4f.js";import{_ as la}from"./BLgccLvp.js";import{_ as qt}from"./vK-WmZ7a.js";import{S as us}from"./C0-Qcoum.js";import{_ as _o}from"./CynerQ2m.js";import{_ as ps}from"./BqKQ8afS.js";import{_ as ms}from"./eN7rAydx.js";import{_ as yo}from"./DCjuPxLb.js";import{_ as go,C as wo}from"./CbjHV4v2.js";import{I as xo}from"./DRJOThhQ.js";import{D as ko}from"./Dg0-TbNo.js";import{u as $o}from"./Ms3UsmOm.js";import{_ as ho}from"./DnwRMKX3.js";import{_ as Io}from"./CyRMlOXW.js";import{_ as To}from"./K3POysmD.js";import{_ as Do}from"./DnSVh-oD.js";import{u as fs}from"./D_Z9WPOi.js";import"./DXQuLwNn.js";import"./BLzs_b5A.js";import"./B5RRVMt5.js";import"./DyDFI6NE.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./D9tFZoTQ.js";import"./BCJFTkwv.js";import"./eX8_g88K.js";import"./0QUe8GCE.js";import"./By7kEk8u.js";import"./QHHXY-Ma.js";import"./D_MsYLkT.js";import"./CB1aB6F1.js";import"./CXKU6jgO.js";import"./2FgppHLC.js";import"./DA0VIM8P.js";import"./BO2leIU3.js";import"./CmWcz5yS.js";import"./CXD-Dj4T.js";import"./DC_VdAC1.js";import"./hZgTYrdl.js";import"./ByVBARmO.js";import"./37hePIet.js";import"./C4K5fdHe.js";import"./t0mbNaqp.js";const Co={class:"flex flex-row flex-grow pl-0.5 pr-1 py-0.5 rounded-md w-full",style:{"max-width":"calc(100% - 2.5rem)"}},So={class:"flex-grow min-w-20"},Vo={"data-testid":"nc-workspace-menu",class:"flex items-center nc-workspace-menu overflow-hidden py-1.25 pr-0.25 justify-center w-full ml-2"},jo={class:"transition-all duration-200 transform w-24 min-w-10",href:"#",target:"_blank",rel:"noopener noreferrer"},Mo=ce({__name:"Menu",setup(b){const{appInfo:S}=De();return(r,l)=>{var w;const i=Vt;return t(),M("div",Co,[u("div",So,[u("div",Vo,[u("a",jo,[s(i,{disabled:!((w=e(S))!=null&&w.version)||("isEeUI"in r?r.isEeUI:e(Qe))},{title:o(()=>{var T;return[A(x((T=e(S))==null?void 0:T.version),1)]}),default:o(()=>[l[0]||(l[0]=u("img",{alt:"NocoDB",src:so},null,-1))]),_:1},8,["disabled"])]),l[1]||(l[1]=u("div",{class:"flex flex-grow"},null,-1))])])])}}}),Po=Ue(Mo,[["__scopeId","data-v-939e9018"]]),Eo=["data-workspace-title"],No={key:0,class:"flex flex-row items-center w-full"},Lo={class:"flex items-center text-inherit"},Oo={key:1,class:"flex flex-row items-center w-full mt-0.25 ml-2.5 gap-x-3"},Uo=ce({__name:"Header",setup(b){const S=dt(),{isLeftSidebarOpen:r}=ae(oa()),{activeWorkspace:l,isWorkspaceLoading:i}=ae(S),{activeViewTitleOrId:w}=ae(Ze()),{activeTableId:T}=ae(Ce()),{isMobileMode:P}=De(),O=se(()=>!(P.value&&!w.value&&!T.value));return(y,a)=>{var U;const D=Po,C=Fe,k=Be,f=Vt,L=cs,n=Ge("e");return t(),M("div",{class:"flex items-center nc-sidebar-header w-full border-b-1 border-gray-200 group md:px-2 md:py-1.2 xs:px-1 xs:py-1","data-workspace-title":(U=e(l))==null?void 0:U.title,style:{height:"var(--topbar-height)"}},[e(i)?(t(),M("div",Oo,[s(L,{active:!0,class:"!w-6 !h-6 !rounded overflow-hidden"}),s(L,{active:!0,class:"!w-40 !h-6 !rounded overflow-hidden"})])):(t(),M("div",No,[s(D),a[1]||(a[1]=u("div",{class:"flex flex-grow min-w-1"},null,-1)),s(f,{class:te(["flex",{"!opacity-100":!e(r)}]),placement:"bottom","hide-on-click":""},{title:o(()=>[A(x(e(r)?`${y.$t("title.hideSidebar")}`:`${y.$t("title.showSidebar")}`),1)]),default:o(()=>[e(O)?Z((t(),p(k,{key:0,type:e(P)?"secondary":"text",size:e(P)?"medium":"small",class:"nc-sidebar-left-toggle-icon !text-gray-700 !hover:text-gray-800 !xs:h-10.5 !xs:max-h-10.5 !xs:max-w-10.5 !md:hover:bg-gray-200",onClick:a[0]||(a[0]=$=>r.value=!e(r))},{default:o(()=>[u("div",Lo,[e(P)?(t(),p(C,{key:0,icon:"close"})):(t(),p(C,{key:1,icon:"doubleLeftArrow",class:te(["duration-150 transition-all !text-lg -mt-0.5 !text-gray-500/75",{"transform rotate-180":!e(r)}])},null,8,["class"]))])]),_:1},8,["type","size"])),[[n,["c:leftSidebar:hideToggle"]]]):E("",!0)]),_:1},8,["class"])]))],8,Eo)}}}),Bo={class:"flex flex-row items-center text-base text-gray-800"},Ro={class:"mt-1"},Ao={class:"flex flex-row justify-end mt-5 gap-x-2"},zo=ce({__name:"CreateProjectDlg",props:{modelValue:{type:Boolean},type:{}},emits:["update:modelValue"],setup(b,{emit:S}){const r=b,l=S,{t:i}=ea(),w=et(r,"modelValue",l),T=Ja(()=>r.type??Dt.DB),P=st(),{createProject:O}=P,{navigateToProject:y}=De(),{refreshCommandPalette:a}=ot(),D=[{required:!0,message:i("msg.info.dbNameRequired")},oo()],C=I(),k=I({title:"",meta:{iconColor:Zt[Math.floor(Math.random()*1e3)%Zt.length]}}),f=I(!1),L=async()=>{k.value.title&&(k.value.title=k.value.title.trim()),f.value=!0;try{const $=await O({type:T.value,title:k.value.title,meta:k.value.meta});y({baseId:$.id,type:T.value,workspaceId:"nc"}),w.value=!1}catch($){me.error(await Ne($))}finally{setTimeout(()=>{f.value=!1},500),a()}},n=I();Xe(w,async($,c)=>{$===c&&!$||setTimeout(async()=>{var d,h,m,R,V;(d=C.value)==null||d.resetFields(),k.value={title:"Base",meta:{iconColor:Zt[Math.floor(Math.random()*1e3)%Zt.length]}},await ct(),(m=(h=n.value)==null?void 0:h.$el)==null||m.focus(),(V=(R=n.value)==null?void 0:R.$el)==null||V.select()},5)});const U=Ja(()=>{switch(T.value){case Dt.DB:default:return"Base"}});return($,c)=>{const d=ma,h=ka,m=$a,R=Ft,V=Be,z=na,G=Ge("e");return t(),p(z,{visible:e(w),"onUpdate:visible":c[2]||(c[2]=Y=>le(w)?w.value=Y:null),size:"small","show-separator":!1},{header:o(()=>[u("div",Bo,[s(d,{color:e(k).meta.iconColor,type:e(T),class:"mr-2.5 !text-lg !h-4"},null,8,["color","type"]),A(" "+x($.$t("general.createEntity",{entity:e(U)})),1)])]),default:o(()=>[u("div",Ro,[s(R,{ref_key:"form",ref:C,model:e(k),name:"basic",layout:"vertical",class:"w-full !mx-auto","no-style":"",autocomplete:"off",onFinish:L},{default:o(()=>[s(m,{name:"title",rules:D,class:"!mb-0"},{default:o(()=>[s(h,{ref_key:"input",ref:n,value:e(k).title,"onUpdate:value":c[0]||(c[0]=Y=>e(k).title=Y),name:"title",class:"nc-metadb-base-name nc-input-sm nc-input-shadow",placeholder:"Title"},null,8,["value"])]),_:1})]),_:1},8,["model"]),u("div",Ao,[s(V,{type:"secondary",size:"small",onClick:c[1]||(c[1]=Y=>w.value=!1)},{default:o(()=>[A(x($.$t("general.cancel")),1)]),_:1}),Z((t(),p(V,{"data-testid":"docs-create-proj-dlg-create-btn",loading:e(f),type:"primary",size:"small",label:`${$.$t("general.create")} ${e(U)}`,"loading-label":`${$.$t("general.creating")} ${e(U)}`,onClick:L},{loading:o(()=>[A(x($.$t("general.creatingEntity",{entity:e(U)})),1)]),default:o(()=>[A(x($.$t("general.createEntity",{entity:e(U)}))+" ",1)]),_:1},8,["loading","label","loading-label"])),[[G,["a:base:create"]]])])])]),_:1},8,["visible"])}}}),Da=Ue(zo,[["__scopeId","data-v-3e0aea55"]]),Go=ce({__name:"CreateProjectBtn",props:{activeWorkspaceId:{},modal:{type:Boolean},type:{},isOpen:{type:Boolean},size:{},centered:{type:Boolean}},setup(b){const S=b,{isUIAllowed:r}=He(),{orgRoles:l,workspaceRoles:i}=He(),w=qe(),{isSharedBase:T}=ae(w),P=dt();ae(P);const O=I(!1),y=se(()=>S.size||"small"),a=se(()=>S.centered??!0);return(D,C)=>{const k=Da,f=Be,L=Ge("e");return e(r)("baseCreate",{roles:e(i)??e(l)})&&!e(T)?Z((t(),p(f,{key:0,type:"text",size:e(y),centered:e(a),onClick:C[1]||(C[1]=n=>O.value=!0)},{default:o(()=>[fa(D.$slots,"default"),s(k,{modelValue:e(O),"onUpdate:modelValue":C[0]||(C[0]=n=>le(O)?O.value=n:null)},null,8,["modelValue"])]),_:3},8,["size","centered"])),[[L,["c:base:create"]]]):E("",!0)}}}),Fo={key:0,class:"flex flex-col w-full gap-y-3.75 ml-3 mt-3.75"},Ko={key:0,class:"flex flex-row items-center w-full gap-x-3"},Wo={class:"flex flex-row items-center w-full gap-x-3"},Ho={class:"flex flex-row items-center w-full gap-x-3"},qo={key:1,class:"xs:hidden flex flex-col p-1 mt-0.25 mb-0.5 truncate"},Jo={class:"gap-x-2 flex flex-row w-full items-center !font-normal"},Yo={class:"flex"},Qo=ce({__name:"TopSection",setup(b){const S=dt(),r=qe(),{isUIAllowed:l}=He(),{appInfo:i}=De(),{meta:w,control:T}=ta(),{isWorkspaceLoading:P,isWorkspaceSettingsPageOpened:O,isIntegrationsPageOpened:y}=ae(S),{navigateToWorkspaceSettings:a,navigateToIntegrations:D}=S,{isSharedBase:C}=ae(r),k=I(!1),f=()=>{const n=Ct()?w.value:T.value;a("",n)},L=()=>{const n=Ct()?w.value:T.value;D("",n)};return(n,U)=>{const $=cs,c=Fe,d=Be,h=Go,m=Ge("e");return e(P)?(t(),M("div",Fo,[e(i).ee?(t(),M("div",Ko,[s($,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),s($,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})])):E("",!0),u("div",Wo,[s($,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),s($,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})]),u("div",Ho,[s($,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),s($,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})])])):e(C)?E("",!0):(t(),M("div",qo,[e(l)("workspaceSettings")||e(l)("workspaceCollaborators")?Z((t(),p(d,{key:0,type:"text",size:"xsmall",class:te(["nc-sidebar-top-button !xs:hidden my-0.5 !h-7",{"!text-brand-600 !bg-brand-50 !hover:bg-brand-50":e(O),"!hover:bg-gray-200 !hover:text-gray-700":!e(O)}]),"data-testid":"nc-sidebar-team-settings-btn",centered:!1,onClick:f},{default:o(()=>[u("div",{class:te(["flex items-center gap-2",{"font-semibold":e(O)}])},[s(c,{icon:"settings",class:"!h-4"}),u("div",null,x(n.$t("title.teamAndSettings")),1)],2)]),_:1},8,["class"])),[[m,["c:team:settings"]]]):E("",!0),e(l)("workspaceSettings")?Z((t(),p(d,{key:1,type:"text",size:"xsmall",class:te(["nc-sidebar-top-button !xs:hidden my-0.5 !h-7",{"!text-brand-600 !bg-brand-50 !hover:bg-brand-50":e(y),"!hover:bg-gray-200 !hover:text-gray-700":!e(y)}]),"data-testid":"nc-sidebar-integrations-btn",centered:!1,onClick:L},{default:o(()=>[u("div",{class:te(["flex items-center gap-2",{"font-semibold":e(y)}])},[s(c,{icon:"integration",class:"!h-4"}),u("div",null,x(n.$t("general.integrations")),1)],2)]),_:1},8,["class"])),[[m,["c:integrations"]]]):E("",!0),s(h,{"is-open":e(k),"onUpdate:isOpen":U[0]||(U[0]=R=>le(k)?k.value=R:null),modal:"",type:"text",class:"nc-sidebar-top-button !hover:bg-gray-200 !hover:text-gray-700 !xs:hidden !h-7 my-0.5","data-testid":"nc-sidebar-create-base-btn"},{default:o(()=>[u("div",Jo,[s(c,{icon:"plus"}),u("div",Yo,x(n.$t("title.createBase")),1)])]),_:1},8,["is-open"])]))}}}),Zo=Ue(Qo,[["__scopeId","data-v-c2c73dce"]]),Xo={class:"flex flex-row items-center gap-x-2"},en={class:"text-gray-900 font-bold"},tn={class:"mt-1"},an={class:"flex flex-row justify-end gap-x-2 mt-5"},sn=ce({__name:"TableDescriptionUpdate",props:{modelValue:{type:Boolean},tableMeta:{},sourceId:{}},emits:["update:modelValue","updated"],setup(b,{emit:S}){const r=as(b,["tableMeta"]),l=S,{$e:i,$api:w}=Le(),{setMeta:T}=yt(),P=et(r,"modelValue",l),{loadProjectTables:O}=Ce(),y=qe(),{loadTables:a}=y,{addUndo:D,defineProjectScope:C}=va(),k=I(),f=I(!1),L=Ft.useForm,n=ba({description:""}),U=se(()=>({description:[{validator:(d,h)=>new Promise((m,R)=>{m()})}]})),{validateInfos:$}=L(n,U);_a(()=>{var d;(d=b.tableMeta)!=null&&d.description&&(n.description=`${b.tableMeta.description}`),ct(()=>{var m;const h=(m=k.value)==null?void 0:m.$el;h&&(h.setSelectionRange(0,n.description.length),h.focus())})},{flush:"post"});const c=async(d=!1)=>{if(b.tableMeta){n.description&&(n.description=n.description.trim()),f.value=!0;try{await w.dbTable.update(b.tableMeta.id,{base_id:b.tableMeta.base_id,description:n.description}),P.value=!1,await O(b.tableMeta.base_id,!0),d||D({redo:{fn:m=>{n.description=m,c(!0,!0)},args:[n.description]},undo:{fn:m=>{n.description=m,c(!0,!0)},args:[b.tableMeta.description]},scope:C({model:b.tableMeta})}),await a();const h=await w.dbTable.read(b.tableMeta.id);await T(h),i("a:table:description:update"),P.value=!1}catch(h){me.error(await Ne(h))}f.value=!1}};return(d,h)=>{const m=Fe,R=co,V=$a,z=Ft,G=Be,Y=na;return t(),p(Y,{visible:e(P),"onUpdate:visible":h[4]||(h[4]=q=>le(P)?P.value=q:null),size:"small","show-separator":!1},{header:o(()=>{var q,_;return[u("div",Xo,[s(m,{icon:"table",class:"w-6 h-6 text-gray-700"}),u("span",en,x(((q=d.tableMeta)==null?void 0:q.title)??((_=d.tableMeta)==null?void 0:_.table_name)),1)])]}),default:o(()=>{var q,_,j,B;return[u("div",tn,[s(z,{layout:"vertical",model:e(n),name:"create-new-table-form"},{default:o(()=>[s(V,hs({label:d.$t("labels.description")},e($).description),{default:o(()=>[s(R,{ref_key:"inputEl",ref:k,value:e(n).description,"onUpdate:value":h[0]||(h[0]=F=>e(n).description=F),class:"nc-input-sm !py-2 nc-text-area nc-input-shadow","hide-details":"",size:"small",placeholder:d.$t("msg.info.enterTableDescription"),onKeydown:h[1]||(h[1]=pt(ve(()=>c(),["exact"]),["enter"]))},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1},8,["model"]),u("div",an,[s(G,{type:"secondary",size:"small",onClick:h[2]||(h[2]=F=>P.value=!1)},{default:o(()=>[A(x(d.$t("general.cancel")),1)]),_:1}),s(G,{key:"submit",type:"primary",size:"small",disabled:((_=(q=e($))==null?void 0:q.description)==null?void 0:_.validateStatus)==="error"||((j=e(n).description)==null?void 0:j.trim())===((B=d.tableMeta)==null?void 0:B.description),loading:e(f),onClick:h[3]||(h[3]=()=>c())},{default:o(()=>[A(x(d.$t("general.save")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),on=Ue(sn,[["__scopeId","data-v-498ac221"]]),nn={class:"flex flex-row items-center gap-x-2"},ln={class:"mt-1"},rn={class:"flex flex-row justify-end gap-x-2 mt-5"},cn=ce({__name:"TableRename",props:{modelValue:{type:Boolean},tableMeta:{},sourceId:{}},emits:["update:modelValue","updated"],setup(b,{emit:S}){const r=as(b,["tableMeta","sourceId"]),l=S,{$e:i,$api:w}=Le(),{setMeta:T}=yt(),P=et(r,"modelValue",l),{updateTab:O}=Mt(),{loadProjectTables:y}=Ce(),a=qe(),{loadTables:D,isMysql:C,isMssql:k,isPg:f}=a,{tables:L,base:n}=ae(a),{allRecentViews:U}=ae(Ze()),{refreshCommandPalette:$}=ot(),{addUndo:c,defineProjectScope:d}=va(),h=I(),m=I(!1),R=Ft.useForm,V=ba({title:""}),z=se(()=>({title:[no,{validator:(q,_)=>new Promise((j,B)=>{var ue;let F=255;if(C(b.sourceId)?F=64:f(b.sourceId)?F=63:k(b.sourceId)&&(F=128),((((ue=n==null?void 0:n.value)==null?void 0:ue.prefix)||"")+_).length>F)return B(new Error(`Table name exceeds ${F} characters`));j()})},{validator:(q,_)=>new Promise((j,B)=>{if(!((L==null?void 0:L.value)||[]).every(F=>F.id===b.tableMeta.id||F.title.toLowerCase()!==((_==null?void 0:_.trim())||"").toLowerCase()))return B(new Error("Duplicate table alias"));j()})}]})),{validateInfos:G}=R(V,z);_a(()=>{var q;(q=b.tableMeta)!=null&&q.title&&(V.title=`${b.tableMeta.title}`),ct(()=>{var j;const _=(j=h.value)==null?void 0:j.$el;_&&(_.setSelectionRange(0,V.title.length),_.focus())})},{flush:"post"});const Y=async(q=!1,_)=>{if(b.tableMeta&&(V.title&&(V.title=V.title.trim()),!(V.title===b.tableMeta.title&&!_))){m.value=!0;try{await w.dbTable.update(b.tableMeta.id,{base_id:b.tableMeta.base_id,table_name:V.title,title:V.title}),P.value=!1,await y(b.tableMeta.base_id,!0),q||c({redo:{fn:B=>{V.title=B,Y(!0,!0)},args:[V.title]},undo:{fn:B=>{V.title=B,Y(!0,!0)},args:[b.tableMeta.title]},scope:d({model:b.tableMeta})}),await D(),U.value=U.value.map(B=>(B.tableID===b.tableMeta.id&&(B.isDefault&&(B.viewName=V.title),B.tableName=V.title),B));const j=await w.dbTable.read(b.tableMeta.id);await T(j),O({id:b.tableMeta.id},{title:j.title}),$(),i("a:table:rename"),P.value=!1}catch(j){me.error(await Ne(j))}m.value=!1}};return(q,_)=>{const j=Fe,B=ka,F=$a,ee=Ft,ue=Be,he=na;return t(),p(he,{visible:e(P),"onUpdate:visible":_[4]||(_[4]=W=>le(P)?P.value=W:null),size:"small","show-separator":!1},{header:o(()=>[u("div",nn,[s(j,{icon:"rename"}),A(" "+x(q.$t("activity.renameTable")),1)])]),default:o(()=>{var W;return[u("div",ln,[s(ee,{model:e(V),name:"create-new-table-form"},{default:o(()=>[s(F,Is(Ts(e(G).title)),{default:o(()=>[s(B,{ref_key:"inputEl",ref:h,value:e(V).title,"onUpdate:value":_[0]||(_[0]=H=>e(V).title=H),class:"nc-input-sm nc-input-shadow","hide-details":"",size:"small",placeholder:q.$t("msg.info.enterTableName"),onKeydown:_[1]||(_[1]=pt(()=>Y(),["enter"]))},null,8,["value","placeholder"])]),_:1},16)]),_:1},8,["model"]),u("div",rn,[s(ue,{type:"secondary",size:"small",onClick:_[2]||(_[2]=H=>P.value=!1)},{default:o(()=>[A(x(q.$t("general.cancel")),1)]),_:1}),s(ue,{key:"submit",type:"primary",size:"small",disabled:e(G).title.validateStatus==="error"||((W=e(V).title)==null?void 0:W.trim())===q.tableMeta.title,label:"Rename Table","loading-label":"Renaming Table",loading:e(m),onClick:_[3]||(_[3]=()=>Y())},{loading:o(()=>[A(x(q.$t("title.renamingTable")),1)]),default:o(()=>[A(x(q.$t("title.renameTable"))+" ",1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),dn={class:"mt-5"},un={class:"prose-md self-center text-gray-500 mt-4"},pn={class:"text-xs p-2"},mn={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},fn=ce({__name:"TableDuplicate",props:{modelValue:{type:Boolean},table:{}},emits:["update:modelValue"],setup(b,{emit:S}){const r=b,l=S,{api:i}=Kt(),w=et(r,"modelValue",l),{addTab:T}=Mt(),{$e:P,$poller:O}=Le();st();const{openTable:y}=Ce(),a=qe(),{loadTables:D}=a,{tables:C}=ae(a),{getMeta:k}=yt(),{t:f}=ea();ae(Ce());const{refreshCommandPalette:L}=ot(),n=I({includeData:!0,includeViews:!0,includeHooks:!0}),U=se(()=>{const{includeData:h,includeViews:m,includeHooks:R}=n.value;return{excludeData:!h,excludeViews:!m,excludeHooks:!R}}),$=I(!1),c=async()=>{try{$.value=!0;const h=await i.dbTable.duplicate(r.table.base_id,r.table.id,{options:U.value});O.subscribe({id:h.id},async m=>{var R;if(m.status!=="close")if(m.status===St.COMPLETED){const V=await k(r.table.id);if(V){for(const G of V.columns||[])if([pa.Links,pa.LinkToAnotherRecord].includes(G.uidt)&&G&&G.colOptions){const Y=(R=G.colOptions)==null?void 0:R.fk_related_model_id;Y&&await k(Y,!0)}}await D(),L();const z=C.value.find(G=>{var Y,q;return G.id===((q=(Y=m==null?void 0:m.data)==null?void 0:Y.result)==null?void 0:q.id)});z&&T({title:z.title,id:z.id,type:z.type}),y(z),$.value=!1,w.value=!1}else m.status===St.FAILED&&(me.error(f("msg.error.failedToDuplicateTable")),await D(),$.value=!1,w.value=!1)}),P("a:table:duplicate")}catch(h){me.error(await Ne(h)),$.value=!1,w.value=!1}};aa("Enter",()=>{w.value&&c()});const d=I(!1);return(h,m)=>{const R=Ia,V=ha,z=Be,G=Pt,Y=Ge("e");return t(),p(G,{visible:e(w),"onUpdate:visible":m[5]||(m[5]=q=>le(w)?w.value=q:null),class:te([{active:e(w)},"!w-[30rem]"]),"mask-closable":!e($),keyboard:!e($),centered:"","wrap-class-name":"nc-modal-table-duplicate",footer:null,onKeydown:m[6]||(m[6]=pt(q=>w.value=!1,["esc"]))},{default:o(()=>[u("div",null,[u("div",{class:"font-medium text-lg text-gray-800 self-center",onDblclick:m[0]||(m[0]=q=>d.value=!e(d))},x(h.$t("general.duplicate"))+" "+x(h.$t("objects.table")),33),u("div",dn,x(h.$t("msg.warning.duplicateTable")),1),u("div",un,x(h.$t("title.advancedSettings")),1),s(R,{class:"!m-0 !p-0 !my-2"}),u("div",pn,[s(V,{checked:e(n).includeData,"onUpdate:checked":m[1]||(m[1]=q=>e(n).includeData=q),disabled:e($)},{default:o(()=>[A(x(h.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"]),s(V,{checked:e(n).includeViews,"onUpdate:checked":m[2]||(m[2]=q=>e(n).includeViews=q),disabled:e($)},{default:o(()=>[A(x(h.$t("labels.includeView")),1)]),_:1},8,["checked","disabled"]),Z(s(V,{checked:e(n).includeHooks,"onUpdate:checked":m[3]||(m[3]=q=>e(n).includeHooks=q),disabled:e($)},{default:o(()=>[A(x(h.$t("labels.includeWebhook")),1)]),_:1},8,["checked","disabled"]),[[ss,e(d)]])])]),u("div",mn,[e($)?E("",!0):(t(),p(z,{key:"back",type:"secondary",size:"small",onClick:m[4]||(m[4]=q=>w.value=!1)},{default:o(()=>[A(x(h.$t("general.cancel")),1)]),_:1})),Z((t(),p(z,{key:"submit",type:"primary",size:"small",loading:e($),onClick:c},{default:o(()=>[A(x(h.$t("general.confirm")),1)]),_:1},8,["loading"])),[[Y,["a:table:duplicate"]]])])]),_:1},8,["visible","class","mask-closable","keyboard"])}}}),vn={class:"h-[80vh]"},bn=ce({__name:"ProjectErd",props:{baseId:{},sourceId:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(b,{emit:S}){const r=b,i=et(r,"modelValue",S),w=se(()=>r.sourceId),{openedProject:T}=ae(st()),{baseTables:P}=ae(Ce()),{loadProjectTables:O}=Ce(),y=I(!0),{getMeta:a}=yt(),D=se(()=>{var C;return r.baseId||((C=T.value)==null?void 0:C.id)});return jt(async()=>{if(D.value&&P.value.get(D.value))return y.value=!1;try{await O(D.value),await Promise.all(P.value.get(D.value).map(async C=>{await a(C.id,!1,!1,D.value)}))}catch(C){console.error(C)}finally{y.value=!1}}),(C,k)=>{const f=uo,L=Pt;return t(),p(L,{visible:e(i),"onUpdate:visible":k[0]||(k[0]=n=>le(i)?i.value=n:null),size:"large"},{default:o(()=>[u("div",vn,[e(y)?E("",!0):(t(),p(f,{key:0,"source-id":e(w),"base-id":e(D),"show-all-columns":!1},null,8,["source-id","base-id"]))])]),_:1},8,["visible"])}}}),_n={class:"p-6 h-full"},yn=ce({__name:"ProjectAudit",props:{workspaceId:{},baseId:{},sourceId:{},modelValue:{type:Boolean},bordered:{type:Boolean}},emits:["update:modelValue"],setup(b,{emit:S}){const r=b,i=et(r,"modelValue",S),{workspaceId:w,sourceId:T,bordered:P}=Ds(r),{openedProject:O}=ae(st()),{baseTables:y}=ae(Ce()),{loadProjectTables:a}=Ce(),D=I(!0),{getMeta:C}=yt(),k=se(()=>{var f;return r.baseId||((f=O.value)==null?void 0:f.id)});return jt(async()=>{if(k.value&&y.value.get(k.value))return D.value=!1;try{await a(k.value),await Promise.all(y.value.get(k.value).map(async f=>{await C(f.id,!1,!1,k.value)}))}catch(f){me.error("Failed to load tables/bases. Please try again later."),console.error(f)}finally{D.value=!1}}),(f,L)=>{const n=po,U=Pt;return t(),p(U,{visible:e(i),"onUpdate:visible":L[0]||(L[0]=$=>le(i)?i.value=$:null),size:"xl",class:"!top-[5vh] lg:!max-w-[calc(100vw_-_64px)]",width:"96.95rem"},{default:o(()=>[u("div",_n,[e(D)?E("",!0):(t(),p(n,{key:0,"workspace-id":e(w),"source-id":e(T),"base-id":e(k),bordered:e(P)},null,8,["workspace-id","source-id","base-id","bordered"]))])]),_:1},8,["visible"])}}}),gn={class:"flex gap-2 items-center"},wn={class:"ml-0.5"},xn={class:"flex gap-2 items-center"},kn={class:"flex gap-2 items-center"},$n={class:"flex gap-2 items-center"},hn=ce({__name:"BaseOptions",props:{source:{},base:{}},setup(b){const S=b,r=at(S,"source"),l=at(S,"base"),{isUIAllowed:i}=He(),w=se(()=>l.value.project_role||l.value.workspace_role),{$e:T}=Le();function P(y,a){if(!y||!a)return;T("a:actions:import-airtable");const D=I(!0),{close:C}=ze(fo,{modelValue:D,baseId:y,sourceId:a,"onUpdate:modelValue":k});function k(){D.value=!1,C(1e3)}}function O(y){var k;if(!((k=r.value)!=null&&k.id)||!r.value.base_id)return;T(`a:actions:import-${y}`);const a=I(!0),{close:D}=ze(vo,{modelValue:a,importType:y,baseId:r.value.base_id,sourceId:r.value.id,"onUpdate:modelValue":C});function C(){a.value=!1,D(1e3)}}return(y,a)=>{const D=Fe,C=Ht,k=bo,f=Ge("e");return t(),p(k,{class:"py-0","data-testid":"nc-sidebar-base-import"},{title:o(()=>[s(D,{icon:"download"}),A(" "+x(y.$t("labels.importData")),1)]),expandIcon:o(()=>a[4]||(a[4]=[])),default:o(()=>[e(i)("airtableImport",{roles:e(w),source:e(r)})?(t(),p(C,{key:"quick-import-airtable",onClick:a[0]||(a[0]=L=>P(e(r).base_id,e(r).id))},{default:o(()=>[Z((t(),M("div",gn,[s(D,{icon:"airtable",class:"max-w-3.75 group-hover:text-black"}),u("div",wn,x(y.$t("labels.airtable")),1)])),[[f,["c:import:airtable"]]])]),_:1})):E("",!0),e(i)("csvImport",{roles:e(w),source:e(r)})?(t(),p(C,{key:"quick-import-csv",onClick:a[1]||(a[1]=L=>O("csv"))},{default:o(()=>[Z((t(),M("div",xn,[s(D,{icon:"csv",class:"w-4 group-hover:text-black"}),A(" "+x(y.$t("labels.csvFile")),1)])),[[f,["c:import:csv"]]])]),_:1})):E("",!0),e(i)("jsonImport",{roles:e(w),source:e(r)})?(t(),p(C,{key:"quick-import-json",onClick:a[2]||(a[2]=L=>O("json"))},{default:o(()=>[Z((t(),M("div",kn,[s(D,{icon:"code",class:"w-4 group-hover:text-black"}),A(" "+x(y.$t("labels.jsonFile")),1)])),[[f,["c:import:json"]]])]),_:1})):E("",!0),e(i)("excelImport",{roles:e(w),source:e(r)})?(t(),p(C,{key:"quick-import-excel",onClick:a[3]||(a[3]=L=>O("excel"))},{default:o(()=>[Z((t(),M("div",$n,[s(D,{icon:"excel",class:"max-w-4 group-hover:text-black"}),A(" "+x(y.$t("labels.microsoftExcel")),1)])),[[f,["c:import:excel"]]])]),_:1})):E("",!0)]),_:1})}}}),In={key:0,class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700"},Tn={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},vs=ce({__name:"TableDelete",props:{visible:{type:Boolean},tableId:{},baseId:{}},emits:["update:visible"],setup(b,{emit:S}){const r=b,i=et(r,"visible",S),{$e:w,$api:T}=Le(),{closeTab:P}=Mt(),{getMeta:O,removeMeta:y}=yt(),{loadTables:a,baseUrl:D,isXcdbBase:C}=qe(),{refreshCommandPalette:k}=ot(),{removeFromRecentViews:f}=Ze(),{baseTables:L,activeTable:n}=ae(Ce()),{openTable:U}=Ce(),$=se(()=>L.value.get(r.baseId)??[]),c=se(()=>$.value.find(m=>m.id===r.tableId)),d=I(!1),h=async()=>{var V,z;if(!c.value)return;const m=JSON.parse(JSON.stringify(c.value)),R=(V=n.value)==null?void 0:V.id;d.value=!0;try{const G=await O(m.id,!0),Y=(z=G==null?void 0:G.columns)==null?void 0:z.filter(_=>_.uidt===pa.LinkToAnotherRecord&&!Cs(_));if(Y!=null&&Y.length&&!C(m.source_id)){const _=await Promise.all(Y.map(async(j,B)=>{var ee;const F=await O((ee=j==null?void 0:j.colOptions)==null?void 0:ee.fk_related_model_id);return`${B+1}. ${j.title} is a LinkToAnotherRecord of ${F&&F.title||j.title}`}));me.info(Ee("div",{innerHTML:`<div style="padding:10px 4px">Unable to delete tables because of the following.
              <br><br>${_.join("<br>")}<br><br>
              Delete them & try again</div>`}));return}if(await T.dbTable.delete(m.id),await P({type:Ss.TABLE,id:m.id,title:m.title}),await a(),f({baseId:r.baseId,tableId:m.id}),y(m.id),k(),w("a:table:delete"),R===m.id){const _=$.value.filter(j=>j.source_id===m.source_id);_.length===0?await Xt(D({id:r.baseId,type:"database"})):await U(_[0])}const q=$.value.findIndex(_=>_.id===m.id);q>-1&&$.value.splice(q,1),i.value=!1}catch(G){me.error(await Ne(G))}finally{d.value=!1}};return(m,R)=>{const V=_o,z=ps;return t(),p(z,{visible:e(i),"onUpdate:visible":R[0]||(R[0]=G=>le(i)?i.value=G:null),"entity-name":m.$t("objects.table"),"on-delete":h},{"entity-preview":o(()=>[e(c)?(t(),M("div",In,[s(V,{meta:e(c),class:"nc-view-icon"},null,8,["meta"]),u("div",Tn,x(e(c).title),1)])):E("",!0)]),_:1},8,["visible","entity-name"])}}}),Dn={class:"item","data-testid":"sidebar-view-create-grid"},Cn={class:"item-inner"},Sn={class:"item","data-testid":"sidebar-view-create-form"},Vn={class:"item-inner"},jn={class:"item","data-testid":"sidebar-view-create-gallery"},Mn={class:"item-inner"},Pn={class:"item"},En={class:"item-inner"},Nn={class:"item"},Ln={class:"item-inner"},On=ce({__name:"CreateViewBtn",props:{alignLeftLevel:{},source:{}},setup(b){const S=b,{$e:r}=Le(),l=at(S,"alignLeftLevel"),{refreshCommandPalette:i}=ot(),w=Ze(),{loadViews:T,navigateToView:P}=w,O=We(ya),y=We(Wt),a=I(!1),D=I(),C=I(!1),k=se(()=>l.value===1?"nc-view-create-dropdown nc-view-create-dropdown-left-1":l.value===2?"nc-view-create-dropdown nc-view-create-dropdown-left-2":"nc-view-create-dropdown");async function f({title:L="",type:n,copyViewId:U,groupingFieldColumnId:$,calendarRange:c,coverImageColumnId:d}){if(a.value)return;D.value=n,a.value=!0,await T({tableId:O.value.id}),C.value=!1,a.value=!1;const h=I(!0),{close:m}=ze(ms,{modelValue:h,title:L,type:n,tableId:O.value.id,selectedViewId:U,calendarRange:c,groupingFieldColumnId:$,coverImageColumnId:d,"onUpdate:modelValue":R,onCreated:async V=>{R(),i(),await T({tableId:O.value.id,force:!0}),O.value.meta={...O.value.meta,hasNonDefaultViews:!0},P({view:V,tableId:O.value.id,baseId:y.value.id,doNotSwitchTab:!0}),r("a:view:create",{view:V.type})}});function R(){C.value=!1,h.value=!1,m(1e3)}}return(L,n)=>{const U=os,$=ga,c=Fe,d=Ht,h=la,m=qt;return t(),p(m,{visible:e(C),"onUpdate:visible":n[5]||(n[5]=R=>le(C)?C.value=R:null),"overlay-class-name":e(k),"destroy-popup-on-hide":"",onClick:n[6]||(n[6]=ve(R=>C.value=!0,["stop"]))},{overlay:o(()=>[s(h,{class:"max-w-48"},{default:o(()=>[s(d,{onClick:n[0]||(n[0]=ve(R=>f({type:e($e).GRID}),["stop"]))},{default:o(()=>[u("div",Dn,[u("div",Cn,[s(U,{meta:{type:e($e).GRID}},null,8,["meta"]),n[7]||(n[7]=u("div",null,"Grid",-1))]),e(D)===e($e).GRID&&e(a)?(t(),p($,{key:0})):(t(),p(c,{key:1,class:"plus",icon:"plus"}))])]),_:1}),L.source.is_data_readonly?E("",!0):(t(),p(d,{key:0,onClick:n[1]||(n[1]=R=>f({type:e($e).FORM}))},{default:o(()=>[u("div",Sn,[u("div",Vn,[s(U,{meta:{type:e($e).FORM}},null,8,["meta"]),n[8]||(n[8]=u("div",null,"Form",-1))]),e(D)===e($e).FORM&&e(a)?(t(),p($,{key:0})):(t(),p(c,{key:1,class:"plus",icon:"plus"}))])]),_:1})),s(d,{onClick:n[2]||(n[2]=R=>f({type:e($e).GALLERY}))},{default:o(()=>[u("div",jn,[u("div",Mn,[s(U,{meta:{type:e($e).GALLERY}},null,8,["meta"]),n[9]||(n[9]=u("div",null,"Gallery",-1))]),e(D)===e($e).GALLERY&&e(a)?(t(),p($,{key:0})):(t(),p(c,{key:1,class:"plus",icon:"plus"}))])]),_:1}),s(d,{"data-testid":"sidebar-view-create-kanban",onClick:n[3]||(n[3]=R=>f({type:e($e).KANBAN}))},{default:o(()=>[u("div",Pn,[u("div",En,[s(U,{meta:{type:e($e).KANBAN}},null,8,["meta"]),n[10]||(n[10]=u("div",null,"Kanban",-1))]),e(D)===e($e).KANBAN&&e(a)?(t(),p($,{key:0})):(t(),p(c,{key:1,class:"plus",icon:"plus"}))])]),_:1}),s(d,{"data-testid":"sidebar-view-create-calendar",onClick:n[4]||(n[4]=R=>f({type:e($e).CALENDAR}))},{default:o(()=>[u("div",Nn,[u("div",Ln,[s(U,{meta:{type:e($e).CALENDAR},class:"!w-4 !h-4"},null,8,["meta"]),u("div",null,x(L.$t("objects.viewType.calendar")),1)]),e(D)===e($e).CALENDAR&&e(a)?(t(),p($,{key:0})):(t(),p(c,{key:1,class:"plus",icon:"plus"}))])]),_:1})]),_:1})]),default:o(()=>[fa(L.$slots,"default",{},void 0,!0)]),_:3},8,["visible","overlay-class-name"])}}}),Un=Ue(On,[["__scopeId","data-v-801c27c0"]]),bs=b=>b.is_meta,Bn=gt(()=>wt(()=>import("./BaG7jRBy.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(b=>b.default||b)),Rn={class:"text-sm flex items-center w-full gap-1","data-testid":"view-item"},An=["data-testid"],zn=ce({__name:"ViewsNode",props:{view:{},table:{},onValidate:{type:Function}},emits:["update:view","selectIcon","changeView","rename","delete","openModal"],setup(b,{emit:S}){const r=b,l=S,i=et(r,"view",l),{$e:w}=Le(),{isMobileMode:T}=De(),{isUIAllowed:P}=He(),O=We(Wt,I()),{activeView:y}=ae(Ze()),{getMeta:a}=yt(),{meta:D,control:C}=ta(),k=se(()=>r.table),f=I(k.value);_t(Vs,i),_t(js,f);const L=We(Ms,I(!1)),n=se(()=>{var H,Oe,Ke,Ie;if(((Oe=(H=O.value)==null?void 0:H.sources)==null?void 0:Oe.length)===1)return!0;const W=(Ie=(Ke=O.value)==null?void 0:Ke.sources)==null?void 0:Ie.find(N=>N.id===i.value.source_id);return W?bs(W):!1}),{openViewDescriptionDialog:U}=We(sa),$=I(),c=I(!1),d=I(!1),h=I(!1),m=I(),R=Es(()=>{l("changeView",i.value)},250),V=()=>{if(d.value||h.value)return;(Ct()?D.value:C.value)?l("changeView",i.value):R()},z=()=>{setTimeout(()=>{var W,H;(W=$.value)==null||W.focus(),(H=$.value)==null||H.select()})};function G(){var W;T.value||P("viewCreateOrEdit")&&(d.value||(d.value=!0,m.value=i.value.title,w("c:view:rename",{view:(W=i.value)==null?void 0:W.type}),ct(()=>{z()})))}function Y(W){W.key==="Escape"?_(W):W.key==="Enter"&&q(W)}function q(W){W.stopImmediatePropagation(),W.preventDefault(),B()}function _(W){W.stopImmediatePropagation(),W.preventDefault(),ee()}aa("Enter",W=>{d.value&&q(W)});const j=()=>{var W;T.value||!P("viewCreateOrEdit")||d.value||(d.value=!0,m.value=i.value.title,w("c:view:rename",{view:(W=i.value)==null?void 0:W.type}),ct(()=>{z()}))};async function B(){if(c.value=!1,!d.value)return;m.value&&(m.value=m.value.trim());const W=r.onValidate({...i.value,title:m.value});if(W!==!0){me.error(W),ee();return}if(i.value.title===""||i.value.title===m.value){ee();return}const H=i.value.title;i.value.title=m.value||"",l("rename",i.value,H),ue()}const F=W=>{c.value=!1,U(W)};function ee(){d.value&&ue()}function ue(){h.value=!0,d.value=!1,m.value="",setTimeout(()=>{h.value=!1},250)}const he=()=>{c.value=!1,l("delete",i.value)};return Xe(c,async()=>{c.value&&(f.value=await a(k.value.id))}),(W,H)=>{const Oe=os,Ke=Bn,Ie=ka,N=Vt,X=Fe,ne=Be,oe=lo,_e=qt,we=Ps,re=Ge("e");return t(),p(we,{class:te(["nc-sidebar-node !min-h-7 !max-h-7 !my-0.5 select-none group text-gray-700 !flex !items-center !hover:bg-gray-200 !hover:text-gray-700 cursor-pointer",{"!pl-13.5 !xs:pl-12":e(n),"!pl-19 ":!e(n)}]),"data-testid":`view-sidebar-view-${e(i).alias||e(i).title}`,onDblclick:ve(G,["stop"]),onClick:ve(V,["prevent"])},{default:o(()=>{var be,xe,ke,Re;return[Z((t(),M("div",Rn,[Z((t(),M("div",{class:"flex min-w-6","data-testid":`view-sidebar-drag-handle-${e(i).alias||e(i).title}`},[s(Ke,{class:"nc-table-icon",emoji:(xe=(be=r.view)==null?void 0:be.meta)==null?void 0:xe.icon,size:"small",clearable:!0,readonly:e(T)||!e(P)("viewCreateOrEdit"),onEmojiSelected:H[0]||(H[0]=ye=>l("selectIcon",ye))},{default:o(()=>[s(Oe,{meta:r.view,class:"nc-view-icon w-4 !text-[16px]"},null,8,["meta"])]),_:1},8,["emoji","readonly"])],8,An)),[[re,["c:view:emoji-picker"]]]),e(d)?(t(),p(Ie,{key:0,ref_key:"input",ref:$,value:e(m),"onUpdate:value":H[1]||(H[1]=ye=>le(m)?m.value=ye:null),class:te(["!bg-transparent !border-0 !ring-0 !outline-transparent !border-transparent !pl-0 !flex-1 mr-4",{"font-medium !text-brand-600":((ke=e(y))==null?void 0:ke.id)===e(i).id}]),onBlur:B,onKeydown:H[2]||(H[2]=ve(ye=>Y(ye),["stop"]))},null,8,["value","class"])):(t(),p(N,{key:1,class:"nc-sidebar-node-title text-ellipsis overflow-hidden select-none w-full","show-on-truncate-only":""},{title:o(()=>[A(x(e(i).alias||e(i).title),1)]),default:o(()=>{var ye;return[u("div",{"data-testid":"sidebar-view-title",class:te({"font-medium text-brand-600":((ye=e(y))==null?void 0:ye.id)===e(i).id}),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},x(e(i).alias||e(i).title),3)]}),_:1})),!e(d)&&!e(L)?(t(),M(ge,{key:2},[(Re=e(i).description)!=null&&Re.length?(t(),p(N,{key:0,placement:"bottom"},{title:o(()=>[A(x(e(i).description),1)]),default:o(()=>[s(ne,{type:"text",class:"!hover:bg-transparent",size:"xsmall"},{default:o(()=>[s(X,{icon:"info",class:"!w-3.5 !h-3.5 nc-info-icon group-hover:opacity-100 text-gray-600 opacity-0"})]),_:1})]),_:1})):E("",!0),s(_e,{visible:e(c),"onUpdate:visible":H[7]||(H[7]=ye=>le(c)?c.value=ye:null),"overlay-class-name":"!rounded-lg"},{overlay:o(()=>[s(oe,{"data-testid":`view-sidebar-view-actions-${e(i).alias||e(i).title}`,view:e(i),table:e(k),"in-sidebar":"",onCloseModal:H[5]||(H[5]=ye=>c.value=!1),onRename:j,onDelete:he,onDescriptionUpdate:H[6]||(H[6]=ye=>F(e(i)))},null,8,["data-testid","view","table"])]),default:o(()=>[Z((t(),p(ne,{type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn invisible !group-hover:visible !group-hover:opacity-100 nc-sidebar-view-node-context-btn",{"!visible !opacity-100":e(c)}]),onClick:H[3]||(H[3]=ve(ye=>c.value=!e(c),["stop"])),onDblclick:H[4]||(H[4]=ve(()=>{},["stop"]))},{default:o(()=>[s(X,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:1},8,["class"])),[[re,["c:view:option"]]])]),_:1},8,["visible"])],64)):E("",!0)])),[[re,["a:view:open",{view:e(i).type}]]])]}),_:1},8,["class","data-testid"])}}}),Gn={class:"flex flex-row items-center pl-1.25 !py-1.5 text-inherit"},Fn={class:"pl-1.75"},Kn=ce({__name:"ViewsList",emits:["openModal","deleted"],setup(b,{emit:S}){const r=S,l=We(Wt),i=We(ya),{isLeftSidebarOpen:w}=ae(oa()),{activeTableId:T}=ae(Ce()),{isUIAllowed:P}=He(),{isMobileMode:O}=De(),{isSharedBase:y}=ae(qe()),{$e:a}=Le(),{t:D}=ea(),{viewsByTable:C,activeView:k,allRecentViews:f}=ae(Ze()),{navigateToTable:L}=Ce(),n=se(()=>{var N;return((N=C.value.get(i.value.id))==null?void 0:N.filter(X=>!X.is_default))??[]}),{api:U}=Kt(),{refreshCommandPalette:$}=ot(),{addUndo:c,defineModelScope:d}=va(),{navigateToView:h,loadViews:m,removeFromRecentViews:R}=Ze(),V=I([]),z=I(!1),G=I(),Y=I(!1);Xe(k,N=>{N&&N.id&&(V.value=[N.id])});function q(N){Y.value=N,setTimeout(()=>{Y.value=!1},300)}const _=se(()=>{var N,X;return(X=(N=l.value)==null?void 0:N.sources)==null?void 0:X.find(ne=>ne.id===i.value.source_id)}),j=se(()=>{var N,X;return((X=(N=l.value)==null?void 0:N.sources)==null?void 0:X.length)===1?!0:_.value?bs(_.value):!1});function B(N){return!N.title||N.title.trim().length<0?D("msg.error.viewNameRequired"):n.value.some(X=>X.title===N.title&&X.id!==N.id)?D("msg.error.viewNameDuplicate"):!0}let F;function ee(N){N.stopImmediatePropagation(),N.preventDefault(),z.value=!0}async function ue(N,X=!1){if(X||(N.stopImmediatePropagation(),N.preventDefault(),z.value=!1),n.value.length<2)return;let{newIndex:ne=0,oldIndex:oe=0}=N;if(ne=ne-1,oe=oe-1,ne===oe)return;X||c({redo:{fn:async()=>{const pe=F.toArray(),K=pe.splice(oe,1);pe.splice(ne,0,K[0]),F.sort(pe),await ue(N,!0)},args:[]},undo:{fn:async()=>{const pe=F.toArray(),K=pe.splice(ne,1);pe.splice(oe,0,K[0]),F.sort(pe),await ue({...N,oldIndex:ne,newIndex:oe},!0)},args:[]},scope:d({view:k.value})});const _e=Array.from(N.to.children);_e.shift();const we=_e[ne-1],re=_e[ne+1],be=n.value.find(pe=>pe.id===N.item.id);if(!be||!be.id)return;const xe=we?n.value.find(pe=>pe.id===we.id)??{order:0}:{order:0},ke=re?n.value.find(pe=>pe.id===re.id):{};let Re;n.value.length-1===ne?Re=parseFloat(String(xe.order))+1:ne===0?Re=parseFloat(String(ke.order))/2:Re=(parseFloat(String(xe.order))+parseFloat(String(ke.order)))/2;const ye=isNaN(Number(Re))?oe:Re;be.order=ye,await U.dbView.update(be.id,{order:ye}),q(be.id),a("a:view:reorder")}const he=N=>{F&&F.destroy(),!O.value&&(F=new us(N,{ghostClass:"ghost",onStart:ee,onEnd:ue}))};jt(()=>G.value&&P("viewCreateOrEdit")&&he(G.value.$el));async function W(N){await h({view:N,tableId:i.value.id,baseId:l.value.id,hardReload:N.type===$e.FORM&&V.value[0]===N.id,doNotSwitchTab:!0}),O.value&&(w.value=!1)}async function H(N,X,ne=!1){try{await U.dbView.update(N.id,{title:N.title,order:N.order}),h({view:N,tableId:i.value.id,baseId:l.value.id,hardReload:N.type===$e.FORM&&V.value[0]===N.id}),$(),ne||c({redo:{fn:(oe,_e)=>{const we=oe.title;oe.title=_e,H(oe,we,!0)},args:[N,N.title]},undo:{fn:(oe,_e)=>{const we=oe.title;oe.title=_e,H(oe,we,!0)},args:[N,X]},scope:d({view:k.value})}),f.value=f.value.map(oe=>(oe.viewId===N.id&&oe.tableID===N.fk_model_id&&(oe.viewName=N.title),oe))}catch(oe){me.error(await Ne(oe))}}function Oe(N){const X=I(!0),{close:ne}=ze(io,{modelValue:X,view:N,"onUpdate:modelValue":oe,onDeleted:async()=>{var we,re;oe(),r("deleted"),R({viewId:N.id,tableId:N.fk_model_id,baseId:l.value.id}),$(),((we=k.value)==null?void 0:we.id)===N.id&&L({tableId:i.value.id,baseId:l.value.id}),await m({tableId:i.value.id,force:!0});const _e=((re=C.value.get(i.value.id))==null?void 0:re.filter(be=>!be.is_default))??[];i.value.meta={...i.value.meta,hasNonDefaultViews:_e.length>1}}});function oe(){X.value=!1,ne(1e3)}}const Ke=async(N,X)=>{try{X.meta={...Tt(X.meta),icon:N},U.dbView.update(X.id,{meta:X.meta}),a("a:view:icon:sidebar",{icon:N})}catch(ne){me.error(await Ne(ne))}};function Ie({title:N="",type:X,copyViewId:ne,groupingFieldColumnId:oe,calendarRange:_e,coverImageColumnId:we}){const re=I(!0),{close:be}=ze(ms,{modelValue:re,title:N,type:X,tableId:i.value.id,selectedViewId:ne,groupingFieldColumnId:oe,views:n,calendarRange:_e,coverImageColumnId:we,"onUpdate:modelValue":xe,onCreated:async ke=>{xe(),$(),await m({force:!0,tableId:i.value.id}),h({view:ke,tableId:i.value.id,baseId:l.value.id,hardReload:ke.type===$e.FORM&&V.value[0]===ke.id}),a("a:view:create",{view:ke.type})}});function xe(){re.value=!1,be(1e3)}}return(N,X)=>{const ne=Fe,oe=Un,_e=zn,we=Ls;return t(),p(we,{ref_key:"menuRef",ref:G,class:te([{dragging:e(z)},"nc-views-menu flex flex-col w-full !border-r-0 !bg-inherit"]),"selected-keys":e(V)},{default:o(()=>[e(y)?E("",!0):(t(),M(ge,{key:0},[e(P)("viewCreateOrEdit")?(t(),p(oe,{key:0,"align-left-level":e(j)?1:2,class:te({"!pl-13.3 !xs:pl-13.5":e(j),"!pl-18.6 !xs:pl-20":!e(j)}),source:e(_)},{default:o(()=>[u("div",{class:te([{"text-brand-500 hover:text-brand-600":e(T)===e(i).id,"text-gray-500 hover:text-brand-500":e(T)!==e(i).id},"nc-create-view-btn flex flex-row items-center cursor-pointer rounded-md w-full"]),role:"button"},[u("div",Gn,[s(ne,{icon:"plus"}),u("div",Fn,x(N.$t("general.createEntity",{entity:N.$t("objects.view")})),1)])],2)]),_:1},8,["align-left-level","class","source"])):E("",!0)],64)),e(n).length?(t(!0),M(ge,{key:1},wa(e(n),re=>{var be;return t(),p(_e,{id:re.id,key:re.id,class:te([{"bg-gray-200":e(Y)===re.id,active:((be=e(k))==null?void 0:be.id)===re.id,[`nc-${re.type?("viewTypeAlias"in N?N.viewTypeAlias:e(Ns))[re.type]:re.type}-view-item`]:!0},"nc-view-item !rounded-md !px-0.75 !py-0.5 w-full transition-all ease-in duration-100"]),"data-view-id":re.id,"on-validate":B,table:e(i),view:re,onDelete:Oe,onRename:H,onChangeView:W,onOpenModal:Ie,onSelectIcon:xe=>Ke(xe,re)},null,8,["id","class","data-view-id","table","view","onSelectIcon"])}),128)):E("",!0)]),_:1},8,["class","selected-keys"])}}}),Wn={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Hn=u("path",{fill:"currentColor",d:"M12 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5a5 5 0 0 1 5-5a5 5 0 0 1 5 5a5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"},null,-1),qn=[Hn];function Jn(b,S){return t(),M("svg",Wn,[...qn])}const Yn={name:"mdi-eye",render:Jn},Qn=gt(()=>wt(()=>import("./BaG7jRBy.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(b=>b.default||b)),Zn=["data-order","data-id","data-table-id","data-active"],Xn={class:"flex items-center py-0.5"},el=["data-testid"],tl={class:"flex flex-row h-full items-center"},al=["data-testid"],sl=["data-testid"],ol={class:"flex items-center"},nl={class:"flex text-xs font-bold text-gray-500 ml-1"},ll={class:"flex gap-2 items-center"},il={class:"flex gap-2 items-center"},rl={class:"flex gap-2 items-center"},cl={class:"flex gap-2 items-center"},dl={class:"flex gap-2 items-center"},ul=ce({__name:"TableNode",props:{base:{},table:{},sourceIndex:{default:0}},setup(b){const S=b,r=at(S,"base"),l=at(S,"table"),i=at(S,"sourceIndex"),{openTable:w}=ts({baseId:r.value.id}),T=Os(),{isUIAllowed:P}=He(),{isMobileMode:O}=De(),y=Mt(),{updateTab:a}=y,{$e:D,$api:C}=Le();ts({baseId:r.value.id});const{meta:k,control:f}=ta(),{copy:L}=ns(),n=We(ls);_t(ya,l);const{setMenuContext:U,openRenameTableDialog:$,openTableDescriptionDialog:c,duplicateTable:d}=We(sa),{loadViews:h,navigateToView:m,duplicateView:R}=Ze(),{activeView:V,activeViewTitleOrId:z,viewsByTable:G}=ae(Ze()),{isLeftSidebarOpen:Y}=ae(oa()),{refreshCommandPalette:q}=ot(),{baseTables:_}=ae(Ce()),j=se(()=>_.value.get(r.value.id)??[]),B=se(()=>T.params.viewId),F=I(!1),ee=I(!1),ue=async(K,Q)=>{try{Q.meta={...Q.meta||{},icon:K},j.value.splice(j.value.indexOf(Q),1,{...Q}),a({id:Q.id},{meta:Q.meta}),await C.dbTable.update(Q.id,{meta:Q.meta}),D("a:table:icon:navdraw",{icon:K})}catch(Se){me.error(await Ne(Se))}},{isSharedBase:he}=qe(),W=se(()=>P("tableIconEdit",{roles:n==null?void 0:n.value})),H=I(!1),Oe=I(!1),Ke=I(!1),Ie=async()=>{if(H.value){H.value=!1;return}Oe.value=!0;try{await h({tableId:l.value.id,ignoreLoading:!0})}catch(K){me.error(await Ne(K))}finally{Oe.value=!1,H.value=!0}},N=async()=>{if(Ct()?k.value:f.value){await w(l.value,!0);return}Oe.value=!0;try{await w(l.value),O.value&&(Y.value=!1)}catch(K){me.error(await Ne(K))}finally{Oe.value=!1,H.value=!0}};let X;const ne=async()=>{X&&clearTimeout(X);try{await L(l.value.id),Ke.value=!0,X=setTimeout(()=>{Ke.value=!1,clearTimeout(X)},5e3)}catch(K){me.error(K.message)}};Xe(()=>{var K;return(K=V.value)==null?void 0:K.id},()=>{var K,Q;V.value&&((K=V.value)==null?void 0:K.fk_model_id)===((Q=l.value)==null?void 0:Q.id)&&(H.value=!0)},{immediate:!0});const oe=se(()=>{var K,Q;return B.value===((K=l.value)==null?void 0:K.id)&&(((Q=V.value)==null?void 0:Q.is_default)||!z.value)});let _e;Xe(B,()=>{var K;if(_e&&clearTimeout(_e),l.value.id!==B.value&&H.value){if((((K=G.value.get(l.value.id))==null?void 0:K.filter(Se=>!Se.is_default))??[]).length)return;_e=setTimeout(()=>{H.value&&(H.value=!1),clearTimeout(_e)},1e4)}});const we=K=>{ee.value=!1,d(K)},re=(K,Q)=>{ee.value=!1,$(K,!!Q)},be=K=>{ee.value=!1,c(K)},xe=()=>{ee.value=!1,F.value=!0},ke=I(!1);async function Re(){ke.value=!0,G.value.get(l.value.id)||await w(l.value,void 0,!1);const K=G.value.get(l.value.id),Q=(K==null?void 0:K.find(Se=>Se.is_default))||(K==null?void 0:K[0]);if(Q){const Se=await R(Q);q(),await h({force:!0,tableId:l.value.id}),Se&&(m({view:Se,tableId:l.value.id,baseId:r.value.id,hardReload:Se.type===$e.FORM}),D("a:view:create",{view:Se.type,sidebar:!0}))}ke.value=!1,ee.value=!1}const ye=async()=>{H.value=!1,await ct(),H.value=!0},pe=se(()=>{var K,Q;return(Q=(K=r.value)==null?void 0:K.sources)==null?void 0:Q[i.value]});return(K,Q)=>{var It,mt,Yt,ut,Qt;const Se=ga,ia=Yn,xt=Vt,Jt=Qn,Ve=Fe,kt=Be,Et=Bs,nt=Ht,$t=Ta,ht=la,Nt=qt,ra=vs,ca=Kn,Je=Ge("e");return t(),M("div",{class:te(["nc-tree-item nc-table-node-wrapper text-sm select-none w-full",[`nc-base-tree-tbl nc-base-tree-tbl-${(It=e(l).title)==null?void 0:It.replaceAll(" ","")}`]]),"data-order":e(l).order,"data-id":e(l).id,"data-table-id":e(l).id,"data-active":e(B)===e(l).id},[u("div",Xn,[Z((t(),M("div",{class:te(["flex-none flex-1 table-context flex items-center gap-1 h-full nc-tree-item-inner nc-sidebar-node pr-0.75 mb-0.25 rounded-md h-7 w-full group cursor-pointer hover:bg-gray-200",{"hover:bg-gray-200":e(B)!==e(l).id,"pl-13.5":e(i)!==0,"pl-7.5 xs:pl-6":e(i)===0,"!bg-primary-selected":e(oe)}]),"data-testid":`nc-tbl-side-node-${e(l).title}`,onContextmenu:Q[9]||(Q[9]=Ae=>e(U)("table",e(l))),onClick:N},[u("div",tl,[u("div",{class:"flex w-auto","data-testid":`tree-view-table-draggable-handle-${e(l).title}`},[e(l).isViewsLoading?(t(),p(Se,{key:0,class:"flex items-center w-6 h-full !text-gray-600"})):Z((t(),M("div",{key:1,class:te(["flex items-center nc-table-icon",{"pointer-events-none":!e(W)}]),onClick:Q[1]||(Q[1]=ve(()=>{},["stop"]))},[(t(),p(Jt,{key:(mt=e(l).meta)==null?void 0:mt.icon,emoji:(Yt=e(l).meta)==null?void 0:Yt.icon,size:"small",readonly:!e(W)||e(O),onEmojiSelected:Q[0]||(Q[0]=Ae=>ue(Ae,e(l)))},{default:o(()=>[s(xt,{class:"flex",placement:"topLeft","hide-on-click":"",disabled:!e(W)},{title:o(()=>[A(x(K.$t("general.changeIcon")),1)]),default:o(()=>[e(l).type==="table"?(t(),p(is(("iconMap"in K?K.iconMap:e(Us)).table),{key:0,class:te(["w-4 text-sm",e(oe)?"!text-brand-600/85":"!text-gray-600/75"])},null,8,["class"])):(t(),p(ia,{key:1,class:te(["flex w-5 text-sm",e(oe)?"!text-brand-600":"!text-gray-600"])},null,8,["class"]))]),_:1},8,["disabled"])]),_:1},8,["emoji","readonly"]))],2)),[[Je,["c:table:emoji-picker"]]])],8,al)]),s(xt,{class:"nc-tbl-title nc-sidebar-node-title text-ellipsis overflow-hidden select-none !flex-1","show-on-truncate-only":""},{title:o(()=>[A(x(e(l).title),1)]),default:o(()=>[u("span",{class:te(e(oe)?"text-brand-600 !font-medium":"text-gray-600"),"data-testid":`nc-tbl-title-${e(l).title}`,style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},x(e(l).title),11,sl)]),_:1}),u("div",ol,[(ut=e(l).description)!=null&&ut.length?(t(),p(xt,{key:0,placement:"bottom"},{title:o(()=>[A(x(e(l).description),1)]),default:o(()=>[s(kt,{type:"text",class:"!hover:bg-transparent",size:"xsmall"},{default:o(()=>[s(Ve,{icon:"info",class:"!w-3.5 !h-3.5 nc-info-icon group-hover:opacity-100 text-gray-600 opacity-0"})]),_:1})]),_:1})):E("",!0),s(Nt,{visible:e(ee),"onUpdate:visible":Q[7]||(Q[7]=Ae=>le(ee)?ee.value=Ae:null),trigger:["click"],onClick:Q[8]||(Q[8]=ve(()=>{},["stop"]))},{overlay:o(()=>[s(ht,{class:"!min-w-62.5","data-testid":`sidebar-table-context-menu-list-${e(l).title}`},{default:o(()=>{var Ae;return[s(xt,null,{title:o(()=>[A(x(K.$t("labels.clickToCopyTableID")),1)]),default:o(()=>{var g;return[u("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:ve(ne,["stop"])},[u("div",nl,x(K.$t("labels.tableIdColon",{tableId:(g=e(l))==null?void 0:g.id})),1),s(kt,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(Ke)?(t(),p(Ve,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(t(),p(Ve,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),e(P)("tableDescriptionEdit",{roles:e(n),source:e(pe)})&&!e(P)("tableRename",{roles:e(n),source:e(pe)})?(t(),p(nt,{key:0,"data-testid":`sidebar-table-description-${e(l).title}`,class:"nc-table-description",onClick:Q[3]||(Q[3]=g=>be(e(l)))},{default:o(()=>[Z((t(),M("div",ll,[s(Ve,{icon:"ncAlignLeft",class:"text-gray-700"}),A(" "+x(K.$t("labels.editDescription")),1)])),[[Je,["c:table:update-description"]]])]),_:1},8,["data-testid"])):E("",!0),!e(he)&&(e(P)("tableRename",{roles:e(n),source:e(pe)})||e(P)("tableDelete",{roles:e(n),source:e(pe)}))?(t(),M(ge,{key:1},[s($t),e(P)("tableRename",{roles:e(n),source:e(pe)})?(t(),p(nt,{key:0,"data-testid":`sidebar-table-rename-${e(l).title}`,class:"nc-table-rename",onClick:Q[4]||(Q[4]=g=>re(e(l),e(pe).id))},{default:o(()=>[Z((t(),M("div",il,[s(Ve,{icon:"rename",class:"text-gray-700"}),A(" "+x(K.$t("general.rename"))+" "+x(K.$t("objects.table").toLowerCase()),1)])),[[Je,["c:table:rename"]]])]),_:1},8,["data-testid"])):E("",!0),e(P)("tableDescriptionEdit",{roles:e(n),source:e(pe)})?(t(),p(nt,{key:1,"data-testid":`sidebar-table-description-${e(l).title}`,class:"nc-table-description",onClick:Q[5]||(Q[5]=g=>be(e(l)))},{default:o(()=>[Z((t(),M("div",rl,[s(Ve,{icon:"ncAlignLeft",class:"text-gray-700"}),A(" "+x(K.$t("labels.editDescription")),1)])),[[Je,["c:table:update-description"]]])]),_:1},8,["data-testid"])):E("",!0),e(P)("tableDuplicate",{source:e(pe)})&&((Ae=e(r).sources)!=null&&Ae[e(i)])&&(e(pe).is_meta||e(pe).is_local)?(t(),p(nt,{key:2,"data-testid":`sidebar-table-duplicate-${e(l).title}`,onClick:Q[6]||(Q[6]=g=>we(e(l)))},{default:o(()=>[Z((t(),M("div",cl,[s(Ve,{icon:"duplicate",class:"text-gray-700"}),A(" "+x(K.$t("general.duplicate"))+" "+x(K.$t("objects.table").toLowerCase()),1)])),[[Je,["c:table:duplicate"]]])]),_:1},8,["data-testid"])):E("",!0),s($t),s(nt,{class:"!text-gray-700",onClick:Re},{default:o(()=>[e(ke)?(t(),p(Se,{key:0,size:"regular"})):(t(),p(Ve,{key:1,class:"nc-view-copy-icon",icon:"duplicate"})),A(" "+x(K.$t("general.duplicateEntity",{entity:K.$t("title.defaultView").toLowerCase()})),1)]),_:1}),s($t),e(P)("tableDelete",{roles:e(n),source:e(pe)})?(t(),p(nt,{key:3,"data-testid":`sidebar-table-delete-${e(l).title}`,class:"!text-red-500 !hover:bg-red-50 nc-table-delete",onClick:xe},{default:o(()=>[Z((t(),M("div",dl,[s(Ve,{icon:"delete"}),A(" "+x(K.$t("general.delete"))+" "+x(K.$t("objects.table").toLowerCase()),1)])),[[Je,["c:table:delete"]]])]),_:1},8,["data-testid"])):E("",!0)],64)):E("",!0)]}),_:1},8,["data-testid"])]),default:o(()=>[Z((t(),p(kt,{class:te(["nc-sidebar-node-btn nc-tbl-context-menu text-gray-700 hover:text-gray-800",{"!opacity-100 !inline-block":e(ee)}]),"data-testid":"nc-sidebar-table-context-menu",type:"text",size:"xxsmall",onClick:Q[2]||(Q[2]=ve(()=>{},["stop"]))},{default:o(()=>[s(Et,{class:"!text-current"})]),_:1},8,["class"])),[[Je,["c:table:option"]]])]),_:1},8,["visible"]),Z((t(),p(kt,{type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn nc-sidebar-expand text-gray-700 hover:text-gray-800",{"!opacity-100 !visible":e(ee)}]),onClick:ve(Ie,["stop"])},{default:o(()=>[s(Ve,{icon:"chevronRight",class:te(["nc-sidebar-source-node-btns cursor-pointer transform transition-transform duration-200 !text-current text-[20px]",{"!rotate-90":e(H)}])},null,8,["class"])]),_:1},8,["class"])),[[Je,["c:table:toggle-expand"]]])])],42,el)),[[Je,["a:table:open"]]])]),e(l).id&&((Qt=e(r))!=null&&Qt.id)?(t(),p(ra,{key:0,visible:e(F),"onUpdate:visible":Q[10]||(Q[10]=Ae=>le(F)?F.value=Ae:null),"table-id":e(l).id,"base-id":e(r).id},null,8,["visible","table-id","base-id"])):E("",!0),e(H)?(t(),p(ca,{key:1,"table-id":e(l).id,"base-id":e(r).id,onDeleted:ye},null,8,["table-id","base-id"])):E("",!0)],10,Zn)}}}),pl=Ue(ul,[["__scopeId","data-v-b29107e1"]]),ml={class:"border-none sortable-list"},fl=["nc-source"],vl=ce({__name:"TableList",props:{base:{},sourceIndex:{default:0}},setup(b){const S=b,r=at(S,"base"),l=at(S,"sourceIndex"),i=se(()=>{var n,U;return(U=(n=r.value)==null?void 0:n.sources)==null?void 0:U[l.value]}),{isMobileMode:w}=De(),{isUIAllowed:T}=He(),{baseTables:P}=ae(Ce()),O=se(()=>P.value.get(r.value.id)??[]),{$api:y}=Le(),a=se(()=>O.value.reduce((n,U)=>(n[U.id]=U,n),{})),D=I({}),C=I(),k={},f=n=>{const U=n.getAttribute("nc-source");U&&(w.value||(k[U]&&k[U].destroy(),us.create(n,{onEnd:async $=>{var _,j;const c=O.value.findIndex(B=>B.source_id===U),{newIndex:d=0,oldIndex:h=0}=$;if(d===h)return;const m=$.item,R=a.value[m.dataset.id],V=$.to.children;if(V.length<2)return;const z=V[d-1],G=V[d+1],Y=z&&a.value[z.dataset.id],q=G&&a.value[G.dataset.id];V.length-1===$.newIndex?R.order=Y.order+1:d===0?R.order=q.order/2:R.order=(Y.order+q.order)/2,(j=O.value)==null||j.splice(d+c,0,...(_=O.value)==null?void 0:_.splice(h+c,1)),D.value[U]?D.value[U]=D.value[U]+1:D.value[U]=1,await y.dbTable.reorder(R.id,{order:R.order})},animation:150,setData($,c){$.setData("text/json",JSON.stringify({id:c.dataset.id,title:c.dataset.title,type:c.dataset.type,sourceId:c.dataset.sourceId}))},revertOnSpill:!0})))};_a(()=>{C.value&&T("viewCreateOrEdit")&&(C.value instanceof HTMLElement?f(C.value):C.value.forEach(n=>f(n)))});const L=se(()=>O.value.filter(n=>{var U,$;return n.source_id===(($=(U=r.value)==null?void 0:U.sources)==null?void 0:$[l.value].id)}));return(n,U)=>{var $,c,d,h,m,R;return t(),M("div",ml,[e(r)?(t(),M(ge,{key:0},[e(L).length===0?(t(),M("div",{key:0,class:te(["py-0.5 text-gray-500",{"ml-8.5":e(l)===0,"ml-14.5 xs:ml-15.25":e(l)!==0}])},x(n.$t("general.empty")),3)):E("",!0),($=e(r).sources)!=null&&$[e(l)]&&e(r).sources[e(l)].enabled?(t(),M("div",{ref_key:"menuRefs",ref:C,key:`sortable-${(c=e(i))==null?void 0:c.id}-${(d=e(i))!=null&&d.id&&((h=e(i))==null?void 0:h.id)in e(D)?e(D)[(m=e(i))==null?void 0:m.id]:"0"}`,"nc-source":(R=e(i))==null?void 0:R.id},[(t(!0),M(ge,null,wa(e(L),V=>{var z;return t(),p(pl,{key:V.id,class:"nc-tree-item text-sm","data-order":V.order,"data-id":V.id,table:V,base:e(r),"source-index":e(l),"data-title":V.title,"data-source-id":(z=e(i))==null?void 0:z.id,"data-type":V.type},null,8,["data-order","data-id","table","base","source-index","data-title","data-source-id","data-type"])}),128))],8,fl)):E("",!0)],64)):E("",!0)])}}}),bl={key:0,class:"flex flex-row items-center py-2 px-2.25 bg-gray-50 rounded-lg text-gray-700"},_l={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},yl=ce({__name:"ProjectDelete",props:{visible:{type:Boolean},baseId:{}},emits:["update:visible"],setup(b,{emit:S}){const r=b,i=et(r,"visible",S),{closeTab:w}=Mt(),T=st(),{deleteProject:P,navigateToFirstProjectOrHome:O}=T,{bases:y}=ae(T),{removeFromRecentViews:a}=Ze(),{refreshCommandPalette:D}=ot(),C=se(()=>y.value.get(r.baseId)),k=I(!1),f=async()=>{if(!C.value)return;const L=JSON.parse(JSON.stringify(C.value));k.value=!0;try{await P(L.id),await w(L.id),D(),i.value=!1,L.id===T.activeProjectId&&await O()}catch(n){me.error(await Ne(n))}finally{k.value=!1,a({baseId:L.id})}};return(L,n)=>{const U=ma,$=ps;return t(),p($,{visible:e(i),"onUpdate:visible":n[0]||(n[0]=c=>le(i)?i.value=c:null),"entity-name":L.$t("objects.project"),"on-delete":f},{"entity-preview":o(()=>[e(C)?(t(),M("div",bl,[s(U,{color:("parseProp"in L?L.parseProp:e(Tt))(e(C).meta).iconColor,type:e(C).type,class:"nc-view-icon w-6 h-6 mx-1"},null,8,["color","type"]),u("div",_l,x(e(C).title),1)])):E("",!0)]),_:1},8,["visible","entity-name"])}}}),gl={class:"mt-5"},wl={class:"prose-md self-center text-gray-500 mt-4"},xl={class:"text-xs p-2"},kl={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},$l=ce({__name:"ProjectDuplicate",props:{modelValue:{type:Boolean},base:{}},emits:["update:modelValue"],setup(b,{emit:S}){const r=b,l=S,{refreshCommandPalette:i}=ot(),{api:w}=Kt(),{$e:T,$poller:P}=Le(),O=st(),{loadProjects:y,createProject:a}=O,{bases:D}=ae(O),{navigateToProject:C}=De(),k=et(r,"modelValue",l),f=I({includeData:!0,includeViews:!0,includeHooks:!0}),L=se(()=>{const{includeData:c,includeViews:d,includeHooks:h}=f.value;return{excludeData:!c,excludeViews:!d,excludeHooks:!h}}),n=I(!1),U=async()=>{try{n.value=!0;const c=Ya[Math.floor(Math.random()*1e3)%Ya.length],h=Rs(c).complement(),m=await w.base.duplicate(r.base.id,{options:L.value,base:{fk_workspace_id:r.base.fk_workspace_id,type:r.base.type,color:c,meta:JSON.stringify({theme:{primaryColor:c,accentColor:h.toHex8String()},iconColor:Tt(r.base.meta).iconColor})}});P.subscribe({id:m.id},async R=>{if(R.status!=="close")if(R.status===St.COMPLETED){await y("workspace");const V=D.value.get(m.base_id);V&&await C({workspaceId:Qe?V.fk_workspace_id:void 0,baseId:V.id,type:V.type}),i(),n.value=!1,k.value=!1}else R.status===St.FAILED&&(me.error("Failed to duplicate project"),await y("workspace"),i(),n.value=!1,k.value=!1)}),T("a:base:duplicate")}catch(c){me.error(await Ne(c)),n.value=!1,k.value=!1}};aa("Enter",()=>{k.value&&U()});const $=I(!1);return(c,d)=>{const h=Ia,m=ha,R=Be,V=Pt,z=Ge("e");return c.base?(t(),p(V,{key:0,visible:e(k),"onUpdate:visible":d[5]||(d[5]=G=>le(k)?k.value=G:null),"mask-closable":!e(n),keyboard:!e(n),class:"!w-[30rem]","wrap-class-name":"nc-modal-base-duplicate"},{default:o(()=>[u("div",null,[u("div",{class:"font-medium text-lg text-gray-800 self-center",onDblclick:d[0]||(d[0]=G=>$.value=!e($))},x(c.$t("general.duplicate"))+" "+x(c.$t("objects.project")),33),u("div",gl,x(c.$t("msg.warning.duplicateProject")),1),u("div",wl,x(c.$t("title.advancedSettings")),1),s(h,{class:"!m-0 !p-0 !my-2"}),u("div",xl,[s(m,{checked:e(f).includeData,"onUpdate:checked":d[1]||(d[1]=G=>e(f).includeData=G),disabled:e(n)},{default:o(()=>[A(x(c.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"]),s(m,{checked:e(f).includeViews,"onUpdate:checked":d[2]||(d[2]=G=>e(f).includeViews=G),disabled:e(n)},{default:o(()=>[A(x(c.$t("labels.includeView")),1)]),_:1},8,["checked","disabled"]),Z(s(m,{checked:e(f).includeHooks,"onUpdate:checked":d[3]||(d[3]=G=>e(f).includeHooks=G),disabled:e(n)},{default:o(()=>[A(x(c.$t("labels.includeWebhook")),1)]),_:1},8,["checked","disabled"]),[[ss,e($)]])])]),u("div",kl,[e(n)?E("",!0):(t(),p(R,{key:"back",type:"secondary",size:"small",onClick:d[4]||(d[4]=G=>k.value=!1)},{default:o(()=>[A(x(c.$t("general.cancel")),1)]),_:1})),Z((t(),p(R,{key:"submit",size:"small",loading:e(n),onClick:U},{default:o(()=>[A(x(c.$t("general.confirm")),1)]),_:1},8,["loading"])),[[z,["a:base:duplicate"]]])])]),_:1},8,["visible","mask-closable","keyboard"])):E("",!0)}}}),hl=b=>b.is_schema_readonly&&b.is_data_readonly?"#278bff":b.is_schema_readonly?"#df830f":"#de0062",Il=b=>{var r,l;const S=`Connection type is ${((r=As.find(i=>i.value===b.type))==null?void 0:r.text)||((l=b.type)==null?void 0:l.toUpperCase())}.`;return b.is_schema_readonly&&b.is_data_readonly?Ee("div",{className:"w-max"},[S,Ee("br"),"Both data and schema editing are disabled.",Ee("br"),"These settings are ideal for read-only use cases of your data.",Ee("br"),Ee("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"Learn more")]):b.is_schema_readonly?Ee("div",{className:"max-w-90"},[S,Ee("br"),"Data editing is allowed and Schema edit is not allowed.",Ee("br"),"An ideal settings for administrative users who need to change data directly on database.",Ee("br"),Ee("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"Learn more")]):Ee("div",{className:"max-w-90"},[S,Ee("br"),"Both Data and Schema Editing are enabled.",Ee("br"),"We highly recommend ",Ee("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"disabling schema editing")," to maintain data integrity and avoid potential issues."])},Tl=gt(()=>wt(()=>import("./DwrbIntl.js"),__vite__mapDeps([4,5,1,2,6,7,8,9,10,11]),import.meta.url).then(b=>b.default||b)),Dl=["data-testid","data-base-id"],Cl=["data-id","data-testid"],Sl={class:"flex items-center select-none w-6 h-full"},Vl={key:1},jl={class:"flex gap-2 items-center"},Ml={class:"flex gap-2 items-center"},Pl={class:"flex gap-2 items-center"},El={class:"flex gap-2 items-center"},Nl={class:"flex gap-2 items-center"},Ll={class:"flex gap-2 items-center"},Ol={class:"flex gap-2 items-center"},Ul={key:0,class:"flex-1"},Bl={class:"transition-height duration-200"},Rl={key:1,class:"transition-height duration-200"},Al={class:"border-none sortable-list"},zl={class:"nc-sidebar-node min-w-20 w-full h-full flex flex-row group py-0.5 pr-6.5 !mr-0"},Gl=["onContextmenu"],Fl=["onContextmenu"],Kl={class:"flex-none w-6 flex items-center justify-center"},Wl=["onUpdate:modelValue","data-source-rename-input-id","onKeyup","onBlur"],Hl=["data-testid"],ql={class:"flex flex-row items-center gap-x-0.25"},Jl={class:"flex gap-2 items-center"},Yl=["nc-source"],Ql={class:"flex text-xs font-bold text-gray-500 ml-1"},Zl={class:"nc-base-option-item flex gap-2 items-center"},Xl={class:"nc-base-option-item flex gap-2 items-center"},ei={class:"nc-base-option-item flex gap-2 items-center text-red-600"},ti={class:"h-[80vh]"},ai=ce({__name:"ProjectNode",setup(b,{expose:S}){const r=Ee(zs,{class:"!text-gray-400",style:{fontSize:"0.85rem"},spin:!0}),i=xa().currentRoute,{isSharedBase:w}=ae(qe()),{setMenuContext:T,openRenameTableDialog:P,duplicateTable:O,contextMenuTarget:y}=We(sa),a=We(Wt),D=st(),{isMobileMode:C}=De(),{api:k}=Kt(),{auditLogsQuery:f,auditPaginationData:L}=ae(dt()),{createProject:n,updateProject:U,getProjectMetaInfo:$,loadProject:c}=D,{bases:d}=ae(D),{loadProjectTables:h}=Ce(),{activeTable:m}=ae(Ce()),{appInfo:R}=De(),{orgRoles:V,isUIAllowed:z}=He();Mt();const{meta:G,control:Y}=ta(),{refreshCommandPalette:q}=ot(),_=I(!1),j=I(""),B=I({}),F=I(""),ee=I(!1),{t:ue}=ea(),he=I(),W=se(()=>a.value.project_role||a.value.workspace_role),{activeProjectId:H}=ae(st()),{baseUrl:Oe}=qe(),Ke=We(rs,()=>{}),{$e:Ie}=Le(),N=I(!1),X=I({}),ne=I([]),[oe]=Gs(),_e=I(""),we=I({}),re=I(!1),be=I(!1),{refreshViewTabTitle:xe}=Ze(),ke=se(()=>{var ie;const g=String((ie=i.value)==null?void 0:ie.name).split("baseId-index-index");if(g.length<=1)return!1;const v=g[g.length-1];return v.split("-").length===2||v.split("-").length===1}),Re=g=>["airtableImport","csvImport","jsonImport","excelImport"].some(v=>z(v,{source:g})),ye=()=>{_.value=!0,j.value=a.value.title,ct(()=>{var g,v;(g=he.value)==null||g.focus(),(v=he.value)==null||v.select()})},pe=g=>{var ie;const v=(ie=a.value.sources)==null?void 0:ie.find(de=>de.id===g);v!=null&&v.id&&(B.value[v.id]={editMode:!0,tempTitle:v.alias||""},ct(()=>{const de=document.querySelector(`[data-source-rename-input-id="${g}"]`);de&&(de==null||de.focus(),de==null||de.select())}))},K=async g=>{var ie;const v=(ie=a.value.sources)==null?void 0:ie.find(de=>de.id===g);if(!(!(v!=null&&v.id)||!B.value[v.id])&&(B.value[v.id].tempTitle&&(B.value[v.id].tempTitle=B.value[v.id].tempTitle.trim()),!!B.value[v.id].tempTitle))try{await k.source.update(v.base_id,v.id,{alias:B.value[v.id].tempTitle}),await c(v.base_id,!0),delete B.value[v.id],Ie("a:source:rename"),xe==null||xe()}catch(de){me.error(await Ne(de))}finally{q()}},Q=async()=>{if(j.value&&(j.value=j.value.trim()),!!j.value)try{await U(a.value.id,{title:j.value}),_.value=!1,j.value="",Ie("a:base:rename"),xe==null||xe()}catch(g){me.error(await Ne(g))}},{copy:Se}=ns(!0),ia=async()=>{try{await Se(Object.entries(await $(a.value.id)).map(([g,v])=>`${g}: **${v}**`).join(`
`))&&me.info(ue("msg.info.copiedToClipboard"))}catch(g){console.error(g),me.error(g.message)}};S({enableEditMode:ye});const xt=async(g,v)=>{try{const ie={...Tt(v.meta),iconColor:g};D.updateProject(v.id,{meta:JSON.stringify(ie)}),Ie("a:base:icon:color:navdraw",{iconColor:g})}catch(ie){me.error(await Ne(ie))}finally{q()}};function Jt(g){var fe,tt,je;const v=I(!0);let ie=(fe=a.value.sources)==null?void 0:fe[0].id;if(typeof g=="number"&&(ie=(tt=a.value.sources)==null?void 0:tt[g].id),!ie||!((je=a.value)!=null&&je.id))return;const{close:de}=ze(ds,{modelValue:v,sourceId:ie,baseId:a.value.id,onCreate:Ye,"onUpdate:modelValue":()=>Ye()});function Ye(lt){v.value=!1,lt&&(a.value.isExpanded=!0,(!ne.value||!ne.value.includes(`collapse-${ie}`))&&ne.value.push(`collapse-${ie}`),setTimeout(()=>{const ft=document.querySelector(`[data-table-id="${lt.id}"]`);ft&&(ft==null||ft.scrollIntoView({behavior:"smooth",block:"nearest"}))},1e3),de(1e3))}}const Ve=I(!1);async function kt(){if(Ve.value)return;Ve.value=!0,!D.isProjectPopulated(a.value.id)&&a.value.type===Dt.DB&&h(a.value.id);try{Jt(),!a.value.isExpanded&&a.value.type!==Dt.DB&&(a.value.isExpanded=!0)}finally{Ve.value=!1}}const Et=async(g,v,ie)=>{if(!g)return;const de=Ct()?G.value:Y.value;if(!ie&&!de&&Ie("c:base:open"),v=C.value||v,ie=C.value||ie,de&&!v){await Xt(`${de?"#":""}${Oe({id:g.id,type:"database",isSharedBase:w.value})}`,de?{open:Ws}:void 0);return}ie?g.isExpanded=!g.isExpanded:g.isExpanded=!0;const Ye=D.isProjectPopulated(g.id);if(Ye||(g.isLoading=!0),v||await Xt(Oe({id:g.id,type:"database",isSharedBase:w.value})),Ye||await h(g.id),!Ye){g.isLoading=!1;const fe=d.value.get(g.id);fe.isLoading=!1}};function nt(g){Ie("c:project:relation");const v=I(!0),{close:ie}=ze(bn,{modelValue:v,sourceId:g.id,"onUpdate:modelValue":()=>de(),baseId:a.value.id});function de(){v.value=!1,ie(1e3)}}const $t=se(()=>{var g,v;if(y.type==="source")return y.value;if(y.type==="table"){const ie=(v=(g=a.value)==null?void 0:g.sources)==null?void 0:v.find(de=>de.id===y.value.source_id);if(ie)return ie}return null});Xe(()=>{var g;return(g=m.value)==null?void 0:g.id},async()=>{if(!m.value)return;const g=m.value.source_id;g&&(ne.value.includes(`collapse-${g}`)||ne.value.push(`collapse-${g}`))},{immediate:!0}),aa("Escape",()=>{N.value&&(N.value=!1);for(const g of Object.keys(X.value))X.value[g]=!1});const ht=I(!1),Nt=I(),ra=g=>{Nt.value=g,ht.value=!0},ca=()=>{re.value=!0,Ie("c:table:delete")},Je=()=>{be.value=!0,Ie("c:project:delete")},It=I(!1);let mt;const Yt=async()=>{mt&&clearTimeout(mt);try{await Se(y.value.id),It.value=!0,mt=setTimeout(()=>{It.value=!1,clearTimeout(mt)},5e3)}catch(g){me.error(g.message)}},ut=g=>{var v;return(v=a.value.sources)==null?void 0:v.find(ie=>ie.id===g)};async function Qt(g){Ie("c:project:audit"),L.value.page=1,f.value={...f.value,orderBy:{created_at:"desc",user:void 0}};const v=I(!0),{close:ie}=ze(yn,{modelValue:v,sourceId:g.id,"onUpdate:modelValue":()=>de(),baseId:a.value.id,bordered:!0});function de(){v.value=!1,ie(1e3)}}const Ae=I();return Xe(()=>{var g;return Ae.value&&H.value===((g=a.value)==null?void 0:g.id)},async g=>{var v;g&&(await ct(),(v=Ae.value)==null||v.scrollIntoView({behavior:"smooth"}))},{immediate:!0}),(g,v)=>{var Va,ja,Ma,Pa,Ea;const ie=Hs,de=qs,Ye=Vt,fe=Fe,tt=Be,je=Ht,lt=Ta,ft=hn,da=la,ua=qt,Ca=vl,Sa=yo,_s=go,ys=wo,gs=vs,ws=yl,xs=$l,ks=Tl,$s=Pt,Me=Ge("e");return t(),M(ge,null,[s(ua,{trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-tree-view-context-menu"},Fs({default:o(()=>{var Pe,Lt,Ot,Ut,Bt,Rt,At,vt,Na,La,Oa,Ua,Ba,Ra,Aa;return[u("div",{ref_key:"labelEl",ref:Ae,class:te(["mx-1 nc-base-sub-menu rounded-md",{active:e(a).isExpanded}]),"data-testid":`nc-sidebar-base-${e(a).title}`,"data-base-id":e(a).id},[u("div",{class:"flex items-center gap-0.75 py-0.5 cursor-pointer",onContextmenu:v[15]||(v[15]=J=>e(T)("base",e(a)))},[u("div",{ref:"baseNodeRefs",class:te([{"bg-primary-selected active":e(H)===e(a).id&&e(ke)&&!e(C),"hover:bg-gray-200":!(e(H)===e(a).id&&e(ke))},"nc-sidebar-node base-title-node h-7 flex-grow rounded-md group flex items-center w-full pr-1 pl-1.5"]),"data-id":e(a).id,"data-testid":`nc-sidebar-base-title-${e(a).title}`},[u("div",{class:"flex items-center mr-1",onClick:v[1]||(v[1]=J=>Et(e(a)))},[u("div",Sl,[e(a).isLoading?(t(),p(ie,{key:0,class:"!ml-1.25 !flex !flex-row !items-center !my-0.5 w-8",indicator:e(r)},null,8,["indicator"])):(t(),M("div",Vl,[(t(),p(de,{key:`${e(a).id}_${("parseProp"in g?g.parseProp:e(Tt))(e(a).meta).iconColor}`,type:(Pe=e(a))==null?void 0:Pe.type,"model-value":("parseProp"in g?g.parseProp:e(Tt))(e(a).meta).iconColor,size:"small",readonly:((Lt=e(a))==null?void 0:Lt.type)&&((Ot=e(a))==null?void 0:Ot.type)!=="database"||!e(z)("baseRename"),"onUpdate:modelValue":v[0]||(v[0]=J=>xt(J,e(a)))},null,8,["type","model-value","readonly"]))]))])]),e(_)?Z((t(),M("input",{key:0,ref_key:"input",ref:he,"onUpdate:modelValue":v[2]||(v[2]=J=>le(j)?j.value=J:null),class:te(["flex-grow leading-1 outline-0 ring-none capitalize !text-inherit !bg-transparent flex-1 mr-4",e(H)===e(a).id&&e(ke)?"!text-brand-600 !font-semibold":"!text-gray-700"]),onClick:v[3]||(v[3]=ve(()=>{},["stop"])),onKeyup:[pt(Q,["enter"]),pt(Q,["esc"])],onBlur:Q},null,34)),[[Qa,e(j)]]):(t(),p(Ye,{key:1,class:te(["nc-sidebar-node-title capitalize text-ellipsis overflow-hidden select-none flex-1",e(H)===e(a).id&&e(ke)?"text-brand-600 font-semibold":"text-gray-700"]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},"show-on-truncate-only":"",onClick:v[4]||(v[4]=J=>Et(e(a)))},{title:o(()=>[A(x(e(a).title),1)]),default:o(()=>[u("span",null,x(e(a).title),1)]),_:1},8,["class"])),e(_)?E("",!0):(t(),M(ge,{key:2},[e(w)?E("",!0):(t(),p(ua,{key:0,visible:e(N),"onUpdate:visible":v[13]||(v[13]=J=>le(N)?N.value=J:null),trigger:["click"]},{overlay:o(()=>[s(da,{class:"nc-scrollbar-md",style:{maxHeight:"70vh",overflow:"overlay"},"data-testid":`nc-sidebar-base-${e(a).title}-options`,onClick:v[12]||(v[12]=J=>N.value=!1)},{default:o(()=>{var J,bt,it,Te,za,Ga,Fa,Ka,Wa,Ha,qa;return[e(w)?E("",!0):(t(),M(ge,{key:0},[e(z)("baseRename")?(t(),p(je,{key:0,"data-testid":"nc-sidebar-project-rename",onClick:ye},{default:o(()=>[Z((t(),M("div",jl,[s(fe,{icon:"rename",class:"group-hover:text-black"}),A(" "+x(g.$t("general.rename")),1)])),[[Me,["c:base:rename"]]])]),_:1})):E("",!0),e(z)("baseDuplicate",{roles:[e(Za)(e(V)),e(W)].join()})?(t(),p(je,{key:1,"data-testid":"nc-sidebar-base-duplicate",onClick:v[6]||(v[6]=rt=>ra(e(a)))},{default:o(()=>[Z((t(),M("div",Ml,[s(fe,{icon:"duplicate",class:"text-gray-700"}),A(" "+x(g.$t("general.duplicate")),1)])),[[Me,["c:base:duplicate"]]])]),_:1})):E("",!0),["baseDuplicate","baseRename"].some(rt=>e(z)(rt))?(t(),p(lt,{key:2})):E("",!0),("isEeUI"in g?g.isEeUI:e(Qe))?E("",!0):(t(),p(je,{key:"copy","data-testid":"nc-sidebar-base-copy-base-info",onClick:ve(ia,["stop"])},{default:o(()=>[Z((t(),M("div",Pl,[s(fe,{icon:"copy",class:"group-hover:text-black"}),A(" "+x(g.$t("activity.account.projInfo")),1)])),[[Me,["c:base:copy-proj-info"]]])]),_:1})),(it=(bt=(J=e(a))==null?void 0:J.sources)==null?void 0:bt[0])!=null&&it.enabled?(t(),p(je,{key:"erd","data-testid":"nc-sidebar-base-relations",onClick:v[7]||(v[7]=rt=>{var zt,Gt;return nt((Gt=(zt=e(a))==null?void 0:zt.sources)==null?void 0:Gt[0])})},{default:o(()=>[Z((t(),M("div",El,[s(fe,{icon:"erd"}),A(" "+x(g.$t("title.relations")),1)])),[[Me,["c:base:erd"]]])]),_:1})):E("",!0),e(z)("baseAuditList")&&((Ga=(za=(Te=e(a))==null?void 0:Te.sources)==null?void 0:za[0])!=null&&Ga.enabled)?(t(),p(je,{key:"audit","data-testid":"nc-sidebar-base-audit",onClick:v[8]||(v[8]=rt=>{var zt,Gt;return Qt((Gt=(zt=e(a))==null?void 0:zt.sources)==null?void 0:Gt[0])})},{default:o(()=>[s(fe,{icon:"audit",class:"group-hover:text-black"}),A(" "+x(g.$t("title.audit")),1)]),_:1})):E("",!0),e(z)("apiDocs")?(t(),p(je,{key:"api","data-testid":"nc-sidebar-base-rest-apis",onClick:v[9]||(v[9]=ve(()=>{e(Ie)("c:base:api-docs"),("openLink"in g?g.openLink:e(Ks))(`/api/v2/meta/bases/${e(a).id}/swagger`,e(R).ncSiteUrl)},["stop"]))},{default:o(()=>[Z((t(),M("div",Nl,[s(fe,{icon:"snippet",class:"group-hover:text-black !max-w-3.9"}),A(" "+x(g.$t("activity.account.swagger")),1)])),[[Me,["c:base:api-docs"]]])]),_:1})):E("",!0)],64)),(Wa=(Ka=(Fa=e(a))==null?void 0:Fa.sources)==null?void 0:Ka[0])!=null&&Wa.enabled&&Re((qa=(Ha=e(a))==null?void 0:Ha.sources)==null?void 0:qa[0])?(t(),M(ge,{key:1},[s(lt),s(ft,{base:e(a),"onUpdate:base":v[10]||(v[10]=rt=>le(a)?a.value=rt:null),source:e(a).sources[0]},null,8,["base","source"])],64)):E("",!0),["baseMiscSettings","baseDelete"].some(rt=>e(z)(rt))?(t(),p(lt,{key:2})):E("",!0),e(z)("baseMiscSettings")?(t(),p(je,{key:"teamAndSettings","data-testid":"nc-sidebar-base-settings",class:"nc-sidebar-base-base-settings",onClick:v[11]||(v[11]=rt=>e(Ke)(!0,"teamAndAuth",void 0,e(a).id))},{default:o(()=>[Z((t(),M("div",Ll,[s(fe,{icon:"settings",class:"group-hover:text-black"}),A(" "+x(g.$t("activity.settings")),1)])),[[Me,["c:base:settings"]]])]),_:1})):E("",!0),e(z)("baseDelete",{roles:[e(Za)(e(V)),e(W)].join()})?(t(),p(je,{key:4,"data-testid":"nc-sidebar-base-delete",class:"!text-red-500 !hover:bg-red-50",onClick:Je},{default:o(()=>[u("div",Ol,[s(fe,{icon:"delete",class:"w-4"}),A(" "+x(g.$t("general.delete")),1)])]),_:1})):E("",!0)]}),_:1},8,["data-testid"])]),default:o(()=>[Z((t(),p(tt,{class:te(["nc-sidebar-node-btn",{"!text-black !opacity-100 !inline-block":e(N)}]),"data-testid":"nc-sidebar-context-menu",type:"text",size:"xxsmall",onClick:v[5]||(v[5]=ve(()=>{},["stop"]))},{default:o(()=>[s(fe,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:1},8,["class"])),[[Me,["c:base:options"]]])]),_:1},8,["visible"])),e(z)("tableCreate",{roles:e(W),source:(Bt=(Ut=e(a))==null?void 0:Ut.sources)==null?void 0:Bt[0]})?Z((t(),p(tt,{key:1,disabled:!((vt=(At=(Rt=e(a))==null?void 0:Rt.sources)==null?void 0:At[0])!=null&&vt.enabled),class:te(["nc-sidebar-node-btn",{"!text-black !inline-block !opacity-100":e(Ve),"!inline-block !opacity-100":e(N)}]),size:"xxsmall",type:"text","data-testid":"nc-sidebar-add-base-entity",loading:e(Ve),onClick:ve(kt,["stop"])},{default:o(()=>[s(fe,{icon:"plus",class:"text-xl leading-5",style:{"-webkit-text-stroke":"0.15px"}})]),_:1},8,["disabled","class","loading"])),[[Me,["c:base:create-table"]]]):E("",!0),Z((t(),p(tt,{type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn nc-sidebar-expand !xs:opacity-100 !mr-0 mt-0.5",{"!opacity-100":e(N)}]),onClick:v[14]||(v[14]=J=>Et(e(a),!0,!0))},{default:o(()=>[s(fe,{icon:"chevronRight",class:te(["group-hover:visible cursor-pointer transform transition-transform duration-200 text-[20px]",{"!rotate-90":e(a).isExpanded}])},null,8,["class"])]),_:1},8,["class"])),[[Me,["c:base:expand"]]])],64))],10,Cl)],32),e(a).id&&!e(a).isLoading?(t(),M("div",{key:"g1",class:te(["overflow-x-hidden transition-max-height",{"max-h-0":!e(a).isExpanded}])},[e(a)&&((Na=e(a))!=null&&Na.sources)?(t(),M("div",{key:0,class:te(["flex-1 overflow-y-auto overflow-x-hidden flex flex-col",{"mb-[20px]":e(w)}])},[(Ua=(Oa=(La=e(a))==null?void 0:La.sources)==null?void 0:Oa[0])!=null&&Ua.enabled?(t(),M("div",Ul,[u("div",Bl,[s(Ca,{base:e(a),"source-index":0},null,8,["base"])])])):E("",!0),(Aa=(Ra=(Ba=e(a))==null?void 0:Ba.sources)==null?void 0:Ra.slice(1).filter(J=>J.enabled))!=null&&Aa.length?(t(),M("div",Rl,[u("div",Al,[(t(!0),M(ge,null,wa(e(a).sources,(J,bt)=>(t(),M("div",{key:`source-${J.id}`},[bt===0?(t(),M(ge,{key:0},[],64)):J&&J.enabled?Z((t(),p(ys,{key:1,activeKey:e(ne),"onUpdate:activeKey":v[19]||(v[19]=it=>le(ne)?ne.value=it:null),class:te(["!mx-0 !px-0 nc-sidebar-source-node",[{hidden:e(oe)&&!!e(_e)}]]),"expand-icon-position":"right",bordered:!1,ghost:""},{expandIcon:o(({isActive:it})=>[Z((t(),p(tt,{type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn nc-sidebar-expand !xs:opacity-100 !mr-0 mt-0.5",{"!opacity-100 !inline-block":e(X)[J.id]}])},{default:o(()=>[s(fe,{icon:"chevronDown",class:te(["flex-none cursor-pointer transform transition-transform duration-500 rotate-270",{"!rotate-180":it}])},null,8,["class"])]),_:2},1032,["class"])),[[Me,["c:external:base:expand"]]])]),default:o(()=>[(t(),p(_s,{key:`collapse-${J.id}`},{header:o(()=>{var it;return[u("div",zl,[bt===0?(t(),M("div",{key:0,class:"source-context flex items-center gap-2 text-gray-800 nc-sidebar-node-title",onContextmenu:Te=>e(T)("source",J)},[s(Sa,{class:"flex-none min-w-4 !xs:min-w-4.25 !xs:w-4.25 !xs:text-sm"}),A(" "+x(g.$t("general.default")),1)],40,Gl)):(t(),M("div",{key:1,class:"source-context flex flex-grow items-center gap-1 text-gray-800 min-w-1/20 max-w-full",onContextmenu:Te=>e(T)("source",J)},[s(Ye,{"tooltip-style":{"min-width":"max-content"},"overlay-inner-style":{"min-width":"max-content"},"mouse-leave-delay":.3,placement:"topLeft",trigger:"hover",class:"flex items-center"},{title:o(()=>[(t(),p(is(("getSourceTooltip"in g?g.getSourceTooltip:e(Il))(J))))]),default:o(()=>[u("div",Kl,[s(Sa,{color:("getSourceIconColor"in g?g.getSourceIconColor:e(hl))(J),class:"flex-none min-w-4 !xs:min-w-4.25 !xs:w-4.25 !xs:text-sm"},null,8,["color"])])]),_:2},1024),J.id&&((it=e(B)[J.id])!=null&&it.editMode)?Z((t(),M("input",{key:0,ref_for:!0,ref_key:"input",ref:he,"onUpdate:modelValue":Te=>e(B)[J.id].tempTitle=Te,class:"flex-grow leading-1 outline-0 ring-none capitalize !text-inherit !bg-transparent flex-1 mr-4 !text-gray-700","data-source-rename-input-id":J.id,onClick:v[16]||(v[16]=ve(()=>{},["stop"])),onKeydown:v[17]||(v[17]=pt(ve(()=>{},["stop","prevent"]),["enter"])),onKeyup:[pt(Te=>K(J.id),["enter"]),pt(Te=>K(J.id),["esc"])],onBlur:Te=>K(J.id)},null,40,Wl)),[[Qa,e(B)[J.id].tempTitle]]):(t(),p(Ye,{key:1,class:"nc-sidebar-node-title capitalize text-ellipsis overflow-hidden select-none text-gray-700",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},"show-on-truncate-only":""},{title:o(()=>[A(x(J.alias||""),1)]),default:o(()=>[u("span",{"data-testid":`nc-sidebar-base-${J.alias}`},x(J.alias||""),9,Hl)]),_:2},1024))],40,Fl)),u("div",ql,[s(ua,{visible:e(X)[J.id],trigger:["click"],"onUpdate:visible":Te=>e(X)[J.id]=Te},{overlay:o(()=>[s(da,{class:"nc-scrollbar-md",style:{maxHeight:"70vh",overflow:"overlay"},onClick:Te=>e(X)[J.id]=!1},{default:o(()=>[e(z)("baseRename")?(t(),p(je,{key:0,"data-testid":"nc-sidebar-source-rename",onClick:Te=>pe(J.id)},{default:o(()=>[s(fe,{icon:"rename",class:"group-hover:text-black"}),A(" "+x(g.$t("general.rename")),1)]),_:2},1032,["onClick"])):E("",!0),s(lt),s(je,{key:"erd",onClick:Te=>nt(J)},{default:o(()=>[Z((t(),M("div",Jl,[s(fe,{icon:"erd"}),A(" "+x(g.$t("title.relations")),1)])),[[Me,["c:source:erd"]]])]),_:2},1032,["onClick"]),Re(J)?(t(),p(ft,{key:1,base:e(a),"onUpdate:base":v[18]||(v[18]=Te=>le(a)?a.value=Te:null),source:J},null,8,["base","source"])):E("",!0)]),_:2},1032,["onClick"])]),default:o(()=>[Z((t(),p(tt,{class:te(["nc-sidebar-node-btn",{"!text-black !opacity-100 !inline-block":e(X)[J.id]}]),type:"text",size:"xxsmall",onClick:ve(Te=>e(X)[J.id]=!e(X)[J.id],["stop"])},{default:o(()=>[s(fe,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:2},1032,["class","onClick"])),[[Me,["c:source:options"]]])]),_:2},1032,["visible","onUpdate:visible"]),e(z)("tableCreate",{roles:e(W),source:J})?Z((t(),p(tt,{key:0,type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn",{"!opacity-100 !inline-block":e(X)[J.id]}]),onClick:ve(Te=>Jt(bt),["stop"])},{default:o(()=>[s(fe,{icon:"plus",class:"text-xl leading-5",style:{"-webkit-text-stroke":"0.15px"}})]),_:2},1032,["class","onClick"])),[[Me,["c:source:add-table"]]]):E("",!0)])])]}),default:o(()=>[(t(),M("div",{ref_for:!0,ref:"menuRefs",key:`sortable-${J.id}-${J.id&&J.id in e(we)?e(we)[J.id]:"0"}`,"nc-source":J.id},[s(Ca,{base:e(a),"source-index":bt},null,8,["base","source-index"])],8,Yl))]),_:2},1024))]),_:2},1032,["activeKey","class"])),[[Me,["c:source:toggle-expand"]]]):E("",!0)]))),128))])])):E("",!0)],2)):E("",!0)],2)):E("",!0)],10,Dl)]}),_:2},[e(w)?void 0:{name:"overlay",fn:o(()=>[s(da,{class:te(["!py-0 rounded text-sm",{"!min-w-62.5":e(y).type==="table"}])},{default:o(()=>{var Pe,Lt,Ot,Ut,Bt,Rt,At;return[e(y).type==="base"&&e(a).type==="database"?(t(),M(ge,{key:0},[],64)):e(y).type==="source"?(t(),M(ge,{key:1},[],64)):e(y).type==="table"?(t(),M(ge,{key:2},[s(Ye,null,{title:o(()=>[A(x(g.$t("labels.clickToCopyTableID")),1)]),default:o(()=>{var vt;return[u("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:ve(Yt,["stop"])},[u("div",Ql,x(g.$t("labels.tableIdColon",{tableId:(vt=e(y).value)==null?void 0:vt.id})),1),s(tt,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(It)?(t(),p(fe,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(t(),p(fe,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),e(z)("tableRename",{source:ut((Pe=e(y).value)==null?void 0:Pe.source_id)})||e(z)("tableDelete",{source:ut((Lt=e(y).value)==null?void 0:Lt.source_id)})?(t(),M(ge,{key:0},[s(lt),e(z)("tableRename",{source:ut((Ot=e(y).value)==null?void 0:Ot.source_id)})?(t(),p(je,{key:0,onClick:v[20]||(v[20]=vt=>e(P)(e(y).value,!0))},{default:o(()=>[Z((t(),M("div",Zl,[s(fe,{icon:"rename",class:"text-gray-700"}),A(" "+x(g.$t("general.rename"))+" "+x(g.$t("objects.table")),1)])),[[Me,["c:table:rename"]]])]),_:1})):E("",!0),e(z)("tableDuplicate",{source:ut((Ut=e(y).value)==null?void 0:Ut.source_id)})&&((Bt=e($t))!=null&&Bt.is_meta||(Rt=e($t))!=null&&Rt.is_local)?(t(),p(je,{key:1,onClick:v[21]||(v[21]=vt=>e(O)(e(y).value))},{default:o(()=>[Z((t(),M("div",Xl,[s(fe,{icon:"duplicate",class:"text-gray-700"}),A(" "+x(g.$t("general.duplicate"))+" "+x(g.$t("objects.table")),1)])),[[Me,["c:table:duplicate"]]])]),_:1})):E("",!0),s(lt),e(z)("tableDelete",{source:ut((At=e(y).value)==null?void 0:At.source_id)})?(t(),p(je,{key:2,class:"!hover:bg-red-50",onClick:ca},{default:o(()=>[u("div",ei,[s(fe,{icon:"delete"}),A(" "+x(g.$t("general.delete"))+" "+x(g.$t("objects.table")),1)])]),_:1})):E("",!0)],64)):E("",!0)],64)):E("",!0)]}),_:1},8,["class"])]),key:"0"}]),1024),(Va=e(y).value)!=null&&Va.id&&((ja=e(a))!=null&&ja.id)?(t(),p(gs,{key:0,visible:e(re),"onUpdate:visible":v[22]||(v[22]=Pe=>le(re)?re.value=Pe:null),"table-id":(Ma=e(y).value)==null?void 0:Ma.id,"base-id":(Pa=e(a))==null?void 0:Pa.id},null,8,["visible","table-id","base-id"])):E("",!0),s(ws,{visible:e(be),"onUpdate:visible":v[23]||(v[23]=Pe=>le(be)?be.value=Pe:null),"base-id":(Ea=e(a))==null?void 0:Ea.id},null,8,["visible","base-id"]),e(Nt)?(t(),p(xs,{key:1,modelValue:e(ht),"onUpdate:modelValue":v[24]||(v[24]=Pe=>le(ht)?ht.value=Pe:null),base:e(Nt)},null,8,["modelValue","base"])):E("",!0),s($s,{visible:e(ee),"onUpdate:visible":v[25]||(v[25]=Pe=>le(ee)?ee.value=Pe:null),size:"large"},{default:o(()=>{var Pe;return[u("div",ti,[s(ks,{"base-id":(Pe=e(a))==null?void 0:Pe.id,"source-id":e(F)},null,8,["base-id","source-id"])])]}),_:1},8,["visible"])],64)}}}),si=Ue(ai,[["__scopeId","data-v-d1d98150"]]),oi={class:"flex items-center justify-center mt-8"},ni={class:"flex flex-col gap-4 items-center text-gray-500"},li={class:"flex gap-2 justify mt-1"},ii={class:"flex gap-2 items-center justify-center text-xs"},ri=ce({__name:"EmptyPlaceholder",props:{buttons:{type:Boolean}},setup(b){const S=b,r=I(!1),l=I(),i=w=>{l.value=w,r.value=!0};return(w,T)=>{const P=xo,O=ma,y=Js,a=Da;return t(),M("div",oi,[u("div",ni,[s(P),T[4]||(T[4]=u("div",{class:"font-weight-medium"},"No Projects",-1)),S.buttons?(t(),M(ge,{key:0},[T[3]||(T[3]=u("div",{class:"text-xs"},"Create Base",-1)),u("div",li,[s(y,{class:"flex-1 nc-btn",onClick:T[0]||(T[0]=D=>i(("NcProjectType"in w?w.NcProjectType:e(Dt)).DB))},{default:o(()=>[u("div",ii,[s(O,{type:("NcProjectType"in w?w.NcProjectType:e(Dt)).DB,class:"text-[#2824FB] text-lg"},null,8,["type"]),T[2]||(T[2]=A(" New Database Base "))])]),_:1})]),s(a,{modelValue:e(r),"onUpdate:modelValue":T[1]||(T[1]=D=>le(r)?r.value=D:null),type:e(l)},null,8,["modelValue","type"])],64)):E("",!0)])])}}}),ci=ce({__name:"ProjectWrapper",props:{baseRole:{default:""},base:{}},setup(b){const S=b,r=at(S,"baseRole"),l=at(S,"base");return _t(ls,r),_t(Wt,l),(i,w)=>fa(i.$slots,"default")}}),di={class:"nc-treeview-container flex flex-col justify-between select-none"},ui={key:0,class:"text-gray-500 font-medium pl-3.5 mb-1"},pi={mode:"inline",class:"nc-treeview pb-0.5 flex-grow min-h-50 overflow-x-hidden"},mi={key:0},fi=ce({__name:"index",setup(b){const{isUIAllowed:S}=He(),{$e:r}=Le(),l=xa(),i=l.currentRoute,w=st(),{createProject:T,updateProject:P}=w,{bases:O,basesList:y,activeProjectId:a}=ae(w),{isWorkspaceLoading:D}=ae(dt()),C=I(!1),k=qe(),{isSharedBase:f,base:L}=ae(k),{activeTable:n}=ae(Ce()),{isMobileMode:U}=De(),$=ba({}),c=(_,j)=>{$.type=_,$.value=j};function d(_){if(!_||!_.id)return;r("c:view:description");const j=I(!0),{close:B}=ze(ro,{modelValue:j,view:_,"onUpdate:modelValue":F});function F(){j.value=!1,B(1e3)}}function h(_){if(!_||!_.id)return;r("c:table:description");const j=I(!0),{close:B}=ze(on,{modelValue:j,tableMeta:_,"onUpdate:modelValue":F});function F(){j.value=!1,B(1e3)}}function m(_,j=!1){if(!_||!_.source_id)return;r("c:table:rename");const B=I(!0),{close:F}=ze(cn,{modelValue:B,tableMeta:_,sourceId:_.source_id,"onUpdate:modelValue":ee});function ee(){B.value=!1,F(1e3)}}function R(_,j){if(!_&&!(j||y.value[0].id))return;r("c:table:create:navdraw");const B=I(!0),{close:F}=ze(ds,{modelValue:B,sourceId:_,baseId:j||y.value[0].id,"onUpdate:modelValue":ee});function ee(){B.value=!1,F(1e3)}}const V=async _=>{if(!_||!_.id||!_.base_id)return;const j=I(!0);r("c:table:duplicate");const{close:B}=ze(fn,{modelValue:j,table:_,"onUpdate:modelValue":F});function F(){j.value=!1,B(1e3)}},z=se(()=>{var _,j,B,F;return((j=(_=L.value)==null?void 0:_.sources)==null?void 0:j[0])&&S("tableCreate",{source:(F=(B=L.value)==null?void 0:B.sources)==null?void 0:F[0]})&&i.value.name!=="index"&&i.value.name!=="index-index"&&i.value.name!=="index-index-create"&&i.value.name!=="index-index-create-external"&&i.value.name!=="index-user-index"});Xa(document,"keydown",async _=>{var B;const j=Ct()?_.metaKey:_.ctrlKey;if(!Ys()&&_.altKey&&!_.shiftKey&&!j)switch(_.keyCode){case 84:{if(z.value&&!Qs()){_.preventDefault(),r("c:shortcut",{key:"ALT + T"});const F=a.value,ee=F?O.value.get(F):void 0;if(!ee)return;F&&R((B=ee.sources)==null?void 0:B[0].id,F)}break}case 76:{i.value.params.baseId&&l.push({query:{...i.value.query,clear:i.value.query.clear==="1"?void 0:"1"}});break}case 68:{_.stopPropagation(),C.value=!0;break}}});const G=_=>{var j;(j=document.querySelector(".source-context, .table-context"))!=null&&j.contains(_.target)||c("main")};_t(sa,{setMenuContext:c,duplicateTable:V,openRenameTableDialog:m,openViewDescriptionDialog:d,openTableDescriptionDialog:h,contextMenuTarget:$}),Xa(document,"contextmenu",G,!0);const Y=()=>{var j;const _=document.querySelector(`.nc-treeview [data-table-id="${(j=n.value)==null?void 0:j.id}"]`);_&&(_==null||_.scrollIntoView({behavior:"smooth",block:"nearest"}))},q=async _=>{var he,W;const{moved:{newIndex:j=0,oldIndex:B=0,element:F}}=_;if(!(F!=null&&F.id))return;let ee;y.value.length-1===j?ee=Math.max(...y.value.map(H=>(H==null?void 0:H.order)??0))+1:j===0?ee=Math.min(...y.value.map(H=>(H==null?void 0:H.order)??0))/2:ee=(parseFloat(String(((he=y.value[j-1])==null?void 0:he.order)??0))+parseFloat(String(((W=y.value[j+1])==null?void 0:W.order)??0)))/2;const ue=isNaN(Number(ee))?B:ee;await P(F.id,{order:ue}),r("a:base:reorder")};return Xe(()=>{var _;return(_=n.value)==null?void 0:_.id},()=>{var _;(_=n.value)!=null&&_.id&&setTimeout(()=>{Y()},1e3)},{immediate:!0}),(_,j)=>{var ue,he;const B=si,F=ri,ee=Da;return t(),M("div",di,[e(f)?E("",!0):(t(),M("div",ui,x(_.$t("objects.projects")),1)),u("div",pi,[(ue=e(y))!=null&&ue.length?(t(),M("div",mi,[s(e(ko),{"model-value":e(y),disabled:e(U)||!e(S)("baseReorder")||((he=e(y))==null?void 0:he.length)<2,"item-key":"id",handle:".base-title-node","ghost-class":"ghost",onChange:j[0]||(j[0]=W=>q(W))},{item:o(({element:W})=>[(t(),M("div",{key:W.id},[s(ci,{"base-role":W.project_role,base:W},{default:o(()=>[s(B)]),_:2},1032,["base-role","base"])]))]),_:1},8,["model-value","disabled"])])):e(D)?E("",!0):(t(),p(F,{key:1}))]),s(ee,{modelValue:e(C),"onUpdate:modelValue":j[1]||(j[1]=W=>le(C)?C.value=W:null)},null,8,["modelValue"])])}}}),vi=Ue(fi,[["__scopeId","data-v-627aaeec"]]),bi=""+new URL("giftCard.CTBuIrB_.svg",import.meta.url).href,_i={class:"wrapper"},yi={class:"header"},gi={key:0,class:"img-wrapper"},wi={class:"flex justify-end mt-7 gap-x-2"},xi=ce({__name:"Gift",setup(b){const{appInfo:S,giftBannerDismissedCount:r,user:l}=De(),{$e:i}=Le(),w=I(!0),T=I(!1),P=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)<780,O=se(()=>{var k,f;return((k=l.value)==null?void 0:k.email)&&!/^[a-zA-Z0-9._%+-]+@(gmail|yahoo|hotmail|outlook|aol|icloud|qq|163|126|sina|nocodb)(\.com)?$/i.test((f=l.value)==null?void 0:f.email)&&(!r.value||r.value<5)});r.value?setTimeout(()=>{w.value=!1},r.value*6e4):w.value=!1;const y=()=>{var k;r.value++,i("a:claim:gift:coupon"),window.open((k=S.value)==null?void 0:k.giftUrl,"_blank","noopener,noreferrer")},a=()=>{!r.value||r.value<4?T.value=!0:(w.value=!0,r.value++)},D=()=>{w.value=!0,r.value=5,T.value=!1},C=()=>{w.value=!0,r.value++,T.value=!1};return(k,f)=>{const L=Fe,n=Be,U=na;return e(O)&&!e(w)&&e(S).giftUrl?(t(),M("div",{key:0,class:"container",onClick:y},[u("div",_i,[u("div",yi,[s(L,{class:"icon",icon:"gift",size:"xlarge"}),f[1]||(f[1]=u("h4",null,"Gifts Unlocked!",-1))]),f[2]||(f[2]=u("div",{class:"body"},"We are giving away $100 worth of amazon coupons to our pro open source users!",-1))]),!P&&!e(r)?(t(),M("div",gi,f[3]||(f[3]=[u("img",{src:bi},null,-1)]))):E("",!0),s(n,{type:"text",size:"small",class:"close-icon",onClick:ve(a,["stop"])},{default:o(()=>[s(L,{icon:"close",size:"xlarge"})]),_:1}),s(U,{visible:e(T),"onUpdate:visible":f[0]||(f[0]=$=>le(T)?T.value=$:null),size:"small"},{default:o(()=>[u("div",null,[f[6]||(f[6]=u("div",{class:"mt-1 text-sm"},"Do you want to remind later on your next visit?",-1)),u("div",wi,[s(n,{type:"secondary",size:"small",onClick:D},{default:o(()=>f[4]||(f[4]=[A(" Don’t show again ")])),_:1}),s(n,{type:"primary",size:"small",onClick:C},{default:o(()=>f[5]||(f[5]=[A(" Yes ")])),_:1})])])]),_:1},8,["visible"])])):E("",!0)}}}),ki=Ue(xi,[["__scopeId","data-v-b7d729ea"]]),$i={};function hi(b,S){return t(),M("span")}const Ii=Ue($i,[["render",hi]]),Ti={class:"flex flex-1 w-full items-center gap-3"},Di={key:0,class:"w-3 h-3 pulsing-dot bg-nc-fill-red-medium border-2 border-white rounded-full"},Ci=ce({__name:"Feed",setup(b){const S=dt(),{navigateToFeed:r}=S,{isFeedPageOpened:l}=ae(S),{isNewFeedAvailable:i}=$o(),w=()=>r();return(T,P)=>{const O=Fe,y=Be,a=Ge("e");return Z((t(),p(y,{type:"text","full-width":"",size:"xsmall",class:te(["n!xs:hidden my-0.5 w-full !h-7 !rounded-md !font-normal !pl-4.5 !pr-5",{"!text-brand-600 !bg-brand-50 !hover:bg-brand-50":e(l),"!hover:bg-gray-200 !hover:text-gray-700":!e(l)}]),"data-testid":"nc-sidebar-product-feed",centered:!1,onClick:w},{default:o(()=>[u("div",{class:te(["flex !w-full items-center gap-2",{"font-semibold":e(l)}])},[u("div",Ti,[s(O,{icon:"megaPhone",class:"!h-4"}),P[0]||(P[0]=u("span",{class:""},"What’s New!",-1))]),e(i)?(t(),M("div",Di)):E("",!0)],2)]),_:1},8,["class"])),[[a,["c:nocodb:feed"]]])}}}),Si=Ue(Ci,[["__scopeId","data-v-ebffa263"]]),Vi={};function ji(b,S){return t(),M("span")}const Mi=Ue(Vi,[["render",ji]]),Pi=gt(()=>wt(()=>import("./B36oLxB9.js"),__vite__mapDeps([12,1,2]),import.meta.url).then(b=>b.default||b)),Ei=gt(()=>wt(()=>import("./CZuNEiKm.js"),__vite__mapDeps([13,14,1,2]),import.meta.url).then(b=>b.default||b)),Ni=gt(()=>wt(()=>import("./J1VSp1ZI.js"),__vite__mapDeps([15,16,1,2,17,18,19,20,21,22,23,24,25,26,27,28,29,30]),import.meta.url).then(b=>b.default||b)),Li={class:"flex w-full flex-col py-0.9 px-1 border-gray-200 gap-y-1"},Oi={class:"flex items-center pr-2 justify-between"},Ui={class:"flex flex-row py-1 px-3 gap-x-2 items-center hover:bg-gray-200 rounded-lg cursor-pointer h-8","data-testid":"nc-sidebar-userinfo"},Bi={class:"flex max-w-32 truncate"},Ri={class:"flex gap-2 items-center"},Ai={class:"menu-btn"},zi={class:"flex gap-2 items-center"},Gi={class:"flex items-center text-gray-400 text-xs"},Fi={class:"bg-white max-h-50vh scrollbar-thin-dull min-w-64 !overflow-auto"},Ki={href:"https://docs.nocodb.com",target:"_blank",class:"!underline-transparent",rel:"noopener"},Wi={class:"menu-btn"},Hi=ce({__name:"UserInfo",setup(b){const{user:S,signOut:r,appInfo:l}=De();mo();const{leftSidebarState:i}=ae(oa()),w=se(()=>{var f,L;return(L=(f=S.value)==null?void 0:f.display_name)==null?void 0:L.trim()}),T=I(!1),P=I(!1),O=I(!1),{isMobileMode:y}=De(),{isUIAllowed:a}=He(),D=async()=>{var f;O.value=!0;try{const L=!!((f=S==null?void 0:S.value)!=null&&f.sso_client_id);await r({redirectToSignin:!0,signinUrl:L?"/sso":"/signin"})}catch(L){console.error(L)}finally{O.value=!1}};Xe(T,()=>{P.value&&(P.value=!1)}),Xe(i,()=>{i.value==="peekCloseEnd"&&(T.value=!1)});const C=I(!1);jt(()=>{C.value=!0});const k=se(()=>a("superAdminSetup")&&!Qe?"/account/setup":"/account/profile");return(f,L)=>{const n=Pi,U=ho,$=Vt,c=Fe,d=ga,h=Ht,m=Ta,R=Zs,V=Ei,z=To,G=Mi,Y=Io,q=la,_=qt,j=Ni,B=Ge("e");return t(),M("div",Li,[s(n),u("div",Oi,[s(_,{visible:e(T),"onUpdate:visible":L[0]||(L[0]=F=>le(T)?T.value=F:null),placement:"topLeft","overlay-class-name":"!min-w-64"},{overlay:o(()=>[s(q,{"data-testid":"nc-sidebar-userinfo"},{default:o(()=>[s(h,{"data-testid":"nc-sidebar-user-logout",onClick:D},{default:o(()=>[Z((t(),M("div",Ri,[e(O)?(t(),p(d,{key:0,class:"!ml-0.5 !mr-0.5 !max-h-4.5 !-mt-0.5"})):(t(),p(c,{key:1,icon:"signout",class:"menu-icon"})),u("span",Ai,x(f.$t("general.logout")),1)])),[[B,["c:user:logout"]]])]),_:1}),s(m),e(l).ee?E("",!0):(t(),M(ge,{key:0},[s(m),s(z,{key:"language",class:"lang-menu !py-1.5",placement:"rightBottom"},{content:o(()=>[u("div",Fi,[s(V)])]),default:o(()=>[s(h,null,{default:o(()=>[Z((t(),M("div",zi,[s(c,{icon:"translate",class:"group-hover:text-black nc-language ml-0.25 menu-icon"}),A(" "+x(f.$t("labels.language"))+" ",1),u("div",Gi,x(f.$t("labels.community.communityTranslated")),1),L[1]||(L[1]=u("div",{class:"flex-1"},null,-1)),s(R,{class:"transform group-hover:scale-115 group-hover:text-accent text-xl text-gray-400"})])),[[B,["c:translate:open"]]])]),_:1})]),_:1})],64)),e(y)?E("",!0):(t(),M(ge,{key:1},[s(m),Z((t(),M("a",Ki,[s(h,null,{default:o(()=>[s(c,{icon:"file",class:"menu-icon mt-0.5"}),u("span",Wi,x(f.$t("title.docs")),1)]),_:1})])),[[B,["c:nocodb:docs-open"]]]),s(m),("isEeUI"in f?f.isEeUI:e(Qe))?(t(),p(G,{key:0})):E("",!0),Z((t(),p(Y,{class:"!no-underline",to:e(k)},{default:o(()=>[s(h,null,{default:o(()=>[s(c,{icon:"ncSettings",class:"menu-icon"}),A(" "+x(f.$t("title.accountSettings")),1)]),_:1})]),_:1},8,["to"])),[[B,["c:user:settings"]]])],64))]),_:1})]),default:o(()=>{var F,ee;return[u("div",Ui,[s(U,{email:(F=e(S))==null?void 0:F.email,size:"auto",name:(ee=e(S))==null?void 0:ee.display_name},null,8,["email","name"]),s($,null,{title:o(()=>{var ue;return[u("span",null,x(e(w)?e(w):(ue=e(S))==null?void 0:ue.email),1)]}),default:o(()=>{var ue;return[u("div",Bi,x(e(w)?e(w):(ue=e(S))==null?void 0:ue.email),1)]}),_:1}),s(c,{icon:"chevronDown",class:"flex-none !min-w-5 transform rotate-180 !text-gray-500"})])]}),_:1},8,["visible"]),s(j)]),e(y)||e(l).ee?(t(),M(ge,{key:0},[],64)):E("",!0)])}}}),qi=Ue(Hi,[["__scopeId","data-v-a8dc1832"]]),Ji={class:"nc-sidebar flex flex-col bg-gray-50 outline-r-1 outline-gray-100 select-none w-full h-full",style:{outlineWidth:"1px"}},Yi={class:"flex flex-col"},Qi={key:0,class:"flex-none overflow-auto"},Zi=ce({__name:"Sidebar",setup(b){const S=dt(),{isWorkspaceLoading:r}=ae(S),{isSharedBase:l}=ae(qe()),{isMobileMode:i,appInfo:w}=De(),T=I(),P=I(!1),O=()=>{if(!i.value)return T.value&&(T.value.scrollTop>0?P.value=!0:P.value=!1),!1};return jt(()=>{var y;(y=T.value)==null||y.addEventListener("scroll",O)}),Xs(()=>{var y;(y=T.value)==null||y.removeEventListener("scroll",O)}),(y,a)=>{const D=Uo,C=Zo,k=vi,f=ki,L=Ii,n=Si,U=qi;return t(),M("div",Ji,[u("div",Yi,[s(D),e(l)?E("",!0):(t(),p(C,{key:0}))]),u("div",{ref_key:"treeViewDom",ref:T,class:te(["flex flex-col nc-scrollbar-dark-md flex-grow xs:border-transparent xs:pt-2 xs:pr-2",{"border-t-1":!e(l),"border-transparent":!e(P),"pt-0.25":e(l)}])},[e(r)?E("",!0):(t(),p(k,{key:0}))],2),e(l)?E("",!0):(t(),M("div",Qi,[("isEeUI"in y?y.isEeUI:e(Qe))?E("",!0):(t(),p(f,{key:0})),a[0]||(a[0]=u("div",{class:"border-t-1 w-full"},null,-1)),s(L),e(w).feedEnabled?(t(),p(n,{key:1})):E("",!0),s(U)]))])}}}),Xi=Ue(Zi,[["__scopeId","data-v-239057b7"]]),er={class:"prose-xl font-bold self-center"},tr={class:"prose-md self-center text-gray-500 mt-4"},ar={class:"text-xs p-2"},sr={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},or=ce({__name:"SharedBaseDuplicate",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(b,{emit:S}){const r=b,l=S,{api:i}=Kt(),{sharedBaseId:w}=fs(),T=dt(),{populateWorkspace:P}=T,{workspacesList:O}=ae(T),{ncNavigateTo:y}=De(),a=et(r,"modelValue",l),D=I({includeData:!0,includeViews:!0}),C=se(()=>{const{includeData:c,includeViews:d}=D.value;return{excludeData:!c,excludeViews:!d}}),k=I(!1),f=I(),{$e:L,$poller:n}=Le(),U=async()=>{if(!(!f.value&&Qe))try{k.value=!0;const c=await i.base.duplicateShared(f.value??"nc",w.value,{options:C.value,base:Qe?{fk_workspace_id:f.value,type:eo.DATABASE}:{}});w.value=null,n.subscribe({id:c.id},async d=>{d.status!=="close"&&(d.status===St.COMPLETED?(console.log("job completed",c),await y({...Qe?{workspaceId:c.fk_workspace_id}:{},baseId:c.base_id}),k.value=!1,a.value=!1):d.status===St.FAILED&&(me.error("Failed to duplicate shared base"),await P(),k.value=!1,a.value=!1))}),L("a:base:duplicate-shared-base")}catch(c){me.error(await Ne(c)),k.value=!1,a.value=!1}},$=se(()=>{var c;return(c=O.value)==null?void 0:c.filter(d=>d.roles===es.OWNER||d.roles===es.CREATOR).map(d=>({label:`${d.title[0].toUpperCase()}${d.title.slice(1)}`,value:d.id}))});return(c,d)=>{const h=Do,m=Ia,R=ha,V=Be,z=Pt,G=Ge("e");return t(),p(z,{visible:e(a),"onUpdate:visible":d[4]||(d[4]=Y=>le(a)?a.value=Y:null),class:"!w-[30rem]","wrap-class-name":"nc-modal-project-duplicate"},{default:o(()=>[u("div",null,[u("div",er,x(c.$t("general.duplicate"))+" "+x(c.$t("labels.sharedBase")),1),("isEeUI"in c?c.isEeUI:e(Qe))?(t(),M(ge,{key:0},[d[5]||(d[5]=u("div",{class:"my-4"},"Select workspace to duplicate shared base to:",-1)),s(h,{value:e(f),"onUpdate:value":d[0]||(d[0]=Y=>le(f)?f.value=Y:null),class:"w-full",options:e($),placeholder:"Select Workspace"},null,8,["value","options"])],64)):E("",!0),u("div",tr,x(c.$t("title.advancedSettings")),1),s(m,{class:"!m-0 !p-0 !my-2"}),u("div",ar,[s(R,{checked:e(D).includeData,"onUpdate:checked":d[1]||(d[1]=Y=>e(D).includeData=Y)},{default:o(()=>[A(x(c.$t("labels.includeData")),1)]),_:1},8,["checked"]),s(R,{checked:e(D).includeViews,"onUpdate:checked":d[2]||(d[2]=Y=>e(D).includeViews=Y)},{default:o(()=>[A(x(c.$t("labels.includeView")),1)]),_:1},8,["checked"])])]),u("div",sr,[s(V,{key:"back",type:"secondary",onClick:d[3]||(d[3]=Y=>a.value=!1)},{default:o(()=>[A(x(c.$t("general.cancel")),1)]),_:1}),Z((t(),p(V,{key:"submit",loading:e(k),disabled:!e(f)&&("isEeUI"in c?c.isEeUI:e(Qe)),onClick:U},{default:o(()=>[A(x(c.$t("general.confirm")),1)]),_:1},8,["loading","disabled"])),[[G,["a:shared-base:duplicate"]]])])]),_:1},8,["visible"])}}}),nr=gt(()=>wt(()=>import("./BNg0gwea.js"),__vite__mapDeps([31,1,2,8,9,10,32,33,34]),import.meta.url).then(b=>b.default||b)),gc=ce({__name:"index",setup(b){const S=I(!1),r=I(""),l=I(""),i=I(),w=st(),{populateWorkspace:T}=dt(),{signedIn:P}=De(),{isUIAllowed:O}=He(),a=xa().currentRoute,{basesList:D}=ae(w),C=async()=>{const c=a.value.name;c!=="index-typeOrId"&&c!=="index"||await w.navigateToProject({baseId:D.value[0].id})},k=se(()=>{const c=a.value.name||"";return!c.startsWith("index-typeOrId-baseId-")&&!["index","index-typeOrId","index-typeOrId-feed","index-typeOrId-integrations"].includes(c)}),f=se(()=>(a.value.name||"").startsWith("index-typeOrId-form-viewId")),{sharedBaseId:L}=fs(),n=I(!1);async function U(){if(!k.value){if(a.value.params.typeOrId==="base"){await T();return}if(!P.value){Xt("/signIn");return}await T(),!a.value.params.baseId&&D.value.length>0&&await C()}}Xe(()=>a.value.params.typeOrId,()=>{U()}),jt(()=>{U().then(()=>{if(L.value){if(!O("baseDuplicate")){me.error("You are not allowed to create base");return}n.value=!0}})});function $(c,d,h,m){S.value=c??!S.value,r.value=d||"",l.value=h||"",i.value=m||""}return _t(rs,$),(c,d)=>{const h=to,m=ao,R=Xi,V=nr,z=or;return t(),M("div",null,[e(f)?(t(),p(m,{key:0},{default:o(()=>[s(h)]),_:1})):e(k)?(t(),p(m,{key:1,name:"shared-view"},{default:o(()=>[s(h)]),_:1})):(t(),p(m,{key:2,name:"dashboard"},{sidebar:o(()=>[s(R)]),content:o(()=>[s(h)]),_:1})),s(V,{"model-value":e(S),"onUpdate:modelValue":d[0]||(d[0]=G=>le(S)?S.value=G:null),"open-key":e(r),"onUpdate:openKey":d[1]||(d[1]=G=>le(r)?r.value=G:null),"data-sources-state":e(l),"onUpdate:dataSourcesState":d[2]||(d[2]=G=>le(l)?l.value=G:null),"base-id":e(i)},null,8,["model-value","open-key","data-sources-state","base-id"]),e(O)("baseDuplicate")?(t(),p(z,{key:3,modelValue:e(n),"onUpdate:modelValue":d[3]||(d[3]=G=>le(n)?n.value=G:null)},null,8,["modelValue"])):E("",!0)])}}});export{gc as default};
