import{f as K,ai as Q,as as X,aA as Z,r as k,g0 as c,g as T,o as n,S as m,w as r,a as t,b as l,d as ee,t as i,P as o,c as C,V as U,W as R,a9 as te,Y as se,T as E,U as oe,aj as _,ak as ae,hy as le,hV as re,aV as ie,$ as ne,cc as ce,A as de,_ as me}from"./Cgw6cdOy.js";import{_ as ue}from"./CJBRTPd8.js";import{u as pe}from"./DgdUBGGc.js";import{h as _e}from"./DCaZaUH5.js";import{_ as ve}from"./CGa6nQ65.js";import{F as I}from"./DpYA1Dpy.js";import{T as fe}from"./D7Mj6For.js";import"./Bcy-XIkn.js";import{I as xe}from"./DPaOlBFV.js";import{_ as ye}from"./CpJUN2HL.js";import{_ as he}from"./dmcxUY_0.js";import{S as ge}from"./D8rpj5Lr.js";import"./LSbsNkd9.js";import"./hvq8FVej.js";import"./BIsWr_mR.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";import"./BZz6iAla.js";import"./BcZAlRJW.js";const we={class:"flex flex-col"},be={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 w-full"},$e={class:"px-2 mt-1.5"},ke={key:0,class:"flex flex-col mt-1 pb-5"},Te={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},Ce={class:"text-xs ml-0.5 mt-0.5","data-rec":"true"},Ue={class:"flex flex-row justify-between items-center py-1"},Re={class:"flex pl-2 text-green-700 text-xs","data-rec":"true"},Ee={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2","data-rec":"true"},Ie={class:"flex flex-row justify-end mt-4 ml-2"},Me={class:"flex flex-row justify-center items-center space-x-0.5"},Ve={class:"text-xs text-gray-600","data-rec":"true"},je={key:1,class:"flex flex-col pb-4"},Be={class:"border-1 py-3 px-4 rounded-md mt-1"},Se={class:"flex flex-row space-x-4"},Ne={class:"flex flex-col w-3/4"},Ae={class:"ml-1 mb-1 text-xs text-gray-500","data-rec":"true"},De={class:"flex flex-col w-2/4"},Fe={class:"ml-1 mb-1 text-xs text-gray-500"},Le={class:"flex items-center gap-1 justify-between"},Oe={"data-rec":"true"},Pe={class:"text-gray-500 text-xs whitespace-normal","data-rec":"true"},We={class:"flex items-center gap-1 justify-between"},qe={"data-rec":"true"},ze={class:"text-gray-500 text-xs whitespace-normal","data-rec":"true"},Ge={class:"flex flex-row justify-end"},Ye={class:"flex flex-row justify-center items-center space-x-1.5"},He={"data-rec":"true"},Je=K({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(Ke,{emit:M}){const v=M,{t:y}=Q(),{$api:V,$e:f}=de(),{copy:j}=X(),{dashboardUrl:B}=pe(),{clearBasesUser:S}=Z(),s=k({emails:"",role:c.VIEWER,invitationToken:void 0}),h=k(),N=I.useForm,A=T(()=>({emails:[_e]})),{validateInfos:D}=N(s.value,A),F=async()=>{var e;f("a:org-user:invite",{role:s.value.role}),await((e=h.value)==null?void 0:e.validateFields());try{const a=await V.orgUsers.add({roles:s.value.role,email:s.value.emails});s.value.invitationToken=a.invite_token,v("reload"),_.success(y("msg.success.userAdded")),S()}catch(a){console.error(a),_.error(await ae(a))}},x=T(()=>s.value.invitationToken?`${B.value}#/signup/${s.value.invitationToken}`:null),L=async()=>{if(x.value){try{await j(x.value),_.success(y("msg.toast.inviteUrlCopy"))}catch(e){_.error(e.message)}f("c:shared-base:copy-url")}},O=()=>{f("c:user:invite-more"),s.value.invitationToken=void 0,s.value.role=c.VIEWER,s.value.emails=""},P=e=>e==null?void 0:e.focus(),W=e=>{var u;const a=((u=e.clipboardData)==null?void 0:u.getData("text"))??"";s.value.emails=le(a)||a};return(e,a)=>{const u=fe,q=re,p=ie,z=ye,g=ve,G=xe,w=he,b=ne,$=ge,Y=ue,H=I,J=ce;return n(),m(J,{class:oe({active:e.show}),footer:null,centered:"",visible:e.show,closable:!1,width:"max(50vw, 44rem)","wrap-class-name":"nc-modal-invite-user",onCancel:a[3]||(a[3]=d=>v("closed"))},{default:r(()=>[t("div",we,[t("div",be,[l(u,{class:"select-none",level:4,"data-rec":"true"},{default:r(()=>[ee(i(e.$t("activity.inviteUser")),1)]),_:1}),l(p,{type:"text",class:"!rounded-md mr-1 -mt-1.5",onClick:a[0]||(a[0]=d=>v("closed"))},{icon:r(()=>[l(q,{"data-testid":"nc-root-user-invite-modal-close",class:"flex mx-auto"})]),_:1})]),t("div",$e,[o(s).invitationToken?(n(),C("div",ke,[t("div",Te,[(n(),m(U(("iconMap"in e?e.iconMap:o(R)).account))),t("div",Ce,i(e.$t("activity.copyInviteURL")),1)]),l(z,{class:"!mt-2",type:"success","show-icon":""},{message:r(()=>[t("div",Ue,[t("div",Re,i(o(x)),1),l(p,{type:"text",class:"!rounded-md -mt-0.5",onClick:L},{icon:r(()=>[(n(),m(U(("iconMap"in e?e.iconMap:o(R)).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),t("div",Ee,i(e.$t("msg.info.userInviteNoSMTP"))+" "+i(o(s).invitationToken&&o(s).emails),1),t("div",Ie,[l(p,{size:"middle",outlined:"",onClick:O},{default:r(()=>[t("div",Me,[l(g,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),t("div",Ve,i(e.$t("activity.inviteMore")),1)])]),_:1})])])):(n(),C("div",je,[t("div",Be,[l(H,{ref_key:"formRef",ref:h,"validate-on-rule-change":!1,model:o(s),"validate-trigger":"onBlur",onFinish:F},{default:r(()=>[t("div",Se,[t("div",Ne,[l(w,te(o(D).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:e.$t("msg.plsInputEmail")}]}),{default:r(()=>[t("div",Ae,i(e.$t("datatype.Email"))+":",1),l(G,{ref:P,value:o(s).emails,"onUpdate:value":a[1]||(a[1]=d=>o(s).emails=d),size:"middle",class:"nc-input-sm","validate-trigger":"onBlur",placeholder:e.$t("labels.email"),onPaste:se(W,["prevent"])},null,8,["value","placeholder"])]),_:1},16,["rules"])]),t("div",De,[l(w,{name:"role",rules:[{required:!0,message:e.$t("msg.roleRequired")}]},{default:r(()=>[t("div",Fe,i(e.$t("labels.selectUserRole")),1),l(Y,{value:o(s).role,"onUpdate:value":a[2]||(a[2]=d=>o(s).role=d),class:"w-55 nc-user-roles","dropdown-match-select-width":!1,"dropdown-class-name":"nc-dropdown-user-role max-w-64"},{default:r(()=>[l($,{class:"nc-role-option",value:o(c).CREATOR,label:e.$t("objects.roleType.orgLevelCreator")},{default:r(()=>[t("div",Le,[t("div",Oe,i(e.$t("objects.roleType.orgLevelCreator")),1),o(s).role===o(c).CREATOR?(n(),m(b,{key:0,id:"nc-selected-item-icon",icon:"check",class:"w-4 h-4 text-primary"})):E("",!0)]),t("div",Pe,i(e.$t("msg.info.roles.orgCreator")),1)]),_:1},8,["value","label"]),l($,{class:"nc-role-option",value:o(c).VIEWER,label:e.$t("objects.roleType.orgLevelViewer")},{default:r(()=>[t("div",We,[t("div",qe,i(e.$t("objects.roleType.orgLevelViewer")),1),o(s).role===o(c).VIEWER?(n(),m(b,{key:0,id:"nc-selected-item-icon",icon:"check",class:"w-4 h-4 text-primary"})):E("",!0)]),t("div",ze,i(e.$t("msg.info.roles.orgViewer")),1)]),_:1},8,["value","label"])]),_:1},8,["value"])]),_:1},8,["rules"])])]),t("div",Ge,[l(p,{type:"primary",class:"!rounded-md","html-type":"submit"},{default:r(()=>[t("div",Ye,[l(g,{class:"flex h-[0.8rem]"}),t("div",He,i(e.$t("activity.invite")),1)])]),_:1})])]),_:1},8,["model"])])]))])])]),_:1},8,["class","visible"])}}}),xt=me(Je,[["__scopeId","data-v-41f4dbf8"]]);export{xt as default};
