import P from"./CBZqTOye.js";import z from"./-QMWbHL6.js";import{_ as Y}from"./CF0GO8gh.js";import{f as j,ac as O,bL as h,fH as J,r as k,d0 as R,cP as G,N as Q,cB as q,cG as W,o as v,U as x,w as g,P as o,c as X,fG as Z,a as r,t as c,S as F,Q as H,fw as ee,fI as te,an as L,ao as U,A as K,ag as ae,at as se,cH as oe,g6 as le,g as ne,ad as ie,b as E,d as A,T as ce,aF as re,cT as N,a2 as ue,h9 as de}from"./nEPQs079.js";import{_ as me}from"./Gr6cVSxP.js";import{a as pe}from"./vKaAFL5T.js";import{C as fe}from"./BfnA8LRy.js";import{_ as _e}from"./C5mABW8R.js";const ve={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700 mb-4"},be={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.5",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ie=j({__name:"DeleteColumnModal",props:{visible:{type:Boolean},onDeleteColumn:{type:Function}},emits:["update:visible"],setup($,{emit:D}){const u=$,d=O(u,"visible",D),{$api:S,$e:l}=K(),e=h(J),m=h(R,k()),{getMeta:p}=G(),{includeM2M:T}=Q(),{loadTables:M}=q(),V=W(),f=k(!1),I=async()=>{var s,n,i,t,a,_,C,y;if(e!=null&&e.value){f.value=!0;try{await S.dbTableColumn.delete((s=e==null?void 0:e.value)==null?void 0:s.id),await p((n=m==null?void 0:m.value)==null?void 0:n.id,!0),ee(e==null?void 0:e.value)&&((i=e.value)!=null&&i.colOptions)&&(await p(((t=e.value)==null?void 0:t.colOptions).fk_related_model_id,!0),T.value&&((a=e.value)==null?void 0:a.colOptions).type===te.MANY_TO_MANY&&M()),V.updateViewCoverImageColumnId({metaId:(_=m.value)==null?void 0:_.id,columnIds:new Set([(C=e==null?void 0:e.value)==null?void 0:C.id])}),l("a:column:delete"),d.value=!1,(y=u.onDeleteColumn)==null||y.call(u)}catch(B){L.error(await U(B))}finally{f.value=!1}}};return(s,n)=>{const i=P,t=z,a=Y;return v(),x(a,{visible:o(d),"onUpdate:visible":n[0]||(n[0]=_=>H(d)?d.value=_:null),"entity-name":s.$t("objects.column"),"on-delete":I},{"entity-preview":g(()=>[o(e)?(v(),X("div",ve,[o(Z)(o(e))?(v(),x(i,{key:0,class:"nc-view-icon"})):(v(),x(t,{key:1,class:"nc-view-icon"})),r("div",be,c(o(e).title),1)])):F("",!0)]),_:1},8,["visible","entity-name"])}}}),ye={class:"prose-xl font-bold self-center"},we=r("div",{class:"mt-4"},"Are you sure you want to duplicate the field?",-1),ge={class:"prose-md self-center text-gray-500 mt-4"},ke={class:"text-xs p-2"},xe={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},Be=j({__name:"ColumnDuplicate",props:{modelValue:{type:Boolean},column:{},extra:{}},emits:["update:modelValue"],setup($,{expose:D,emit:u}){const b=$,d=u,{api:S}=ae(),l=O(b,"modelValue",d),{$e:e,$poller:m}=K();se(oe());const p=h(le),{eventBus:T}=pe(),{getMeta:M}=G(),V=h(R,k()),f=k({includeData:!0}),I=ne(()=>{const{includeData:t}=f.value;return{excludeData:!t}}),s=k(!1),n=async()=>{await M(V.value.id,!0),T.emit(de.FIELD_RELOAD),p==null||p.trigger()},i=async()=>{try{s.value=!0;const t=await S.dbTable.duplicateColumn(b.column.base_id,b.column.id,{options:I.value,extra:b.extra});m.subscribe({id:t.id},async a=>{a.status!=="close"&&(a.status===N.COMPLETED?(n(),s.value=!1,l.value=!1):a.status===N.FAILED&&(L.error("There was an error duplicating the column."),n(),s.value=!1,l.value=!1))}),e("a:column:duplicate")}catch(t){L.error(await U(t)),s.value=!1,l.value=!1}};return ie("Enter",()=>{l.value&&i()}),D({duplicate:i}),(t,a)=>{const _=_e,C=fe,y=ue,B=me;return v(),x(B,{visible:o(l),"onUpdate:visible":a[2]||(a[2]=w=>H(l)?l.value=w:null),class:ce([{active:o(l)},"!w-[30rem]"]),closable:!o(s),"mask-closable":!o(s),keyboard:!o(s),centered:"","wrap-class-name":"nc-modal-column-duplicate",footer:null,onKeydown:a[3]||(a[3]=re(w=>l.value=!1,["esc"]))},{default:g(()=>[r("div",null,[r("div",ye,c(t.$t("general.duplicate"))+" "+c(t.$t("objects.column")),1),we,r("div",ge,c(t.$t("title.advancedSettings")),1),E(_,{class:"!m-0 !p-0 !my-2"}),r("div",ke,[E(C,{checked:o(f).includeData,"onUpdate:checked":a[0]||(a[0]=w=>o(f).includeData=w),disabled:o(s)},{default:g(()=>[A(c(t.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"])])]),r("div",xe,[o(s)?F("",!0):(v(),x(y,{key:"back",type:"secondary",onClick:a[1]||(a[1]=w=>l.value=!1)},{default:g(()=>[A(c(t.$t("general.cancel")),1)]),_:1})),E(y,{key:"submit",type:"primary",loading:o(s),onClick:i},{default:g(()=>[A(c(t.$t("general.confirm")),1)]),_:1},8,["loading"])])]),_:1},8,["visible","class","closable","mask-closable","keyboard"])}}});export{Ie as _,Be as a};
