const __vite__fileDeps=["./DXof0zKo.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css","./D51uA4Lq.js","./DpDIhxXu.js","./BBXMuneh.js","./VirtualCell.BYk4C8Tn.css","./DQfYvTkb.js","./r2PN1Hfg.js","./CO8XXsKl.js","./vIgbYHAs.js","./boyBAVNN.js","./D7yS5JAk.js","./Cell.DUBzJZSm.css","./CJNyL6pj.js","./VirtualCell.DaTWCMZu.css","./CBOrWF0V.js","./Dqwep-0C.js","./Cell.CE2XxAOg.css","./Bys73o5q.js","./C1WkfNyL.js","./DBOeGHNL.js","./MenuItem.C7h59s4s.css","./C6pQ4eSP.js","./VVwMOds3.js","./Divider.DqtSqZhb.css","./Bxm040c6.js","./Menu.CQ8GNWeI.css","./CiTH7PYd.js","./H9SMaBKT.js","./DivDataCell.1yCNpUg3.css","./Do1LnTan.js","./UserIcon.DEVmGavY.css","./DRVKgtZT.js","./Cw6_lRNR.js","./Badge.D0-UrqG9.css","./DGBAbsZ-.js","./Cy50pBgZ.js","./Bcy-XIkn.js","./DPaOlBFV.js","./BQQOEPN4.js","./hvq8FVej.js","./C8c9012h.js","./BIsWr_mR.js","./BZz6iAla.js","./links.C8uCzV-l.css","./Dwil3It4.js","./DgdUBGGc.js","./DzMG5wJt.js","./DvfxijkH.js","./BtFqRdSP.js","./BPivYv4D.js","./BK3iCpwL.js","./DFiWgQ57.js","./CAuyt8bq.js","./Tabs.DaLSLYpn.css","./WttlrBnq.js","./S1x-kZdE.js","./DeleteModal.SEMJ_gSK.css","./CpJUN2HL.js","./BcpeJQoi.js","./CnN16FGu.js","./ahvdY77A.js","./cCmEAZwU.js","./CHLXm8Ls.js","./index.MCJqUXFi.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as ft,bc as Jt,bN as U,r as f,da as _t,cZ as Yt,o,S as n,w as s,b as m,P as e,Q as ee,d9 as Zt,gD as Qt,hn as Xt,dK as ea,ho as ta,db as aa,dB as oa,aB as ye,hK as la,u as na,az as sa,cR as ia,L as ra,N as da,c_ as ca,aF as ua,hM as ma,hL as pa,hN as fa,g as W,hh as _a,df as Oe,ij as Te,b1 as it,l as va,H as rt,d7 as ga,O as ya,c as v,a as i,aa as Me,aq as J,av as Be,co as Fe,R as Y,V as j,W as L,d as I,t as p,T as w,U as R,dj as X,fP as Ne,Y as dt,dI as ct,Z as te,a6 as ae,aN as wa,$ as ha,a0 as ba,a1 as xa,ft as ka,p as Ca,e as Sa,dd as Ia,_ as Ra}from"./Cgw6cdOy.js";import{u as Ma,_ as Va}from"./ChdiWx0E.js";import{F as $a}from"./DpYA1Dpy.js";import{_ as ja}from"./DBOeGHNL.js";import{_ as La}from"./C6pQ4eSP.js";import{_ as za}from"./Bxm040c6.js";import{_ as Da}from"./CiTH7PYd.js";import{_ as Ea}from"./WttlrBnq.js";import{u as Aa}from"./BcWX645D.js";import{a as Oa}from"./BcpeJQoi.js";import{a as Ta}from"./BK3iCpwL.js";import{D as Ba,C as ut}from"./BBXMuneh.js";import{j as mt,e as Ve}from"./D7yS5JAk.js";import{i as Fa}from"./C00NHga8.js";import{_ as Na}from"./Cfg3mPCN.js";import{D as pt}from"./tqKkZMzS.js";import{S as Ua}from"./cCmEAZwU.js";import{T as Pa}from"./BBFld1ZO.js";import{b as Ha,L as qa,c as Ka,_ as Ga}from"./ByWnxpgj.js";import{_ as Wa}from"./SnuQkHMZ.js";import"./DCaZaUH5.js";import"./F-dFAGVG.js";import"./BRorwQ1i.js";import"./Bcy-XIkn.js";import"./DPaOlBFV.js";import"./BQQOEPN4.js";import"./hvq8FVej.js";import"./C8c9012h.js";import"./BIsWr_mR.js";import"./BZz6iAla.js";import"./dmcxUY_0.js";import"./BcZAlRJW.js";import"./LSbsNkd9.js";import"./VVwMOds3.js";import"./S1x-kZdE.js";import"./CpJUN2HL.js";import"./CO8XXsKl.js";import"./DFiWgQ57.js";import"./boyBAVNN.js";import"./CHLXm8Ls.js";import"./DBJzESM9.js";const Ja=ft({__name:"EditOrAddStack",props:{column:{},optionId:{},isNewStack:{type:Boolean}},emits:["submit","cancel"],setup(u,{emit:M}){const oe=u,le=M,{column:ce,optionId:O,isNewStack:h}=Jt(oe),_=U(_t,f()),{formState:V,addOrUpdate:Z}=Ma(_,ce,void 0,void 0,void 0,f(!0)),{getMeta:we}=Yt(),Q=async()=>{var T;await we((T=_.value)==null?void 0:T.id,!0)};async function ne(T=!1,D=!0,P){if(!D&&T){le("submit");return}const ue=await Z(Q);T&&ue&&le("submit",!0,P)}return(T,D)=>{const P=Va,ue=$a;return o(),n(ue,{modelValue:e(V),"onUpdate:modelValue":D[1]||(D[1]=H=>ee(V)?V.value=H:null),"no-style":"",name:"column-create-or-edit",layout:"vertical","data-testid":"add-or-edit-column",class:"w-full flex"},{default:s(()=>[m(P,{value:e(V),"onUpdate:value":D[0]||(D[0]=H=>ee(V)?V.value=H:null),"is-kanban-stack":"","option-id":e(O),"is-new-stack":e(h),onSaveChanges:ne},null,8,["value","option-id","is-new-stack"])]),_:1},8,["modelValue"])}}}),Ya=te(()=>ae(()=>import("./DXof0zKo.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(u=>u.default||u)),Za=te(()=>ae(()=>import("./D51uA4Lq.js"),__vite__mapDeps([3,1,2,4,5,6]),import.meta.url).then(u=>u.default||u)),Qa=te(()=>ae(()=>import("./DQfYvTkb.js"),__vite__mapDeps([7,1,2,8,9,10,4,11,12,5,13]),import.meta.url).then(u=>u.default||u)),Xa=te(()=>ae(()=>import("./CJNyL6pj.js"),__vite__mapDeps([14,1,2,4,12,15]),import.meta.url).then(u=>u.default||u)),eo=te(()=>ae(()=>import("./CBOrWF0V.js"),__vite__mapDeps([16,1,2,17,5,18]),import.meta.url).then(u=>u.default||u)),to=te(()=>ae(()=>import("./Bys73o5q.js"),__vite__mapDeps([19,8,9,1,2,10,4,11,12]),import.meta.url).then(u=>u.default||u)),ao=te(()=>ae(()=>import("./C1WkfNyL.js"),__vite__mapDeps([20,1,2,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,9,12,51,8,10,4,11,52,53,54,55,56,57,58,59,60,61,62,63,64,65]),import.meta.url).then(u=>u.default||u)),vt=u=>(Ca("data-v-4df2eb35"),u=u(),Sa(),u),oo={class:"flex flex-col w-full bg-gray-50 h-full","data-testid":"nc-kanban-wrapper",style:{minHeight:"calc(100% - var(--topbar-height))"}},lo={key:0,class:"flex flex-row min-h-full gap-x-2"},no={class:"flex gap-3"},so=["data-testid"],io={key:0,class:"mt-2.5 px-3 !w-full"},ro={"data-testid":"nc-kanban-stack-title",class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},co={class:"flex gap-2 items-center"},uo={class:"flex gap-2 items-center"},mo={class:"flex gap-2 items-center"},po={class:"flex gap-2 items-center"},fo={class:"flex gap-2 items-center"},_o={class:"flex gap-2 items-center"},vo=["data-stack-title"],go={class:"nc-kanban-item py-1 first:pt-2 last:pb-2"},yo=vt(()=>i("a",null,[i("div",null,[i("div")])],-1)),wo={class:"z-10 arrow"},ho={class:"z-10 arrow"},bo={key:1,class:"h-52 w-full !flex flex-row !border-b-1 !border-gray-200 items-center justify-center"},xo=vt(()=>i("img",{class:"object-contain w-[48px] h-[48px]",src:Na},null,-1)),ko=[xo],Co={class:"flex flex-col gap-3 !children:pointer-events-none"},So={key:0,class:"nc-card-display-value-wrapper"},Io=["onClick"],Ro={class:"flex flex-col rounded-lg w-full"},Mo={class:"flex flex-row w-full justify-start"},Vo={class:"nc-card-col-header w-full !children:text-gray-500"},$o={key:0,class:"flex flex-row w-full text-gray-800 items-center justify-start min-h-7 py-1"},jo={key:1,class:"flex flex-row w-full h-7 pl-1 items-center justify-start"},Lo={class:"h-full w-full flex flex-col gap-4 items-center justify-center"},zo={class:"flex flex-col items-center gap-2 text-gray-600 text-center"},Do={class:"text-sm font-semibold"},Eo={class:"text-xs font-weight-500"},Ao={class:"flex items-center gap-2"},Oo={class:"flex items-center justify-between"},To={class:"flex items-center gap-2"},Bo={key:1},Fo={class:"nc-kanban-data-count text-gray-500 font-weight-500 px-1"},No=["onClick"],Uo={key:0,class:"!w-full !h-full flex items-center justify-center"},Po={key:1,class:"nc-kanban-stack-head w-full flex items-center justify-between gap-2"},Ho={class:"flex items-center gap-1"},qo={class:"flex-1 flex max-w-[115px]"},Ko={"data-testid":"nc-kanban-stack-title",class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Go={class:"flex items-center gap-2 truncate"},Wo={class:"nc-kanban-data-count px-1 rounded bg-gray-200 text-gray-800 text-sm font-weight-500 truncate",style:{"word-break":"keep-all","white-space":"nowrap"}},Jo={key:0,class:"nc-kanban-add-new-stack"},Yo={key:0,class:"mt-2.5 px-3 !w-full"},Zo={class:"flex items-center gap-2"},Qo={class:"flex items-center gap-2 nc-kanban-context-menu-item"},Xo={class:"flex items-center gap-2 nc-kanban-context-menu-item"},el={key:0,class:"flex flex-row items-center py-2 px-2.25 bg-gray-100 rounded-lg text-gray-700 mb-4"},tl={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},al=100,ol=ft({__name:"Kanban",setup(u){const M=U(_t,f()),oe=U(Zt,f()),le=U(Qt),ce=U(Xt),O=U(ta,ea()),h=U(aa,f(!1)),_=U(oa,f(!1)),V=f(!1),Z=f(),we=f();ye(la,f(1));const Q=f(!1),ne=f(""),T=f(0),D=na(),P=D.currentRoute,{getPossibleAttachmentSrc:ue}=Aa(),{metaColumnById:H}=Oa(),{loadKanbanData:Ue,loadMoreKanbanData:gt,loadKanbanMeta:he,kanbanMetaData:me,formattedData:E,updateOrSaveRow:yt,updateKanbanMeta:wt,addEmptyRow:ht,groupingFieldColOptions:x,updateKanbanStackMeta:$e,groupingField:Pe,groupingFieldColumn:je,countByStack:C,deleteStack:bt,shouldScrollToRight:He,deleteRow:xt,moveHistory:qe,addNewStackId:Le,removeRowFromUncategorizedStack:kt}=Ta(),{isViewDataLoading:be}=sa(ia()),{isUIAllowed:ze}=ra(),{appInfo:Ct,isMobileMode:Ke}=da(),{addUndo:St,defineViewScope:It}=ca();ye(ua,f(!1)),ye(ma,f(!1)),ye(pa,f(!1)),ye(fa,f(!0));const S=W(()=>ze("dataEdit")),Ge=U(_a,f([])),Rt=W(()=>Ge.value.filter(t=>!Ba(t))),B=W(()=>{var t,a;return((a=(t=M.value)==null?void 0:t.columns)==null?void 0:a.find(r=>r.pv&&Ge.value.includes(r)))??null}),pe=W(()=>{var t,a;return(t=M.value)!=null&&t.columnsById?M.value.columnsById[(a=me.value)==null?void 0:a.fk_cover_image_col_id]:{}}),Mt=W(()=>{var a,r;const t=((r=Oe((a=me.value)==null?void 0:a.meta))==null?void 0:r.fk_cover_image_object_fit)||Te.FIT;if(t===Te.FIT)return"!object-contain";if(t===Te.COVER)return"!object-cover"}),xe=f(),fe=f("");le==null||le.on(async()=>{await he(),await Ue()});const De=t=>{var a;if(!((a=pe.value)!=null&&a.title)||!t.row[pe.value.title])return[];try{const r=typeof t.row[pe.value.title]=="string"?JSON.parse(t.row[pe.value.title]):t.row[pe.value.title];return Array.isArray(r)?r.flat().map(y=>typeof y=="string"?JSON.parse(y):y).filter(y=>y&&!Array.isArray(y)&&typeof y=="object"&&Object.keys(y).length):[]}catch{return[]}},Ee=f(!1);ce==null||ce.on(async()=>{await he(),Ee.value=!0,it(()=>{Ee.value=!1})});const ke=(t,a)=>{const r=Ve(t.row,M.value.columns);we.value=a,r&&!_.value?(Z.value=void 0,D.push({query:{...P.value.query,rowId:r}})):(Z.value=t,V.value=!0)},We=f(!1),se=W({get:()=>We.value,set:t=>{S.value&&(We.value=t)}}),ie=f(null),Vt=(t,a)=>{t.preventDefault(),a&&(ie.value=a)},Ce=W({get(){return!!P.value.query.rowId},set(t){t||D.push({query:{...P.value.query,rowId:void 0}})}}),$t=async(t,a)=>{const r=t.target;r.closest(".arrow")||r.closest(".slick-dots")||t.target&&ke(a)};function jt(t){if(t.draggedContext.futureIndex===0)return!1}async function Ae(t,a=!1){if(t.moved){const{oldIndex:r,newIndex:y}=t.moved,{fk_grp_col_id:$,meta:z}=me.value;x.value[r].order=y,x.value[y].order=r;const ve=Oe(z)||{};ve[$]=x.value,await wt({meta:ve}),a||St({undo:{fn:async A=>{const re=x.value.splice(A.moved.newIndex,1);x.value.splice(A.moved.oldIndex,0,re[0]),await Ae(A,!0)},args:[{moved:{oldIndex:r,newIndex:y}}]},redo:{fn:async A=>{const re=x.value.splice(A.moved.oldIndex,1);x.value.splice(A.moved.newIndex,0,re[0]),await Ae(A,!0)},args:[{moved:{oldIndex:r,newIndex:y}},!0]},scope:It({view:oe.value})})}}async function Lt(t,a){if(t.added){const r=t.added.element;qe.value.unshift({op:"added",pk:Ve(t.added.element.row,M.value.columns),index:t.added.newIndex,stack:a}),r.row[Pe.value]=a,C.value.set(a,C.value.get(a)+1),await yt(r)}else t.removed&&(C.value.set(a,C.value.get(a)-1),qe.value.unshift({op:"removed",pk:Ve(t.removed.element.row,M.value.columns),index:t.removed.oldIndex,stack:a}))}const Je=Ia(async t=>{if(t.target&&t.target.scrollTop+t.target.clientHeight+al>=t.target.scrollHeight){const a=t.target.getAttribute("data-stack-title"),r=Ct.value.defaultLimit||25,y=E.value.get(a);if(y&&(C.value.get(a)===void 0||y.length<C.value.get(a))){const $=Math.ceil(y.length/r);await gt(a,{offset:$*r>C.value.get(a)||$*r>y.length?($-1)*r:$*r})}}}),zt=t=>{t&&(t.removeEventListener("scroll",Je),t.addEventListener("scroll",Je))},Dt=(t,a)=>{Q.value=!0,ne.value=t,T.value=a},Et=async()=>{await bt(ne.value,T.value),Q.value=!1},Ye=async t=>{x.value[t].collapsed=!x.value[t].collapsed,_.value||await $e()},At=(t,a)=>{ut(t)&&a.stopPropagation()},Ot=async()=>{x.value.forEach(t=>{t.id!==Le&&!t.collapsed&&(t.collapsed=!0)}),_.value||await $e()},Tt=async()=>{x.value.forEach(t=>{t.id!==Le&&t.collapsed&&(t.collapsed=!1)}),_.value||await $e()},Ze=async()=>{const t=await ht();t.row={[Pe.value]:fe.value===""?null:fe.value},C.value.set(null,C.value.get(null)+1),ke(t)};O==null||O.on(Ze),va(()=>O.off(Ze)),rt(se,()=>{se.value||(ie.value=null)}),rt(oe,async t=>{if((t==null?void 0:t.type)===ga.KANBAN){be.value=!0;try{await he(),be.value=!1,await Ue(),it(()=>{He.value&&xe.value&&(xe.value.scrollTo({left:xe.value.scrollWidth,behavior:"smooth"}),He.value=!1)})}catch(a){console.error(a),be.value=!1}}},{immediate:!0});const Bt=t=>{const a=Ve(t.row,M.value.columns);return a?`row-${a}`:""},Ft=W(()=>{var t;return Oe((t=me.value)==null?void 0:t.meta).hide_empty_stack||!1}),F={id:Le},g=f(null),b=(t,a)=>(t==null?void 0:t.id)&&(a==null?void 0:a.id)&&t.id===a.id,_e=f(null),Qe=async(t,a,r)=>{_e.value=g.value,g.value=null,a&&(a!=null&&a.title)&&(a!=null&&a.color)&&r!==void 0&&(x.value[r].title=a.title,x.value[r].color=a.color),t&&await he(),_e.value=null};return(t,a)=>{const r=Ua,y=wa,$=ha,z=ba,ve=Ja,A=xa,re=Pa,q=ja,Xe=La,et=za,tt=Da,at=Ha,Nt=Ya,Ut=Wa,ot=Za,lt=Qa,Pt=Xa,Ht=eo,Se=ka,qt=to,Kt=qa,Gt=Ka,nt=Ga,st=ao,Wt=Ea,K=ya("e");return o(),v(J,null,[i("div",oo,[i("div",{ref_key:"kanbanContainerRef",ref:xe,class:"nc-kanban-container flex p-3 overflow-y-hidden w-full nc-scrollbar-x-lg",style:Me({minHeight:e(Ke)?"calc(100%  - 2rem)":"calc(100vh - var(--topbar-height) - var(--toolbar-height) - 0.4rem)",maxHeight:e(Ke)?"calc(100%  - 2rem)":"calc(100vh - var(--topbar-height) - var(--toolbar-height) - 0.4rem)"})},[e(be)?(o(),v("div",lo,[(o(!0),v(J,null,Be(Array(20),k=>(o(),n(r,{key:k,class:"!min-w-80 !min-h-full !rounded-xl overflow-hidden"}))),128))])):(o(),n(tt,{key:1,visible:e(se),"onUpdate:visible":a[13]||(a[13]=k=>ee(se)?se.value=k:null),trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-kanban-context-menu"},Fe({default:s(()=>{var k;return[i("div",no,[m(e(pt),{modelValue:e(x),"onUpdate:modelValue":a[3]||(a[3]=l=>ee(x)?x.value=l:null),class:"flex gap-3","item-key":"id",group:"kanban-stack",draggable:".nc-kanban-stack",handle:".nc-kanban-stack-drag-handler",filter:".not-draggable",move:jt,onStart:a[4]||(a[4]=l=>l.target.classList.add("grabbing")),onEnd:a[5]||(a[5]=l=>l.target.classList.remove("grabbing")),onChange:a[6]||(a[6]=l=>Ae(l))},{item:s(({element:l,index:G})=>{var Ie;return[i("div",{class:R(["nc-kanban-stack",{"w-[44px]":l.collapsed,hidden:e(Ft)&&!((Ie=e(E).get(l.title))!=null&&Ie.length)}]),"data-testid":`nc-kanban-stack-${l.title}`},[l.collapsed?(o(),n(Se,{key:`${l.id}-collapsed`,class:R(["nc-kanban-collapsed-stack flex items-center w-68.5 h-[44px] !rounded-xl cursor-pointer h-full !p-2 overflow-hidden !shadow-none !hover:shadow-none !border-gray-200",{"not-draggable":l.title===null||e(h)||e(_)||!e(S)}]),"body-style":{padding:"0px !important",height:"100%",width:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[i("div",{class:"h-full flex items-center justify-between",onClick:de=>Ye(G)},[!e(E).get(l.title)||!e(C)?(o(),v("div",Uo,[m(r,{active:!0,class:"!w-full !h-4 !rounded-lg overflow-hidden"})])):(o(),v("div",Po,[i("div",Ho,[e(h)||e(_)||!e(S)?w("",!0):(o(),n(z,{key:0,disabled:!l.title,type:"text",size:"xs",class:"nc-kanban-stack-drag-handler !px-1.5 !cursor-move",onClick:a[2]||(a[2]=dt(()=>{},["stop"]))},{default:s(()=>[m($,{icon:"ncDrag",class:"font-weight-800 flex-none"})]),_:2},1032,["disabled"])),i("div",qo,[m(re,{class:"max-w-full !rounded-full !px-2 !py-1 h-7 !m-0 !border-none",color:l.color},{default:s(()=>[i("span",{style:Me({color:e(X).isReadable(l.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(X).mostReadable(l.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-sm font-semibold"},[m(A,{class:"truncate max-w-full",placement:"left","show-on-truncate-only":""},{title:s(()=>[I(p(l.title??"Uncategorized"),1)]),default:s(()=>[i("span",Ko,p(l.title??"Uncategorized"),1)]),_:2},1024)],4)]),_:2},1032,["color"])])]),i("div",Go,[i("div",Wo,p(e(E).get(l.title).length)+" "+p(e(C).get(l.title)!==1?t.$t("objects.records"):t.$t("objects.record")),1),m(z,{type:"text",size:"xs",class:"!px-1.5"},{default:s(()=>[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).arrowDown),{class:"text-grey h-4 w-4 flex-none"}))]),_:1})])]))],8,No)]),_:2},1032,["class"])):(o(),n(Se,{key:`${l.id}-${G}`,class:R(["flex flex-col w-68.5 h-full !rounded-xl overflow-y-hidden !shadow-none !hover:shadow-none !border-gray-200",{"not-draggable":l.title===null||e(h)||e(_)||!e(S),"!cursor-default":e(h)||!e(S)}]),"head-style":{paddingBottom:"0px"},"body-style":{padding:"0px !important",height:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[!e(E).get(l.title)||!e(C)?(o(),v("div",io,[m(r,{active:!0,class:"!w-full !h-9.75 !rounded-lg overflow-hidden"})])):(o(),n(nt,{key:1},{default:s(()=>[m(at,{class:"border-b-1 border-gray-100 min-h-[49px]"},{default:s(()=>{var de,d;return[i("div",{class:R(["nc-kanban-stack-head w-full flex gap-1",{"items-start":b(l,e(g)),"items-center":!b(l,e(g))}])},[i("div",{class:R(["flex-1 flex gap-1 max-w-[calc(100%_-_32px)]",{"items-start":b(l,e(g)),"items-center":!b(l,e(g))}])},[e(h)||e(_)||!e(S)?w("",!0):(o(),n(z,{key:0,disabled:!l.title||b(l,e(_e))||b(l,e(g)),type:"text",size:"xs",class:"nc-kanban-stack-drag-handler !px-1.5 !cursor-move !:disabled:cursor-not-allowed mt-0.5"},{default:s(()=>[b(l,e(_e))?(o(),n(y,{key:0,size:"regular",class:"stack-rename-loader"})):(o(),n($,{key:1,icon:"ncDrag",class:"!font-weight-800 flex-none"}))]),_:2},1032,["disabled"])),i("div",{class:R(["flex-1 flex max-w-[calc(100%_-_28px)]",{"-ml-1":b(l,e(g))}])},[b(l,e(g))&&e(H)[(de=e(g))==null?void 0:de.fk_column_id]?(o(),n(ve,{key:0,column:e(H)[(d=e(g))==null?void 0:d.fk_column_id],"option-id":e(g).id,onSubmit:(ge,Re)=>Qe(ge,Re,G)},null,8,["column","option-id","onSubmit"])):(o(),n(re,{key:1,class:"max-w-full !rounded-full !px-2 !py-1 h-7 !m-0 !border-none !mt-0.5",color:l.color,onDblclick:()=>{l.title!==null&&e(S)&&!e(_)&&!e(h)&&(g.value=l)}},{default:s(()=>[i("span",{style:Me({color:e(X).isReadable(l.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(X).mostReadable(l.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-sm font-semibold"},[m(A,{class:"truncate max-w-full",placement:"bottom","show-on-truncate-only":""},{title:s(()=>[I(p(l.title??"Uncategorized"),1)]),default:s(()=>[i("span",ro,p(l.title??"Uncategorized"),1)]),_:2},1024)],4)]),_:2},1032,["color","onDblclick"]))],2)],2),e(h)?w("",!0):(o(),n(tt,{key:0,placement:"bottomRight","overlay-class-name":"nc-dropdown-kanban-stack-context-menu",class:"bg-white !rounded-lg"},{overlay:s(()=>[m(et,{class:"!text-sm"},{default:s(()=>[e(S)&&!e(_)&&!e(h)?Y((o(),n(q,{key:0,"data-testid":"nc-kanban-context-menu-add-new-record",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",co,[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).plus),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.newRecord")),1)])]),_:2},1032,["onClick"])),[[K,["c:kanban:add-new-record"]]]):w("",!0),l.title!==null&&e(S)&&!e(_)&&!e(h)?Y((o(),n(q,{key:1,"data-testid":"nc-kanban-context-menu-rename-stack",onClick:()=>{g.value=l}},{default:s(()=>[i("div",uo,[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).ncEdit),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.renameStack")),1)])]),_:2},1032,["onClick"])),[[K,["c:kanban:rename-stack"]]]):w("",!0),Y((o(),n(q,{"data-testid":"nc-kanban-context-menu-collapse-stack",onClick:ge=>Ye(G)},{default:s(()=>[i("div",mo,[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).minimize),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.collapseStack")),1)])]),_:2},1032,["onClick"])),[[K,["c:kanban:collapse-stack"]]]),Y((o(),n(q,{"data-testid":"nc-kanban-context-menu-collapse-all-stack",onClick:Ot},{default:s(()=>[i("div",po,[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).minimizeAll),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.collapseAll")),1)])]),_:1})),[[K,["c:kanban:collapse-all-stack"]]]),Y((o(),n(q,{"data-testid":"nc-kanban-context-menu-expand-all-stack",onClick:Tt},{default:s(()=>[i("div",fo,[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).maximizeAll),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.expandAll")),1)])]),_:1})),[[K,["c:kanban:expand-all-stack"]]]),l.title!==null&&!e(_)&&e(S)?(o(),v(J,{key:2},[m(Xe),Y((o(),n(q,{class:"!text-red-600 !hover:bg-red-50","data-testid":"nc-kanban-context-menu-delete-stack",onClick:ge=>Dt(l.title,G)},{default:s(()=>[i("div",_o,[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).delete),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.deleteStack")),1)])]),_:2},1032,["onClick"])),[[K,["c:kanban:delete-stack"]]])],64)):w("",!0)]),_:2},1024)]),default:s(()=>[m(z,{disabled:b(l,e(_e)),type:"text",size:"xs",class:"!px-1.5 mt-0.5","data-testid":"nc-kanban-stack-context-menu"},{default:s(()=>[m($,{icon:"threeDotVertical"})]),_:2},1032,["disabled"])]),_:2},1024))],2)]}),_:2},1024),m(Kt,{class:"overflow-y-hidden",style:Me({backgroundColor:e(X).mix(l.color||"#ccc","#ffffff",e(X)(l.color||"#ccc").isLight()?70:e(X)(l.color||"#ccc").getBrightness()<=100?80:90).toString()})},{default:s(()=>{var de;return[i("div",{ref:zt,class:"nc-kanban-list h-full px-2 nc-scrollbar-thin","data-stack-title":l.title},[m(e(pt),{list:e(E).get(l.title),"item-key":"row.Id",draggable:".nc-kanban-item",group:"kanban-card",class:"flex flex-col h-full",filter:".not-draggable",onStart:a[0]||(a[0]=d=>d.target.classList.add("grabbing")),onEnd:a[1]||(a[1]=d=>d.target.classList.remove("grabbing")),onChange:d=>Lt(d,l.title)},Fe({item:s(({element:d,index:ge})=>[i("div",go,[m(qt,{row:d},{default:s(()=>{var Re;return[(o(),n(Se,{key:`${Bt(d)}-${ge}`,class:R(["!rounded-lg h-full border-gray-200 border-1 group overflow-hidden break-all max-w-[450px] cursor-pointer",{"not-draggable":e(h)||!e(S)||e(_),"!cursor-default":e(h)||!e(S)||e(_)}]),"body-style":{padding:"16px !important"},"data-stack":l.title,"data-testid":`nc-gallery-card-${d.row.id}`,onClick:c=>$t(c,d),onContextmenu:c=>Vt(c,d)},Fe({default:s(()=>[i("div",Co,[e(B)?(o(),v("h2",So,[("isRowEmpty"in t?t.isRowEmpty:e(mt))(d,e(B))?(o(),v(J,{key:1},[I(" - ")],64)):(o(),v(J,{key:0},[e(Ne)(e(B))?(o(),n(ot,{key:0,modelValue:d.row[e(B).title],"onUpdate:modelValue":c=>d.row[e(B).title]=c,class:"!text-brand-500",column:e(B),row:d},null,8,["modelValue","onUpdate:modelValue","column","row"])):(o(),n(lt,{key:1,modelValue:d.row[e(B).title],"onUpdate:modelValue":c=>d.row[e(B).title]=c,class:"!text-brand-500",column:e(B),"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))],64))])):w("",!0),(o(!0),v(J,null,Be(e(Rt),c=>(o(),v("div",{key:`record-${d.row.id}-${c.id}`,class:R({"!children:pointer-events-auto":("isButton"in t?t.isButton:e(ut))(c)}),onClick:N=>At(c,N)},[i("div",Ro,[i("div",Mo,[i("div",Vo,[e(Ne)(c)?(o(),n(Pt,{key:0,column:c,"hide-menu":!0},null,8,["column"])):(o(),n(Ht,{key:1,column:c,"hide-menu":!0},null,8,["column"]))])]),("isRowEmpty"in t?t.isRowEmpty:e(mt))(d,c)?(o(),v("div",jo,"-")):(o(),v("div",$o,[e(Ne)(c)?(o(),n(ot,{key:0,modelValue:d.row[c.title],"onUpdate:modelValue":N=>d.row[c.title]=N,column:c,row:d,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column","row"])):(o(),n(lt,{key:1,modelValue:d.row[c.title],"onUpdate:modelValue":N=>d.row[c.title]=N,column:c,"edit-enabled":!1,"read-only":!0,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column"]))]))])],10,Io))),128))])]),_:2},[(Re=e(me))!=null&&Re.fk_cover_image_col_id?{name:"cover",fn:s(()=>[!e(Ee)&&De(d).length?(o(),n(Ut,{key:De(d).reduce((c,N)=>c+(N==null?void 0:N.path),""),class:"gallery-carousel !border-b-1 !border-gray-200",arrows:""},{customPaging:s(()=>[yo]),prevArrow:s(()=>[i("div",wo,[m(z,{type:"secondary",size:"xsmall",class:"!absolute !left-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:s(()=>[m($,{icon:"arrowLeft",class:"text-gray-700 w-4 h-4"})]),_:1})])]),nextArrow:s(()=>[i("div",ho,[m(z,{type:"secondary",size:"xsmall",class:"!absolute !right-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:s(()=>[m($,{icon:"arrowRight",class:"text-gray-700 w-4 h-4"})]),_:1})])]),default:s(()=>[(o(!0),v(J,null,Be(De(d),c=>(o(),v(J,null,[("isImage"in t?t.isImage:e(Fa))(c.title,c.mimetype??c.type)?(o(),n(Nt,{key:c.path,class:R(["h-52",[`${e(Mt)}`]]),srcs:e(ue)(c,"card_cover")},null,8,["class","srcs"])):w("",!0)],64))),256))]),_:2},1024)):(o(),v("div",bo,ko))]),key:"0"}:void 0]),1032,["data-stack","data-testid","class","onClick","onContextmenu"]))]}),_:2},1032,["row"])])]),_:2},[(de=e(E).get(l.title))!=null&&de.length?void 0:{name:"footer",fn:s(()=>[i("div",Lo,[i("div",zo,[i("span",Do,p(t.$t("general.empty"))+" "+p(t.$t("general.stack").toLowerCase()),1),i("span",Eo,p(t.$t("title.looksLikeThisStackIsEmpty")),1)]),e(ze)("dataInsert")?(o(),n(z,{key:0,size:"xs",type:"secondary",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",Ao,[!e(_)&&!e(h)?(o(),n(j(("iconMap"in t?t.iconMap:e(L)).plus),{key:0})):w("",!0),I(" "+p(t.$t("activity.newRecord")),1)])]),_:2},1032,["onClick"])):w("",!0)])]),key:"0"}]),1032,["list","onChange"])],8,vo)]}),_:2},1032,["style"]),e(E).get(l.title)?(o(),n(Gt,{key:0,class:"border-t-1 border-gray-100"},{default:s(()=>[i("div",Oo,[e(ze)("dataInsert")?(o(),n(z,{key:0,size:"xs",type:"secondary",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",To,[!e(_)&&!e(h)?(o(),n(j(("iconMap"in t?t.iconMap:e(L)).plus),{key:0,class:""})):w("",!0),I(" "+p(t.$t("activity.newRecord")),1)])]),_:2},1032,["onClick"])):(o(),v("div",Bo," ")),i("div",Fo,p(e(E).get(l.title).length)+"/"+p(e(C).get(l.title)??0)+" "+p(e(C).get(l.title)!==1?t.$t("objects.records"):t.$t("objects.record")),1)])]),_:2},1024)):w("",!0)]),_:2},1024))]),_:2},1032,["class"]))],10,so)]}),_:1},8,["modelValue"]),e(S)&&!e(_)&&!e(h)&&((k=e(je))!=null&&k.id)?(o(),v("div",Jo,[m(Se,{class:R(["flex flex-col w-68.5 !rounded-xl overflow-y-hidden !shadow-none !hover:shadow-none border-gray-200",{"!cursor-default":e(h)||!e(S),"!border-none":!b(F,e(g))}]),"head-style":{paddingBottom:"0px"},"body-style":{padding:"0px !important",height:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[!e(E).get(null)||!e(C)?(o(),v("div",Yo,[m(r,{active:!0,class:"!w-full !h-9.75 !rounded-lg overflow-hidden"})])):(o(),n(nt,{key:1},{default:s(()=>[m(at,{class:R({"!p-0 overflow-hidden":!b(F,e(g))})},{default:s(()=>{var l,G;return[i("div",{class:R(["w-full flex",{"items-start":b(F,e(g)),"cursor-pointer":!b(F,e(g))}]),onClick:a[9]||(a[9]=()=>{b(F,e(g))||(g.value=F)})},[b(F,e(g))?(o(),v("div",{key:1,class:R(["flex-1 flex",{"-ml-1":b(F,e(g))}]),onClick:a[8]||(a[8]=dt(()=>{},["stop"]))},[b(F,e(g))&&e(H)[(l=e(je))==null?void 0:l.id]?(o(),n(ve,{key:0,column:e(H)[(G=e(je))==null?void 0:G.id],"is-new-stack":"",onSubmit:a[7]||(a[7]=Ie=>Qe(Ie,void 0))},null,8,["column"])):w("",!0)],2)):(o(),n(z,{key:0,type:"secondary",class:"add-new-stack-btn w-full !rounded-xl min-h-11"},{default:s(()=>[i("div",Zo,[!e(_)&&!e(h)?(o(),n(j(("iconMap"in t?t.iconMap:e(L)).plus),{key:0,class:""})):w("",!0),I(" "+p(t.$t("general.new"))+" "+p(t.$t("general.stack").toLowerCase()),1)])]),_:1}))],2)]}),_:1},8,["class"])]),_:1}))]),_:1},8,["class"])])):w("",!0)])]}),_:2},[!e(h)&&!e(_)&&e(S)?{name:"overlay",fn:s(()=>[m(et,{onClick:a[12]||(a[12]=k=>se.value=!1)},{default:s(()=>[e(ie)?(o(),n(q,{key:0,onClick:a[10]||(a[10]=k=>ke(e(ie)))},{default:s(()=>[Y((o(),v("div",Qo,[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).expand),{class:"flex"})),I(" "+p(t.$t("activity.expandRecord")),1)])),[[K,["a:kanban:expand-record"]]])]),_:1})):w("",!0),m(Xe),e(ie)?(o(),n(q,{key:1,class:"!text-red-600 !hover:bg-red-50",onClick:a[11]||(a[11]=k=>e(xt)(e(ie)))},{default:s(()=>[Y((o(),v("div",Xo,[(o(),n(j(("iconMap"in t?t.iconMap:e(L)).delete),{class:"flex"})),I(" "+p(t.$t("general.deleteEntity",{entity:t.$t("objects.record").toLowerCase()})),1)])),[[K,["a:kanban:delete-record"]]])]),_:1})):w("",!0)]),_:1})]),key:"0"}:void 0]),1032,["visible"]))],4)]),(o(),n(ct,null,{default:s(()=>[e(Z)&&e(V)?(o(),n(st,{key:0,modelValue:e(V),"onUpdate:modelValue":a[14]||(a[14]=k=>ee(V)?V.value=k:null),row:e(Z),state:e(we),meta:e(M),"load-row":!e(_),view:e(oe),onCancel:e(kt)},null,8,["modelValue","row","state","meta","load-row","view","onCancel"])):w("",!0)]),_:1})),(o(),n(ct,null,{default:s(()=>{var k;return[e(Ce)&&((k=e(M))!=null&&k.id)?(o(),n(st,{key:0,modelValue:e(Ce),"onUpdate:modelValue":a[15]||(a[15]=l=>ee(Ce)?Ce.value=l:null),"load-row":!e(_),row:e(Z)??{row:{},oldRow:{},rowMeta:{}},meta:e(M),"expand-form":ke,"row-id":e(P).query.rowId,view:e(oe)},null,8,["modelValue","load-row","row","meta","row-id","view"])):w("",!0)]}),_:1})),m(Wt,{visible:e(Q),"onUpdate:visible":a[16]||(a[16]=k=>ee(Q)?Q.value=k:null),"entity-name":"Stack","on-delete":Et},{"entity-preview":s(()=>[e(ne)?(o(),v("div",el,[i("div",tl,p(e(ne)),1)])):w("",!0)]),_:1},8,["visible"])],64)}}}),ql=Ra(ol,[["__scopeId","data-v-4df2eb35"]]);export{ql as default};
