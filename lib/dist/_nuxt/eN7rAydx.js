import{e as xe,cW as $e,ax as Ae,cO as Ce,cS as Ne,ba as Ve,r as M,ab as Fe,ag as De,ap as Le,f as ce,d4 as i,ar as Me,eL as Re,F as Ie,e7 as Te,dC as Ge,a$ as Ee,g as Be,c$ as y,f_ as Oe,M as Se,o as t,Q as w,w as u,a as _,b as g,N as l,c as r,ao as m,d as v,t as c,R as C,aJ as Pe,at as J,T as Ke,U as Ue,W as qe,P as ze,O as Ye,ah as je,d5 as We,$ as He,Y as Je,Z as Qe,_ as Ze}from"./DZZ6t_j4.js";import{_ as Xe}from"./DC_VdAC1.js";import{_ as el}from"./DnSVh-oD.js";import{_ as ll}from"./Bdv7ru7D.js";import{i as al}from"./C4K5fdHe.js";import"./DKN1hQ6S.js";import{I as tl}from"./BQuyMdA-.js";import{S as sl}from"./D_MsYLkT.js";import{F as ol}from"./BYINaHrJ.js";import{_ as il}from"./dfem9Uc_.js";import{_ as nl}from"./DGj1ycqW.js";const dl={class:"flex w-full flex-row justify-between items-center"},rl={class:"flex font-bold text-base gap-x-3 items-center"},cl=["href"],ul={class:"mt-1"},_l=["title"],fl={class:"flex-1 flex items-center gap-1 max-w-[calc(100%_-_24px)]"},ml=["title"],pl={class:"flex-1 flex items-center gap-1 max-w-[calc(100%_-_24px)]"},vl={class:"text-gray-800"},gl={class:"flex w-full gap-2 justify-between items-center"},yl={class:"flex gap-2 items-center"},wl={key:0,class:"flex flex-row p-4 border-gray-200 border-1 gap-x-4 rounded-lg w-full"},kl={class:"text-gray-500 flex gap-4"},bl={class:"flex flex-col gap-1"},hl={class:"text-gray-500 font-default text-sm"},xl={key:1,class:"flex flex-row p-4 border-gray-200 border-1 gap-x-4 rounded-lg w-full"},$l={class:"text-gray-500 flex gap-4"},Al={class:"flex flex-col gap-1"},Cl={class:"text-gray-500 font-default text-sm"},Nl={class:"flex gap-3 text-gray-800 h-7 mt-4 mb-1 items-center justify-between"},Vl={class:"text-[13px]"},Fl={class:"flex flex-row w-full justify-between gap-x-2 mt-5"},Dl={class:"flex !text-gray-700 items-center gap-2"},Ll={class:"first-letter:capitalize"},Ml={key:1},Rl={class:"flex gap-2 items-center"},Il=xe({__name:"ViewCreate",props:{modelValue:{type:Boolean},type:{},title:{},selectedViewId:{default:void 0},groupingFieldColumnId:{default:void 0},geoDataFieldColumnId:{default:void 0},description:{},tableId:{},calendarRange:{default:void 0},coverImageColumnId:{default:void 0}},emits:["update:modelValue","created"],setup(ue,{emit:_e}){const b=ue,Z=_e,{metas:X,getMeta:ee}=$e(),{viewsByTable:fe}=Ae(Ce()),{refreshCommandPalette:me}=Ne(),{selectedViewId:P,groupingFieldColumnId:le,geoDataFieldColumnId:ae,tableId:F,coverImageColumnId:q}=Ve(b),R=M(),te=M(),se=M(),oe=M(),K=Fe(b,"modelValue",Z),{t:D}=De(),{api:E}=Le(),Q=M(!1),z=ce(()=>fe.value.get(F.value)??[]),B=M(!0),pe={[i.KANBAN]:D("msg.warning.kanbanNoFields"),[i.MAP]:D("msg.warning.mapNoFields"),[i.CALENDAR]:D("msg.warning.calendarNoFields")},e=Me({title:b.title||"",type:b.type,copy_from_id:null,fk_grp_col_id:null,fk_geo_data_col_id:null,calendar_range:b.calendarRange||[],fk_cover_image_col_id:null,description:b.description||""}),p=M([]),ve=[{required:!0,message:`${D("labels.viewName")} ${D("general.required").toLowerCase()}`},{validator:(a,s)=>new Promise((n,h)=>{z.value.every(x=>x.title!==s)?n(!0):h(new Error("View name should be unique"))}),message:"View name should be unique"}],ge=[{required:!0,message:`${D("general.groupingField")} ${D("general.required")}`}],ye=[{required:!0,message:`${D("general.geoDataField")} ${D("general.required")}`}],ie=ce(()=>({[i.GRID]:"grid",[i.GALLERY]:"gallery",[i.FORM]:"form",[i.KANBAN]:"kanban",[i.MAP]:"map",[i.CALENDAR]:"calendar"})[b.type]);Re(we),Ie(()=>b.type,a=>{e.type=a});function we(){var a;if(e.title=`${Te(ie.value)}`,P.value){e.copy_from_id=P==null?void 0:P.value;const s=((a=z.value.find(n=>n.id===P.value))==null?void 0:a.title)||e.title;e.title=Ge(`${s} copy`,z.value,"title","_",!0)}else{const s=z.value.filter(n=>n.title.startsWith(e.title)).length;s&&(e.title=`${e.title}-${s}`)}Ee(()=>{var n;const s=(n=te.value)==null?void 0:n.$el;s&&(s.focus(),s.select())})}async function ne(){var s;let a=null;try{a=await((s=oe.value)==null?void 0:s.validateFields())}catch(n){console.error(n)}if(e.title&&(e.title=e.title.trim()),a&&e.type){if(!F.value)return;try{let n=null;switch(Q.value=!0,e.type){case i.GRID:n=await E.dbView.gridCreate(F.value,e);break;case i.GALLERY:n=await E.dbView.galleryCreate(F.value,e);break;case i.FORM:n=await E.dbView.formCreate(F.value,e);break;case i.KANBAN:n=await E.dbView.kanbanCreate(F.value,e);break;case i.MAP:n=await E.dbView.mapCreate(F.value,e);break;case i.CALENDAR:n=await E.dbView.calendarCreate(F.value,{...e,calendar_range:e.calendar_range.map(h=>({fk_from_column_id:h.fk_from_column_id,fk_to_column_id:h.fk_to_column_id}))});break}n&&Z("created",n)}catch(n){je.error(n.message)}finally{await me()}K.value=!1,setTimeout(()=>{Q.value=!1},500)}}const G=M(!1),ke=()=>{e.description="",G.value=!1},be=()=>{G.value?G.value=!1:(G.value=!0,setTimeout(()=>{var a;(a=se.value)==null||a.focus()},100))},V=M(!1);Be(async()=>{var a,s,n,h,x,O;if(e.copy_from_id&&(G.value=!0),[i.GALLERY,i.KANBAN,i.MAP,i.CALENDAR].includes(b.type)){V.value=!0;try{if(R.value=await ee(F.value),b.type===i.MAP&&(p.value=R.value.columns.filter(d=>d.uidt===y.GeoData).map(d=>({value:d.id,label:d.title})),ae.value?e.fk_geo_data_col_id=ae.value:(a=p.value)!=null&&a.length?e.fk_geo_data_col_id=(n=(s=p.value)==null?void 0:s[0])==null?void 0:n.value:B.value=!1),b.type===i.GALLERY){p.value=[{value:null,label:"No Image"},...(R.value.columns||[]).filter(f=>f.uidt===y.Attachment).map(f=>({value:f.id,label:f.title,uidt:f.uidt}))];const d=(h=R.value.columns||[])==null?void 0:h.filter(f=>f.uidt===y.Lookup),k=new Set,$=async(f,N,Y)=>{var j,o,U,A,T,W,de;const I=Y||(j=R.value)!=null&&j.id?(A=(U=X.value[Y||((o=R.value)==null?void 0:o.id)])==null?void 0:U.columns)==null?void 0:A.find(L=>{var H;return L.id===((H=N==null?void 0:N.colOptions)==null?void 0:H.fk_relation_column_id)}):void 0;if((T=I==null?void 0:I.colOptions)!=null&&T.fk_related_model_id){await ee(I.colOptions.fk_related_model_id);const L=(de=(W=X.value[I.colOptions.fk_related_model_id])==null?void 0:W.columns)==null?void 0:de.find(H=>{var re;return H.id===((re=N==null?void 0:N.colOptions)==null?void 0:re.fk_lookup_column_id)});L&&al(L)?k.add(f.id):L&&(L==null?void 0:L.uidt)===y.Lookup&&await $(f,L,I.colOptions.fk_related_model_id)}};await Promise.allSettled(d.map(f=>$(f,f)));const S=d.filter(f=>k.has(f==null?void 0:f.id)).map(f=>({value:f.id,label:f.title,uidt:f.uidt}));p.value=[...p.value,...S],q.value?e.fk_cover_image_col_id=q.value:p.value.length>1&&!e.copy_from_id?e.fk_cover_image_col_id=p.value[1].value:e.fk_cover_image_col_id=null}b.type===i.KANBAN&&(p.value=R.value.columns.filter(d=>d.uidt===y.SingleSelect).map(d=>({value:d.id,label:d.title,uidt:d.uidt})),le.value?e.fk_grp_col_id=le.value:(x=p.value)!=null&&x.length?e.fk_grp_col_id=p.value[0].value:B.value=!1,q.value?e.fk_cover_image_col_id=q.value:p.value.length>1&&!e.copy_from_id?e.fk_cover_image_col_id=p.value[1].value:e.fk_cover_image_col_id=null),b.type===i.CALENDAR&&(p.value=R.value.columns.filter(d=>{var k,$;return[y.DateTime,y.Date,y.CreatedTime,y.LastModifiedTime].includes(d.uidt)||d.uidt===y.Formula&&(($=(k=d.colOptions)==null?void 0:k.parsed_tree)==null?void 0:$.dataType)===Oe.DATE}).map(d=>({value:d.id,label:d.title,uidt:d.uidt})).sort((d,k)=>{const $={[y.DateTime]:1,[y.Date]:2,[y.Formula]:3,[y.CreatedTime]:4,[y.LastModifiedTime]:5};return($[d.uidt]||6)-($[k.uidt]||6)}),(O=p.value)!=null&&O.length?e.calendar_range.length===0&&(e.calendar_range=[{fk_from_column_id:p.value[0].value,fk_to_column_id:null}]):B.value=!1)}catch(d){console.error(d)}finally{V.value=!1}}});const he=a=>a?a.some(s=>{var h;console.log(s);const n=(h=p.value)==null?void 0:h.find(x=>x.value===(s==null?void 0:s.fk_from_column_id));return!n||![y.DateTime,y.Date].includes(n.uidt)}):!1;return(a,s)=>{const n=We,h=tl,x=il,O=Xe,d=He,k=Je,$=sl,S=el,f=ol,N=Qe,Y=nl,I=ll,j=Se("e");return t(),w(I,{visible:l(K),"onUpdate:visible":s[6]||(s[6]=o=>Ye(K)?K.value=o:null),class:"nc-view-create-modal","show-separator":!1,size:[l(i).MAP].includes(l(e).type)?"medium":"small"},{header:u(()=>[_("div",dl,[_("div",rl,[g(n,{meta:{type:l(e).type},class:"nc-view-icon !text-[24px] !leading-6 max-h-6 max-w-6"},null,8,["meta"]),l(e).type===l(i).GRID?(t(),r(m,{key:0},[l(e).copy_from_id?(t(),r(m,{key:0},[v(c(a.$t("labels.duplicateGridView")),1)],64)):(t(),r(m,{key:1},[v(c(a.$t("labels.createGridView")),1)],64))],64)):l(e).type===l(i).GALLERY?(t(),r(m,{key:1},[l(e).copy_from_id?(t(),r(m,{key:0},[v(c(a.$t("labels.duplicateGalleryView")),1)],64)):(t(),r(m,{key:1},[v(c(a.$t("labels.createGalleryView")),1)],64))],64)):l(e).type===l(i).FORM?(t(),r(m,{key:2},[l(e).copy_from_id?(t(),r(m,{key:0},[v(c(a.$t("labels.duplicateFormView")),1)],64)):(t(),r(m,{key:1},[v(c(a.$t("labels.createFormView")),1)],64))],64)):l(e).type===l(i).KANBAN?(t(),r(m,{key:3},[l(e).copy_from_id?(t(),r(m,{key:0},[v(c(a.$t("labels.duplicateKanbanView")),1)],64)):(t(),r(m,{key:1},[v(c(a.$t("labels.createKanbanView")),1)],64))],64)):l(e).type===l(i).CALENDAR?(t(),r(m,{key:4},[l(e).copy_from_id?(t(),r(m,{key:0},[v(c(a.$t("labels.duplicateCalendarView")),1)],64)):(t(),r(m,{key:1},[v(c(a.$t("labels.createCalendarView")),1)],64))],64)):(t(),r(m,{key:5},[l(e).copy_from_id?(t(),r(m,{key:0},[v(c(a.$t("labels.duplicateMapView")),1)],64)):(t(),r(m,{key:1},[v(c(a.$t("labels.duplicateView")),1)],64))],64))]),l(e).copy_from_id?C("",!0):(t(),r("a",{key:0,class:"text-sm !text-gray-600 !font-default !hover:text-gray-600",href:`https://docs.nocodb.com/views/view-types/${l(ie)}`,target:"_blank"}," Docs ",8,cl))])]),default:u(()=>[_("div",ul,[l(B)?(t(),w(f,{key:0,ref_key:"formValidator",ref:oe,model:l(e),layout:"vertical",class:"flex flex-col gap-y-5"},{default:u(()=>[g(x,{rules:ve,name:"title"},{default:u(()=>[g(h,{ref_key:"inputEl",ref:te,value:l(e).title,"onUpdate:value":s[0]||(s[0]=o=>l(e).title=o),placeholder:a.$t("labels.viewName"),autofocus:"",class:"nc-input-sm nc-input-shadow",onKeydown:Pe(ne,["enter"])},null,8,["value","placeholder"])]),_:1}),l(e).type===l(i).GALLERY&&!l(e).copy_from_id?(t(),w(x,{key:0,label:`${a.$t("labels.coverImageField")}`,name:"fk_cover_image_col_id"},{default:u(()=>[g(S,{value:l(e).fk_cover_image_col_id,"onUpdate:value":s[1]||(s[1]=o=>l(e).fk_cover_image_col_id=o),disabled:l(V),loading:l(V),"dropdown-match-select-width":"","not-found-content":a.$t("placeholder.selectGroupFieldNotFound"),placeholder:a.$t("placeholder.selectCoverImageField"),class:"nc-select-shadow w-full nc-gallery-cover-image-field-select"},{default:u(()=>[(t(!0),r(m,null,J(l(p),o=>(t(),w($,{key:o.value,value:o.value},{default:u(()=>[_("div",{class:"w-full flex gap-2 items-center justify-between",title:o.label},[_("div",fl,[o.value?(t(),w(O,{key:0,column:o,class:"!ml-0"},null,8,["column"])):C("",!0),g(d,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:u(()=>[v(c(o.label),1)]),default:u(()=>[v(c(o.label),1)]),_:2},1024)]),l(e).fk_cover_image_col_id===o.value?(t(),w(k,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):C("",!0)],8,_l)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled","loading","not-found-content","placeholder"])]),_:1},8,["label"])):C("",!0),l(e).type===l(i).KANBAN&&!l(e).copy_from_id?(t(),w(x,{key:1,label:a.$t("general.groupingField"),rules:ge,name:"fk_grp_col_id"},{default:u(()=>[g(S,{value:l(e).fk_grp_col_id,"onUpdate:value":s[2]||(s[2]=o=>l(e).fk_grp_col_id=o),disabled:l(V),loading:l(V),"dropdown-match-select-width":"","not-found-content":a.$t("placeholder.selectGroupFieldNotFound"),placeholder:a.$t("placeholder.selectGroupField"),class:"nc-select-shadow w-full nc-kanban-grouping-field-select"},{default:u(()=>[(t(!0),r(m,null,J(l(p),o=>(t(),w($,{key:o.value,value:o.value},{default:u(()=>[_("div",{class:"w-full flex gap-2 items-center justify-between",title:o.label},[_("div",pl,[g(O,{column:o,class:"!ml-0"},null,8,["column"]),g(d,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:u(()=>[v(c(o.label),1)]),default:u(()=>[v(c(o.label),1)]),_:2},1024)]),l(e).fk_grp_col_id===o.value?(t(),w(k,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):C("",!0)],8,ml)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled","loading","not-found-content","placeholder"])]),_:1},8,["label"])):C("",!0),l(e).type===l(i).MAP?(t(),w(x,{key:2,label:a.$t("general.geoDataField"),rules:ye,name:"fk_geo_data_col_id"},{default:u(()=>[g(S,{value:l(e).fk_geo_data_col_id,"onUpdate:value":s[3]||(s[3]=o=>l(e).fk_geo_data_col_id=o),disabled:l(V),loading:l(V),"not-found-content":a.$t("placeholder.selectGeoFieldNotFound"),options:l(p),placeholder:a.$t("placeholder.selectGeoField"),class:"nc-select-shadow w-full"},null,8,["value","disabled","loading","not-found-content","options","placeholder"])]),_:1},8,["label"])):C("",!0),l(e).type===l(i).CALENDAR&&!l(e).copy_from_id?(t(),r(m,{key:3},[(t(!0),r(m,null,J(l(e).calendar_range,(o,U)=>(t(),r("div",{key:`range-${U}`,class:"flex w-full items-center gap-2"},[_("span",vl,c(a.$t("labels.organiseBy")),1),g(S,{value:o.fk_from_column_id,"onUpdate:value":A=>o.fk_from_column_id=A,disabled:l(V),loading:l(V),class:"nc-select-shadow nc-from-select"},{default:u(()=>[(t(!0),r(m,null,J([...l(p)].filter(A=>{if(U===0)return!0;const T=l(p).find(W=>W.value===l(e).calendar_range[0].fk_from_column_id);return(T==null?void 0:T.uidt)===A.uidt}),(A,T)=>(t(),w($,{key:T,class:"w-40",value:A.value},{default:u(()=>[_("div",gl,[_("div",yl,[g(O,{column:A,class:"!ml-0"},null,8,["column"]),g(d,{class:"truncate flex-1 max-w-18",placement:"top","show-on-truncate-only":""},{title:u(()=>[v(c(A.label),1)]),default:u(()=>[v(" "+c(A.label),1)]),_:2},1024)]),s[7]||(s[7]=_("div",{class:"flex-1"},null,-1)),A.value===o.fk_from_column_id?(t(),w(Ke(("iconMap"in a?a.iconMap:l(Ue)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary min-w-4 h-4"})):C("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled","loading"])]))),128)),he(l(e).calendar_range)?(t(),r("div",wl,[_("div",kl,[g(k,{class:"min-w-6 h-6 text-orange-500",icon:"info"}),_("div",bl,[s[8]||(s[8]=_("h2",{class:"font-semibold text-sm mb-0 text-gray-800"},"Calendar is readonly",-1)),_("span",hl,c(a.$t("msg.info.calendarReadOnly")),1)])])])):C("",!0)],64)):C("",!0)]),_:1},8,["model"])):l(B)?C("",!0):(t(),r("div",xl,[_("div",$l,[g(k,{class:"min-w-6 h-6 text-orange-500",icon:"alertTriangle"}),_("div",Al,[s[9]||(s[9]=_("h2",{class:"font-semibold text-sm mb-0 text-gray-800"},"Suitable fields not present",-1)),_("span",Cl,c(pe[l(e).type]),1)])])])),l(G)?(t(),w(x,{key:2},{default:u(()=>[_("div",Nl,[_("span",Vl,c(a.$t("labels.description")),1),g(N,{type:"text",class:"!h-6 !w-5",size:"xsmall",onClick:ke},{default:u(()=>[g(k,{icon:"delete",class:"text-gray-700 w-3.5 h-3.5"})]),_:1})]),g(Y,{ref_key:"descriptionInputEl",ref:se,value:l(e).description,"onUpdate:value":s[4]||(s[4]=o=>l(e).description=o),class:"nc-input-sm nc-input-text-area nc-input-shadow px-3 !text-gray-800 max-h-[150px] min-h-[100px]","hide-details":"","data-testid":"create-table-title-input",placeholder:a.$t("msg.info.enterViewDescription")},null,8,["value","placeholder"])]),_:1})):C("",!0),_("div",Fl,[l(G)?(t(),r("div",Ml)):(t(),w(N,{key:0,size:"small",type:"text",onClick:qe(be,["stop"])},{default:u(()=>[_("div",Dl,[g(k,{icon:"plus",class:"h-4 w-4"}),_("span",Ll,c(a.$t("labels.addDescription")),1)])]),_:1})),_("div",Rl,[g(N,{type:"secondary",size:"small",onClick:s[5]||(s[5]=o=>K.value=!1)},{default:u(()=>[v(c(a.$t("general.cancel")),1)]),_:1}),ze((t(),w(N,{disabled:!l(B),loading:l(Q),type:"primary",size:"small",onClick:ne},{loading:u(()=>[v(c(a.$t("labels.creatingView")),1)]),default:u(()=>[v(c(a.$t("labels.createView"))+" ",1)]),_:1},8,["disabled","loading"])),[[j,[l(e).copy_from_id?"a:view:duplicate":"a:view:create"]]])])])])]),_:1},8,["visible","size"])}}}),Yl=Ze(Il,[["__scopeId","data-v-cf228a08"]]);export{Yl as _};
