import{f as W,bN as k,gD as F,r as c,d9 as L,N as O,g as D,d3 as Q,d2 as u,H as U,hJ as j,af as E,i as z,o as i,c as h,P as o,S as v,w as b,b as m,U as I,a as g,t as G,T as $,V as H,W as P,Q as A,Y as J,b1 as Y,$ as K,aV as X,_ as Z}from"./Cgw6cdOy.js";import{_ as ee}from"./CBB1QnSh.js";import{_ as ae}from"./CiTH7PYd.js";import{a as oe,b as te}from"./DFiWgQ57.js";import"./Bcy-XIkn.js";import{I as re}from"./DPaOlBFV.js";import"./Bw0A6WKO.js";import"./Cj4l15BV.js";import"./DpDIhxXu.js";import"./Dqwep-0C.js";import"./BBXMuneh.js";import"./5xpACL64.js";import"./C0xV_Bo1.js";import"./BcpeJQoi.js";import"./CO8XXsKl.js";import"./C8c9012h.js";import"./BIsWr_mR.js";import"./BQQOEPN4.js";import"./hvq8FVej.js";import"./BZz6iAla.js";const se={key:0,class:"w-16 text-xs font-medium text-gray-400 truncate"},le={class:"xs:text-gray-600 group-hover:text-gray-700 sm:text-gray-400"},ie=W({__name:"SearchData",setup(ne){const q=k(F),{meta:V}=oe(),y=k(L,c()),{search:t,loadFieldQuery:C}=te(),s=c(!1),l=c(!1),_=c(),w=c(),{isMobileMode:M}=O(),f=D(()=>{var e,a;return((a=(e=V.value)==null?void 0:e.columns)==null?void 0:a.filter(r=>!Q(r)&&![u.Links,u.Rollup,u.DateTime,u.Date].includes(r==null?void 0:r.uidt)))??[]});U(()=>{var e;return(e=y.value)==null?void 0:e.id},(e,a)=>{var r;e!==a&&C((r=y.value)==null?void 0:r.id)},{immediate:!0});function x(){q.trigger({shouldShowLoading:!1,offset:0})}const S=D(()=>{var a,r,d;if(t.value.field)return(r=(a=f.value)==null?void 0:a.find(n=>n.id===t.value.field))==null?void 0:r.title;const e=(d=f.value)==null?void 0:d.find(n=>n.pv);return t.value.field=e==null?void 0:e.id,e==null?void 0:e.title});j(()=>t.value.query,()=>{x()},{debounce:500,maxWait:600});const R=e=>{t.value.field=e.id,s.value=!1},B=()=>{l.value=!0,Y(()=>{var e;(e=_.value)==null||e.focus()})};return E(w,e=>{const a=e.target;t.value.query||a.closest(".nc-dropdown-toolbar-search-field-option")||(l.value=!1)}),z(()=>{t.value.query&&!l.value&&(l.value=!0)}),(e,a)=>{const r=K,d=X,n=ee,N=ae,T=re;return i(),h("div",{ref_key:"globalSearchWrapperRef",ref:w,class:"nc-global-search-wrapper"},[!o(t).query&&!o(l)?(i(),v(d,{key:0,class:"nc-toolbar-btn !rounded-lg !h-7 !px-1.5","data-testid":"nc-global-search-show-input",onClick:B},{default:b(()=>[m(r,{icon:"search",class:"h-4 w-4 text-gray-700 group-hover:text-black"})]),_:1})):(i(),h("div",{key:1,class:I(["flex flex-row border-1 rounded-lg h-7 xs:h-10 xs:ml-0 ml-1 border-gray-200 overflow-hidden focus-within:border-primary",{"border-primary":o(t).query.length!==0}])},[m(N,{visible:o(s),"onUpdate:visible":a[1]||(a[1]=p=>A(s)?s.value=p:null),trigger:["click"],"overlay-class-name":"nc-dropdown-toolbar-search-field-option"},{overlay:b(()=>[m(n,{"is-parent-open":o(s),"selected-option-id":o(t).field,"show-selected-option":"",options:o(f),"search-input-placeholder":e.$t("placeholder.searchFields"),"toolbar-menu":"globalSearch",onSelected:R},null,8,["is-parent-open","selected-option-id","options","search-input-placeholder"])]),default:b(()=>[g("div",{class:I(["flex items-center group px-2 cursor-pointer border-r-1 border-gray-200 hover:bg-gray-100",{"bg-gray-50 ":o(s)}]),onClick:a[0]||(a[0]=p=>s.value=!o(s))},[m(r,{icon:"search",class:"ml-1 mr-2 h-3.5 w-3.5 text-gray-500 group-hover:text-black"}),o(M)?$("",!0):(i(),h("div",se,G(o(S)??""),1)),g("div",le,[(i(),v(H(("iconMap"in e?e.iconMap:o(P)).arrowDown),{class:"text-sm text-inherit"}))])],2)]),_:1},8,["visible"]),g("form",{class:"p-0",onSubmit:a[3]||(a[3]=J(()=>{},["prevent"]))},[o(t).query||o(l)?(i(),v(T,{key:0,ref_key:"globalSearchRef",ref:_,value:o(t).query,"onUpdate:value":a[2]||(a[2]=p=>o(t).query=p),name:"globalSearchQuery",size:"small",class:"text-xs w-40 h-full",placeholder:`${e.$t("general.searchIn")} ${o(S)??""}`,bordered:!1,"data-testid":"search-data-input",onPressEnter:x},null,8,["value","placeholder"])):$("",!0)],32)],2))],512)}}}),Ve=Z(ie,[["__scopeId","data-v-f10ad39d"]]);export{Ve as default};
