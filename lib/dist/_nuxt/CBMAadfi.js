import{_ as Pe}from"./CdfAcTJv.js";import{_ as je}from"./CbkSs5Gy.js";import{_ as Ee}from"./vK-WmZ7a.js";import{e as Se,cs as V,cL as Ke,L as Ne,bL as D,r as c,hK as Oe,aA as Te,aC as Be,i2 as Ue,aD as Ae,h5 as Re,ag as He,h_ as ze,ha as Le,g2 as Ge,f as h,dc as $,cr as be,cq as n,D as qe,d0 as ge,ad as we,F as De,il as We,g as Xe,cA as Qe,aE as Ze,j4 as Je,o as A,c as $e,a as P,b as _e,w as Me,S as R,N as t,Q as ae,O as ea,W as j,R as he,a7 as aa,ao as ta,Y as la,_ as sa}from"./DZZ6t_j4.js";import"./CToWLgER.js";import"./jD721dGr.js";const oa=["title"],ua=["value","placeholder","readonly"],na=["value","placeholder","readonly"],ra={key:0,class:"absolute inset-0 z-90 cursor-pointer"},ia=Se({__name:"DateTimePicker",props:{modelValue:{},isPk:{type:Boolean},showCurrentDateOption:{type:[Boolean,String]},isUpdatedFromCopyNPaste:{}},emits:["update:modelValue","currentDate"],setup(d,{emit:ke}){const J=ke,te={[V[0]]:"hh:mm A",[V[1]]:"hh:mm:ss A",[V[2]]:"hh:mm:ss.SSS A"},{isMssql:xe,isXcdbBase:Ve}=Ke(),{showNull:_,isMobileMode:le}=Ne(),B=D(Oe,c(!1)),H=D(Te,c(!1)),p=D(Be,c(!1)),k=D(Ue,c(!1)),E=D(Ae,c(!1)),Ye=D(Re,c(!1)),{t:se}=He(),S=D(ze,c(!1)),K=D(Le,c(!1)),s=D(Ge),z=c(!1),y=c(),M=c(),oe=h(()=>{var l,o,f,i;const a=((o=$((l=s==null?void 0:s.value)==null?void 0:l.meta))==null?void 0:o.date_format)??be[0],e=((i=$((f=s==null?void 0:s.value)==null?void 0:f.meta))==null?void 0:i.time_format)??V[0];return`${a} ${e}`}),ee=h(()=>{var a,e;return((e=$((a=s==null?void 0:s.value)==null?void 0:a.meta))==null?void 0:e.date_format)??be[0]}),w=h(()=>{var a,e;return((e=$((a=s==null?void 0:s.value)==null?void 0:a.meta))==null?void 0:e.time_format)??V[0]});let N=d.modelValue?n(d.modelValue).utc().local():void 0;const L=c(!1),r=c(!1),m=c(),b=c(!0),u=h({get(){var e;if(!d.modelValue||L.value)return;if(!n(d.modelValue).isValid()){z.value=!0;return}const a=Ve(s.value.source_id);if(s.value.title in(d.isUpdatedFromCopyNPaste??{}))return N=n(d.modelValue).utc().local(),N;if(!a)return/^\d+$/.test(d.modelValue)?n(+d.modelValue):n(d.modelValue);if(xe(s.value.source_id))return n(d.modelValue);if((e=s==null?void 0:s.value)!=null&&e.cdf)return n(d.modelValue).utc().local();if(N){const l=N;return N=void 0,l}return n(d.modelValue).utc().local()},set(a){if(L.value=!1,!a){J("update:modelValue",null);return}a.isValid()&&(N=n(a),J("update:modelValue",n(a).utc().format("YYYY-MM-DD HH:mm:ssZ")))}});qe(()=>{u.value&&(m.value=u.value)});const x=h(()=>ge(s.value)||B.value||u.value&&d.isPk),Y=h(()=>B.value||x.value||B.value||u.value&&d.isPk?!1:r.value&&(H.value||p.value)),O=`picker_${Math.floor(Math.random()*99999)}`;we(y,a=>{var e,l,o,f,i;(e=a.target)!=null&&e.closest(`.${O}, .nc-${O}`)||((o=(l=y.value)==null?void 0:l.blur)==null||o.call(l),(i=(f=M.value)==null?void 0:f.blur)==null||i.call(f),r.value=!1)});const ue=a=>{b.value=a,r.value=!0};De(r,a=>{var e,l,o,f;a?(p.value=!0,b.value?(l=(e=y.value)==null?void 0:e.focus)==null||l.call(e):(f=(o=M.value)==null?void 0:o.focus)==null||f.call(o),we(document.querySelector(`.${O}`),i=>{var g;(g=i==null?void 0:i.target)!=null&&g.closest(`.nc-${O}`)||(r.value=!1)})):L.value=!1},{flush:"post"});const T=h(()=>(E.value||K.value)&&!z.value||k.value&&!_.value&&!z.value&&!ge(s.value)&&H.value||S.value?{dateTime:oe.value,date:ee.value,time:$(s.value.meta).is12hrFormat?`${w.value} AM`:w.value}:d.modelValue===null&&_.value?se("general.null").toUpperCase():z.value?se("msg.invalidDate"):""),C=D(We,null),G=()=>{B.value||r.value||(r.value=H.value||p.value)};Xe(()=>{C==null||C.on(G)}),Qe(()=>{C==null||C.on(G)});const ne=(a,e=!1)=>{b.value=e,!C&&G()},re=(a,e,l=!1)=>{var o,f,i,g,F,U,I,v,q,me,W,fe,X,ce,Q,pe,Z,ye;switch(a.key!=="Enter"&&a.stopPropagation(),a.key){case"Enter":a.preventDefault(),Ye.value&&a.stopPropagation(),u.value=m.value,l?((U=(F=y.value)==null?void 0:F.blur)==null||U.call(F),r.value=!1,p.value=!1):(a.stopPropagation(),(f=(o=M.value)==null?void 0:o.blur)==null||f.call(o),b.value=!1,(g=(i=y.value)==null?void 0:i.focus)==null||g.call(i),G());return;case"Escape":e?(r.value=!1,p.value=!1,k.value&&!K.value&&!S.value&&(l?(v=(I=y.value)==null?void 0:I.blur)==null||v.call(I):(me=(q=M.value)==null?void 0:q.blur)==null||me.call(q))):(p.value=!1,l?(fe=(W=y.value)==null?void 0:W.blur)==null||fe.call(W):(ce=(X=M.value)==null?void 0:X.blur)==null||ce.call(X));return;case"Tab":r.value=!1,k.value&&!K.value&&!S.value&&(l?(pe=(Q=y.value)==null?void 0:Q.blur)==null||pe.call(Q):(ye=(Z=M.value)==null?void 0:Z.blur)==null||ye.call(Z),a.shiftKey&&l||!a.shiftKey&&!l?p.value=!1:a.stopPropagation());return;default:!e&&/^[0-9a-z]$/i.test(a.key)&&(r.value=!0)}};Ze(document,"keydown",a=>{var e,l;if(H.value&&!(a.altKey||a.shiftKey||!k.value||K.value||S.value||Je())){if(a.metaKey||a.ctrlKey)if(a.key===";")k.value&&!K.value&&!S.value&&(u.value=n(new Date),a.preventDefault());else return;!Y.value&&(y.value||M.value)&&/^[0-9a-z]$/i.test(a.key)&&(L.value=!0,b.value?(e=y.value)==null||e.focus():(l=M.value)==null||l.focus(),p.value=!0,r.value=!0)}}),De(p,a=>{k.value&&a&&!r.value&&(b.value=!0,r.value=!0)});const ie=(a,e)=>{let l=a.target.value;if(e){if(!l){m.value=void 0;return}const o=n(l,ee.value);o.isValid()&&(u.value?m.value=n(`${o.format("YYYY-MM-DD")} ${u.value.format(w.value)}`):m.value=o)}if(!e){if(!l){m.value=n(n().format("YYYY-MM-DD"));return}l=$(s.value.meta).is12hrFormat?l.trim().toUpperCase().replace(/(AM|PM)$/," $1").replace(/\s+/g," "):l.trim();const o=n(l,$(s.value.meta).is12hrFormat?te[w.value]:w.value);o.isValid()&&(m.value=n(`${(m.value??n()).format("YYYY-MM-DD")} ${o.format(w.value)}`))}};function ve(a){if(a&&u.value){const e=n(`${a.format("YYYY-MM-DD")} ${u.value.format(w.value)}`);m.value=e,u.value=e}else m.value=a,u.value=a;r.value=!1}function Ce(a){if(a.isValid()){if(u.value){const e=n(`${u.value.format("YYYY-MM-DD")} ${a.format("HH:mm")}:00`);m.value=e,u.value=e}else{const e=n(`${n().format("YYYY-MM-DD")} ${a.format("HH:mm")}:00`);m.value=e,u.value=e}r.value=!1}}const Fe=h(()=>({[V[0]]:{12:"max-w-[85px]",24:"max-w-[65px]"},[V[1]]:{12:"max-w-[100px]",24:"max-w-[80px]"},[V[2]]:{12:"max-w-[130px]",24:"max-w-[110px]"}})[w.value][$(s.value.meta).is12hrFormat?12:24]),Ie=h(()=>{var a;return((a=u.value)==null?void 0:a.format($(s.value.meta).is12hrFormat?te[w.value]:w.value))??""}),de=a=>{r.value=!1,J("currentDate",a)};return(a,e)=>{const l=Pe,o=je,f=Ee,i=la;return A(),$e(ta,null,[P("div",aa(a.$attrs,{class:"nc-cell-field relative"}),[_e(f,{visible:t(Y),placement:t(b)?"bottomLeft":"bottomRight","auto-close":!1,trigger:["click"],class:R(["nc-cell-picker-datetime",[`nc-${O}`,{"nc-null":a.modelValue===null&&t(_)}]]),"overlay-class-name":`${O} nc-picker-datetime ${t(r)?"active":""} !min-w-[0] overflow-hidden`},{overlay:Me(()=>[P("div",{class:R(["min-w-[72px]",{"w-[256px]":t(b)}])},[t(b)?(A(),ae(l,{key:0,"page-date":t(m),"onUpdate:pageDate":e[12]||(e[12]=g=>ea(m)?m.value=g:null),"selected-date":t(u),"is-open":t(Y),type:"date",size:"medium","show-current-date-option":a.showCurrentDateOption,"onUpdate:selectedDate":ve,onCurrentDate:de},null,8,["page-date","selected-date","is-open","show-current-date-option"])):(A(),ae(o,{key:1,"selected-date":t(u),"min-granularity":30,"is-min-granularity-picker":"","is12hr-format":!!("parseProp"in a?a.parseProp:t($))(t(s).meta).is12hrFormat,"is-open":t(Y),"show-current-date-option":a.showCurrentDateOption,"onUpdate:selectedDate":Ce,onCurrentDate:de},null,8,["selected-date","is12hr-format","is-open","show-current-date-option"]))],2)]),default:Me(()=>{var g,F,U,I;return[P("div",{title:(g=t(u))==null?void 0:g.format(t(oe)),class:R(["nc-date-picker ant-picker-input flex relative !w-auto gap-2",{"justify-between":!t(x)}])},[P("div",{class:R(["flex-none rounded-md box-border w-[60%] max-w-[110px]",{"py-0":t(E),"py-0.5":!t(E)&&!t(x),"bg-gray-100":t(b)&&t(Y),"hover:bg-gray-100 px-1":!t(x)}])},[P("input",{ref_key:"datePickerRef",ref:y,value:((F=t(u))==null?void 0:F.format(t(ee)))??"",placeholder:typeof t(T)=="string"?t(T):(U=t(T))==null?void 0:U.date,class:"nc-date-input w-full !truncate border-transparent outline-none !text-current !bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:!!t(le)||t(x),onFocus:e[0]||(e[0]=v=>ue(!0)),onKeydown:e[1]||(e[1]=v=>re(v,t(Y),!0)),onMouseup:e[2]||(e[2]=j(()=>{},["stop"])),onMousedown:e[3]||(e[3]=j(()=>{},["stop"])),onClick:e[4]||(e[4]=j(v=>ne(v,!0),["stop"])),onInput:e[5]||(e[5]=v=>ie(v,!0))},null,40,ua)],2),P("div",{class:R(["flex-none rounded-md box-border flex-1",[`${t(Fe)}`,{"py-0":t(E),"py-0.5":!t(E)&&!t(x),"bg-gray-100":!t(b)&&t(Y),"hover:bg-gray-100 px-1":!t(x)}]])},[P("input",{ref_key:"timePickerRef",ref:M,value:t(Ie),placeholder:typeof t(T)=="string"?t(T):(I=t(T))==null?void 0:I.time,class:"nc-time-input w-full !truncate border-transparent outline-none !text-current !bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:!!t(le)||t(x),onFocus:e[6]||(e[6]=v=>ue(!1)),onKeydown:e[7]||(e[7]=v=>re(v,t(r))),onMouseup:e[8]||(e[8]=j(()=>{},["stop"])),onMousedown:e[9]||(e[9]=j(()=>{},["stop"])),onClick:e[10]||(e[10]=j(v=>ne(v,!1),["stop"])),onInput:e[11]||(e[11]=v=>ie(v,!1))},null,40,na)],2)],10,oa)]}),_:1},8,["visible","placement","class","overlay-class-name"]),t(u)&&(t(K)||t(E)||!t(k)||t(S))&&!t(B)?(A(),ae(i,{key:0,icon:"closeCircle",class:"nc-clear-date-time-icon nc-action-icon h-4 w-4 absolute right-0 top-[50%] transform -translate-y-1/2 invisible cursor-pointer",onClick:e[13]||(e[13]=j(g=>ve(),["stop"]))})):he("",!0)],16),!t(p)&&t(k)?(A(),$e("div",ra)):he("",!0)],64)}}}),ya=sa(ia,[["__scopeId","data-v-83d4db79"]]);export{ya as default};
