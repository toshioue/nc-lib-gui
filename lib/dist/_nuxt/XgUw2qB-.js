const __vite__fileDeps=["./DwvYIORx.js","./nEPQs079.js","./entry.B8GgT5QA.css","./CAANIJCe.js","./BQDKbNwe.js","./C3R8onno.js","./VirtualCell.CZh3Dt_h.css","./gBj2Viq1.js","./DVCdQBfZ.js","./-Hb63wRq.js","./DlJISsR5.js","./boyBAVNN.js","./DAFLhYLz.js","./Cell.DV_4HH8i.css","./Dj2YYI3r.js","./VirtualCell.BsQKIqYj.css","./BVVlkhGF.js","./-QMWbHL6.js","./Cell.CYBwEWH5.css","./DeHkXimq.js","./BhhdTVvF.js","./BMD-JIxU.js","./MenuItem.C7h59s4s.css","./COUq3J8q.js","./C5mABW8R.js","./Divider.DqtSqZhb.css","./C6cwFr3C.js","./Menu.CQ8GNWeI.css","./CNqbIxb7.js","./CsDrjaMN.js","./DivDataCell.1yCNpUg3.css","./DEj7mPxe.js","./UserIcon.JKLzA6N5.css","./CigpOy_T.js","./PYX8IZJE.js","./Badge.D0-UrqG9.css","./CINLm5KA.js","./Cy50pBgZ.js","./BdIpmjdG.js","./ByzT15Y-.js","./BQQOEPN4.js","./COktFmkf.js","./DKtVUO_j.js","./DzMAdbS0.js","./QHUCxglU.js","./links.C8uCzV-l.css","./BDH4PFIz.js","./Tabs.DaLSLYpn.css","./uUEzSIs0.js","./vKaAFL5T.js","./B00EKCmm.js","./DQ9lOBun.js","./eSDe9FnP.js","./BThhIoag.js","./CF0GO8gh.js","./Gr6cVSxP.js","./DeleteModal.SEMJ_gSK.css","./B_7Ene6-.js","./DhnetN0h.js","./C4eCLVVw.js","./index.BSNjFO1V.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as pt,ba as Kt,bL as N,r as f,d0 as ft,cP as Qt,o,U as n,w as s,b as m,P as e,Q as X,c$ as Wt,g6 as Jt,hb as Yt,dS as Zt,hc as Xt,d1 as ea,fC as ta,av as ye,hs as aa,u as oa,at as la,cG as na,L as sa,N as ia,cQ as ra,az as da,hu as ca,ht as ua,hv as ma,g as K,h6 as pa,d4 as Oe,i5 as Te,a_ as it,d2 as fa,l as _a,H as rt,cZ as va,O as ga,c as v,a as i,a8 as Me,al as Q,am as Fe,cd as Ue,R as W,V as $,W as z,d as I,t as p,S as w,T as j,d9 as Z,fG as Ne,Y as dt,dQ as ct,Z as ee,a5 as te,aG as ya,$ as wa,a2 as ha,ap as ba,dt as xa,p as ka,e as Sa,_ as Ca}from"./nEPQs079.js";import{u as Ia,_ as Ra}from"./_EDhj-h1.js";import{F as Ma}from"./BzWD3wIg.js";import{_ as Va}from"./BMD-JIxU.js";import{_ as $a}from"./COUq3J8q.js";import{_ as za}from"./C6cwFr3C.js";import{_ as ja}from"./CNqbIxb7.js";import{_ as La}from"./CF0GO8gh.js";import{u as Da}from"./D8Zaht4D.js";import{a as Aa}from"./BfMXOlc4.js";import{a as Ea}from"./uUEzSIs0.js";import{C as Oa}from"./C3R8onno.js";import{j as ut,e as Ve}from"./DAFLhYLz.js";import{i as Ta}from"./BNDnQ_SZ.js";import{_ as Fa}from"./Be456SY3.js";import{D as mt}from"./Crc5Dj5L.js";import{S as Ua}from"./DhnetN0h.js";import{T as Na}from"./ewl_ufim.js";import{b as Ba,a as Ha,c as Pa,_ as Ga}from"./DUhkN2eB.js";import{_ as qa}from"./BGiMKGQu.js";import"./CZJAloFU.js";import"./0qbEdPZ2.js";import"./CbkeA9B5.js";import"./BdIpmjdG.js";import"./ByzT15Y-.js";import"./BQQOEPN4.js";import"./COktFmkf.js";import"./DKtVUO_j.js";import"./DzMAdbS0.js";import"./QHUCxglU.js";import"./5fs2TD9N.js";import"./BTGvCRQH.js";import"./DYYbRAhI.js";import"./C5mABW8R.js";import"./Gr6cVSxP.js";import"./-Hb63wRq.js";import"./vKaAFL5T.js";import"./boyBAVNN.js";import"./C4eCLVVw.js";import"./QTd5iuHu.js";const Ka=pt({__name:"EditOrAddStack",props:{column:{},optionId:{},isNewStack:{type:Boolean}},emits:["submit","cancel"],setup(u,{emit:R}){const ae=u,oe=R,{column:ce,optionId:O,isNewStack:h}=Kt(ae),_=N(ft,f()),{formState:M,addOrUpdate:le}=Ia(_,ce,void 0,void 0,void 0,f(!0)),{getMeta:we}=Qt(),J=async()=>{var T;await we((T=_.value)==null?void 0:T.id,!0)};async function ne(T=!1,D=!0,B){if(!D&&T){oe("submit");return}const ue=await le(J);T&&ue&&oe("submit",!0,B)}return(T,D)=>{const B=Ra,ue=Ma;return o(),n(ue,{modelValue:e(M),"onUpdate:modelValue":D[1]||(D[1]=H=>X(M)?M.value=H:null),"no-style":"",name:"column-create-or-edit",layout:"vertical","data-testid":"add-or-edit-column",class:"w-full flex"},{default:s(()=>[m(B,{value:e(M),"onUpdate:value":D[0]||(D[0]=H=>X(M)?M.value=H:null),"is-kanban-stack":"","option-id":e(O),"is-new-stack":e(h),onSaveChanges:ne},null,8,["value","option-id","is-new-stack"])]),_:1},8,["modelValue"])}}}),Qa=ee(()=>te(()=>import("./DwvYIORx.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(u=>u.default||u)),Wa=ee(()=>te(()=>import("./CAANIJCe.js"),__vite__mapDeps([3,1,2,4,5,6]),import.meta.url).then(u=>u.default||u)),Ja=ee(()=>te(()=>import("./gBj2Viq1.js"),__vite__mapDeps([7,1,2,8,9,10,4,11,12,5,13]),import.meta.url).then(u=>u.default||u)),Ya=ee(()=>te(()=>import("./Dj2YYI3r.js"),__vite__mapDeps([14,1,2,4,12,15]),import.meta.url).then(u=>u.default||u)),Za=ee(()=>te(()=>import("./BVVlkhGF.js"),__vite__mapDeps([16,1,2,17,5,18]),import.meta.url).then(u=>u.default||u)),Xa=ee(()=>te(()=>import("./DeHkXimq.js"),__vite__mapDeps([19,8,9,1,2,10,4,11,12]),import.meta.url).then(u=>u.default||u)),eo=ee(()=>te(()=>import("./BhhdTVvF.js"),__vite__mapDeps([20,1,2,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,9,8,10,4,11,12,48,49,50,51,52,53,54,55,56,57,58,59,60]),import.meta.url).then(u=>u.default||u)),_t=u=>(ka("data-v-89a03368"),u=u(),Sa(),u),to={class:"flex flex-col w-full bg-gray-50 h-full","data-testid":"nc-kanban-wrapper",style:{minHeight:"calc(100% - var(--topbar-height))"}},ao={key:0,class:"flex flex-row min-h-full gap-x-2"},oo={class:"flex gap-3"},lo=["data-testid"],no={key:0,class:"mt-2.5 px-3 !w-full"},so={"data-testid":"nc-kanban-stack-title",class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},io={class:"flex gap-2 items-center"},ro={class:"flex gap-2 items-center"},co={class:"flex gap-2 items-center"},uo={class:"flex gap-2 items-center"},mo={class:"flex gap-2 items-center"},po={class:"flex gap-2 items-center"},fo=["data-stack-title"],_o={class:"nc-kanban-item py-1 first:pt-2 last:pb-2"},vo=_t(()=>i("a",null,[i("div",null,[i("div")])],-1)),go={class:"z-10 arrow"},yo={class:"z-10 arrow"},wo={key:1,class:"h-52 w-full !flex flex-row !border-b-1 !border-gray-200 items-center justify-center"},ho=_t(()=>i("img",{class:"object-contain w-[48px] h-[48px]",src:Fa},null,-1)),bo=[ho],xo={class:"flex flex-col gap-3 !children:pointer-events-none"},ko={key:0,class:"nc-card-display-value-wrapper"},So={class:"flex flex-col rounded-lg w-full"},Co={class:"flex flex-row w-full justify-start"},Io={class:"nc-card-col-header w-full !children:text-gray-500"},Ro={key:0,class:"flex flex-row w-full text-gray-800 items-center justify-start min-h-7 py-1"},Mo={key:1,class:"flex flex-row w-full h-7 pl-1 items-center justify-start"},Vo={class:"h-full w-full flex flex-col gap-4 items-center justify-center"},$o={class:"flex flex-col items-center gap-2 text-gray-600 text-center"},zo={class:"text-sm font-semibold"},jo={class:"text-xs font-weight-500"},Lo={class:"flex items-center gap-2"},Do={class:"flex items-center justify-between"},Ao={class:"flex items-center gap-2"},Eo={key:1},Oo={class:"nc-kanban-data-count text-gray-500 font-weight-500 px-1"},To=["onClick"],Fo={key:0,class:"!w-full !h-full flex items-center justify-center"},Uo={key:1,class:"nc-kanban-stack-head w-full flex items-center justify-between gap-2"},No={class:"flex items-center gap-1"},Bo={class:"flex-1 flex max-w-[115px]"},Ho={"data-testid":"nc-kanban-stack-title",class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Po={class:"flex items-center gap-3"},Go={class:"nc-kanban-data-count px-1 rounded bg-gray-200 text-gray-800 text-sm font-weight-500",style:{"word-break":"keep-all","white-space":"nowrap"}},qo={key:0,class:"nc-kanban-add-new-stack"},Ko={key:0,class:"mt-2.5 px-3 !w-full"},Qo={class:"flex items-center gap-2"},Wo={class:"flex items-center gap-2 nc-kanban-context-menu-item"},Jo={class:"flex items-center gap-2 nc-kanban-context-menu-item"},Yo={key:0,class:"flex flex-row items-center py-2 px-2.25 bg-gray-100 rounded-lg text-gray-700 mb-4"},Zo={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Xo=100,el=pt({__name:"Kanban",setup(u){const R=N(ft,f()),ae=N(Wt,f()),oe=N(Jt),ce=N(Yt),O=N(Xt,Zt()),h=N(ea,f(!1)),_=N(ta,f(!1)),M=f(!1),le=f(),we=f();ye(aa,f(1));const J=f(!1),ne=f(""),T=f(0),D=oa(),B=D.currentRoute,{getPossibleAttachmentSrc:ue}=Da(),{metaColumnById:H}=Aa(),{loadKanbanData:Be,loadMoreKanbanData:vt,loadKanbanMeta:he,kanbanMetaData:me,formattedData:A,updateOrSaveRow:gt,updateKanbanMeta:yt,addEmptyRow:wt,groupingFieldColOptions:x,updateKanbanStackMeta:$e,groupingField:He,groupingFieldColumn:ze,countByStack:S,deleteStack:ht,shouldScrollToRight:Pe,deleteRow:bt,moveHistory:Ge,addNewStackId:je,removeRowFromUncategorizedStack:xt}=Ea(),{isViewDataLoading:be}=la(na()),{isUIAllowed:Le}=sa(),{appInfo:kt,isMobileMode:qe}=ia(),{addUndo:St,defineViewScope:Ct}=ra();ye(da,f(!1)),ye(ca,f(!1)),ye(ua,f(!1)),ye(ma,f(!0));const C=K(()=>Le("dataEdit")),Ke=N(pa,f([])),It=K(()=>Ke.value.filter(t=>!Oa(t))),F=K(()=>{var t,a;return((a=(t=R.value)==null?void 0:t.columns)==null?void 0:a.find(r=>r.pv&&Ke.value.includes(r)))??null}),pe=K(()=>{var t,a;return(t=R.value)!=null&&t.columnsById?R.value.columnsById[(a=me.value)==null?void 0:a.fk_cover_image_col_id]:{}}),Rt=K(()=>{var a,r;const t=((r=Oe((a=me.value)==null?void 0:a.meta))==null?void 0:r.fk_cover_image_object_fit)||Te.FIT;if(t===Te.FIT)return"!object-contain";if(t===Te.COVER)return"!object-cover"}),xe=f(),fe=f("");oe==null||oe.on(async()=>{await he(),await Be()});const De=t=>{var a;if(!((a=pe.value)!=null&&a.title)||!t.row[pe.value.title])return[];try{const r=typeof t.row[pe.value.title]=="string"?JSON.parse(t.row[pe.value.title]):t.row[pe.value.title];return Array.isArray(r)?r.flat().map(y=>typeof y=="string"?JSON.parse(y):y).filter(y=>y&&!Array.isArray(y)&&typeof y=="object"&&Object.keys(y).length):[]}catch{return[]}},Ae=f(!1);ce==null||ce.on(async()=>{await he(),Ae.value=!0,it(()=>{Ae.value=!1})});const ke=(t,a)=>{const r=Ve(t.row,R.value.columns);we.value=a,r&&!_.value?D.push({query:{...B.value.query,rowId:r}}):(le.value=t,M.value=!0)},Qe=f(!1),se=K({get:()=>Qe.value,set:t=>{C.value&&(Qe.value=t)}}),ie=f(null),Mt=(t,a)=>{t.preventDefault(),a&&(ie.value=a)},Se=K({get(){return!!B.value.query.rowId},set(t){t||D.push({query:{...B.value.query,rowId:void 0}})}}),Vt=async(t,a)=>{const r=t.target;r.closest(".arrow")||r.closest(".slick-dots")||t.target&&ke(a)};function $t(t){if(t.draggedContext.futureIndex===0)return!1}async function Ee(t,a=!1){if(t.moved){const{oldIndex:r,newIndex:y}=t.moved,{fk_grp_col_id:V,meta:L}=me.value;x.value[r].order=y,x.value[y].order=r;const ve=Oe(L)||{};ve[V]=x.value,await yt({meta:ve}),a||St({undo:{fn:async E=>{const re=x.value.splice(E.moved.newIndex,1);x.value.splice(E.moved.oldIndex,0,re[0]),await Ee(E,!0)},args:[{moved:{oldIndex:r,newIndex:y}}]},redo:{fn:async E=>{const re=x.value.splice(E.moved.oldIndex,1);x.value.splice(E.moved.newIndex,0,re[0]),await Ee(E,!0)},args:[{moved:{oldIndex:r,newIndex:y}},!0]},scope:Ct({view:ae.value})})}}async function zt(t,a){if(t.added){const r=t.added.element;Ge.value.unshift({op:"added",pk:Ve(t.added.element.row,R.value.columns),index:t.added.newIndex,stack:a}),r.row[He.value]=a,S.value.set(a,S.value.get(a)+1),await gt(r)}else t.removed&&(S.value.set(a,S.value.get(a)-1),Ge.value.unshift({op:"removed",pk:Ve(t.removed.element.row,R.value.columns),index:t.removed.oldIndex,stack:a}))}const We=fa(async t=>{if(t.target.scrollTop+t.target.clientHeight+Xo>=t.target.scrollHeight){const a=t.target.getAttribute("data-stack-title"),r=kt.value.defaultLimit||25,y=A.value.get(a);if(y&&(S.value.get(a)===void 0||y.length<S.value.get(a))){const V=Math.ceil(y.length/r);await vt(a,{offset:V*r>S.value.get(a)||V*r>y.length?(V-1)*r:V*r})}}}),jt=t=>{t&&(t.removeEventListener("scroll",We),t.addEventListener("scroll",We))},Lt=(t,a)=>{J.value=!0,ne.value=t,T.value=a},Dt=async()=>{await ht(ne.value,T.value),J.value=!1},Je=async t=>{x.value[t].collapsed=!x.value[t].collapsed,_.value||await $e()},At=async()=>{x.value.forEach(t=>{t.id!==je&&!t.collapsed&&(t.collapsed=!0)}),_.value||await $e()},Et=async()=>{x.value.forEach(t=>{t.id!==je&&t.collapsed&&(t.collapsed=!1)}),_.value||await $e()},Ye=async()=>{const t=await wt();t.row={[He.value]:fe.value===""?null:fe.value},S.value.set(null,S.value.get(null)+1),ke(t)};O==null||O.on(Ye),_a(()=>O.off(Ye)),rt(se,()=>{se.value||(ie.value=null)}),rt(ae,async t=>{if((t==null?void 0:t.type)===va.KANBAN){be.value=!0;try{await he(),be.value=!1,await Be(),it(()=>{Pe.value&&xe.value&&(xe.value.scrollTo({left:xe.value.scrollWidth,behavior:"smooth"}),Pe.value=!1)})}catch(a){console.error(a),be.value=!1}}},{immediate:!0});const Ot=t=>{const a=Ve(t.row,R.value.columns);return a?`row-${a}`:""},Tt=K(()=>{var t;return Oe((t=me.value)==null?void 0:t.meta).hide_empty_stack||!1}),U={id:je},g=f(null),b=(t,a)=>(t==null?void 0:t.id)&&(a==null?void 0:a.id)&&t.id===a.id,_e=f(null),Ze=async(t,a,r)=>{_e.value=g.value,g.value=null,a&&(a!=null&&a.title)&&(a!=null&&a.color)&&r!==void 0&&(x.value[r].title=a.title,x.value[r].color=a.color),t&&await he(),_e.value=null};return(t,a)=>{const r=Ua,y=ya,V=wa,L=ha,ve=Ka,E=ba,re=Na,P=Va,Xe=$a,et=za,tt=ja,at=Ba,Ft=Qa,Ut=qa,ot=Wa,lt=Ja,Nt=Ya,Bt=Za,Ce=xa,Ht=Xa,Pt=Ha,Gt=Pa,nt=Ga,st=eo,qt=La,G=ga("e");return o(),v(Q,null,[i("div",to,[i("div",{ref_key:"kanbanContainerRef",ref:xe,class:"nc-kanban-container flex p-3 overflow-y-hidden w-full nc-scrollbar-x-lg",style:Me({minHeight:e(qe)?"calc(100%  - 2rem)":"calc(100vh - var(--topbar-height) - var(--toolbar-height) - 0.4rem)",maxHeight:e(qe)?"calc(100%  - 2rem)":"calc(100vh - var(--topbar-height) - var(--toolbar-height) - 0.4rem)"})},[e(be)?(o(),v("div",ao,[(o(!0),v(Q,null,Fe(Array(20),k=>(o(),n(r,{key:k,class:"!min-w-80 !min-h-full !rounded-xl overflow-hidden"}))),128))])):(o(),n(tt,{key:1,visible:e(se),"onUpdate:visible":a[13]||(a[13]=k=>X(se)?se.value=k:null),trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-kanban-context-menu"},Ue({default:s(()=>{var k;return[i("div",oo,[m(e(mt),{modelValue:e(x),"onUpdate:modelValue":a[3]||(a[3]=l=>X(x)?x.value=l:null),class:"flex gap-3","item-key":"id",group:"kanban-stack",draggable:".nc-kanban-stack",handle:".nc-kanban-stack-drag-handler",filter:".not-draggable",move:$t,onStart:a[4]||(a[4]=l=>l.target.classList.add("grabbing")),onEnd:a[5]||(a[5]=l=>l.target.classList.remove("grabbing")),onChange:a[6]||(a[6]=l=>Ee(l))},{item:s(({element:l,index:q})=>{var Ie;return[i("div",{class:j(["nc-kanban-stack",{"w-[44px]":l.collapsed,hidden:e(Tt)&&!((Ie=e(A).get(l.title))!=null&&Ie.length)}]),"data-testid":`nc-kanban-stack-${l.title}`},[l.collapsed?(o(),n(Ce,{key:`${l.id}-collapsed`,class:j(["nc-kanban-collapsed-stack flex items-center w-68.5 h-[44px] !rounded-xl cursor-pointer h-full !p-2 overflow-hidden !shadow-none !hover:shadow-none !border-gray-200",{"not-draggable":l.title===null||e(h)||e(_)||!e(C)}]),"body-style":{padding:"0px !important",height:"100%",width:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[i("div",{class:"h-full flex items-center justify-between",onClick:de=>Je(q)},[!e(A).get(l.title)||!e(S)?(o(),v("div",Fo,[m(r,{active:!0,class:"!w-full !h-4 !rounded-lg overflow-hidden"})])):(o(),v("div",Uo,[i("div",No,[e(h)||e(_)||!e(C)?w("",!0):(o(),n(L,{key:0,disabled:!l.title,type:"text",size:"xs",class:"nc-kanban-stack-drag-handler !px-1.5 !cursor-move",onClick:a[2]||(a[2]=dt(()=>{},["stop"]))},{default:s(()=>[m(V,{icon:"ncDrag",class:"font-weight-800 flex-none"})]),_:2},1032,["disabled"])),i("div",Bo,[m(re,{class:"max-w-full !rounded-full !px-2 !py-1 h-7 !m-0 !border-none",color:l.color},{default:s(()=>[i("span",{style:Me({color:e(Z).isReadable(l.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Z).mostReadable(l.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-sm font-semibold"},[m(E,{class:"truncate max-w-full",placement:"left","show-on-truncate-only":""},{title:s(()=>[I(p(l.title??"Uncategorized"),1)]),default:s(()=>[i("span",Ho,p(l.title??"Uncategorized"),1)]),_:2},1024)],4)]),_:2},1032,["color"])])]),i("div",Po,[i("div",Go,p(e(A).get(l.title).length)+" "+p(e(S).get(l.title)!==1?t.$t("objects.records"):t.$t("objects.record")),1),m(L,{type:"text",size:"xs",class:"!px-1.5"},{default:s(()=>[(o(),n($(("iconMap"in t?t.iconMap:e(z)).arrowDown),{class:"text-grey h-4 w-4 flex-none"}))]),_:1})])]))],8,To)]),_:2},1032,["class"])):(o(),n(Ce,{key:`${l.id}-${q}`,class:j(["flex flex-col w-68.5 h-full !rounded-xl overflow-y-hidden !shadow-none !hover:shadow-none !border-gray-200",{"not-draggable":l.title===null||e(h)||e(_)||!e(C),"!cursor-default":e(h)||!e(C)}]),"head-style":{paddingBottom:"0px"},"body-style":{padding:"0px !important",height:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[!e(A).get(l.title)||!e(S)?(o(),v("div",no,[m(r,{active:!0,class:"!w-full !h-9.75 !rounded-lg overflow-hidden"})])):(o(),n(nt,{key:1},{default:s(()=>[m(at,{class:"border-b-1 border-gray-100 min-h-[49px]"},{default:s(()=>{var de,d;return[i("div",{class:j(["nc-kanban-stack-head w-full flex gap-1",{"items-start":b(l,e(g)),"items-center":!b(l,e(g))}])},[i("div",{class:j(["flex-1 flex gap-1 max-w-[calc(100%_-_32px)]",{"items-start":b(l,e(g)),"items-center":!b(l,e(g))}])},[e(h)||e(_)||!e(C)?w("",!0):(o(),n(L,{key:0,disabled:!l.title||b(l,e(_e))||b(l,e(g)),type:"text",size:"xs",class:"nc-kanban-stack-drag-handler !px-1.5 !cursor-move !:disabled:cursor-not-allowed mt-0.5"},{default:s(()=>[b(l,e(_e))?(o(),n(y,{key:0,size:"regular",class:"stack-rename-loader"})):(o(),n(V,{key:1,icon:"ncDrag",class:"!font-weight-800 flex-none"}))]),_:2},1032,["disabled"])),i("div",{class:j(["flex-1 flex max-w-[calc(100%_-_28px)]",{"-ml-1":b(l,e(g))}])},[b(l,e(g))&&e(H)[(de=e(g))==null?void 0:de.fk_column_id]?(o(),n(ve,{key:0,column:e(H)[(d=e(g))==null?void 0:d.fk_column_id],"option-id":e(g).id,onSubmit:(ge,Re)=>Ze(ge,Re,q)},null,8,["column","option-id","onSubmit"])):(o(),n(re,{key:1,class:"max-w-full !rounded-full !px-2 !py-1 h-7 !m-0 !border-none !mt-0.5",color:l.color,onDblclick:()=>{l.title!==null&&e(C)&&!e(_)&&!e(h)&&(g.value=l)}},{default:s(()=>[i("span",{style:Me({color:e(Z).isReadable(l.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Z).mostReadable(l.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-sm font-semibold"},[m(E,{class:"truncate max-w-full",placement:"bottom","show-on-truncate-only":""},{title:s(()=>[I(p(l.title??"Uncategorized"),1)]),default:s(()=>[i("span",so,p(l.title??"Uncategorized"),1)]),_:2},1024)],4)]),_:2},1032,["color","onDblclick"]))],2)],2),e(h)?w("",!0):(o(),n(tt,{key:0,placement:"bottomRight","overlay-class-name":"nc-dropdown-kanban-stack-context-menu",class:"bg-white !rounded-lg"},{overlay:s(()=>[m(et,{class:"!text-sm"},{default:s(()=>[e(C)&&!e(_)&&!e(h)?W((o(),n(P,{key:0,"data-testid":"nc-kanban-context-menu-add-new-record",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",io,[(o(),n($(("iconMap"in t?t.iconMap:e(z)).plus),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.addNewRecord")),1)])]),_:2},1032,["onClick"])),[[G,["c:kanban:add-new-record"]]]):w("",!0),l.title!==null&&e(C)&&!e(_)&&!e(h)?W((o(),n(P,{key:1,"data-testid":"nc-kanban-context-menu-rename-stack",onClick:()=>{g.value=l}},{default:s(()=>[i("div",ro,[(o(),n($(("iconMap"in t?t.iconMap:e(z)).ncEdit),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.renameStack")),1)])]),_:2},1032,["onClick"])),[[G,["c:kanban:rename-stack"]]]):w("",!0),W((o(),n(P,{"data-testid":"nc-kanban-context-menu-collapse-stack",onClick:ge=>Je(q)},{default:s(()=>[i("div",co,[(o(),n($(("iconMap"in t?t.iconMap:e(z)).minimize),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.collapseStack")),1)])]),_:2},1032,["onClick"])),[[G,["c:kanban:collapse-stack"]]]),W((o(),n(P,{"data-testid":"nc-kanban-context-menu-collapse-all-stack",onClick:At},{default:s(()=>[i("div",uo,[(o(),n($(("iconMap"in t?t.iconMap:e(z)).minimizeAll),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.collapseAll")),1)])]),_:1})),[[G,["c:kanban:collapse-all-stack"]]]),W((o(),n(P,{"data-testid":"nc-kanban-context-menu-expand-all-stack",onClick:Et},{default:s(()=>[i("div",mo,[(o(),n($(("iconMap"in t?t.iconMap:e(z)).maximizeAll),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.expandAll")),1)])]),_:1})),[[G,["c:kanban:expand-all-stack"]]]),l.title!==null&&!e(_)&&e(C)?(o(),v(Q,{key:2},[m(Xe),W((o(),n(P,{class:"!text-red-600 !hover:bg-red-50","data-testid":"nc-kanban-context-menu-delete-stack",onClick:ge=>Lt(l.title,q)},{default:s(()=>[i("div",po,[(o(),n($(("iconMap"in t?t.iconMap:e(z)).delete),{class:"flex-none w-4 h-4"})),I(" "+p(t.$t("activity.kanban.deleteStack")),1)])]),_:2},1032,["onClick"])),[[G,["c:kanban:delete-stack"]]])],64)):w("",!0)]),_:2},1024)]),default:s(()=>[m(L,{disabled:b(l,e(_e)),type:"text",size:"xs",class:"!px-1.5 mt-0.5","data-testid":"nc-kanban-stack-context-menu"},{default:s(()=>[m(V,{icon:"threeDotVertical"})]),_:2},1032,["disabled"])]),_:2},1024))],2)]}),_:2},1024),m(Pt,{class:"overflow-y-hidden",style:Me({backgroundColor:e(Z).mix(l.color||"#ccc","#ffffff",e(Z)(l.color||"#ccc").isLight()?70:e(Z)(l.color||"#ccc").getBrightness()<=100?80:90).toString()})},{default:s(()=>{var de;return[i("div",{ref:jt,class:"nc-kanban-list h-full px-2 nc-scrollbar-thin","data-stack-title":l.title},[m(e(mt),{list:e(A).get(l.title),"item-key":"row.Id",draggable:".nc-kanban-item",group:"kanban-card",class:"flex flex-col h-full",filter:".not-draggable",onStart:a[0]||(a[0]=d=>d.target.classList.add("grabbing")),onEnd:a[1]||(a[1]=d=>d.target.classList.remove("grabbing")),onChange:d=>zt(d,l.title)},Ue({item:s(({element:d,index:ge})=>[i("div",_o,[m(Ht,{row:d},{default:s(()=>{var Re;return[(o(),n(Ce,{key:`${Ot(d)}-${ge}`,class:j(["!rounded-lg h-full border-gray-200 border-1 group overflow-hidden break-all max-w-[450px] cursor-pointer",{"not-draggable":e(h)||!e(C)||e(_),"!cursor-default":e(h)||!e(C)||e(_)}]),"body-style":{padding:"16px !important"},"data-stack":l.title,"data-testid":`nc-gallery-card-${d.row.id}`,onClick:c=>Vt(c,d),onContextmenu:c=>Mt(c,d)},Ue({default:s(()=>[i("div",xo,[e(F)?(o(),v("h2",ko,[("isRowEmpty"in t?t.isRowEmpty:e(ut))(d,e(F))?(o(),v(Q,{key:1},[I(" - ")],64)):(o(),v(Q,{key:0},[e(Ne)(e(F))?(o(),n(ot,{key:0,modelValue:d.row[e(F).title],"onUpdate:modelValue":c=>d.row[e(F).title]=c,class:"!text-brand-500",column:e(F),row:d},null,8,["modelValue","onUpdate:modelValue","column","row"])):(o(),n(lt,{key:1,modelValue:d.row[e(F).title],"onUpdate:modelValue":c=>d.row[e(F).title]=c,class:"!text-brand-500",column:e(F),"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))],64))])):w("",!0),(o(!0),v(Q,null,Fe(e(It),c=>(o(),v("div",{key:`record-${d.row.id}-${c.id}`},[i("div",So,[i("div",Co,[i("div",Io,[e(Ne)(c)?(o(),n(Nt,{key:0,column:c,"hide-menu":!0},null,8,["column"])):(o(),n(Bt,{key:1,column:c,"hide-menu":!0},null,8,["column"]))])]),("isRowEmpty"in t?t.isRowEmpty:e(ut))(d,c)?(o(),v("div",Mo,"-")):(o(),v("div",Ro,[e(Ne)(c)?(o(),n(ot,{key:0,modelValue:d.row[c.title],"onUpdate:modelValue":Y=>d.row[c.title]=Y,column:c,row:d,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column","row"])):(o(),n(lt,{key:1,modelValue:d.row[c.title],"onUpdate:modelValue":Y=>d.row[c.title]=Y,column:c,"edit-enabled":!1,"read-only":!0,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column"]))]))])]))),128))])]),_:2},[(Re=e(me))!=null&&Re.fk_cover_image_col_id?{name:"cover",fn:s(()=>[!e(Ae)&&De(d).length?(o(),n(Ut,{key:De(d).reduce((c,Y)=>c+(Y==null?void 0:Y.path),""),class:"gallery-carousel !border-b-1 !border-gray-200",arrows:""},{customPaging:s(()=>[vo]),prevArrow:s(()=>[i("div",go,[m(L,{type:"secondary",size:"xsmall",class:"!absolute !left-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:s(()=>[m(V,{icon:"arrowLeft",class:"text-gray-700 w-4 h-4"})]),_:1})])]),nextArrow:s(()=>[i("div",yo,[m(L,{type:"secondary",size:"xsmall",class:"!absolute !right-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:s(()=>[m(V,{icon:"arrowRight",class:"text-gray-700 w-4 h-4"})]),_:1})])]),default:s(()=>[(o(!0),v(Q,null,Fe(De(d),c=>(o(),v(Q,null,[("isImage"in t?t.isImage:e(Ta))(c.title,c.mimetype??c.type)?(o(),n(Ft,{key:c.path,class:j(["h-52",[`${e(Rt)}`]]),srcs:e(ue)(c)},null,8,["class","srcs"])):w("",!0)],64))),256))]),_:2},1024)):(o(),v("div",wo,bo))]),key:"0"}:void 0]),1032,["data-stack","data-testid","class","onClick","onContextmenu"]))]}),_:2},1032,["row"])])]),_:2},[(de=e(A).get(l.title))!=null&&de.length?void 0:{name:"footer",fn:s(()=>[i("div",Vo,[i("div",$o,[i("span",zo,p(t.$t("general.empty"))+" "+p(t.$t("general.stack").toLowerCase()),1),i("span",jo,p(t.$t("title.looksLikeThisStackIsEmpty")),1)]),e(Le)("dataInsert")?(o(),n(L,{key:0,size:"xs",type:"secondary",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",Lo,[!e(_)&&!e(h)?(o(),n($(("iconMap"in t?t.iconMap:e(z)).plus),{key:0})):w("",!0),I(" "+p(t.$t("activity.newRecord")),1)])]),_:2},1032,["onClick"])):w("",!0)])]),key:"0"}]),1032,["list","onChange"])],8,fo)]}),_:2},1032,["style"]),e(A).get(l.title)?(o(),n(Gt,{key:0,class:"border-t-1 border-gray-100"},{default:s(()=>[i("div",Do,[e(Le)("dataInsert")?(o(),n(L,{key:0,size:"xs",type:"secondary",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",Ao,[!e(_)&&!e(h)?(o(),n($(("iconMap"in t?t.iconMap:e(z)).plus),{key:0,class:""})):w("",!0),I(" "+p(t.$t("activity.newRecord")),1)])]),_:2},1032,["onClick"])):(o(),v("div",Eo," ")),i("div",Oo,p(e(A).get(l.title).length)+"/"+p(e(S).get(l.title)??0)+" "+p(e(S).get(l.title)!==1?t.$t("objects.records"):t.$t("objects.record")),1)])]),_:2},1024)):w("",!0)]),_:2},1024))]),_:2},1032,["class"]))],10,lo)]}),_:1},8,["modelValue"]),e(C)&&!e(_)&&!e(h)&&((k=e(ze))!=null&&k.id)?(o(),v("div",qo,[m(Ce,{class:j(["flex flex-col w-68.5 !rounded-xl overflow-y-hidden !shadow-none !hover:shadow-none border-gray-200",{"!cursor-default":e(h)||!e(C),"!border-none":!b(U,e(g))}]),"head-style":{paddingBottom:"0px"},"body-style":{padding:"0px !important",height:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[!e(A).get(null)||!e(S)?(o(),v("div",Ko,[m(r,{active:!0,class:"!w-full !h-9.75 !rounded-lg overflow-hidden"})])):(o(),n(nt,{key:1},{default:s(()=>[m(at,{class:j({"!p-0 overflow-hidden":!b(U,e(g))})},{default:s(()=>{var l,q;return[i("div",{class:j(["w-full flex",{"items-start":b(U,e(g)),"cursor-pointer":!b(U,e(g))}]),onClick:a[9]||(a[9]=()=>{b(U,e(g))||(g.value=U)})},[b(U,e(g))?(o(),v("div",{key:1,class:j(["flex-1 flex",{"-ml-1":b(U,e(g))}]),onClick:a[8]||(a[8]=dt(()=>{},["stop"]))},[b(U,e(g))&&e(H)[(l=e(ze))==null?void 0:l.id]?(o(),n(ve,{key:0,column:e(H)[(q=e(ze))==null?void 0:q.id],"is-new-stack":"",onSubmit:a[7]||(a[7]=Ie=>Ze(Ie,void 0))},null,8,["column"])):w("",!0)],2)):(o(),n(L,{key:0,type:"secondary",class:"add-new-stack-btn w-full !rounded-xl min-h-11"},{default:s(()=>[i("div",Qo,[!e(_)&&!e(h)?(o(),n($(("iconMap"in t?t.iconMap:e(z)).plus),{key:0,class:""})):w("",!0),I(" "+p(t.$t("general.new"))+" "+p(t.$t("general.stack").toLowerCase()),1)])]),_:1}))],2)]}),_:1},8,["class"])]),_:1}))]),_:1},8,["class"])])):w("",!0)])]}),_:2},[!e(h)&&!e(_)&&e(C)?{name:"overlay",fn:s(()=>[m(et,{onClick:a[12]||(a[12]=k=>se.value=!1)},{default:s(()=>[e(ie)?(o(),n(P,{key:0,onClick:a[10]||(a[10]=k=>ke(e(ie)))},{default:s(()=>[W((o(),v("div",Wo,[(o(),n($(("iconMap"in t?t.iconMap:e(z)).expand),{class:"flex"})),I(" "+p(t.$t("activity.expandRecord")),1)])),[[G,["a:kanban:expand-record"]]])]),_:1})):w("",!0),m(Xe),e(ie)?(o(),n(P,{key:1,class:"!text-red-600 !hover:bg-red-50",onClick:a[11]||(a[11]=k=>e(bt)(e(ie)))},{default:s(()=>[W((o(),v("div",Jo,[(o(),n($(("iconMap"in t?t.iconMap:e(z)).delete),{class:"flex"})),I(" "+p(t.$t("activity.deleteRecord")),1)])),[[G,["a:kanban:delete-record"]]])]),_:1})):w("",!0)]),_:1})]),key:"0"}:void 0]),1032,["visible"]))],4)]),(o(),n(ct,null,{default:s(()=>[e(le)&&e(M)?(o(),n(st,{key:0,modelValue:e(M),"onUpdate:modelValue":a[14]||(a[14]=k=>X(M)?M.value=k:null),row:e(le),state:e(we),meta:e(R),"load-row":!e(_),view:e(ae),onCancel:e(xt)},null,8,["modelValue","row","state","meta","load-row","view","onCancel"])):w("",!0)]),_:1})),(o(),n(ct,null,{default:s(()=>{var k;return[e(Se)&&((k=e(R))!=null&&k.id)?(o(),n(st,{key:0,modelValue:e(Se),"onUpdate:modelValue":a[15]||(a[15]=l=>X(Se)?Se.value=l:null),"load-row":!e(_),row:e(le)??{row:{},oldRow:{},rowMeta:{}},meta:e(R),"expand-form":ke,"row-id":e(B).query.rowId,view:e(ae)},null,8,["modelValue","load-row","row","meta","row-id","view"])):w("",!0)]}),_:1})),m(qt,{visible:e(J),"onUpdate:visible":a[16]||(a[16]=k=>X(J)?J.value=k:null),"entity-name":"Stack","on-delete":Dt},{"entity-preview":s(()=>[e(ne)?(o(),v("div",Yo,[i("div",Zo,p(e(ne)),1)])):w("",!0)]),_:1},8,["visible"])],64)}}}),Nl=Ca(el,[["__scopeId","data-v-89a03368"]]);export{Nl as default};
