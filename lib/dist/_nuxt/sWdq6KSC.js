const __vite__fileDeps=["./qAM_WqEm.js","./3QBYHahY.js","./entry.Ic44fwRn.css","./EmojiPicker.B3qwzTNG.css","./Cp5O2m5x.js","./CfCRYnGS.js","./C726Gdw3.js","./Overlay.BGbSKdGB.css","./Dg1gNFnz.js","./Ci1lK5Ee.js","./xnDaHwV-.js","./View.B2EG4bUV.css","./Dxayr4Dn.js","./BtNrnrmS.js","./BaYZe_0_.js","./Dsa3ljIC.js","./CptMOkl-.js","./DdUr8XSo.js","./MenuItem.C7h59s4s.css","./leimKhvx.js","./CyuhXrst.js","./Divider.DqtSqZhb.css","./PcgFfkcK.js","./Menu.CQ8GNWeI.css","./Kma333Sh.js","./B4uVmeYG.js","./DeZFPfai.js","./DkE_qgY_.js","./2yzrrcqg.js","./Tabs.DaLSLYpn.css","./ChSCnN6E.js","./Menu.CgrqNPiu.css","./kC1vA9nq.js","./S6k-HM05.js","./DiZ67kIC.js","./Modal.Bu3vZLfr.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as Oe,o as t,c as V,cP as Ds,f as pe,ay as pt,az as te,cQ as qe,cR as Ie,N as De,g as ae,O as Fe,P as e,b as a,w as o,d as K,t as y,R as Z,S as f,a as v,U as ee,T as E,$ as We,a0 as Ue,a1 as Wt,ai as aa,ad as Ye,cS as Xa,cT as Ct,aA as at,cU as st,r as I,cV as ta,H as Je,b1 as ut,Q as le,aj as ue,ak as Pe,aO as ba,L as ze,cM as Ge,a8 as _a,cW as sa,aM as St,cX as ls,cY as kt,cZ as ya,at as ga,F as wa,a9 as Cs,aL as dt,Y as ve,A as Ne,c_ as Ss,c$ as Vs,ar as Kt,ae as oa,aH as is,d0 as Vt,d1 as fa,i as jt,bc as js,a7 as tt,d2 as Ms,n as Me,d3 as Ps,B as Gt,bN as Ae,d4 as xa,d5 as Ht,d6 as ke,d7 as rs,aN as ka,p as na,e as la,aB as xt,d8 as Es,d9 as Ns,da as Bs,db as ia,aq as _e,ab as Ls,Z as ht,a6 as $t,dc as Os,av as ha,dd as Us,de as Dt,ac as Rs,M as As,as as cs,df as ds,V as us,W as zs,dg as Gs,dh as es,di as Fs,X as et,dj as Ws,bV as Ks,u as $a,dk as ps,dl as Hs,co as qs,dm as ts,dn as as,dp as Js,dq as Ys,dr as Qs,ds as Zs,aV as Xs,aG as ss,dt as eo,du as to,cB as ao,dv as so,dw as os,a4 as oo,a5 as no}from"./3QBYHahY.js";import{_ as lo}from"./C53Akvvw.js";import{u as ra}from"./Uiq3YTcq.js";import{S as ms}from"./Giw8WUI1.js";import"./BH8oNBwT.js";import{_ as ca}from"./C95Svpv6.js";import{b as io,a as ro}from"./CWtzMcwx.js";import"./kHOslGNR.js";import{I as Ia}from"./CmN9vPg3.js";import{F as Ft}from"./DAKhk9t6.js";import{_ as Ta}from"./Bk0xUMNV.js";import{_ as co,a as uo,b as po}from"./BpWFRerK.js";import{_ as mo}from"./BsWDDIqE.js";import{u as Mt}from"./C_IZzKNf.js";import{u as ns,_ as vs}from"./B3xChUf-.js";import{_ as Pt}from"./CJ26qO3d.js";import{C as Da}from"./Dg1gNFnz.js";import{_ as Ca}from"./CyuhXrst.js";import{_ as vo}from"./CfCRYnGS.js";import{_ as fo,u as bo}from"./BeaxC1ZC.js";import{_ as qt}from"./DdUr8XSo.js";import{_ as Sa}from"./leimKhvx.js";import{_ as _o,a as yo}from"./CQG617t7.js";import{_ as go}from"./CoNP9Geb.js";import{u as Be}from"./BVQBF9Vn.js";import{_ as da}from"./PcgFfkcK.js";import{_ as Jt}from"./Kma333Sh.js";import{S as fs}from"./C0-Qcoum.js";import{_ as Va}from"./DQEIlAel.js";import{_ as wo}from"./CTSlxRce.js";import{_ as bs}from"./BkiSZLeF.js";import{_ as xo}from"./BrEnaVC0.js";import{_ as ko,C as ho}from"./CPUhUHn0.js";import{I as $o}from"./HnlR1fDL.js";import{D as Io}from"./Ddy65kPJ.js";import{_ as To}from"./DmzaAQYu.js";import{_ as Do}from"./DHn6lT7K.js";import{_ as Co}from"./B8d2yde0.js";import{_ as So}from"./D7hrRKCy.js";import{u as _s}from"./CkUu2qpu.js";import"./DEVpQDRz.js";import"./DiVAloGI.js";import"./DPgYHC40.js";import"./ceYq-xax.js";import"./BQQOEPN4.js";import"./xnDaHwV-.js";import"./wEQwkVjR.js";import"./CGxepfeV.js";import"./DgfVJyEd.js";import"./Ci1lK5Ee.js";import"./C726Gdw3.js";import"./DEDKhbvL.js";import"./BSepFqtU.js";import"./BEpKpjF5.js";import"./3ezdMRmZ.js";import"./CdQRhxEe.js";import"./B4uVmeYG.js";import"./DkE_qgY_.js";import"./P3kwmRxC.js";import"./Cu_tC_Dm.js";import"./CdYx1kPu.js";import"./ISaCd8Ij.js";import"./BV5EkxN-.js";import"./DPqnb67u.js";import"./CtMydB5S.js";import"./D4iSzjWt.js";import"./CsJPQclb.js";const Vo={},jo={class:"flex flex-row flex-grow pl-0.5 pr-1 py-0.5 rounded-md w-full",style:{"max-width":"calc(100% - 2.5rem)"}},Mo=Ds('<div class="flex-grow min-w-20" data-v-144435fb><div data-testid="nc-workspace-menu" class="flex items-center nc-workspace-menu overflow-hidden py-1.25 pr-0.25 justify-center w-full ml-2" data-v-144435fb><a class="transition-all duration-200 transform w-24 min-w-10" href="#" target="_blank" rel="noopener noreferrer" data-v-144435fb><img alt="NocoDB" src="'+lo+'" data-v-144435fb></a><div class="flex flex-grow" data-v-144435fb></div></div></div>',1),Po=[Mo];function Eo(c,P){return t(),V("div",jo,Po)}const No=Oe(Vo,[["render",Eo],["__scopeId","data-v-144435fb"]]),Bo=["data-workspace-title"],Lo={key:0,class:"flex flex-row items-center w-full"},Oo=v("div",{class:"flex flex-grow min-w-1"},null,-1),Uo={class:"flex items-center text-inherit"},Ro={key:1,class:"flex flex-row items-center w-full mt-0.25 ml-2.5 gap-x-3"},Ao=pe({__name:"Header",setup(c){const P=pt(),{isLeftSidebarOpen:d}=te(ra()),{activeWorkspace:r,isWorkspaceLoading:l}=te(P),{activeViewTitleOrId:_}=te(qe()),{activeTableId:N}=te(Ie()),{isMobileMode:B}=De(),j=ae(()=>!(B.value&&!_.value&&!N.value));return(k,s)=>{var O;const T=No,C=We,g=Ue,w=Wt,L=ms,n=Fe("e");return t(),V("div",{class:"flex items-center nc-sidebar-header w-full border-b-1 border-gray-200 group md:px-2 md:py-1.2 xs:px-1 xs:py-1","data-workspace-title":(O=e(r))==null?void 0:O.title,style:{height:"var(--topbar-height)"}},[e(l)?(t(),V("div",Ro,[a(L,{active:!0,class:"!w-6 !h-6 !rounded overflow-hidden"}),a(L,{active:!0,class:"!w-40 !h-6 !rounded overflow-hidden"})])):(t(),V("div",Lo,[a(T),Oo,a(w,{class:ee(["flex",{"!opacity-100":!e(d)}]),placement:"bottom","hide-on-click":""},{title:o(()=>[K(y(e(d)?`${k.$t("title.hideSidebar")}`:`${k.$t("title.showSidebar")}`),1)]),default:o(()=>[e(j)?Z((t(),f(g,{key:0,type:e(B)?"secondary":"text",size:e(B)?"medium":"small",class:"nc-sidebar-left-toggle-icon !text-gray-700 !hover:text-gray-800 !xs:h-10.5 !xs:max-h-10.5 !xs:max-w-10.5 !md:hover:bg-gray-200",onClick:s[0]||(s[0]=x=>d.value=!e(d))},{default:o(()=>[v("div",Uo,[e(B)?(t(),f(C,{key:0,icon:"close"})):(t(),f(C,{key:1,icon:"doubleLeftArrow",class:ee(["duration-150 transition-all !text-lg -mt-0.5 !text-gray-500/75",{"transform rotate-180":!e(d)}])},null,8,["class"]))])]),_:1},8,["type","size"])),[[n,["c:leftSidebar:hideToggle"]]]):E("",!0)]),_:1},8,["class"])]))],8,Bo)}}}),zo={class:"flex flex-row items-center text-base text-gray-800"},Go={class:"mt-1"},Fo={class:"flex flex-row justify-end mt-5 gap-x-2"},Wo=pe({__name:"CreateProjectDlg",props:{modelValue:{type:Boolean},type:{}},emits:["update:modelValue"],setup(c,{emit:P}){const d=c,r=P,{t:l}=aa(),_=Ye(d,"modelValue",r),N=Xa(()=>d.type??Ct.DB),B=at(),{createProject:j}=B,{navigateToProject:k}=De(),{refreshCommandPalette:s}=st(),T=[{required:!0,message:l("msg.info.dbNameRequired")},io()],C=I(),g=I({title:"",meta:{iconColor:ta[Math.floor(Math.random()*1e3)%ta.length]}}),w=I(!1),L=async()=>{g.value.title&&(g.value.title=g.value.title.trim()),w.value=!0;try{const x=await j({type:N.value,title:g.value.title,meta:g.value.meta});k({baseId:x.id,type:N.value,workspaceId:"nc"}),_.value=!1}catch(x){ue.error(await Pe(x))}finally{setTimeout(()=>{w.value=!1},500),s()}},n=I();Je(_,async(x,i)=>{x===i&&!x||setTimeout(async()=>{var u,h,p,A,M;(u=C.value)==null||u.resetFields(),g.value={title:"Base",meta:{iconColor:ta[Math.floor(Math.random()*1e3)%ta.length]}},await ut(),(p=(h=n.value)==null?void 0:h.$el)==null||p.focus(),(M=(A=n.value)==null?void 0:A.$el)==null||M.select()},5)});const O=Xa(()=>{switch(N.value){case Ct.DB:default:return"Base"}});return(x,i)=>{const u=ba,h=Ia,p=Ta,A=Ft,M=Ue,W=ca,H=Fe("e");return t(),f(W,{visible:e(_),"onUpdate:visible":i[2]||(i[2]=Y=>le(_)?_.value=Y:null),size:"small","show-separator":!1},{header:o(()=>[v("div",zo,[a(u,{color:e(g).meta.iconColor,type:e(N),class:"mr-2.5 !text-lg !h-4"},null,8,["color","type"]),K(" "+y(x.$t("general.createEntity",{entity:e(O)})),1)])]),default:o(()=>[v("div",Go,[a(A,{ref_key:"form",ref:C,model:e(g),name:"basic",layout:"vertical",class:"w-full !mx-auto","no-style":"",autocomplete:"off",onFinish:L},{default:o(()=>[a(p,{name:"title",rules:T,class:"!mb-0"},{default:o(()=>[a(h,{ref_key:"input",ref:n,value:e(g).title,"onUpdate:value":i[0]||(i[0]=Y=>e(g).title=Y),name:"title",class:"nc-metadb-base-name nc-input-sm nc-input-shadow",placeholder:"Title"},null,8,["value"])]),_:1})]),_:1},8,["model"]),v("div",Fo,[a(M,{type:"secondary",size:"small",onClick:i[1]||(i[1]=Y=>_.value=!1)},{default:o(()=>[K(y(x.$t("general.cancel")),1)]),_:1}),Z((t(),f(M,{"data-testid":"docs-create-proj-dlg-create-btn",loading:e(w),type:"primary",size:"small",label:`${x.$t("general.create")} ${e(O)}`,"loading-label":`${x.$t("general.creating")} ${e(O)}`,onClick:L},{loading:o(()=>[K(y(x.$t("general.creatingEntity",{entity:e(O)})),1)]),default:o(()=>[K(y(x.$t("general.createEntity",{entity:e(O)}))+" ",1)]),_:1},8,["loading","label","loading-label"])),[[H,["a:base:create"]]])])])]),_:1},8,["visible"])}}}),ja=Oe(Wo,[["__scopeId","data-v-3e0aea55"]]),Ko=pe({__name:"CreateProjectBtn",props:{activeWorkspaceId:{},modal:{type:Boolean},type:{},isOpen:{type:Boolean},size:{},centered:{type:Boolean}},setup(c){const P=c,{isUIAllowed:d}=ze(),{orgRoles:r,workspaceRoles:l}=ze(),_=Ge(),{isSharedBase:N}=te(_),B=pt();te(B);const j=I(!1),k=ae(()=>P.size||"small"),s=ae(()=>P.centered??!0);return(T,C)=>{const g=ja,w=Ue,L=Fe("e");return e(d)("baseCreate",{roles:e(l)??e(r)})&&!e(N)?Z((t(),f(w,{key:0,type:"text",size:e(k),centered:e(s),onClick:C[1]||(C[1]=n=>j.value=!0)},{default:o(()=>[_a(T.$slots,"default"),a(g,{modelValue:e(j),"onUpdate:modelValue":C[0]||(C[0]=n=>le(j)?j.value=n:null)},null,8,["modelValue"])]),_:3},8,["size","centered"])),[[L,["c:base:create"]]]):E("",!0)}}}),Ho={key:0,class:"flex flex-col w-full gap-y-3.75 ml-3 mt-3.75"},qo={key:0,class:"flex flex-row items-center w-full gap-x-3"},Jo={class:"flex flex-row items-center w-full gap-x-3"},Yo={class:"flex flex-row items-center w-full gap-x-3"},Qo={key:1,class:"xs:hidden flex flex-col p-1 mt-0.25 mb-0.5 truncate"},Zo={class:"gap-x-2 flex flex-row w-full items-center !font-normal"},Xo={class:"flex"},en=pe({__name:"TopSection",setup(c){const P=pt(),d=Ge(),{isUIAllowed:r}=ze(),{appInfo:l}=De(),{meta:_,control:N}=sa(),{isWorkspaceLoading:B,isWorkspaceSettingsPageOpened:j,isIntegrationsPageOpened:k}=te(P),{navigateToWorkspaceSettings:s,navigateToIntegrations:T}=P,{isSharedBase:C}=te(d),g=I(!1),w=()=>{const n=St()?_.value:N.value;s("",n)},L=()=>{const n=St()?_.value:N.value;T("",n)};return(n,O)=>{const x=ms,i=We,u=Ue,h=Ko,p=Fe("e");return e(B)?(t(),V("div",Ho,[e(l).ee?(t(),V("div",qo,[a(x,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),a(x,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})])):E("",!0),v("div",Jo,[a(x,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),a(x,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})]),v("div",Yo,[a(x,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),a(x,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})])])):e(C)?E("",!0):(t(),V("div",Qo,[e(r)("workspaceSettings")||e(r)("workspaceCollaborators")?Z((t(),f(u,{key:0,type:"text",size:"xsmall",class:ee(["nc-sidebar-top-button !xs:hidden my-0.5 !h-7",{"!text-brand-600 !bg-brand-50 !hover:bg-brand-50":e(j),"!hover:bg-gray-200 !hover:text-gray-700":!e(j)}]),"data-testid":"nc-sidebar-team-settings-btn",centered:!1,onClick:w},{default:o(()=>[v("div",{class:ee(["flex items-center gap-2",{"font-semibold":e(j)}])},[a(i,{icon:"settings",class:"!h-4"}),v("div",null,y(n.$t("title.teamAndSettings")),1)],2)]),_:1},8,["class"])),[[p,["c:team:settings"]]]):E("",!0),e(r)("workspaceSettings")?Z((t(),f(u,{key:1,type:"text",size:"xsmall",class:ee(["nc-sidebar-top-button !xs:hidden my-0.5 !h-7",{"!text-brand-600 !bg-brand-50 !hover:bg-brand-50":e(k),"!hover:bg-gray-200 !hover:text-gray-700":!e(k)}]),"data-testid":"nc-sidebar-integrations-btn",centered:!1,onClick:L},{default:o(()=>[v("div",{class:ee(["flex items-center gap-2",{"font-semibold":e(k)}])},[a(i,{icon:"integration",class:"!h-4"}),v("div",null,y(n.$t("general.integrations")),1)],2)]),_:1},8,["class"])),[[p,["c:integrations"]]]):E("",!0),a(h,{"is-open":e(g),"onUpdate:isOpen":O[0]||(O[0]=A=>le(g)?g.value=A:null),modal:"",type:"text",class:"nc-sidebar-top-button !hover:bg-gray-200 !hover:text-gray-700 !xs:hidden !h-7 my-0.5","data-testid":"nc-sidebar-create-base-btn"},{default:o(()=>[v("div",Zo,[a(i,{icon:"plus"}),v("div",Xo,y(n.$t("title.createBase")),1)])]),_:1},8,["is-open"])]))}}}),tn=Oe(en,[["__scopeId","data-v-c2c73dce"]]),an={class:"flex flex-row items-center gap-x-2"},sn={class:"text-gray-900 font-bold"},on={class:"mt-1"},nn={class:"flex flex-row justify-end gap-x-2 mt-5"},ln=pe({__name:"TableDescriptionUpdate",props:{modelValue:{type:Boolean},tableMeta:{},sourceId:{}},emits:["update:modelValue","updated"],setup(c,{emit:P}){const d=ls(c,["tableMeta"]),r=P,{$e:l,$api:_}=Ne(),{setMeta:N}=kt(),B=Ye(d,"modelValue",r),{loadProjectTables:j}=Ie(),k=Ge(),{loadTables:s}=k,{addUndo:T,defineProjectScope:C}=ya(),g=I(),w=I(!1),L=Ft.useForm,n=ga({description:""}),O=ae(()=>({description:[{validator:(u,h)=>new Promise((p,A)=>{p()})}]})),{validateInfos:x}=L(n,O);wa(()=>{var u;(u=c.tableMeta)!=null&&u.description&&(n.description=`${c.tableMeta.description}`),ut(()=>{var p;const h=(p=g.value)==null?void 0:p.$el;h&&(h.setSelectionRange(0,n.description.length),h.focus())})},{flush:"post"});const i=async(u=!1)=>{if(c.tableMeta){n.description&&(n.description=n.description.trim()),w.value=!0;try{await _.dbTable.update(c.tableMeta.id,{base_id:c.tableMeta.base_id,description:n.description}),B.value=!1,await j(c.tableMeta.base_id,!0),u||T({redo:{fn:p=>{n.description=p,i(!0,!0)},args:[n.description]},undo:{fn:p=>{n.description=p,i(!0,!0)},args:[c.tableMeta.description]},scope:C({model:c.tableMeta})}),await s();const h=await _.dbTable.read(c.tableMeta.id);await N(h),l("a:table:description:update"),B.value=!1}catch(h){ue.error(await Pe(h))}w.value=!1}};return(u,h)=>{const p=We,A=mo,M=Ta,W=Ft,H=Ue,Y=ca;return t(),f(Y,{visible:e(B),"onUpdate:visible":h[4]||(h[4]=q=>le(B)?B.value=q:null),size:"small","show-separator":!1},{header:o(()=>{var q,m;return[v("div",an,[a(p,{icon:"table",class:"w-6 h-6 text-gray-700"}),v("span",sn,y(((q=u.tableMeta)==null?void 0:q.title)??((m=u.tableMeta)==null?void 0:m.table_name)),1)])]}),default:o(()=>{var q,m,D,R;return[v("div",on,[a(W,{layout:"vertical",model:e(n),name:"create-new-table-form"},{default:o(()=>[a(M,Cs({label:u.$t("labels.description")},e(x).description),{default:o(()=>[a(A,{ref_key:"inputEl",ref:g,value:e(n).description,"onUpdate:value":h[0]||(h[0]=z=>e(n).description=z),class:"nc-input-sm !py-2 nc-text-area nc-input-shadow","hide-details":"",size:"small",placeholder:u.$t("msg.info.enterTableDescription"),onKeydown:h[1]||(h[1]=dt(ve(()=>i(),["exact"]),["enter"]))},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1},8,["model"]),v("div",nn,[a(H,{type:"secondary",size:"small",onClick:h[2]||(h[2]=z=>B.value=!1)},{default:o(()=>[K(y(u.$t("general.cancel")),1)]),_:1}),a(H,{key:"submit",type:"primary",size:"small",disabled:((m=(q=e(x))==null?void 0:q.description)==null?void 0:m.validateStatus)==="error"||((D=e(n).description)==null?void 0:D.trim())===((R=u.tableMeta)==null?void 0:R.description),loading:e(w),onClick:h[3]||(h[3]=()=>i())},{default:o(()=>[K(y(u.$t("general.save")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),rn=Oe(ln,[["__scopeId","data-v-4ec58e01"]]),cn={class:"flex flex-row items-center gap-x-2"},dn={class:"mt-1"},un={class:"flex flex-row justify-end gap-x-2 mt-5"},pn=pe({__name:"TableRename",props:{modelValue:{type:Boolean},tableMeta:{},sourceId:{}},emits:["update:modelValue","updated"],setup(c,{emit:P}){const d=ls(c,["tableMeta","sourceId"]),r=P,{$e:l,$api:_}=Ne(),{setMeta:N}=kt(),B=Ye(d,"modelValue",r),{updateTab:j}=Mt(),{loadProjectTables:k}=Ie(),s=Ge(),{loadTables:T,isMysql:C,isMssql:g,isPg:w}=s,{tables:L,base:n}=te(s),{allRecentViews:O}=te(qe()),{refreshCommandPalette:x}=st(),{addUndo:i,defineProjectScope:u}=ya(),h=I(),p=I(!1),A=Ft.useForm,M=ga({title:""}),W=ae(()=>({title:[ro,{validator:(q,m)=>new Promise((D,R)=>{var de;let z=255;if(C(c.sourceId)?z=64:w(c.sourceId)?z=63:g(c.sourceId)&&(z=128),((((de=n==null?void 0:n.value)==null?void 0:de.prefix)||"")+m).length>z)return R(new Error(`Table name exceeds ${z} characters`));D()})},{validator:(q,m)=>new Promise((D,R)=>{if(!((L==null?void 0:L.value)||[]).every(z=>z.id===c.tableMeta.id||z.title.toLowerCase()!==((m==null?void 0:m.trim())||"").toLowerCase()))return R(new Error("Duplicate table alias"));D()})}]})),{validateInfos:H}=A(M,W);wa(()=>{var q;(q=c.tableMeta)!=null&&q.title&&(M.title=`${c.tableMeta.title}`),ut(()=>{var D;const m=(D=h.value)==null?void 0:D.$el;m&&(m.setSelectionRange(0,M.title.length),m.focus())})},{flush:"post"});const Y=async(q=!1,m)=>{if(c.tableMeta&&(M.title&&(M.title=M.title.trim()),!(M.title===c.tableMeta.title&&!m))){p.value=!0;try{await _.dbTable.update(c.tableMeta.id,{base_id:c.tableMeta.base_id,table_name:M.title,title:M.title}),B.value=!1,await k(c.tableMeta.base_id,!0),q||i({redo:{fn:R=>{M.title=R,Y(!0,!0)},args:[M.title]},undo:{fn:R=>{M.title=R,Y(!0,!0)},args:[c.tableMeta.title]},scope:u({model:c.tableMeta})}),await T(),O.value=O.value.map(R=>(R.tableID===c.tableMeta.id&&(R.isDefault&&(R.viewName=M.title),R.tableName=M.title),R));const D=await _.dbTable.read(c.tableMeta.id);await N(D),j({id:c.tableMeta.id},{title:D.title}),x(),l("a:table:rename"),B.value=!1}catch(D){ue.error(await Pe(D))}p.value=!1}};return(q,m)=>{const D=We,R=Ia,z=Ta,ne=Ft,de=Ue,ye=ca;return t(),f(ye,{visible:e(B),"onUpdate:visible":m[4]||(m[4]=G=>le(B)?B.value=G:null),size:"small","show-separator":!1},{header:o(()=>[v("div",cn,[a(D,{icon:"rename"}),K(" "+y(q.$t("activity.renameTable")),1)])]),default:o(()=>{var G;return[v("div",dn,[a(ne,{model:e(M),name:"create-new-table-form"},{default:o(()=>[a(z,Ss(Vs(e(H).title)),{default:o(()=>[a(R,{ref_key:"inputEl",ref:h,value:e(M).title,"onUpdate:value":m[0]||(m[0]=Q=>e(M).title=Q),class:"nc-input-sm nc-input-shadow","hide-details":"",size:"small",placeholder:q.$t("msg.info.enterTableName"),onKeydown:m[1]||(m[1]=dt(()=>Y(),["enter"]))},null,8,["value","placeholder"])]),_:1},16)]),_:1},8,["model"]),v("div",un,[a(de,{type:"secondary",size:"small",onClick:m[2]||(m[2]=Q=>B.value=!1)},{default:o(()=>[K(y(q.$t("general.cancel")),1)]),_:1}),a(de,{key:"submit",type:"primary",size:"small",disabled:e(H).title.validateStatus==="error"||((G=e(M).title)==null?void 0:G.trim())===q.tableMeta.title,label:"Rename Table","loading-label":"Renaming Table",loading:e(p),onClick:m[3]||(m[3]=()=>Y())},{loading:o(()=>[K(y(q.$t("title.renamingTable")),1)]),default:o(()=>[K(y(q.$t("title.renameTable"))+" ",1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),mn={class:"mt-5"},vn={class:"prose-md self-center text-gray-500 mt-4"},fn={class:"text-xs p-2"},bn={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},_n=pe({__name:"TableDuplicate",props:{modelValue:{type:Boolean},table:{}},emits:["update:modelValue"],setup(c,{emit:P}){const d=c,r=P,{api:l}=Kt(),_=Ye(d,"modelValue",r),{addTab:N}=Mt(),{$e:B,$poller:j}=Ne();at();const{openTable:k}=Ie(),s=Ge(),{loadTables:T}=s,{tables:C}=te(s),{getMeta:g}=kt(),{t:w}=aa();te(Ie());const{refreshCommandPalette:L}=st(),n=I({includeData:!0,includeViews:!0,includeHooks:!0}),O=ae(()=>{const{includeData:h,includeViews:p,includeHooks:A}=n.value;return{excludeData:!h,excludeViews:!p,excludeHooks:!A}}),x=I(!1),i=async()=>{try{x.value=!0;const h=await l.dbTable.duplicate(d.table.base_id,d.table.id,{options:O.value});j.subscribe({id:h.id},async p=>{var A;if(p.status!=="close")if(p.status===Vt.COMPLETED){const M=await g(d.table.id);if(M){for(const H of M.columns||[])if([fa.Links,fa.LinkToAnotherRecord].includes(H.uidt)&&H&&H.colOptions){const Y=(A=H.colOptions)==null?void 0:A.fk_related_model_id;Y&&await g(Y,!0)}}await T(),L();const W=C.value.find(H=>{var Y,q;return H.id===((q=(Y=p==null?void 0:p.data)==null?void 0:Y.result)==null?void 0:q.id)});W&&N({title:W.title,id:W.id,type:W.type}),k(W),x.value=!1,_.value=!1}else p.status===Vt.FAILED&&(ue.error(w("msg.error.failedToDuplicateTable")),await T(),x.value=!1,_.value=!1)}),B("a:table:duplicate")}catch(h){ue.error(await Pe(h)),x.value=!1,_.value=!1}};oa("Enter",()=>{_.value&&i()});const u=I(!1);return(h,p)=>{const A=Ca,M=Da,W=Ue,H=Pt,Y=Fe("e");return t(),f(H,{visible:e(_),"onUpdate:visible":p[5]||(p[5]=q=>le(_)?_.value=q:null),class:ee([{active:e(_)},"!w-[30rem]"]),"mask-closable":!e(x),keyboard:!e(x),centered:"","wrap-class-name":"nc-modal-table-duplicate",footer:null,onKeydown:p[6]||(p[6]=dt(q=>_.value=!1,["esc"]))},{default:o(()=>[v("div",null,[v("div",{class:"font-medium text-lg text-gray-800 self-center",onDblclick:p[0]||(p[0]=q=>u.value=!e(u))},y(h.$t("general.duplicate"))+" "+y(h.$t("objects.table")),33),v("div",mn,y(h.$t("msg.warning.duplicateTable")),1),v("div",vn,y(h.$t("title.advancedSettings")),1),a(A,{class:"!m-0 !p-0 !my-2"}),v("div",fn,[a(M,{checked:e(n).includeData,"onUpdate:checked":p[1]||(p[1]=q=>e(n).includeData=q),disabled:e(x)},{default:o(()=>[K(y(h.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"]),a(M,{checked:e(n).includeViews,"onUpdate:checked":p[2]||(p[2]=q=>e(n).includeViews=q),disabled:e(x)},{default:o(()=>[K(y(h.$t("labels.includeView")),1)]),_:1},8,["checked","disabled"]),Z(a(M,{checked:e(n).includeHooks,"onUpdate:checked":p[3]||(p[3]=q=>e(n).includeHooks=q),disabled:e(x)},{default:o(()=>[K(y(h.$t("labels.includeWebhook")),1)]),_:1},8,["checked","disabled"]),[[is,e(u)]])])]),v("div",bn,[e(x)?E("",!0):(t(),f(W,{key:"back",type:"secondary",size:"small",onClick:p[4]||(p[4]=q=>_.value=!1)},{default:o(()=>[K(y(h.$t("general.cancel")),1)]),_:1})),Z((t(),f(W,{key:"submit",type:"primary",size:"small",loading:e(x),onClick:i},{default:o(()=>[K(y(h.$t("general.confirm")),1)]),_:1},8,["loading"])),[[Y,["a:table:duplicate"]]])])]),_:1},8,["visible","class","mask-closable","keyboard"])}}}),yn={class:"h-[80vh]"},gn=pe({__name:"ProjectErd",props:{baseId:{},sourceId:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(c,{emit:P}){const d=c,l=Ye(d,"modelValue",P),_=ae(()=>d.sourceId),{openedProject:N}=te(at()),{baseTables:B}=te(Ie()),{loadProjectTables:j}=Ie(),k=I(!0),{getMeta:s}=kt(),T=ae(()=>{var C;return d.baseId||((C=N.value)==null?void 0:C.id)});return jt(async()=>{if(T.value&&B.value.get(T.value))return k.value=!1;try{await j(T.value),await Promise.all(B.value.get(T.value).map(async C=>{await s(C.id,!1,!1,T.value)}))}catch(C){console.error(C)}finally{k.value=!1}}),(C,g)=>{const w=vo,L=Pt;return t(),f(L,{visible:e(l),"onUpdate:visible":g[0]||(g[0]=n=>le(l)?l.value=n:null),size:"large"},{default:o(()=>[v("div",yn,[e(k)?E("",!0):(t(),f(w,{key:0,"source-id":e(_),"base-id":e(T),"show-all-columns":!1},null,8,["source-id","base-id"]))])]),_:1},8,["visible"])}}}),wn={class:"p-6 h-full"},xn=pe({__name:"ProjectAudit",props:{workspaceId:{},baseId:{},sourceId:{},modelValue:{type:Boolean},bordered:{type:Boolean}},emits:["update:modelValue"],setup(c,{emit:P}){const d=c,l=Ye(d,"modelValue",P),{workspaceId:_,sourceId:N,bordered:B}=js(d),{openedProject:j}=te(at()),{baseTables:k}=te(Ie()),{loadProjectTables:s}=Ie(),T=I(!0),{getMeta:C}=kt(),g=ae(()=>{var w;return d.baseId||((w=j.value)==null?void 0:w.id)});return jt(async()=>{if(g.value&&k.value.get(g.value))return T.value=!1;try{await s(g.value),await Promise.all(k.value.get(g.value).map(async w=>{await C(w.id,!1,!1,g.value)}))}catch(w){ue.error("Failed to load tables/bases. Please try again later."),console.error(w)}finally{T.value=!1}}),(w,L)=>{const n=fo,O=Pt;return t(),f(O,{visible:e(l),"onUpdate:visible":L[0]||(L[0]=x=>le(l)?l.value=x:null),size:"xl",class:"!top-[5vh] lg:!max-w-[calc(100vw_-_64px)]",width:"96.95rem"},{default:o(()=>[v("div",wn,[e(T)?E("",!0):(t(),f(n,{key:0,"workspace-id":e(_),"source-id":e(N),"base-id":e(g),bordered:e(B)},null,8,["workspace-id","source-id","base-id","bordered"]))])]),_:1},8,["visible"])}}}),kn={class:"flex gap-2 items-center"},hn={class:"ml-0.5"},$n={class:"flex gap-2 items-center"},In={class:"flex gap-2 items-center"},Tn={class:"flex gap-2 items-center"},Dn=pe({__name:"BaseOptions",props:{source:{},base:{}},setup(c){const P=c,d=tt(P,"source"),r=tt(P,"base"),{isUIAllowed:l}=ze(),_=ae(()=>r.value.project_role||r.value.workspace_role),{$e:N}=Ne();function B(k,s){if(!k||!s)return;N("a:actions:import-airtable");const T=I(!0),{close:C}=Be(_o,{modelValue:T,baseId:k,sourceId:s,"onUpdate:modelValue":g});function g(){T.value=!1,C(1e3)}}function j(k){var g;if(!((g=d.value)!=null&&g.id)||!d.value.base_id)return;N(`a:actions:import-${k}`);const s=I(!0),{close:T}=Be(yo,{modelValue:s,importType:k,baseId:d.value.base_id,sourceId:d.value.id,"onUpdate:modelValue":C});function C(){s.value=!1,T(1e3)}}return(k,s)=>{const T=We,C=qt,g=go,w=Fe("e");return t(),f(g,{class:"py-0","data-testid":"nc-sidebar-base-import"},{title:o(()=>[a(T,{icon:"download"}),K(" "+y(k.$t("labels.importData")),1)]),expandIcon:o(()=>[]),default:o(()=>[e(l)("airtableImport",{roles:e(_),source:e(d)})?(t(),f(C,{key:"quick-import-airtable",onClick:s[0]||(s[0]=L=>B(e(d).base_id,e(d).id))},{default:o(()=>[Z((t(),V("div",kn,[a(T,{icon:"airtable",class:"max-w-3.75 group-hover:text-black"}),v("div",hn,y(k.$t("labels.airtable")),1)])),[[w,["c:import:airtable"]]])]),_:1})):E("",!0),e(l)("csvImport",{roles:e(_),source:e(d)})?(t(),f(C,{key:"quick-import-csv",onClick:s[1]||(s[1]=L=>j("csv"))},{default:o(()=>[Z((t(),V("div",$n,[a(T,{icon:"csv",class:"w-4 group-hover:text-black"}),K(" "+y(k.$t("labels.csvFile")),1)])),[[w,["c:import:csv"]]])]),_:1})):E("",!0),e(l)("jsonImport",{roles:e(_),source:e(d)})?(t(),f(C,{key:"quick-import-json",onClick:s[2]||(s[2]=L=>j("json"))},{default:o(()=>[Z((t(),V("div",In,[a(T,{icon:"code",class:"w-4 group-hover:text-black"}),K(" "+y(k.$t("labels.jsonFile")),1)])),[[w,["c:import:json"]]])]),_:1})):E("",!0),e(l)("excelImport",{roles:e(_),source:e(d)})?(t(),f(C,{key:"quick-import-excel",onClick:s[3]||(s[3]=L=>j("excel"))},{default:o(()=>[Z((t(),V("div",Tn,[a(T,{icon:"excel",class:"max-w-4 group-hover:text-black"}),K(" "+y(k.$t("labels.microsoftExcel")),1)])),[[w,["c:import:excel"]]])]),_:1})):E("",!0)]),_:1})}}}),Cn={key:0,class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700"},Sn={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},ys=pe({__name:"TableDelete",props:{visible:{type:Boolean},tableId:{},baseId:{}},emits:["update:visible"],setup(c,{emit:P}){const d=c,l=Ye(d,"visible",P),{$e:_,$api:N}=Ne(),{closeTab:B}=Mt(),{getMeta:j,removeMeta:k}=kt(),{loadTables:s,baseUrl:T,isXcdbBase:C}=Ge(),{refreshCommandPalette:g}=st(),{removeFromRecentViews:w}=qe(),{baseTables:L,activeTable:n}=te(Ie()),{openTable:O}=Ie(),x=ae(()=>L.value.get(d.baseId)??[]),i=ae(()=>x.value.find(p=>p.id===d.tableId)),u=I(!1),h=async()=>{var M,W;if(!i.value)return;const p=JSON.parse(JSON.stringify(i.value)),A=(M=n.value)==null?void 0:M.id;u.value=!0;try{const H=await j(p.id,!0),Y=(W=H==null?void 0:H.columns)==null?void 0:W.filter(m=>m.uidt===fa.LinkToAnotherRecord&&!Ms(m));if(Y!=null&&Y.length&&!C(p.source_id)){const m=await Promise.all(Y.map(async(D,R)=>{var ne;const z=await j((ne=D==null?void 0:D.colOptions)==null?void 0:ne.fk_related_model_id);return`${R+1}. ${D.title} is a LinkToAnotherRecord of ${z&&z.title||D.title}`}));ue.info(Me("div",{innerHTML:`<div style="padding:10px 4px">Unable to delete tables because of the following.
              <br><br>${m.join("<br>")}<br><br>
              Delete them & try again</div>`}));return}if(await N.dbTable.delete(p.id),await B({type:Ps.TABLE,id:p.id,title:p.title}),await s(),w({baseId:d.baseId,tableId:p.id}),k(p.id),g(),_("a:table:delete"),A===p.id){const m=x.value.filter(D=>D.source_id===p.source_id);m.length===0?await Gt(T({id:d.baseId,type:"database"})):await O(m[0])}const q=x.value.findIndex(m=>m.id===p.id);q>-1&&x.value.splice(q,1),l.value=!1}catch(H){ue.error(await Pe(H))}finally{u.value=!1}};return(p,A)=>{const M=wo,W=bs;return t(),f(W,{visible:e(l),"onUpdate:visible":A[0]||(A[0]=H=>le(l)?l.value=H:null),"entity-name":p.$t("objects.table"),"on-delete":h},{"entity-preview":o(()=>[e(i)?(t(),V("div",Cn,[a(M,{meta:e(i),class:"nc-view-icon"},null,8,["meta"]),v("div",Sn,y(e(i).title),1)])):E("",!0)]),_:1},8,["visible","entity-name"])}}}),ua=c=>(na("data-v-85eddd0a"),c=c(),la(),c),Vn={class:"item","data-testid":"sidebar-view-create-grid"},jn={class:"item-inner"},Mn=ua(()=>v("div",null,"Grid",-1)),Pn={class:"item","data-testid":"sidebar-view-create-form"},En={class:"item-inner"},Nn=ua(()=>v("div",null,"Form",-1)),Bn={class:"item","data-testid":"sidebar-view-create-gallery"},Ln={class:"item-inner"},On=ua(()=>v("div",null,"Gallery",-1)),Un={class:"item"},Rn={class:"item-inner"},An=ua(()=>v("div",null,"Kanban",-1)),zn={class:"item"},Gn={class:"item-inner"},Fn=pe({__name:"CreateViewBtn",props:{alignLeftLevel:{},source:{}},setup(c){const P=c,{$e:d}=Ne(),r=tt(P,"alignLeftLevel"),{refreshCommandPalette:l}=st(),_=qe(),{loadViews:N,navigateToView:B}=_,j=Ae(xa),k=Ae(Ht),s=I(!1),T=I(),C=I(!1),g=ae(()=>r.value===1?"nc-view-create-dropdown nc-view-create-dropdown-left-1":r.value===2?"nc-view-create-dropdown nc-view-create-dropdown-left-2":"nc-view-create-dropdown");async function w({title:L="",type:n,copyViewId:O,groupingFieldColumnId:x,calendarRange:i,coverImageColumnId:u}){if(s.value)return;T.value=n,s.value=!0,await N({tableId:j.value.id}),C.value=!1,s.value=!1;const h=I(!0),{close:p}=Be(Va,{modelValue:h,title:L,type:n,tableId:j.value.id,selectedViewId:O,calendarRange:i,groupingFieldColumnId:x,coverImageColumnId:u,"onUpdate:modelValue":A,onCreated:async M=>{A(),l(),await N({tableId:j.value.id,force:!0}),j.value.meta={...j.value.meta,hasNonDefaultViews:!0},B({view:M,tableId:j.value.id,baseId:k.value.id,doNotSwitchTab:!0}),d("a:view:create",{view:M.type})}});function A(){C.value=!1,h.value=!1,p(1e3)}}return(L,n)=>{const O=rs,x=ka,i=We,u=qt,h=da,p=Jt;return t(),f(p,{visible:e(C),"onUpdate:visible":n[5]||(n[5]=A=>le(C)?C.value=A:null),"overlay-class-name":e(g),"destroy-popup-on-hide":"",onClick:n[6]||(n[6]=ve(A=>C.value=!0,["stop"]))},{overlay:o(()=>[a(h,{class:"max-w-48"},{default:o(()=>[a(u,{onClick:n[0]||(n[0]=ve(A=>w({type:e(ke).GRID}),["stop"]))},{default:o(()=>[v("div",Vn,[v("div",jn,[a(O,{meta:{type:e(ke).GRID}},null,8,["meta"]),Mn]),e(T)===e(ke).GRID&&e(s)?(t(),f(x,{key:0})):(t(),f(i,{key:1,class:"plus",icon:"plus"}))])]),_:1}),L.source.is_schema_readonly?E("",!0):(t(),f(u,{key:0,onClick:n[1]||(n[1]=A=>w({type:e(ke).FORM}))},{default:o(()=>[v("div",Pn,[v("div",En,[a(O,{meta:{type:e(ke).FORM}},null,8,["meta"]),Nn]),e(T)===e(ke).FORM&&e(s)?(t(),f(x,{key:0})):(t(),f(i,{key:1,class:"plus",icon:"plus"}))])]),_:1})),a(u,{onClick:n[2]||(n[2]=A=>w({type:e(ke).GALLERY}))},{default:o(()=>[v("div",Bn,[v("div",Ln,[a(O,{meta:{type:e(ke).GALLERY}},null,8,["meta"]),On]),e(T)===e(ke).GALLERY&&e(s)?(t(),f(x,{key:0})):(t(),f(i,{key:1,class:"plus",icon:"plus"}))])]),_:1}),a(u,{"data-testid":"sidebar-view-create-kanban",onClick:n[3]||(n[3]=A=>w({type:e(ke).KANBAN}))},{default:o(()=>[v("div",Un,[v("div",Rn,[a(O,{meta:{type:e(ke).KANBAN}},null,8,["meta"]),An]),e(T)===e(ke).KANBAN&&e(s)?(t(),f(x,{key:0})):(t(),f(i,{key:1,class:"plus",icon:"plus"}))])]),_:1}),a(u,{"data-testid":"sidebar-view-create-calendar",onClick:n[4]||(n[4]=A=>w({type:e(ke).CALENDAR}))},{default:o(()=>[v("div",zn,[v("div",Gn,[a(O,{meta:{type:e(ke).CALENDAR},class:"!w-4 !h-4"},null,8,["meta"]),v("div",null,y(L.$t("objects.viewType.calendar")),1)]),e(T)===e(ke).CALENDAR&&e(s)?(t(),f(x,{key:0})):(t(),f(i,{key:1,class:"plus",icon:"plus"}))])]),_:1})]),_:1})]),default:o(()=>[_a(L.$slots,"default",{},void 0,!0)]),_:3},8,["visible","overlay-class-name"])}}}),Wn=Oe(Fn,[["__scopeId","data-v-85eddd0a"]]),gs=c=>c.is_meta,Kn=ht(()=>$t(()=>import("./qAM_WqEm.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(c=>c.default||c)),Hn={class:"text-sm flex items-center w-full gap-1","data-testid":"view-item"},qn=["data-testid"],Jn=pe({__name:"ViewsNode",props:{view:{},table:{},onValidate:{type:Function}},emits:["update:view","selectIcon","changeView","rename","delete","openModal"],setup(c,{emit:P}){const d=c,r=P,l=Ye(d,"view",r),{$e:_}=Ne(),{isMobileMode:N}=De(),{isUIAllowed:B}=ze(),j=Ae(Ht,I()),{activeView:k}=te(qe()),{getMeta:s}=kt(),{meta:T,control:C}=sa(),g=ae(()=>d.table),w=I(g.value);xt(Es,l),xt(Ns,w);const L=Ae(Bs,I(!1)),n=ae(()=>{var Q,Le,Qe,he;if(((Le=(Q=j.value)==null?void 0:Q.sources)==null?void 0:Le.length)===1)return!0;const G=(he=(Qe=j.value)==null?void 0:Qe.sources)==null?void 0:he.find(S=>S.id===l.value.source_id);return G?gs(G):!1}),{openViewDescriptionDialog:O}=Ae(ia),x=I(),i=I(!1),u=I(!1),h=I(!1),p=I(),A=Os(()=>{r("changeView",l.value)},250),M=()=>{if(u.value||h.value)return;(St()?T.value:C.value)?r("changeView",l.value):A()},W=()=>{setTimeout(()=>{var G,Q;(G=x.value)==null||G.focus(),(Q=x.value)==null||Q.select()})};function H(){var G;N.value||B("viewCreateOrEdit")&&(u.value||(u.value=!0,p.value=l.value.title,_("c:view:rename",{view:(G=l.value)==null?void 0:G.type}),ut(()=>{W()})))}function Y(G){G.key==="Escape"?m(G):G.key==="Enter"&&q(G)}function q(G){G.stopImmediatePropagation(),G.preventDefault(),R()}function m(G){G.stopImmediatePropagation(),G.preventDefault(),ne()}oa("Enter",G=>{u.value&&q(G)});const D=()=>{var G;N.value||!B("viewCreateOrEdit")||u.value||(u.value=!0,p.value=l.value.title,_("c:view:rename",{view:(G=l.value)==null?void 0:G.type}),ut(()=>{W()}))};async function R(){if(i.value=!1,!u.value)return;p.value&&(p.value=p.value.trim());const G=d.onValidate({...l.value,title:p.value});if(G!==!0){ue.error(G),ne();return}if(l.value.title===""||l.value.title===p.value){ne();return}const Q=l.value.title;l.value.title=p.value||"",r("rename",l.value,Q),de()}const z=G=>{i.value=!1,O(G)};function ne(){u.value&&de()}function de(){h.value=!0,u.value=!1,p.value="",setTimeout(()=>{h.value=!1},250)}const ye=()=>{i.value=!1,r("delete",l.value)};return Je(i,async()=>{i.value&&(w.value=await s(g.value.id))}),(G,Q)=>{const Le=rs,Qe=Kn,he=Ia,S=Wt,X=We,se=Ue,oe=co,we=Jt,ge=Ls,re=Fe("e");return t(),f(ge,{class:ee(["nc-sidebar-node !min-h-7 !max-h-7 !my-0.5 select-none group text-gray-700 !flex !items-center !hover:bg-gray-200 !hover:text-gray-700 cursor-pointer",{"!pl-13.5 !xs:pl-12":e(n),"!pl-19 ":!e(n)}]),"data-testid":`view-sidebar-view-${e(l).alias||e(l).title}`,onDblclick:ve(H,["stop"]),onClick:ve(M,["prevent"])},{default:o(()=>{var be,xe,Te,fe;return[Z((t(),V("div",Hn,[Z((t(),V("div",{class:"flex min-w-6","data-testid":`view-sidebar-drag-handle-${e(l).alias||e(l).title}`},[a(Qe,{class:"nc-table-icon",emoji:(xe=(be=d.view)==null?void 0:be.meta)==null?void 0:xe.icon,size:"small",clearable:!0,readonly:e(N)||!e(B)("viewCreateOrEdit"),onEmojiSelected:Q[0]||(Q[0]=U=>r("selectIcon",U))},{default:o(()=>[a(Le,{meta:d.view,class:"nc-view-icon w-4 !text-[16px]"},null,8,["meta"])]),_:1},8,["emoji","readonly"])],8,qn)),[[re,["c:view:emoji-picker"]]]),e(u)?(t(),f(he,{key:0,ref_key:"input",ref:x,value:e(p),"onUpdate:value":Q[1]||(Q[1]=U=>le(p)?p.value=U:null),class:ee(["!bg-transparent !border-0 !ring-0 !outline-transparent !border-transparent !pl-0 !flex-1 mr-4",{"font-medium !text-brand-600":((Te=e(k))==null?void 0:Te.id)===e(l).id}]),onBlur:R,onKeydown:Q[2]||(Q[2]=ve(U=>Y(U),["stop"]))},null,8,["value","class"])):(t(),f(S,{key:1,class:"nc-sidebar-node-title text-ellipsis overflow-hidden select-none w-full","show-on-truncate-only":""},{title:o(()=>[K(y(e(l).alias||e(l).title),1)]),default:o(()=>{var U;return[v("div",{"data-testid":"sidebar-view-title",class:ee({"font-medium text-brand-600":((U=e(k))==null?void 0:U.id)===e(l).id}),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},y(e(l).alias||e(l).title),3)]}),_:1})),!e(u)&&!e(L)?(t(),V(_e,{key:2},[(fe=e(l).description)!=null&&fe.length?(t(),f(S,{key:0,placement:"bottom"},{title:o(()=>[K(y(e(l).description),1)]),default:o(()=>[a(se,{type:"text",class:"!hover:bg-transparent",size:"xsmall"},{default:o(()=>[a(X,{icon:"info",class:"!w-3.5 !h-3.5 nc-info-icon group-hover:opacity-100 text-gray-600 opacity-0"})]),_:1})]),_:1})):E("",!0),a(we,{visible:e(i),"onUpdate:visible":Q[7]||(Q[7]=U=>le(i)?i.value=U:null),"overlay-class-name":"!rounded-lg"},{overlay:o(()=>[a(oe,{"data-testid":`view-sidebar-view-actions-${e(l).alias||e(l).title}`,view:e(l),table:e(g),"in-sidebar":"",onCloseModal:Q[5]||(Q[5]=U=>i.value=!1),onRename:D,onDelete:ye,onDescriptionUpdate:Q[6]||(Q[6]=U=>z(e(l)))},null,8,["data-testid","view","table"])]),default:o(()=>[Z((t(),f(se,{type:"text",size:"xxsmall",class:ee(["nc-sidebar-node-btn invisible !group-hover:visible !group-hover:opacity-100 nc-sidebar-view-node-context-btn",{"!visible !opacity-100":e(i)}]),onClick:Q[3]||(Q[3]=ve(U=>i.value=!e(i),["stop"])),onDblclick:Q[4]||(Q[4]=ve(()=>{},["stop"]))},{default:o(()=>[a(X,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:1},8,["class"])),[[re,["c:view:option"]]])]),_:1},8,["visible"])],64)):E("",!0)])),[[re,["a:view:open",{view:e(l).type}]]])]}),_:1},8,["class","data-testid"])}}}),Yn={class:"flex flex-row items-center pl-1.25 !py-1.5 text-inherit"},Qn={class:"pl-1.75"},Zn=pe({__name:"ViewsList",emits:["openModal","deleted"],setup(c,{emit:P}){const d=P,r=Ae(Ht),l=Ae(xa),{isLeftSidebarOpen:_}=te(ra()),{activeTableId:N}=te(Ie()),{isUIAllowed:B}=ze(),{isMobileMode:j}=De(),{isSharedBase:k}=te(Ge()),{$e:s}=Ne(),{t:T}=aa(),{viewsByTable:C,activeView:g,allRecentViews:w}=te(qe()),{navigateToTable:L}=Ie(),n=ae(()=>{var S;return((S=C.value.get(l.value.id))==null?void 0:S.filter(X=>!X.is_default))??[]}),{api:O}=Kt(),{refreshCommandPalette:x}=st(),{addUndo:i,defineModelScope:u}=ya(),{navigateToView:h,loadViews:p,removeFromRecentViews:A}=qe(),M=I([]),W=I(!1),H=I(),Y=I(!1);Je(g,S=>{S&&S.id&&(M.value=[S.id])});function q(S){Y.value=S,setTimeout(()=>{Y.value=!1},300)}const m=ae(()=>{var S,X;return(X=(S=r.value)==null?void 0:S.sources)==null?void 0:X.find(se=>se.id===l.value.source_id)}),D=ae(()=>{var S,X;return((X=(S=r.value)==null?void 0:S.sources)==null?void 0:X.length)===1?!0:m.value?gs(m.value):!1});function R(S){return!S.title||S.title.trim().length<0?T("msg.error.viewNameRequired"):n.value.some(X=>X.title===S.title&&X.id!==S.id)?T("msg.error.viewNameDuplicate"):!0}let z;function ne(S){S.stopImmediatePropagation(),S.preventDefault(),W.value=!0}async function de(S,X=!1){if(X||(S.stopImmediatePropagation(),S.preventDefault(),W.value=!1),n.value.length<2)return;let{newIndex:se=0,oldIndex:oe=0}=S;if(se=se-1,oe=oe-1,se===oe)return;X||i({redo:{fn:async()=>{const F=z.toArray(),Ce=F.splice(oe,1);F.splice(se,0,Ce[0]),z.sort(F),await de(S,!0)},args:[]},undo:{fn:async()=>{const F=z.toArray(),Ce=F.splice(se,1);F.splice(oe,0,Ce[0]),z.sort(F),await de({...S,oldIndex:se,newIndex:oe},!0)},args:[]},scope:u({view:g.value})});const we=Array.from(S.to.children);we.shift();const ge=we[se-1],re=we[se+1],be=n.value.find(F=>F.id===S.item.id);if(!be||!be.id)return;const xe=ge?n.value.find(F=>F.id===ge.id)??{order:0}:{order:0},Te=re?n.value.find(F=>F.id===re.id):{};let fe;n.value.length-1===se?fe=parseFloat(String(xe.order))+1:se===0?fe=parseFloat(String(Te.order))/2:fe=(parseFloat(String(xe.order))+parseFloat(String(Te.order)))/2;const U=isNaN(Number(fe))?oe:fe;be.order=U,await O.dbView.update(be.id,{order:U}),q(be.id),s("a:view:reorder")}const ye=S=>{z&&z.destroy(),!j.value&&(z=new fs(S,{ghostClass:"ghost",onStart:ne,onEnd:de}))};jt(()=>H.value&&B("viewCreateOrEdit")&&ye(H.value.$el));async function G(S){await h({view:S,tableId:l.value.id,baseId:r.value.id,hardReload:S.type===ke.FORM&&M.value[0]===S.id,doNotSwitchTab:!0}),j.value&&(_.value=!1)}async function Q(S,X,se=!1){try{await O.dbView.update(S.id,{title:S.title,order:S.order}),h({view:S,tableId:l.value.id,baseId:r.value.id,hardReload:S.type===ke.FORM&&M.value[0]===S.id}),x(),se||i({redo:{fn:(oe,we)=>{const ge=oe.title;oe.title=we,Q(oe,ge,!0)},args:[S,S.title]},undo:{fn:(oe,we)=>{const ge=oe.title;oe.title=we,Q(oe,ge,!0)},args:[S,X]},scope:u({view:g.value})}),w.value=w.value.map(oe=>(oe.viewId===S.id&&oe.tableID===S.fk_model_id&&(oe.viewName=S.title),oe))}catch(oe){ue.error(await Pe(oe))}}function Le(S){const X=I(!0),{close:se}=Be(uo,{modelValue:X,view:S,"onUpdate:modelValue":oe,onDeleted:async()=>{var ge,re;oe(),d("deleted"),A({viewId:S.id,tableId:S.fk_model_id,baseId:r.value.id}),x(),((ge=g.value)==null?void 0:ge.id)===S.id&&L({tableId:l.value.id,baseId:r.value.id}),await p({tableId:l.value.id,force:!0});const we=((re=C.value.get(l.value.id))==null?void 0:re.filter(be=>!be.is_default))??[];l.value.meta={...l.value.meta,hasNonDefaultViews:we.length>1}}});function oe(){X.value=!1,se(1e3)}}const Qe=async(S,X)=>{try{X.meta={...Dt(X.meta),icon:S},O.dbView.update(X.id,{meta:X.meta}),s("a:view:icon:sidebar",{icon:S})}catch(se){ue.error(await Pe(se))}};function he({title:S="",type:X,copyViewId:se,groupingFieldColumnId:oe,calendarRange:we,coverImageColumnId:ge}){const re=I(!0),{close:be}=Be(Va,{modelValue:re,title:S,type:X,tableId:l.value.id,selectedViewId:se,groupingFieldColumnId:oe,views:n,calendarRange:we,coverImageColumnId:ge,"onUpdate:modelValue":xe,onCreated:async Te=>{xe(),x(),await p({force:!0,tableId:l.value.id}),h({view:Te,tableId:l.value.id,baseId:r.value.id,hardReload:Te.type===ke.FORM&&M.value[0]===Te.id}),s("a:view:create",{view:Te.type})}});function xe(){re.value=!1,be(1e3)}}return(S,X)=>{const se=We,oe=Wn,we=Jn,ge=Rs;return t(),f(ge,{ref_key:"menuRef",ref:H,class:ee([{dragging:e(W)},"nc-views-menu flex flex-col w-full !border-r-0 !bg-inherit"]),"selected-keys":e(M)},{default:o(()=>[e(k)?E("",!0):(t(),V(_e,{key:0},[e(B)("viewCreateOrEdit")?(t(),f(oe,{key:0,"align-left-level":e(D)?1:2,class:ee({"!pl-13.3 !xs:pl-13.5":e(D),"!pl-18.6 !xs:pl-20":!e(D)}),source:e(m)},{default:o(()=>[v("div",{class:ee([{"text-brand-500 hover:text-brand-600":e(N)===e(l).id,"text-gray-500 hover:text-brand-500":e(N)!==e(l).id},"nc-create-view-btn flex flex-row items-center cursor-pointer rounded-md w-full"]),role:"button"},[v("div",Yn,[a(se,{icon:"plus"}),v("div",Qn,y(S.$t("general.createEntity",{entity:S.$t("objects.view")})),1)])],2)]),_:1},8,["align-left-level","class","source"])):E("",!0)],64)),e(n).length?(t(!0),V(_e,{key:1},ha(e(n),re=>{var be;return t(),f(we,{id:re.id,key:re.id,class:ee([{"bg-gray-200":e(Y)===re.id,active:((be=e(g))==null?void 0:be.id)===re.id,[`nc-${re.type?("viewTypeAlias"in S?S.viewTypeAlias:e(Us))[re.type]:re.type}-view-item`]:!0},"nc-view-item !rounded-md !px-0.75 !py-0.5 w-full transition-all ease-in duration-100"]),"data-view-id":re.id,"on-validate":R,table:e(l),view:re,onDelete:Le,onRename:Q,onChangeView:G,onOpenModal:he,onSelectIcon:xe=>Qe(xe,re)},null,8,["id","class","data-view-id","table","view","onSelectIcon"])}),128)):E("",!0)]),_:1},8,["class","selected-keys"])}}}),Xn={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},el=v("path",{fill:"currentColor",d:"M12 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5a5 5 0 0 1 5-5a5 5 0 0 1 5 5a5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"},null,-1),tl=[el];function al(c,P){return t(),V("svg",Xn,[...tl])}const sl={name:"mdi-eye",render:al},ol=ht(()=>$t(()=>import("./qAM_WqEm.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(c=>c.default||c)),nl=["data-order","data-id","data-table-id","data-active"],ll={class:"flex items-center py-0.5"},il=["data-testid"],rl={class:"flex flex-row h-full items-center"},cl=["data-testid"],dl=["data-testid"],ul={class:"flex items-center"},pl={class:"flex text-xs font-bold text-gray-500 ml-1"},ml={class:"flex gap-2 items-center"},vl={class:"flex gap-2 items-center"},fl={class:"flex gap-2 items-center"},bl={class:"flex gap-2 items-center"},_l={class:"flex gap-2 items-center"},yl=pe({__name:"TableNode",props:{base:{},table:{},sourceIndex:{default:0}},setup(c){const P=c,d=tt(P,"base"),r=tt(P,"table"),l=tt(P,"sourceIndex"),{openTable:_}=ns({baseId:d.value.id}),N=As(),{isUIAllowed:B}=ze(),{isMobileMode:j}=De(),k=Mt(),{updateTab:s}=k,{$e:T,$api:C}=Ne();ns({baseId:d.value.id});const{meta:g,control:w}=sa(),{copy:L}=cs(),n=Ae(ds);xt(xa,r);const{setMenuContext:O,openRenameTableDialog:x,openTableDescriptionDialog:i,duplicateTable:u}=Ae(ia),{loadViews:h,navigateToView:p}=qe(),{activeView:A,activeViewTitleOrId:M,viewsByTable:W}=te(qe()),{isLeftSidebarOpen:H}=te(ra()),{refreshCommandPalette:Y}=st(),{baseTables:q}=te(Ie()),m=ae(()=>q.value.get(d.value.id)??[]),D=ae(()=>N.params.viewId),R=I(!1),z=I(!1),ne=async(U,F)=>{try{F.meta={...F.meta||{},icon:U},m.value.splice(m.value.indexOf(F),1,{...F}),s({id:F.id},{meta:F.meta}),await C.dbTable.update(F.id,{meta:F.meta}),T("a:table:icon:navdraw",{icon:U})}catch(Ce){ue.error(await Pe(Ce))}},{isSharedBase:de}=Ge(),ye=ae(()=>B("tableIconEdit",{roles:n==null?void 0:n.value})),G=I(!1),Q=I(!1),Le=I(!1),Qe=async()=>{if(G.value){G.value=!1;return}Q.value=!0;try{await h({tableId:r.value.id,ignoreLoading:!0})}catch(U){ue.error(await Pe(U))}finally{Q.value=!1,G.value=!0}},he=async()=>{if(St()?g.value:w.value){await _(r.value,!0);return}Q.value=!0;try{await _(r.value),j.value&&(H.value=!1)}catch(U){ue.error(await Pe(U))}finally{Q.value=!1,G.value=!0}};let S;const X=async()=>{S&&clearTimeout(S);try{await L(r.value.id),Le.value=!0,S=setTimeout(()=>{Le.value=!1,clearTimeout(S)},5e3)}catch(U){ue.error(U.message)}};Je(()=>{var U;return(U=A.value)==null?void 0:U.id},()=>{var U,F;A.value&&((U=A.value)==null?void 0:U.fk_model_id)===((F=r.value)==null?void 0:F.id)&&(G.value=!0)},{immediate:!0});const se=ae(()=>{var U,F;return D.value===((U=r.value)==null?void 0:U.id)&&(((F=A.value)==null?void 0:F.is_default)||!M.value)});let oe;Je(D,()=>{var U;if(oe&&clearTimeout(oe),r.value.id!==D.value&&G.value){if((((U=W.value.get(r.value.id))==null?void 0:U.filter(Ce=>!Ce.is_default))??[]).length)return;oe=setTimeout(()=>{G.value&&(G.value=!1),clearTimeout(oe)},1e4)}});const we=U=>{z.value=!1,u(U)},ge=(U,F)=>{z.value=!1,x(U,!!F)},re=U=>{z.value=!1,i(U)},be=()=>{z.value=!1,R.value=!0};function xe(){z.value=!1;const U=W.value.get(r.value.id),F=(U==null?void 0:U.find(ot=>ot.is_default))||(U==null?void 0:U[0]),Ce=I(!0),{close:mt}=Be(Va,{modelValue:Ce,title:F.title,type:F.type,tableId:r.value.id,selectedViewId:F.id,groupingFieldColumnId:F.view.fk_grp_col_id,views:U,calendarRange:F.view.calendar_range,coverImageColumnId:F.view.fk_cover_image_col_id,"onUpdate:modelValue":Ze,onCreated:async ot=>{Ze(),Y(),await h({force:!0,tableId:r.value.id}),p({view:ot,tableId:r.value.id,baseId:d.value.id,hardReload:ot.type===ke.FORM}),T("a:view:create",{view:ot.type,sidebar:!0})}});function Ze(){Ce.value=!1,mt(1e3)}}const Te=async()=>{G.value=!1,await ut(),G.value=!0},fe=ae(()=>{var U,F;return(F=(U=d.value)==null?void 0:U.sources)==null?void 0:F[l.value]});return(U,F)=>{var Zt,Xt,Tt,_t,ea;const Ce=ka,mt=sl,Ze=Wt,ot=ol,Re=We,vt=Ue,ft=Gs,rt=qt,bt=Sa,Yt=da,Qt=Jt,It=ys,Et=Zn,Ke=Fe("e");return t(),V("div",{class:ee(["nc-tree-item nc-table-node-wrapper text-sm select-none w-full",[`nc-base-tree-tbl nc-base-tree-tbl-${(Zt=e(r).title)==null?void 0:Zt.replaceAll(" ","")}`]]),"data-order":e(r).order,"data-id":e(r).id,"data-table-id":e(r).id,"data-active":e(D)===e(r).id},[v("div",ll,[Z((t(),V("div",{class:ee(["flex-none flex-1 table-context flex items-center gap-1 h-full nc-tree-item-inner nc-sidebar-node pr-0.75 mb-0.25 rounded-md h-7 w-full group cursor-pointer hover:bg-gray-200",{"hover:bg-gray-200":e(D)!==e(r).id,"pl-13.5":e(l)!==0,"pl-7.5 xs:pl-6":e(l)===0,"!bg-primary-selected":e(se)}]),"data-testid":`nc-tbl-side-node-${e(r).title}`,onContextmenu:F[9]||(F[9]=Ee=>e(O)("table",e(r))),onClick:he},[v("div",rl,[v("div",{class:"flex w-auto","data-testid":`tree-view-table-draggable-handle-${e(r).title}`},[e(r).isViewsLoading?(t(),f(Ce,{key:0,class:"flex items-center w-6 h-full !text-gray-600"})):Z((t(),V("div",{key:1,class:ee(["flex items-center nc-table-icon",{"pointer-events-none":!e(ye)}]),onClick:F[1]||(F[1]=ve(()=>{},["stop"]))},[(t(),f(ot,{key:(Xt=e(r).meta)==null?void 0:Xt.icon,emoji:(Tt=e(r).meta)==null?void 0:Tt.icon,size:"small",readonly:!e(ye)||e(j),onEmojiSelected:F[0]||(F[0]=Ee=>ne(Ee,e(r)))},{default:o(()=>[a(Ze,{class:"flex",placement:"topLeft","hide-on-click":"",disabled:!e(ye)},{title:o(()=>[K(y(U.$t("general.changeIcon")),1)]),default:o(()=>[e(r).type==="table"?(t(),f(us(("iconMap"in U?U.iconMap:e(zs)).table),{key:0,class:ee(["w-4 text-sm",e(se)?"!text-brand-600/85":"!text-gray-600/75"])},null,8,["class"])):(t(),f(mt,{key:1,class:ee(["flex w-5 text-sm",e(se)?"!text-brand-600":"!text-gray-600"])},null,8,["class"]))]),_:1},8,["disabled"])]),_:1},8,["emoji","readonly"]))],2)),[[Ke,["c:table:emoji-picker"]]])],8,cl)]),a(Ze,{class:"nc-tbl-title nc-sidebar-node-title text-ellipsis overflow-hidden select-none !flex-1","show-on-truncate-only":""},{title:o(()=>[K(y(e(r).title),1)]),default:o(()=>[v("span",{class:ee(e(se)?"text-brand-600 !font-medium":"text-gray-600"),"data-testid":`nc-tbl-title-${e(r).title}`,style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},y(e(r).title),11,dl)]),_:1}),v("div",ul,[(_t=e(r).description)!=null&&_t.length?(t(),f(Ze,{key:0,placement:"bottom"},{title:o(()=>[K(y(e(r).description),1)]),default:o(()=>[a(vt,{type:"text",class:"!hover:bg-transparent",size:"xsmall"},{default:o(()=>[a(Re,{icon:"info",class:"!w-3.5 !h-3.5 nc-info-icon group-hover:opacity-100 text-gray-600 opacity-0"})]),_:1})]),_:1})):E("",!0),a(Qt,{visible:e(z),"onUpdate:visible":F[7]||(F[7]=Ee=>le(z)?z.value=Ee:null),trigger:["click"],onClick:F[8]||(F[8]=ve(()=>{},["stop"]))},{overlay:o(()=>[a(Yt,{class:"!min-w-62.5","data-testid":`sidebar-table-context-menu-list-${e(r).title}`},{default:o(()=>{var Ee;return[a(Ze,null,{title:o(()=>[K(y(U.$t("labels.clickToCopyTableID")),1)]),default:o(()=>{var ct;return[v("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:ve(X,["stop"])},[v("div",pl,y(U.$t("labels.tableIdColon",{tableId:(ct=e(r))==null?void 0:ct.id})),1),a(vt,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(Le)?(t(),f(Re,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(t(),f(Re,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),e(B)("tableDescriptionEdit",{roles:e(n),source:e(fe)})&&!e(B)("tableRename",{roles:e(n),source:e(fe)})?(t(),f(rt,{key:0,"data-testid":`sidebar-table-description-${e(r).title}`,class:"nc-table-description",onClick:F[3]||(F[3]=ct=>re(e(r)))},{default:o(()=>[Z((t(),V("div",ml,[a(Re,{icon:"ncAlignLeft",class:"text-gray-700"}),K(" "+y(U.$t("labels.editDescription")),1)])),[[Ke,["c:table:update-description"]]])]),_:1},8,["data-testid"])):E("",!0),!e(de)&&(e(B)("tableRename",{roles:e(n),source:e(fe)})||e(B)("tableDelete",{roles:e(n),source:e(fe)}))?(t(),V(_e,{key:1},[a(bt),e(B)("tableRename",{roles:e(n),source:e(fe)})?(t(),f(rt,{key:0,"data-testid":`sidebar-table-rename-${e(r).title}`,class:"nc-table-rename",onClick:F[4]||(F[4]=ct=>ge(e(r),e(fe).id))},{default:o(()=>[Z((t(),V("div",vl,[a(Re,{icon:"rename",class:"text-gray-700"}),K(" "+y(U.$t("general.rename"))+" "+y(U.$t("objects.table").toLowerCase()),1)])),[[Ke,["c:table:rename"]]])]),_:1},8,["data-testid"])):E("",!0),e(B)("tableDescriptionEdit",{roles:e(n),source:e(fe)})?(t(),f(rt,{key:1,"data-testid":`sidebar-table-description-${e(r).title}`,class:"nc-table-description",onClick:F[5]||(F[5]=ct=>re(e(r)))},{default:o(()=>[Z((t(),V("div",fl,[a(Re,{icon:"ncAlignLeft",class:"text-gray-700"}),K(" "+y(U.$t("labels.editDescription")),1)])),[[Ke,["c:table:update-description"]]])]),_:1},8,["data-testid"])):E("",!0),e(B)("tableDuplicate",{source:e(fe)})&&((Ee=e(d).sources)!=null&&Ee[e(l)])&&(e(fe).is_meta||e(fe).is_local)?(t(),f(rt,{key:2,"data-testid":`sidebar-table-duplicate-${e(r).title}`,onClick:F[6]||(F[6]=ct=>we(e(r)))},{default:o(()=>[Z((t(),V("div",bl,[a(Re,{icon:"duplicate",class:"text-gray-700"}),K(" "+y(U.$t("general.duplicate"))+" "+y(U.$t("objects.table").toLowerCase()),1)])),[[Ke,["c:table:duplicate"]]])]),_:1},8,["data-testid"])):E("",!0),a(bt),a(rt,{class:"!text-gray-700",onClick:xe},{default:o(()=>[a(Re,{class:"nc-view-copy-icon",icon:"duplicate"}),K(" "+y(U.$t("general.duplicateEntity",{entity:U.$t("title.defaultView").toLowerCase()})),1)]),_:1}),a(bt),e(B)("tableDelete",{roles:e(n),source:e(fe)})?(t(),f(rt,{key:3,"data-testid":`sidebar-table-delete-${e(r).title}`,class:"!text-red-500 !hover:bg-red-50 nc-table-delete",onClick:be},{default:o(()=>[Z((t(),V("div",_l,[a(Re,{icon:"delete"}),K(" "+y(U.$t("general.delete"))+" "+y(U.$t("objects.table").toLowerCase()),1)])),[[Ke,["c:table:delete"]]])]),_:1},8,["data-testid"])):E("",!0)],64)):E("",!0)]}),_:1},8,["data-testid"])]),default:o(()=>[Z((t(),f(vt,{class:ee(["nc-sidebar-node-btn nc-tbl-context-menu text-gray-700 hover:text-gray-800",{"!opacity-100 !inline-block":e(z)}]),"data-testid":"nc-sidebar-table-context-menu",type:"text",size:"xxsmall",onClick:F[2]||(F[2]=ve(()=>{},["stop"]))},{default:o(()=>[a(ft,{class:"!text-current"})]),_:1},8,["class"])),[[Ke,["c:table:option"]]])]),_:1},8,["visible"]),Z((t(),f(vt,{type:"text",size:"xxsmall",class:ee(["nc-sidebar-node-btn nc-sidebar-expand text-gray-700 hover:text-gray-800",{"!opacity-100 !visible":e(z)}]),onClick:ve(Qe,["stop"])},{default:o(()=>[a(Re,{icon:"chevronRight",class:ee(["nc-sidebar-source-node-btns cursor-pointer transform transition-transform duration-200 !text-current text-[20px]",{"!rotate-90":e(G)}])},null,8,["class"])]),_:1},8,["class"])),[[Ke,["c:table:toggle-expand"]]])])],42,il)),[[Ke,["a:table:open"]]])]),e(r).id&&((ea=e(d))!=null&&ea.id)?(t(),f(It,{key:0,visible:e(R),"onUpdate:visible":F[10]||(F[10]=Ee=>le(R)?R.value=Ee:null),"table-id":e(r).id,"base-id":e(d).id},null,8,["visible","table-id","base-id"])):E("",!0),e(G)?(t(),f(Et,{key:1,"table-id":e(r).id,"base-id":e(d).id,onDeleted:Te},null,8,["table-id","base-id"])):E("",!0)],10,nl)}}}),gl=Oe(yl,[["__scopeId","data-v-340a63f9"]]),wl={class:"border-none sortable-list"},xl=["nc-source"],kl=pe({__name:"TableList",props:{base:{},sourceIndex:{default:0}},setup(c){const P=c,d=tt(P,"base"),r=tt(P,"sourceIndex"),l=ae(()=>{var n,O;return(O=(n=d.value)==null?void 0:n.sources)==null?void 0:O[r.value]}),{isMobileMode:_}=De(),{isUIAllowed:N}=ze(),{baseTables:B}=te(Ie()),j=ae(()=>B.value.get(d.value.id)??[]),{$api:k}=Ne(),s=ae(()=>j.value.reduce((n,O)=>(n[O.id]=O,n),{})),T=I({}),C=I(),g={},w=n=>{const O=n.getAttribute("nc-source");O&&(_.value||(g[O]&&g[O].destroy(),fs.create(n,{onEnd:async x=>{var m,D;const i=j.value.findIndex(R=>R.source_id===O),{newIndex:u=0,oldIndex:h=0}=x;if(u===h)return;const p=x.item,A=s.value[p.dataset.id],M=x.to.children;if(M.length<2)return;const W=M[u-1],H=M[u+1],Y=W&&s.value[W.dataset.id],q=H&&s.value[H.dataset.id];M.length-1===x.newIndex?A.order=Y.order+1:u===0?A.order=q.order/2:A.order=(Y.order+q.order)/2,(D=j.value)==null||D.splice(u+i,0,...(m=j.value)==null?void 0:m.splice(h+i,1)),T.value[O]?T.value[O]=T.value[O]+1:T.value[O]=1,await k.dbTable.reorder(A.id,{order:A.order})},animation:150,setData(x,i){x.setData("text/json",JSON.stringify({id:i.dataset.id,title:i.dataset.title,type:i.dataset.type,sourceId:i.dataset.sourceId}))},revertOnSpill:!0})))};wa(()=>{C.value&&N("viewCreateOrEdit")&&(C.value instanceof HTMLElement?w(C.value):C.value.forEach(n=>w(n)))});const L=ae(()=>j.value.filter(n=>{var O,x;return n.source_id===((x=(O=d.value)==null?void 0:O.sources)==null?void 0:x[r.value].id)}));return(n,O)=>{var x,i,u,h,p,A;return t(),V("div",wl,[e(d)?(t(),V(_e,{key:0},[e(L).length===0?(t(),V("div",{key:0,class:ee(["py-0.5 text-gray-500",{"ml-8.5":e(r)===0,"ml-14.5 xs:ml-15.25":e(r)!==0}])},y(n.$t("general.empty")),3)):E("",!0),(x=e(d).sources)!=null&&x[e(r)]&&e(d).sources[e(r)].enabled?(t(),V("div",{ref_key:"menuRefs",ref:C,key:`sortable-${(i=e(l))==null?void 0:i.id}-${(u=e(l))!=null&&u.id&&((h=e(l))==null?void 0:h.id)in e(T)?e(T)[(p=e(l))==null?void 0:p.id]:"0"}`,"nc-source":(A=e(l))==null?void 0:A.id},[(t(!0),V(_e,null,ha(e(L),M=>{var W;return t(),f(gl,{key:M.id,class:"nc-tree-item text-sm","data-order":M.order,"data-id":M.id,table:M,base:e(d),"source-index":e(r),"data-title":M.title,"data-source-id":(W=e(l))==null?void 0:W.id,"data-type":M.type},null,8,["data-order","data-id","table","base","source-index","data-title","data-source-id","data-type"])}),128))],8,xl)):E("",!0)],64)):E("",!0)])}}}),hl={key:0,class:"flex flex-row items-center py-2 px-2.25 bg-gray-50 rounded-lg text-gray-700"},$l={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Il=pe({__name:"ProjectDelete",props:{visible:{type:Boolean},baseId:{}},emits:["update:visible"],setup(c,{emit:P}){const d=c,l=Ye(d,"visible",P),{closeTab:_}=Mt(),N=at(),{deleteProject:B,navigateToFirstProjectOrHome:j}=N,{bases:k}=te(N),{removeFromRecentViews:s}=qe(),{refreshCommandPalette:T}=st(),C=ae(()=>k.value.get(d.baseId)),g=I(!1),w=async()=>{if(!C.value)return;const L=JSON.parse(JSON.stringify(C.value));g.value=!0;try{await B(L.id),await _(L.id),T(),l.value=!1,L.id===N.activeProjectId&&await j()}catch(n){ue.error(await Pe(n))}finally{g.value=!1,s({baseId:L.id})}};return(L,n)=>{const O=ba,x=bs;return t(),f(x,{visible:e(l),"onUpdate:visible":n[0]||(n[0]=i=>le(l)?l.value=i:null),"entity-name":L.$t("objects.project"),"on-delete":w},{"entity-preview":o(()=>[e(C)?(t(),V("div",hl,[a(O,{color:("parseProp"in L?L.parseProp:e(Dt))(e(C).meta).iconColor,type:e(C).type,class:"nc-view-icon w-6 h-6 mx-1"},null,8,["color","type"]),v("div",$l,y(e(C).title),1)])):E("",!0)]),_:1},8,["visible","entity-name"])}}}),Tl={class:"mt-5"},Dl={class:"prose-md self-center text-gray-500 mt-4"},Cl={class:"text-xs p-2"},Sl={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},Vl=pe({__name:"ProjectDuplicate",props:{modelValue:{type:Boolean},base:{}},emits:["update:modelValue"],setup(c,{emit:P}){const d=c,r=P,{refreshCommandPalette:l}=st(),{api:_}=Kt(),{$e:N,$poller:B}=Ne(),j=at(),{loadProjects:k,createProject:s}=j,{bases:T}=te(j),{navigateToProject:C}=De(),g=Ye(d,"modelValue",r),w=I({includeData:!0,includeViews:!0,includeHooks:!0}),L=ae(()=>{const{includeData:i,includeViews:u,includeHooks:h}=w.value;return{excludeData:!i,excludeViews:!u,excludeHooks:!h}}),n=I(!1),O=async()=>{try{n.value=!0;const i=es[Math.floor(Math.random()*1e3)%es.length],h=Fs(i).complement(),p=await _.base.duplicate(d.base.id,{options:L.value,base:{fk_workspace_id:d.base.fk_workspace_id,type:d.base.type,color:i,meta:JSON.stringify({theme:{primaryColor:i,accentColor:h.toHex8String()},iconColor:Dt(d.base.meta).iconColor})}});B.subscribe({id:p.id},async A=>{if(A.status!=="close")if(A.status===Vt.COMPLETED){await k("workspace");const M=T.value.get(p.base_id);M&&await C({workspaceId:et?M.fk_workspace_id:void 0,baseId:M.id,type:M.type}),l(),n.value=!1,g.value=!1}else A.status===Vt.FAILED&&(ue.error("Failed to duplicate project"),await k("workspace"),l(),n.value=!1,g.value=!1)}),N("a:base:duplicate")}catch(i){ue.error(await Pe(i)),n.value=!1,g.value=!1}};oa("Enter",()=>{g.value&&O()});const x=I(!1);return(i,u)=>{const h=Ca,p=Da,A=Ue,M=Pt,W=Fe("e");return i.base?(t(),f(M,{key:0,visible:e(g),"onUpdate:visible":u[5]||(u[5]=H=>le(g)?g.value=H:null),"mask-closable":!e(n),keyboard:!e(n),class:"!w-[30rem]","wrap-class-name":"nc-modal-base-duplicate"},{default:o(()=>[v("div",null,[v("div",{class:"font-medium text-lg text-gray-800 self-center",onDblclick:u[0]||(u[0]=H=>x.value=!e(x))},y(i.$t("general.duplicate"))+" "+y(i.$t("objects.project")),33),v("div",Tl,y(i.$t("msg.warning.duplicateProject")),1),v("div",Dl,y(i.$t("title.advancedSettings")),1),a(h,{class:"!m-0 !p-0 !my-2"}),v("div",Cl,[a(p,{checked:e(w).includeData,"onUpdate:checked":u[1]||(u[1]=H=>e(w).includeData=H),disabled:e(n)},{default:o(()=>[K(y(i.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"]),a(p,{checked:e(w).includeViews,"onUpdate:checked":u[2]||(u[2]=H=>e(w).includeViews=H),disabled:e(n)},{default:o(()=>[K(y(i.$t("labels.includeView")),1)]),_:1},8,["checked","disabled"]),Z(a(p,{checked:e(w).includeHooks,"onUpdate:checked":u[3]||(u[3]=H=>e(w).includeHooks=H),disabled:e(n)},{default:o(()=>[K(y(i.$t("labels.includeWebhook")),1)]),_:1},8,["checked","disabled"]),[[is,e(x)]])])]),v("div",Sl,[e(n)?E("",!0):(t(),f(A,{key:"back",type:"secondary",size:"small",onClick:u[4]||(u[4]=H=>g.value=!1)},{default:o(()=>[K(y(i.$t("general.cancel")),1)]),_:1})),Z((t(),f(A,{key:"submit",size:"small",loading:e(n),onClick:O},{default:o(()=>[K(y(i.$t("general.confirm")),1)]),_:1},8,["loading"])),[[W,["a:base:duplicate"]]])])]),_:1},8,["visible","mask-closable","keyboard"])):E("",!0)}}}),jl=c=>c.is_schema_readonly&&c.is_data_readonly?"#278bff":c.is_schema_readonly?"#df830f":"#de0062",Ml=c=>{var d,r;const P=`Connection type is ${((d=Ws.find(l=>l.value===c.type))==null?void 0:d.text)||((r=c.type)==null?void 0:r.toUpperCase())}.`;return c.is_schema_readonly&&c.is_data_readonly?Me("div",{className:"w-max"},[P,Me("br"),"Both data and schema editing are disabled.",Me("br"),"These settings are ideal for read-only use cases of your data.",Me("br"),Me("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"Learn more")]):c.is_schema_readonly?Me("div",{className:"max-w-90"},[P,Me("br"),"Data editing is allowed and Schema edit is not allowed.",Me("br"),"An ideal settings for administrative users who need to change data directly on database.",Me("br"),Me("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"Learn more")]):Me("div",{className:"max-w-90"},[P,Me("br"),"Both Data and Schema Editing are enabled.",Me("br"),"We highly recommend ",Me("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"disabling schema editing")," to maintain data integrity and avoid potential issues."])},Pl=ht(()=>$t(()=>import("./Cp5O2m5x.js"),__vite__mapDeps([4,5,1,2,6,7,8,9,10,11]),import.meta.url).then(c=>c.default||c)),El=["data-testid","data-base-id"],Nl=["data-testid"],Bl={class:"flex items-center select-none w-6 h-full"},Ll={key:1},Ol={class:"flex gap-2 items-center"},Ul={class:"flex gap-2 items-center"},Rl={class:"flex gap-2 items-center"},Al={class:"flex gap-2 items-center"},zl={class:"flex gap-2 items-center"},Gl={class:"flex gap-2 items-center"},Fl={class:"flex gap-2 items-center"},Wl={key:0,class:"flex-1"},Kl={class:"transition-height duration-200"},Hl={key:1,class:"transition-height duration-200"},ql={class:"border-none sortable-list"},Jl={class:"nc-sidebar-node min-w-20 w-full h-full flex flex-row group py-0.5 pr-6.5 !mr-0"},Yl=["onContextmenu"],Ql=["onContextmenu"],Zl={class:"flex-none w-6 flex items-center justify-center"},Xl=["onUpdate:modelValue","data-source-rename-input-id","onKeyup","onBlur"],ei=["data-testid"],ti={class:"flex flex-row items-center gap-x-0.25"},ai={class:"flex gap-2 items-center"},si=["nc-source"],oi={class:"flex text-xs font-bold text-gray-500 ml-1"},ni={class:"nc-base-option-item flex gap-2 items-center"},li={class:"nc-base-option-item flex gap-2 items-center"},ii={class:"nc-base-option-item flex gap-2 items-center text-red-600"},ri={class:"h-[80vh]"},ci=pe({__name:"ProjectNode",setup(c,{expose:P}){const d=Me(Ks,{class:"!text-gray-400",style:{fontSize:"0.85rem"},spin:!0}),l=$a().currentRoute,{isSharedBase:_}=te(Ge()),{setMenuContext:N,openRenameTableDialog:B,duplicateTable:j,contextMenuTarget:k}=Ae(ia),s=Ae(Ht),T=at(),{isMobileMode:C}=De(),{api:g}=Kt(),{auditLogsQuery:w,auditPaginationData:L}=te(pt()),{createProject:n,updateProject:O,getProjectMetaInfo:x,loadProject:i}=T,{bases:u}=te(T),{loadProjectTables:h}=Ie(),{activeTable:p}=te(Ie()),{appInfo:A}=De(),{orgRoles:M,isUIAllowed:W}=ze();Mt();const{meta:H,control:Y}=sa(),{refreshCommandPalette:q}=st(),m=I(!1),D=I(""),R=I({}),z=I(""),ne=I(!1),{t:de}=aa(),ye=I(),G=ae(()=>s.value.project_role||s.value.workspace_role),{activeProjectId:Q}=te(at()),{baseUrl:Le}=Ge(),Qe=Ae(ps,()=>{}),{$e:he}=Ne(),S=I(!1),X=I({}),se=I([]),[oe]=Hs(),we=I(""),ge=I({}),re=I(!1),be=I(!1),{refreshViewTabTitle:xe}=qe(),Te=ae(()=>{var ie;const $=String((ie=l.value)==null?void 0:ie.name).split("baseId-index-index");if($.length<=1)return!1;const b=$[$.length-1];return b.split("-").length===2||b.split("-").length===1}),fe=$=>["airtableImport","csvImport","jsonImport","excelImport"].some(b=>W(b,{source:$})),U=()=>{m.value=!0,D.value=s.value.title,ut(()=>{var $,b;($=ye.value)==null||$.focus(),(b=ye.value)==null||b.select()})},F=$=>{var ie;const b=(ie=s.value.sources)==null?void 0:ie.find(ce=>ce.id===$);b!=null&&b.id&&(R.value[b.id]={editMode:!0,tempTitle:b.alias||""},ut(()=>{const ce=document.querySelector(`[data-source-rename-input-id="${$}"]`);ce&&(ce==null||ce.focus(),ce==null||ce.select())}))},Ce=async $=>{var ie;const b=(ie=s.value.sources)==null?void 0:ie.find(ce=>ce.id===$);if(!(!(b!=null&&b.id)||!R.value[b.id])&&(R.value[b.id].tempTitle&&(R.value[b.id].tempTitle=R.value[b.id].tempTitle.trim()),!!R.value[b.id].tempTitle))try{await g.source.update(b.base_id,b.id,{alias:R.value[b.id].tempTitle}),await i(b.base_id,!0),delete R.value[b.id],he("a:source:rename"),xe==null||xe()}catch(ce){ue.error(await Pe(ce))}finally{q()}},mt=async()=>{if(D.value&&(D.value=D.value.trim()),!!D.value)try{await O(s.value.id,{title:D.value}),m.value=!1,D.value="",he("a:base:rename"),xe==null||xe()}catch($){ue.error(await Pe($))}},{copy:Ze}=cs(!0),ot=async()=>{try{await Ze(Object.entries(await x(s.value.id)).map(([$,b])=>`${$}: **${b}**`).join(`
`))&&ue.info(de("msg.info.copiedToClipboard"))}catch($){console.error($),ue.error($.message)}};P({enableEditMode:U});const Re=async($,b)=>{try{const ie={...Dt(b.meta),iconColor:$};T.updateProject(b.id,{meta:JSON.stringify(ie)}),he("a:base:icon:color:navdraw",{iconColor:$})}catch(ie){ue.error(await Pe(ie))}finally{q()}};function vt($){var me,Xe,Se;const b=I(!0);let ie=(me=s.value.sources)==null?void 0:me[0].id;if(typeof $=="number"&&(ie=(Xe=s.value.sources)==null?void 0:Xe[$].id),!ie||!((Se=s.value)!=null&&Se.id))return;const{close:ce}=Be(vs,{modelValue:b,sourceId:ie,baseId:s.value.id,onCreate:He,"onUpdate:modelValue":()=>He()});function He(nt){b.value=!1,nt&&(s.value.isExpanded=!0,(!se.value||!se.value.includes(`collapse-${ie}`))&&se.value.push(`collapse-${ie}`),setTimeout(()=>{const yt=document.querySelector(`[data-table-id="${nt.id}"]`);yt&&(yt==null||yt.scrollIntoView({behavior:"smooth",block:"nearest"}))},1e3),ce(1e3))}}const ft=I(!1);async function rt(){if(ft.value)return;ft.value=!0,!T.isProjectPopulated(s.value.id)&&s.value.type===Ct.DB&&h(s.value.id);try{vt(),!s.value.isExpanded&&s.value.type!==Ct.DB&&(s.value.isExpanded=!0)}finally{ft.value=!1}}const bt=async($,b,ie)=>{if(!$)return;const ce=St()?H.value:Y.value;if(!ie&&!ce&&he("c:base:open"),b=C.value||b,ie=C.value||ie,ce&&!b){await Gt(`${ce?"#":""}${Le({id:$.id,type:"database",isSharedBase:_.value})}`,ce?{open:Ys}:void 0);return}ie?$.isExpanded=!$.isExpanded:$.isExpanded=!0;const He=T.isProjectPopulated($.id);if(He||($.isLoading=!0),b||await Gt(Le({id:$.id,type:"database",isSharedBase:_.value})),He||await h($.id),!He){$.isLoading=!1;const me=u.value.get($.id);me.isLoading=!1}};function Yt($){he("c:project:relation");const b=I(!0),{close:ie}=Be(gn,{modelValue:b,sourceId:$.id,"onUpdate:modelValue":()=>ce(),baseId:s.value.id});function ce(){b.value=!1,ie(1e3)}}const Qt=ae(()=>{var $,b;if(k.type==="source")return k.value;if(k.type==="table"){const ie=(b=($=s.value)==null?void 0:$.sources)==null?void 0:b.find(ce=>ce.id===k.value.source_id);if(ie)return ie}return null});Je(()=>{var $;return($=p.value)==null?void 0:$.id},async()=>{if(!p.value)return;const $=p.value.source_id;$&&(se.value.includes(`collapse-${$}`)||se.value.push(`collapse-${$}`))},{immediate:!0}),oa("Escape",()=>{S.value&&(S.value=!1);for(const $ of Object.keys(X.value))X.value[$]=!1});const It=I(!1),Et=I(),Ke=$=>{Et.value=$,It.value=!0},Zt=()=>{re.value=!0,he("c:table:delete")},Xt=()=>{be.value=!0,he("c:project:delete")},Tt=I(!1);let _t;const ea=async()=>{_t&&clearTimeout(_t);try{await Ze(k.value.id),Tt.value=!0,_t=setTimeout(()=>{Tt.value=!1,clearTimeout(_t)},5e3)}catch($){ue.error($.message)}},Ee=$=>{var b;return(b=s.value.sources)==null?void 0:b.find(ie=>ie.id===$)};async function ct($){he("c:project:audit"),L.value.page=1,w.value={...w.value,orderBy:{created_at:"desc",user:void 0}};const b=I(!0),{close:ie}=Be(xn,{modelValue:b,sourceId:$.id,"onUpdate:modelValue":()=>ce(),baseId:s.value.id,bordered:!0});function ce(){b.value=!1,ie(1e3)}}return($,b)=>{var Ea,Na,Ba,La,Oa;const ie=Qs,ce=Zs,He=Wt,me=We,Xe=Ue,Se=qt,nt=Sa,yt=Dn,ma=da,va=Jt,Ma=kl,Pa=xo,ws=ko,xs=ho,ks=ys,hs=Il,$s=Vl,Is=Pl,Ts=Pt,Ve=Fe("e");return t(),V(_e,null,[a(va,{trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-tree-view-context-menu"},qs({default:o(()=>{var je,Nt,Bt,Lt,Ot,Ut,Rt,gt,Ua,Ra,Aa,za,Ga,Fa,Wa;return[v("div",{class:ee(["mx-1 nc-base-sub-menu rounded-md",{active:e(s).isExpanded}]),"data-testid":`nc-sidebar-base-${e(s).title}`,"data-base-id":e(s).id},[v("div",{class:"flex items-center gap-0.75 py-0.5 cursor-pointer",onContextmenu:b[15]||(b[15]=J=>e(N)("base",e(s)))},[v("div",{ref:"baseNodeRefs",class:ee([{"bg-primary-selected active":e(Q)===e(s).id&&e(Te)&&!e(C),"hover:bg-gray-200":!(e(Q)===e(s).id&&e(Te))},"nc-sidebar-node base-title-node h-7 flex-grow rounded-md group flex items-center w-full pr-1 pl-1.5"]),"data-testid":`nc-sidebar-base-title-${e(s).title}`},[v("div",{class:"flex items-center mr-1",onClick:b[1]||(b[1]=J=>bt(e(s)))},[v("div",Bl,[e(s).isLoading?(t(),f(ie,{key:0,class:"!ml-1.25 !flex !flex-row !items-center !my-0.5 w-8",indicator:e(d)},null,8,["indicator"])):(t(),V("div",Ll,[(t(),f(ce,{key:`${e(s).id}_${("parseProp"in $?$.parseProp:e(Dt))(e(s).meta).iconColor}`,type:(je=e(s))==null?void 0:je.type,"model-value":("parseProp"in $?$.parseProp:e(Dt))(e(s).meta).iconColor,size:"small",readonly:((Nt=e(s))==null?void 0:Nt.type)&&((Bt=e(s))==null?void 0:Bt.type)!=="database"||!e(W)("baseRename"),"onUpdate:modelValue":b[0]||(b[0]=J=>Re(J,e(s)))},null,8,["type","model-value","readonly"]))]))])]),e(m)?Z((t(),V("input",{key:0,ref_key:"input",ref:ye,"onUpdate:modelValue":b[2]||(b[2]=J=>le(D)?D.value=J:null),class:ee(["flex-grow leading-1 outline-0 ring-none capitalize !text-inherit !bg-transparent flex-1 mr-4",e(Q)===e(s).id&&e(Te)?"!text-brand-600 !font-semibold":"!text-gray-700"]),onClick:b[3]||(b[3]=ve(()=>{},["stop"])),onKeyup:[dt(mt,["enter"]),dt(mt,["esc"])],onBlur:mt},null,34)),[[ts,e(D)]]):(t(),f(He,{key:1,class:ee(["nc-sidebar-node-title capitalize text-ellipsis overflow-hidden select-none flex-1",e(Q)===e(s).id&&e(Te)?"text-brand-600 font-semibold":"text-gray-700"]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},"show-on-truncate-only":"",onClick:b[4]||(b[4]=J=>bt(e(s)))},{title:o(()=>[K(y(e(s).title),1)]),default:o(()=>[v("span",null,y(e(s).title),1)]),_:1},8,["class"])),e(m)?E("",!0):(t(),V(_e,{key:2},[e(_)?E("",!0):(t(),f(va,{key:0,visible:e(S),"onUpdate:visible":b[13]||(b[13]=J=>le(S)?S.value=J:null),trigger:["click"]},{overlay:o(()=>[a(ma,{class:"nc-scrollbar-md",style:{maxHeight:"70vh",overflow:"overlay"},"data-testid":`nc-sidebar-base-${e(s).title}-options`,onClick:b[12]||(b[12]=J=>S.value=!1)},{default:o(()=>{var J,wt,lt,$e,Ka,Ha,qa,Ja,Ya,Qa,Za;return[e(_)?E("",!0):(t(),V(_e,{key:0},[e(W)("baseRename")?(t(),f(Se,{key:0,"data-testid":"nc-sidebar-project-rename",onClick:U},{default:o(()=>[Z((t(),V("div",Ol,[a(me,{icon:"rename",class:"group-hover:text-black"}),K(" "+y($.$t("general.rename")),1)])),[[Ve,["c:base:rename"]]])]),_:1})):E("",!0),e(W)("baseDuplicate",{roles:[e(as)(e(M)),e(G)].join()})?(t(),f(Se,{key:1,"data-testid":"nc-sidebar-base-duplicate",onClick:b[6]||(b[6]=it=>Ke(e(s)))},{default:o(()=>[Z((t(),V("div",Ul,[a(me,{icon:"duplicate",class:"text-gray-700"}),K(" "+y($.$t("general.duplicate")),1)])),[[Ve,["c:base:duplicate"]]])]),_:1})):E("",!0),["baseDuplicate","baseRename"].some(it=>e(W)(it))?(t(),f(nt,{key:2})):E("",!0),("isEeUI"in $?$.isEeUI:e(et))?E("",!0):(t(),f(Se,{key:"copy","data-testid":"nc-sidebar-base-copy-base-info",onClick:ve(ot,["stop"])},{default:o(()=>[Z((t(),V("div",Rl,[a(me,{icon:"copy",class:"group-hover:text-black"}),K(" "+y($.$t("activity.account.projInfo")),1)])),[[Ve,["c:base:copy-proj-info"]]])]),_:1})),(lt=(wt=(J=e(s))==null?void 0:J.sources)==null?void 0:wt[0])!=null&&lt.enabled?(t(),f(Se,{key:"erd","data-testid":"nc-sidebar-base-relations",onClick:b[7]||(b[7]=it=>{var At,zt;return Yt((zt=(At=e(s))==null?void 0:At.sources)==null?void 0:zt[0])})},{default:o(()=>[Z((t(),V("div",Al,[a(me,{icon:"erd"}),K(" "+y($.$t("title.relations")),1)])),[[Ve,["c:base:erd"]]])]),_:1})):E("",!0),e(W)("baseAuditList")&&((Ha=(Ka=($e=e(s))==null?void 0:$e.sources)==null?void 0:Ka[0])!=null&&Ha.enabled)?(t(),f(Se,{key:"audit","data-testid":"nc-sidebar-base-audit",onClick:b[8]||(b[8]=it=>{var At,zt;return ct((zt=(At=e(s))==null?void 0:At.sources)==null?void 0:zt[0])})},{default:o(()=>[a(me,{icon:"audit",class:"group-hover:text-black"}),K(" "+y($.$t("title.audit")),1)]),_:1})):E("",!0),e(W)("apiDocs")?(t(),f(Se,{key:"api","data-testid":"nc-sidebar-base-rest-apis",onClick:b[9]||(b[9]=ve(()=>{e(he)("c:base:api-docs"),("openLink"in $?$.openLink:e(Js))(`/api/v2/meta/bases/${e(s).id}/swagger`,e(A).ncSiteUrl)},["stop"]))},{default:o(()=>[Z((t(),V("div",zl,[a(me,{icon:"snippet",class:"group-hover:text-black !max-w-3.9"}),K(" "+y($.$t("activity.account.swagger")),1)])),[[Ve,["c:base:api-docs"]]])]),_:1})):E("",!0)],64)),(Ya=(Ja=(qa=e(s))==null?void 0:qa.sources)==null?void 0:Ja[0])!=null&&Ya.enabled&&fe((Za=(Qa=e(s))==null?void 0:Qa.sources)==null?void 0:Za[0])?(t(),V(_e,{key:1},[a(nt),a(yt,{base:e(s),"onUpdate:base":b[10]||(b[10]=it=>le(s)?s.value=it:null),source:e(s).sources[0]},null,8,["base","source"])],64)):E("",!0),["baseMiscSettings","baseDelete"].some(it=>e(W)(it))?(t(),f(nt,{key:2})):E("",!0),e(W)("baseMiscSettings")?(t(),f(Se,{key:"teamAndSettings","data-testid":"nc-sidebar-base-settings",class:"nc-sidebar-base-base-settings",onClick:b[11]||(b[11]=it=>e(Qe)(!0,"teamAndAuth",void 0,e(s).id))},{default:o(()=>[Z((t(),V("div",Gl,[a(me,{icon:"settings",class:"group-hover:text-black"}),K(" "+y($.$t("activity.settings")),1)])),[[Ve,["c:base:settings"]]])]),_:1})):E("",!0),e(W)("baseDelete",{roles:[e(as)(e(M)),e(G)].join()})?(t(),f(Se,{key:4,"data-testid":"nc-sidebar-base-delete",class:"!text-red-500 !hover:bg-red-50",onClick:Xt},{default:o(()=>[v("div",Fl,[a(me,{icon:"delete",class:"w-4"}),K(" "+y($.$t("general.delete")),1)])]),_:1})):E("",!0)]}),_:1},8,["data-testid"])]),default:o(()=>[Z((t(),f(Xe,{class:ee(["nc-sidebar-node-btn",{"!text-black !opacity-100 !inline-block":e(S)}]),"data-testid":"nc-sidebar-context-menu",type:"text",size:"xxsmall",onClick:b[5]||(b[5]=ve(()=>{},["stop"]))},{default:o(()=>[a(me,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:1},8,["class"])),[[Ve,["c:base:options"]]])]),_:1},8,["visible"])),e(W)("tableCreate",{roles:e(G),source:(Ot=(Lt=e(s))==null?void 0:Lt.sources)==null?void 0:Ot[0]})?Z((t(),f(Xe,{key:1,disabled:!((gt=(Rt=(Ut=e(s))==null?void 0:Ut.sources)==null?void 0:Rt[0])!=null&&gt.enabled),class:ee(["nc-sidebar-node-btn",{"!text-black !inline-block !opacity-100":e(ft),"!inline-block !opacity-100":e(S)}]),size:"xxsmall",type:"text","data-testid":"nc-sidebar-add-base-entity",loading:e(ft),onClick:ve(rt,["stop"])},{default:o(()=>[a(me,{icon:"plus",class:"text-xl leading-5",style:{"-webkit-text-stroke":"0.15px"}})]),_:1},8,["disabled","class","loading"])),[[Ve,["c:base:create-table"]]]):E("",!0),Z((t(),f(Xe,{type:"text",size:"xxsmall",class:ee(["nc-sidebar-node-btn nc-sidebar-expand !xs:opacity-100 !mr-0 mt-0.5",{"!opacity-100":e(S)}]),onClick:b[14]||(b[14]=J=>bt(e(s),!0,!0))},{default:o(()=>[a(me,{icon:"chevronRight",class:ee(["group-hover:visible cursor-pointer transform transition-transform duration-200 text-[20px]",{"!rotate-90":e(s).isExpanded}])},null,8,["class"])]),_:1},8,["class"])),[[Ve,["c:base:expand"]]])],64))],10,Nl)],32),e(s).id&&!e(s).isLoading?(t(),V("div",{key:"g1",class:ee(["overflow-x-hidden transition-max-height",{"max-h-0":!e(s).isExpanded}])},[e(s)&&((Ua=e(s))!=null&&Ua.sources)?(t(),V("div",{key:0,class:ee(["flex-1 overflow-y-auto overflow-x-hidden flex flex-col",{"mb-[20px]":e(_)}])},[(za=(Aa=(Ra=e(s))==null?void 0:Ra.sources)==null?void 0:Aa[0])!=null&&za.enabled?(t(),V("div",Wl,[v("div",Kl,[a(Ma,{base:e(s),"source-index":0},null,8,["base"])])])):E("",!0),(Wa=(Fa=(Ga=e(s))==null?void 0:Ga.sources)==null?void 0:Fa.slice(1).filter(J=>J.enabled))!=null&&Wa.length?(t(),V("div",Hl,[v("div",ql,[(t(!0),V(_e,null,ha(e(s).sources,(J,wt)=>(t(),V("div",{key:`source-${J.id}`},[wt===0?(t(),V(_e,{key:0},[],64)):J&&J.enabled?Z((t(),f(xs,{key:1,activeKey:e(se),"onUpdate:activeKey":b[19]||(b[19]=lt=>le(se)?se.value=lt:null),class:ee(["!mx-0 !px-0 nc-sidebar-source-node",[{hidden:e(oe)&&!!e(we)}]]),"expand-icon-position":"right",bordered:!1,ghost:""},{expandIcon:o(({isActive:lt})=>[Z((t(),f(Xe,{type:"text",size:"xxsmall",class:ee(["nc-sidebar-node-btn nc-sidebar-expand !xs:opacity-100 !mr-0 mt-0.5",{"!opacity-100 !inline-block":e(X)[J.id]}])},{default:o(()=>[a(me,{icon:"chevronDown",class:ee(["flex-none cursor-pointer transform transition-transform duration-500 rotate-270",{"!rotate-180":lt}])},null,8,["class"])]),_:2},1032,["class"])),[[Ve,["c:external:base:expand"]]])]),default:o(()=>[(t(),f(ws,{key:`collapse-${J.id}`},{header:o(()=>{var lt;return[v("div",Jl,[wt===0?(t(),V("div",{key:0,class:"source-context flex items-center gap-2 text-gray-800 nc-sidebar-node-title",onContextmenu:$e=>e(N)("source",J)},[a(Pa,{class:"flex-none min-w-4 !xs:min-w-4.25 !xs:w-4.25 !xs:text-sm"}),K(" "+y($.$t("general.default")),1)],40,Yl)):(t(),V("div",{key:1,class:"source-context flex flex-grow items-center gap-1 text-gray-800 min-w-1/20 max-w-full",onContextmenu:$e=>e(N)("source",J)},[a(He,{"tooltip-style":{"min-width":"max-content"},"overlay-inner-style":{"min-width":"max-content"},"mouse-leave-delay":.3,placement:"topLeft",trigger:"hover",class:"flex items-center"},{title:o(()=>[(t(),f(us(("getSourceTooltip"in $?$.getSourceTooltip:e(Ml))(J))))]),default:o(()=>[v("div",Zl,[a(Pa,{color:("getSourceIconColor"in $?$.getSourceIconColor:e(jl))(J),class:"flex-none min-w-4 !xs:min-w-4.25 !xs:w-4.25 !xs:text-sm"},null,8,["color"])])]),_:2},1024),J.id&&((lt=e(R)[J.id])!=null&&lt.editMode)?Z((t(),V("input",{key:0,ref_for:!0,ref_key:"input",ref:ye,"onUpdate:modelValue":$e=>e(R)[J.id].tempTitle=$e,class:"flex-grow leading-1 outline-0 ring-none capitalize !text-inherit !bg-transparent flex-1 mr-4 !text-gray-700","data-source-rename-input-id":J.id,onClick:b[16]||(b[16]=ve(()=>{},["stop"])),onKeydown:b[17]||(b[17]=dt(ve(()=>{},["stop","prevent"]),["enter"])),onKeyup:[dt($e=>Ce(J.id),["enter"]),dt($e=>Ce(J.id),["esc"])],onBlur:$e=>Ce(J.id)},null,40,Xl)),[[ts,e(R)[J.id].tempTitle]]):(t(),f(He,{key:1,class:"nc-sidebar-node-title capitalize text-ellipsis overflow-hidden select-none text-gray-700",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},"show-on-truncate-only":""},{title:o(()=>[K(y(J.alias||""),1)]),default:o(()=>[v("span",{"data-testid":`nc-sidebar-base-${J.alias}`},y(J.alias||""),9,ei)]),_:2},1024))],40,Ql)),v("div",ti,[a(va,{visible:e(X)[J.id],trigger:["click"],"onUpdate:visible":$e=>e(X)[J.id]=$e},{overlay:o(()=>[a(ma,{class:"nc-scrollbar-md",style:{maxHeight:"70vh",overflow:"overlay"},onClick:$e=>e(X)[J.id]=!1},{default:o(()=>[e(W)("baseRename")?(t(),f(Se,{key:0,"data-testid":"nc-sidebar-source-rename",onClick:$e=>F(J.id)},{default:o(()=>[a(me,{icon:"rename",class:"group-hover:text-black"}),K(" "+y($.$t("general.rename")),1)]),_:2},1032,["onClick"])):E("",!0),a(nt),a(Se,{key:"erd",onClick:$e=>Yt(J)},{default:o(()=>[Z((t(),V("div",ai,[a(me,{icon:"erd"}),K(" "+y($.$t("title.relations")),1)])),[[Ve,["c:source:erd"]]])]),_:2},1032,["onClick"]),fe(J)?(t(),f(yt,{key:1,base:e(s),"onUpdate:base":b[18]||(b[18]=$e=>le(s)?s.value=$e:null),source:J},null,8,["base","source"])):E("",!0)]),_:2},1032,["onClick"])]),default:o(()=>[Z((t(),f(Xe,{class:ee(["nc-sidebar-node-btn",{"!text-black !opacity-100 !inline-block":e(X)[J.id]}]),type:"text",size:"xxsmall",onClick:ve($e=>e(X)[J.id]=!e(X)[J.id],["stop"])},{default:o(()=>[a(me,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:2},1032,["class","onClick"])),[[Ve,["c:source:options"]]])]),_:2},1032,["visible","onUpdate:visible"]),e(W)("tableCreate",{roles:e(G),source:J})?Z((t(),f(Xe,{key:0,type:"text",size:"xxsmall",class:ee(["nc-sidebar-node-btn",{"!opacity-100 !inline-block":e(X)[J.id]}]),onClick:ve($e=>vt(wt),["stop"])},{default:o(()=>[a(me,{icon:"plus",class:"text-xl leading-5",style:{"-webkit-text-stroke":"0.15px"}})]),_:2},1032,["class","onClick"])),[[Ve,["c:source:add-table"]]]):E("",!0)])])]}),default:o(()=>[(t(),V("div",{ref_for:!0,ref:"menuRefs",key:`sortable-${J.id}-${J.id&&J.id in e(ge)?e(ge)[J.id]:"0"}`,"nc-source":J.id},[a(Ma,{base:e(s),"source-index":wt},null,8,["base","source-index"])],8,si))]),_:2},1024))]),_:2},1032,["activeKey","class"])),[[Ve,["c:source:toggle-expand"]]]):E("",!0)]))),128))])])):E("",!0)],2)):E("",!0)],2)):E("",!0)],10,El)]}),_:2},[e(_)?void 0:{name:"overlay",fn:o(()=>[a(ma,{class:ee(["!py-0 rounded text-sm",{"!min-w-62.5":e(k).type==="table"}])},{default:o(()=>{var je,Nt,Bt,Lt,Ot,Ut,Rt;return[e(k).type==="base"&&e(s).type==="database"?(t(),V(_e,{key:0},[],64)):e(k).type==="source"?(t(),V(_e,{key:1},[],64)):e(k).type==="table"?(t(),V(_e,{key:2},[a(He,null,{title:o(()=>[K(y($.$t("labels.clickToCopyTableID")),1)]),default:o(()=>{var gt;return[v("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:ve(ea,["stop"])},[v("div",oi,y($.$t("labels.tableIdColon",{tableId:(gt=e(k).value)==null?void 0:gt.id})),1),a(Xe,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(Tt)?(t(),f(me,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(t(),f(me,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),e(W)("tableRename",{source:Ee((je=e(k).value)==null?void 0:je.source_id)})||e(W)("tableDelete",{source:Ee((Nt=e(k).value)==null?void 0:Nt.source_id)})?(t(),V(_e,{key:0},[a(nt),e(W)("tableRename",{source:Ee((Bt=e(k).value)==null?void 0:Bt.source_id)})?(t(),f(Se,{key:0,onClick:b[20]||(b[20]=gt=>e(B)(e(k).value,!0))},{default:o(()=>[Z((t(),V("div",ni,[a(me,{icon:"rename",class:"text-gray-700"}),K(" "+y($.$t("general.rename"))+" "+y($.$t("objects.table")),1)])),[[Ve,["c:table:rename"]]])]),_:1})):E("",!0),e(W)("tableDuplicate",{source:Ee((Lt=e(k).value)==null?void 0:Lt.source_id)})&&((Ot=e(Qt))!=null&&Ot.is_meta||(Ut=e(Qt))!=null&&Ut.is_local)?(t(),f(Se,{key:1,onClick:b[21]||(b[21]=gt=>e(j)(e(k).value))},{default:o(()=>[Z((t(),V("div",li,[a(me,{icon:"duplicate",class:"text-gray-700"}),K(" "+y($.$t("general.duplicate"))+" "+y($.$t("objects.table")),1)])),[[Ve,["c:table:duplicate"]]])]),_:1})):E("",!0),a(nt),e(W)("tableDelete",{source:Ee((Rt=e(k).value)==null?void 0:Rt.source_id)})?(t(),f(Se,{key:2,class:"!hover:bg-red-50",onClick:Zt},{default:o(()=>[v("div",ii,[a(me,{icon:"delete"}),K(" "+y($.$t("general.delete"))+" "+y($.$t("objects.table")),1)])]),_:1})):E("",!0)],64)):E("",!0)],64)):E("",!0)]}),_:1},8,["class"])]),key:"0"}]),1024),(Ea=e(k).value)!=null&&Ea.id&&((Na=e(s))!=null&&Na.id)?(t(),f(ks,{key:0,visible:e(re),"onUpdate:visible":b[22]||(b[22]=je=>le(re)?re.value=je:null),"table-id":(Ba=e(k).value)==null?void 0:Ba.id,"base-id":(La=e(s))==null?void 0:La.id},null,8,["visible","table-id","base-id"])):E("",!0),a(hs,{visible:e(be),"onUpdate:visible":b[23]||(b[23]=je=>le(be)?be.value=je:null),"base-id":(Oa=e(s))==null?void 0:Oa.id},null,8,["visible","base-id"]),e(Et)?(t(),f($s,{key:1,modelValue:e(It),"onUpdate:modelValue":b[24]||(b[24]=je=>le(It)?It.value=je:null),base:e(Et)},null,8,["modelValue","base"])):E("",!0),a(Ts,{visible:e(ne),"onUpdate:visible":b[25]||(b[25]=je=>le(ne)?ne.value=je:null),size:"large"},{default:o(()=>{var je;return[v("div",ri,[a(Is,{"base-id":(je=e(s))==null?void 0:je.id,"source-id":e(z)},null,8,["base-id","source-id"])])]}),_:1},8,["visible"])],64)}}}),di=Oe(ci,[["__scopeId","data-v-7c26e8d0"]]),ui={class:"flex items-center justify-center mt-8"},pi={class:"flex flex-col gap-4 items-center text-gray-500"},mi=v("div",{class:"font-weight-medium"},"No Projects",-1),vi=v("div",{class:"text-xs"},"Create Base",-1),fi={class:"flex gap-2 justify mt-1"},bi={class:"flex gap-2 items-center justify-center text-xs"},_i=pe({__name:"EmptyPlaceholder",props:{buttons:{type:Boolean}},setup(c){const P=c,d=I(!1),r=I(),l=_=>{r.value=_,d.value=!0};return(_,N)=>{const B=$o,j=ba,k=Xs,s=ja;return t(),V("div",ui,[v("div",pi,[a(B),mi,P.buttons?(t(),V(_e,{key:0},[vi,v("div",fi,[a(k,{class:"flex-1 nc-btn",onClick:N[0]||(N[0]=T=>l(("NcProjectType"in _?_.NcProjectType:e(Ct)).DB))},{default:o(()=>[v("div",bi,[a(j,{type:("NcProjectType"in _?_.NcProjectType:e(Ct)).DB,class:"text-[#2824FB] text-lg"},null,8,["type"]),K(" New Database Base ")])]),_:1})]),a(s,{modelValue:e(d),"onUpdate:modelValue":N[1]||(N[1]=T=>le(d)?d.value=T:null),type:e(r)},null,8,["modelValue","type"])],64)):E("",!0)])])}}}),yi=c=>!!(c.offsetWidth||c.offsetHeight||c.getClientRects().length),gi=pe({__name:"ProjectWrapper",props:{baseRole:{default:""},base:{}},setup(c){const P=c,d=tt(P,"baseRole"),r=tt(P,"base");return xt(ds,d),xt(Ht,r),(l,_)=>_a(l.$slots,"default")}}),wi={class:"nc-treeview-container flex flex-col justify-between select-none"},xi={key:0,class:"text-gray-500 font-medium pl-3.5 mb-1"},ki={mode:"inline",class:"nc-treeview pb-0.5 flex-grow min-h-50 overflow-x-hidden"},hi={key:0},$i=pe({__name:"index",setup(c){const{isUIAllowed:P}=ze(),{$e:d}=Ne(),r=$a(),l=r.currentRoute,_=at(),{createProject:N,updateProject:B}=_,{bases:j,basesList:k,activeProjectId:s}=te(_),{isWorkspaceLoading:T}=te(pt()),C=I(!1),g=Ge(),{isSharedBase:w,base:L}=te(g),{activeTable:n}=te(Ie()),{isMobileMode:O}=De(),x=ga({}),i=(m,D)=>{x.type=m,x.value=D};function u(m){if(!m||!m.id)return;d("c:view:description");const D=I(!0),{close:R}=Be(po,{modelValue:D,view:m,"onUpdate:modelValue":z});function z(){D.value=!1,R(1e3)}}function h(m){if(!m||!m.id)return;d("c:table:description");const D=I(!0),{close:R}=Be(rn,{modelValue:D,tableMeta:m,"onUpdate:modelValue":z});function z(){D.value=!1,R(1e3)}}function p(m,D=!1){if(!m||!m.source_id)return;d("c:table:rename");const R=I(!0),{close:z}=Be(pn,{modelValue:R,tableMeta:m,sourceId:m.source_id,"onUpdate:modelValue":ne});function ne(){R.value=!1,z(1e3)}}function A(m,D){if(!m&&!(D||k.value[0].id))return;d("c:table:create:navdraw");const R=I(!0),{close:z}=Be(vs,{modelValue:R,sourceId:m,baseId:D||k.value[0].id,"onUpdate:modelValue":ne});function ne(){R.value=!1,z(1e3)}}const M=async m=>{if(!m||!m.id||!m.base_id)return;const D=I(!0);d("c:table:duplicate");const{close:R}=Be(_n,{modelValue:D,table:m,"onUpdate:modelValue":z});function z(){D.value=!1,R(1e3)}},W=ae(()=>{var m,D,R,z;return((D=(m=L.value)==null?void 0:m.sources)==null?void 0:D[0])&&P("tableCreate",{source:(z=(R=L.value)==null?void 0:R.sources)==null?void 0:z[0]})&&l.value.name!=="index"&&l.value.name!=="index-index"&&l.value.name!=="index-index-create"&&l.value.name!=="index-index-create-external"&&l.value.name!=="index-user-index"});ss(document,"keydown",async m=>{var R;const D=St()?m.metaKey:m.ctrlKey;if(m.altKey&&!m.shiftKey&&!D)switch(m.keyCode){case 84:{if(W.value&&!eo()){m.preventDefault(),d("c:shortcut",{key:"ALT + T"});const z=s.value,ne=z?j.value.get(z):void 0;if(!ne)return;z&&A((R=ne.sources)==null?void 0:R[0].id,z)}break}case 76:{l.value.params.baseId&&r.push({query:{...l.value.query,clear:l.value.query.clear==="1"?void 0:"1"}});break}case 68:{m.stopPropagation(),C.value=!0;break}}});const H=m=>{var D;(D=document.querySelector(".source-context, .table-context"))!=null&&D.contains(m.target)||i("main")};xt(ia,{setMenuContext:i,duplicateTable:M,openRenameTableDialog:p,openViewDescriptionDialog:u,openTableDescriptionDialog:h,contextMenuTarget:x}),ss(document,"contextmenu",H,!0);const Y=()=>{var D;const m=document.querySelector(`.nc-treeview [data-table-id="${(D=n.value)==null?void 0:D.id}"]`);m&&(m==null||m.scrollIntoView({behavior:"smooth",block:"nearest"}))},q=async m=>{var ye,G;const{moved:{newIndex:D=0,oldIndex:R=0,element:z}}=m;if(!(z!=null&&z.id))return;let ne;k.value.length-1===D?ne=Math.max(...k.value.map(Q=>(Q==null?void 0:Q.order)??0))+1:D===0?ne=Math.min(...k.value.map(Q=>(Q==null?void 0:Q.order)??0))/2:ne=(parseFloat(String(((ye=k.value[D-1])==null?void 0:ye.order)??0))+parseFloat(String(((G=k.value[D+1])==null?void 0:G.order)??0)))/2;const de=isNaN(Number(ne))?R:ne;await B(z.id,{order:de}),d("a:base:reorder")};return Je(()=>{var m;return(m=n.value)==null?void 0:m.id},()=>{var m;(m=n.value)!=null&&m.id&&setTimeout(()=>{Y()},1e3)},{immediate:!0}),Je(s,()=>{const m=document.querySelector(`.nc-treeview [data-base-id="${s.value}"]`);m&&yi(m)&&(m==null||m.scrollIntoView({behavior:"smooth"}))},{immediate:!0}),(m,D)=>{var de,ye;const R=di,z=_i,ne=ja;return t(),V("div",wi,[e(w)?E("",!0):(t(),V("div",xi,y(m.$t("objects.projects")),1)),v("div",ki,[(de=e(k))!=null&&de.length?(t(),V("div",hi,[a(e(Io),{"model-value":e(k),disabled:e(O)||!e(P)("baseReorder")||((ye=e(k))==null?void 0:ye.length)<2,"item-key":"id",handle:".base-title-node","ghost-class":"ghost",onChange:D[0]||(D[0]=G=>q(G))},{item:o(({element:G})=>[(t(),V("div",{key:G.id},[a(gi,{"base-role":G.project_role,base:G},{default:o(()=>[a(R)]),_:2},1032,["base-role","base"])]))]),_:1},8,["model-value","disabled"])])):e(T)?E("",!0):(t(),f(z,{key:1}))]),a(ne,{modelValue:e(C),"onUpdate:modelValue":D[1]||(D[1]=G=>le(C)?C.value=G:null)},null,8,["modelValue"])])}}}),Ii=Oe($i,[["__scopeId","data-v-d7c427dd"]]),Ti=""+new URL("giftCard.CTBuIrB_.svg",import.meta.url).href,pa=c=>(na("data-v-b7d729ea"),c=c(),la(),c),Di={class:"wrapper"},Ci={class:"header"},Si=pa(()=>v("h4",null,"Gifts Unlocked!",-1)),Vi=pa(()=>v("div",{class:"body"},"We are giving away $100 worth of amazon coupons to our pro open source users!",-1)),ji={key:0,class:"img-wrapper"},Mi=pa(()=>v("img",{src:Ti},null,-1)),Pi=[Mi],Ei=pa(()=>v("div",{class:"mt-1 text-sm"},"Do you want to remind later on your next visit?",-1)),Ni={class:"flex justify-end mt-7 gap-x-2"},Bi=pe({__name:"Gift",setup(c){const{appInfo:P,giftBannerDismissedCount:d,user:r}=De(),{$e:l}=Ne(),_=I(!0),N=I(!1),B=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)<780,j=ae(()=>{var g,w;return((g=r.value)==null?void 0:g.email)&&!/^[a-zA-Z0-9._%+-]+@(gmail|yahoo|hotmail|outlook|aol|icloud|qq|163|126|sina|nocodb)(\.com)?$/i.test((w=r.value)==null?void 0:w.email)&&(!d.value||d.value<5)});d.value?setTimeout(()=>{_.value=!1},d.value*6e4):_.value=!1;const k=()=>{var g;d.value++,l("a:claim:gift:coupon"),window.open((g=P.value)==null?void 0:g.giftUrl,"_blank","noopener,noreferrer")},s=()=>{!d.value||d.value<4?N.value=!0:(_.value=!0,d.value++)},T=()=>{_.value=!0,d.value=5,N.value=!1},C=()=>{_.value=!0,d.value++,N.value=!1};return(g,w)=>{const L=We,n=Ue,O=ca;return e(j)&&!e(_)&&e(P).giftUrl?(t(),V("div",{key:0,class:"container",onClick:k},[v("div",Di,[v("div",Ci,[a(L,{class:"icon",icon:"gift",size:"xlarge"}),Si]),Vi]),!B&&!e(d)?(t(),V("div",ji,Pi)):E("",!0),a(n,{type:"text",size:"small",class:"close-icon",onClick:ve(s,["stop"])},{default:o(()=>[a(L,{icon:"close",size:"xlarge"})]),_:1}),a(O,{visible:e(N),"onUpdate:visible":w[0]||(w[0]=x=>le(N)?N.value=x:null),size:"small"},{default:o(()=>[v("div",null,[Ei,v("div",Ni,[a(n,{type:"secondary",size:"small",onClick:T},{default:o(()=>[K(" Dont show again ")]),_:1}),a(n,{type:"primary",size:"small",onClick:C},{default:o(()=>[K(" Yes ")]),_:1})])])]),_:1},8,["visible"])])):E("",!0)}}}),Li=Oe(Bi,[["__scopeId","data-v-b7d729ea"]]),Oi={};function Ui(c,P){return t(),V("span")}const Ri=Oe(Oi,[["render",Ui]]),Ai={};function zi(c,P){return t(),V("span")}const Gi=Oe(Ai,[["render",zi]]),Fi=ht(()=>$t(()=>import("./Dxayr4Dn.js"),__vite__mapDeps([12,1,2]),import.meta.url).then(c=>c.default||c)),Wi=ht(()=>$t(()=>import("./BtNrnrmS.js"),__vite__mapDeps([13,14,1,2]),import.meta.url).then(c=>c.default||c)),Ki=ht(()=>$t(()=>import("./Dsa3ljIC.js"),__vite__mapDeps([15,16,1,2,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url).then(c=>c.default||c)),Hi=c=>(na("data-v-400916d9"),c=c(),la(),c),qi={class:"flex w-full flex-col py-0.9 px-1 border-gray-200 gap-y-1"},Ji={class:"flex items-center pr-2 justify-between"},Yi={class:"flex flex-row py-1 px-3 gap-x-2 items-center hover:bg-gray-200 rounded-lg cursor-pointer h-8","data-testid":"nc-sidebar-userinfo"},Qi={class:"flex max-w-32 truncate"},Zi={class:"flex gap-2 items-center"},Xi={class:"menu-btn"},er={class:"flex gap-2 items-center"},tr={class:"flex items-center text-gray-400 text-xs"},ar=Hi(()=>v("div",{class:"flex-1"},null,-1)),sr={class:"bg-white max-h-50vh scrollbar-thin-dull min-w-64 !overflow-auto"},or={href:"https://docs.nocodb.com",target:"_blank",class:"!underline-transparent",rel:"noopener"},nr={class:"menu-btn"},lr=pe({__name:"UserInfo",setup(c){const{user:P,signOut:d,appInfo:r}=De();bo();const{leftSidebarState:l}=te(ra()),_=ae(()=>{var w,L;return(L=(w=P.value)==null?void 0:w.display_name)==null?void 0:L.trim()}),N=I(!1),B=I(!1),j=I(!1),{isMobileMode:k}=De(),{isUIAllowed:s}=ze(),T=async()=>{var w;j.value=!0;try{const L=!!((w=P==null?void 0:P.value)!=null&&w.sso_client_id);await d(!1),await Gt(L?"/sso":"/signin")}catch(L){console.error(L)}finally{j.value=!1}};Je(N,()=>{B.value&&(B.value=!1)}),Je(l,()=>{l.value==="peekCloseEnd"&&(N.value=!1)});const C=I(!1);jt(()=>{C.value=!0});const g=ae(()=>s("superAdminSetup")&&!et?"/account/setup":"/account/profile");return(w,L)=>{const n=Fi,O=To,x=Wt,i=We,u=ka,h=qt,p=Sa,A=to,M=Wi,W=Co,H=Gi,Y=Do,q=da,m=Jt,D=Ki,R=Fe("e");return t(),V("div",qi,[a(n),v("div",Ji,[a(m,{visible:e(N),"onUpdate:visible":L[0]||(L[0]=z=>le(N)?N.value=z:null),placement:"topLeft","overlay-class-name":"!min-w-64"},{overlay:o(()=>[a(q,{"data-testid":"nc-sidebar-userinfo"},{default:o(()=>[a(h,{"data-testid":"nc-sidebar-user-logout",onClick:T},{default:o(()=>[Z((t(),V("div",Zi,[e(j)?(t(),f(u,{key:0,class:"!ml-0.5 !mr-0.5 !max-h-4.5 !-mt-0.5"})):(t(),f(i,{key:1,icon:"signout",class:"menu-icon"})),v("span",Xi,y(w.$t("general.logout")),1)])),[[R,["c:user:logout"]]])]),_:1}),a(p),e(r).ee?E("",!0):(t(),V(_e,{key:0},[a(p),a(W,{key:"language",class:"lang-menu !py-1.5",placement:"rightBottom"},{content:o(()=>[v("div",sr,[a(M)])]),default:o(()=>[a(h,null,{default:o(()=>[Z((t(),V("div",er,[a(i,{icon:"translate",class:"group-hover:text-black nc-language ml-0.25 menu-icon"}),K(" "+y(w.$t("labels.language"))+" ",1),v("div",tr,y(w.$t("labels.community.communityTranslated")),1),ar,a(A,{class:"transform group-hover:scale-115 group-hover:text-accent text-xl text-gray-400"})])),[[R,["c:translate:open"]]])]),_:1})]),_:1})],64)),e(k)?E("",!0):(t(),V(_e,{key:1},[a(p),Z((t(),V("a",or,[a(h,null,{default:o(()=>[a(i,{icon:"file",class:"menu-icon mt-0.5"}),v("span",nr,y(w.$t("title.docs")),1)]),_:1})])),[[R,["c:nocodb:docs-open"]]]),a(p),("isEeUI"in w?w.isEeUI:e(et))?(t(),f(H,{key:0})):E("",!0),Z((t(),f(Y,{class:"!no-underline",to:e(g)},{default:o(()=>[a(h,null,{default:o(()=>[a(i,{icon:"ncSettings",class:"menu-icon"}),K(" "+y(w.$t("title.accountSettings")),1)]),_:1})]),_:1},8,["to"])),[[R,["c:user:settings"]]])],64))]),_:1})]),default:o(()=>{var z,ne;return[v("div",Yi,[a(O,{email:(z=e(P))==null?void 0:z.email,size:"auto",name:(ne=e(P))==null?void 0:ne.display_name},null,8,["email","name"]),a(x,null,{title:o(()=>{var de;return[v("span",null,y(e(_)?e(_):(de=e(P))==null?void 0:de.email),1)]}),default:o(()=>{var de;return[v("div",Qi,y(e(_)?e(_):(de=e(P))==null?void 0:de.email),1)]}),_:1}),a(i,{icon:"chevronDown",class:"flex-none !min-w-5 transform rotate-180 !text-gray-500"})])]}),_:1},8,["visible"]),a(D)]),e(k)||e(r).ee?(t(),V(_e,{key:0},[],64)):E("",!0)])}}}),ir=Oe(lr,[["__scopeId","data-v-400916d9"]]),rr=c=>(na("data-v-932d781e"),c=c(),la(),c),cr={class:"nc-sidebar flex flex-col bg-gray-50 outline-r-1 outline-gray-100 select-none w-full h-full",style:{outlineWidth:"1px"}},dr={class:"flex flex-col"},ur={key:0,class:"flex-none overflow-auto"},pr=rr(()=>v("div",{class:"border-t-1 w-full"},null,-1)),mr=pe({__name:"Sidebar",setup(c){const P=pt(),{isWorkspaceLoading:d}=te(P),{isSharedBase:r}=te(Ge()),{isMobileMode:l}=De(),_=I(),N=I(!1),B=()=>{if(!l.value)return _.value&&(_.value.scrollTop>0?N.value=!0:N.value=!1),!1};return jt(()=>{var j;(j=_.value)==null||j.addEventListener("scroll",B)}),ao(()=>{var j;(j=_.value)==null||j.removeEventListener("scroll",B)}),(j,k)=>{const s=Ao,T=tn,C=Ii,g=Li,w=Ri,L=ir;return t(),V("div",cr,[v("div",dr,[a(s),e(r)?E("",!0):(t(),f(T,{key:0}))]),v("div",{ref_key:"treeViewDom",ref:_,class:ee(["flex flex-col nc-scrollbar-dark-md flex-grow xs:border-transparent xs:pt-2 xs:pr-2",{"border-t-1":!e(r),"border-transparent":!e(N),"pt-0.25":e(r)}])},[e(d)?E("",!0):(t(),f(C,{key:0}))],2),e(r)?E("",!0):(t(),V("div",ur,[("isEeUI"in j?j.isEeUI:e(et))?E("",!0):(t(),f(g,{key:0})),pr,a(w),a(L)]))])}}}),vr=Oe(mr,[["__scopeId","data-v-932d781e"]]),fr={class:"prose-xl font-bold self-center"},br=v("div",{class:"my-4"},"Select workspace to duplicate shared base to:",-1),_r={class:"prose-md self-center text-gray-500 mt-4"},yr={class:"text-xs p-2"},gr={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},wr=pe({__name:"SharedBaseDuplicate",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(c,{emit:P}){const d=c,r=P,{api:l}=Kt(),{sharedBaseId:_}=_s(),N=pt(),{populateWorkspace:B}=N,{workspacesList:j}=te(N),{ncNavigateTo:k}=De(),s=Ye(d,"modelValue",r),T=I({includeData:!0,includeViews:!0}),C=ae(()=>{const{includeData:i,includeViews:u}=T.value;return{excludeData:!i,excludeViews:!u}}),g=I(!1),w=I(),{$e:L,$poller:n}=Ne(),O=async()=>{if(!(!w.value&&et))try{g.value=!0;const i=await l.base.duplicateShared(w.value??"nc",_.value,{options:C.value,base:et?{fk_workspace_id:w.value,type:so.DATABASE}:{}});_.value=null,n.subscribe({id:i.id},async u=>{u.status!=="close"&&(u.status===Vt.COMPLETED?(console.log("job completed",i),await k({...et?{workspaceId:i.fk_workspace_id}:{},baseId:i.base_id}),g.value=!1,s.value=!1):u.status===Vt.FAILED&&(ue.error("Failed to duplicate shared base"),await B(),g.value=!1,s.value=!1))}),L("a:base:duplicate-shared-base")}catch(i){ue.error(await Pe(i)),g.value=!1,s.value=!1}},x=ae(()=>{var i;return(i=j.value)==null?void 0:i.filter(u=>u.roles===os.OWNER||u.roles===os.CREATOR).map(u=>({label:`${u.title[0].toUpperCase()}${u.title.slice(1)}`,value:u.id}))});return(i,u)=>{const h=So,p=Ca,A=Da,M=Ue,W=Pt,H=Fe("e");return t(),f(W,{visible:e(s),"onUpdate:visible":u[4]||(u[4]=Y=>le(s)?s.value=Y:null),class:"!w-[30rem]","wrap-class-name":"nc-modal-project-duplicate"},{default:o(()=>[v("div",null,[v("div",fr,y(i.$t("general.duplicate"))+" "+y(i.$t("labels.sharedBase")),1),("isEeUI"in i?i.isEeUI:e(et))?(t(),V(_e,{key:0},[br,a(h,{value:e(w),"onUpdate:value":u[0]||(u[0]=Y=>le(w)?w.value=Y:null),class:"w-full",options:e(x),placeholder:"Select Workspace"},null,8,["value","options"])],64)):E("",!0),v("div",_r,y(i.$t("title.advancedSettings")),1),a(p,{class:"!m-0 !p-0 !my-2"}),v("div",yr,[a(A,{checked:e(T).includeData,"onUpdate:checked":u[1]||(u[1]=Y=>e(T).includeData=Y)},{default:o(()=>[K(y(i.$t("labels.includeData")),1)]),_:1},8,["checked"]),a(A,{checked:e(T).includeViews,"onUpdate:checked":u[2]||(u[2]=Y=>e(T).includeViews=Y)},{default:o(()=>[K(y(i.$t("labels.includeView")),1)]),_:1},8,["checked"])])]),v("div",gr,[a(M,{key:"back",type:"secondary",onClick:u[3]||(u[3]=Y=>s.value=!1)},{default:o(()=>[K(y(i.$t("general.cancel")),1)]),_:1}),Z((t(),f(M,{key:"submit",loading:e(g),disabled:!e(w)&&("isEeUI"in i?i.isEeUI:e(et)),onClick:O},{default:o(()=>[K(y(i.$t("general.confirm")),1)]),_:1},8,["loading","disabled"])),[[H,["a:shared-base:duplicate"]]])])]),_:1},8,["visible"])}}}),xr=ht(()=>$t(()=>import("./kC1vA9nq.js"),__vite__mapDeps([32,1,2,8,9,10,33,34,35]),import.meta.url).then(c=>c.default||c)),Nc=pe({__name:"index",setup(c){const P=I(!1),d=I(""),r=I(""),l=I(),_=at(),{populateWorkspace:N}=pt(),{signedIn:B}=De(),{isUIAllowed:j}=ze(),s=$a().currentRoute,{basesList:T}=te(_),C=async()=>{const i=s.value.name;i!=="index-typeOrId"&&i!=="index"||await _.navigateToProject({baseId:T.value[0].id})},g=ae(()=>{const i=s.value.name||"";return!i.startsWith("index-typeOrId-baseId-")&&!["index","index-typeOrId","index-typeOrId-integrations"].includes(i)}),w=ae(()=>(s.value.name||"").startsWith("index-typeOrId-form-viewId")),{sharedBaseId:L}=_s(),n=I(!1);async function O(){if(!g.value){if(s.value.params.typeOrId==="base"){await N();return}if(!B.value){Gt("/signIn");return}await N(),!s.value.params.baseId&&T.value.length>0&&await C()}}Je(()=>s.value.params.typeOrId,()=>{O()}),jt(()=>{O().then(()=>{if(L.value){if(!j("baseDuplicate")){ue.error("You are not allowed to create base");return}n.value=!0}})});function x(i,u,h,p){P.value=i??!P.value,d.value=u||"",r.value=h||"",l.value=p||""}return xt(ps,x),(i,u)=>{const h=oo,p=no,A=vr,M=xr,W=wr;return t(),V("div",null,[e(w)?(t(),f(p,{key:0},{default:o(()=>[a(h)]),_:1})):e(g)?(t(),f(p,{key:1,name:"shared-view"},{default:o(()=>[a(h)]),_:1})):(t(),f(p,{key:2,name:"dashboard"},{sidebar:o(()=>[a(A)]),content:o(()=>[a(h)]),_:1})),a(M,{"model-value":e(P),"onUpdate:modelValue":u[0]||(u[0]=H=>le(P)?P.value=H:null),"open-key":e(d),"onUpdate:openKey":u[1]||(u[1]=H=>le(d)?d.value=H:null),"data-sources-state":e(r),"onUpdate:dataSourcesState":u[2]||(u[2]=H=>le(r)?r.value=H:null),"base-id":e(l)},null,8,["model-value","open-key","data-sources-state","base-id"]),e(j)("baseDuplicate")?(t(),f(W,{key:3,modelValue:e(n),"onUpdate:modelValue":u[3]||(u[3]=H=>le(n)?n.value=H:null)},null,8,["modelValue"])):E("",!0)])}}});export{Nc as default};
