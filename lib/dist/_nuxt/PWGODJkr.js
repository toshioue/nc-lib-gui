import{f as N,r as E,gg as T,H as A,g2 as V,iM as I,l as P,o as a,c as i,P as t,S as x,w as m,d as r,t as s,b as h,T as M,a as p,V as D,W as z,aq as B,av as Z,U as W,aa as S,$ as O,a0 as q,a1 as G}from"./Cgw6cdOy.js";import{a as H}from"./CEBaEII4.js";import{u as J}from"./DWwIKYJw.js";import"./C9Sjn86N.js";import"./zKWQxcjd.js";import"./DFiWgQ57.js";import"./CO8XXsKl.js";import"./BcWX645D.js";import"./r2PN1Hfg.js";import"./vIgbYHAs.js";import"./DpDIhxXu.js";import"./boyBAVNN.js";import"./D7yS5JAk.js";import"./BtFqRdSP.js";import"./CnN16FGu.js";import"./C00NHga8.js";import"./BBXMuneh.js";import"./DbRkwnd8.js";import"./S1x-kZdE.js";import"./Bcy-XIkn.js";import"./DPaOlBFV.js";import"./BQQOEPN4.js";import"./hvq8FVej.js";import"./C8c9012h.js";import"./BIsWr_mR.js";import"./BZz6iAla.js";import"./DpYA1Dpy.js";import"./dmcxUY_0.js";import"./BcZAlRJW.js";import"./LSbsNkd9.js";import"./C0-Qcoum.js";const K=async v=>!v.type.startsWith("image/")&&!v.type.startsWith("video/")?null:new Promise((g,w)=>{const k=new FileReader;k.onload=function(o){var F;const _=(F=o.target)==null?void 0:F.result;if(v.type.startsWith("image/")){const n=new Image;n.onload=function(){const c=document.createElement("canvas"),f=c.getContext("2d");if(!f)return g(null);const u=200,b=u/n.width,y=n.height*b;c.width=u,c.height=y,f.drawImage(n,0,0,u,y);const $=c.toDataURL("image/png");g($)},n.onerror=function(){console.error("Error loading image"),w(null)},n.src=_}else if(v.type.startsWith("video/")){const n=document.createElement("video");n.onloadedmetadata=function(){n.currentTime=1},n.onseeked=function(){const c=document.createElement("canvas"),f=c.getContext("2d");if(!f)return g(null);const u=200,b=u/n.videoWidth,y=n.videoHeight*b;c.width=u,c.height=y,f.drawImage(n,0,0,u,y);const $=c.toDataURL("image/png");g($)},n.onerror=function(){console.error("Error loading video"),w(null)},n.src=_}else g(null)},k.onerror=function(){console.error("Error reading file"),w(null)},k.readAsDataURL(v)}),Q={key:1,class:"flex w-full border-b-1 py-1 h-9.5 items-center justify-between top-0"},X={class:"text-xs"},Y={class:"flex gap-1 items-center"},ee={key:0,class:"flex cursor-pointer items-center justify-center flex-col gap-4"},te={class:"font-semibold text-brand-500"},oe={class:"font-semibold"},se={class:"text-brand-500 font-bold"},ae={key:1,class:"grid overflow-y-auto flex-grow-1 nc-scrollbar-md grid-cols-4 w-full h-full items-start py-2 justify-center gap-4"},ne={key:0,style:{height:"140px"},class:"flex items-center justify-center rounded-md bg-gray-300"},le=["src"],ie={class:"relative text-[12px] font-semibold items-center text-gray-800 flex"},re={class:"flex-none hide-ui transition-all transition-ease-in-out !h-4 flex items-center bg-white"},ce={class:"flex-none text-[10px] font-semibold text-gray-500"},de={key:2,class:"flex gap-2 pt-2 bg-white w-full items-center justify-end"},Ie=N({__name:"Local",emits:["update:visible","upload"],setup(v,{emit:g}){const w=g,k=E(),o=E([]),{isLoading:_}=J(),{files:F,open:n}=T({reset:!0});A(F,e=>{e&&Object.values(e).forEach(l=>{o.value.push(l)})});const c=(e,l)=>{o.value.push(...e),l.preventDefault(),l.stopPropagation()},f=V(async()=>{const e=new Map;return await Promise.all(o.value.map(async l=>{const R=await K(l);R&&e.set(l,R)})),e}),u=e=>{o.value=o.value.filter(l=>l!==e)},{isOverDropZone:b}=I(k,c),y=()=>{o.value=[]},$=()=>{n()},U=()=>{w("update:visible",!1)};return P(()=>{o.value=[]}),(e,l)=>{const R=O,C=q,L=G;return a(),i("div",{class:W([{"flex flex-col relative justify-center items-center":!t(o).length},"w-full p-2 h-full"])},[t(o).length===0?(a(),x(L,{key:0,class:"absolute top-3 right-3"},{title:m(()=>[r(s(e.$t("general.close")),1)]),default:m(()=>[h(C,{type:"text",class:"!border-0",size:"xsmall",onClick:U},{default:m(()=>[h(R,{icon:"close"})]),_:1})]),_:1})):M("",!0),t(o).length>0?(a(),i("div",Q,[h(C,{type:"text",size:"small",onClick:y},{default:m(()=>[r(s(e.$t("labels.clearAllFiles")),1)]),_:1}),p("span",X,s(t(o).length)+" files, total size: "+s(("formatBytes"in e?e.formatBytes:t(H))(t(o).reduce((d,j)=>d+j.size,0),0)),1),h(C,{type:"text",size:"small",onClick:$},{default:m(()=>[p("div",Y,[(a(),x(D(("iconMap"in e?e.iconMap:t(z)).plus))),r(" "+s(e.$t("labels.addMore")),1)])]),_:1})])):M("",!0),p("div",{ref_key:"dropZoneRef",ref:k,class:W([{"border-brand-500":t(b),"border-dashed border-2":!t(o).length},"flex flex-col items-center justify-center h-full w-full flex-grow-1 rounded-lg"]),"data-testid":"attachment-drop-zone",style:S(`height: ${t(o).length>0?"324px":"100%"}`),onClick:l[0]||(l[0]=d=>t(o).length>0?()=>{}:$())},[t(o).length?(a(),i("div",ae,[(a(!0),i(B,null,Z(t(o),d=>(a(),i("div",{key:d.name,class:"flex gap-1.5 group min-w-34 max-w-28 pb-4 flex-col relative"},[t(f).get(d)?(a(),i("img",{key:1,src:t(f).get(d),style:{height:"140px"},alt:"thumbnail",class:"rounded-md object-cover"},null,8,le)):(a(),i("div",ne,[(a(),x(D(("iconMap"in e?e.iconMap:t(z)).file),{class:"w-16 h-16"}))])),p("div",ie,[h(L,{class:"flex-auto truncate",placement:"bottom"},{title:m(()=>[r(s(d.name),1)]),default:m(()=>[r(" "+s(d.name),1)]),_:2},1024),p("div",re,[h(L,{placement:"bottom"},{title:m(()=>[r(s(e.$t("title.removeFile")),1)]),default:m(()=>[(a(),x(D(("iconMap"in e?e.iconMap:t(z)).delete),{class:"!text-red-500 w-3 h-3 cursor-pointer",onClick:j=>u(d)},null,8,["onClick"]))]),_:2},1024)])]),p("div",ce,s(("formatBytes"in e?e.formatBytes:t(H))(d.size,0)),1)]))),128))])):(a(),i("div",ee,[t(b)?M("",!0):(a(),i(B,{key:0},[(a(),x(D(("iconMap"in e?e.iconMap:t(z)).upload),{class:"w-8 h-8 text-gray-500"})),p("h1",null,[r(s(e.$t("labels.clickTo"))+" ",1),p("span",te,s(e.$t("labels.browseFiles")),1),r(" "+s(e.$t("general.or"))+" ",1),p("span",oe,s(e.$t("labels.dragFilesHere")),1),r(" "+s(e.$t("labels.toUpload")),1)])],64)),t(b)?(a(),i(B,{key:1},[(a(),x(D(("iconMap"in e?e.iconMap:t(z)).upload),{class:"w-8 text-brand-500 h-8"})),p("h1",se,s(e.$t("labels.dropHere")),1)],64)):M("",!0)]))],6),t(o).length?(a(),i("div",de,[h(C,{disabled:t(_),type:"secondary",size:"small",onClick:U},{default:m(()=>[r(s(e.$t("labels.cancel")),1)]),_:1},8,["disabled"]),h(C,{loading:t(_),"data-testid":"nc-upload-file",size:"small",onClick:l[1]||(l[1]=d=>w("upload",t(o)))},{default:m(()=>[t(_)?(a(),i(B,{key:0},[r(s(e.$t("labels.uploading")),1)],64)):(a(),i(B,{key:1},[r(s(e.$t("general.upload"))+" "+s(t(o).length)+" "+s(e.$t("objects.files")),1)],64))]),_:1},8,["loading"])])):M("",!0)],2)}}});export{Ie as default};
