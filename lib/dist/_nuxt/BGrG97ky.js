import{_ as xe}from"./DnwRMKX3.js";import{e as ke,L as Ce,bL as b,d7 as Ie,g2 as Se,hK as Ae,r as k,aC as Re,aA as $e,ay as Me,cL as Le,ax as oe,f as I,aD as Ee,h_ as je,i1 as Be,i4 as Ve,J as Ue,dc as D,F as ne,il as ze,g as Te,cA as He,aE as Ke,o as u,c as _,N as a,Q as V,w as m,ao as U,at as G,T as ie,S as p,b as x,a as y,a8 as T,dg as S,d as J,t as A,R as N,O as re,m as De,W as ce,$ as Ne,Y as qe,ds as Oe,_ as Pe}from"./DZZ6t_j4.js";import{u as de}from"./EqBqqo9-.js";import{B as Fe}from"./C4K5fdHe.js";import{M as Ge}from"./DO2z7KR_.js";import{C as Je,a as Qe}from"./DNgdBwTe.js";import{R as We,_ as Ye}from"./CFvUUxCy.js";import{T as Xe}from"./DKoVb009.js";import{S as Ze,_ as ea}from"./D_MsYLkT.js";import"./eX8_g88K.js";import"./vll-Pnjv.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";const aa={key:0,class:"w-full max-w-full"},la={class:"flex-none"},sa={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},ta=ke({__name:"User",props:{modelValue:{},rowIndex:{},location:{},forceMulti:{type:Boolean}},emits:["update:modelValue"],setup(Q,{emit:ue}){const W=ue,{isMobileMode:me}=Ce(),Y=b(Ie),w=b(Se),H=b(Ae),X=b(Re,k(!1)),Z=b($e,k(!1)),fe=Me(),pe=Le(),{basesUser:ve}=oe(fe),{idUserMap:ye}=oe(pe),ee=I(()=>Y.value.base_id?ve.value.get(Y.value.base_id)||[]:[]),K=I(()=>Z.value||X.value),q=b(Ee,k(!1)),O=b(je,k(!1)),M=I(()=>{var e;return Q.forceMulti||((e=w.value.meta)==null?void 0:e.is_multi)}),R=b(Be,k(void 0)),L=k(),c=k(!1),E=b(Ve,k(!1)),ae=k(),{isUIAllowed:we}=Ue(),j=I(()=>{var o,r,d;let e=1;const l=(((o=D(w.value.meta))==null?void 0:o.limitOptions)||[]).reduce((n,i)=>(e<((i==null?void 0:i.order)??0)&&(e=i.order),{...n,[i.id]:i}),{})??{},t=[];return!O.value&&q.value&&((r=D(w.value.meta))!=null&&r.isLimitOption)&&(((d=D(w.value.meta))==null?void 0:d.limitOptions)||[]).length?t.push(...(ee.value||[]).filter(n=>{var i,z;return((i=l[n.id])==null?void 0:i.show)!==void 0?(z=l[n.id])==null?void 0:z.show:!1}).map(n=>{var i;return{id:n.id,email:n.email,display_name:n.display_name,deleted:n.deleted,order:n.id&&l[n.id]?((i=l[n.id])==null?void 0:i.order)??n.order:e++}}).sort((n,i)=>n.order-i.order)):t.push(...(ee.value||[]).map(n=>({id:n.id,email:n.email,display_name:n.display_name,deleted:n.deleted,order:e++})).sort((n,i)=>n.order-i.order)),t}),le=I(()=>we("dataEdit")),g=I(()=>(le.value||q.value)&&K.value),h=I({get:()=>{let e=[],l=Q.modelValue;if(typeof l=="string"&&/^\s*[{[]/.test(l))try{l=JSON.parse(l)}catch{}return typeof l=="string"?e=l.split(",").map(o=>o.trim()).reduce((o,r)=>{const d=j.value.find(n=>n.id===r||n.email===r);return d&&o.push({label:(d==null?void 0:d.display_name)||(d==null?void 0:d.email),value:d.id}),o},[]):e=l?(Array.isArray(l)?l:[l]).reduce((t,o)=>{const r=(o==null?void 0:o.display_name)||(o==null?void 0:o.email);return r&&t.push({label:r,value:o.id}),t},[]):[],e},set:e=>{const l=[];e&&e.length&&e.forEach(t=>{const o=j.value.find(r=>r.id===t);o&&l.push(o.id)}),M.value?W("update:modelValue",e!=null&&e.length?l.join(","):null):(W("update:modelValue",e!=null&&e.length?l[l.length-1]:null),c.value=!1)}}),P=I(()=>{var e,l;return M.value?(h.value||[]).map(t=>t.value):((l=(e=h.value||[])==null?void 0:e[0])==null?void 0:l.value)||""});ne(c,(e,l)=>{var t,o,r,d,n,i;e||(ae.value=""),g.value&&(e?(i=(n=(d=L.value)==null?void 0:d.$el)==null?void 0:n.querySelector("input"))==null||i.focus():(r=(o=(t=L.value)==null?void 0:t.$el)==null?void 0:o.querySelector("input"))==null||r.blur())}),ne(K,(e,l)=>{e||(c.value=!1)}),de(Z,e=>{var l;switch(e.key){case"Escape":c.value=!1;break;case"Enter":g.value&&K.value&&!c.value&&(c.value=!0);break;case" ":break;case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":case"Delete":break;default:if(!g.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)&&((l=e.key)==null?void 0:l.length)===1&&!Oe()&&(e.stopPropagation(),c.value=!0);break}}),de(c,e=>{e.key==="Escape"&&(c.value=!1)});const ge=()=>{var e,l,t;ae.value=(t=(l=(e=L.value)==null?void 0:e.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:t.value},he=(e,l)=>{var t,o;((t=e.target)!=null&&t.classList.contains("ant-tag-close-icon")||(o=e.target)!=null&&o.closest(".ant-tag-close-icon"))&&(e.stopPropagation(),l())},$=b(ze,null),be=()=>{$||(c.value=g.value&&!c.value)},se=()=>{c.value=g.value&&!c.value};Te(()=>{$==null||$.on(se)}),He(()=>{$==null||$.on(se)}),Ke(document,"click",e=>{var l;c.value&&L.value&&!L.value.$el.contains(e.target)&&!((l=document.querySelector(".nc-dropdown-user-select-cell.active"))!=null&&l.contains(e.target))&&(X.value=!1,c.value=!1)},!0);const _e=(e,l)=>{const t=j.value.find(r=>r.id===l.value),o=(t==null?void 0:t.display_name)||(t==null?void 0:t.email);if(o)return o.toLowerCase().includes(e.toLowerCase())},B=e=>{var l,t;return!((t=(l=ye.value)==null?void 0:l[e])!=null&&t.deleted)};return(e,l)=>{var z;const t=xe,o=Ne,r=Xe,d=qe,n=Ze,i=ea;return u(),_("div",{class:p(["nc-cell-field nc-user-select h-full w-full flex items-center",{"read-only":a(H)}]),onClick:be},[!a(O)&&a(q)&&((z=("parseProp"in e?e.parseProp:a(D))(a(w).meta))!=null&&z.isList)?(u(),_("div",aa,[(u(),V(ie(a(M)?a(Qe):a(Ye)),{value:a(P),"onUpdate:value":[l[0]||(l[0]=s=>re(P)?P.value=s:null),l[1]||(l[1]=s=>{h.value=a(M)?s:[s]})],disabled:a(H)||!a(g),class:"nc-field-layout-list"},{default:m(()=>[(u(!0),_(U,null,G(a(j),s=>(u(),_(U,{key:s.id||s.email},[s.deleted?N("",!0):(u(),V(ie(a(M)?a(Je):a(We)),{key:s.id||s.email,value:s.id,"data-testid":`select-option-${a(w).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:p(`nc-select-option-${a(w).title}-${s.email}`)},{default:m(()=>[x(r,{class:"rounded-tag max-w-full !pl-0",color:"'#ccc'"},{default:m(()=>{var v,C;return[y("span",{style:T({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"flex items-stretch gap-2 text-small"},[y("div",null,[x(t,{size:"auto",name:(v=s.display_name)!=null&&v.trim()?(C=s.display_name)==null?void 0:C.trim():"",email:s.email,class:"!text-[0.65rem]",disabled:!B(s.id)},null,8,["name","email","disabled"])]),x(o,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>{var f;return[J(A(((f=s.display_name)==null?void 0:f.trim())||s.email),1)]}),default:m(()=>{var f;return[y("span",{class:p(["text-ellipsis overflow-hidden",{"text-gray-600":!B(s.id||s.email)}]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},A(((f=s.display_name)==null?void 0:f.trim())||s.email),3)]}),_:2},1024)],4)]}),_:2},1024)]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},40,["value","disabled"])),!a(M)&&a(h).length?(u(),_("div",{key:0,class:"inline-block px-2 pt-2 cursor-pointer text-xs text-gray-500 hover:text-gray-800",onClick:l[2]||(l[2]=s=>h.value=[])},A(e.$t("labels.clearSelection")),1)):N("",!0)])):(u(),_(U,{key:1},[a(K)?(u(),V(i,{key:1,ref_key:"aselect",ref:L,value:a(h),"onUpdate:value":l[4]||(l[4]=s=>re(h)?h.value=s:null),mode:"multiple",class:p(["w-full overflow-hidden",{"caret-transparent":!a(le)}]),placeholder:a(O)?e.$t("labels.optional"):"",bordered:!1,"clear-icon":"","show-search":!a(me),"show-arrow":a(g)&&!a(H),open:a(c)&&a(g),disabled:a(H)||!a(g),"dropdown-class-name":`nc-dropdown-user-select-cell !min-w-156px ${a(c)?"active":""}`,"filter-option":_e,onSearch:ge,onKeydown:l[5]||(l[5]=ce(()=>{},["stop"]))},{suffixIcon:m(()=>[x(d,{icon:"arrowDown",class:"text-gray-700 nc-select-expand-btn"})]),tagRender:m(({label:s,value:v,onClose:C})=>{var f,te;return[a(j).find(F=>F.id===v)?(u(),V(r,{key:0,class:p(["rounded-tag nc-selected-option !pl-0",{"!my-0":!a(R)||a(R)===1}]),style:{display:"flex",alignItems:"center"},color:"'#ccc'",closable:a(g)&&((((f=a(h))==null?void 0:f.length)??0)>1||!((te=a(w))!=null&&te.rqd)),"close-icon":("h"in e?e.h:a(De))(a(Ge),{class:["ms-close-icon"]}),onClick:F=>he(F,C),onClose:C},{default:m(()=>[y("span",{style:T({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:p(["flex items-stretch gap-2",{"text-sm":a(E),"text-small":!a(E)}])},[y("div",null,[x(t,{size:"auto",name:s!=null&&s.includes("@")?"":s.trim(),email:s,class:"!text-[0.65rem]",disabled:!B(v)},null,8,["name","email","disabled"])]),y("span",{class:p({"text-gray-600":!B(v)})},A(s),3)],6)]),_:2},1032,["class","closable","close-icon","onClick","onClose"])):N("",!0)]}),default:m(()=>[(u(!0),_(U,null,G(a(j),s=>(u(),_(U,{key:s.id||s.email},[s.deleted?N("",!0):(u(),V(n,{key:0,value:s.id,"data-testid":`select-option-${a(w).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:p(`nc-select-option-${a(w).title}-${s.email}`),onClick:l[3]||(l[3]=ce(()=>{},["stop"]))},{default:m(()=>[x(r,{class:p(["rounded-tag max-w-full !pl-0",{"!my-0":!a(R)||a(R)===1}]),color:"'#ccc'"},{default:m(()=>{var v,C;return[y("span",{style:T({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:p(["flex items-stretch gap-2",{"text-sm":a(E),"text-small":!a(E)}])},[y("div",null,[x(t,{size:"auto",name:(v=s.display_name)!=null&&v.trim()?(C=s.display_name)==null?void 0:C.trim():"",email:s.email,class:"!text-[0.65rem]"},null,8,["name","email"])]),x(o,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>{var f;return[J(A(((f=s.display_name)==null?void 0:f.trim())||s.email),1)]}),default:m(()=>{var f;return[y("span",sa,A(((f=s.display_name)==null?void 0:f.trim())||s.email),1)]}),_:2},1024)],6)]}),_:2},1032,["class"])]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},8,["value","placeholder","show-search","show-arrow","open","disabled","class","dropdown-class-name"])):(u(),_("div",{key:0,class:"flex flex-wrap",style:T({display:"-webkit-box","max-width":"100%","-webkit-line-clamp":("rowHeightTruncateLines"in e?e.rowHeightTruncateLines:a(Fe))(a(R)),"-webkit-box-orient":"vertical",overflow:"hidden"})},[(u(!0),_(U,null,G(a(h),s=>(u(),V(r,{key:s.value,class:p(["rounded-tag max-w-full !pl-0",{"!my-0":!a(R)||a(R)===1}]),color:"'#ccc'"},{default:m(()=>{var v;return[y("span",{style:T({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:p(["flex items-stretch gap-2",{"text-sm":a(E),"text-small":!a(E)}])},[y("div",la,[x(t,{disabled:!B(s.value),size:"auto",name:(v=s.label)!=null&&v.includes("@")?"":s.label.trim(),email:s.label,class:"!text-[0.65rem]"},null,8,["disabled","name","email"])]),x(o,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>[J(A(s.label),1)]),default:m(()=>[y("span",{class:p(["text-ellipsis overflow-hidden",{"text-gray-600":!B(s.value)}]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},A(s.label),3)]),_:2},1024)],6)]}),_:2},1032,["class"]))),128))],4))],64))],2)}}}),_a=Pe(ta,[["__scopeId","data-v-5cb3ffc8"]]);export{_a as default};
