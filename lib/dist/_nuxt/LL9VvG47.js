const __vite__fileDeps=["./DxURyUlp.js","./BLdk6lRf.js","./entry.B8GgT5QA.css","./C9Sjn86N.js","./DV47GYLy.js","./CSxPNiqH.js","./PlainCell.BhW7NMdh.css","./CJxwwhO9.js","./RecordCard.BkJXt930.css","./0XsICibf.js","./BPK89SF_.js","./DTl_5Njz.js","./DoWzg9_J.js","./boyBAVNN.js","./CwqgNcWF.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as G,bL as I,r as R,d0 as K,L as Q,h6 as W,g as T,ce as c,P as x,o as w,c as y,al as E,am as $,a8 as X,b as F,w as N,Y as ee,U as te,S as oe,Z as g,a5 as Y}from"./BLdk6lRf.js";import{a as ae}from"./rkXympsO.js";import{a as ne}from"./KocR1J4Z.js";import{j as re,e as b}from"./CwqgNcWF.js";import"./DTl_5Njz.js";import"./BtPl72f0.js";const le=g(()=>Y(()=>import("./DxURyUlp.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(d=>d.default||d)),se=g(()=>Y(()=>import("./CJxwwhO9.js"),__vite__mapDeps([7,1,2,8]),import.meta.url).then(d=>d.default||d)),ie=g(()=>Y(()=>import("./0XsICibf.js"),__vite__mapDeps([9,10,11,1,2,12,5,13,14]),import.meta.url).then(d=>d.default||d)),ce=["onMouseover"],we=G({__name:"DateField",emits:["expandRecord","newRecord"],setup(d,{emit:U}){const V=U,C=I(K,R()),P=R(),{isUIAllowed:z}=Q(),{selectedDate:D,formattedData:v,formattedSideBarData:A,calendarRange:k,updateRowProperty:Z}=ae(),J=I(W,R()),{fields:L}=ne(),q=T(()=>L.value?new Map(L.value.map(o=>[o.fk_column_id,{underline:o.underline,bold:o.bold,italic:o.italic}])):new Map),S=o=>q.value.get(o.id),O=T(()=>{let o=0;const s=28;if(!k.value)return[];const f=[];return k.value.forEach(u=>{const p=u.fk_from_col,e=u.fk_to_col;if(p&&e)for(const a of v.value){const t=c(a.row[p.title]),r=c(a.row[e.title]);o++;const m={top:`${(o-1)*s}px`,width:"100%"};let n="none";const _=i=>i.isSame(D.value,"day"),h=i=>i.isBefore(D.value,"day"),l=i=>i.isAfter(D.value,"day");_(t)&&_(r)?n="rounded":h(t)&&l(r)?n="none":_(t)&&l(r)?n="leftRounded":h(t)&&_(r)?n="rightRounded":n="none",f.push({...a,rowMeta:{...a.rowMeta,position:n,style:m,range:u}})}else if(p)for(const a of v.value)o++,f.push({...a,rowMeta:{...a.rowMeta,range:u,style:{width:"100%",left:"0",top:`${(o-1)*s}px`},position:"rounded"}})}),f}),M=R(null),B=R(null),H=o=>{var f,u,p;if(!z("dataEdit"))return;o.preventDefault();const s=(f=o.dataTransfer)==null?void 0:f.getData("text/plain");if(s){const{record:e}=JSON.parse(s),a=(u=e.rowMeta.range)==null?void 0:u.fk_from_col,t=(p=e.rowMeta.range)==null?void 0:p.fk_to_col;if(!a)return;const r=c(D.value).startOf("day");let m;const n={...e,row:{...e.row,[a.title]:c(r).format("YYYY-MM-DD HH:mm:ssZ")}},_=[a.title];if(t){const l=e.row[a.title]?c(e.row[a.title]):null,i=e.row[t.title]?c(e.row[t.title]):null;l&&i?m=c(r).add(i.diff(l,"day"),"day"):l&&!i?m=c(r).endOf("day"):!l&&i?m=c(r).endOf("day"):m=r.clone(),n.row[t.title]=c(m).format("YYYY-MM-DD HH:mm:ssZ"),_.push(t.title)}if(!n)return;const h=b(n.row,C.value.columns);M.value?v.value=v.value.map(l=>b(l.row,C.value.columns)===h?n:l):(v.value=[...v.value,n],A.value=A.value.filter(l=>b(l.row,C.value.columns)!==h)),M.value&&(M.value.style.boxShadow="none",M.value=null),Z(n,_,!1),$e("c:calendar:day:drag-record")}},j=()=>{var s;if(!z("dataEdit")||!((s=k.value)!=null&&s.length))return;const o={row:{[k.value[0].fk_from_col.title]:D.value.format("YYYY-MM-DD HH:mm:ssZ")}};V("newRecord",o)};return(o,s)=>{const f=le,u=se,p=ie;return x(O).length?(w(),y("div",{key:0,ref_key:"container",ref:P,class:"w-full cursor-pointer relative h-[calc(100vh-10.8rem)] overflow-y-auto nc-scrollbar-md","data-testid":"nc-calendar-day-view",onDblclick:j,onDrop:H},[(w(!0),y(E,null,$(x(O),(e,a)=>(w(),y("div",{key:a,style:X(e.rowMeta.style),class:"absolute mt-2","data-testid":"nc-calendar-day-record-card",onMouseleave:s[0]||(s[0]=t=>B.value=null),onMouseover:t=>B.value=e.rowMeta.id},[F(p,{row:e},{default:N(()=>[F(u,{position:e.rowMeta.position,record:e,resize:!1,color:"blue",size:"small",onClick:ee(t=>V("expandRecord",e),["prevent"])},{default:N(()=>[(w(!0),y(E,null,$(x(J),(t,r)=>(w(),y(E,{key:r},[("isRowEmpty"in o?o.isRowEmpty:x(re))(e,t)?oe("",!0):(w(),te(f,{key:0,modelValue:e.row[t.title],"onUpdate:modelValue":m=>e.row[t.title]=m,class:"text-xs",bold:S(t).bold,column:t,italic:S(t).italic,underline:S(t).underline},null,8,["modelValue","onUpdate:modelValue","bold","column","italic","underline"]))],64))),128))]),_:2},1032,["position","record","onClick"])]),_:2},1032,["row"])],44,ce))),128))],544)):(w(),y("div",{key:1,ref_key:"container",ref:P,class:"w-full h-full cursor-pointer flex text-md font-bold text-gray-500 items-center justify-center",onDrop:H,onDblclick:j}," No records in this day ",544))}}});export{we as default};
