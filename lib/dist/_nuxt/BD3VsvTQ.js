const __vite__fileDeps=["./BwqzOS03.js","./xtxyOwu-.js","./Cj4l15BV.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css","./DpDIhxXu.js","./Dqwep-0C.js","./BBXMuneh.js","./CJBRTPd8.js","./D8rpj5Lr.js","./BcZAlRJW.js","./BQQOEPN4.js","./BohSct8s.js","./C8c9012h.js","./hvq8FVej.js","./Select.C8Fy0-eI.css","./BcpeJQoi.js","./CO8XXsKl.js","./FieldListAutoCompleteDropdown.B9RfDcmT.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as oe,bc as _e,bN as M,r as g,da as te,g as h,d2 as f,d3 as se,ht as fe,fs as ne,fR as Z,o as i,c as B,b as _,P as t,d9 as ve,db as ye,h$ as be,N as ge,H as he,hk as W,O as we,S as d,w as l,a as b,Y as x,V,W as $,aq as ke,av as Be,t as L,T as N,R as q,Q as X,d as Ce,U as Oe,Z as Ge,a6 as Se,aj as ee,a0 as Te,a1 as xe,$ as Me,A as De,_ as Ie}from"./Cgw6cdOy.js";import{_ as Ve}from"./CBB1QnSh.js";import{a as re}from"./BcpeJQoi.js";import{a as ae}from"./DpOBhFIe.js";import{_ as $e}from"./CJBRTPd8.js";import{_ as Le}from"./CiTH7PYd.js";import{a as Ne}from"./DFiWgQ57.js";import{u as Ee}from"./LbdZxisI.js";import{g as Re}from"./D-o63D3c.js";import{D as Ue}from"./tqKkZMzS.js";import{S as Ae}from"./D8rpj5Lr.js";import"./Bw0A6WKO.js";import"./Cj4l15BV.js";import"./DpDIhxXu.js";import"./Dqwep-0C.js";import"./BBXMuneh.js";import"./5xpACL64.js";import"./C0xV_Bo1.js";import"./Bcy-XIkn.js";import"./DPaOlBFV.js";import"./BQQOEPN4.js";import"./hvq8FVej.js";import"./C8c9012h.js";import"./BIsWr_mR.js";import"./BZz6iAla.js";import"./CO8XXsKl.js";import"./BcZAlRJW.js";import"./BohSct8s.js";const Fe={class:"nc-group-by-create-modal"},ze=oe({__name:"CreateGroupBy",props:{isParentOpen:{type:Boolean},columns:{}},emits:["created"],setup(C,{emit:D}){const E=C,R=D,{isParentOpen:U,columns:O}=_e(E),G=M(te,g()),{showSystemFields:S,metaColumnById:T}=re(),{groupBy:w}=ae(),A=h(()=>{var n,c;return((c=O.value||((n=G.value)==null?void 0:n.columns))==null?void 0:c.filter(r=>{var v;return r.uidt===f.Links?!0:se((v=T==null?void 0:T.value)==null?void 0:v[r.id])?r!=null&&r.colOptions||fe(r,G.value)?!1:S.value:r.uidt===f.QrCode||r.uidt===f.Barcode||r.uidt===f.ID?!1:!(ne(r)&&![Z.BELONGS_TO,Z.ONE_TO_ONE].includes(r.colOptions.type))}).filter(r=>!w.value.find(v=>{var I;return((I=v.column)==null?void 0:I.id)===r.id})))??[]}),F=n=>{R("created",n)};return(n,c)=>{const r=Ve;return i(),B("div",Fe,[_(r,{"is-parent-open":t(U),"search-input-placeholder":n.$t("msg.selectFieldToGroup"),options:t(A),"toolbar-menu":"groupBy",onSelected:F},null,8,["is-parent-open","search-input-placeholder","options"])])}}}),Pe=Ge(()=>Se(()=>import("./BwqzOS03.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url).then(C=>C.default||C)),je={class:"flex items-center gap-1"},Ye={class:"flex items-center gap-2"},Qe={key:0,class:"text-capitalize !text-[13px] font-medium"},He={key:0,class:"bg-brand-50 text-brand-500 py-1 px-2 text-md rounded-md"},We={key:1,class:"flex flex-col bg-white overflow-auto nc-group-by-list menu-filter-dropdown w-100 p-4","data-testid":"nc-group-by-menu"},qe={class:"w-full flex items-center justify-between gap-2"},Ze={class:"truncate flex-1"},Je={class:"flex gap-1 items-center"},Ke=oe({__name:"GroupByMenu",setup(C){const D=M(te,g()),E=M(ve,g()),R=M(ye,g(!1)),U=M(be,h(()=>!1)),{gridViewCols:O,updateGridViewColumn:G,metaColumnById:S,showSystemFields:T}=re(),{fieldsToGroupBy:w,groupByLimit:A}=ae(),{$e:F}=De(),n=g([]),c=h(()=>{const o=[];return Object.values(O.value).forEach(e=>{e.group_by&&o.push({fk_column_id:e.fk_column_id,sort:e.group_by_sort||"asc",order:e.group_by_order||1})}),o.sort((e,s)=>e.order-s.order),o}),r=h(()=>c.value.map(o=>o.fk_column_id).filter(o=>o)),{eventBus:v}=Ne(),{isMobileMode:I}=ge(),y=g(!1),J=h(()=>{var o;return((o=D.value)==null?void 0:o.columns)||[]}),ie=h(()=>J.value.reduce((o,e)=>(o[e.id]=e,o),{})),le=h(()=>{var o;return(o=J.value)==null?void 0:o.filter(e=>{var s;return e.uidt===f.Links?!0:se((s=S==null?void 0:S.value)==null?void 0:s[e.id])?T.value:e.uidt===f.QrCode||e.uidt===f.Barcode||e.uidt===f.ID?!1:!(ne(e)&&e.colOptions.type!==Z.BELONGS_TO)}).filter(e=>!c.value.find(s=>s.fk_column_id===e.id))}),ue=o=>{var e;return o&&((e=ie.value[o])==null?void 0:e.uidt)||""},p=g(!1);Ee(p);const k=async()=>{var o;if((o=E.value)!=null&&o.id)try{for(const e of n.value){if(!e.fk_column_id)continue;const s=O.value[e.fk_column_id];s&&(!s.group_by||s.group_by_order!==e.order||s.group_by_sort!==e.sort)&&await G(e.fk_column_id,{group_by:!0,group_by_order:e.order,group_by_sort:e.sort})}for(const e of c.value){if(!e.fk_column_id||n.value.find(m=>m.fk_column_id===e.fk_column_id))continue;const s=O.value[e.fk_column_id];s&&s.group_by&&await G(e.fk_column_id,{group_by:!1,group_by_order:void 0,group_by_sort:void 0})}F("a:group-by:update",{groupBy:c.value}),v.emit(W.GROUP_BY_RELOAD)}catch{ee.error("There was an error while updating view!")}else ee.error("View not found!!!")},z=o=>{n.value.push({fk_column_id:o.id,sort:"asc",order:n.value.length+1}),k(),y.value=!1},de=async o=>{if(r.value.length===0){p.value=!1;return}const e=n.value.findIndex(s=>s.fk_column_id===o.fk_column_id);n.value.splice(+e,1),await k()};he(p,()=>{p.value?n.value=[...c.value]:y.value=!1}),v.on(async(o,e)=>{if(e!=null&&e.id){if(o===W.GROUP_BY_ADD)z(e);else if(o===W.GROUP_BY_REMOVE){if(r.value.length===0)return;n.value=n.value.filter(s=>s.fk_column_id!==e.id),await k()}}});const ce=async o=>{const{newIndex:e,oldIndex:s}=o.moved,m=[...n.value],P=m.splice(s,1)[0];m.splice(e,0,P??[]);const j=m.map((Y,Q)=>({...Y,order:Q+1}));n.value=[...j],await k()};return(o,e)=>{const s=Te,m=ze,P=Pe,j=Ae,Y=$e,Q=xe,pe=Me,K=Le,H=we("e");return i(),d(K,{visible:t(p),"onUpdate:visible":e[6]||(e[6]=a=>X(p)?p.value=a:null),"offset-y":"",trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-group-by-menu nc-toolbar-dropdown overflow-hidden"},{overlay:l(()=>[t(n).length?(i(),B("div",We,[b("div",{class:"max-h-100",onClick:e[3]||(e[3]=x(()=>{},["stop"]))},[_(t(Ue),{"model-value":t(n),"item-key":"fk_column_id","ghost-class":"bg-gray-50",onChange:e[2]||(e[2]=a=>ce(a))},{item:l(({element:a})=>[(i(),B("div",{key:a.fk_column_id,class:"flex first:mb-0 !mb-1.5 !last:mb-0 items-center"},[_(s,{type:"secondary",size:"small",class:"!border-r-transparent !rounded-r-none"},{default:l(()=>[(i(),d(V(("iconMap"in o?o.iconMap:t($)).drag)))]),_:1}),_(P,{modelValue:a.fk_column_id,"onUpdate:modelValue":u=>a.fk_column_id=u,class:"caption nc-sort-field-select !w-36",columns:t(w),"allow-empty":!0,meta:t(D),onChange:k,onClick:e[0]||(e[0]=x(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns","meta"]),_(Y,{ref:"",value:a.sort,"onUpdate:value":u=>a.sort=u,class:"flex flex-grow-1 w-full nc-sort-dir-select",label:o.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir",disabled:!a.fk_column_id,onChange:k,onClick:e[1]||(e[1]=x(()=>{},["stop"]))},{default:l(()=>[(i(!0),B(ke,null,Be(("getSortDirectionOptions"in o?o.getSortDirectionOptions:t(Re))(ue(a.fk_column_id),!0),(u,me)=>(i(),d(j,{key:me,value:u.value},{default:l(()=>[b("div",qe,[b("div",Ze,L(u.text),1),a.sort===u.value?(i(),d(V(("iconMap"in o?o.iconMap:t($)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):N("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","label","disabled"]),_(Q,{placement:"top",title:"Remove",class:"flex-none"},{default:l(()=>[q((i(),d(s,{class:"nc-group-by-item-remove-btn !border-l-transparent !rounded-l-none min-w-40",size:"small",type:"secondary",onClick:x(u=>de(a),["stop"])},{default:l(()=>[(i(),d(V(("iconMap"in o?o.iconMap:t($)).deleteListItem)))]),_:2},1032,["onClick"])),[[H,["c:group-by:remove"]]])]),_:2},1024)]))]),_:1},8,["model-value"])]),t(le).length&&t(w).length>t(n).length&&t(n).length<t(A)?(i(),d(K,{key:0,visible:t(y),"onUpdate:visible":e[5]||(e[5]=a=>X(y)?y.value=a:null),trigger:["click"],"overlay-class-name":"nc-toolbar-dropdown"},{overlay:l(()=>[_(m,{"is-parent-open":t(y),columns:t(w),onCreated:z},null,8,["is-parent-open","columns"])]),default:l(()=>[q((i(),d(s,{type:"text",size:"small",style:{width:"fit-content"},class:"nc-add-group-by-btn mt-2 !text-brand-500",onClick:e[4]||(e[4]=x(a=>y.value=!0,["stop"]))},{default:l(()=>[b("div",Je,[_(pe,{icon:"plus"}),Ce(" "+L(o.$t("activity.addSubGroup")),1)])]),_:1})),[[H,["c:group-by:add"]]])]),_:1},8,["visible"])):N("",!0)])):(i(),d(m,{key:0,"is-parent-open":t(p),columns:t(w),onCreated:z},null,8,["is-parent-open","columns"]))]),default:l(()=>{var a;return[b("div",{class:Oe({"nc-active-btn":(a=t(r))==null?void 0:a.length})},[q((i(),d(s,{disabled:t(R),class:"nc-group-by-menu-btn nc-toolbar-btn !border-0 !h-7",size:"small",type:"secondary"},{default:l(()=>{var u;return[b("div",je,[b("div",Ye,[(i(),d(V(("iconMap"in o?o.iconMap:t($)).group),{class:"h-4 w-4"})),!t(I)&&!t(U)?(i(),B("span",Qe,L(o.$t("activity.group")),1)):N("",!0)]),(u=t(r))!=null&&u.length?(i(),B("span",He,L(t(r).length),1)):N("",!0)])]}),_:1},8,["disabled"])),[[H,["c:group-by"]]])],2)]}),_:1},8,["visible"])}}}),To=Ie(Ke,[["__scopeId","data-v-1312d941"]]);export{To as default};
