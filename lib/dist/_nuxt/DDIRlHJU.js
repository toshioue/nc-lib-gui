import{a as L}from"./B05h-4V9.js";import{o as l,c as b,a as t,e as z,bL as c,r as i,d7 as G,d6 as R,d8 as H,dz as Q,F as W,f as v,hD as Y,c$ as q,M as J,N as o,Q as d,w as p,W as w,t as m,b as _,O as g,R as h,P as K,d as X,T as Z,U as ee,aT as ae,ae as te}from"./DZZ6t_j4.js";import{a as oe}from"./i4aLU0Nw.js";import{a as se}from"./BhreHRvP.js";import{_ as ne}from"./0azk-b-q.js";import{_ as ie}from"./D_MsYLkT.js";import"./GMLocJHP.js";import"./BDAIZopQ.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";import"./vll-Pnjv.js";const le={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ce=t("path",{fill:"currentColor",d:"M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 2a8 8 0 0 1 8 8a8 8 0 0 1-8 8a8 8 0 0 1-8-8a8 8 0 0 1 8-8m-5 6l5 5l5-5z"},null,-1),re=[ce];function de(M,u){return l(),b("svg",le,[...re])}const pe={name:"mdi-arrow-down-drop-circle-outline",render:de},me={class:"nc-map-btn"},_e={class:"flex items-center gap-1"},ue={class:"text-capitalize !text-sm font-weight-normal"},fe={class:"font-bold"},ve={class:"font-bold"},we={class:"nc-fields-list py-1"},ge={class:"grouping-field"},Te=z({__name:"MappedBy",setup(M){const{eventBus:u}=L(),y=c(G,i()),f=c(R,i()),k=c(H,i(!1)),C=c(Q,i(!1)),{fields:D,loadViewColumns:B,metaColumnById:x}=oe(),{loadMapData:I,loadMapMeta:V,updateMapMeta:N,mapMetaData:S,geoDataFieldColumn:T}=se(),n=i(!1);W(()=>{var a;return(a=f.value)==null?void 0:a.id},async(a,e)=>{a!==e&&y.value&&await B()},{immediate:!0});const r=v({get:()=>S.value.fk_geo_data_col_id,set:async a=>{var e;a&&(await N({fk_geo_data_col_id:a}),await V(),await I(),((e=f.value)==null?void 0:e.view).fk_geo_data_col_id=a,u.emit(Y.MAPPED_BY_COLUMN_CHANGE))}}),F=v(()=>{var a;return(a=D.value)==null?void 0:a.filter(e=>e.fk_column_id&&x.value[e.fk_column_id].uidt===q.GeoData).map(e=>({value:e.fk_column_id,label:e.title}))}),O=()=>{n.value=!1};return(a,e)=>{const $=pe,j=ae,A=ne,P=ie,U=te,E=J("e");return o(C)?h("",!0):(l(),d(U,{key:0,visible:o(n),"onUpdate:visible":e[3]||(e[3]=s=>g(n)?n.value=s:null),trigger:["click"],class:"!xs:hidden"},{overlay:p(()=>[o(n)?(l(),b("div",{key:0,class:"p-3 min-w-[280px] bg-gray-50 shadow-lg nc-table-toolbar-menu max-h-[max(80vh,500px)] overflow-auto !border",onClick:e[2]||(e[2]=w(()=>{},["stop"]))},[t("div",null,[t("span",ve,m(a.$t("activity.map.chooseMappingField")),1),_(A,{class:"!my-2"})]),t("div",we,[t("div",ge,[_(P,{value:o(r),"onUpdate:value":e[0]||(e[0]=s=>g(r)?r.value=s:null),class:"w-full nc-msp-grouping-field-select",options:o(F),placeholder:"Select a Mapping Field",onChange:O,onClick:e[1]||(e[1]=w(()=>{},["stop"]))},null,8,["value","options"])])])])):h("",!0)]),default:p(()=>[t("div",me,[K((l(),d(j,{class:"nc-map-stacked-by-menu-btn nc-toolbar-btn",disabled:o(k)},{default:p(()=>{var s;return[t("div",_e,[_($),t("span",ue,[X(m(a.$t("activity.map.mappedBy"))+" ",1),t("span",fe,m((s=o(T))==null?void 0:s.title),1)]),(l(),d(Z(("iconMap"in a?a.iconMap:o(ee)).arrowDown),{class:"text-grey"}))])]}),_:1},8,["disabled"])),[[E,["c:map:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{Te as default};
