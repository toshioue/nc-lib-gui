import{u as xe,_ as Ee}from"./BqsLY80A.js";import{r as m,az as ce,f as Ie,aA as Se,ay as ze,L as Ce,ad as $e,g as C,g3 as Me,dx as Re,at as V,H as L,aj as K,ak as oe,ae as Oe,i as Be,o as u,S as $,w as f,a as c,t as g,U as P,P as s,c as M,aq as ie,av as le,d as w,V as A,W as F,R as De,aL as re,Y as je,dn as Ne,b as h,T as ne,Q,hy as We,a1 as Te,a0 as Ue,hz as Ve,p as Le,e as Ke,_ as Pe}from"./Cgw6cdOy.js";import{_ as Ae}from"./C6pnOEba.js";import{_ as Fe}from"./CiTH7PYd.js";import{_ as Qe}from"./ahvdY77A.js";import{v as B}from"./DCaZaUH5.js";import"./Bcy-XIkn.js";import{I as qe}from"./DPaOlBFV.js";import"./1TGO_kFB.js";import"./DBXRneGc.js";import"./DpYA1Dpy.js";import"./dmcxUY_0.js";import"./BcZAlRJW.js";import"./hvq8FVej.js";import"./LSbsNkd9.js";import"./BZz6iAla.js";import"./KNudlHpk.js";import"./CitraFSq.js";import"./VVwMOds3.js";import"./hzkm8p6q.js";import"./Cd1fRcFb.js";import"./BohSct8s.js";import"./DGChWJi9.js";import"./DvfxijkH.js";import"./BnsFObH3.js";import"./CaljPn-s.js";import"./B4oYR-Xl.js";import"./DOBx3lw4.js";import"./BIsWr_mR.js";import"./BQQOEPN4.js";import"./BLvTi2Ht.js";import"./Clh5TdFY.js";import"./Bi6QLLC9.js";import"./S1x-kZdE.js";import"./DbRkwnd8.js";import"./P9ghmVPN.js";import"./DgSeK08O.js";import"./Do1LnTan.js";import"./DRVKgtZT.js";import"./Cw6_lRNR.js";import"./D8rpj5Lr.js";import"./C8c9012h.js";import"./CX7Px7b_.js";import"./BPivYv4D.js";import"./CAuyt8bq.js";import"./D8LQIFYN.js";import"./ByWnxpgj.js";import"./DBJzESM9.js";import"./CJBRTPd8.js";import"./C6pQ4eSP.js";import"./DPyR1M2Z.js";import"./boyBAVNN.js";import"./Dzlf0Q89.js";import"./zKWQxcjd.js";import"./CO8XXsKl.js";import"./C00NHga8.js";import"./G4Pt-Lbf.js";import"./C8ARa7D-.js";import"./C2g4bvWC.js";import"./BiBN5Lxt.js";import"./DBOeGHNL.js";import"./Bxm040c6.js";import"./WttlrBnq.js";import"./CpJUN2HL.js";import"./DzMG5wJt.js";import"./C0xV_Bo1.js";import"./tqKkZMzS.js";const Ge=()=>{const y=m([]),D=m([]),n=m([]),{orgId:j}=ce(xe());return{orgId:j,workspaces:y,listWorkspaces:async(..._)=>{},fetchOrganizationMembers:async(..._)=>{},fetchOrganizationBases:async(..._)=>{},bases:n,members:D}},He=y=>(Le("data-v-51392d9c"),y=y(),Ke(),y),Ye={class:"flex flex-row text-2xl font-bold items-center gap-x-2"},Je={class:"flex items-center justify-between gap-3 mt-2"},Xe={class:"flex w-full gap-4 flex-col"},Ze={class:"flex justify-between gap-3 w-full"},et=["disabled","placeholder"],tt={key:0,class:"ml-2 text-red-500 text-[10px] mt-1.5"},st={class:""},at={class:"py-2"},ot={class:"mx-2"},it={class:"flex flex-col max-h-64 overflow-y-auto nc-scrollbar-md mt-2"},lt=["onClick"],rt={class:"flex gap-2 capitalize items-center"},nt=He(()=>c("div",{class:"flex-1"},null,-1)),ct={class:"flex mt-8 justify-end"},mt={class:"flex gap-2"},pt=Ie({__name:"InviteDlg",props:{modelValue:{type:Boolean},type:{},baseId:{},emails:{},workspaceId:{}},emits:["update:modelValue"],setup(y,{emit:D}){const n=y,j=D,q=Se(),G=ze(),{baseRoles:R,workspaceRoles:_}=Ce(),{createProjectUser:me}=q,{inviteCollaborator:H}=G,v=$e(n,"modelValue",j),Y=C(()=>n.type==="base"?Me:Re),J=C(()=>n.type==="base"?R==null?void 0:R.value:_==null?void 0:_.value),o=V({email:"",roles:Y.value.NO_ACCESS}),pe=m(),X=m(),x=m(!1),i=V({isError:!0,message:""}),b=m(""),l=m([]),N=m([]),W=m([]),E=m(!1),Z=Ge(),{listWorkspaces:de}=Z,{workspaces:ue}=ce(Z),I=m(""),ee=C(()=>ue.value.filter(e=>e.title.toLowerCase().includes(I.value.toLowerCase()))),S=V({}),k=C(()=>ee.value.filter(e=>S[e.id])),T=()=>{var e;(e=X.value)==null||e.focus(),x.value=!0};L(v,async e=>{if(e){try{const t=Object.values(Y.value),r=t.findIndex(p=>J.value&&Object.keys(J.value).includes(p));r!==-1?(N.value=t.slice(r),W.value=t.slice(0,r)):(N.value=t,W.value=[])}catch(t){K.error(await oe(t))}n.emails&&(l.value=n.emails),setTimeout(()=>{T()},100)}else l.value=[],o.email="",b.value=""});const te=e=>{const t=l.value.indexOf(e);t!==-1&&l.value.splice(t,1),l.value.push(e)},se=(e,t=!1)=>e.length?B(e.trim())?!0:(t||(i.isError=!0,i.message="Invalid Email"),!1):(t||(i.isError=!0,i.message="Email should not be empty"),!1),fe=C(()=>{if(!l.value.length&&!b.value.length||l.value.length&&o.email)return!0});L(o,e=>{if(B(e.email)&&!l.value.length){b.value=e.email,i.isError=!1;return}if(b.value="",(e.email.charAt(e.email.length-1)===","||e.email.charAt(e.email.length-1)===" ")&&e.email.trim().length){const p=e.email.split(",")[0].trim()||e.email.split(" ")[0].trim();if(!B(p)){i.isError=!0,i.message="Invalid Email";return}if(l.value.includes(p)){te(p),o.email="";return}l.value.push(p),o.email="",b.value=""}!e.email.length&&i.isError&&(i.isError=!1)});const ve=()=>{se(o.email)&&(o.email+=" ",i.isError=!1,i.message="")};Oe("Backspace",()=>{x.value&&o.email.length<1&&l.value.pop()}),L(v,e=>{e&&setTimeout(()=>{T()},100)});const ge=e=>{var p;i.isError=!1;const t=(p=e.clipboardData)==null?void 0:p.getData("text"),r=(t==null?void 0:t.split(","))||(t==null?void 0:t.split(" "));(r==null?void 0:r.length)===1&&o.email.length&&(r[0]=o.email+=r[0]),r==null||r.forEach(d=>{if(d=We(d)||d,!!se(d,r.length>1)){if(l.value.includes(d)){te(d);return}l.value.push(d),o.email=""}}),o.email=""},he=async()=>{try{E.value=!0;const e=b.value||l.value.join(",");if(e.includes(",")||B(e)||(i.isError=!0,i.message="invalid email"),n.type==="base"&&n.baseId)await me(n.baseId,{email:e,roles:o.roles});else if(n.type==="workspace"&&n.workspaceId)await H(e,o.roles,n.workspaceId);else if(n.type==="organization")for(const t of k.value)await H(e,o.roles,t.id);K.success("Invitation sent successfully"),o.email="",l.value=[],v.value=!1}catch(e){K.error(await oe(e))}finally{b.value="",E.value=!1}},U=m(!1);Be(async()=>{n.type==="organization"&&await de()});const ye=e=>o.roles=e;return(e,t)=>{const r=Ee,p=Te,d=Ue,ae=qe,be=Ve,_e=Ae,ke=Fe,we=Qe;return u(),$(we,{visible:s(v),"onUpdate:visible":t[6]||(t[6]=z=>Q(v)?v.value=z:null),header:e.$t("activity.createTable"),"show-separator":!1,size:"medium",class:"nc-invite-dlg",onKeydown:t[7]||(t[7]=re(z=>v.value=!1,["esc"]))},{header:f(()=>[c("div",Ye,g(e.type==="organization"?e.$t("labels.addMembersToOrganization"):e.type==="base"?e.$t("activity.addMember"):e.$t("activity.inviteToWorkspace")),1)]),default:f(()=>{var z;return[c("div",Je,[c("div",Xe,[c("div",Ze,[c("div",{ref_key:"divRef",ref:pe,class:P([{"border-primary/100":s(x),"p-1":((z=s(l))==null?void 0:z.length)>1},"flex items-center border-1 gap-1 w-full overflow-x-scroll nc-scrollbar-x-md items-center h-10 rounded-lg !min-w-96"]),tabindex:"0",onBlur:t[2]||(t[2]=a=>x.value=!1),onClick:T},[(u(!0),M(ie,null,le(s(l),(a,O)=>(u(),M("span",{key:a,class:"border-1 text-gray-800 first:ml-1 bg-gray-100 rounded-md flex items-center px-2 py-1"},[w(g(a)+" ",1),(u(),$(A(("iconMap"in e?e.iconMap:s(F)).close),{class:"ml-0.5 hover:cursor-pointer mt-0.5 w-4 h-4",onClick:dt=>s(l).splice(O,1)},null,8,["onClick"]))]))),128)),De(c("input",{id:"email",ref_key:"focusRef",ref:X,"onUpdate:modelValue":t[0]||(t[0]=a=>s(o).email=a),disabled:s(E),placeholder:e.$t("activity.enterEmail"),class:"w-full min-w-36 outline-none px-2","data-testid":"email-input",onBlur:t[1]||(t[1]=a=>x.value=!1),onKeyup:re(ve,["enter"]),onPaste:je(ge,["prevent"])},null,40,et),[[Ne,s(o).email]])],34),h(r,{description:!1,"on-role-change":ye,role:s(o).roles,"disabled-roles":s(W),roles:s(N),class:"!min-w-[152px] nc-invite-role-selector",size:"lg"},null,8,["role","disabled-roles","roles"])]),s(i).isError&&s(i).message?(u(),M("span",tt,g(s(i).message),1)):ne("",!0),e.type==="organization"?(u(),$(ke,{key:1,visible:s(U),"onUpdate:visible":t[4]||(t[4]=a=>Q(U)?U.value=a:null)},{overlay:f(()=>[c("div",at,[c("div",ot,[h(ae,{value:s(I),"onUpdate:value":t[3]||(t[3]=a=>Q(I)?I.value=a:null),class:P([{"!border-brand-500":s(I).length>0},"!rounded-lg !h-8 !ring-0 !placeholder:text-gray-500 !border-gray-200 !px-4"]),"data-testid":"nc-ws-search",placeholder:"Search workspace"},{prefix:f(()=>[(u(),$(A(("iconMap"in e?e.iconMap:s(F)).search),{class:"h-4 w-4 mr-1 text-gray-500"}))]),_:1},8,["value","class"])]),c("div",it,[(u(!0),M(ie,null,le(s(ee),a=>(u(),M("div",{key:a.id,class:"px-4 cursor-pointer hover:bg-gray-100 rounded-lg h-9.5 py-2 w-full flex gap-2",onClick:O=>s(S)[a.id]=!s(S)[a.id]},[c("div",rt,[h(be,{"hide-label":!0,workspace:a,size:"small"},null,8,["workspace"]),w(" "+g(a.title),1)]),nt,h(_e,{checked:s(S)[a.id],"onUpdate:checked":O=>s(S)[a.id]=O,size:"large"},null,8,["checked","onUpdate:checked"])],8,lt))),128))])])]),default:f(()=>[h(d,{class:"!justify-between","full-width":"",size:"medium",type:"secondary"},{default:f(()=>[c("div",{class:P([{"!text-gray-600":s(k).length>0},"flex text-gray-500 justify-between items-center w-full"])},[h(p,{class:"!max-w-130 truncate","show-on-truncate-only":""},{title:f(()=>[w(g(s(k).length>0?s(k).map(a=>a.title).join(", "):"-select workspaces to invite to-"),1)]),default:f(()=>[c("span",st,g(s(k).length>0?s(k).map(a=>a.title).join(", "):"-select workspaces to invite to-"),1)]),_:1}),(u(),$(A(("iconMap"in e?e.iconMap:s(F)).chevronDown)))],2)]),_:1}),w(" /> ")]),_:1},8,["visible"])):ne("",!0)])]),c("div",ct,[c("div",mt,[h(d,{type:"secondary",onClick:t[5]||(t[5]=a=>v.value=!1)},{default:f(()=>[w(g(e.$t("labels.cancel")),1)]),_:1}),h(d,{disabled:s(fe)||s(i).isError||s(E),loading:s(E),size:"medium",type:"primary",class:"nc-invite-btn",onClick:he},{default:f(()=>[w(g(e.type==="base"?e.$t("activity.inviteToBase"):e.$t("activity.inviteToWorkspace")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible","header"])}}}),Ss=Pe(pt,[["__scopeId","data-v-51392d9c"]]);export{Ss as default};
