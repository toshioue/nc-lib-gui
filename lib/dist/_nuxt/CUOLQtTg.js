import{u as xe,_ as Ee}from"./C3dEhB1d.js";import{r as m,ax as ce,e as Ie,ay as Se,aw as $e,J as Ce,ab as ze,f as $,gf as Me,dv as Re,ar as V,F as L,ah as K,ai as ie,ac as Oe,g as Be,o as u,Q as C,w as f,a as c,t as g,S as P,N as s,c as z,ao as oe,at as le,d as k,T as F,U as A,P as De,aJ as re,W as Ne,dk as je,b as h,R as ne,O as J,hR as We,$ as Te,Z as Ue,hS as Ve,_ as Le}from"./DZZ6t_j4.js";import{_ as Ke}from"./DfeSAprs.js";import{_ as Pe}from"./vK-WmZ7a.js";import{_ as Fe}from"./Bdv7ru7D.js";import{v as O}from"./C3jLTHF4.js";import"./DKN1hQ6S.js";import{I as Ae}from"./BQuyMdA-.js";import"./CxrpBWdD.js";import"./DA0VIM8P.js";import"./BYINaHrJ.js";import"./dfem9Uc_.js";import"./BCJFTkwv.js";import"./vll-Pnjv.js";import"./D9tFZoTQ.js";import"./DyDFI6NE.js";import"./DNgdBwTe.js";import"./eX8_g88K.js";import"./0azk-b-q.js";import"./BO2leIU3.js";import"./CmWcz5yS.js";import"./CB1aB6F1.js";import"./CMQKmrr6.js";import"./CMIIcM5i.js";import"./ByvYYClF.js";import"./DuvRsGDb.js";import"./BT-ahe-O.js";import"./DGj1ycqW.js";import"./BQQOEPN4.js";import"./CynerQ2m.js";import"./DCjuPxLb.js";import"./CY3l82lI.js";import"./DgixBgIx.js";import"./C3XbZq4f.js";import"./CyRMlOXW.js";import"./By7kEk8u.js";import"./DnwRMKX3.js";import"./B6xrG0q8.js";import"./B89oU1M4.js";import"./D_MsYLkT.js";import"./B5RRVMt5.js";import"./YRNmwX8m.js";import"./2FgppHLC.js";import"./Ck-cgwga.js";import"./BpclqUFq.js";import"./DuJHisTB.js";import"./oyD85nwD.js";import"./DnSVh-oD.js";import"./TJfB7GlU.js";import"./B4Lj1XSi.js";import"./boyBAVNN.js";import"./CwK0k4WN.js";import"./0QUe8GCE.js";import"./GMLocJHP.js";import"./C00NHga8.js";import"./G4Pt-Lbf.js";import"./C3wAmqC5.js";import"./CbjHV4v2.js";import"./CDWovrGB.js";import"./sz1d3zjm.js";import"./BLgccLvp.js";import"./BqKQ8afS.js";import"./CXD-Dj4T.js";import"./DS_HXCWn.js";import"./BVrX6sNU.js";import"./Dg0-TbNo.js";import"./t0mbNaqp.js";const Je=()=>{const B=m([]),D=m([]),n=m([]),{orgId:N}=ce(xe());return{orgId:N,workspaces:B,listWorkspaces:async(...b)=>{},fetchOrganizationMembers:async(...b)=>{},fetchOrganizationBases:async(...b)=>{},bases:n,members:D}},Qe={class:"flex flex-row text-2xl font-bold items-center gap-x-2"},Ge={class:"flex items-center justify-between gap-3 mt-2"},Ze={class:"flex w-full gap-4 flex-col"},qe={class:"flex justify-between gap-3 w-full"},He=["disabled","placeholder"],Xe={key:0,class:"ml-2 text-red-500 text-[10px] mt-1.5"},Ye={class:""},et={class:"py-2"},tt={class:"mx-2"},st={class:"flex flex-col max-h-64 overflow-y-auto nc-scrollbar-md mt-2"},at=["onClick"],it={class:"flex gap-2 capitalize items-center"},ot={class:"flex mt-8 justify-end"},lt={class:"flex gap-2"},rt=Ie({__name:"InviteDlg",props:{modelValue:{type:Boolean},type:{},baseId:{},emails:{},workspaceId:{}},emits:["update:modelValue"],setup(B,{emit:D}){const n=B,N=D,Q=Se(),G=$e(),{baseRoles:M,workspaceRoles:b}=Ce(),{createProjectUser:me}=Q,{inviteCollaborator:Z}=G,v=ze(n,"modelValue",N),q=$(()=>n.type==="base"?Me:Re),H=$(()=>n.type==="base"?M==null?void 0:M.value:b==null?void 0:b.value),i=V({email:"",roles:q.value.NO_ACCESS}),pe=m(),X=m(),w=m(!1),o=V({isError:!0,message:""}),y=m(""),l=m([]),j=m([]),W=m([]),x=m(!1),Y=Je(),{listWorkspaces:de}=Y,{workspaces:ue}=ce(Y),E=m(""),ee=$(()=>ue.value.filter(e=>e.title.toLowerCase().includes(E.value.toLowerCase()))),I=V({}),_=$(()=>ee.value.filter(e=>I[e.id])),T=()=>{var e;(e=X.value)==null||e.focus(),w.value=!0};L(v,async e=>{if(e){try{const t=Object.values(q.value),r=t.findIndex(p=>H.value&&Object.keys(H.value).includes(p));r!==-1?(j.value=t.slice(r),W.value=t.slice(0,r)):(j.value=t,W.value=[])}catch(t){K.error(await ie(t))}n.emails&&(l.value=n.emails),setTimeout(()=>{T()},100)}else l.value=[],i.email="",y.value=""});const te=e=>{const t=l.value.indexOf(e);t!==-1&&l.value.splice(t,1),l.value.push(e)},se=(e,t=!1)=>e.length?O(e.trim())?!0:(t||(o.isError=!0,o.message="Invalid Email"),!1):(t||(o.isError=!0,o.message="Email should not be empty"),!1),fe=$(()=>{if(!l.value.length&&!y.value.length||l.value.length&&i.email)return!0});L(i,e=>{if(O(e.email)&&!l.value.length){y.value=e.email,o.isError=!1;return}if(y.value="",(e.email.charAt(e.email.length-1)===","||e.email.charAt(e.email.length-1)===" ")&&e.email.trim().length){const p=e.email.split(",")[0].trim()||e.email.split(" ")[0].trim();if(!O(p)){o.isError=!0,o.message="Invalid Email";return}if(l.value.includes(p)){te(p),i.email="";return}l.value.push(p),i.email="",y.value=""}!e.email.length&&o.isError&&(o.isError=!1)});const ve=()=>{se(i.email)&&(i.email+=" ",o.isError=!1,o.message="")};Oe("Backspace",()=>{w.value&&i.email.length<1&&l.value.pop()}),L(v,e=>{e&&setTimeout(()=>{T()},100)});const ge=e=>{var p;o.isError=!1;const t=(p=e.clipboardData)==null?void 0:p.getData("text"),r=(t==null?void 0:t.split(","))||(t==null?void 0:t.split(" "));(r==null?void 0:r.length)===1&&i.email.length&&(r[0]=i.email+=r[0]),r==null||r.forEach(d=>{if(d=We(d)||d,!!se(d,r.length>1)){if(l.value.includes(d)){te(d);return}l.value.push(d),i.email=""}}),i.email=""},he=async()=>{try{x.value=!0;const e=y.value||l.value.join(",");if(e.includes(",")||O(e)||(o.isError=!0,o.message="invalid email"),n.type==="base"&&n.baseId)await me(n.baseId,{email:e,roles:i.roles});else if(n.type==="workspace"&&n.workspaceId)await Z(e,i.roles,n.workspaceId);else if(n.type==="organization")for(const t of _.value)await Z(e,i.roles,t.id);K.success("Invitation sent successfully"),i.email="",l.value=[],v.value=!1}catch(e){K.error(await ie(e))}finally{y.value="",x.value=!1}},U=m(!1);Be(async()=>{n.type==="organization"&&await de()});const ye=e=>i.roles=e;return(e,t)=>{const r=Ee,p=Te,d=Ue,ae=Ae,be=Ve,_e=Ke,ke=Pe,we=Fe;return u(),C(we,{visible:s(v),"onUpdate:visible":t[6]||(t[6]=S=>J(v)?v.value=S:null),header:e.$t("activity.createTable"),"show-separator":!1,size:"medium",class:"nc-invite-dlg",onKeydown:t[7]||(t[7]=re(S=>v.value=!1,["esc"]))},{header:f(()=>[c("div",Qe,g(e.type==="organization"?e.$t("labels.addMembersToOrganization"):e.type==="base"?e.$t("activity.addMember"):e.$t("activity.inviteToWorkspace")),1)]),default:f(()=>{var S;return[c("div",Ge,[c("div",Ze,[c("div",qe,[c("div",{ref_key:"divRef",ref:pe,class:P([{"border-primary/100":s(w),"p-1":((S=s(l))==null?void 0:S.length)>1},"flex items-center border-1 gap-1 w-full overflow-x-scroll nc-scrollbar-x-md items-center h-10 rounded-lg !min-w-96"]),tabindex:"0",onBlur:t[2]||(t[2]=a=>w.value=!1),onClick:T},[(u(!0),z(oe,null,le(s(l),(a,R)=>(u(),z("span",{key:a,class:"border-1 text-gray-800 first:ml-1 bg-gray-100 rounded-md flex items-center px-2 py-1"},[k(g(a)+" ",1),(u(),C(F(("iconMap"in e?e.iconMap:s(A)).close),{class:"ml-0.5 hover:cursor-pointer mt-0.5 w-4 h-4",onClick:nt=>s(l).splice(R,1)},null,8,["onClick"]))]))),128)),De(c("input",{id:"email",ref_key:"focusRef",ref:X,"onUpdate:modelValue":t[0]||(t[0]=a=>s(i).email=a),disabled:s(x),placeholder:e.$t("activity.enterEmail"),class:"w-full min-w-36 outline-none px-2","data-testid":"email-input",onBlur:t[1]||(t[1]=a=>w.value=!1),onKeyup:re(ve,["enter"]),onPaste:Ne(ge,["prevent"])},null,40,He),[[je,s(i).email]])],34),h(r,{description:!1,"on-role-change":ye,role:s(i).roles,"disabled-roles":s(W),roles:s(j),class:"!min-w-[152px] nc-invite-role-selector",size:"lg"},null,8,["role","disabled-roles","roles"])]),s(o).isError&&s(o).message?(u(),z("span",Xe,g(s(o).message),1)):ne("",!0),e.type==="organization"?(u(),C(ke,{key:1,visible:s(U),"onUpdate:visible":t[4]||(t[4]=a=>J(U)?U.value=a:null)},{overlay:f(()=>[c("div",et,[c("div",tt,[h(ae,{value:s(E),"onUpdate:value":t[3]||(t[3]=a=>J(E)?E.value=a:null),class:P([{"!border-brand-500":s(E).length>0},"!rounded-lg !h-8 !ring-0 !placeholder:text-gray-500 !border-gray-200 !px-4"]),"data-testid":"nc-ws-search",placeholder:"Search workspace"},{prefix:f(()=>[(u(),C(F(("iconMap"in e?e.iconMap:s(A)).search),{class:"h-4 w-4 mr-1 text-gray-500"}))]),_:1},8,["value","class"])]),c("div",st,[(u(!0),z(oe,null,le(s(ee),a=>(u(),z("div",{key:a.id,class:"px-4 cursor-pointer hover:bg-gray-100 rounded-lg h-9.5 py-2 w-full flex gap-2",onClick:R=>s(I)[a.id]=!s(I)[a.id]},[c("div",it,[h(be,{"hide-label":!0,workspace:a,size:"small"},null,8,["workspace"]),k(" "+g(a.title),1)]),t[8]||(t[8]=c("div",{class:"flex-1"},null,-1)),h(_e,{checked:s(I)[a.id],"onUpdate:checked":R=>s(I)[a.id]=R,size:"large"},null,8,["checked","onUpdate:checked"])],8,at))),128))])])]),default:f(()=>[h(d,{class:"!justify-between","full-width":"",size:"medium",type:"secondary"},{default:f(()=>[c("div",{class:P([{"!text-gray-600":s(_).length>0},"flex text-gray-500 justify-between items-center w-full"])},[h(p,{class:"!max-w-130 truncate","show-on-truncate-only":""},{title:f(()=>[k(g(s(_).length>0?s(_).map(a=>a.title).join(", "):"-select workspaces to invite to-"),1)]),default:f(()=>[c("span",Ye,g(s(_).length>0?s(_).map(a=>a.title).join(", "):"-select workspaces to invite to-"),1)]),_:1}),(u(),C(F(("iconMap"in e?e.iconMap:s(A)).chevronDown)))],2)]),_:1}),t[9]||(t[9]=k(" /> "))]),_:1},8,["visible"])):ne("",!0)])]),c("div",ot,[c("div",lt,[h(d,{type:"secondary",onClick:t[5]||(t[5]=a=>v.value=!1)},{default:f(()=>[k(g(e.$t("labels.cancel")),1)]),_:1}),h(d,{disabled:s(fe)||s(o).isError||s(x),loading:s(x),size:"medium",type:"primary",class:"nc-invite-btn",onClick:he},{default:f(()=>[k(g(e.type==="base"?e.$t("activity.inviteToBase"):e.$t("activity.inviteToWorkspace")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible","header"])}}}),ws=Le(rt,[["__scopeId","data-v-51392d9c"]]);export{ws as default};
