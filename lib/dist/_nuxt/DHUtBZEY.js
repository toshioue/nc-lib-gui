import{_ as te}from"./DGQVY9pZ.js";import{_ as oe}from"./By7kEk8u.js";import{r as P,f as z,F as se,g as ae,e as U,o as r,c as i,b as y,w as b,ao as E,at as V,N as a,t as _,R as N,a as s,a8 as ne,Q as A,a7 as le,cm as re,S as ce,Y as M,$ as ie,dp as j,_ as G,ab as ue,ft as pe,d as R,cq as de,Z as me}from"./DZZ6t_j4.js";import{_ as _e}from"./DnSVh-oD.js";import{_ as fe}from"./CJNscGy3.js";import{_ as he}from"./0QUe8GCE.js";import{u as ve}from"./GMLocJHP.js";import{d as ye}from"./G4Pt-Lbf.js";import{F as Y}from"./BYINaHrJ.js";import"./DKN1hQ6S.js";import{I as ge}from"./BQuyMdA-.js";import{_ as xe}from"./DyDFI6NE.js";import{_ as we}from"./dfem9Uc_.js";import{_ as be}from"./TJfB7GlU.js";import{a as ke,A as H}from"./va4LPhtg.js";import"./D_MsYLkT.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";import"./vll-Pnjv.js";import"./CDWovrGB.js";import"./D9tFZoTQ.js";import"./DGj1ycqW.js";import"./0azk-b-q.js";var u=(d=>(d.Input="input",d.Select="select",d.Switch="switch",d.Space="space",d.Password="password",d))(u||{});const Z="form-builder-non-categorized",[Se,Ie]=ve(d=>{const{formSchema:F,onSubmit:g,initialState:m}=d,C=Y.useForm,q=P(),f=P(!1),x=P(!1),o=z(()=>{const n={};for(const t of F)t.category=t.category||Z,n[t.category]||(n[t.category]=[]),n[t.category].push(t);return n}),c=(n,t,I)=>{const v=t.split("."),e=v.pop();if(!e)return;const l=v.reduce(($,T)=>($[T]||($[T]={}),$[T]),n);l[e]=I},h=()=>{const n={};for(const t of F)t.model&&(t.type===u.Switch?c(n,t.model,t.defaultValue??!1):t.type===u.Select?c(n,t.model,t.defaultValue??[]):c(n,t.model,t.defaultValue??""));return n},p=P(h()),B=z(()=>{const n={};for(const t of F)t.model&&t.required&&(n[t.model]=[{required:!0,message:`${t.label} is required`}]);return{title:[{required:!0,message:"Integration title is required"}],...n}}),{validate:w,validateInfos:k}=C(p,B),O=async()=>{var n,t,I,v,e;try{await w()}catch(l){return(e=(v=(I=(t=(n=q.value)==null?void 0:n.$el.querySelector(".ant-form-item-explain-error"))==null?void 0:t.parentNode)==null?void 0:I.parentNode)==null?void 0:v.querySelector("input"))==null||e.focus(),{success:!1,details:l}}f.value=!0;try{return{success:!0,result:await(g==null?void 0:g())}}catch(l){return{success:!1,details:l}}finally{f.value=!1}};function D(){if(!(m!=null&&m.value))return!1;const n=ye(m.value,p.value);return!(typeof n=="object"&&Object.keys(n).length===0)}return se(p,()=>{D()?x.value=!0:x.value=!1},{deep:!0}),ae(async()=>{f.value=!0,p.value={...h(),...(m==null?void 0:m.value)??{}},f.value=!1}),{form:q,formState:p,initialState:m,formElementsCategorized:o,isLoading:f,isChanged:x,validateInfos:k,validate:w,submit:O}},"form-builder-helper");function $e(){const d=Ie();if(d==null)throw new Error("Please call `useProvideFormBuilderHelper` on the appropriate parent component");return d}const Te={class:"nc-form-builder nc-scrollbar-thin relative"},Fe={key:0,class:"nc-form-section-title"},Be={class:"nc-form-section-body"},Ne={class:"flex flex-wrap"},Ae={class:"flex items-center gap-1"},Ce={key:0,class:"text-red-500"},Oe={class:"text-xs"},De={class:"flex items-center"},qe={class:"ml-[6px] font-bold"},Ee={class:"text-xs"},Pe={key:0,class:"w-full mt-1 pl-[35px]"},ze={class:"text-xs text-gray-500"},Ve={key:4,class:"w-full mt-1"},He={class:"text-xs text-gray-500"},Le={class:"flex items-center justify-center h-full w-full !bg-white !bg-opacity-85 z-1000"},Re=U({__name:"index",setup(d){const{form:F,formState:g,formElementsCategorized:m,isLoading:C,validateInfos:q}=$e(),f=o=>o.split(".").reduce((c,h)=>c[h],g.value),x=(o,c)=>{const h=o.split("."),p=h.pop();if(!p)return;const B=h.reduce((w,k)=>(w[k]||(w[k]={}),w[k]),g.value);B[p]=c};return(o,c)=>{const h=M,p=ie,B=ge,w=xe,k=_e,O=fe,D=we,n=Y,t=j,I=he;return r(),i("div",Te,[y(n,{ref_key:"form",ref:F,model:a(g),"hide-required-mark":"",layout:"vertical",class:"flex flex-col gap-4"},{default:b(()=>[(r(!0),i(E,null,V(Object.keys(a(m)),v=>(r(),i("div",{key:v,class:"nc-form-section"},[v!==("FORM_BUILDER_NON_CATEGORIZED"in o?o.FORM_BUILDER_NON_CATEGORIZED:a(Z))?(r(),i("div",Fe,_(v),1)):N("",!0),s("div",Be,[s("div",Ne,[(r(!0),i(E,null,V(a(m)[v],e=>(r(),i(E,{key:e.model},[e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:a(u)).Space?(r(),i("div",{key:0,style:ne(`width:${+e.width||100}%`),class:"w-full"},null,4)):(r(),A(D,le({key:1,ref_for:!0},a(q)[e.model],{class:"nc-form-item",style:`width:${+e.width||100}%`,required:!1,"data-testid":`nc-form-input-${e.model}`}),re({default:b(()=>[e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:a(u)).Input?(r(),A(B,{key:0,autocomplete:"off",class:"!w-full",value:f(e.model),"onUpdate:value":l=>x(e.model,l)},null,8,["value","onUpdate:value"])):e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:a(u)).Password?(r(),A(w,{key:1,readonly:"",onfocus:"this.removeAttribute('readonly');",onblur:"this.setAttribute('readonly', true);",autocomplete:"off",value:f(e.model),"onUpdate:value":l=>x(e.model,l)},null,8,["value","onUpdate:value"])):e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:a(u)).Select?(r(),A(k,{key:2,value:f(e.model),options:e.options,"onUpdate:value":l=>x(e.model,l)},null,8,["value","options","onUpdate:value"])):e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:a(u)).Switch?(r(),i("div",{key:3,class:ce(["flex flex-col p-2",e.border?"border-1 rounded-lg shadow":""])},[s("div",De,[y(O,{checked:!!f(e.model),"onUpdate:checked":l=>x(e.model,l)},null,8,["checked","onUpdate:checked"]),s("span",qe,_(e.label),1),e.helpText?(r(),A(p,{key:0},{title:b(()=>[s("div",Ee,_(e.helpText),1)]),default:b(()=>[y(h,{icon:"info",class:"text-gray-500 h-4 ml-1"})]),_:2},1024)):N("",!0)]),e.helpText&&!e.showHintAsTooltip?(r(),i("div",Pe,[s("div",ze,_(e.helpText),1)])):N("",!0)],2)):N("",!0),e.helpText&&e.type!==("FormBuilderInputType"in o?o.FormBuilderInputType:a(u)).Switch&&!e.showHintAsTooltip?(r(),i("div",Ve,[s("div",He,_(e.helpText),1)])):N("",!0)]),_:2},[[("FormBuilderInputType"in o?o.FormBuilderInputType:a(u)).Switch].includes(e.type)?void 0:{name:"label",fn:b(()=>[s("div",Ae,[s("span",null,_(e.label),1),e.required?(r(),i("span",Ce,"*")):N("",!0),e.helpText&&e.showHintAsTooltip?(r(),A(p,{key:1},{title:b(()=>[s("div",Oe,_(e.helpText),1)]),default:b(()=>[y(h,{icon:"info",class:"text-gray-500 h-4"})]),_:2},1024)):N("",!0)])]),key:"0"}]),1040,["style","data-testid"]))],64))),128))])])]))),128))]),_:1},8,["model"]),y(I,{"model-value":a(C),inline:"",transition:"",class:"!bg-opacity-15"},{default:b(()=>[s("div",Le,[y(t,{size:"large"})])]),_:1},8,["model-value"])])}}}),Ue=G(Re,[["__scopeId","data-v-dbf4ad9d"]]),Me={class:"flex flex-col h-full h-[calc(100vh_-_40px)]","data-testid":"nc-setup-config"},je={class:"flex gap-3 items-center"},Ge={"data-rec":"true"},Ye={class:"h-full flex h-[calc(100%_-_48px)]"},Ze={class:"nc-config-left-panel nc-scrollbar-thin relative h-full flex flex-col"},Ke={class:"w-full flex items-center gap-3 border-gray-200 py-6 px-6"},Qe={class:"font-semibold text-base"},Je={class:"flex gap-2"},We={class:"h-[calc(100%_-_48px)] flex py-4 flex-col p-6 overflow-auto"},Xe={key:0,class:"flex flex-row w-full justify-center items-center h-52"},et={key:1,class:"flex"},tt={class:"nc-config-right-panel"},ot={class:"flex-grow flex flex-col gap-3"},st={class:"text-gray-500 text-capitalize"},at=["href"],nt={class:"text-gray-500 text-capitalize"},lt={class:""},rt=U({__name:"Config",props:{id:{},modelValue:{type:Boolean}},emits:["saved","close","update:modelValue"],async setup(d,{emit:F}){let g,m;const C=d,f=ue(C,"modelValue",F),{readPluginDetails:x,activePluginFormData:o,activePlugin:c,isLoading:h,loadingAction:p,testSettings:B,saveSettings:w}=ke();[g,m]=pe(()=>x(C.id)),await g,m();const k={Input:u.Input,Select:u.Select,Checkbox:u.Switch,LongText:u.Input,Password:u.Password},{formState:O,validate:D,validateInfos:n}=Se({formSchema:[...c.value.formDetails.items.flatMap((e,l)=>[{type:k[e.type]||u.Input,label:e.label,placeholder:e.placeholder,model:e.key,required:e.required,helpText:e.help_text,width:"48",border:!1,showHintAsTooltip:!0},...l%2?[]:[{type:u.Space,width:"4"}]])],initialState:o}),t=async e=>{try{switch(e){case H.Save:await D(),o.value=O.value,await w(),f.value=!1;break;case H.Test:await D(),o.value=O.value,await B();break}}catch(l){console.log(l)}finally{p.value=null}},I=z(()=>Object.values(n||{}).every(e=>e.validateStatus!=="error")),v=z(()=>{var e,l,$,T;return[{title:"Application Setup",url:`https://docs.nocodb.com/account-settings/oss-specific-details#configure-${(l=(e=c.value)==null?void 0:e.category)==null?void 0:l.toLowerCase()}`},...((T=($=c.value)==null?void 0:$.formDetails)==null?void 0:T.docs)||[]]});return(e,l)=>{const $=te,T=oe,K=me,Q=j,J=Ue,W=M,X=be;return r(),i("div",Me,[y(T,null,{title:b(()=>[s("div",je,[y($,{app:a(c),class:"h-8 w-8"},null,8,["app"]),s("span",Ge,_(a(c).title),1)])]),_:1}),s("div",Ye,[s("div",Ze,[s("div",Ke,[s("span",Qe,_(e.$t("labels.configuration")),1),l[0]||(l[0]=s("div",{class:"flex-grow"},null,-1)),s("div",Je,[(r(!0),i(E,null,V(a(c).formDetails.actions,(S,ee)=>{var L;return r(),A(K,{key:ee,loading:a(p)===S.key,type:S.key===("Action"in e?e.Action:a(H)).Save?"primary":"default",size:"small",disabled:!!a(p)||!a(I),"data-testid":`nc-setup-config-action-${(L=S.key)==null?void 0:L.toLowerCase()}`,onClick:ct=>t(S.key)},{default:b(()=>[R(_(S.label),1)]),_:2},1032,["loading","type","disabled","data-testid","onClick"])}),128))])]),s("div",We,[a(h)||!a(c)?(r(),i("div",Xe,[y(Q,{size:"large"})])):(r(),i("div",et,[y(J,{class:"w-229 px-2 mx-auto"})]))])]),s("div",tt,[s("div",ot,[s("div",st,_(e.$t("labels.documentation")),1),(r(!0),i(E,null,V(a(v),S=>(r(),i("a",{key:S.title,href:S.url,target:"_blank",rel:"noopener noreferrer",class:"!no-underline !text-current flex gap-2 items-center"},[y(W,{icon:"bookOpen",class:"text-gray-500"}),R(" "+_(S.title),1)],8,at))),128)),y(X),s("div",nt,_(e.$t("labels.modifiedOn")),1),s("div",lt,_(a(de)(a(c).created_at).format("DD MMM YYYY HH:mm")),1)])])])])}}}),Dt=G(rt,[["__scopeId","data-v-4941accd"]]);export{Dt as default};
