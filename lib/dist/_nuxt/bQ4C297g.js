import{b as Z,a as ee,_ as te}from"./BpWFRerK.js";import{f as ae,az as g,cR as C,N as oe,cM as se,ai as ie,cU as le,cQ as $,r as n,H as D,O as ne,P as a,o as _,c as re,R as M,dm as ue,a as x,Q as U,U as S,aL as O,S as y,w as m,d as ce,t as me,b as h,T as ve,$ as de,a1 as pe,a0 as fe,A as _e}from"./3QBYHahY.js";import{_ as we}from"./Kma333Sh.js";import{u as A}from"./BVQBF9Vn.js";import"./C95Svpv6.js";import"./DAKhk9t6.js";import"./Bk0xUMNV.js";import"./CGxepfeV.js";import"./xnDaHwV-.js";import"./wEQwkVjR.js";import"./BsWDDIqE.js";import"./CmN9vPg3.js";import"./BQQOEPN4.js";import"./kHOslGNR.js";import"./DPgYHC40.js";import"./ceYq-xax.js";import"./BkiSZLeF.js";import"./CJ26qO3d.js";import"./CsJPQclb.js";import"./DQEIlAel.js";import"./ISaCd8Ij.js";import"./BV5EkxN-.js";import"./DPqnb67u.js";import"./CtMydB5S.js";import"./D4iSzjWt.js";import"./D7hrRKCy.js";import"./BEpKpjF5.js";import"./3ezdMRmZ.js";import"./leimKhvx.js";import"./CyuhXrst.js";import"./DdUr8XSo.js";import"./CoNP9Geb.js";import"./PcgFfkcK.js";const be={class:"flex items-center gap-0.5"},Ze=ae({__name:"OpenedViewAction",setup(Ve){const{activeTable:u}=g(C()),{isMobileMode:T}=oe(),{isSharedBase:N,base:R}=g(se()),{t:w}=ie(),{$api:z,$e:P}=_e(),{refreshCommandPalette:G}=le(),{activeView:e,views:K,viewsByTable:L}=g($()),{loadViews:Q,removeFromRecentViews:q}=$(),{navigateToTable:E}=C(),l=n(!1),F=n(!1),v=n(!1),c=n(),o=n(""),s=n(),H=async()=>{if(!e.value||!e.value.id)return;P("c:view:description");const t=n(!0);l.value=!1;const{close:i}=A(Z,{modelValue:t,view:e.value,"onUpdate:modelValue":r});function r(){t.value=!1,i(1e3)}},j=()=>{v.value=!0,l.value=!1,o.value=e.value.title,setTimeout(()=>{c.value.focus()})};D(c,()=>{var t;(t=c.value)==null||t.focus()});const I=async()=>{var t;J()?(e.value.title=o.value,v.value=!1,s.value=void 0,await z.dbView.update(e.value.id,{title:o.value})):(t=c.value)==null||t.focus()};function J(){return!o.value||o.value.trim().length<0?(s.value=w("msg.error.viewNameRequired"),!1):o.value.trim().length>255?(s.value=w("msg.error.nameMaxLength256"),!1):K.value.some(t=>t.title===o.value&&t.id!==e.value.id)?(s.value=w("msg.error.viewNameDuplicate"),!1):!0}D(o,()=>{s.value&&(s.value=void 0)}),D(l,()=>{setTimeout(()=>{F.value=!1},250)});const W=()=>{o.value=e.value.title,v.value=!1};function X(){const t=n(!0);l.value=!1;const{close:i}=A(ee,{modelValue:t,view:e.value,"onUpdate:modelValue":r,onDeleted:async()=>{var d,p;r(),q({viewId:e.value.id,tableId:e.value.fk_model_id,baseId:R.value.id}),G(),((d=e.value)==null?void 0:d.id)===e.value.id&&E({tableId:u.value.id,baseId:R.value.id}),await Q({tableId:u.value.id,force:!0});const b=((p=L.value.get(u.value.id))==null?void 0:p.filter(V=>!V.is_default))??[];u.value.meta={...u.value.meta,hasNonDefaultViews:b.length>1}}});function r(){t.value=!1,i(1e3)}}return(t,i)=>{var B,k;const r=de,b=pe,d=fe,p=te,V=we,Y=ne("e");return a(v)?(_(),re("div",{key:0,class:S(["h-6 relative",{"max-w-2/5":!a(N)&&!a(T)&&((B=a(e))==null?void 0:B.is_default),"max-w-3/5":!a(N)&&!a(T)&&!((k=a(e))!=null&&k.is_default)}])},[M(x("input",{ref_key:"renameInputDom",ref:c,"onUpdate:modelValue":i[0]||(i[0]=f=>U(o)?o.value=f:null),class:S(["ml-0.25 w-full px-1 py-0.5 rounded-md font-medium text-gray-800",{"outline-brand-500":!a(s),"outline-red-500 pr-6":a(s)}]),onBlur:I,onKeydown:[O(I,["enter"]),O(W,["esc"])]},null,34),[[ue,a(o)]]),a(s)?(_(),y(b,{key:0,class:"absolute top-0.25 right-0.5 bg-white rounded-lg"},{title:m(()=>[ce(me(a(s)),1)]),default:m(()=>[h(r,{icon:"info",class:"cursor-pointer"})]),_:1})):ve("",!0)],2)):(_(),y(V,{key:1,visible:a(l),"onUpdate:visible":i[2]||(i[2]=f=>U(l)?l.value=f:null),class:"!xs:pointer-events-none nc-actions-menu-btn nc-view-context-btn","overlay-class-name":"nc-dropdown-actions-menu"},{overlay:m(()=>[h(p,{table:a(u),view:a(e),onCloseModal:i[1]||(i[1]=f=>l.value=!1),onRename:j,onDelete:X,onDescriptionUpdate:H},null,8,["table","view"])]),default:m(()=>[x("div",null,[M((_(),y(d,{class:"nc-view-action-menu-btn nc-toolbar-btn !border-0 !h-7 !px-1.5 !min-w-7",size:"small",type:"secondary"},{default:m(()=>[x("div",be,[h(r,{icon:"threeDotVertical",class:"!h-4 !w-4"})])]),_:1})),[[Y,["c:toolbar:view-actions"]]])])]),_:1},8,["visible"]))}}});export{Ze as default};
