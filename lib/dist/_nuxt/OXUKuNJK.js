import{f as ne,bL as k,r as m,d0 as oe,c$ as se,d1 as le,fB as ie,g,H as D,cU as V,cV as re,O as ce,P as n,o,U as p,w as r,c as f,Y as de,al as M,am as N,a as l,t as v,b as h,d as R,V as U,W as B,S as y,Q as T,R as ue,an as j,a2 as me,ap as _e,$ as pe,p as fe,e as ve,A as he,_ as we}from"./DKhUGBot.js";import{_ as ke}from"./jbOQaGBo.js";import{_ as ge}from"./C600yAEI.js";import{_ as ye}from"./C9s6MY6c.js";import{_ as be}from"./B5mlyM8k.js";import{a as xe}from"./BMlI7u7p.js";import{a as Ce}from"./6zAE39KB.js";import{S as Se}from"./CX4Cv_ut.js";import"./DDp3Vqr0.js";import"./lyxpGZoZ.js";import"./DL47xb_5.js";import"./DFT4Rrrq.js";import"./DNxjIm4c.js";import"./CUg8TjpL.js";import"./DGy9VVU7.js";import"./D-d1Vlq3.js";import"./Ce4Hnuew.js";import"./DEJjMRn_.js";import"./BQQOEPN4.js";import"./DX_5E9FR.js";import"./BOlDoh1A.js";const Ie=w=>(fe("data-v-59f3d036"),w=w(),ve(),w),$e={class:"nc-calendar-btn"},De={class:"flex items-center gap-2"},Ve={class:"text-capitalize !group-hover:text-brand-500 !text-[13px] font-medium"},Me={class:"flex w-full gap-2 justify-between items-center"},Ne={class:"flex items-center"},Re={key:0,class:"flex items-center gap-2 !mt-2"},Ue=Ie(()=>l("span",{class:"text-sm text-gray-500"}," Date field is required! ",-1)),Be={class:"text-gray-800"},Te=ne({__name:"Range",setup(w){const x=k(oe,m()),{$api:P}=he(),i=k(se,m()),O=k(le,m(!1)),A=k(ie,m(!1)),{loadViewColumns:L}=xe(),{loadCalendarMeta:W,loadCalendarData:z,loadSidebarData:E,fetchActiveDates:F,updateCalendarMeta:H,viewMetaProperties:q}=Ce(),c=m(!1),b=g({get:()=>{var e;return((e=q.value)==null?void 0:e.hide_weekend)??!1},set:e=>{H({meta:{hide_weekend:e}})}});D(()=>{var e;return(e=i.value)==null?void 0:e.id},async(e,a)=>{e!==a&&x.value&&await L()},{immediate:!0});const C=g(()=>{var a;const e=[];return!i.value||!i.value.view||(a=i.value.view.calendar_range)==null||a.forEach(t=>{e.push({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id})}),e}),u=m(C.value),S=g(()=>u.value.length>0&&u.value[0].fk_from_column_id);D(c,e=>{!e&&!S.value&&(c.value=!0,u.value.length===0&&u.value.push({fk_from_column_id:void 0,fk_to_column_id:null}))},{immediate:!0});const G=async()=>{var e;if(i.value)try{const a=u.value.filter(t=>t.fk_from_column_id).map(t=>({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id}));await P.dbView.calendarUpdate((e=i.value)==null?void 0:e.id,{calendar_range:a}),i.value.view&&(i.value.view.calendar_range=a),await W(),await Promise.all([z(),E(),F()]),c.value=!1}catch(a){console.log(a),j.error("There was an error while updating view!")}else j.error("Please select a view first")},I=g(()=>{var e,a;return((a=(e=x.value)==null?void 0:e.columns)==null?void 0:a.filter(t=>t.uidt===V.Date||t.uidt===V.DateTime&&!re(t)).map(t=>({label:t.title,value:t.id,uidt:t.uidt})))??[]});return(e,a)=>{const t=me,Q=ke,Y=_e,J=Se,K=ge,X=pe,Z=ye,ee=be,ae=ce("e");return n(A)?y("",!0):(o(),p(ee,{key:0,visible:n(c),"onUpdate:visible":a[2]||(a[2]=d=>T(c)?c.value=d:null),trigger:["click"],class:"!xs:hidden"},{overlay:r(()=>[n(c)?(o(),f("div",{key:0,class:"w-98 space-y-6 rounded-2xl p-6","data-testid":"nc-calendar-range-menu",onClick:a[1]||(a[1]=de(()=>{},["stop"]))},[(o(!0),f(M,null,N(n(u),(d,$)=>(o(),f("div",{key:$,class:"flex w-full gap-2 mb-2 items-center","data-testid":"nc-calendar-range-option"},[l("span",null,v(e.$t("labels.organiseBy")),1),h(K,{value:d.fk_from_column_id,"onUpdate:value":s=>d.fk_from_column_id=s,placeholder:e.$t("placeholder.notSelected"),"data-testid":"nc-calendar-range-from-field-select",onChange:G},{default:r(()=>[(o(!0),f(M,null,N([...n(I)??[]].filter(s=>{if($===0)return!0;const _=(n(I)??[]).find(te=>te.value===n(C)[0].fk_from_column_id);return(_==null?void 0:_.uidt)===s.uidt}),(s,_)=>(o(),p(J,{key:_,class:"w-40",value:s.value},{default:r(()=>[l("div",Me,[l("div",Ne,[h(Q,{column:s},null,8,["column"]),h(Y,{class:"truncate flex-1 max-w-18",placement:"top","show-on-truncate-only":""},{title:r(()=>[R(v(s.label),1)]),default:r(()=>[R(" "+v(s.label),1)]),_:2},1024)]),s.value===d.fk_from_column_id?(o(),p(U(("iconMap"in e?e.iconMap:n(B)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary min-w-4 h-4"})):y("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]))),128)),n(S)?y("",!0):(o(),f("div",Re,[h(X,{icon:"warning",class:"text-sm mt-0.5 text-orange-500"}),Ue])),l("div",null,[h(Z,{checked:n(b),"onUpdate:checked":a[0]||(a[0]=d=>T(b)?b.value=d:null)},{default:r(()=>[l("span",Be,v(e.$t("activity.hideWeekends")),1)]),_:1},8,["checked"])])])):y("",!0)]),default:r(()=>[l("div",$e,[ue((o(),p(t,{disabled:n(O),class:"nc-toolbar-btn !border-0 group !h-6",size:"small",type:"secondary","data-testid":"nc-calendar-range-btn"},{default:r(()=>[l("div",De,[(o(),p(U(("iconMap"in e?e.iconMap:n(B)).calendar),{class:"h-4 w-4 transition-all group-hover:text-brand-500"})),l("span",Ve,v(e.$t("activity.settings")),1)])]),_:1},8,["disabled"])),[[ae,["c:calendar:change-calendar-range"]]])])]),_:1},8,["visible"]))}}}),na=we(Te,[["__scopeId","data-v-59f3d036"]]);export{na as default};
