const __vite__fileDeps=["./BVHyv0aP.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./BIhr-Z4C.js","./ByVBARmO.js","./C4K5fdHe.js","./VirtualCell.BYk4C8Tn.css","./DG2ZH8TR.js","./CA74dF2b.js","./GMLocJHP.js","./qW2V2r_p.js","./boyBAVNN.js","./BDAIZopQ.js","./Cell.DUBzJZSm.css","./Co32XBKZ.js","./VirtualCell.Dgszrgh-.css","./Dby8gS7l.js","./37hePIet.js","./Cell.CE2XxAOg.css","./Tryc0omP.js","./Fr_cZ1zf.js","./QHHXY-Ma.js","./D_MsYLkT.js","./BCJFTkwv.js","./BQQOEPN4.js","./CB1aB6F1.js","./B5RRVMt5.js","./vll-Pnjv.js","./Pagination.D7qN7qzC.css","./uskrw1rV.js","./DXQuLwNn.js","./BmtvKY7O.js","./BLzs_b5A.js","./DKN1hQ6S.js","./BQuyMdA-.js","./DGj1ycqW.js","./DyDFI6NE.js","./Pagination.Sdu4RSaT.css","./CRPCEw5j.js","./sz1d3zjm.js","./MenuItem.C7h59s4s.css","./TJfB7GlU.js","./0azk-b-q.js","./Divider.DqtSqZhb.css","./BLgccLvp.js","./Menu.CQ8GNWeI.css","./vK-WmZ7a.js","./B9n4-CGo.js","./DivDataCell.1yCNpUg3.css","./DnwRMKX3.js","./UserIcon.DEVmGavY.css","./B6xrG0q8.js","./B89oU1M4.js","./Badge.D0-UrqG9.css","./BmNyaTYf.js","./Cy50pBgZ.js","./links.C8uCzV-l.css","./Dwil3It4.js","./uhBJvRY2.js","./DS_HXCWn.js","./CMIIcM5i.js","./Bgw0NQgX.js","./2FgppHLC.js","./C4o9gerC.js","./B05h-4V9.js","./Ck-cgwga.js","./Tabs.DaLSLYpn.css","./BqKQ8afS.js","./DgixBgIx.js","./DeleteModal.SEMJ_gSK.css","./CXD-Dj4T.js","./i4aLU0Nw.js","./EqBqqo9-.js","./Bdv7ru7D.js","./index.XURKHfTB.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as Ge,bL as I,r as c,d7 as He,d6 as qe,hG as Je,gT as We,dJ as Xe,hH as Ye,dz as Ke,ax as Qe,cO as Ze,az as R,aD as et,i3 as tt,i2 as ot,ib as at,i1 as nt,hA as lt,K as st,u as rt,L as it,f as b,dc as ut,iC as W,J as dt,k as ct,a$ as mt,iw as pt,F as _t,d4 as ft,M as yt,o as n,c as r,b as _,w as d,N as t,Q as i,P as we,T as X,U as Y,d as F,t as K,R as w,a as m,S as Q,a8 as vt,ao as v,at as z,cm as wt,f$ as Z,O as M,dH as ge,ia as he,X as g,a4 as h,Y as gt,Z as ht,fF as kt,_ as xt}from"./DZZ6t_j4.js";import{_ as It}from"./sz1d3zjm.js";import{_ as bt}from"./TJfB7GlU.js";import{_ as Rt}from"./BLgccLvp.js";import{_ as Vt}from"./vK-WmZ7a.js";import{a as Ct}from"./B05h-4V9.js";import{a as Dt}from"./Bvfp7LPc.js";import{u as Et}from"./RXURfzjs.js";import{D as jt,C as ke}from"./C4K5fdHe.js";import{k as xe,e as zt,f as At}from"./BDAIZopQ.js";import{i as Pt}from"./C00NHga8.js";import{_ as Lt}from"./C9pR2Nv2.js";import{S as St}from"./BmtvKY7O.js";import{_ as $t}from"./CVMW45vd.js";import"./0azk-b-q.js";import"./GMLocJHP.js";import"./ByVBARmO.js";import"./DXQuLwNn.js";const Nt=g(()=>h(()=>import("./BVHyv0aP.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(s=>s.default||s)),Tt=g(()=>h(()=>import("./BIhr-Z4C.js"),__vite__mapDeps([3,1,2,4,5,6]),import.meta.url).then(s=>s.default||s)),Ft=g(()=>h(()=>import("./DG2ZH8TR.js"),__vite__mapDeps([7,1,2,8,9,10,4,11,12,5,13]),import.meta.url).then(s=>s.default||s)),Mt=g(()=>h(()=>import("./Co32XBKZ.js"),__vite__mapDeps([14,1,2,4,12,15]),import.meta.url).then(s=>s.default||s)),Ot=g(()=>h(()=>import("./Dby8gS7l.js"),__vite__mapDeps([16,1,2,17,5,18]),import.meta.url).then(s=>s.default||s)),Ut=g(()=>h(()=>import("./Tryc0omP.js"),__vite__mapDeps([19,8,9,1,2,10,4,11,12]),import.meta.url).then(s=>s.default||s)),Bt=g(()=>h(()=>import("./Fr_cZ1zf.js"),__vite__mapDeps([20,21,1,2,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url).then(s=>s.default||s)),Gt=g(()=>h(()=>import("./CRPCEw5j.js"),__vite__mapDeps([38,1,2,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,33,34,24,27,26,35,36,56,57,58,59,60,61,9,12,62,8,10,4,11,63,64,65,66,67,68,69,70,71,72,73,31,30,74]),import.meta.url).then(s=>s.default||s)),Ht={class:"flex items-center gap-2"},qt={class:"flex items-center gap-2"},Jt={key:0,class:"flex flex-col h-full"},Wt={class:"nc-gallery-container-skeleton grid gap-3 p-3"},Xt={key:1,class:"nc-gallery-container grid gap-3 p-3"},Yt={class:"z-10 arrow"},Kt={class:"z-10 arrow"},Qt={key:1,class:"h-52 w-full !flex flex-row !border-b-1 !border-gray-200 items-center justify-center"},Zt={class:"flex flex-col gap-3 !children:pointer-events-none"},eo={key:0,class:"nc-card-display-value-wrapper"},to=["onClick"],oo={class:"flex flex-col rounded-lg w-full"},ao={class:"flex flex-row w-full justify-start"},no={class:"nc-card-col-header w-full !children:text-gray-500"},lo={key:0,class:"flex flex-row w-full text-gray-800 items-center justify-start min-h-7 py-1"},so={key:1,class:"flex flex-row w-full h-7 pl-1 items-center justify-start"},ro={class:"flex items-center gap-2"},io=Ge({__name:"Gallery",setup(s){const f=I(He,c()),A=I(qe,c()),O=I(Je),P=I(We),V=I(Ye,Xe()),U=I(Ke,c(!1)),{isViewDataLoading:L}=Qe(Ze()),{isSqlView:ee,xWhere:Ie}=Ct(),C=c(!1),D=c(),te=c(),{loadData:oe,paginationData:B,formattedData:G,loadGalleryData:ae,galleryData:H,changePage:be,deleteRow:Re,navigateToSiblingRow:ne}=Dt(f,A,Ie);R(et,c(!1)),R(tt,c(!0)),R(ot,c(!1)),R(at,c(!1)),R(nt,c(1));const le=I(lt,c([])),S=st(),se=rt(),{getPossibleAttachmentSrc:Ve}=Et(),{isMobileMode:Ce}=it(),De=b(()=>le.value.filter(e=>!jt(e))),y=b(()=>{var e,o;return((o=(e=f.value)==null?void 0:e.columns)==null?void 0:o.find(u=>u.pv&&le.value.includes(u)))??null}),E=b(()=>{var e,o;return(e=f.value)!=null&&e.columnsById?f.value.columnsById[(o=H.value)==null?void 0:o.fk_cover_image_col_id]:{}}),Ee=b(()=>{var o,u;const e=((u=ut((o=H.value)==null?void 0:o.meta))==null?void 0:u.fk_cover_image_object_fit)||W.FIT;if(e===W.FIT)return"!object-contain";if(e===W.COVER)return"!object-cover"}),{isUIAllowed:re}=dt(),je=b(()=>re("dataEdit")),ie=c(!1),$=b({get:()=>ie.value,set:e=>{je.value&&(ie.value=e)}}),j=c(null),ze=(e,o)=>{ee.value||(e.preventDefault(),o&&(j.value=o))},ue=e=>{var o;if(!((o=E.value)!=null&&o.title)||!e.row[E.value.title])return[];try{const u=typeof e.row[E.value.title]=="string"?JSON.parse(e.row[E.value.title]):e.row[E.value.title];return Array.isArray(u)?u.flat().map(p=>typeof p=="string"?JSON.parse(p):p).filter(p=>p&&!Array.isArray(p)&&typeof p=="object"&&Object.keys(p).length):[]}catch{return[]}},N=(e,o)=>{const u=zt(e.row,f.value.columns);te.value=o,u&&!U.value?(D.value=void 0,se.push({query:{...S.query,rowId:u}})):(D.value=e,C.value=!0)},de=async(e,o)=>{const u=e.target;u.closest(".arrow")||u.closest(".slick-dots")||N(o)},ce=async()=>{var e;N({row:{...At((e=f.value)==null?void 0:e.columns)},oldRow:{},rowMeta:{new:!0}})},Ae=(e,o)=>{ke(e)&&o.stopPropagation()};V==null||V.on(ce),ct(()=>V.off(ce));const T=b({get(){return!!S.query.rowId},set(e){e||se.push({query:{...S.query,rowId:void 0}})}}),q=c(!1);return O==null||O.on(async()=>{await ae(),q.value=!0,mt(()=>{q.value=!1})}),P==null||P.on(async e=>{await oe({...(e==null?void 0:e.offset)!==void 0?{offset:e.offset}:{}})}),R(pt,P),_t(A,async e=>{L.value=!0;try{(e==null?void 0:e.type)===ft.GALLERY&&(await oe(),await ae())}finally{L.value=!1}},{immediate:!0}),(e,o)=>{const u=It,p=bt,Pe=Rt,Le=St,me=gt,J=ht,Se=Nt,$e=$t,pe=Tt,_e=Ft,Ne=Mt,Te=Ot,Fe=kt,Me=Ut,Oe=Vt,Ue=Bt,fe=Gt,ye=yt("e");return n(),r(v,null,[_(Oe,{visible:t($),"onUpdate:visible":o[3]||(o[3]=a=>M($)?$.value=a:null),trigger:t(ee)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:d(()=>[_(Pe,{onClick:o[2]||(o[2]=a=>$.value=!1)},{default:d(()=>{var a;return[t(j)?(n(),i(u,{key:0,onClick:o[0]||(o[0]=k=>N(t(j).row))},{default:d(()=>[we((n(),r("div",Ht,[(n(),i(X(("iconMap"in e?e.iconMap:t(Y)).expand),{class:"flex"})),F(" "+K(e.$t("activity.expandRecord")),1)])),[[ye,["a:row:expand-record"]]])]),_:1})):w("",!0),_(p),((a=t(j))==null?void 0:a.index)!==void 0?(n(),i(u,{key:1,class:"!text-red-600 !hover:bg-red-50",onClick:o[1]||(o[1]=k=>t(Re)(t(j).index))},{default:d(()=>[we((n(),r("div",qt,[(n(),i(X(("iconMap"in e?e.iconMap:t(Y)).delete),{class:"flex"})),F(" "+K(e.$t("activity.deleteRow")),1)])),[[ye,["a:row:delete"]]])]),_:1})):w("",!0)]}),_:1})]),default:d(()=>[m("div",{class:Q(["flex flex-col w-full nc-gallery nc-scrollbar-md bg-gray-50",{"!overflow-hidden":t(L)}]),"data-testid":"nc-gallery-wrapper",style:vt({height:t(Ce)?"calc(100% - var(--topbar-height))":"calc(100% - var(--topbar-height) + 0.6rem)"})},[t(L)?(n(),r("div",Jt,[m("div",Wt,[(n(!0),r(v,null,z(Array(20),a=>(n(),i(Le,{key:a,class:"!min-w-60.5 !h-96 !rounded-md overflow-hidden"}))),128))])])):(n(),r("div",Xt,[(n(!0),r(v,null,z(t(G),(a,k)=>(n(),r("div",{key:`record-${a.row.id}`},[_(Me,{row:a},{default:d(()=>{var ve;return[_(Fe,{class:"!rounded-xl h-full border-gray-200 border-1 group overflow-hidden break-all max-w-[450px] cursor-pointer","body-style":{padding:"16px !important"},"data-testid":`nc-gallery-card-${a.row.id}`,onClick:l=>de(l,a),onContextmenu:l=>ze(l,{row:a,index:k})},wt({default:d(()=>[m("div",Zt,[t(y)?(n(),r("h2",eo,[("isRowEmpty"in e?e.isRowEmpty:t(xe))(a,t(y))?(n(),r(v,{key:1},[F(" - ")],64)):(n(),r(v,{key:0},[t(Z)(t(y))?(n(),i(pe,{key:0,modelValue:a.row[t(y).title],"onUpdate:modelValue":l=>a.row[t(y).title]=l,class:"!text-brand-500",column:t(y),row:a},null,8,["modelValue","onUpdate:modelValue","column","row"])):(n(),i(_e,{key:1,modelValue:a.row[t(y).title],"onUpdate:modelValue":l=>a.row[t(y).title]=l,class:"!text-brand-500",column:t(y),"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))],64))])):w("",!0),(n(!0),r(v,null,z(t(De),l=>(n(),r("div",{key:`record-${a.row.id}-${l.id}`,class:Q({"!children:pointer-events-auto":("isButton"in e?e.isButton:t(ke))(l)}),onClick:x=>Ae(l,x)},[m("div",oo,[m("div",ao,[m("div",no,[t(Z)(l)?(n(),i(Ne,{key:0,column:l,"hide-menu":!0},null,8,["column"])):(n(),i(Te,{key:1,column:l,"hide-menu":!0},null,8,["column"]))])]),("isRowEmpty"in e?e.isRowEmpty:t(xe))(a,l)?(n(),r("div",so,"-")):(n(),r("div",lo,[t(Z)(l)?(n(),i(pe,{key:0,modelValue:a.row[l.title],"onUpdate:modelValue":x=>a.row[l.title]=x,column:l,row:a,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column","row"])):(n(),i(_e,{key:1,modelValue:a.row[l.title],"onUpdate:modelValue":x=>a.row[l.title]=x,column:l,"edit-enabled":!1,"read-only":!0,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column"]))]))])],10,to))),128))])]),_:2},[(ve=t(H))!=null&&ve.fk_cover_image_col_id?{name:"cover",fn:d(()=>[!t(q)&&ue(a).length?(n(),i($e,{key:0,class:"gallery-carousel !border-b-1 !border-gray-200 min-h-52",arrows:""},{customPaging:d(()=>o[9]||(o[9]=[m("a",null,[m("div",null,[m("div")])],-1)])),prevArrow:d(()=>[m("div",Yt,[_(J,{type:"secondary",size:"xsmall",class:"!absolute !left-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:d(()=>[_(me,{icon:"arrowLeft",class:"text-gray-700 w-4 h-4"})]),_:1})])]),nextArrow:d(()=>[m("div",Kt,[_(J,{type:"secondary",size:"xsmall",class:"!absolute !right-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:d(()=>[_(me,{icon:"arrowRight",class:"text-gray-700 w-4 h-4"})]),_:1})])]),default:d(()=>[(n(!0),r(v,null,z(ue(a),(l,x)=>(n(),r(v,null,[("isImage"in e?e.isImage:t(Pt))(l.title,l.mimetype??l.type)?(n(),i(Se,{key:`carousel-${a.row.id}-${x}`,class:Q(["h-52",[`${t(Ee)}`]]),srcs:t(Ve)(l,"card_cover"),onClick:Be=>de(Be,a)},null,8,["class","srcs","onClick"])):w("",!0)],64))),256))]),_:2},1024)):(n(),r("div",Qt,o[10]||(o[10]=[m("img",{class:"object-contain w-[48px] h-[48px]",src:Lt},null,-1)])))]),key:"0"}:void 0]),1032,["data-testid","onClick","onContextmenu"])]}),_:2},1032,["row"])]))),128)),t(G).length<=4?(n(!0),r(v,{key:0},z(Array(8-t(G).length),a=>(n(),r("div",{key:a,class:"nc-empty-card"}))),128)):w("",!0)]))],6)]),_:1},8,["visible","trigger"]),_(Ue,{"pagination-data":t(B),"onUpdate:paginationData":o[4]||(o[4]=a=>M(B)?B.value=a:null),"align-count-on-right":"","show-api-timing":"","change-page":t(be),class:""},{"add-record":d(()=>[t(re)("dataInsert")?(n(),i(J,{key:0,size:"xs",type:"secondary",class:"ml-2",onClick:t(V).trigger},{default:d(()=>[m("div",ro,[(n(),i(X(("iconMap"in e?e.iconMap:t(Y)).plus),{class:""})),F(" "+K(e.$t("activity.newRecord")),1)])]),_:1},8,["onClick"])):w("",!0)]),_:1},8,["pagination-data","change-page"]),(n(),i(ge,null,{default:d(()=>[t(D)&&t(C)?(n(),i(fe,{key:0,modelValue:t(C),"onUpdate:modelValue":o[5]||(o[5]=a=>M(C)?C.value=a:null),row:t(D),"load-row":!t(U),state:t(te),meta:t(f),view:t(A)},null,8,["modelValue","row","load-row","state","meta","view"])):w("",!0)]),_:1})),(n(),i(ge,null,{default:d(()=>{var a;return[t(T)&&((a=t(f))!=null&&a.id)?(n(),i(fe,{key:0,modelValue:t(T),"onUpdate:modelValue":o[6]||(o[6]=k=>M(T)?T.value=k:null),row:t(D)??{row:{},oldRow:{},rowMeta:{}},meta:t(f),"load-row":!t(U),"row-id":t(S).query.rowId,view:t(A),"show-next-prev-icons":"","expand-form":N,onNext:o[7]||(o[7]=k=>t(ne)(("NavigateDir"in e?e.NavigateDir:t(he)).NEXT)),onPrev:o[8]||(o[8]=k=>t(ne)(("NavigateDir"in e?e.NavigateDir:t(he)).PREV))},null,8,["modelValue","row","meta","load-row","row-id","view"])):w("",!0)]}),_:1}))],64)}}}),Do=xt(io,[["__scopeId","data-v-f0e4ead6"]]);export{Do as default};
