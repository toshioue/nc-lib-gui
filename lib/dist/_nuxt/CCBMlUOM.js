import{f as nt,ai as st,cP as rt,bL as dt,r as S,d1 as ut,cG as ct,at as pt,i1 as ft,g as oe,cV as mt,L as vt,cU as O,aA as _t,cN as he,fx as ae,cM as gt,ic as je,H as Ee,i as yt,fP as ht,ib as Me,o as f,c as X,a as m,P as i,b as d,al as be,w as s,U as w,S as P,Q as bt,d as T,t as y,cd as kt,T as M,V as Ue,W as Re,Y as pe,fG as wt,aF as ze,cD as xt,A as Ct,hK as Ft,hL as Ot,an as Y,a_ as $t,fw as Tt,$ as It,a2 as At,ap as St,gH as Lt,p as Nt,e as Dt,_ as Vt}from"./BLdk6lRf.js";import{_ as jt}from"./CDdKupVi.js";import Et from"./DehHWxa3.js";import Mt from"./CKK7YKGi.js";import{_ as Ut}from"./ImiwO6hR.js";import{_ as Rt}from"./DMNHEWRT.js";import{_ as zt}from"./CsKtxyeB.js";import{_ as Kt}from"./BaHXy0hV.js";import{c as Ke,_ as Ht}from"./D4vTL36A.js";import{a as Pt}from"./BtPl72f0.js";import{a as Bt}from"./KocR1J4Z.js";import{k as qt}from"./CwqgNcWF.js";import{_ as Wt}from"./DkVxy4dl.js";import{D as Gt}from"./DJNpGLJk.js";import{S as Qt}from"./ByxI50E5.js";import"./JimKVLH8.js";import{I as Xt}from"./DWFLnnq8.js";import"./C9I3jrHo.js";import"./C0Si9_oy.js";import"./BD_L_KCX.js";import"./CSxPNiqH.js";import"./DV47GYLy.js";import"./B0-3_x1m.js";import"./BWqs1SG-.js";import"./BwgB2nHU.js";import"./D13eUeY3.js";import"./DD6KJAAC.js";import"./JCToPTxN.js";import"./BLwY008C.js";import"./CBNgcPSC.js";import"./wBAlULwF.js";import"./BYLX6PMP.js";import"./DRbVe3tA.js";import"./BFWmkR58.js";import"./Cajlse94.js";import"./DZeneEWs.js";import"./BrF0EXdL.js";import"./BQQOEPN4.js";import"./DTv03lbO.js";import"./C-Z2v8Hi.js";import"./KHtB3uuq.js";import"./DCNkOWj0.js";import"./BTh9o-aK.js";import"./CeUmvK4L.js";import"./yAvBJhn8.js";import"./C9Sjn86N.js";import"./B2oTMMt7.js";import"./CAR_5qDD.js";import"./Df7iec88.js";import"./iRN6wbuV.js";import"./BpBaP95G.js";import"./ZMTPBx1J.js";import"./DTl_5Njz.js";import"./L-4v1RNB.js";import"./ETGzLqdt.js";const Yt=""+new URL("multi-field-editor.DjOPELNE.png",import.meta.url).href,ke=k=>k instanceof Date,Jt=k=>Object.keys(k).length===0,xe=k=>k!=null&&typeof k=="object",He=(k,...F)=>Object.prototype.hasOwnProperty.call(k,...F),we=k=>xe(k)&&Jt(k),Zt=()=>Object.create(null),Ce=(k,F)=>{if(k===F)return{};if(!xe(k)||!xe(F))return F;const Z=Object.keys(k).reduce((B,h)=>(He(F,h)||(B[h]=void 0),B),Zt());return ke(k)||ke(F)?k.valueOf()==F.valueOf()?{}:F:Object.keys(F).reduce((B,h)=>{if(!He(k,h))return B[h]=F[h],B;const W=Ce(k[h],F[h]);return we(W)&&!ke(W)&&(we(k[h])||!we(F[h]))||(B[h]=W),B},Z)},el=k=>(Nt("data-v-62f1108f"),k=k(),Dt(),k),tl={class:"nc-fields-wrapper w-full p-4"},ll={class:"max-w-250 h-full w-full mx-auto"},il={key:0,class:"flex flex-row justify-between mt-2"},ol={class:"flex flex-row gap-x-4"},al={class:"flex w-full justify-between py-2"},nl={class:"flex gap-2"},sl={class:"flex items-center gap-2"},rl={class:"flex flex-row rounded-lg border-1 overflow-clip border-gray-200"},dl=["data-testid","onClick"],ul={class:"flex items-center flex-1 py-2.5 gap-1 w-2/6"},cl={"data-testid":"nc-field-title"},pl={class:"flex items-center justify-end gap-1"},fl={class:"nc-field-status-wrapper flex items-center"},ml={class:"flex items-center text-xs gap-1"},vl=["onClick"],_l={class:"flex flex-row items-baseline gap-x-1 font-bold text-xs"},gl={class:"text-gray-600"},yl={class:"flex flex-row text-gray-600 text-xs","data-testid":"nc-field-item-id"},hl={class:"text-red-500"},bl=["data-testid"],kl={class:"flex items-center flex-1 py-2.5 gap-1 w-2/6"},wl={"data-testid":"nc-field-title"},xl={class:"flex items-center justify-end gap-1"},Cl={class:"flex items-center"},Fl={class:"flex items-center text-xs gap-1"},Ol={class:"flex flex-row items-baseline gap-x-1 font-bold text-xs"},$l={class:"text-gray-600"},Tl={class:"flex flex-row text-gray-600 text-xs"},Il={key:1,class:"w-[25rem] flex flex-col justify-center p-4 items-center"},Al=el(()=>m("img",{src:Yt,class:"!w-[18rem]"},null,-1)),Sl={class:"text-2xl text-gray-600 font-bold text-center pt-6"},Ll={class:"text-center text-sm px-2 text-gray-500 pt-6"},Nl=nt({__name:"Fields",setup(k){const{t:F}=st(),{$api:Z}=Ct(),{getMeta:B}=rt(),{meta:h,view:W}=Pt(),I=dt(ut,S(!1)),Fe=ct(),{openedViewsTab:ne}=pt(Fe),G=S([]),V=S([]),z=S([]),se=S(),{copy:Pe}=ft(),{fields:fe,toggleFieldVisibility:Be,loadViewColumns:qe,isViewColumnsLoading:We}=Bt(),Q=S(!1),re=S(),q=S([]),de=S(!1),r=(e,t)=>e!=null&&e.id&&(t!=null&&t.id)?e.id===t.id:e!=null&&e.temp_id&&(t!=null&&t.temp_id)?e.temp_id===t.temp_id:!1,ue=oe(()=>{const e={};if(fe.value)for(const t of fe.value)t.fk_column_id&&(e[t.fk_column_id]=t);return e}),ee=e=>{if(!e)return-1;const t=V.value.find(l=>r(l.column,e));if(t)return t.order;if(e.id){const l=ue.value[e.id];if(l)return l.order}return-1},v=oe({get:()=>(G.value??[]).filter(t=>!t.fk_column_id&&!mt(t)).concat(q.value).map(t=>et(t)).sort((t,l)=>ee(t)-ee(l)),set:e=>{var t;G.value=(t=G.value)==null?void 0:t.map(l=>{const o=e.find(_=>r(_,l));return o||l})}}),n=S(),J=S(""),me=(e,t=!1)=>{if(!fe.value)return-1;if(e<=0){const x=v.value.find(j=>j.pv);return x?x.order||0:-1}if(e>=v.value.length-1){const x=v.value.map(j=>ee(j));return Math.max(...x)+1}let l=-1,o=-1;const _=v.value[e+(t?-1:0)],u=v.value[e+(t?0:1)];return _&&(l=ee(_)),u&&(o=ee(u),o===-1&&(o=l+1)),(l+o)/2},c=S([]),Ge=S(0),ve=S(!1),te=S(),ce=S(),Qe=(e,t=!1)=>{const l=v.value.findIndex(o=>r(o,e));l!==-1&&(te.value=t?l:l+1)},{isMetaReadOnly:Xe}=vt(),Oe=e=>!(Xe.value&&!Ft.includes(e==null?void 0:e.uidt)&&!Ot.includes(e==null?void 0:e.uidt)),L=(e,t)=>{if(e!=null&&e.id&&(e!=null&&e.uidt)&&!Oe(e))return Y.info(F("msg.info.schemaReadOnly"));if(e&&(e!=null&&e.pk)){Y.info(F("msg.info.editingPKnotSupported"));return}t&&t.target instanceof HTMLElement&&t.target.closest(".no-action")||r(e,n.value)||e===void 0&&n.value===void 0||(ve.value=!0,$t(()=>{n.value=e,ve.value=!1}))},le=(e,t=!1)=>{e&&Qe(e,t),L({}),setTimeout(()=>{!e&&!t&&se.value&&(se.value.scrollTop=se.value.scrollHeight)},100)},b=oe(()=>{if(G.value)return G.value.find(e=>e.pv)}),Ye=async e=>{var o,_;if(!G.value)return;const t=qt(`${e.title}_copy`,G.value);let l={};switch(e.uidt){case O.LinkToAnotherRecord:case O.Links:case O.Lookup:case O.Rollup:case O.Formula:return Y.info(F("msg.info.notAvailableAtTheMoment"));case O.SingleSelect:case O.MultiSelect:l={...e,title:t,column_name:t,id:void 0,order:void 0,pv:!1,colOptions:{options:((_=(o=e.colOptions)==null?void 0:o.options)==null?void 0:_.map(u=>({...u,id:void 0})))??[]}};break;default:l={...e,title:t,column_name:t,id:void 0,colOptions:void 0,order:void 0,pv:!1};break}le(e),ce.value=l},$e=e=>{for(const t of e)if(t.status||t.is_group&&$e(t.children||[]))return!0},_e=(e,t=!1)=>{var u,$,x,j,H,E;const l=v.value.find(C=>r(C,e));if(!l)return;e.colOptions&&[O.SingleSelect,O.MultiSelect].includes(l.uidt)&&(e={...e,colOptions:{...e.colOptions||{},options:(((u=e.colOptions)==null?void 0:u.options)||[]).map(C=>((C==null?void 0:C.index)!==void 0&&delete C.index,C))}});const o=Ce(l,e),_=Object.fromEntries(Object.entries(o).filter(([C,N])=>N!==void 0));if(Object.keys(_).length===0||Object.keys(_).length===1&&"altered"in _)c.value=c.value.filter(C=>C.op==="add"||!r(C.column,e));else{const C=c.value.find(p=>r(p.column,e)),N=V.value.find(p=>r(p.column,e));if(q.value.find(p=>r(p,e))){q.value=q.value.map(p=>r(p,e)?(c.value=c.value.filter(D=>D.op==="add"&&!r(D.column,e)),c.value.push({op:"add",column:e}),e):p);return}C||C&&N?C.column=e:Tt(e)&&!t?(["title","column_name","meta"].some(p=>p in _)||"childViewId"in _&&_.childViewId!==(($=l.colOptions)==null?void 0:$.fk_target_view_id)||$e(_.filters||[]))&&c.value.push({op:"update",column:e}):c.value.push({op:"update",column:e}),n.value&&Object.keys(n.value).length&&(e!=null&&e.id&&((x=n.value)!=null&&x.id)&&(e==null?void 0:e.id)===((j=n.value)==null?void 0:j.id)||e!=null&&e.temp_id&&((H=n.value)!=null&&H.temp_id)&&(e==null?void 0:e.temp_id)===((E=n.value)==null?void 0:E.temp_id))&&(n.value=e)}},ge=e=>{const t=c.value.find(l=>r(l.column,e));t?t.op==="delete"?c.value=c.value.filter(l=>l.column.id!==e.id):t.op==="add"?(n.value&&r(n.value,e)&&L(),c.value=c.value.filter(l=>l.column.temp_id!==e.temp_id),q.value=q.value.filter(l=>l.temp_id!==e.temp_id)):(t.op="delete",t.column=e):c.value.push({op:"delete",column:e})},Je=e=>{var t;ce.value&&(e=ce.value,ce.value=void 0),e.temp_id=`temp_${++Ge.value}`,e.view_id=(t=W.value)==null?void 0:t.id,c.value.push({op:"add",column:e}),q.value.push(e),te.value?(V.value.push({op:"move",column:e,index:te.value,order:me(te.value)}),te.value=void 0):V.value.push({op:"move",column:e,index:v.value.length,order:me(v.value.length)}),L(e)},Ze=e=>{var u,$;const t=v.value[e.moved.oldIndex],l=me(e.moved.newIndex,e.moved.newIndex<e.moved.oldIndex),o=c.value.find(x=>r(x.column,t));if((o==null?void 0:o.op)==="update"){const x=Ce(o.column,t);if(!(Object.keys(x).length===1&&"column_order"in x)){Y.warning(F("msg.warning.multiField.moveEditedField"));return}}if((o==null?void 0:o.op)==="delete"){Y.warning(F("msg.warning.multiField.moveDeletedField"));return}const _=V.value.find(x=>r(x.column,v.value[e.moved.oldIndex]));_?(_.index=e.moved.newIndex,_.order=l):V.value.push({op:"move",column:v.value[e.moved.oldIndex],index:e.moved.newIndex,order:l}),_e(o?{...o.column,column_order:{order:l,view_id:(u=W.value)==null?void 0:u.id}}:{...t,column_order:{order:l,view_id:($=W.value)==null?void 0:$.id}},!0)},ie=e=>{const t=c.value.find(o=>r(e,o.column)&&o.op==="delete"),l=c.value.find(o=>r(e,o.column)&&o.op==="add");return t?!0:!(!e.title&&!l||(e.uidt===O.Links||e.uidt===O.LinkToAnotherRecord)&&l&&(!e.childColumn||!e.childTable||!e.childId)||e.uidt===O.Lookup&&l&&(!e.fk_relation_column_id||!e.fk_lookup_column_id)||e.uidt===O.Rollup&&l&&(!e.fk_relation_column_id||!e.fk_rollup_column_id||!e.rollup_function)||e.uidt===O.Formula&&l&&!e.formula_raw)};function et(e){var t,l,o,_,u,$,x,j,H;return e.uidt===O.QrCode&&((t=e.colOptions)!=null&&t.fk_qr_value_column_id)&&(e!=null&&e.fk_qr_value_column_id||(e.fk_qr_value_column_id=e.colOptions.fk_qr_value_column_id)),e.uidt===O.Barcode&&((l=e.colOptions)!=null&&l.fk_barcode_value_column_id)&&(e!=null&&e.fk_barcode_value_column_id||(e.fk_barcode_value_column_id=e.colOptions.fk_barcode_value_column_id)),e.uidt===O.Lookup&&((o=e==null?void 0:e.colOptions)!=null&&o.fk_lookup_column_id)&&((_=e==null?void 0:e.colOptions)!=null&&_.fk_relation_column_id)&&(e!=null&&e.fk_lookup_column_id||(e.fk_lookup_column_id=e.colOptions.fk_lookup_column_id),e!=null&&e.fk_relation_column_id||(e.fk_relation_column_id=e.colOptions.fk_relation_column_id)),e.uidt===O.Rollup&&((u=e==null?void 0:e.colOptions)!=null&&u.fk_relation_column_id)&&(($=e==null?void 0:e.colOptions)!=null&&$.fk_rollup_column_id)&&((x=e==null?void 0:e.colOptions)!=null&&x.rollup_function)&&(e!=null&&e.fk_relation_column_id||(e.fk_relation_column_id=e.colOptions.fk_relation_column_id),e!=null&&e.fk_rollup_column_id||(e.fk_rollup_column_id=e.colOptions.fk_rollup_column_id),e!=null&&e.rollup_function||(e.rollup_function=e.colOptions.rollup_function)),e.uidt===O.Formula&&((j=e.colOptions)!=null&&j.formula_raw)&&!(e!=null&&e.formula_raw)&&(e.formula_raw=(H=e.colOptions)==null?void 0:H.formula_raw),e}const Te=e=>{const t=c.value.find(l=>r(l.column,e));t&&(t.op==="delete"?c.value=c.value.filter(l=>!r(l.column,e)):t.op==="update"&&(c.value=c.value.filter(l=>!r(l.column,e)),V.value=V.value.filter(l=>!r(l.column,e))),n.value=null,L(v.value.filter(l=>l.id===e.id)[0]))},K=e=>{const t=v.value.find(l=>r(l,e));if(t){const l=c.value.find(o=>r(o.column,t));if(l)return l.column}return null},Ie=oe(()=>{const e={};for(const t of c.value)t.op==="add"?t.column.temp_id&&(e[t.column.temp_id]="add"):t.op==="update"?t.column.id&&(e[t.column.id]="update"):t.op==="delete"&&t.column.id&&(e[t.column.id]="delete");return e}),U=e=>{const t=(e==null?void 0:e.id)||(e==null?void 0:e.temp_id);return t?Ie.value[t]:""},tt=()=>{c.value=[],V.value=[],q.value=[],z.value=[],L()},Ae=oe(()=>v.value.every(e=>ie(e))),Se=()=>{var e,t;G.value=(t=(e=h.value)==null?void 0:e.columns)==null?void 0:t.map(l=>(l.uidt&&l.uidt in Ke&&(l.meta||(l.meta={}),l.meta={...Ke[l.uidt],...l.meta||{}}),{...l}))},ye=async()=>{var e,t,l,o,_,u,$,x,j,H;if(Ae.value){if(!Q.value&&c.value.length<1&&V.value.length<1&&z.value.length<1)return}else{Y.error(F("msg.error.multiFieldSaveValidation"));return}try{if(!((e=h.value)!=null&&e.id))return;Q.value=!0;const E=[];for(const g of V.value){const p=c.value.find(D=>r(D.column,g.column));if(p&&p.op==="add"){if(!((t=p.column)!=null&&t.userHasChangedTitle)&&!p.column.title){const D=Me({formState:p.column,tableExplorerColumns:v.value||[],metaColumns:((l=h.value)==null?void 0:l.columns)||[],newFieldTitles:E});E.push(D),p.column.title=D,p.column.column_name=D}p.column.column_order={order:g.order,view_id:(o=W.value)==null?void 0:o.id}}p&&p.op==="update"&&(p.column.column_order={order:g.order,view_id:(_=W.value)==null?void 0:_.id})}const C=new Set;for(const g of c.value)if(g.op==="add")n.value&&r(n.value,g.column)&&L();else if(g.op==="delete")C.add(g.column.id),n.value&&r(n.value,g.column)&&L();else if(g.op==="update"){const p=($=(u=h.value)==null?void 0:u.columns)==null?void 0:$.find(D=>D.id===g.column.id);(p==null?void 0:p.uidt)===O.Attachment&&(p==null?void 0:p.uidt)!==g.column.uidt&&C.add(g.column.id)}for(const g of z.value)await Be(g.visible,{...g.column,show:g.visible});const N=await Z.dbTableColumn.bulk((x=h.value)==null?void 0:x.id,{hash:re.value,ops:c.value});await qe(),N&&(c.value=N.failedOps&&((j=N.failedOps)!=null&&j.length)?N.failedOps.map(({error:g,...p})=>p):[],q.value=q.value.filter(g=>!!(N.failedOps&&N.failedOps.find(D=>D.column.temp_id===g.temp_id))),V.value=[]);for(const g of c.value)C.has(g.column.id)&&(g.op==="delete"||g.op==="update")&&C.delete(g.column.id);await B(h.value.id,!0),Se(),Fe.updateViewCoverImageColumnId({metaId:h.value.id,columnIds:C}),re.value=(await Z.dbTableColumn.hash((H=h.value)==null?void 0:H.id)).hash,z.value=[]}catch{Y.error(F("msg.error.somethingWentWrong"))}finally{Q.value=!1}},lt=async(e,t)=>{if(t.fk_column_id&&Ie.value[t.fk_column_id]){Y.warning(F("msg.warning.multiField.fieldVisibility"));return}if(z.value.find(l=>l.column.fk_column_id===t.fk_column_id)){z.value=z.value.filter(l=>l.column.fk_column_id!==t.fk_column_id);return}z.value.push({visible:e,column:t})};_t(document,"keydown",async e=>{const t=he()?e.metaKey:e.ctrlKey;if(!I.value){if(t&&e.key.toLowerCase()==="s"){if(ne.value!=="field")return;e.preventDefault();return}if(e.altKey&&e.key.toLowerCase()==="c"||e.altKey&&e.code==="KeyC"){if(ne.value!=="field")return;e.preventDefault(),le()}}});const it=()=>he()?"⌘":"Ctrl",ot=()=>he()?"⌥":"ALT";ae("ArrowDown",()=>{const e=v.value.findIndex(t=>r(t,n.value));e===-1||e===v.value.length-1?L(v.value[0]):L(v.value[e+1])}),ae("ArrowUp",()=>{const e=v.value.findIndex(t=>r(t,n.value));L(e===-1?v.value[0]:e===0?v.value[v.value.length-1]:v.value[e-1])}),ae("Delete",()=>{var t,l,o;if(I.value||((t=document.activeElement)==null?void 0:t.tagName)==="INPUT"||((l=document.activeElement)==null?void 0:l.tagName)==="TEXTAREA"||(o=document.activeElement)!=null&&o.getAttribute("contenteditable"))return;!(U(n.value)==="delete")&&n.value&&ge(n.value)}),ae("Backspace",()=>{var t,l,o;if(I.value||((t=document.activeElement)==null?void 0:t.tagName)==="INPUT"||((l=document.activeElement)==null?void 0:l.tagName)==="TEXTAREA"||(o=document.activeElement)!=null&&o.getAttribute("contenteditable"))return;!(U(n.value)==="delete")&&n.value&&ge(n.value)}),ae("ArrowRight",()=>{var e;if(((e=document.activeElement)==null?void 0:e.tagName)!=="TEXTAREA"&&n.value){const t=document.querySelector(".nc-fields-input");t&&t.focus()}});const Le=async e=>{await Pe(e.id),de.value=!0},Ne=gt();je(Ne.meta_s,()=>{var e;I.value||(e=h.value)!=null&&e.id&&ne.value==="field"&&ye()}),je(Ne.ctrl_s,()=>{var e;I.value||(e=h.value)!=null&&e.id&&ne.value==="field"&&ye()}),Ee(h,async e=>{e!=null&&e.id&&(re.value=(await Z.dbTableColumn.hash(e.id)).hash)},{deep:!0}),yt(async()=>{h.value&&h.value.id&&(re.value=(await Z.dbTableColumn.hash(h.value.id)).hash),await ht(()=>{var e;return(e=h.value)==null?void 0:e.columns}),Se()});const De=()=>{setTimeout(()=>{de.value=!1},200)};return Ee(()=>{var e;return(e=n.value)==null?void 0:e.temp_id},(e,t)=>{if(!t)return;const l=v.value.find(u=>u.temp_id===t);if(!l||l&&(l.title||!c.value.find(u=>u.op==="add"&&u.column.temp_id===l.temp_id)||l!=null&&l.userHasChangedTitle||!ie(l)))return;const o=c.value.filter(u=>u.op==="add"&&u.column.title).map(u=>u.column.title).filter(u=>u),_=Me({formState:l,tableExplorerColumns:v.value||[],metaColumns:G.value||[],newFieldTitles:o});l.title=_,l.column_name=_}),(e,t)=>{const l=Qt,o=It,_=Xt,u=At,$=St,x=jt,j=Et,H=Mt,E=Ut,C=Lt,N=Rt,g=zt,p=Kt,D=Wt,at=Ht;return f(),X("div",tl,[m("div",ll,[i(We)?(f(),X("div",il,[d(l,{class:"!h-8 !w-68 !rounded !overflow-hidden",active:"",size:"small"}),m("div",ol,[d(l,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"}),d(l,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"}),d(l,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"})])])):(f(),X(be,{key:1},[m("div",al,[d(_,{value:i(J),"onUpdate:value":t[1]||(t[1]=a=>bt(J)?J.value=a:null),"data-testid":"nc-field-search-input",class:"!h-8 !px-1 !rounded-lg !w-72",placeholder:e.$t("placeholder.searchFields")},{prefix:s(()=>[d(o,{icon:"search",class:"mx-1 h-3.5 w-3.5 text-gray-500 group-hover:text-black"})]),suffix:s(()=>[i(J).length>0?(f(),w(o,{key:0,icon:"close",class:"mx-1 h-3.5 w-3.5 text-gray-500 group-hover:text-black","data-testid":"nc-field-clear-search",onClick:t[0]||(t[0]=a=>J.value="")})):P("",!0)]),_:1},8,["value","placeholder"]),m("div",nl,[d($,{disabled:i(I)},{title:s(()=>[T(y(`${ot()} + C`),1)]),default:s(()=>[d(u,{"data-testid":"nc-field-add-new",type:"secondary",size:"small",class:"mr-1",disabled:i(Q)||i(I),onClick:t[2]||(t[2]=a=>le())},{default:s(()=>[m("div",sl,[d(o,{icon:"plus",class:"w-3"}),T(" "+y(e.$t("labels.multiField.newField")),1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"]),d(u,{"data-testid":"nc-field-reset",type:"secondary",size:"small",disabled:!i(Q)&&i(c).length<1&&i(V).length<1&&i(z).length<1||i(I),onClick:t[3]||(t[3]=a=>tt())},{default:s(()=>[T(y(e.$t("general.reset")),1)]),_:1},8,["disabled"]),d($,{disabled:i(I)},{title:s(()=>[T(y(`${it()} + S`),1)]),default:s(()=>[d(u,{"data-testid":"nc-field-save-changes",type:"primary",size:"small",loading:i(Q),disabled:(i(Ae)?!i(Q)&&i(c).length<1&&i(V).length<1&&i(z).length<1:!0)||i(I),onClick:t[4]||(t[4]=a=>ye())},{default:s(()=>[T(y(e.$t("labels.multiField.saveChanges")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["disabled"])])]),m("div",rl,[m("div",{ref_key:"fieldsListWrapperDomRef",ref:se,class:"nc-scrollbar-md !overflow-auto flex-1 flex-grow-1 nc-fields-height"},[d(i(Gt),{"model-value":i(v),disabled:i(I),"item-key":"id","data-testid":"nc-field-list-wrapper",onChange:t[10]||(t[10]=a=>Ze(a))},kt({item:s(({element:a})=>{var R,Ve;return[a.title.toLowerCase().includes(i(J).toLowerCase())&&!a.pv?(f(),X("div",{key:0,class:M(["flex px-2 hover:bg-gray-100 first:rounded-t-lg border-b-1 last:rounded-b-none border-gray-200 pl-5 group",{selected:r(a,i(n)),"cursor-not-allowed":!Oe(a)}]),"data-testid":`nc-field-item-${((R=K(a))==null?void 0:R.title)||a.title}`,onClick:A=>L(a,A)},[m("div",ul,[(f(),w(Ue(("iconMap"in e?e.iconMap:i(Re)).drag),{class:M(["cursor-move !h-3.75 text-gray-600 mr-1",{"opacity-0 !cursor-default":i(I)}])},null,8,["class"])),a.id&&i(ue)[a.id]?(f(),w(x,{key:0,disabled:i(I),checked:((Ve=i(z).find(A=>A.column.fk_column_id===a.id))==null?void 0:Ve.visible)??i(ue)[a.id].show,"data-testid":"nc-field-visibility-checkbox",onChange:A=>{lt(A.target.checked,i(ue)[a.id])}},null,8,["disabled","checked","onChange"])):(f(),w(x,{key:1,disabled:!0,class:"opacity-0",checked:!0})),a&&i(wt)(K(a)||a)?(f(),w(j,{key:2,"column-meta":K(a)||a,class:M({"text-brand-500":r(a,i(n))})},null,8,["column-meta","class"])):(f(),w(H,{key:3,"column-meta":K(a)||a,class:M({"text-brand-500":r(a,i(n))})},null,8,["column-meta","class"])),d($,{class:M([{"text-brand-500":r(a,i(n))},"truncate flex-1"]),"show-on-truncate-only":""},{title:s(()=>{var A;return[T(y(((A=K(a))==null?void 0:A.title)||a.title),1)]}),default:s(()=>{var A;return[m("span",cl,y(((A=K(a))==null?void 0:A.title)||a.title),1)]}),_:2},1032,["class"])]),m("div",pl,[m("div",fl,[U(a)==="delete"?(f(),w(E,{key:0,color:"red",border:!1,class:"bg-red-50 text-red-700","data-testid":"nc-field-status-deleted-field"},{default:s(()=>[T(y(e.$t("labels.multiField.deletedField")),1)]),_:1})):ie(a)&&U(a)==="add"?(f(),w(E,{key:1,color:"orange",border:!1,class:"bg-green-50 text-green-700","data-testid":"nc-field-status-new-field"},{default:s(()=>[T(y(e.$t("labels.multiField.newField")),1)]),_:1})):U(a)==="update"?(f(),w(E,{key:2,color:"orange",border:!1,class:"bg-orange-50 text-orange-700","data-testid":"nc-field-status-updated-field"},{default:s(()=>[T(y(e.$t("labels.multiField.updatedField")),1)]),_:1})):P("",!0),ie(a)?P("",!0):(f(),w(E,{key:3,color:"yellow",border:!1,class:"ml-1 bg-yellow-50 text-yellow-700","data-testid":"nc-field-status-incomplete-configuration"},{default:s(()=>[T(y(e.$t("labels.multiField.incompleteConfiguration")),1)]),_:1}))]),U(a)==="delete"||U(a)==="update"?(f(),w(u,{key:0,type:"secondary",size:"small",class:"no-action mr-2",disabled:i(Q),"data-testid":"nc-field-restore-changes",onClick:A=>Te(a)},{default:s(()=>[m("div",ml,[d(o,{icon:"reload"}),T(" "+y(e.$t("general.restore")),1)])]),_:2},1032,["disabled","onClick"])):(f(),w(p,{key:1,trigger:["click"],"overlay-class-name":"nc-field-item-action-dropdown nc-dropdown-table-explorer","onUpdate:visible":De,onClick:t[5]||(t[5]=pe(()=>{},["stop"]))},{overlay:s(()=>[d(g,{style:{"padding-top":"0.45rem !important"}},{default:s(()=>[U(a)!=="add"?(f(),X(be,{key:0},[d($,{placement:"top"},{title:s(()=>[T(y(e.$t("msg.clickToCopyFieldId")),1)]),default:s(()=>[m("div",{class:"flex flex-row px-3 py-2 w-46 justify-between items-center group hover:bg-gray-100 cursor-pointer","data-testid":"nc-field-item-action-copy-id",onClick:A=>Le(a)},[m("div",_l,[m("div",gl,y(e.$t("labels.idColon")),1),m("div",yl,y(a.id),1)]),d(u,{size:"xsmall",type:"secondary",class:"!group-hover:bg-gray-100"},{default:s(()=>[i(de)?(f(),w(o,{key:0,icon:"check"})):(f(),w(o,{key:1,icon:"copy"}))]),_:1})],8,vl)]),_:2},1024),i(I)?P("",!0):(f(),w(C,{key:0,class:"my-1.5"}))],64)):P("",!0),i(I)?P("",!0):(f(),X(be,{key:1},[d(N,{key:"table-explorer-duplicate","data-testid":"nc-field-item-action-duplicate",onClick:A=>Ye(a)},{default:s(()=>[d(o,{icon:"duplicate",class:"text-gray-800"}),m("span",null,y(e.$t("general.duplicate")),1)]),_:2},1032,["onClick"]),a.pv?P("",!0):(f(),w(N,{key:"table-explorer-insert-above","data-testid":"nc-field-item-action-insert-above",onClick:A=>le(a,!0)},{default:s(()=>[d(o,{icon:"ncArrowUp",class:"text-gray-800"}),m("span",null,y(e.$t("general.insertAbove")),1)]),_:2},1032,["onClick"])),d(N,{key:"table-explorer-insert-below","data-testid":"nc-field-item-action-insert-below",onClick:A=>le(a)},{default:s(()=>[d(o,{icon:"ncArrowDown",class:"text-gray-800"}),m("span",null,y(e.$t("general.insertBelow")),1)]),_:2},1032,["onClick"]),d(C,{class:"my-1.5"}),d(N,{key:"table-explorer-delete",class:"!hover:bg-red-50","data-testid":"nc-field-item-action-delete",onClick:A=>ge(a)},{default:s(()=>[m("div",hl,[d(o,{icon:"delete",class:"group-hover:text-accent -ml-0.25 -mt-0.75 mr-0.5"}),T(" "+y(e.$t("general.delete")),1)])]),_:2},1032,["onClick"])],64))]),_:2},1024)]),default:s(()=>[d(u,{size:"xsmall",type:"text",class:M(["!opacity-0 !group-hover:opacity-100",{"!hover:text-brand-700 !hover:bg-brand-100 !group-hover:text-brand-500":r(a,i(n)),"!hover:text-gray-700 !hover:bg-gray-200 !group-hover:text-gray-500":!r(a,i(n))}]),"data-testid":"nc-field-item-action-button"},{default:s(()=>[d(o,{icon:"threeDotVertical",class:"no-action text-inherit"})]),_:2},1032,["class"])]),_:2},1024)),d(D,{class:M(["text-brand-500 opacity-0",{"opacity-100":r(a,i(n))}])},null,8,["class"])])],10,dl)):P("",!0)]}),_:2},[i(b)&&i(b).title&&i(b).title.toLowerCase().includes(i(J).toLowerCase())?{name:"header",fn:s(()=>{var a;return[m("div",{class:M(["flex px-2 bg-white hover:bg-gray-100 border-b-1 border-gray-200 first:rounded-tl-lg last:border-b-1 pl-5 group",` ${r(i(b),i(n))?"selected":""}`]),"data-testid":`nc-field-item-${((a=K(i(b)))==null?void 0:a.title)||i(b).title}`,onClick:t[9]||(t[9]=R=>L(i(b),R))},[m("div",kl,[(f(),w(Ue(("iconMap"in e?e.iconMap:i(Re)).drag),{class:M(["cursor-move !h-3.75 text-gray-200 mr-1",{"opacity-0 !cursor-default":i(I)}])},null,8,["class"])),d(x,{disabled:!0,checked:!0,"data-testid":"nc-field-visibility-checkbox"}),i(b)?(f(),w(H,{key:0,"column-meta":K(i(b))||i(b),class:M({"text-brand-500":r(i(b),i(n))})},null,8,["column-meta","class"])):P("",!0),d($,{class:M(["truncate flex-1",{"text-brand-500":r(i(b),i(n))}]),"show-on-truncate-only":""},{title:s(()=>{var R;return[T(y(((R=K(i(b)))==null?void 0:R.title)||i(b).title),1)]}),default:s(()=>{var R;return[m("span",wl,y(((R=K(i(b)))==null?void 0:R.title)||i(b).title),1)]}),_:1},8,["class"])]),m("div",xl,[m("div",Cl,[U(i(b))==="delete"?(f(),w(E,{key:0,color:"red",border:!1,class:"bg-red-50 text-red-700","data-testid":"nc-field-status-deleted-field"},{default:s(()=>[T(y(e.$t("labels.multiField.deletedField")),1)]),_:1})):U(i(b))==="update"?(f(),w(E,{key:1,color:"orange",border:!1,class:"bg-orange-50 text-orange-700","data-testid":"nc-field-status-updated-field"},{default:s(()=>[T(y(e.$t("labels.multiField.updatedField")),1)]),_:1})):P("",!0)]),U(i(b))==="delete"||U(i(b))==="update"?(f(),w(u,{key:0,type:"secondary",size:"small",class:"no-action mr-2",disabled:i(Q),"data-testid":"nc-field-restore-changes",onClick:t[6]||(t[6]=R=>Te(i(b)))},{default:s(()=>[m("div",Fl,[d(o,{icon:"reload"}),T(" "+y(e.$t("general.restore")),1)])]),_:1},8,["disabled"])):(f(),w(p,{key:1,trigger:["click"],"overlay-class-name":"nc-field-item-action-dropdown-display-column nc-dropdown-table-explorer-display-column","onUpdate:visible":De,onClick:t[8]||(t[8]=pe(()=>{},["stop"]))},{overlay:s(()=>[d(g,null,{default:s(()=>[d($,{placement:"top"},{title:s(()=>[T(y(e.$t("msg.clickToCopyFieldId")),1)]),default:s(()=>[m("div",{class:"flex flex-row px-3 py-2 w-46 justify-between items-center group hover:bg-gray-100 cursor-pointer","data-testid":"nc-field-item-action-copy-id",onClick:t[7]||(t[7]=R=>Le(i(b)))},[m("div",Ol,[m("div",$l,y(e.$t("labels.idColon")),1),m("div",Tl,y(i(b).id),1)]),d(u,{size:"xsmall",type:"secondary",class:"!group-hover:bg-gray-100"},{default:s(()=>[i(de)?(f(),w(o,{key:0,icon:"check"})):(f(),w(o,{key:1,icon:"copy"}))]),_:1})])]),_:1})]),_:1})]),default:s(()=>[d(u,{size:"xsmall",type:"text",class:M(["!opacity-0 !group-hover:opacity-100",{"!hover:text-brand-700 !hover:bg-brand-100 !group-hover:text-brand-500":r(i(b),i(n)),"!hover:text-gray-700 !hover:bg-gray-200 !group-hover:text-gray-500":!r(i(b),i(n))}]),"data-testid":"nc-field-item-action-button"},{default:s(()=>[d(o,{icon:"threeDotVertical",class:"no-action text-inherit"})]),_:1},8,["class"])]),_:1})),d(D,{class:M(["text-brand-500 opacity-0",{"opacity-100":r(i(b),i(n))}])},null,8,["class"])])],10,bl)]}),key:"0"}:void 0]),1032,["model-value","disabled"])],512),d(xt,{name:"slide-fade"},{default:s(()=>[i(ve)?P("",!0):(f(),X("div",{key:0,class:"border-gray-200 border-l-1 nc-scrollbar-md nc-fields-height !overflow-y-auto",onKeydown:[t[11]||(t[11]=ze(pe(()=>{},["stop"]),["up"])),t[12]||(t[12]=ze(pe(()=>{},["stop"]),["down"]))]},[i(n)?(f(),w(at,{key:0,class:"p-4 w-[25rem]",column:i(n),preload:K(i(n)),"table-explorer-columns":i(v),"is-column-valid":ie,"embed-mode":"",readonly:i(I),"from-table-explorer":"",onUpdate:_e,onAdd:Je},null,8,["column","preload","table-explorer-columns","readonly"])):(f(),X("div",Il,[Al,m("div",Sl,y(e.$t("labels.multiField.selectField")),1),m("div",Ll,y(e.$t("labels.multiField.selectFieldLabel")),1)]))],32))]),_:1})])],64))])])}}}),Vi=Vt(Nl,[["__scopeId","data-v-62f1108f"]]);export{Vi as default};
