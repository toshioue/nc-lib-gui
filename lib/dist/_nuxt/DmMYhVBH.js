import{_ as G}from"./DxNgCQAu.js";import{u as I}from"./DgdUBGGc.js";import{f as P,r as v,az as V,cN as L,N as M,ay as W,g as k,i as z,O,o as h,c as _,a as u,t as B,R as S,b,P as r,Q,T as U,aj as l,ak as i,A as q}from"./Cgw6cdOy.js";import{_ as F}from"./BiBN5Lxt.js";import"./DFiWgQ57.js";import"./CO8XXsKl.js";import"./BttyO-T4.js";import"./CitraFSq.js";import"./hvq8FVej.js";import"./BZz6iAla.js";import"./DPaOlBFV.js";import"./BQQOEPN4.js";import"./DoqAS2qD.js";import"./BRorwQ1i.js";import"./B2gUw4Rv.js";import"./D933wnC7.js";import"./LSbsNkd9.js";import"./CgtJdY-6.js";import"./6kmz45LK.js";import"./D8rpj5Lr.js";import"./BcZAlRJW.js";import"./BohSct8s.js";import"./C8c9012h.js";const H={class:"flex flex-col py-2 px-3 gap-2 w-full","data-testid":"nc-share-base-sub-modal"},J={class:"flex flex-col w-full p-3 border-1 border-gray-100 rounded-md"},K={class:"flex flex-row w-full justify-between"},X={class:"text-gray-900 font-medium"},Y={key:0,class:"flex flex-col w-full mt-3 border-t-1 pt-3 border-gray-100"},Z={key:0,class:"flex flex-row justify-between mt-3 bg-gray-50 px-3 py-2 rounded-md"},ee={class:"text-black"},Se=P({__name:"ShareBase",setup(ae){const{dashboardUrl:$}=I(),{$api:d,$e:g}=q(),a=v(null),{base:t}=V(L()),{getBaseUrl:R,appInfo:y}=M(),N=W(),p=k(()=>{var o;if(!a.value||!a.value.uuid)return"";const e=R(N.activeWorkspaceId);let s=$.value;return e&&(s=`${e}${(o=y.value)==null?void 0:o.dashboardPath}`),encodeURI(`${s}#/base/${a.value.uuid}`)}),C=async()=>{try{if(!t.value.id)return;const e=await d.base.sharedBaseGet(t.value.id);a.value={uuid:e.uuid,url:e.url,role:e.roles}}catch(e){l.error(await i(e))}},f=async(e="viewer")=>{try{if(!t.value.id)return;const s=await d.base.sharedBaseUpdate(t.value.id,{roles:e});a.value=s??{},a.value.role=e,t.value.uuid=s.uuid}catch(s){l.error(await i(s))}g("a:shared-base:enable",{role:e})},D=async()=>{try{if(!t.value.id)return;await d.base.sharedBaseDisable(t.value.id),a.value=null,t.value.uuid=void 0}catch(e){l.error(await i(e))}g("a:shared-base:disable")};z(()=>{a.value||C()});const m=k(()=>{var e;return!!((e=a.value)!=null&&e.uuid)}),n=v(!1),c=v(!1),T=async()=>{if(!n.value){n.value=!0;try{m.value?await D():await f()}catch(e){l.error(await i(e))}finally{n.value=!1}}},A=async()=>{if(a.value&&!c.value){c.value=!0;try{a.value.role==="viewer"?await f("editor"):await f("viewer")}catch(e){l.error(await i(e))}finally{c.value=!1}}};return(e,s)=>{var x;const o=F,j=G,w=O("e");return h(),_("div",H,[u("div",J,[u("div",K,[u("div",X,B(e.$t("activity.enablePublicAccess")),1),S(b(o,{checked:r(m),loading:r(n),class:"ml-2",onClick:T},null,8,["checked","loading"]),[[w,["c:share:base:enable:toggle"]]])]),r(m)?(h(),_("div",Y,[b(j,{url:r(p),"onUpdate:url":s[0]||(s[0]=E=>Q(p)?p.value=E:null)},null,8,["url"]),r(y).ee?U("",!0):(h(),_("div",Z,[u("div",ee,B(e.$t("activity.editingAccess")),1),S(b(o,{loading:r(c),checked:((x=r(a))==null?void 0:x.role)==="editor",class:"ml-2",onClick:A},null,8,["loading","checked"]),[[w,["c:share:base:role:toggle"]]])]))])):U("",!0)])])}}});export{Se as default};
