import{_ as I}from"./CufbkOJY.js";import{u as M}from"./uhBJvRY2.js";import{e as P,r as f,ax as V,cL as j,L as W,aw as O,f as k,g as q,M as z,o as v,c as h,a as u,t as S,P as U,b as _,N as r,O as F,R as $,ah as l,ai as i,y as H}from"./DZZ6t_j4.js";import{_ as J}from"./CDWovrGB.js";import"./B05h-4V9.js";import"./GMLocJHP.js";import"./CFvUUxCy.js";import"./eX8_g88K.js";import"./vll-Pnjv.js";import"./DyDFI6NE.js";import"./BQuyMdA-.js";import"./BQQOEPN4.js";import"./CvNj_pzL.js";import"./9ZvwAtsX.js";import"./ABvOSKp8.js";import"./B8iX-Tu_.js";import"./D9tFZoTQ.js";import"./Cz_1GoV3.js";import"./K3POysmD.js";import"./D_MsYLkT.js";import"./BCJFTkwv.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";const K={class:"flex flex-col py-2 px-3 gap-2 w-full","data-testid":"nc-share-base-sub-modal"},Q={class:"flex flex-col w-full p-3 border-1 border-gray-100 rounded-md"},X={class:"flex flex-row w-full justify-between"},Y={class:"text-gray-900 font-medium"},Z={key:0,class:"flex flex-col w-full mt-3 border-t-1 pt-3 border-gray-100"},ee={key:0,class:"flex flex-row justify-between mt-3 bg-gray-50 px-3 py-2 rounded-md"},ae={class:"text-black"},Ue=P({__name:"ShareBase",setup(se){const{dashboardUrl:R}=M(),{$api:d,$e:b}=H(),a=f(null),{base:t}=V(j()),{getBaseUrl:C,appInfo:g}=W(),D=O(),p=k(()=>{var o;if(!a.value||!a.value.uuid)return"";const e=C(D.activeWorkspaceId);let s=R.value;return e&&(s=`${e}${(o=g.value)==null?void 0:o.dashboardPath}`),encodeURI(`${s}#/base/${a.value.uuid}`)}),N=async()=>{try{if(!t.value.id)return;const e=await d.base.sharedBaseGet(t.value.id);a.value={uuid:e.uuid,url:e.url,role:e.roles}}catch(e){l.error(await i(e))}},y=async(e="viewer")=>{try{if(!t.value.id)return;const s=await d.base.sharedBaseUpdate(t.value.id,{roles:e});a.value=s??{},a.value.role=e,t.value.uuid=s.uuid}catch(s){l.error(await i(s))}b("a:shared-base:enable",{role:e})},L=async()=>{try{if(!t.value.id)return;await d.base.sharedBaseDisable(t.value.id),a.value=null,t.value.uuid=void 0}catch(e){l.error(await i(e))}b("a:shared-base:disable")};q(()=>{a.value||N()});const m=k(()=>{var e;return!!((e=a.value)!=null&&e.uuid)}),n=f(!1),c=f(!1),T=async()=>{if(!n.value){n.value=!0;try{m.value?await L():await y()}catch(e){l.error(await i(e))}finally{n.value=!1}}},A=async()=>{if(a.value&&!c.value){c.value=!0;try{await y("viewer")}catch(e){l.error(await i(e))}finally{c.value=!1}}};return(e,s)=>{var x,B;const o=J,E=I,w=z("e");return v(),h("div",K,[u("div",Q,[u("div",X,[u("div",Y,S(e.$t("activity.enablePublicAccess")),1),U(_(o,{checked:r(m),loading:r(n),class:"ml-2",onClick:T},null,8,["checked","loading"]),[[w,["c:share:base:enable:toggle"]]])]),r(m)?(v(),h("div",Z,[_(E,{url:r(p),"onUpdate:url":s[0]||(s[0]=G=>F(p)?p.value=G:null)},null,8,["url"]),!r(g).ee&&((x=r(a))==null?void 0:x.role)==="editor"?(v(),h("div",ee,[u("div",ae,S(e.$t("activity.editingAccess")),1),U(_(o,{loading:r(c),checked:((B=r(a))==null?void 0:B.role)==="editor",class:"ml-2",onClick:A},null,8,["loading","checked"]),[[w,["c:share:base:role:toggle"]]])])):$("",!0)])):$("",!0)])])}}});export{Ue as default};
