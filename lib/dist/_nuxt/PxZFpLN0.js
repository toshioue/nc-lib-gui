const __vite__fileDeps=["./1CF7f7ZM.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./DgixBgIx.js","./DeleteModal.SEMJ_gSK.css","./uhBJvRY2.js","./C3jLTHF4.js","./EqBqqo9-.js","./Bd2huW26.js","./BYINaHrJ.js","./dfem9Uc_.js","./BCJFTkwv.js","./vll-Pnjv.js","./D9tFZoTQ.js","./DKN1hQ6S.js","./BQuyMdA-.js","./BQQOEPN4.js","./B5RRVMt5.js","./DGj1ycqW.js","./DyDFI6NE.js","./CXD-Dj4T.js","./D_MsYLkT.js","./CB1aB6F1.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{o,c as w,a as t,e as me,ag as _e,ap as fe,ax as ve,cL as ye,aq as xe,J as we,ay as he,r as p,eL as ge,i0 as be,M as ke,N as n,b as r,Q as i,w as l,d as q,t as d,O as D,S as $e,P as L,T as y,U as x,R as g,ao as O,at as Me,a8 as F,gD as J,gc as Q,ah as m,ai as z,dp as Ue,aT as Ce,ca as Re,a1 as Ie,a9 as je,aa as Se,ae as De,X as ze,a4 as Ae,y as Be}from"./DZZ6t_j4.js";import{u as Te}from"./uhBJvRY2.js";import{_ as Ee}from"./CZ4qli51.js";import{_ as Le}from"./wMOVDMe3.js";import"./DKN1hQ6S.js";import{I as Pe}from"./BQuyMdA-.js";import{_ as Ne}from"./DLDZbX8i.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./DyDFI6NE.js";import"./oyD85nwD.js";import"./D_MsYLkT.js";import"./BCJFTkwv.js";import"./CB1aB6F1.js";import"./B8iX-Tu_.js";const Ve={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},qe=t("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0c.41-.41.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"},null,-1),Oe=[qe];function Fe(U,b){return o(),w("svg",Ve,[...Oe])}const Je={name:"ic-round-search",render:Fe},Qe=ze(()=>Ae(()=>import("./1CF7f7ZM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url).then(U=>U.default||U)),We={key:0,class:"h-full w-full flex items-center justify-center"},Xe={key:1,class:"flex flex-col w-full px-6"},Ge={class:"flex flex-col h-full"},He={class:"flex mt-6 justify-end space-x-2"},Ke={class:"flex flex-row mb-4 mx-4 justify-between pb-2"},Ye={class:"flex w-1/3"},Ze={class:"flex flex-row space-x-1"},es={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},ss={class:"text-gray-500"},ts={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},as={class:"px-5"},os={class:"flex flex-row border-b-1 pb-2 px-2"},ns={class:"flex flex-row w-3/6 space-x-1 items-center pl-1"},ls={class:"text-gray-600 text-xs space-x-1"},is={class:"flex flex-row justify-start w-2/6 space-x-1 items-center pl-1"},rs={class:"text-gray-600 text-xs"},cs={class:"flex flex-row w-1/6 justify-end items-center pl-1"},ds={class:"text-gray-600 text-xs"},us={class:"flex w-3/6 flex-wrap nc-user-email"},ps={class:"flex w-2/6 justify-start gap-2 flex-wrap ml-4"},ms={class:"flex w-1/6 flex-wrap justify-end"},_s={class:"flex flex-row items-center"},fs={class:"flex flex-row items-center h-[1.2rem]"},vs=["onClick"],ys={class:"text-xs pl-2"},xs=["onClick"],ws={class:"text-xs pl-2"},Es=me({__name:"UserManagement",setup(U){const{t:b}=_e(),{$e:C}=Be(),{api:R}=fe(),{base:_}=ve(ye()),{copy:W}=xe(),{isUIAllowed:X}=we(),{dashboardUrl:G}=Te(),{clearBasesUser:H}=he(),A=p(null),h=p(null),k=p(!1),f=p(!1),B=p(!1),P=p(0),$=p(1),I=p(10),M=p(""),v=async(e=$.value,s=I.value)=>{var u,j;try{if(!((u=_.value)!=null&&u.id))return;const c=await R.auth.baseUserList((j=_.value)==null?void 0:j.id,{query:{limit:s,offset:(e-1)*s,query:M.value}});if(!c.users)return;P.value=c.users.pageInfo.totalRows??0,A.value=c.users.list}catch(c){m.error(await z(c))}},K=async e=>{var s;try{if(!((s=_.value)!=null&&s.id))return;e.roles||(e.roles="editor"),await R.auth.baseUserAdd(_.value.id,e),H(),m.success(b("msg.success.userAddedToProject")),await v()}catch(u){m.error(await z(u))}C("a:user:add")},Y=async()=>{var e,s;try{if(!((e=_.value)!=null&&e.id)||!((s=h.value)!=null&&s.id))return;await R.auth.baseUserRemove(_.value.id,h.value.id),m.success(b("msg.success.userDeletedFromProject")),await v(),f.value=!1}catch(u){m.error(await z(u))}finally{f.value=!1}C("a:user:delete")},Z=e=>{h.value=e,k.value=!0},ee=()=>{h.value=null,k.value=!0},se=e=>{h.value=e,f.value=!0},te=async e=>{var s;if((s=_.value)!=null&&s.id){try{await R.auth.baseUserResendInvite(_.value.id,e.id),m.success(b("msg.success.inviteEmailSent")),await v()}catch(u){m.error(await z(u))}C("a:user:resend-invite")}},ae=async e=>{if(e.invite_token){try{await W(`${G.value}#/signup/${e.invite_token}`),m.success(b("msg.success.inviteURLCopied"))}catch(s){m.error(s.message)}C("c:user:copy-url")}};ge(async()=>{A.value||(B.value=!0,await v(),B.value=!1)}),be(M,()=>{$.value=1,v()},{debounce:300,maxWait:600});const N=e=>{var s;return(s=e.main_roles)==null?void 0:s.split(",").includes(Q.SUPER_ADMIN)};return(e,s)=>{const u=Ue,j=Qe,c=Ce,oe=Re,ne=Je,le=Pe,ie=Le,T=Ie,re=Ee,V=je,ce=Se,de=De,ue=Ne,E=ke("e");return n(B)?(o(),w("div",We,[r(u,{size:"large"})])):(o(),w("div",Xe,[(o(),i(j,{key:`${n(k)}`,show:n(k),"selected-user":n(h),onClosed:s[0]||(s[0]=a=>k.value=!1),onReload:s[1]||(s[1]=a=>v())},null,8,["show","selected-user"])),r(oe,{visible:n(f),"onUpdate:visible":s[3]||(s[3]=a=>D(f)?f.value=a:null),class:$e([{active:n(f)},"!rounded-md"]),closable:!1,width:"28rem",centered:"",footer:null,"wrap-class-name":"nc-modal-delete-user"},{default:l(()=>[t("div",Ge,[s[8]||(s[8]=t("div",{class:"flex flex-row justify-center mt-2 text-center w-full text-base"}," This action will remove this user from this base ",-1)),t("div",He,[r(c,{class:"!rounded-md",onClick:s[2]||(s[2]=a=>f.value=!1)},{default:l(()=>[q(d(e.$t("general.cancel")),1)]),_:1}),r(c,{class:"!rounded-md",type:"primary",danger:"",onClick:Y},{default:l(()=>[q(d(e.$t("general.confirm")),1)]),_:1})])])]),_:1},8,["visible","class"]),t("div",Ke,[t("div",Ye,[r(le,{value:n(M),"onUpdate:value":s[4]||(s[4]=a=>D(M)?M.value=a:null),placeholder:e.$t("placeholder.filterByEmail")},{prefix:l(()=>[r(ne,{class:"text-gray-400"})]),_:1},8,["value","placeholder"])]),t("div",Ze,[L((o(),i(c,{size:"middle",type:"text",onClick:s[5]||(s[5]=a=>v())},{default:l(()=>[t("div",es,[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).reload),{class:"text-gray-500"})),t("div",ss,d(e.$t("general.reload")),1)])]),_:1})),[[E,["a:user:reload"]]]),n(X)("newUser")?L((o(),i(c,{key:0,size:"middle",type:"primary",class:"nc-invite-team !rounded-md",onClick:ee},{default:l(()=>[t("div",ts,[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).accountPlus),{class:"mr-1"})),t("div",null,d(e.$t("activity.inviteTeam")),1)])]),_:1})),[[E,["c:user:invite"]]]):g("",!0)])]),t("div",as,[t("div",os,[t("div",ns,[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).email),{class:"flex text-gray-500 -mt-0.5"})),t("div",ls,d(e.$t("labels.email")),1)]),t("div",is,[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).role),{class:"flex text-gray-500 -mt-0.5"})),t("div",rs,d(e.$t("objects.role")),1)]),t("div",cs,[t("div",ds,d(e.$t("labels.actions")),1)])]),(o(!0),w(O,null,Me(n(A),(a,pe)=>(o(),w("div",{key:pe,class:"flex flex-row items-center border-b-1 py-2 px-2 nc-user-row"},[t("div",us,d(a.email),1),t("div",ps,[N(a)?(o(),w("div",{key:0,class:"rounded-full px-3 py-1 nc-user-role",style:F({backgroundColor:n(J)[n(Q).SUPER_ADMIN]})}," Super Admin ",4)):g("",!0),a.roles?(o(),w("div",{key:1,class:"rounded-full px-3 py-1 nc-user-role",style:F({backgroundColor:n(J)[a.roles]})},d(e.$t(`objects.roleType.${a.roles}`)),5)):g("",!0)]),t("div",ms,[N(a)?g("",!0):(o(),w(O,{key:0},[a.base_id?(o(),i(T,{key:0,placement:"bottom"},{title:l(()=>[t("span",null,d(e.$t("activity.editUser")),1)]),default:l(()=>[r(c,{type:"text",class:"!rounded-md nc-user-edit",onClick:S=>Z(a)},{icon:l(()=>[r(ie,{class:"flex mx-auto h-[1rem] text-gray-500"})]),_:2},1032,["onClick"])]),_:2},1024)):g("",!0),a.base_id?(o(),i(T,{key:2,placement:"bottom"},{title:l(()=>[t("span",null,d(e.$t("activity.deleteUser")),1)]),default:l(()=>[L((o(),i(c,{type:"text",class:"!rounded-md nc-user-delete",onClick:S=>se(a)},{icon:l(()=>[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).delete),{class:"flex mx-auto h-[1.1rem] text-gray-500"}))]),_:2},1032,["onClick"])),[[E,["c:user:delete"]]])]),_:2},1024)):(o(),i(T,{key:1,placement:"bottom"},{title:l(()=>[t("span",null,d(e.$t("activity.addUserToProject")),1)]),default:l(()=>[r(c,{type:"text",class:"!rounded-md nc-user-invite",onClick:S=>K(a)},{icon:l(()=>[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).plus),{class:"flex mx-auto h-[1.1rem] text-gray-500"}))]),_:2},1032,["onClick"])]),_:2},1024)),a.invite_token?(o(),i(de,{key:3,trigger:["click"],class:"flex",placement:"bottomRight","overlay-class-name":"nc-dropdown-user-mgmt"},{overlay:l(()=>[r(ce,null,{default:l(()=>[r(V,null,{default:l(()=>[t("div",{class:"flex flex-row items-center py-3",onClick:S=>te(a)},[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).sendEmail),{class:"flex h-[1rem] text-gray-500"})),t("div",ys,d(e.$t("activity.resendInvite")),1)],8,vs)]),_:2},1024),r(V,null,{default:l(()=>[t("div",{class:"flex flex-row items-center py-3",onClick:S=>ae(a)},[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).copy),{class:"flex h-[1rem] text-gray-500"})),t("div",ws,d(e.$t("activity.copyInviteURL")),1)],8,xs)]),_:2},1024)]),_:2},1024)]),default:l(()=>[t("div",_s,[r(c,{type:"text",class:"!px-0"},{default:l(()=>[t("div",fs,[r(re)])]),_:1})])]),_:2},1024)):g("",!0)],64))])]))),128)),r(ue,{current:n($),"onUpdate:current":s[6]||(s[6]=a=>D($)?$.value=a:null),"page-size":n(I),"onUpdate:pageSize":s[7]||(s[7]=a=>D(I)?I.value=a:null),"hide-on-single-page":"",class:"mt-4",total:+n(P),"show-less-items":"",onChange:v},null,8,["current","page-size","total"])])]))}}});export{Es as default};
