import{_ as I}from"./BFOImRwp.js";import{u as P}from"./Bhv5f4lm.js";import{f as V,r as v,at as j,cB as L,N as M,as as W,g as B,i as O,O as Q,o as h,c as _,a as u,t as k,R as S,b,P as r,Q as q,S as U,an as l,ao as i,A as z}from"./B2hUoZAs.js";import{_ as F}from"./pcWi62uI.js";import"./Bye44sky.js";import"./B_8aIjz8.js";import"./Df48od_3.js";import"./Coz9Ftud.js";import"./C9qKCFvP.js";import"./kd0F6MQ0.js";import"./CwHJfKcC.js";import"./BQQOEPN4.js";import"./Dk9gIyw5.js";import"./DaczmVFk.js";import"./DGxpMPpu.js";import"./DRJOl617.js";import"./fKrvpb1C.js";import"./U6IX4jMM.js";import"./TwC8XIV0.js";import"./CaxUP45y.js";import"./1orNHd0L.js";import"./R1pHeCcp.js";import"./BGKYJ52S.js";const H={class:"flex flex-col py-2 px-3 gap-2 w-full","data-testid":"nc-share-base-sub-modal"},J={class:"flex flex-col w-full p-3 border-1 border-gray-100 rounded-md"},K={class:"flex flex-row w-full justify-between"},X={class:"text-gray-900 font-medium"},Y={key:0,class:"flex flex-col w-full mt-3 border-t-1 pt-3 border-gray-100"},Z={key:0,class:"flex flex-row justify-between mt-3 bg-gray-50 px-3 py-2 rounded-md"},ee={class:"text-black"},Se=V({__name:"ShareBase",setup(ae){const{dashboardUrl:$}=P(),{$api:d,$e:g}=z(),a=v(null),{base:t}=j(L()),{getBaseUrl:R,appInfo:w}=M(),C=W(),p=B(()=>{var o;if(!a.value||!a.value.uuid)return"";const e=R(C.activeWorkspaceId);let s=$.value;return e&&(s=`${e}${(o=w.value)==null?void 0:o.dashboardPath}`),encodeURI(`${s}#/base/${a.value.uuid}`)}),D=async()=>{try{if(!t.value.id)return;const e=await d.base.sharedBaseGet(t.value.id);a.value={uuid:e.uuid,url:e.url,role:e.roles}}catch(e){l.error(await i(e))}},f=async(e="viewer")=>{try{if(!t.value.id)return;const s=await d.base.sharedBaseUpdate(t.value.id,{roles:e});a.value=s??{},a.value.role=e,t.value.uuid=s.uuid}catch(s){l.error(await i(s))}g("a:shared-base:enable",{role:e})},N=async()=>{try{if(!t.value.id)return;await d.base.sharedBaseDisable(t.value.id),a.value=null,t.value.uuid=void 0}catch(e){l.error(await i(e))}g("a:shared-base:disable")};O(()=>{a.value||D()});const m=B(()=>{var e;return!!((e=a.value)!=null&&e.uuid)}),n=v(!1),c=v(!1),A=async()=>{if(!n.value){n.value=!0;try{m.value?await N():await f()}catch(e){l.error(await i(e))}finally{n.value=!1}}},T=async()=>{if(a.value&&!c.value){c.value=!0;try{a.value.role==="viewer"?await f("editor"):await f("viewer")}catch(e){l.error(await i(e))}finally{c.value=!1}}};return(e,s)=>{var x;const o=F,E=I,y=Q("e");return h(),_("div",H,[u("div",J,[u("div",K,[u("div",X,k(e.$t("activity.enablePublicAccess")),1),S(b(o,{checked:r(m),loading:r(n),class:"ml-2",onClick:A},null,8,["checked","loading"]),[[y,["c:share:base:enable:toggle"]]])]),r(m)?(h(),_("div",Y,[b(E,{url:r(p),"onUpdate:url":s[0]||(s[0]=G=>q(p)?p.value=G:null)},null,8,["url"]),r(w).ee?U("",!0):(h(),_("div",Z,[u("div",ee,k(e.$t("activity.editingAccess")),1),S(b(o,{loading:r(c),checked:((x=r(a))==null?void 0:x.role)==="editor",class:"ml-2",onClick:T},null,8,["loading","checked"]),[[y,["c:share:base:role:toggle"]]])]))])):U("",!0)])])}}});export{Se as default};
