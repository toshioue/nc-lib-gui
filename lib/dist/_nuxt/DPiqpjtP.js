import{o,c as m,a as i,f as K,ai as O,r as D,at as Q,cB as W,ah as q,g as J,i as X,t as c,b as t,w as a,P as r,Q as Y,U as v,al as Z,am as ee,S as V,V as w,W as x,an as u,ao as g,aS as ae,a9 as se,aa as te,af as oe,a1 as ne,A as le}from"./BLdk6lRf.js";import{u as re}from"./CwyeWFQa.js";import{S as ie,_ as ce}from"./BrF0EXdL.js";import"./CBNgcPSC.js";import"./BQQOEPN4.js";import"./DTv03lbO.js";import"./C-Z2v8Hi.js";import"./BD_L_KCX.js";const de={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ue=i("path",{fill:"currentColor",d:"M8.12 9.29L12 13.17l3.88-3.88a.996.996 0 1 1 1.41 1.41l-4.59 4.59a.996.996 0 0 1-1.41 0L6.7 10.7a.996.996 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0"},null,-1),me=[ue];function pe(R,B){return o(),m("svg",de,[...me])}const _e={name:"ic-round-keyboard-arrow-down",render:pe},fe={class:"flex flex-col gap-2 w-full","data-testid":"nc-share-base-sub-modal"},ve={class:"flex text-xs text-gray-500 justify-start ml-1"},he={class:"flex flex-row justify-between mx-1"},be={class:"flex flex-row rounded-md items-center space-x-2 nc-disable-shared-base"},ye={key:0},we={key:1},xe={class:"flex flex-row"},ge={class:"w-full px-2 capitalize"},Be={key:0,class:"flex flex-row mt-2 bg-red-50 py-4 mx-1 px-2 items-center rounded-sm w-full justify-between"},ke={class:"flex text-xs overflow-x-hidden overflow-ellipsis text-gray-700 pl-2 nc-url"},$e={class:"flex border-l-1 pt-1 pl-1"},Ie=K({__name:"ShareBase",setup(R){const{t:B}=O(),{dashboardUrl:L}=re(),{$api:b,$e:f}=le(),s=D(null),k=D(!1),{base:d}=Q(W()),{copy:$}=q(),p=J(()=>s.value&&s.value.uuid?`${L.value}#/base/${s.value.uuid}`:null),E=async()=>{try{if(!d.value.id)return;const e=await b.base.sharedBaseGet(d.value.id);s.value={uuid:e.uuid,url:e.url,role:e.roles}}catch(e){u.error(await g(e))}},C=async(e="viewer")=>{try{if(!d.value.id)return;const n=await b.base.sharedBaseUpdate(d.value.id,{roles:e});s.value=n??{},s.value.role=e}catch(n){u.error(await g(n))}f("a:shared-base:enable",{role:e})},I=async()=>{try{if(!d.value.id)return;await b.base.sharedBaseDisable(d.value.id),s.value=null}catch(e){u.error(await g(e))}f("a:shared-base:disable")},N=async()=>{var e,n;try{if(!d.value.id)return;const _=await b.base.sharedBaseCreate(d.value.id,{roles:((e=s.value)==null?void 0:e.role)||"viewer"})||{};s.value={..._,role:(n=s.value)==null?void 0:n.role}}catch(h){u.error(await g(h))}f("a:shared-base:recreate")},T=async()=>{if(p.value){try{await $(p.value),u.success(B("msg.success.shareableURLCopied"))}catch(e){u.error(e.message)}f("c:shared-base:copy-url")}},j=()=>{p.value&&(window.open(p.value,"_blank"),f("c:shared-base:open-url"))},A=async()=>{if(p.value){try{await $(`<iframe
class="nc-embed"
src="${p.value}?embed"
frameborder="0"
width="100%"
height="700"
style="background: transparent; border: 1px solid #ddd"></iframe>`),u.success(B("msg.success.embeddableHTMLCodeCopied"))}catch(e){u.error(e.message)}f("c:shared-base:copy-embed-frame")}};return X(()=>{s.value||E()}),(e,n)=>{var M,S;const h=_e,_=ae,z=se,F=te,P=oe,G=ie,H=ce,y=ne;return o(),m("div",fe,[i("div",ve,c(e.$t("msg.info.generatePublicShareableReadonlyBase")),1),i("div",he,[t(P,{modelValue:r(k),"onUpdate:modelValue":n[1]||(n[1]=l=>Y(k)?k.value=l:null),class:"flex","overlay-class-name":"nc-dropdown-shared-base-toggle"},{overlay:a(()=>[t(F,null,{default:a(()=>[t(z,null,{default:a(()=>{var l;return[(l=r(s))!=null&&l.uuid?(o(),m("div",{key:0,class:"py-3",onClick:I},c(e.$t("activity.shareBase.disable")),1)):(o(),m("div",{key:1,class:"py-3",onClick:n[0]||(n[0]=U=>C("viewer"))},c(e.$t("activity.shareBase.enable")),1))]}),_:1})]),_:1})]),default:a(()=>[t(_,null,{default:a(()=>{var l;return[i("div",be,[(l=r(s))!=null&&l.uuid?(o(),m("div",ye,c(e.$t("activity.shareBase.enable")),1)):(o(),m("div",we,c(e.$t("activity.shareBase.disable")),1)),t(h,{class:"h-[1rem]"})])]}),_:1})]),_:1},8,["modelValue"]),(M=r(s))!=null&&M.uuid?(o(),v(H,{key:0,value:r(s).role,"onUpdate:value":n[2]||(n[2]=l=>r(s).role=l),class:"flex nc-shared-base-role","dropdown-class-name":"nc-dropdown-share-base-role"},{suffixIcon:a(()=>[i("div",xe,[t(h,{class:"text-black -mt-0.5 h-[1rem]"})])]),default:a(()=>[(o(!0),m(Z,null,ee(["editor","viewer"],(l,U)=>(o(),v(G,{key:U,value:l,"dropdown-class-name":"capitalize",onClick:Ce=>C(l)},{default:a(()=>[i("div",ge,c(l),1)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["value"])):V("",!0)]),(S=r(s))!=null&&S.uuid?(o(),m("div",Be,[i("span",ke,c(r(p)),1),i("div",$e,[t(y,{placement:"bottom"},{title:a(()=>[i("span",null,c(e.$t("general.reload")),1)]),default:a(()=>[t(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:N},{icon:a(()=>[(o(),v(w(("iconMap"in e?e.iconMap:r(x)).reload),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),t(y,{placement:"bottom"},{title:a(()=>[i("span",null,c(e.$t("activity.copyUrl")),1)]),default:a(()=>[t(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:T},{icon:a(()=>[(o(),v(w(("iconMap"in e?e.iconMap:r(x)).copy),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),t(y,{placement:"bottom"},{title:a(()=>[i("span",null,c(e.$t("activity.openTab")),1)]),default:a(()=>[t(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:j},{icon:a(()=>[(o(),v(w(("iconMap"in e?e.iconMap:r(x)).share),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),t(y,{placement:"bottom"},{title:a(()=>[i("span",null,c(e.$t("activity.iFrame")),1)]),default:a(()=>[t(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:A},{icon:a(()=>[(o(),v(w(("iconMap"in e?e.iconMap:r(x)).xml),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1})])])):V("",!0)])}}});export{Ie as default};
