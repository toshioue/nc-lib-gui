const __vite__fileDeps=["./BsNJKiLS.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./CY3l82lI.js","./Table.flBPdmEH.css","./BT-ahe-O.js","./C3jLTHF4.js","./BDAIZopQ.js","./BYINaHrJ.js","./dfem9Uc_.js","./BCJFTkwv.js","./vll-Pnjv.js","./D9tFZoTQ.js","./DNgdBwTe.js","./eX8_g88K.js","./CbjHV4v2.js","./DKN1hQ6S.js","./BQuyMdA-.js","./BQQOEPN4.js","./B5RRVMt5.js","./DGj1ycqW.js","./DyDFI6NE.js","./D_MsYLkT.js","./CB1aB6F1.js","./Editor.Brx8uguF.css","./B4Lj1XSi.js","./boyBAVNN.js","./CwK0k4WN.js","./toggleHighContrast.wojAGmRG.css","./Editor.6PWXOFSt.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var pn=Object.defineProperty;var vn=(a,e,t)=>e in a?pn(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var Q=(a,e,t)=>(vn(a,typeof e!="symbol"?e+"":e,t),t);import{b as p,b0 as Ne,bg as gn,bj as hn,bz as bn,e as Ce,r as Y,g as Ue,k as Nt,aQ as Ke,al as ne,am as J,cv as yn,aZ as Ve,bB as zt,bC as We,a_ as Ht,c7 as gt,ak as ht,f as ue,cd as wn,ce as _n,P as bt,aF as qt,a1 as Jt,D as In,bO as Tn,bP as kn,bQ as Cn,aW as Dn,I as Sn,bT as Dt,b5 as Fn,aT as Xe,cD as Rn,a5 as On,aO as St,fD as nt,b7 as Pn,bM as xn,aU as at,an as $n,c4 as Ln,o as q,c as ye,a as H,cL as Gt,cS as Un,F as Kt,M as En,Q as te,w as E,N as s,d as ae,t as N,R as he,cY as Ft,cZ as Rt,T as Te,U as ke,ao as jn,at as An,c_ as Se,O as ct,S as ut,aJ as Wt,y as dt,ah as ve,ai as Le,ca as ft,fF as Mn,a$ as Bn,c$ as w,fG as Vn,fH as yt,fI as Nn,fJ as mt,fK as Xt,fL as Yt,fM as Qt,fN as zn,fO as Ye,fP as Zt,a4 as wt,L as Ot,ag as Hn,ax as Pt,cP as qn,ar as Jn,ab as Gn,fQ as Kn,a7 as Wn,X as en,cV as Xn,fR as ze,fS as Yn,bX as Fe,fT as ot,fU as Qn,fV as Zn,dp as ea,x as ta,fW as Re,fX as Oe,_ as na}from"./DZZ6t_j4.js";import{u as aa}from"./DA0VIM8P.js";import{f as pt,i as oa,c as ra,d as ia}from"./C3jLTHF4.js";import{F as Qe}from"./BYINaHrJ.js";import{E as sa,_ as la}from"./DyDFI6NE.js";import"./DKN1hQ6S.js";import{I as tn}from"./BQuyMdA-.js";import{C as nn}from"./DNgdBwTe.js";import{i as ca,_ as an}from"./dfem9Uc_.js";import{_ as on}from"./0azk-b-q.js";import{p as xt}from"./BO2leIU3.js";import{_ as ua}from"./CmWcz5yS.js";import{u as da}from"./vll-Pnjv.js";var fa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};function $t(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),n.forEach(function(o){ma(a,o,t[o])})}return a}function ma(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var _t=function(e,t){var n=$t({},e,t.attrs);return p(Ne,$t({},n,{icon:fa}),null)};_t.displayName="DeleteOutlined";_t.inheritAttrs=!1;function pa(a,e){var t="cannot ".concat(a.method," ").concat(a.action," ").concat(e.status,"'"),n=new Error(t);return n.status=e.status,n.method=a.method,n.url=a.action,n}function Lt(a){var e=a.responseText||a.response;if(!e)return e;try{return JSON.parse(e)}catch{return e}}function va(a){var e=new XMLHttpRequest;a.onProgress&&e.upload&&(e.upload.onprogress=function(r){r.total>0&&(r.percent=r.loaded/r.total*100),a.onProgress(r)});var t=new FormData;a.data&&Object.keys(a.data).forEach(function(o){var r=a.data[o];if(Array.isArray(r)){r.forEach(function(l){t.append("".concat(o,"[]"),l)});return}t.append(o,r)}),a.file instanceof Blob?t.append(a.filename,a.file,a.file.name):t.append(a.filename,a.file),e.onerror=function(r){a.onError(r)},e.onload=function(){return e.status<200||e.status>=300?a.onError(pa(a,e),Lt(e)):a.onSuccess(Lt(e),e)},e.open(a.method,a.action,!0),a.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0);var n=a.headers||{};return n["X-Requested-With"]!==null&&e.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(n).forEach(function(o){n[o]!==null&&e.setRequestHeader(o,n[o])}),e.send(t),{abort:function(){e.abort()}}}var ga=+new Date,ha=0;function rt(){return"vc-upload-".concat(ga,"-").concat(++ha)}const it=function(a,e){if(a&&e){var t=Array.isArray(e)?e:e.split(","),n=a.name||"",o=a.type||"",r=o.replace(/\/.*$/,"");return t.some(function(l){var f=l.trim();if(/^\*(\/\*)?$/.test(l))return!0;if(f.charAt(0)==="."){var m=n.toLowerCase(),u=f.toLowerCase(),O=[u];return(u===".jpg"||u===".jpeg")&&(O=[".jpg",".jpeg"]),O.some(function(x){return m.endsWith(x)})}return/\/\*$/.test(f)?r===f.replace(/\/.*$/,""):!!(o===f||/^\w+$/.test(f))})}return!0};function ba(a,e){var t=a.createReader(),n=[];function o(){t.readEntries(function(r){var l=Array.prototype.slice.apply(r);n=n.concat(l);var f=!l.length;f?e(n):o()})}o()}var ya=function(e,t,n){var o=function r(l,f){l.path=f||"",l.isFile?l.file(function(m){n(m)&&(l.fullPath&&!m.webkitRelativePath&&(Object.defineProperties(m,{webkitRelativePath:{writable:!0}}),m.webkitRelativePath=l.fullPath.replace(/^\//,""),Object.defineProperties(m,{webkitRelativePath:{writable:!1}})),t([m]))}):l.isDirectory&&ba(l,function(m){m.forEach(function(u){r(u,"".concat(f).concat(l.name,"/"))})})};e.forEach(function(r){o(r.webkitGetAsEntry())})},rn=function(){return{capture:[Boolean,String],multipart:{type:Boolean,default:void 0},name:String,disabled:{type:Boolean,default:void 0},componentTag:String,action:[String,Function],method:String,directory:{type:Boolean,default:void 0},data:[Object,Function],headers:Object,accept:String,multiple:{type:Boolean,default:void 0},onBatchStart:Function,onReject:Function,onStart:Function,onError:Function,onSuccess:Function,onProgress:Function,beforeUpload:Function,customRequest:Function,withCredentials:{type:Boolean,default:void 0},openFileDialogOnClick:{type:Boolean,default:void 0},prefixCls:String,id:String,onMouseenter:Function,onMouseleave:Function,onClick:Function}};function wa(a,e,t,n){for(var o=-1,r=a==null?0:a.length;++o<r;){var l=a[o];e(n,l,t(l),a)}return n}function _a(a){return function(e,t,n){for(var o=-1,r=Object(e),l=n(e),f=l.length;f--;){var m=l[++o];if(t(r[m],m,r)===!1)break}return e}}var Ia=_a();function Ta(a,e){return a&&Ia(a,e,gn)}function ka(a,e){return function(t,n){if(t==null)return t;if(!hn(t))return a(t,n);for(var o=t.length,r=-1,l=Object(t);++r<o&&n(l[r],r,l)!==!1;);return t}}var Ca=ka(Ta);function Da(a,e,t,n){return Ca(a,function(o,r,l){e(n,o,t(o),l)}),n}function Sa(a,e){return function(t,n){var o=bn(t)?wa:Da,r=e?e():{};return o(t,a,ca(n),r)}}var Fa=Sa(function(a,e,t){a[t?0:1].push(e)},function(){return[[],[]]}),Ra=["componentTag","prefixCls","disabled","id","multiple","accept","capture","directory","openFileDialogOnClick","onMouseenter","onMouseleave"];const Oa=Ce({compatConfig:{MODE:3},name:"AjaxUploader",inheritAttrs:!1,props:rn(),setup:function(e,t){var n=t.slots,o=t.attrs,r=t.expose,l=Y(rt()),f={},m=Y(),u=!1,O=function(){var i=zt(We.mark(function D(b,h){var P,_,A,Z,ee,v,k,R,F;return We.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(P=e.beforeUpload,_=b,!P){I.next=14;break}return I.prev=3,I.next=6,P(b,h);case 6:_=I.sent,I.next=12;break;case 9:I.prev=9,I.t0=I.catch(3),_=!1;case 12:if(_!==!1){I.next=14;break}return I.abrupt("return",{origin:b,parsedFile:null,action:null,data:null});case 14:if(A=e.action,typeof A!="function"){I.next=21;break}return I.next=18,A(b);case 18:Z=I.sent,I.next=22;break;case 21:Z=A;case 22:if(ee=e.data,typeof ee!="function"){I.next=29;break}return I.next=26,ee(b);case 26:v=I.sent,I.next=30;break;case 29:v=ee;case 30:return k=(Ht(_)==="object"||typeof _=="string")&&_?_:b,k instanceof File?R=k:R=new File([k],b.name,{type:b.type}),F=R,F.uid=b.uid,I.abrupt("return",{origin:b,data:v,parsedFile:F,action:Z});case 35:case"end":return I.stop()}},D,null,[[3,9]])}));return function(b,h){return i.apply(this,arguments)}}(),x=function(D){var b=D.data,h=D.origin,P=D.action,_=D.parsedFile;if(u){var A=e.onStart,Z=e.customRequest,ee=e.name,v=e.headers,k=e.withCredentials,R=e.method,F=h.uid,U=Z||va,I={action:P,filename:ee,data:b,file:_,headers:v,withCredentials:k,method:R||"post",onProgress:function(M){var V=e.onProgress;V==null||V(M,_)},onSuccess:function(M,V){var L=e.onSuccess;L==null||L(M,_,V),delete f[F]},onError:function(M,V){var L=e.onError;L==null||L(M,V,_),delete f[F]}};A(h),f[F]=U(I)}},j=function(){l.value=rt()},z=function(D){if(D){var b=D.uid?D.uid:D;f[b]&&f[b].abort&&f[b].abort(),delete f[b]}else Object.keys(f).forEach(function(h){f[h]&&f[h].abort&&f[h].abort(),delete f[h]})};Ue(function(){u=!0}),Nt(function(){u=!1,z()});var W=function(D){var b=Ve(D),h=b.map(function(P){return P.uid=rt(),O(P,b)});Promise.all(h).then(function(P){var _=e.onBatchStart;_==null||_(P.map(function(A){var Z=A.origin,ee=A.parsedFile;return{file:Z,parsedFile:ee}})),P.filter(function(A){return A.parsedFile!==null}).forEach(function(A){x(A)})})},y=function(D){var b=e.accept,h=e.directory,P=D.target.files,_=Ve(P).filter(function(A){return!h||it(A,b)});W(_),j()},C=function(D){var b=m.value;if(b){var h=e.onClick;b.click(),h&&h(D)}},S=function(D){D.key==="Enter"&&C(D)},$=function(D){var b=e.multiple;if(D.preventDefault(),D.type!=="dragover")if(e.directory)ya(Array.prototype.slice.call(D.dataTransfer.items),W,function(A){return it(A,e.accept)});else{var h=Fa(Array.prototype.slice.call(D.dataTransfer.files),function(A){return it(A,e.accept)}),P=h[0],_=h[1];b===!1&&(P=P.slice(0,1)),W(P),_.length&&e.onReject&&e.onReject(_)}};return r({abort:z}),function(){var i,D,b=e.componentTag,h=e.prefixCls,P=e.disabled,_=e.id,A=e.multiple,Z=e.accept,ee=e.capture,v=e.directory,k=e.openFileDialogOnClick,R=e.onMouseenter,F=e.onMouseleave,U=Ke(e,Ra),I=(i={},ne(i,h,!0),ne(i,"".concat(h,"-disabled"),P),ne(i,o.class,!!o.class),i),B=v?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},M=P?{}:{onClick:k?C:function(){},onKeydown:k?S:function(){},onMouseenter:R,onMouseleave:F,onDrop:$,onDragover:$,tabindex:"0"};return p(b,J(J({},M),{},{class:I,role:"button",style:o.style}),{default:function(){return[p("input",J(J(J({},yn(U,{aria:!0,data:!0})),{},{id:_,type:"file",ref:m,onClick:function(d){return d.stopPropagation()},key:l.value,style:{display:"none"},accept:Z},B),{},{multiple:A,onChange:y},ee!=null?{capture:ee}:{}),null),(D=n.default)===null||D===void 0?void 0:D.call(n)]}})}}});function st(){}const Ut=Ce({compatConfig:{MODE:3},name:"Upload",inheritAttrs:!1,props:gt(rn(),{componentTag:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:st,onError:st,onSuccess:st,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0}),setup:function(e,t){var n=t.slots,o=t.attrs,r=t.expose,l=Y(),f=function(u){var O;(O=l.value)===null||O===void 0||O.abort(u)};return r({abort:f}),function(){return p(Oa,J(J(J({},e),o),{},{ref:l}),n)}}});var Pa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"};function Et(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),n.forEach(function(o){xa(a,o,t[o])})}return a}function xa(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var It=function(e,t){var n=Et({},e,t.attrs);return p(Ne,Et({},n,{icon:Pa}),null)};It.displayName="PaperClipOutlined";It.inheritAttrs=!1;var $a={icon:function(e,t){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:e}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:t}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:t}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:t}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:e}}]}},name:"picture",theme:"twotone"};function jt(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),n.forEach(function(o){La(a,o,t[o])})}return a}function La(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var Tt=function(e,t){var n=jt({},e,t.attrs);return p(Ne,jt({},n,{icon:$a}),null)};Tt.displayName="PictureTwoTone";Tt.inheritAttrs=!1;var Ua={icon:function(e,t){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:t}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:e}}]}},name:"file",theme:"twotone"};function At(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),n.forEach(function(o){Ea(a,o,t[o])})}return a}function Ea(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var kt=function(e,t){var n=At({},e,t.attrs);return p(Ne,At({},n,{icon:Ua}),null)};kt.displayName="FileTwoTone";kt.inheritAttrs=!1;function sn(){return{capture:[Boolean,String],type:String,name:String,defaultFileList:Array,fileList:Array,action:[String,Function],directory:{type:Boolean,default:void 0},data:[Object,Function],method:String,headers:Object,showUploadList:{type:[Boolean,Object],default:void 0},multiple:{type:Boolean,default:void 0},accept:String,beforeUpload:Function,onChange:Function,"onUpdate:fileList":Function,onDrop:Function,listType:String,onPreview:Function,onDownload:Function,onReject:Function,onRemove:Function,remove:Function,supportServerRender:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},prefixCls:String,customRequest:Function,withCredentials:{type:Boolean,default:void 0},openFileDialogOnClick:{type:Boolean,default:void 0},locale:{type:Object,default:void 0},id:String,previewFile:Function,transformFile:Function,iconRender:Function,isImageUrl:Function,progress:Object,itemRender:Function,maxCount:Number,height:[Number,String],removeIcon:Function,downloadIcon:Function,previewIcon:Function}}function ja(){return{listType:String,onPreview:Function,onDownload:Function,onRemove:Function,items:Array,progress:Object,prefixCls:String,showRemoveIcon:{type:Boolean,default:void 0},showDownloadIcon:{type:Boolean,default:void 0},showPreviewIcon:{type:Boolean,default:void 0},removeIcon:Function,downloadIcon:Function,previewIcon:Function,locale:{type:Object,default:void 0},previewFile:Function,iconRender:Function,isImageUrl:Function,appendAction:Function,appendActionVisible:{type:Boolean,default:void 0},itemRender:Function}}function He(a){return J(J({},a),{},{lastModified:a.lastModified,lastModifiedDate:a.lastModifiedDate,name:a.name,size:a.size,type:a.type,uid:a.uid,percent:0,originFileObj:a})}function qe(a,e){var t=Ve(e),n=t.findIndex(function(o){var r=o.uid;return r===a.uid});return n===-1?t.push(a):t[n]=a,t}function lt(a,e){var t=a.uid!==void 0?"uid":"name";return e.filter(function(n){return n[t]===a[t]})[0]}function Aa(a,e){var t=a.uid!==void 0?"uid":"name",n=e.filter(function(o){return o[t]!==a[t]});return n.length===e.length?null:n}var Ma=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=e.split("/"),n=t[t.length-1],o=n.split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(o)||[""])[0]},ln=function(e){return e.indexOf("image/")===0},Ba=function(e){if(e.type&&!e.thumbUrl)return ln(e.type);var t=e.thumbUrl||e.url||"",n=Ma(t);return/^data:image\//.test(t)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i.test(n)?!0:!(/^data:/.test(t)||n)},Ie=200;function Va(a){return new Promise(function(e){if(!a.type||!ln(a.type)){e("");return}var t=document.createElement("canvas");t.width=Ie,t.height=Ie,t.style.cssText="position: fixed; left: 0; top: 0; width: ".concat(Ie,"px; height: ").concat(Ie,"px; z-index: 9999; display: none;"),document.body.appendChild(t);var n=t.getContext("2d"),o=new Image;o.onload=function(){var r=o.width,l=o.height,f=Ie,m=Ie,u=0,O=0;r>l?(m=l*(Ie/r),O=-(m-f)/2):(f=r*(Ie/l),u=-(f-m)/2),n.drawImage(o,u,O,f,m);var x=t.toDataURL();document.body.removeChild(t),e(x)},o.src=window.URL.createObjectURL(a)})}var Na={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"};function Mt(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable}))),n.forEach(function(o){za(a,o,t[o])})}return a}function za(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}var Ct=function(e,t){var n=Mt({},e,t.attrs);return p(Ne,Mt({},n,{icon:Na}),null)};Ct.displayName="DownloadOutlined";Ct.inheritAttrs=!1;var Ha=function(){return{prefixCls:String,locale:{type:Object,default:void 0},file:Object,items:Array,listType:String,isImgUrl:Function,showRemoveIcon:{type:Boolean,default:void 0},showDownloadIcon:{type:Boolean,default:void 0},showPreviewIcon:{type:Boolean,default:void 0},removeIcon:Function,downloadIcon:Function,previewIcon:Function,iconRender:Function,actionIconRender:Function,itemRender:Function,onPreview:Function,onClose:Function,onDownload:Function,progress:{type:Object,default:void 0}}};const qa=Ce({compatConfig:{MODE:3},name:"ListItem",inheritAttrs:!1,props:Ha(),setup:function(e,t){var n=t.slots,o=t.attrs,r=Y(!1),l=Y();Ue(function(){l.value=setTimeout(function(){r.value=!0},300)}),Nt(function(){clearTimeout(l.value)});var f=ht("upload",e),m=f.rootPrefixCls,u=ue(function(){return wn("".concat(m.value,"-fade"))});return function(){var O,x,j=e.prefixCls,z=e.locale,W=e.listType,y=e.file,C=e.items,S=e.progress,$=e.iconRender,i=$===void 0?n.iconRender:$,D=e.actionIconRender,b=D===void 0?n.actionIconRender:D,h=e.itemRender,P=h===void 0?n.itemRender:h,_=e.isImgUrl,A=e.showPreviewIcon,Z=e.showRemoveIcon,ee=e.showDownloadIcon,v=e.previewIcon,k=v===void 0?n.previewIcon:v,R=e.removeIcon,F=R===void 0?n.removeIcon:R,U=e.downloadIcon,I=U===void 0?n.downloadIcon:U,B=e.onPreview,M=e.onDownload,V=e.onClose,L=o.class,d=o.style,g="".concat(j,"-span"),K=i({file:y}),X=p("div",{class:"".concat(j,"-text-icon")},[K]);if(W==="picture"||W==="picture-card")if(y.status==="uploading"||!y.thumbUrl&&!y.url){var oe,ie=(oe={},ne(oe,"".concat(j,"-list-item-thumbnail"),!0),ne(oe,"".concat(j,"-list-item-file"),y.status!=="uploading"),oe);X=p("div",{class:ie},[K])}else{var de,we=_!=null&&_(y)?p("img",{src:y.thumbUrl||y.url,alt:y.name,class:"".concat(j,"-list-item-image")},null):K,De=(de={},ne(de,"".concat(j,"-list-item-thumbnail"),!0),ne(de,"".concat(j,"-list-item-file"),_&&!_(y)),de);X=p("a",{class:De,onClick:function(me){return B(y,me)},href:y.url||y.thumbUrl,target:"_blank",rel:"noopener noreferrer"},[we])}var pe=(O={},ne(O,"".concat(j,"-list-item"),!0),ne(O,"".concat(j,"-list-item-").concat(y.status),!0),ne(O,"".concat(j,"-list-item-list-type-").concat(W),!0),O),Ee=typeof y.linkProps=="string"?JSON.parse(y.linkProps):y.linkProps,Pe=Z?b({customIcon:F?F({file:y}):p(_t,null,null),callback:function(){return V(y)},prefixCls:j,title:z.removeFile}):null,xe=ee&&y.status==="done"?b({customIcon:I?I({file:y}):p(Ct,null,null),callback:function(){return M(y)},prefixCls:j,title:z.downloadFile}):null,$e=W!=="picture-card"&&p("span",{key:"download-delete",class:["".concat(j,"-list-item-card-actions"),{picture:W==="picture"}]},[xe,Pe]),G="".concat(j,"-list-item-name"),je=y.url?[p("a",J(J({key:"view",target:"_blank",rel:"noopener noreferrer",class:G,title:y.name},Ee),{},{href:y.url,onClick:function(me){return B(y,me)}}),[y.name]),$e]:[p("span",{key:"view",class:G,onClick:function(me){return B(y,me)},title:y.name},[y.name]),$e],_e={pointerEvents:"none",opacity:.5},Ze=A?p("a",{href:y.url||y.thumbUrl,target:"_blank",rel:"noopener noreferrer",style:y.url||y.thumbUrl?void 0:_e,onClick:function(me){return B(y,me)},title:z.previewFile},[k?k({file:y}):p(sa,null,null)]):null,et=W==="picture-card"&&y.status!=="uploading"&&p("span",{class:"".concat(j,"-list-item-actions")},[Ze,y.status==="done"&&xe,Pe]),c;if(y.response&&typeof y.response=="string")c=y.response;else{var T,ce;c=((T=y.error)===null||T===void 0?void 0:T.statusText)||((ce=y.error)===null||ce===void 0?void 0:ce.message)||z.uploadError}var se=p("span",{class:g},[X,je]),re=p("div",{class:pe},[p("div",{class:"".concat(j,"-list-item-info")},[se]),et,r.value&&p(_n,u.value,{default:function(){return[bt(p("div",{class:"".concat(j,"-list-item-progress")},["percent"in y?p(ua,J(J({},S),{},{type:"line",percent:y.percent}),null):null]),[[qt,y.status==="uploading"]])]}})]),be=(x={},ne(x,"".concat(j,"-list-").concat(W,"-container"),!0),ne(x,"".concat(L),!!L),x),ge=y.status==="error"?p(Jt,{title:c,getPopupContainer:function(me){return me.parentNode}},{default:function(){return[re]}}):re;return p("div",{class:be,style:d,ref:Y},[P?P({originNode:ge,file:y,fileList:C,actions:{download:M.bind(null,y),preview:B.bind(null,y),remove:V.bind(null,y)}}):ge])}}});var Ja=function(e,t){var n,o=t.slots;return Dn((n=o.default)===null||n===void 0?void 0:n.call(o))[0]};const Ga=Ce({compatConfig:{MODE:3},name:"AUploadList",props:gt(ja(),{listType:"text",progress:{strokeWidth:2,showInfo:!1},showRemoveIcon:!0,showDownloadIcon:!1,showPreviewIcon:!0,previewFile:Va,isImageUrl:Ba,items:[],appendActionVisible:!0}),setup:function(e,t){var n=t.slots,o=t.expose,r=Y(!1),l=Sn();Ue(function(){r.value==!0}),In(function(){e.listType!=="picture"&&e.listType!=="picture-card"||(e.items||[]).forEach(function(S){typeof document>"u"||typeof window>"u"||!window.FileReader||!window.File||!(S.originFileObj instanceof File||S.originFileObj instanceof Blob)||S.thumbUrl!==void 0||(S.thumbUrl="",e.previewFile&&e.previewFile(S.originFileObj).then(function($){S.thumbUrl=$||"",l.update()}))})});var f=function($,i){if(e.onPreview)return i==null||i.preventDefault(),e.onPreview($)},m=function($){typeof e.onDownload=="function"?e.onDownload($):$.url&&window.open($.url)},u=function($){var i;(i=e.onRemove)===null||i===void 0||i.call(e,$)},O=function($){var i=$.file,D=e.iconRender||n.iconRender;if(D)return D({file:i,listType:e.listType});var b=i.status==="uploading",h=e.isImageUrl&&e.isImageUrl(i)?p(Tt,null,null):p(kt,null,null),P=b?p(Dt,null,null):p(It,null,null);return e.listType==="picture"?P=b?p(Dt,null,null):h:e.listType==="picture-card"&&(P=b?e.locale.uploading:h),P},x=function($){var i=$.customIcon,D=$.callback,b=$.prefixCls,h=$.title,P={type:"text",size:"small",title:h,onClick:function(){D()},class:"".concat(b,"-list-item-card-actions-btn")};return Fn(i)?p(Xe,P,{icon:function(){return i}}):p(Xe,P,{default:function(){return[p("span",null,[i])]}})};o({handlePreview:f,handleDownload:m});var j=ht("upload",e),z=j.prefixCls,W=j.direction,y=ue(function(){var S;return S={},ne(S,"".concat(z.value,"-list"),!0),ne(S,"".concat(z.value,"-list-").concat(e.listType),!0),ne(S,"".concat(z.value,"-list-rtl"),W.value==="rtl"),S}),C=ue(function(){return J(J(J({},Tn("".concat(z.value,"-").concat(e.listType==="picture-card"?"animate-inline":"animate"))),kn("".concat(z.value,"-").concat(e.listType==="picture-card"?"animate-inline":"animate"))),{},{class:y.value,appear:r.value})});return function(){var S=e.listType,$=e.locale,i=e.isImageUrl,D=e.items,b=D===void 0?[]:D,h=e.showPreviewIcon,P=e.showRemoveIcon,_=e.showDownloadIcon,A=e.removeIcon,Z=e.previewIcon,ee=e.downloadIcon,v=e.progress,k=e.appendAction,R=e.itemRender,F=e.appendActionVisible,U=k==null?void 0:k();return p(Cn,J(J({},C.value),{},{tag:"div"}),{default:function(){return[b.map(function(B){var M=B.uid;return p(qa,{key:M,locale:$,prefixCls:z.value,file:B,items:b,progress:v,listType:S,isImgUrl:i,showPreviewIcon:h,showRemoveIcon:P,showDownloadIcon:_,onPreview:f,onDownload:m,onClose:u,removeIcon:A,previewIcon:Z,downloadIcon:ee,itemRender:R},J(J({},n),{},{iconRender:O,actionIconRender:x}))}),k?bt(p(Ja,{key:"__ant_upload_appendAction"},{default:function(){return U}}),[[qt,!!F]]):null]}})}}});var Ka=["class","style"],Be="__LIST_IGNORE_".concat(Date.now(),"__");const Je=Ce({compatConfig:{MODE:3},name:"AUpload",inheritAttrs:!1,props:gt(sn(),{type:"select",multiple:!1,action:"",data:{},accept:"",showUploadList:!0,listType:"text",disabled:!1,supportServerRender:!0}),setup:function(e,t){var n=t.slots,o=t.attrs,r=t.expose,l=da(),f=Rn(e.defaultFileList||[],{value:On(e,"fileList"),postState:function(k){var R=Date.now();return(k??[]).map(function(F,U){return!F.uid&&!Object.isFrozen(F)&&(F.uid="__AUTO__".concat(R,"_").concat(U,"__")),F})}}),m=St(f,2),u=m[0],O=m[1],x=Y("drop"),j=Y();Ue(function(){nt(e.fileList!==void 0||o.value===void 0,"Upload","`value` is not a valid prop, do you mean `fileList`?"),nt(e.transformFile===void 0,"Upload","`transformFile` is deprecated. Please use `beforeUpload` directly."),nt(e.remove===void 0,"Upload","`remove` props is deprecated. Please use `remove` event.")});var z=function(k,R,F){var U,I,B=Ve(R);e.maxCount===1?B=B.slice(-1):e.maxCount&&(B=B.slice(0,e.maxCount)),O(B);var M={file:k,fileList:B};F&&(M.event=F),(U=e["onUpdate:fileList"])===null||U===void 0||U.call(e,M.fileList),(I=e.onChange)===null||I===void 0||I.call(e,M),l.onFieldChange()},W=function(){var v=zt(We.mark(function k(R,F){var U,I,B,M;return We.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(U=e.beforeUpload,I=e.transformFile,B=R,!U){L.next=13;break}return L.next=5,U(R,F);case 5:if(M=L.sent,M!==!1){L.next=8;break}return L.abrupt("return",!1);case 8:if(delete R[Be],M!==Be){L.next=12;break}return Object.defineProperty(R,Be,{value:!0,configurable:!0}),L.abrupt("return",!1);case 12:Ht(M)==="object"&&M&&(B=M);case 13:if(!I){L.next=17;break}return L.next=16,I(B);case 16:B=L.sent;case 17:return L.abrupt("return",B);case 18:case"end":return L.stop()}},k)}));return function(R,F){return v.apply(this,arguments)}}(),y=function(k){var R=k.filter(function(I){return!I.file[Be]});if(R.length){var F=R.map(function(I){return He(I.file)}),U=Ve(u.value);F.forEach(function(I){U=qe(I,U)}),F.forEach(function(I,B){var M=I;if(R[B].parsedFile)I.status="uploading";else{var V=I.originFileObj,L;try{L=new File([V],V.name,{type:V.type})}catch{L=new Blob([V],{type:V.type}),L.name=V.name,L.lastModifiedDate=new Date,L.lastModified=new Date().getTime()}L.uid=I.uid,M=L}z(M,U)})}},C=function(k,R,F){try{typeof k=="string"&&(k=JSON.parse(k))}catch{}if(lt(R,u.value)){var U=He(R);U.status="done",U.percent=100,U.response=k,U.xhr=F;var I=qe(U,u.value);z(U,I)}},S=function(k,R){if(lt(R,u.value)){var F=He(R);F.status="uploading",F.percent=k.percent;var U=qe(F,u.value);z(F,U,k)}},$=function(k,R,F){if(lt(F,u.value)){var U=He(F);U.error=k,U.response=R,U.status="error";var I=qe(U,u.value);z(U,I)}},i=function(k){var R,F=e.onRemove||e.remove;Promise.resolve(typeof F=="function"?F(k):F).then(function(U){if(U!==!1){var I=Aa(k,u.value);if(I){var B,M;R=J(J({},k),{},{status:"removed"}),(B=u.value)===null||B===void 0||B.forEach(function(V){var L=R.uid!==void 0?"uid":"name";V[L]===R[L]&&!Object.isFrozen(V)&&(V.status="removed")}),(M=j.value)===null||M===void 0||M.abort(R),z(R,I)}}})},D=function(k){if(x.value=k.type,k.type==="drop"){var R;(R=e.onDrop)===null||R===void 0||R.call(e,k)}};r({onBatchStart:y,onSuccess:C,onProgress:S,onError:$,fileList:u,upload:j});var b=ht("upload",e),h=b.prefixCls,P=b.direction,_=Pn("Upload",xn.Upload,ue(function(){return e.locale})),A=St(_,1),Z=A[0],ee=function(k,R){var F=e.removeIcon,U=e.previewIcon,I=e.downloadIcon,B=e.previewFile,M=e.onPreview,V=e.onDownload,L=e.disabled,d=e.isImageUrl,g=e.progress,K=e.itemRender,X=e.iconRender,oe=e.showUploadList,ie=typeof oe=="boolean"?{}:oe,de=ie.showDownloadIcon,we=ie.showPreviewIcon,De=ie.showRemoveIcon;return oe?p(Ga,{listType:e.listType,items:u.value,previewFile:B,onPreview:M,onDownload:V,onRemove:i,showRemoveIcon:!L&&De,showPreviewIcon:we,showDownloadIcon:de,removeIcon:F,previewIcon:U,downloadIcon:I,iconRender:X,locale:Z.value,isImageUrl:d,progress:g,itemRender:K,appendActionVisible:R,appendAction:k},J({},n)):k==null?void 0:k()};return function(){var v,k,R,F=e.listType,U=e.disabled,I=e.type;o.class,o.style;var B=Ke(o,Ka),M=J(J(J({onBatchStart:y,onError:$,onProgress:S,onSuccess:C},B),e),{},{id:(v=e.id)!==null&&v!==void 0?v:l.id.value,prefixCls:h.value,beforeUpload:W,onChange:void 0});if(delete M.remove,(!n.default||U)&&delete M.id,I==="drag"){var V,L,d=at(h.value,(V={},ne(V,"".concat(h.value,"-drag"),!0),ne(V,"".concat(h.value,"-drag-uploading"),u.value.some(function(oe){return oe.status==="uploading"})),ne(V,"".concat(h.value,"-drag-hover"),x.value==="dragover"),ne(V,"".concat(h.value,"-disabled"),U),ne(V,"".concat(h.value,"-rtl"),P.value==="rtl"),V),o.class);return p("span",null,[p("div",{class:d,onDrop:D,onDragover:D,onDragleave:D,style:o.style},[p(Ut,J(J({},M),{},{ref:j,class:"".concat(h.value,"-btn")}),J({default:function(){return[p("div",{class:"".concat(h.value,"-drag-container")},[(L=n.default)===null||L===void 0?void 0:L.call(n)])]}},n))]),ee()])}var g=at(h.value,(k={},ne(k,"".concat(h.value,"-select"),!0),ne(k,"".concat(h.value,"-select-").concat(F),!0),ne(k,"".concat(h.value,"-disabled"),U),ne(k,"".concat(h.value,"-rtl"),P.value==="rtl"),k)),K=$n((R=n.default)===null||R===void 0?void 0:R.call(n)),X=function(ie){return p("div",{class:g,style:ie},[p(Ut,J(J({},M),{},{ref:j}),n)])};return F==="picture-card"?p("span",{class:at("".concat(h.value,"-picture-card-wrapper"),o.class)},[ee(X,!!(K&&K.length))]):p("span",{class:o.class},[X(K&&K.length?void 0:{display:"none"}),ee()])}}});var Wa=["height"],Xa=["style"];const Ge=Ce({compatConfig:{MODE:3},name:"AUploadDragger",inheritAttrs:!1,props:sn(),setup:function(e,t){var n=t.slots,o=t.attrs;return function(){var r=e.height,l=Ke(e,Wa),f=o.style,m=Ke(o,Xa),u=J(J(J({},l),m),{},{type:"drag",style:J(J({},f),{},{height:typeof r=="number"?"".concat(r,"px"):r})});return p(Je,u,n)}}});var Ya=Ge;const Qa=Ln(Je,{Dragger:Ge,LIST_IGNORE:Be,install:function(e){return e.component(Je.name,Je),e.component(Ge.name,Ge),e}}),Za={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},eo=H("path",{fill:"currentColor",d:"M7 15h2c0 1.08 1.37 2 3 2s3-.92 3-2c0-1.1-1.04-1.5-3.24-2.03C9.64 12.44 7 11.78 7 9c0-1.79 1.47-3.31 3.5-3.82V3h3v2.18C15.53 5.69 17 7.21 17 9h-2c0-1.08-1.37-2-3-2s-3 .92-3 2c0 1.1 1.04 1.5 3.24 2.03C14.36 11.56 17 12.22 17 15c0 1.79-1.47 3.31-3.5 3.82V21h-3v-2.18C8.47 18.31 7 16.79 7 15"},null,-1),to=[eo];function no(a,e){return q(),ye("svg",Za,[...to])}const ao={name:"mdi-currency-usd",render:no},oo={class:"px-5"},ro={key:0},io={class:"mb-4"},so={class:"mr-3 pt-2 text-gray-500 text-xs"},lo={href:"https://docs.nocodb.com/bases/import-base-from-airtable#get-airtable-credentials",class:"prose-sm underline text-grey text-xs",target:"_blank",rel:"noopener"},co={class:"prose-lg self-center my-4 text-gray-500"},uo={class:"mt-0 my-2"},fo={class:"my-2"},mo={class:"my-2"},po={class:"my-2"},vo={class:"my-2"},go={class:"my-2"},ho={href:"https://github.com/nocodb/nocodb/issues/2052",target:"_blank",rel:"noopener noreferrer"},bo={class:"prose-sm",href:"https://github.com/nocodb/nocodb/discussions/2122",target:"_blank",rel:"noopener noreferrer"},yo={key:1},wo={class:"mb-4 prose-xl font-bold"},_o={key:0,class:"flex items-center"},Io={class:"text-red-500 ml-2 log-message"},To={key:1,class:"flex items-center"},ko={class:"text-green-500 ml-2 log-message"},Co={key:1,class:"flex items-center"},Do={class:"text-green-500 ml-2"},So={class:"flex justify-center items-center"},Fo={key:0},mr=Ce({__name:"AirtableImport",props:{modelValue:{type:Boolean},baseId:{},sourceId:{}},emits:["update:modelValue"],setup(a,{emit:e}){const t=e,{$api:n}=dt(),o=n.instance.defaults.baseURL,{$state:r,$poller:l}=dt(),f=Gt(),{refreshCommandPalette:m}=Un(),{loadTables:u}=f,{getJobsForBase:O,loadJobsForBase:x}=aa(),j=Y(!1),z=Y(1),W=Y([]),y=Y(),C=Y(!1),S=Y(!1),$=Y(!1),i=Y({id:"",type:"Airtable",details:{syncInterval:"15mins",syncDirection:"Airtable to NocoDB",syncRetryCount:1,apiKey:"",appId:"",shareId:"",syncSourceUrlOrId:"",options:{syncViews:!0,syncData:!0,syncRollup:!1,syncLookup:!0,syncFormula:!1,syncAttachment:!0,syncUsers:!1}}}),D=async(d,g)=>{W.value.push({msg:d,status:g}),await Bn(()=>{var X,oe;const K=(oe=(X=y.value)==null?void 0:X.$el)==null?void 0:oe.firstElementChild;K&&(K.scrollTop=K.scrollHeight)})},b=async(d,g)=>{d===Se.COMPLETED?(j.value=!0,await u(),D("Done!",d),m()):d===Se.FAILED&&(await u(),S.value=!0,D(g.error.message,d),m())},h=d=>{D(d.message,"progress")},P=ue(()=>({"details.apiKey":[pt()],"details.syncSourceUrlOrId":[pt()]})),_=ue({get:()=>a.modelValue,set:d=>t("update:modelValue",d)}),A=Qe.useForm,{validateInfos:Z}=A(i,P),ee=ue(()=>!i.value.details.apiKey||!i.value.details.syncSourceUrlOrId),v=Y(!1);async function k(){v.value=!0,await R(),await I()}async function R(){try{const{id:d,...g}=i.value;d!==""?await $fetch(`/api/v1/db/meta/syncs/${d}`,{baseURL:o,method:"PATCH",headers:{"xc-auth":r.token.value},body:g}):i.value=await $fetch(`/api/v1/db/meta/projects/${a.baseId}/syncs/${a.sourceId}`,{baseURL:o,method:"POST",headers:{"xc-auth":r.token.value},body:g})}catch(d){ve.error(await Le(d))}}async function F(d){if($.value)return;$.value=!0,await x(a.baseId);const g=await O(a.baseId),K=d?{id:d}:g.sort((X,oe)=>new Date(oe.created_at).getTime()-new Date(X.created_at).getTime()).find(X=>X.base_id===a.baseId&&X.status!==Se.COMPLETED&&X.status!==Se.FAILED);if(!K){$.value=!1;return}l.subscribe({id:K.id},X=>{X.status!=="close"?(z.value=2,X.status?b(X.status,X.data):h(X.data)):($.value=!1,v.value=!1)})}async function U(){const d=await $fetch(`/api/v1/db/meta/projects/${a.baseId}/syncs/${a.sourceId}`,{baseURL:o,method:"GET",headers:{"xc-auth":r.token.value}}),{list:g}=d;g&&g[0]?(g[0].details=g[0].details||{},i.value=V(g[0]),i.value.details.syncSourceUrlOrId=g[0].details.appId&&g[0].details.appId.length>0?g[0].details.syncSourceUrlOrId:g[0].details.shareId,F()):i.value={id:"",type:"Airtable",details:{syncInterval:"15mins",syncDirection:"Airtable to NocoDB",syncRetryCount:1,apiKey:"",appId:"",shareId:"",syncSourceUrlOrId:"",options:{syncViews:!0,syncData:!0,syncRollup:!1,syncLookup:!0,syncFormula:!1,syncAttachment:!0,syncUsers:!1}}}}async function I(){try{const d=await $fetch(`/api/v1/db/meta/syncs/${i.value.id}/trigger`,{baseURL:o,method:"POST",headers:{"xc-auth":r.token.value}});$.value=!1,F(d.id)}catch(d){ve.error(await Le(d))}}async function B(){ft.confirm({title:"Are you sure you want to abort this job?",type:"warn",content:"This is a highly experimental feature and only marks job as not started, please don't abort the job unless you are sure job is stuck.",onOk:async()=>{try{await $fetch(`/api/v1/db/meta/syncs/${i.value.id}/abort`,{baseURL:o,method:"POST",headers:{"xc-auth":r.token.value}}),z.value=1,W.value=[],S.value=!1,C.value=!1}catch(d){ve.error(await Le(d))}}})}function M(){z.value=1,W.value=[],S.value=!1,C.value=!1}function V(d){var g;return(g=d.details)!=null&&g.options||(d.details.options={syncViews:!1,syncData:!0,syncRollup:!1,syncLookup:!0,syncFormula:!1,syncAttachment:!0},d.details.options.syncViews=d.syncViews,delete d.syncViews),d}Kt(()=>i.value.details.syncSourceUrlOrId,d=>{if(i.value.details){const g=d&&d.match(/(exp|shr).{14}/g);i.value.details.shareId=g?g[0]:"";const K=d&&d.match(/(app).{14}/g);i.value.details.appId=K?K[0]:""}}),Ue(async()=>{i.value.id&&F(),await U()});function L(d){let g="";for(const X of document.querySelectorAll(".nc-modal-airtable-import .log-message"))g+=`${X.textContent}
`;const K=document.createElement("a");K.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(g)}`),K.setAttribute("download",d),K.style.display="none",document.body.appendChild(K),K.click(),document.body.removeChild(K)}return(d,g)=>{const K=la,X=an,oe=tn,ie=on,de=nn,we=Jt,De=Qe,pe=Xe,Ee=ao,Pe=Mn,xe=ft,$e=En("e");return q(),te(xe,{visible:s(_),"onUpdate:visible":g[14]||(g[14]=G=>ct(_)?_.value=G:null),class:ut([{active:s(_)},"p-2"]),closable:s(z)!==2,keyboard:s(z)!==2,"mask-closable":s(z)!==2,width:"max(30vw, 600px)","wrap-class-name":"nc-modal-airtable-import",onKeydown:g[15]||(g[15]=Wt(G=>_.value=!1,["esc"]))},{footer:E(()=>[s(z)===1?(q(),ye("div",Fo,[p(pe,{key:"back",onClick:g[13]||(g[13]=G=>_.value=!1)},{default:E(()=>[ae(N(d.$t("general.cancel")),1)]),_:1}),bt((q(),te(pe,{key:"submit",type:"primary",class:"nc-btn-airtable-import",loading:s(v),disabled:s(ee),onClick:k},{default:E(()=>[ae(N(d.$t("activity.import")),1)]),_:1},8,["loading","disabled"])),[[$e,["c:sync-airtable:save-and-sync"]]])])):he("",!0)]),default:E(()=>[H("div",oo,[H("div",{class:"mt-5 prose-xl font-weight-bold",onDblclick:g[0]||(g[0]=G=>C.value=!0)},N(d.$t("title.quickImportAirtable")),33),s(z)===1?(q(),ye("div",ro,[H("div",io,[H("span",so,N(d.$t("general.credentials")),1),H("a",lo,N(d.$t("msg.info.airtable.credentials")),1)]),p(De,{ref:"form",model:s(i),name:"quick-import-airtable-form",layout:"horizontal",class:"m-0"},{default:E(()=>[p(X,Ft(Rt(s(Z)["details.apiKey"])),{default:E(()=>[p(K,{value:s(i).details.apiKey,"onUpdate:value":g[1]||(g[1]=G=>s(i).details.apiKey=G),class:"nc-input-api-key",placeholder:`${d.$t("labels.apiKey")} / ${d.$t("labels.personalAccessToken")}`,size:"large"},null,8,["value","placeholder"])]),_:1},16),p(X,Ft(Rt(s(Z)["details.syncSourceUrlOrId"])),{default:E(()=>[p(oe,{value:s(i).details.syncSourceUrlOrId,"onUpdate:value":g[2]||(g[2]=G=>s(i).details.syncSourceUrlOrId=G),class:"nc-input-shared-base",placeholder:`${d.$t("labels.sharedBaseUrl")}`,size:"large"},null,8,["value","placeholder"])]),_:1},16),H("div",co,N(d.$t("title.advancedSettings")),1),p(ie,{class:"mt-2 mb-5"}),H("div",uo,[p(de,{checked:s(i).details.options.syncData,"onUpdate:checked":g[3]||(g[3]=G=>s(i).details.options.syncData=G)},{default:E(()=>[ae(N(d.$t("labels.importData")),1)]),_:1},8,["checked"])]),H("div",fo,[p(de,{checked:s(i).details.options.syncViews,"onUpdate:checked":g[4]||(g[4]=G=>s(i).details.options.syncViews=G)},{default:E(()=>[ae(N(d.$t("labels.importSecondaryViews")),1)]),_:1},8,["checked"])]),H("div",mo,[p(de,{checked:s(i).details.options.syncRollup,"onUpdate:checked":g[5]||(g[5]=G=>s(i).details.options.syncRollup=G)},{default:E(()=>[ae(N(d.$t("labels.importRollupColumns")),1)]),_:1},8,["checked"])]),H("div",po,[p(de,{checked:s(i).details.options.syncLookup,"onUpdate:checked":g[6]||(g[6]=G=>s(i).details.options.syncLookup=G)},{default:E(()=>[ae(N(d.$t("labels.importLookupColumns")),1)]),_:1},8,["checked"])]),H("div",vo,[p(de,{checked:s(i).details.options.syncAttachment,"onUpdate:checked":g[7]||(g[7]=G=>s(i).details.options.syncAttachment=G)},{default:E(()=>[ae(N(d.$t("labels.importAttachmentColumns")),1)]),_:1},8,["checked"])]),H("div",go,[p(we,{placement:"top"},{title:E(()=>[H("span",null,N(d.$t("title.comingSoon")),1)]),default:E(()=>[p(de,{checked:s(i).details.options.syncFormula,"onUpdate:checked":g[8]||(g[8]=G=>s(i).details.options.syncFormula=G),disabled:""},{default:E(()=>[ae(N(d.$t("labels.importFormulaColumns")),1)]),_:1},8,["checked"])]),_:1})])]),_:1},8,["model"]),p(ie),H("div",null,[H("a",ho,N(d.$t("general.questions"))+" / "+N(d.$t("general.help"))+" - "+N(d.$t("general.reachOut")),1),g[17]||(g[17]=H("br",null,null,-1)),H("div",null,[ae(N(d.$t("general.betaNote"))+" ",1),H("a",bo,N(d.$t("general.moreInfo")),1),g[16]||(g[16]=ae(" . "))])])])):he("",!0),s(z)===2?(q(),ye("div",yo,[H("div",wo,N(d.$t("general.logs")),1),p(Pe,{ref_key:"logRef",ref:y,"body-style":{backgroundColor:"#000000",height:"400px",overflow:"auto"}},{default:E(()=>[s(j)||s(S)?(q(),te(pe,{key:0,class:"!absolute mr-1 mb-1 z-1 right-0 bottom-0 opacity-40 hover:opacity-100",size:"small",onClick:g[9]||(g[9]=G=>L("at-import-logs.txt"))},{default:E(()=>[(q(),te(Te(("iconMap"in d?d.iconMap:s(ke)).download),{class:"text-green-500"}))]),_:1})):he("",!0),(q(!0),ye(jn,null,An(s(W),({msg:G,status:je},_e)=>(q(),ye("div",{key:_e},[je===s(Se).FAILED?(q(),ye("div",_o,[(q(),te(Te(("iconMap"in d?d.iconMap:s(ke)).closeCircle),{class:"text-red-500"})),H("span",Io,N(G),1)])):(q(),ye("div",To,[p(Ee,{class:"text-green-500"}),H("span",ko,N(G),1)]))]))),128)),!s(W)||!s(W).length||s(W)[s(W).length-1].status!==s(Se).COMPLETED&&s(W)[s(W).length-1].status!==s(Se).FAILED?(q(),ye("div",Co,[(q(),te(Te(("iconMap"in d?d.iconMap:s(ke)).loading),{class:"text-green-500 animate-spin"})),H("span",Do,N(d.$t("labels.importing")),1)])):he("",!0)]),_:1},512),H("div",So,[s(j)?(q(),te(pe,{key:0,class:"mt-4",size:"large",onClick:g[10]||(g[10]=G=>_.value=!1)},{default:E(()=>[ae(N(d.$t("labels.goToDashboard")),1)]),_:1})):s(S)?(q(),te(pe,{key:1,class:"mt-4 uppercase",size:"large",danger:"",onClick:g[11]||(g[11]=G=>M())},{default:E(()=>[ae(N(d.$t("general.cancel")),1)]),_:1})):s(C)?(q(),te(pe,{key:2,class:"mt-4 uppercase",size:"large",danger:"",onClick:g[12]||(g[12]=G=>B())},{default:E(()=>[ae(N(d.$t("general.abort")),1)]),_:1})):he("",!0)])])):he("",!0)])]),_:1},8,["visible","class","closable","keyboard","mask-closable"])}}});class cn{constructor(e){Q(this,"progressCallback");this.progressCallback=e}progress(e){var t;(t=this.progressCallback)==null||t.call(this,e)}init(){}parse(){throw new Error("'parse' method is not implemented")}parseData(){throw new Error("'parseData' method is not implemented")}parseTemplate(){throw new Error("'parseTemplate' method is not implemented")}getColumns(){throw new Error("'getColumns' method is not implemented")}getTemplate(){throw new Error("'getTemplate' method is not implemented")}getData(){throw new Error("'getData' method is not implemented")}}const Ro={number:w.Number,string:w.SingleLineText,date:w.DateTime,boolean:w.Checkbox,object:w.JSON},Bt=(a,e)=>e.reduce((t,n)=>t&&t[n],a);class vt extends cn{constructor(t,n={},o){super(o);Q(this,"config");Q(this,"data");Q(this,"_jsonData");Q(this,"jsonData");Q(this,"base");Q(this,"columns");this.config=n,this._jsonData=t,this.base={tables:[]},this.jsonData=[],this.data=[],this.columns={}}async init(){this.progress("Initializing json parser");const t=typeof this._jsonData=="string"?JSON.parse(this._jsonData):JSON.parse(new TextDecoder().decode(this._jsonData));this.jsonData=Array.isArray(t)?t:[t]}getColumns(){return this.columns}getData(){return this.data}parse(){this.progress("Parsing json data");const t=this.jsonData,n="table",o={table_name:n,ref_table_name:n,columns:[]};this.data[n]=[];for(const r of Object.keys(t[0])){const l=this._parseColumn([r],t);o.columns.push(...l)}this.config.shouldImportData&&this._parseTableData(o),this.base.tables.push(o)}getTemplate(){return this.base}_parseColumn(t=[],n=this.jsonData,o=t.reduce((r,l)=>r&&r[l],this.jsonData[0])){const r=[];if(o&&typeof o=="object"&&!Array.isArray(o)&&this.config.normalizeNested)for(const l of Object.keys(o)){const f=this._parseColumn([...t,l],this.jsonData,o[l]);r.push(...f)}else{const l=t.join(" ").trim(),f=t.join("_").replace(/\W/g,"_").trim(),m={title:l,column_name:f,ref_column_name:f,uidt:w.SingleLineText,path:t};if(this.config.autoSelectFieldTypes){m.uidt=Ro[typeof o]||w.SingleLineText;const u=n.map(O=>Bt(O,t));Object.assign(m,Vn(u,m.uidt))}r.push(m)}return r}_parseTableData(t){for(const n of this.jsonData){const o={};for(let r=0;r<t.columns.length;r++){const l=Bt(n,t.columns[r].path||[]);t.columns[r].uidt===w.Checkbox?o[t.columns[r].ref_column_name]=yt(l):t.columns[r].uidt===w.SingleSelect||t.columns[r].uidt===w.MultiSelect?o[t.columns[r].ref_column_name]=(l||"").toString().trim()||null:t.columns[r].uidt===w.JSON?o[t.columns[r].ref_column_name]=JSON.stringify(l):o[t.columns[r].column_name]=l}this.data[t.ref_table_name].push(o)}}}class Oo extends vt{constructor(t,n,o,r){super({},n,r);Q(this,"url");Q(this,"$api");this.url=t,this.$api=o}async init(){this.progress("Downloading json file");const t=await this.$api.utils.axiosRequestMake({apiMeta:{url:this.url}});this._jsonData=t,await super.init()}}class Vt{constructor(e,t={},n){Q(this,"config");Q(this,"source");Q(this,"detectedColumnTypes");Q(this,"distinctValues");Q(this,"headers");Q(this,"tables");Q(this,"base");Q(this,"data",{});Q(this,"columnValues");Q(this,"progressCallback");this.config=t,this.source=e,this.base={tables:[]},this.detectedColumnTypes={},this.distinctValues={},this.headers={},this.columnValues={},this.tables={},this.progressCallback=n}async init(){}initTemplate(e,t,n){const o=+n.every(m=>m===null||typeof m=="string"),r={id:0,Id:0},l={id:0,Id:0},f={table_name:t,ref_table_name:t,columns:[]};this.headers[e]=[],this.tables[e]=[];for(const[m,u]of n.entries()){let O=(o&&u.toString().trim()||`Field ${m+1}`).trim(),x=(o&&u.toString().trim()||`field_${m+1}`).replace(/[` ~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"_").trim();for(;x in r;)x=`${x}${++r[x]}`;for(;O in l;)O=`${O}${++l[O]}`;r[x]=0,l[O]=0,this.detectedColumnTypes[m]={},this.distinctValues[m]=new Set,this.columnValues[m]=[],f.columns.push({title:O,column_name:x,ref_column_name:x,meta:{},uidt:w.SingleLineText,key:m}),this.headers[e].push(x),this.tables[e]=f}}detectInitialUidt(e){return!isNaN(Number(e))&&!isNaN(parseFloat(e))?w.Number:Nn(e)?w.DateTime:mt(e)?w.Checkbox:w.SingleLineText}detectColumnType(e,t){for(let n=0;n<t.length;n++){if(!t[n])continue;const o=[t[n]],r={uidt:this.detectInitialUidt(t[n])};Xt(o)?r.uidt=w.LongText:r.uidt===w.SingleLineText?Yt(o)?r.uidt=w.Email:Qt(o)?r.uidt=w.URL:mt(o)?r.uidt=w.Checkbox:t[n]&&n<this.config.maxRowsToParse&&(this.columnValues[n].push(t[n]),r.uidt=w.SingleSelect):r.uidt===w.Number?zn(o)&&(r.uidt=w.Decimal):r.uidt===w.DateTime&&t[n]&&n<this.config.maxRowsToParse&&this.columnValues[n].push(t[n]),r.uidt in this.detectedColumnTypes[n]||(this.detectedColumnTypes[n]={...this.detectedColumnTypes[n],[r.uidt]:0}),this.detectedColumnTypes[n][r.uidt]+=1,t[n]&&this.distinctValues[n].add(t[n])}}getPossibleUidt(e){const t=this.detectedColumnTypes[e],n=Object.keys(t).length;return n===0?w.SingleLineText:n===2&&w.Number in t&&w.Decimal in t?w.Decimal:n>1?w.LongText in t?w.LongText:w.SingleLineText:Object.keys(t)[0]}updateTemplate(e){for(let t=0;t<this.headers[e].length;t++){const n=this.getPossibleUidt(t);if(this.columnValues[t].length>0){if(n===w.DateTime){const o={};if(this.columnValues[t].slice(1,this.config.maxRowsToParse).every(r=>{const l=r.split(" ").length===1;return l&&(o[Ye(r)]=(o[Ye(r)]||0)+1),l})){this.tables[e].columns[t].uidt=w.Date;const r=Object.keys(o);this.tables[e].columns[t].meta.date_format=r.length?r.reduce((l,f)=>o[l]>o[f]?l:f):"YYYY/MM/DD"}else this.tables[e].columns[t].uidt=n}else n===w.SingleSelect||n===w.MultiSelect?(this.tables[e].columns[t].uidt=w.SingleLineText,Object.assign(this.tables[e].columns[t],Zt(this.columnValues[t]))):this.tables[e].columns[t].uidt=n;delete this.columnValues[t]}else this.tables[e].columns[t].uidt=n}}async _parseTableData(e,t,n){return new Promise((o,r)=>{const l=this;let f=0;if(l.config.shouldImportData){l.progress(`Processing ${n} data`),f=0;const m=this.config.importFromURL?t:t.originFileObj;xt.parse(m,{download:l.config.importFromURL,skipEmptyLines:"greedy",step(u){if(f+=1,u&&f>=+l.config.firstRowAsHeaders+1){const O={};for(let x=0;x<l.headers[e].length;x++){const j=l.tables[e].columns[x],z=u.data[x]===""?null:u.data[x];j.uidt===w.Checkbox?O[j.column_name]=yt(z):j.uidt===w.SingleSelect||j.uidt===w.MultiSelect?O[j.column_name]=(z||"").toString().trim()||null:O[j.column_name]=z}l.data[n].push(O)}f%1e3===0&&l.progress(`Processed ${f} rows of ${n}`)},complete(){l.progress(`Processed ${n} data`),o(!0)},error(u){r(u)}})}else o(!0)})}async _parseTableMeta(e,t){return new Promise((n,o)=>{const r=this;let l=0;const f=(this.config.importFromURL?t.split("/").pop():t.name).replace(/[` ~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"_").trim();this.data[f]=[];const m=this.config.importFromURL?t:t.originFileObj;xt.parse(m,{download:r.config.importFromURL,skipEmptyLines:"greedy",step(u){l+=1,u&&(l===1?r.config.firstRowAsHeaders?r.initTemplate(e,f,u.data):(r.initTemplate(e,f,[...Array(u.data.length)].map((O,x)=>`field_${x+1}`)),r.config.autoSelectFieldTypes&&r.detectColumnType(e,u.data)):r.config.autoSelectFieldTypes&&r.detectColumnType(e,u.data))},async complete(){r.updateTemplate(e),r.base.tables.push(r.tables[e]),r.progress(`Processed ${f} metadata`),await r._parseTableData(e,t,f),n(!0)},error(u){o(u)}})})}async parse(){this.config.importFromURL?await this._parseTableMeta(0,this.source):await Promise.all(this.source.map((e,t)=>(async(n,o)=>{this.progress(`Parsing ${n.name}`),await this._parseTableMeta(o,n)})(e,t)))}getColumns(){return this.base.tables.map(e=>e.columns)}getData(){return this.data}getTemplate(){return this.base}progress(e){var t;(t=this.progressCallback)==null||t.call(this,e)}}const Po={d:w.DateTime,b:w.Checkbox,n:w.Number,s:w.SingleLineText};class un extends cn{constructor(t={},n={},o=null,r){super(r);Q(this,"config");Q(this,"excelData");Q(this,"base");Q(this,"data",{});Q(this,"wb");Q(this,"xlsx");this.config=n,this.excelData=t,this.base={tables:[]},this.xlsx=o}async init(){this.progress("Initializing excel parser"),this.xlsx=this.xlsx||await wt(()=>import("./C2piJvdv.js"),[],import.meta.url);const t={cellText:!0,cellDates:!0};this.wb=this.xlsx.read(new Uint8Array(this.excelData),{type:"array",...t})}async parse(){this.progress("Parsing excel file");const t={};await Promise.all(this.wb.SheetNames.map(n=>(async o=>{this.progress(`Parsing sheet ${n}`),await new Promise(r=>{const l={id:0,Id:0};let f=(o||"table").replace(/[` ~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"_").trim();for(;f in t;)f=`${f}${++t[f]}`;t[f]=0;const m={table_name:f,ref_table_name:f,columns:[]},u=this.wb.Sheets[o];if(!u||!u["!ref"])return r(!0);const O=this.xlsx.utils.decode_range(u["!ref"]);let x=this.xlsx.utils.sheet_to_json(u,{header:1,blankrows:!1,defval:null});const j=new Date(1899,11,30,0,0,0),z=j.getTime()+(new Date().getTimezoneOffset()-j.getTimezoneOffset())*6e4,W=24*60*60*1e3,y=C=>{const S=this.xlsx.SSF.parse_date_code((C.getTime()-z)/W,{date1904:this.wb.Workbook.WBProps.date1904});return new Date(S.y,S.m,S.d,S.H,S.M,S.S)};x=x.map(C=>C.map(S=>S instanceof Date?y(S):S));for(let C=0;C<x[0].length;C++){const S=(this.config.firstRowAsHeaders&&x[0]&&x[0][C]&&x[0][C].toString().trim()||`Field ${C+1}`).trim();let $=(this.config.firstRowAsHeaders&&x[0]&&x[0][C]&&x[0][C].toString().trim()||`field_${C+1}`).replace(/[` ~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"_").trim();for(;$ in l;)$=`${$}${++l[$]}`;l[$]=0;const i={title:S,column_name:$,ref_column_name:$,meta:{},uidt:w.SingleLineText};if(this.config.autoSelectFieldTypes){const D=this.xlsx.utils.encode_cell({c:O.s.c+C,r:+this.config.firstRowAsHeaders}),b=u[D]||{};if(i.uidt=this.config.importDataOnly?Po[b.t]||w.SingleLineText:w.SingleLineText,i.uidt===w.SingleLineText&&this.config.importDataOnly)if(Xt(x,C))i.uidt=w.LongText;else if(Yt(x,C))i.uidt=w.Email;else if(Qt(x,C))i.uidt=w.URL;else{const h=x.slice(+this.config.firstRowAsHeaders).map(P=>P[C]).filter(P=>P!=null&&P.toString().trim()!=="");mt(h,C)?i.uidt=w.Checkbox:Object.assign(i,Zt(h))}else if(i.uidt===w.Number)x.slice(1,this.config.maxRowsToParse).some(h=>h&&h[C]&&parseInt(h[C])!==+h[C])&&(i.uidt=w.Decimal),x.slice(1,this.config.maxRowsToParse).every((h,P)=>{const _=this.xlsx.utils.encode_cell({c:O.s.c+C,r:P+ +this.config.firstRowAsHeaders}),A=u[_];return!A||A.w&&A.w.startsWith("$")})&&(i.uidt=w.Currency),x.slice(1,this.config.maxRowsToParse).some((h,P)=>{const _=this.xlsx.utils.encode_cell({c:O.s.c+C,r:P+ +this.config.firstRowAsHeaders}),A=u[_];return!A||A.w&&!(!isNaN(Number(A.w))&&!isNaN(parseFloat(A.w)))})&&(i.uidt=w.SingleLineText);else if(i.uidt===w.DateTime){const h={};x.slice(1,this.config.maxRowsToParse).every((P,_)=>{const A=this.xlsx.utils.encode_cell({c:O.s.c+C,r:_+ +this.config.firstRowAsHeaders}),Z=u[A],ee=!Z||Z.w&&Z.w.split(" ").length===1;return ee&&Z&&(h[Ye(Z.w)]=(h[Ye(Z.w)]||0)+1),ee})&&(i.uidt=w.Date,i.meta.date_format=Object.keys(h).reduce((P,_)=>h[P]>h[_]?P:_)||"YYYY/MM/DD")}}m.columns.push(i)}if(this.base.tables.push(m),this.data[f]=[],this.config.shouldImportData){this.progress(`Parsing data from ${f}`);let C=0;for(const S of x.slice(1)){const $={};for(let i=0;i<m.columns.length;i++)if(!this.config.autoSelectFieldTypes||!this.config.importDataOnly){const D=this.xlsx.utils.encode_cell({c:O.s.c+i,r:C+ +this.config.firstRowAsHeaders}),b=u[D];$[m.columns[i].column_name]=b&&b.w||S[i]}else if(m.columns[i].uidt===w.Checkbox)$[m.columns[i].column_name]=yt(S[i]);else if(m.columns[i].uidt===w.Currency){const D=this.xlsx.utils.encode_cell({c:O.s.c+i,r:C+ +this.config.firstRowAsHeaders}),b=u[D];$[m.columns[i].column_name]=b&&typeof(b==null?void 0:b.w)=="string"&&b.w.replace(/[^\d.]+/g,"")||S[i]}else if(m.columns[i].uidt===w.SingleSelect||m.columns[i].uidt===w.MultiSelect)$[m.columns[i].column_name]=(S[i]||"").toString().trim()||null;else if(m.columns[i].uidt===w.Date){const D=this.xlsx.utils.encode_cell({c:O.s.c+i,r:C+ +this.config.firstRowAsHeaders}),b=u[D];$[m.columns[i].column_name]=b&&b.w||S[i]}else m.columns[i].uidt===w.SingleLineText||m.columns[i].uidt===w.LongText?$[m.columns[i].column_name]=S[i]===null||S[i]===void 0?null:`${S[i]}`:$[m.columns[i].column_name]=S[i];this.data[f].push($),C++}}r(!0)})})(n)))}getTemplate(){return this.base}getData(){return this.data}getColumns(){return this.base.tables.map(t=>t.columns)}}class xo extends un{constructor(t,n,o,r=null,l){super({},n,r,l);Q(this,"url");Q(this,"excelData");Q(this,"$api");this.url=t,this.excelData=null,this.$api=o}async init(){this.progress("Downloading excel file");const t=await this.$api.utils.axiosRequestMake({apiMeta:{url:this.url}});this.excelData=t.data,await super.init()}}const $o=""+new URL("importWorker-DGC0Hc8U.js",import.meta.url).href,Lo=en(()=>wt(()=>import("./BsNJKiLS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url).then(a=>a.default||a)),Uo=en(()=>wt(()=>import("./B4Lj1XSi.js"),__vite__mapDeps([25,26,1,2,27,28,29]),import.meta.url).then(a=>a.default||a)),Eo={class:"px-5"},jo={class:"prose-xl font-weight-bold my-5"},Ao={class:"flex items-center gap-2"},Mo={class:"py-6"},Bo={class:"ant-upload-text"},Vo={class:"ant-upload-hint"},No={class:"flex items-center gap-2"},zo={class:"pb-3 pt-3"},Ho={class:"flex items-center gap-2"},qo={class:"pr-10 pt-5"},Jo={key:0},Go={class:"mb-4"},Ko={class:"prose-lg"},Wo={class:"caption"},Xo={class:"caption"},Yo=Ce({__name:"QuickImport",props:{modelValue:{type:Boolean},importType:{},baseId:{},sourceId:{},importDataOnly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a,{expose:e,emit:t}){const n=Xn(a,["importType","importDataOnly","baseId","sourceId"]),o=t,{$api:r}=dt(),{appInfo:l}=Ot(),f=ta(),m=typeof Worker<"u";let u;const{t:O}=Hn(),x=Y("Parsing Data ..."),{tables:j}=Pt(Gt()),z=qn(),{loadProjectTables:W}=z,{baseTables:y}=Pt(z),C=Y("uploadTab"),S=Y(),$=Y(),i=Y(!1),D=Y(!1),b=Y(),h=Y(),P=Y([]),_=Y(!1),A=Y(!1),Z=Qe.useForm,ee={fileList:[],url:"",jsonEditor:{},parserConfig:{maxRowsToParse:500,normalizeNested:!0,autoSelectFieldTypes:!0,firstRowAsHeaders:!0,shouldImportData:!0,importDataOnly:!0}},v=Jn(ee),{token:k}=Ot(),R=ue(()=>a.importType==="json"),F=ue(()=>a.importType==="csv"),U=ue(()=>a.importType==="excel"),I=ue(()=>({url:[pt(),oa,F.value?ra:ia]})),{validate:B,validateInfos:M}=Z(v,I),V=ue(()=>U.value?{header:`${O("title.quickImportExcel")}`,uploadHint:O("msg.info.excelSupport"),urlInputLabel:O("msg.info.excelURL"),loadUrlDirective:["c:quick-import:excel:load-url"],acceptTypes:".xls, .xlsx, .xlsm, .ods, .ots"}:F.value?{header:`${O("title.quickImportCSV")}`,uploadHint:"",urlInputLabel:O("msg.info.csvURL"),loadUrlDirective:["c:quick-import:csv:load-url"],acceptTypes:".csv"}:R.value?{header:`${O("title.quickImportJSON")}`,uploadHint:"",acceptTypes:".json"}:{}),L=Gn(n,"modelValue",o);m&&Kt(L,async c=>{c?u=await Kn($o):u==null||u.terminate()},{immediate:!0});const d=ue(()=>{var c;if(C.value==="uploadTab")return!(v.fileList.length>0);if(C.value==="urlTab")return M.url.validateStatus?M.url.validateStatus==="error":!0;if(C.value==="jsonEditorTab")return!((c=S.value)!=null&&c.isValid)}),g=Y(!1),K=ue(()=>{var c;return!((c=$.value)!=null&&c.isValid)||g.value}),X=ue(()=>{var c;return!((c=S.value)!=null&&c.isValid)}),oe=ue(()=>"max(60vw, 600px)");let ie;async function de(){if(i.value=!0,A.value=!0,y.value.get(a.baseId)||await W(a.baseId),C.value==="uploadTab")F.value||m&&u?await _e(v.fileList):await _e(v.fileList[0].data);else if(C.value==="urlTab")try{await B(),await _e(v.url)}catch(c){ve.error(await Le(c))}else C.value==="jsonEditorTab"&&await _e(JSON.stringify(v.jsonEditor))}async function we(){try{if(!ie&&!u){ve.error(O("msg.error.templateGeneratorNotFound"));return}D.value=!0,await $.value.importTemplate()}catch(c){return ve.error(await Le(c))}finally{D.value=!1,_.value=!1,Object.assign(v,ee)}L.value=!1}function De(c){c.map(T=>ve.error(`${O("msg.error.fileUploadFailed")} ${T.name}`))}function pe(c){const T=c.file.status;if(T&&T!=="uploading"&&T!=="removed")if(F.value||m&&u)v.fileList.find(ce=>ce.uid===c.file.uid)||v.fileList.push({...c.file,status:"done"});else{const ce=new FileReader;ce.onload=se=>{const re=v.fileList.find(be=>be.uid===c.file.uid);se.target&&se.target.result&&(re?re.data=se.target.result:re||v.fileList.push({...c.file,status:"done",data:se.target.result}))},ce.readAsArrayBuffer(c.file.originFileObj)}T==="done"?ve.success(`Uploaded file ${c.file.name} successfully`):T==="error"&&ve.error(`${O("msg.error.fileUploadFailed")} ${c.file.name}`)}function Ee(){var c;(c=S.value)==null||c.format()}function Pe(c,T=[]){var se;let ce=1;for(;T.includes(c)||(se=y.value.get(a.baseId))!=null&&se.some(re=>{const be=re.table_name.split("___");let ge=re.table_name;return be.length>1&&(ge=be[1]),ge===`${c}`||re.table_name===`${c}`});)c=`${c}_${ce++}`;return c}function xe(c){if(F.value)switch(C.value){case"uploadTab":return new Vt(c,{...v.parserConfig,importFromURL:!1});case"urlTab":return new Vt(c,{...v.parserConfig,importFromURL:!0})}else if(U.value)switch(C.value){case"uploadTab":return new un(c,v.parserConfig);case"urlTab":return new xo(c,v.parserConfig,r)}else if(R.value)switch(C.value){case"uploadTab":return new vt(c,v.parserConfig);case"urlTab":return new Oo(c,v.parserConfig,r);case"jsonEditorTab":return new vt(c,v.parserConfig)}return null}e({handleChange:pe});const $e=c=>{v.fileList.forEach(T=>{T.uid===c.file.uid&&(T.status="done",pe({file:T,fileList:v.fileList}))}),c.onSuccess()},G=c=>{const T=c.size/1024/1024>25;return T&&ve.error(`File ${c.name} is too big. The accepted file size is less than 25MB.`),!T||Qa.LIST_IGNORE};function je(c){let T;if(F.value)switch(C.value){case"uploadTab":T={config:{...v.parserConfig,importFromURL:!1},value:c,importType:Re.CSV,importSource:Oe.FILE};break;case"urlTab":T={config:{...v.parserConfig,importFromURL:!0},value:c,importType:Re.CSV,importSource:Oe.FILE};break}else if(U.value)switch(C.value){case"uploadTab":T={config:Fe(v.parserConfig),value:c,importType:Re.EXCEL,importSource:Oe.FILE};break;case"urlTab":T={config:Fe(v.parserConfig),value:c,importType:Re.EXCEL,importSource:Oe.URL};break}else if(R.value)switch(C.value){case"uploadTab":T={config:Fe(v.parserConfig),value:c,importType:Re.JSON,importSource:Oe.FILE};break;case"urlTab":T={config:Fe(v.parserConfig),value:c,importType:Re.JSON,importSource:Oe.URL};break;case"jsonEditorTab":T={config:Fe(v.parserConfig),value:c,importType:Re.JSON,importSource:Oe.STRING};break}return T}async function _e(c){b.value=null,h.value=null,P.value=[];try{if(m&&u){u.postMessage([ze.INIT_SDK,{baseURL:f.public.ncBackendUrl||l.value.ncSiteUrl||Yn,token:k.value}]);let T=Fe(c);Array.isArray(T)&&(T=T.map(re=>Fe(re)));const ce=je(T);u.postMessage([ze.SET_TABLES,s(j).map(re=>({table_name:re.table_name,title:re.title}))]),u.postMessage([ze.SET_CONFIG,{importDataOnly:a.importDataOnly,importColumns:!!P.value,importData:!!h.value}]);const se=await new Promise((re,be)=>{const ge=fe=>{const[me,Ae]=fe.data;switch(me){case ot.PROCESSED_DATA:re(Ae),u==null||u.removeEventListener("message",ge,!1);break;case ot.PROGRESS:x.value=Ae;break;case ot.ERROR:be(Ae),u==null||u.removeEventListener("message",ge,!1);break}};u==null||u.addEventListener("message",ge,!1),u==null||u.postMessage([ze.PROCESS,ce])});b.value=se.templateData,P.value=se.importColumns,h.value=se.importData}else{if(ie=xe(c),!ie){ve.error(O("msg.error.templateGeneratorNotFound"));return}if(await ie.init(),await ie.parse(),b.value=ie.getTemplate(),a.importDataOnly)P.value=ie.getColumns();else{const T=[];b.value.tables=b.value.tables.map(ce=>{const se=Pe(ce.table_name,T);return T.push(se),{...ce,table_name:se}})}h.value=ie.getData()}_.value=!0}catch(T){console.log(T),ve.error(await Le(T))}finally{A.value=!1,i.value=!1}}const Ze=()=>{g.value=!0},et=()=>{g.value=!1};return Ue(()=>{v.parserConfig.importDataOnly=a.importDataOnly,v.parserConfig.autoSelectFieldTypes=a.importDataOnly}),(c,T)=>{const ce=Lo,se=Ya,re=Qn,be=Uo,ge=tn,fe=an,me=Qe,Ae=Zn,dn=on,tt=nn,fn=ea,Me=Xe,mn=ft;return q(),te(mn,{visible:s(L),"onUpdate:visible":T[9]||(T[9]=le=>ct(L)?L.value=le:null),class:ut({active:s(L)}),width:s(oe),"wrap-class-name":"nc-modal-quick-import",onKeydown:T[10]||(T[10]=Wt(le=>L.value=!1,["esc"]))},{footer:E(()=>[s(_)?(q(),te(Me,{key:"back",class:"!rounded-md",onClick:T[7]||(T[7]=le=>_.value=!1)},{default:E(()=>[ae(N(c.$t("general.back")),1)]),_:1})):(q(),te(Me,{key:"cancel",class:"!rounded-md",onClick:T[8]||(T[8]=le=>L.value=!1)},{default:E(()=>[ae(N(c.$t("general.cancel")),1)]),_:1})),s(C)==="jsonEditorTab"&&!s(_)?(q(),te(Me,{key:"format",class:"!rounded-md",disabled:s(X),onClick:Ee},{default:E(()=>[ae(N(c.$t("labels.formatJson")),1)]),_:1},8,["disabled"])):he("",!0),s(_)?(q(),te(Me,{key:"import",type:"primary",class:"!rounded-md",loading:s(D),disabled:s(K),onClick:we},{default:E(()=>[ae(N(c.$t("activity.import")),1)]),_:1},8,["loading","disabled"])):(q(),te(Me,{key:"pre-import",type:"primary",class:"nc-btn-import !rounded-md",loading:s(i),disabled:s(d),onClick:de},{default:E(()=>[ae(N(c.$t("activity.import")),1)]),_:1},8,["loading","disabled"]))]),default:E(()=>[p(fn,{spinning:s(A),tip:s(x),size:"large"},{default:E(()=>[H("div",Eo,[H("div",jo,N(s(V).header),1),H("div",{class:ut(["mt-5",{"mb-4":s(_)}])},[s(_)?(q(),te(ce,{key:0,ref_key:"templateEditorRef",ref:$,"base-template":s(b),"import-data":s(h),"import-columns":s(P),"import-data-only":c.importDataOnly,"quick-import-type":c.importType,"max-rows-to-parse":s(v).parserConfig.maxRowsToParse,"base-id":c.baseId,"source-id":c.sourceId,"import-worker":s(u),class:"nc-quick-import-template-editor",onImport:we,onError:Ze,onChange:et},null,8,["base-template","import-data","import-columns","import-data-only","quick-import-type","max-rows-to-parse","base-id","source-id","import-worker"])):(q(),te(Ae,{key:1,activeKey:s(C),"onUpdate:activeKey":T[3]||(T[3]=le=>ct(C)?C.value=le:null),"hide-add":"",type:"editable-card","tab-position":"top"},{default:E(()=>[p(re,{key:"uploadTab",closable:!1},{tab:E(()=>[H("div",Ao,[(q(),te(Te(("iconMap"in c?c.iconMap:s(ke)).fileUpload))),ae(" "+N(c.$t("general.upload")),1)])]),default:E(()=>[H("div",Mo,[p(se,{fileList:s(v).fileList,"onUpdate:fileList":T[0]||(T[0]=le=>s(v).fileList=le),name:"file",class:"nc-input-import !scrollbar-thin-dull","list-type":"picture",accept:s(V).acceptTypes,"max-count":s(F)?5:1,multiple:!0,"custom-request":$e,"before-upload":G,onChange:pe,onReject:De},{removeIcon:E(()=>[(q(),te(Te(("iconMap"in c?c.iconMap:s(ke)).deleteListItem)))]),default:E(()=>[(q(),te(Te(("iconMap"in c?c.iconMap:s(ke)).plusCircle),{size:"large"})),H("p",Bo,N(c.$t("msg.info.import.clickOrDrag")),1),H("p",Vo,N(s(V).uploadHint),1)]),_:1},8,["fileList","accept","max-count"])])]),_:1}),s(R)?(q(),te(re,{key:"jsonEditorTab",closable:!1},{tab:E(()=>[H("span",No,[(q(),te(Te(("iconMap"in c?c.iconMap:s(ke)).json))),ae(" "+N(c.$t("title.jsonEditor")),1)])]),default:E(()=>[H("div",zo,[p(be,{ref_key:"jsonEditorRef",ref:S,modelValue:s(v).jsonEditor,"onUpdate:modelValue":T[1]||(T[1]=le=>s(v).jsonEditor=le),class:"min-h-60 max-h-80"},null,8,["modelValue"])])]),_:1})):(q(),te(re,{key:"urlTab",closable:!1},{tab:E(()=>[H("span",Ho,[(q(),te(Te(("iconMap"in c?c.iconMap:s(ke)).link))),ae(" "+N(c.$t("datatype.URL")),1)])]),default:E(()=>[H("div",qo,[p(me,{model:s(v),name:"quick-import-url-form",layout:"vertical",class:"mb-0 !ml-0.5"},{default:E(()=>[p(fe,Wn({label:s(V).urlInputLabel},s(M).url),{default:E(()=>[p(ge,{value:s(v).url,"onUpdate:value":T[2]||(T[2]=le=>s(v).url=le),size:"large",class:"!rounded-md"},null,8,["value"])]),_:1},16,["label"])]),_:1},8,["model"])])]),_:1}))]),_:1},8,["activeKey"]))],2),s(_)?he("",!0):(q(),ye("div",Jo,[p(dn),H("div",Go,[H("span",Ko,N(c.$t("title.advancedSettings")),1),s(F)||s(U)?(q(),te(fe,{key:0,class:"!my-2"},{default:E(()=>[p(tt,{checked:s(v).parserConfig.firstRowAsHeaders,"onUpdate:checked":T[4]||(T[4]=le=>s(v).parserConfig.firstRowAsHeaders=le)},{default:E(()=>[H("span",Wo,N(c.$t("labels.firstRowAsHeaders")),1)]),_:1},8,["checked"])]),_:1})):he("",!0),s(R)?(q(),te(fe,{key:1,class:"!my-2"},{default:E(()=>[p(tt,{checked:s(v).parserConfig.normalizeNested,"onUpdate:checked":T[5]||(T[5]=le=>s(v).parserConfig.normalizeNested=le)},{default:E(()=>[H("span",Xo,N(c.$t("labels.flattenNested")),1)]),_:1},8,["checked"])]),_:1})):he("",!0),c.importDataOnly?he("",!0):(q(),te(fe,{key:2,class:"!my-2"},{default:E(()=>[p(tt,{checked:s(v).parserConfig.shouldImportData,"onUpdate:checked":T[6]||(T[6]=le=>s(v).parserConfig.shouldImportData=le)},{default:E(()=>[ae(N(c.$t("labels.importData")),1)]),_:1},8,["checked"])]),_:1}))])]))])]),_:1},8,["spinning","tip"])]),_:1},8,["visible","class","width"])}}}),Qo=na(Yo,[["__scopeId","data-v-de19a357"]]),pr=Object.freeze(Object.defineProperty({__proto__:null,default:Qo},Symbol.toStringTag,{value:"Module"}));export{pr as Q,mr as _,Qo as a};
