const __vite__fileDeps=["./BVHyv0aP.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./BIhr-Z4C.js","./ByVBARmO.js","./C4K5fdHe.js","./VirtualCell.BYk4C8Tn.css","./DG2ZH8TR.js","./CA74dF2b.js","./GMLocJHP.js","./qW2V2r_p.js","./boyBAVNN.js","./BDAIZopQ.js","./Cell.DUBzJZSm.css","./Co32XBKZ.js","./VirtualCell.Dgszrgh-.css","./Dby8gS7l.js","./37hePIet.js","./Cell.CE2XxAOg.css","./Tryc0omP.js","./CRPCEw5j.js","./sz1d3zjm.js","./MenuItem.C7h59s4s.css","./TJfB7GlU.js","./0azk-b-q.js","./Divider.DqtSqZhb.css","./BLgccLvp.js","./Menu.CQ8GNWeI.css","./vK-WmZ7a.js","./B9n4-CGo.js","./DivDataCell.1yCNpUg3.css","./DnwRMKX3.js","./UserIcon.DEVmGavY.css","./B6xrG0q8.js","./B89oU1M4.js","./Badge.D0-UrqG9.css","./BmNyaTYf.js","./Cy50pBgZ.js","./DKN1hQ6S.js","./BQuyMdA-.js","./BQQOEPN4.js","./vll-Pnjv.js","./B5RRVMt5.js","./DGj1ycqW.js","./DyDFI6NE.js","./links.C8uCzV-l.css","./Dwil3It4.js","./uhBJvRY2.js","./DS_HXCWn.js","./CMIIcM5i.js","./Bgw0NQgX.js","./2FgppHLC.js","./C4o9gerC.js","./B05h-4V9.js","./Ck-cgwga.js","./Tabs.DaLSLYpn.css","./BqKQ8afS.js","./DgixBgIx.js","./DeleteModal.SEMJ_gSK.css","./CXD-Dj4T.js","./i4aLU0Nw.js","./EqBqqo9-.js","./Bdv7ru7D.js","./BmtvKY7O.js","./DXQuLwNn.js","./index.XURKHfTB.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as ft,ba as Jt,bL as N,r as p,d7 as vt,cW as Wt,o,Q as n,w as s,b as u,N as e,O as ee,d6 as Xt,gT as Yt,hG as Qt,dJ as Zt,hH as ea,d8 as ta,dz as aa,az as ye,i1 as oa,u as la,ax as na,cO as sa,J as ia,L as ra,cX as da,aD as ca,i3 as ua,i2 as ma,i4 as pa,f as J,hA as fa,dc as Oe,iC as Te,a$ as it,k as va,F as rt,d4 as _a,M as ga,c as v,a as i,a8 as Me,ao as W,at as Fe,cm as Be,P as X,T as L,U as z,d as I,t as m,R as w,S as R,dg as Z,f$ as Ue,W as dt,dH as ct,X as te,a4 as ae,aL as ya,Y as wa,Z as ha,$ as ba,fF as xa,da as ka,_ as Ca}from"./DZZ6t_j4.js";import{u as Sa,_ as Ia}from"./d-K880gs.js";import{F as Ra}from"./BYINaHrJ.js";import{_ as Ma}from"./sz1d3zjm.js";import{_ as $a}from"./TJfB7GlU.js";import{_ as Va}from"./BLgccLvp.js";import{_ as La}from"./vK-WmZ7a.js";import{_ as za}from"./BqKQ8afS.js";import{u as Da}from"./RXURfzjs.js";import{a as ja}from"./i4aLU0Nw.js";import{a as Aa}from"./C4o9gerC.js";import{D as Ea,C as ut}from"./C4K5fdHe.js";import{k as mt,e as $e}from"./BDAIZopQ.js";import{i as Oa}from"./C00NHga8.js";import{_ as Ta}from"./C9pR2Nv2.js";import{D as pt}from"./Dg0-TbNo.js";import{S as Fa}from"./BmtvKY7O.js";import{T as Ba}from"./DKoVb009.js";import{b as Ua,L as Na,c as Ha,_ as Pa}from"./DuJHisTB.js";import{_ as Ga}from"./CVMW45vd.js";import"./C3jLTHF4.js";import"./3mkq4YHx.js";import"./9ZvwAtsX.js";import"./DKN1hQ6S.js";import"./BQuyMdA-.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";import"./dfem9Uc_.js";import"./BCJFTkwv.js";import"./D9tFZoTQ.js";import"./0azk-b-q.js";import"./DgixBgIx.js";import"./CXD-Dj4T.js";import"./GMLocJHP.js";import"./B05h-4V9.js";import"./boyBAVNN.js";import"./t0mbNaqp.js";import"./DXQuLwNn.js";import"./oyD85nwD.js";const qa=ft({__name:"EditOrAddStack",props:{column:{},optionId:{},isNewStack:{type:Boolean}},emits:["submit","cancel"],setup(_,{emit:M}){const oe=_,le=M,{column:ce,optionId:O,isNewStack:h}=Jt(oe),f=N(vt,p()),{formState:$,addOrUpdate:Y}=Sa(f,ce,void 0,void 0,void 0,p(!0)),{getMeta:we}=Wt(),Q=async()=>{var T;await we((T=f.value)==null?void 0:T.id,!0)};async function ne(T=!1,j=!0,H){if(!j&&T){le("submit");return}const ue=await Y(Q);T&&ue&&le("submit",!0,H)}return(T,j)=>{const H=Ia,ue=Ra;return o(),n(ue,{modelValue:e($),"onUpdate:modelValue":j[1]||(j[1]=P=>ee($)?$.value=P:null),"no-style":"",name:"column-create-or-edit",layout:"vertical","data-testid":"add-or-edit-column",class:"w-full flex"},{default:s(()=>[u(H,{value:e($),"onUpdate:value":j[0]||(j[0]=P=>ee($)?$.value=P:null),"is-kanban-stack":"","option-id":e(O),"is-new-stack":e(h),onSaveChanges:ne},null,8,["value","option-id","is-new-stack"])]),_:1},8,["modelValue"])}}}),Ka=te(()=>ae(()=>import("./BVHyv0aP.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(_=>_.default||_)),Ja=te(()=>ae(()=>import("./BIhr-Z4C.js"),__vite__mapDeps([3,1,2,4,5,6]),import.meta.url).then(_=>_.default||_)),Wa=te(()=>ae(()=>import("./DG2ZH8TR.js"),__vite__mapDeps([7,1,2,8,9,10,4,11,12,5,13]),import.meta.url).then(_=>_.default||_)),Xa=te(()=>ae(()=>import("./Co32XBKZ.js"),__vite__mapDeps([14,1,2,4,12,15]),import.meta.url).then(_=>_.default||_)),Ya=te(()=>ae(()=>import("./Dby8gS7l.js"),__vite__mapDeps([16,1,2,17,5,18]),import.meta.url).then(_=>_.default||_)),Qa=te(()=>ae(()=>import("./Tryc0omP.js"),__vite__mapDeps([19,8,9,1,2,10,4,11,12]),import.meta.url).then(_=>_.default||_)),Za=te(()=>ae(()=>import("./CRPCEw5j.js"),__vite__mapDeps([20,1,2,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,9,12,51,8,10,4,11,52,53,54,55,56,57,58,59,60,61,62,63,64,65]),import.meta.url).then(_=>_.default||_)),eo={class:"flex flex-col w-full bg-gray-50 h-full","data-testid":"nc-kanban-wrapper",style:{minHeight:"calc(100% - var(--topbar-height))"}},to={key:0,class:"flex flex-row min-h-full gap-x-2"},ao={class:"flex gap-3"},oo=["data-testid"],lo={key:0,class:"mt-2.5 px-3 !w-full"},no={"data-testid":"nc-kanban-stack-title",class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},so={class:"flex gap-2 items-center"},io={class:"flex gap-2 items-center"},ro={class:"flex gap-2 items-center"},co={class:"flex gap-2 items-center"},uo={class:"flex gap-2 items-center"},mo={class:"flex gap-2 items-center"},po=["data-stack-title"],fo={class:"nc-kanban-item py-1 first:pt-2 last:pb-2"},vo={class:"z-10 arrow"},_o={class:"z-10 arrow"},go={key:1,class:"h-52 w-full !flex flex-row !border-b-1 !border-gray-200 items-center justify-center"},yo={class:"flex flex-col gap-3 !children:pointer-events-none"},wo={key:0,class:"nc-card-display-value-wrapper"},ho=["onClick"],bo={class:"flex flex-col rounded-lg w-full"},xo={class:"flex flex-row w-full justify-start"},ko={class:"nc-card-col-header w-full !children:text-gray-500"},Co={key:0,class:"flex flex-row w-full text-gray-800 items-center justify-start min-h-7 py-1"},So={key:1,class:"flex flex-row w-full h-7 pl-1 items-center justify-start"},Io={class:"h-full w-full flex flex-col gap-4 items-center justify-center"},Ro={class:"flex flex-col items-center gap-2 text-gray-600 text-center"},Mo={class:"text-sm font-semibold"},$o={class:"text-xs font-weight-500"},Vo={class:"flex items-center gap-2"},Lo={class:"flex items-center justify-between"},zo={class:"flex items-center gap-2"},Do={key:1},jo={class:"nc-kanban-data-count text-gray-500 font-weight-500 px-1"},Ao=["onClick"],Eo={key:0,class:"!w-full !h-full flex items-center justify-center"},Oo={key:1,class:"nc-kanban-stack-head w-full flex items-center justify-between gap-2"},To={class:"flex items-center gap-1"},Fo={class:"flex-1 flex max-w-[115px]"},Bo={"data-testid":"nc-kanban-stack-title",class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Uo={class:"flex items-center gap-2 truncate"},No={class:"nc-kanban-data-count px-1 rounded bg-gray-200 text-gray-800 text-sm font-weight-500 truncate",style:{"word-break":"keep-all","white-space":"nowrap"}},Ho={key:0,class:"nc-kanban-add-new-stack"},Po={key:0,class:"mt-2.5 px-3 !w-full"},Go={class:"flex items-center gap-2"},qo={class:"flex items-center gap-2 nc-kanban-context-menu-item"},Ko={class:"flex items-center gap-2 nc-kanban-context-menu-item"},Jo={key:0,class:"flex flex-row items-center py-2 px-2.25 bg-gray-100 rounded-lg text-gray-700 mb-4"},Wo={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Xo=100,Yo=ft({__name:"Kanban",setup(_){const M=N(vt,p()),oe=N(Xt,p()),le=N(Yt),ce=N(Qt),O=N(ea,Zt()),h=N(ta,p(!1)),f=N(aa,p(!1)),$=p(!1),Y=p(),we=p();ye(oa,p(1));const Q=p(!1),ne=p(""),T=p(0),j=la(),H=j.currentRoute,{getPossibleAttachmentSrc:ue}=Da(),{metaColumnById:P}=ja(),{loadKanbanData:Ne,loadMoreKanbanData:_t,loadKanbanMeta:he,kanbanMetaData:me,formattedData:A,updateOrSaveRow:gt,updateKanbanMeta:yt,addEmptyRow:wt,groupingFieldColOptions:x,updateKanbanStackMeta:Ve,groupingField:He,groupingFieldColumn:Le,countByStack:C,deleteStack:ht,shouldScrollToRight:Pe,deleteRow:bt,moveHistory:Ge,addNewStackId:ze,removeRowFromUncategorizedStack:xt}=Aa(),{isViewDataLoading:be}=na(sa()),{isUIAllowed:De}=ia(),{appInfo:kt,isMobileMode:qe}=ra(),{addUndo:Ct,defineViewScope:St}=da();ye(ca,p(!1)),ye(ua,p(!1)),ye(ma,p(!1)),ye(pa,p(!0));const S=J(()=>De("dataEdit")),Ke=N(fa,p([])),It=J(()=>Ke.value.filter(t=>!Ea(t))),F=J(()=>{var t,a;return((a=(t=M.value)==null?void 0:t.columns)==null?void 0:a.find(r=>r.pv&&Ke.value.includes(r)))??null}),pe=J(()=>{var t,a;return(t=M.value)!=null&&t.columnsById?M.value.columnsById[(a=me.value)==null?void 0:a.fk_cover_image_col_id]:{}}),Rt=J(()=>{var a,r;const t=((r=Oe((a=me.value)==null?void 0:a.meta))==null?void 0:r.fk_cover_image_object_fit)||Te.FIT;if(t===Te.FIT)return"!object-contain";if(t===Te.COVER)return"!object-cover"}),xe=p(),fe=p("");le==null||le.on(async()=>{await he(),await Ne()});const je=t=>{var a;if(!((a=pe.value)!=null&&a.title)||!t.row[pe.value.title])return[];try{const r=typeof t.row[pe.value.title]=="string"?JSON.parse(t.row[pe.value.title]):t.row[pe.value.title];return Array.isArray(r)?r.flat().map(y=>typeof y=="string"?JSON.parse(y):y).filter(y=>y&&!Array.isArray(y)&&typeof y=="object"&&Object.keys(y).length):[]}catch{return[]}},Ae=p(!1);ce==null||ce.on(async()=>{await he(),Ae.value=!0,it(()=>{Ae.value=!1})});const ke=(t,a)=>{const r=$e(t.row,M.value.columns);we.value=a,r&&!f.value?(Y.value=void 0,j.push({query:{...H.value.query,rowId:r}})):(Y.value=t,$.value=!0)},Je=p(!1),se=J({get:()=>Je.value,set:t=>{S.value&&(Je.value=t)}}),ie=p(null),Mt=(t,a)=>{t.preventDefault(),a&&(ie.value=a)},Ce=J({get(){return!!H.value.query.rowId},set(t){t||j.push({query:{...H.value.query,rowId:void 0}})}}),$t=async(t,a)=>{const r=t.target;r.closest(".arrow")||r.closest(".slick-dots")||t.target&&ke(a)};function Vt(t){if(t.draggedContext.futureIndex===0)return!1}async function Ee(t,a=!1){if(t.moved){const{oldIndex:r,newIndex:y}=t.moved,{fk_grp_col_id:V,meta:D}=me.value;x.value[r].order=y,x.value[y].order=r;const _e=Oe(D)||{};_e[V]=x.value,await yt({meta:_e}),a||Ct({undo:{fn:async E=>{const re=x.value.splice(E.moved.newIndex,1);x.value.splice(E.moved.oldIndex,0,re[0]),await Ee(E,!0)},args:[{moved:{oldIndex:r,newIndex:y}}]},redo:{fn:async E=>{const re=x.value.splice(E.moved.oldIndex,1);x.value.splice(E.moved.newIndex,0,re[0]),await Ee(E,!0)},args:[{moved:{oldIndex:r,newIndex:y}},!0]},scope:St({view:oe.value})})}}async function Lt(t,a){if(t.added){const r=t.added.element;Ge.value.unshift({op:"added",pk:$e(t.added.element.row,M.value.columns),index:t.added.newIndex,stack:a}),r.row[He.value]=a,C.value.set(a,C.value.get(a)+1),await gt(r)}else t.removed&&(C.value.set(a,C.value.get(a)-1),Ge.value.unshift({op:"removed",pk:$e(t.removed.element.row,M.value.columns),index:t.removed.oldIndex,stack:a}))}const We=ka(async t=>{if(t.target&&t.target.scrollTop+t.target.clientHeight+Xo>=t.target.scrollHeight){const a=t.target.getAttribute("data-stack-title"),r=kt.value.defaultLimit||25,y=A.value.get(a);if(y&&(C.value.get(a)===void 0||y.length<C.value.get(a))){const V=Math.ceil(y.length/r);await _t(a,{offset:V*r>C.value.get(a)||V*r>y.length?(V-1)*r:V*r})}}}),zt=t=>{t&&(t.removeEventListener("scroll",We),t.addEventListener("scroll",We))},Dt=(t,a)=>{Q.value=!0,ne.value=t,T.value=a},jt=async()=>{await ht(ne.value,T.value),Q.value=!1},Xe=async t=>{x.value[t].collapsed=!x.value[t].collapsed,f.value||await Ve()},At=(t,a)=>{ut(t)&&a.stopPropagation()},Et=async()=>{x.value.forEach(t=>{t.id!==ze&&!t.collapsed&&(t.collapsed=!0)}),f.value||await Ve()},Ot=async()=>{x.value.forEach(t=>{t.id!==ze&&t.collapsed&&(t.collapsed=!1)}),f.value||await Ve()},Ye=async()=>{const t=await wt();t.row={[He.value]:fe.value===""?null:fe.value},C.value.set(null,C.value.get(null)+1),ke(t)};O==null||O.on(Ye),va(()=>O.off(Ye)),rt(se,()=>{se.value||(ie.value=null)}),rt(oe,async t=>{if((t==null?void 0:t.type)===_a.KANBAN){be.value=!0;try{await he(),be.value=!1,await Ne(),it(()=>{Pe.value&&xe.value&&(xe.value.scrollTo({left:xe.value.scrollWidth,behavior:"smooth"}),Pe.value=!1)})}catch(a){console.error(a),be.value=!1}}},{immediate:!0});const Tt=t=>{const a=$e(t.row,M.value.columns);return a?`row-${a}`:""},Ft=J(()=>{var t;return Oe((t=me.value)==null?void 0:t.meta).hide_empty_stack||!1}),B={id:ze},g=p(null),b=(t,a)=>(t==null?void 0:t.id)&&(a==null?void 0:a.id)&&t.id===a.id,ve=p(null),Qe=async(t,a,r)=>{ve.value=g.value,g.value=null,a&&(a!=null&&a.title)&&(a!=null&&a.color)&&r!==void 0&&(x.value[r].title=a.title,x.value[r].color=a.color),t&&await he(),ve.value=null};return(t,a)=>{const r=Fa,y=ya,V=wa,D=ha,_e=qa,E=ba,re=Ba,G=Ma,Ze=$a,et=Va,tt=La,at=Ua,Bt=Ka,Ut=Ga,ot=Ja,lt=Wa,Nt=Xa,Ht=Ya,Se=xa,Pt=Qa,Gt=Na,qt=Ha,nt=Pa,st=Za,Kt=za,q=ga("e");return o(),v(W,null,[i("div",eo,[i("div",{ref_key:"kanbanContainerRef",ref:xe,class:"nc-kanban-container flex p-3 overflow-y-hidden w-full nc-scrollbar-x-lg",style:Me({minHeight:e(qe)?"calc(100%  - 2rem)":"calc(100vh - var(--topbar-height) - var(--toolbar-height) - 0.4rem)",maxHeight:e(qe)?"calc(100%  - 2rem)":"calc(100vh - var(--topbar-height) - var(--toolbar-height) - 0.4rem)"})},[e(be)?(o(),v("div",to,[(o(!0),v(W,null,Fe(Array(20),k=>(o(),n(r,{key:k,class:"!min-w-80 !min-h-full !rounded-xl overflow-hidden"}))),128))])):(o(),n(tt,{key:1,visible:e(se),"onUpdate:visible":a[13]||(a[13]=k=>ee(se)?se.value=k:null),trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-kanban-context-menu"},Be({default:s(()=>{var k;return[i("div",ao,[u(e(pt),{modelValue:e(x),"onUpdate:modelValue":a[3]||(a[3]=l=>ee(x)?x.value=l:null),class:"flex gap-3","item-key":"id",group:"kanban-stack",draggable:".nc-kanban-stack",handle:".nc-kanban-stack-drag-handler",filter:".not-draggable",move:Vt,onStart:a[4]||(a[4]=l=>l.target.classList.add("grabbing")),onEnd:a[5]||(a[5]=l=>l.target.classList.remove("grabbing")),onChange:a[6]||(a[6]=l=>Ee(l))},{item:s(({element:l,index:K})=>{var Ie;return[i("div",{class:R(["nc-kanban-stack",{"w-[44px]":l.collapsed,hidden:e(Ft)&&!((Ie=e(A).get(l.title))!=null&&Ie.length)}]),"data-testid":`nc-kanban-stack-${l.title}`},[l.collapsed?(o(),n(Se,{key:`${l.id}-collapsed`,class:R(["nc-kanban-collapsed-stack flex items-center w-68.5 h-[44px] !rounded-xl cursor-pointer h-full !p-2 overflow-hidden !shadow-none !hover:shadow-none !border-gray-200",{"not-draggable":l.title===null||e(h)||e(f)||!e(S)}]),"body-style":{padding:"0px !important",height:"100%",width:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[i("div",{class:"h-full flex items-center justify-between",onClick:de=>Xe(K)},[!e(A).get(l.title)||!e(C)?(o(),v("div",Eo,[u(r,{active:!0,class:"!w-full !h-4 !rounded-lg overflow-hidden"})])):(o(),v("div",Oo,[i("div",To,[e(h)||e(f)||!e(S)?w("",!0):(o(),n(D,{key:0,disabled:!l.title,type:"text",size:"xs",class:"nc-kanban-stack-drag-handler !px-1.5 !cursor-move",onClick:a[2]||(a[2]=dt(()=>{},["stop"]))},{default:s(()=>[u(V,{icon:"ncDrag",class:"font-weight-800 flex-none"})]),_:2},1032,["disabled"])),i("div",Fo,[u(re,{class:"max-w-full !rounded-full !px-2 !py-1 h-7 !m-0 !border-none",color:l.color},{default:s(()=>[i("span",{style:Me({color:e(Z).isReadable(l.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Z).mostReadable(l.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-sm font-semibold"},[u(E,{class:"truncate max-w-full",placement:"left","show-on-truncate-only":""},{title:s(()=>[I(m(l.title??"Uncategorized"),1)]),default:s(()=>[i("span",Bo,m(l.title??"Uncategorized"),1)]),_:2},1024)],4)]),_:2},1032,["color"])])]),i("div",Uo,[i("div",No,m(e(A).get(l.title).length)+" "+m(e(C).get(l.title)!==1?t.$t("objects.records"):t.$t("objects.record")),1),u(D,{type:"text",size:"xs",class:"!px-1.5"},{default:s(()=>[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).arrowDown),{class:"text-grey h-4 w-4 flex-none"}))]),_:1})])]))],8,Ao)]),_:2},1032,["class"])):(o(),n(Se,{key:`${l.id}-${K}`,class:R(["flex flex-col w-68.5 h-full !rounded-xl overflow-y-hidden !shadow-none !hover:shadow-none !border-gray-200",{"not-draggable":l.title===null||e(h)||e(f)||!e(S),"!cursor-default":e(h)||!e(S)}]),"head-style":{paddingBottom:"0px"},"body-style":{padding:"0px !important",height:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[!e(A).get(l.title)||!e(C)?(o(),v("div",lo,[u(r,{active:!0,class:"!w-full !h-9.75 !rounded-lg overflow-hidden"})])):(o(),n(nt,{key:1},{default:s(()=>[u(at,{class:"border-b-1 border-gray-100 min-h-[49px]"},{default:s(()=>{var de,d;return[i("div",{class:R(["nc-kanban-stack-head w-full flex gap-1",{"items-start":b(l,e(g)),"items-center":!b(l,e(g))}])},[i("div",{class:R(["flex-1 flex gap-1 max-w-[calc(100%_-_32px)]",{"items-start":b(l,e(g)),"items-center":!b(l,e(g))}])},[e(h)||e(f)||!e(S)?w("",!0):(o(),n(D,{key:0,disabled:!l.title||b(l,e(ve))||b(l,e(g)),type:"text",size:"xs",class:"nc-kanban-stack-drag-handler !px-1.5 !cursor-move !:disabled:cursor-not-allowed mt-0.5"},{default:s(()=>[b(l,e(ve))?(o(),n(y,{key:0,size:"regular",class:"stack-rename-loader"})):(o(),n(V,{key:1,icon:"ncDrag",class:"!font-weight-800 flex-none"}))]),_:2},1032,["disabled"])),i("div",{class:R(["flex-1 flex max-w-[calc(100%_-_28px)]",{"-ml-1":b(l,e(g))}])},[b(l,e(g))&&e(P)[(de=e(g))==null?void 0:de.fk_column_id]?(o(),n(_e,{key:0,column:e(P)[(d=e(g))==null?void 0:d.fk_column_id],"option-id":e(g).id,onSubmit:(ge,Re)=>Qe(ge,Re,K)},null,8,["column","option-id","onSubmit"])):(o(),n(re,{key:1,class:"max-w-full !rounded-full !px-2 !py-1 h-7 !m-0 !border-none !mt-0.5",color:l.color,onDblclick:()=>{l.title!==null&&e(S)&&!e(f)&&!e(h)&&(g.value=l)}},{default:s(()=>[i("span",{style:Me({color:e(Z).isReadable(l.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Z).mostReadable(l.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-sm font-semibold"},[u(E,{class:"truncate max-w-full",placement:"bottom","show-on-truncate-only":""},{title:s(()=>[I(m(l.title??"Uncategorized"),1)]),default:s(()=>[i("span",no,m(l.title??"Uncategorized"),1)]),_:2},1024)],4)]),_:2},1032,["color","onDblclick"]))],2)],2),e(h)?w("",!0):(o(),n(tt,{key:0,placement:"bottomRight","overlay-class-name":"nc-dropdown-kanban-stack-context-menu",class:"bg-white !rounded-lg"},{overlay:s(()=>[u(et,{class:"!text-sm"},{default:s(()=>[e(S)&&!e(f)&&!e(h)?X((o(),n(G,{key:0,"data-testid":"nc-kanban-context-menu-add-new-record",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",so,[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).plus),{class:"flex-none w-4 h-4"})),I(" "+m(t.$t("activity.newRecord")),1)])]),_:2},1032,["onClick"])),[[q,["c:kanban:add-new-record"]]]):w("",!0),l.title!==null&&e(S)&&!e(f)&&!e(h)?X((o(),n(G,{key:1,"data-testid":"nc-kanban-context-menu-rename-stack",onClick:()=>{g.value=l}},{default:s(()=>[i("div",io,[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).ncEdit),{class:"flex-none w-4 h-4"})),I(" "+m(t.$t("activity.kanban.renameStack")),1)])]),_:2},1032,["onClick"])),[[q,["c:kanban:rename-stack"]]]):w("",!0),X((o(),n(G,{"data-testid":"nc-kanban-context-menu-collapse-stack",onClick:ge=>Xe(K)},{default:s(()=>[i("div",ro,[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).minimize),{class:"flex-none w-4 h-4"})),I(" "+m(t.$t("activity.kanban.collapseStack")),1)])]),_:2},1032,["onClick"])),[[q,["c:kanban:collapse-stack"]]]),X((o(),n(G,{"data-testid":"nc-kanban-context-menu-collapse-all-stack",onClick:Et},{default:s(()=>[i("div",co,[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).minimizeAll),{class:"flex-none w-4 h-4"})),I(" "+m(t.$t("activity.kanban.collapseAll")),1)])]),_:1})),[[q,["c:kanban:collapse-all-stack"]]]),X((o(),n(G,{"data-testid":"nc-kanban-context-menu-expand-all-stack",onClick:Ot},{default:s(()=>[i("div",uo,[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).maximizeAll),{class:"flex-none w-4 h-4"})),I(" "+m(t.$t("activity.kanban.expandAll")),1)])]),_:1})),[[q,["c:kanban:expand-all-stack"]]]),l.title!==null&&!e(f)&&e(S)?(o(),v(W,{key:2},[u(Ze),X((o(),n(G,{class:"!text-red-600 !hover:bg-red-50","data-testid":"nc-kanban-context-menu-delete-stack",onClick:ge=>Dt(l.title,K)},{default:s(()=>[i("div",mo,[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).delete),{class:"flex-none w-4 h-4"})),I(" "+m(t.$t("activity.kanban.deleteStack")),1)])]),_:2},1032,["onClick"])),[[q,["c:kanban:delete-stack"]]])],64)):w("",!0)]),_:2},1024)]),default:s(()=>[u(D,{disabled:b(l,e(ve)),type:"text",size:"xs",class:"!px-1.5 mt-0.5","data-testid":"nc-kanban-stack-context-menu"},{default:s(()=>[u(V,{icon:"threeDotVertical"})]),_:2},1032,["disabled"])]),_:2},1024))],2)]}),_:2},1024),u(Gt,{class:"overflow-y-hidden",style:Me({backgroundColor:e(Z).mix(l.color||"#ccc","#ffffff",e(Z)(l.color||"#ccc").isLight()?70:e(Z)(l.color||"#ccc").getBrightness()<=100?80:90).toString()})},{default:s(()=>{var de;return[i("div",{ref:zt,class:"nc-kanban-list h-full px-2 nc-scrollbar-thin","data-stack-title":l.title},[u(e(pt),{list:e(A).get(l.title),"item-key":"row.Id",draggable:".nc-kanban-item",group:"kanban-card",class:"flex flex-col h-full",filter:".not-draggable",onStart:a[0]||(a[0]=d=>d.target.classList.add("grabbing")),onEnd:a[1]||(a[1]=d=>d.target.classList.remove("grabbing")),onChange:d=>Lt(d,l.title)},Be({item:s(({element:d,index:ge})=>[i("div",fo,[u(Pt,{row:d},{default:s(()=>{var Re;return[(o(),n(Se,{key:`${Tt(d)}-${ge}`,class:R(["!rounded-lg h-full border-gray-200 border-1 group overflow-hidden break-all max-w-[450px] cursor-pointer",{"not-draggable":e(h)||!e(S)||e(f),"!cursor-default":e(h)||!e(S)||e(f)}]),"body-style":{padding:"16px !important"},"data-stack":l.title,"data-testid":`nc-gallery-card-${d.row.id}`,onClick:c=>$t(c,d),onContextmenu:c=>Mt(c,d)},Be({default:s(()=>[i("div",yo,[e(F)?(o(),v("h2",wo,[("isRowEmpty"in t?t.isRowEmpty:e(mt))(d,e(F))?(o(),v(W,{key:1},[I(" - ")],64)):(o(),v(W,{key:0},[e(Ue)(e(F))?(o(),n(ot,{key:0,modelValue:d.row[e(F).title],"onUpdate:modelValue":c=>d.row[e(F).title]=c,class:"!text-brand-500",column:e(F),row:d},null,8,["modelValue","onUpdate:modelValue","column","row"])):(o(),n(lt,{key:1,modelValue:d.row[e(F).title],"onUpdate:modelValue":c=>d.row[e(F).title]=c,class:"!text-brand-500",column:e(F),"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))],64))])):w("",!0),(o(!0),v(W,null,Fe(e(It),c=>(o(),v("div",{key:`record-${d.row.id}-${c.id}`,class:R({"!children:pointer-events-auto":("isButton"in t?t.isButton:e(ut))(c)}),onClick:U=>At(c,U)},[i("div",bo,[i("div",xo,[i("div",ko,[e(Ue)(c)?(o(),n(Nt,{key:0,column:c,"hide-menu":!0},null,8,["column"])):(o(),n(Ht,{key:1,column:c,"hide-menu":!0},null,8,["column"]))])]),("isRowEmpty"in t?t.isRowEmpty:e(mt))(d,c)?(o(),v("div",So,"-")):(o(),v("div",Co,[e(Ue)(c)?(o(),n(ot,{key:0,modelValue:d.row[c.title],"onUpdate:modelValue":U=>d.row[c.title]=U,column:c,row:d,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column","row"])):(o(),n(lt,{key:1,modelValue:d.row[c.title],"onUpdate:modelValue":U=>d.row[c.title]=U,column:c,"edit-enabled":!1,"read-only":!0,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column"]))]))])],10,ho))),128))])]),_:2},[(Re=e(me))!=null&&Re.fk_cover_image_col_id?{name:"cover",fn:s(()=>[!e(Ae)&&je(d).length?(o(),n(Ut,{key:je(d).reduce((c,U)=>c+(U==null?void 0:U.path),""),class:"gallery-carousel !border-b-1 !border-gray-200",arrows:""},{customPaging:s(()=>a[17]||(a[17]=[i("a",null,[i("div",null,[i("div")])],-1)])),prevArrow:s(()=>[i("div",vo,[u(D,{type:"secondary",size:"xsmall",class:"!absolute !left-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:s(()=>[u(V,{icon:"arrowLeft",class:"text-gray-700 w-4 h-4"})]),_:1})])]),nextArrow:s(()=>[i("div",_o,[u(D,{type:"secondary",size:"xsmall",class:"!absolute !right-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:s(()=>[u(V,{icon:"arrowRight",class:"text-gray-700 w-4 h-4"})]),_:1})])]),default:s(()=>[(o(!0),v(W,null,Fe(je(d),c=>(o(),v(W,null,[("isImage"in t?t.isImage:e(Oa))(c.title,c.mimetype??c.type)?(o(),n(Bt,{key:c.path,class:R(["h-52",[`${e(Rt)}`]]),srcs:e(ue)(c,"card_cover")},null,8,["class","srcs"])):w("",!0)],64))),256))]),_:2},1024)):(o(),v("div",go,a[18]||(a[18]=[i("img",{class:"object-contain w-[48px] h-[48px]",src:Ta},null,-1)])))]),key:"0"}:void 0]),1032,["data-stack","data-testid","class","onClick","onContextmenu"]))]}),_:2},1032,["row"])])]),_:2},[(de=e(A).get(l.title))!=null&&de.length?void 0:{name:"footer",fn:s(()=>[i("div",Io,[i("div",Ro,[i("span",Mo,m(t.$t("general.empty"))+" "+m(t.$t("general.stack").toLowerCase()),1),i("span",$o,m(t.$t("title.looksLikeThisStackIsEmpty")),1)]),e(De)("dataInsert")?(o(),n(D,{key:0,size:"xs",type:"secondary",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",Vo,[!e(f)&&!e(h)?(o(),n(L(("iconMap"in t?t.iconMap:e(z)).plus),{key:0})):w("",!0),I(" "+m(t.$t("activity.newRecord")),1)])]),_:2},1032,["onClick"])):w("",!0)])]),key:"0"}]),1032,["list","onChange"])],8,po)]}),_:2},1032,["style"]),e(A).get(l.title)?(o(),n(qt,{key:0,class:"border-t-1 border-gray-100"},{default:s(()=>[i("div",Lo,[e(De)("dataInsert")?(o(),n(D,{key:0,size:"xs",type:"secondary",onClick:()=>{fe.value=l.title,e(O).trigger(l.title)}},{default:s(()=>[i("div",zo,[!e(f)&&!e(h)?(o(),n(L(("iconMap"in t?t.iconMap:e(z)).plus),{key:0,class:""})):w("",!0),I(" "+m(t.$t("activity.newRecord")),1)])]),_:2},1032,["onClick"])):(o(),v("div",Do," ")),i("div",jo,m(e(A).get(l.title).length)+"/"+m(e(C).get(l.title)??0)+" "+m(e(C).get(l.title)!==1?t.$t("objects.records"):t.$t("objects.record")),1)])]),_:2},1024)):w("",!0)]),_:2},1024))]),_:2},1032,["class"]))],10,oo)]}),_:1},8,["modelValue"]),e(S)&&!e(f)&&!e(h)&&((k=e(Le))!=null&&k.id)?(o(),v("div",Ho,[u(Se,{class:R(["flex flex-col w-68.5 !rounded-xl overflow-y-hidden !shadow-none !hover:shadow-none border-gray-200",{"!cursor-default":e(h)||!e(S),"!border-none":!b(B,e(g))}]),"head-style":{paddingBottom:"0px"},"body-style":{padding:"0px !important",height:"100%",borderRadius:"0.75rem !important",paddingBottom:"0rem !important"}},{default:s(()=>[!e(A).get(null)||!e(C)?(o(),v("div",Po,[u(r,{active:!0,class:"!w-full !h-9.75 !rounded-lg overflow-hidden"})])):(o(),n(nt,{key:1},{default:s(()=>[u(at,{class:R({"!p-0 overflow-hidden":!b(B,e(g))})},{default:s(()=>{var l,K;return[i("div",{class:R(["w-full flex",{"items-start":b(B,e(g)),"cursor-pointer":!b(B,e(g))}]),onClick:a[9]||(a[9]=()=>{b(B,e(g))||(g.value=B)})},[b(B,e(g))?(o(),v("div",{key:1,class:R(["flex-1 flex",{"-ml-1":b(B,e(g))}]),onClick:a[8]||(a[8]=dt(()=>{},["stop"]))},[b(B,e(g))&&e(P)[(l=e(Le))==null?void 0:l.id]?(o(),n(_e,{key:0,column:e(P)[(K=e(Le))==null?void 0:K.id],"is-new-stack":"",onSubmit:a[7]||(a[7]=Ie=>Qe(Ie,void 0))},null,8,["column"])):w("",!0)],2)):(o(),n(D,{key:0,type:"secondary",class:"add-new-stack-btn w-full !rounded-xl min-h-11"},{default:s(()=>[i("div",Go,[!e(f)&&!e(h)?(o(),n(L(("iconMap"in t?t.iconMap:e(z)).plus),{key:0,class:""})):w("",!0),I(" "+m(t.$t("general.new"))+" "+m(t.$t("general.stack").toLowerCase()),1)])]),_:1}))],2)]}),_:1},8,["class"])]),_:1}))]),_:1},8,["class"])])):w("",!0)])]}),_:2},[!e(h)&&!e(f)&&e(S)?{name:"overlay",fn:s(()=>[u(et,{onClick:a[12]||(a[12]=k=>se.value=!1)},{default:s(()=>[e(ie)?(o(),n(G,{key:0,onClick:a[10]||(a[10]=k=>ke(e(ie)))},{default:s(()=>[X((o(),v("div",qo,[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).expand),{class:"flex"})),I(" "+m(t.$t("activity.expandRecord")),1)])),[[q,["a:kanban:expand-record"]]])]),_:1})):w("",!0),u(Ze),e(ie)?(o(),n(G,{key:1,class:"!text-red-600 !hover:bg-red-50",onClick:a[11]||(a[11]=k=>e(bt)(e(ie)))},{default:s(()=>[X((o(),v("div",Ko,[(o(),n(L(("iconMap"in t?t.iconMap:e(z)).delete),{class:"flex"})),I(" "+m(t.$t("general.deleteEntity",{entity:t.$t("objects.record").toLowerCase()})),1)])),[[q,["a:kanban:delete-record"]]])]),_:1})):w("",!0)]),_:1})]),key:"0"}:void 0]),1032,["visible"]))],4)]),(o(),n(ct,null,{default:s(()=>[e(Y)&&e($)?(o(),n(st,{key:0,modelValue:e($),"onUpdate:modelValue":a[14]||(a[14]=k=>ee($)?$.value=k:null),row:e(Y),state:e(we),meta:e(M),"load-row":!e(f),view:e(oe),onCancel:e(xt)},null,8,["modelValue","row","state","meta","load-row","view","onCancel"])):w("",!0)]),_:1})),(o(),n(ct,null,{default:s(()=>{var k;return[e(Ce)&&((k=e(M))!=null&&k.id)?(o(),n(st,{key:0,modelValue:e(Ce),"onUpdate:modelValue":a[15]||(a[15]=l=>ee(Ce)?Ce.value=l:null),"load-row":!e(f),row:e(Y)??{row:{},oldRow:{},rowMeta:{}},meta:e(M),"expand-form":ke,"row-id":e(H).query.rowId,view:e(oe)},null,8,["modelValue","load-row","row","meta","row-id","view"])):w("",!0)]}),_:1})),u(Kt,{visible:e(Q),"onUpdate:visible":a[16]||(a[16]=k=>ee(Q)?Q.value=k:null),"entity-name":"Stack","on-delete":jt},{"entity-preview":s(()=>[e(ne)?(o(),v("div",Jo,[i("div",Wo,m(e(ne)),1)])):w("",!0)]),_:1},8,["visible"])],64)}}}),Bl=Ca(Yo,[["__scopeId","data-v-4df2eb35"]]);export{Bl as default};
