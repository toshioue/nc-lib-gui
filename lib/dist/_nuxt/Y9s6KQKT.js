const __vite__fileDeps=["./DSjSw5ad.js","./BXXS6TCz.js","./B2hUoZAs.js","./entry.B8GgT5QA.css","./Dy8qGaId.js","./C9Sjn86N.js","./fS-pjH0A.js","./PlainCell.BhW7NMdh.css","./JWC_RPKq.js","./RecordCard.BkJXt930.css","./BlhRk6zn.js","./nk4tSM_m.js","./B_8aIjz8.js","./B-HHpLTx.js","./boyBAVNN.js","./MeGaiume.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as et,r as S,L as tt,bL as Ie,d0 as ot,g as ne,gJ as at,h6 as nt,ce as n,d2 as lt,O as rt,P as t,o as h,c as b,a as V,al as $,am as J,t as Q,T as F,cU as I,U,w as z,b as ee,d as st,V as ze,W as Oe,S as N,R as it,a8 as ut,Y as dt,cd as ct,Z as we,a5 as pe,a2 as mt,A as ft,_ as vt}from"./B2hUoZAs.js";import{_ as wt}from"./DerldqwU.js";import{_ as pt}from"./DfZ7_DBQ.js";import{_ as _t}from"./e4fIiYA_.js";import{a as ht}from"./BSjxiJhm.js";import{a as yt}from"./D1iILnOh.js";import{b as Le}from"./DodZPEOQ.js";import{j as gt,e as le}from"./MeGaiume.js";import"./B_8aIjz8.js";import"./Bye44sky.js";const Dt=we(()=>pe(()=>import("./DSjSw5ad.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(C=>C.default||C)),Mt=we(()=>pe(()=>import("./Dy8qGaId.js"),__vite__mapDeps([4,2,3,5,1,6,7]),import.meta.url).then(C=>C.default||C)),kt=we(()=>pe(()=>import("./JWC_RPKq.js"),__vite__mapDeps([8,2,3,9]),import.meta.url).then(C=>C.default||C)),Yt=we(()=>pe(()=>import("./BlhRk6zn.js"),__vite__mapDeps([10,11,12,2,3,13,6,14,15]),import.meta.url).then(C=>C.default||C)),xt={key:0,class:"h-full prevent-select relative","data-testid":"nc-calendar-month-view"},bt=["onClick","onDblclick"],Rt={key:0,class:"flex justify-between p-1"},St={class:"flex items-center gap-1"},Et={class:"ml-1"},Ct={key:1,class:"leading-3 p-3"},Tt={class:"text-xs px-1"},It={class:"absolute inset-0 pointer-events-none mt-8 pb-7.5","data-testid":"nc-calendar-month-record-container"},zt=["data-testid","data-unique-id","onMouseover","onMousedown"],Ot={class:"text-xs font-medium text-gray-400"},Lt=et({__name:"MonthView",emits:["newRecord","expandRecord"],setup(C,{emit:He}){const re=He,{selectedDate:se,selectedMonth:_e,formattedData:Z,formattedSideBarData:xe,calDataType:j,sideBarFilterOption:Pe,displayField:Be,calendarRange:B,viewMetaProperties:Ve,showSideMenu:$e,updateRowProperty:he}=ht(),{$e:be}=ft(),ye=S(!0),{isUIAllowed:O}=tt(),te=Ie(ot,S()),L=ne(()=>{var e;return(e=Ve.value)!=null&&e.hide_weekend?5:7}),Ae=ne(()=>{let e=[];return ye.value?e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],L.value===5&&(e=e.filter(r=>r!=="Sat"&&r!=="Sun")),e}),ie=S(),{width:Fe,height:Ne}=at(ie),Ze=e=>e.month()===_e.value.month(),A=S(null),W=S(null),ue=S(!1),X=S(!1),D=S(),ge=S(),De=S(),de=S(null),ce=S(),R=S(),We=Ie(nt,S()),{fields:Re}=yt(),qe=ne(()=>Re.value?new Map(Re.value.map(e=>[e.fk_column_id,{underline:e.underline,bold:e.bold,italic:e.italic}])):new Map),Me=e=>qe.value.get(e.id),c=ne(()=>{const e=_e.value.startOf("month"),r=_e.value.endOf("month"),s=e.startOf("week").add(ye.value?0:-1,"day"),i=r.endOf("week").add(ye.value?0:-1,"day").diff(s,"day")+1;let g=Math.ceil(i/7);g=Math.max(g,5);const M=[];let _=s;for(let k=0;k<g;k++){const Y=[];for(let u=0;u<7;u++)Y.push(_),_=_.add(1,"day");M.push(Y)}return M}),me=ne(()=>{if(!c.value||!B.value)return[];const e=Fe.value/L.value,r=Ne.value/c.value.length,s=24,y=27,i={};if(!B.value)return[];const g=[];return B.value.forEach(M=>{const _=M.fk_from_col,k=M.fk_to_col;[...Z.value].filter(u=>{if(_&&k){const a=u.row[_.title]?n(u.row[_.title]):null,d=u.row[k.title]?n(u.row[k.title]):null;return a&&d&&!d.isBefore(a)}else if(_&&!k)return!!(u.row[_.title]?n(u.row[_.title]):null);return!1}).forEach(u=>{if(!k&&_){const a=n(u.row[_.title]),d=a.format("YYYY-MM-DD");i[d]||(i[d]={overflow:!1,count:0,overflowCount:0}),i[d].count++;const o=u.rowMeta.id??Le(),f=c.value.findIndex(E=>E.some(H=>n(H).isSame(a,"day"))),v=(c.value[f]??[]).findIndex(E=>n(E).isSame(a,"day")),l={left:`${v*e}px`,width:`${e}px`};L.value===5&&(v===5||v===6)&&(l.display="none");const x=i[d].count,m=f*r+y+(x-1)*(s+4);s*x+y+12>r?(l.display="none",i[d].overflow=!0,i[d].overflowCount++):l.top=`${m}px`,g.push({...u,rowMeta:{...u.rowMeta,style:l,position:"rounded",range:M,id:o}})}else if(_&&k){const a=n(u.row[_.title]),d=n(u.row[k.title]);let o=a.startOf("week");const f=u.rowMeta.id??Le();for(;o.isSameOrBefore(d,"day")&&o.isBefore(c.value[c.value.length-1][6]);){const v=o.endOf("week"),l=o.isBefore(a)?a:o,x=v.isAfter(d)?d:v;if(x.isBefore(c.value[0][0])){o=o.add(1,"week");continue}let m=l.clone();for(;m.isSameOrBefore(x);){const p=m.format("YYYY-MM-DD");i[p]||(i[p]={overflow:!1,count:0,overflowCount:0}),i[p].count++,m=m.add(1,"day")}const w=Math.max(c.value.findIndex(p=>p.findIndex(G=>n(G).isSame(l,"day"))!==-1),0);let E=0;for(let p=0;p<(c.value[w]??[]).length;p++){const G=c.value[w][p],ae=n(G).format("YYYY-MM-DD");i[ae]||(i[ae]={count:0,overflow:!1,overflowCount:0}),E=Math.max(E,i[ae].count)}const H=Math.max((c.value[w]??[]).findIndex(p=>n(p).isSame(l,"day")),0),oe=Math.max((c.value[w]??[]).findIndex(p=>n(p).isSame(x,"day")),0),K={left:`${H*e}px`,width:`${(oe-H+1)*e}px`},fe=w*r+y+Math.max(E-1,0)*(s+4),ve=s*Math.max(E,0)+y+12;let P="rounded";const T=c.value[w-1]?n(c.value[w-1][0]).isBefore(a,"month"):!1;if(a.isSame(o,"week")&&d.isSame(v,"week")?P="rounded":a.isSame(l,"week")?T&&d.isSame(v,"week")?P="rounded":P="leftRounded":d.isSame(v,"week")?P="rightRounded":P="none",ve>r){K.display="none";for(let p=H;p<=oe;p++){const G=c.value[w];if(!G)continue;const ae=G[p],Ye=n(ae).format("YYYY-MM-DD");i[Ye]&&(i[Ye].overflow=!0,i[Ye].overflowCount++)}}else K.top=`${fe}px`;g.push({...u,rowMeta:{...u.rowMeta,position:P,style:K,range:M,id:f}}),o=o.add(1,"week")}}})}),{records:g,count:i}}),ke=(e,r,s)=>{var w,E,H,oe,K,fe,ve,P;const{top:y,height:i,width:g,left:M}=ie.value.getBoundingClientRect(),_=(e.clientY-y-window.scrollY)/i,k=(e.clientX-M-window.scrollX)/g,Y=(E=(w=D.value)==null?void 0:w.rowMeta.range)==null?void 0:E.fk_from_col,u=(oe=(H=D.value)==null?void 0:H.rowMeta.range)==null?void 0:oe.fk_to_col;if(!Y)return{newRow:null,updateProperty:[]};const a=Math.floor(_*c.value.length),d=Math.floor(k*L.value);let o=c.value[a]?n(c.value[a][d]):null;if(!o)return{newRow:null,updateProperty:[]};let f=n(D.value.row[Y.title]);f.isValid()||(f=n()),o=o.add(f.hour(),"hour").add(f.minute(),"minute").add(f.second(),"second");let v;const l={...D.value,row:{...(K=D.value)==null?void 0:K.row,[Y.title]:j.value===I.Date?n(o).format("YYYY-MM-DD HH:mm:ssZ"):n(o).utc().format("YYYY-MM-DD HH:mm:ssZ")}},x=[Y.title];if(u){const T=(fe=D.value)!=null&&fe.row[Y.title]?n(D.value.row[Y.title]):null,p=(ve=D.value)!=null&&ve.row[u.title]?n((P=D.value)==null?void 0:P.row[u.title]):null;T&&p?v=n(o).add(p.diff(T,"day"),"day"):T&&!p?v=n(o).endOf("day"):!T&&p?v=n(o).endOf("day"):v=o.clone(),l.row[u.title]=j.value===I.Date?n(v).format("YYYY-MM-DD HH:mm:ssZ"):n(v).utc().format("YYYY-MM-DD HH:mm:ssZ"),x.push(u.title)}if(D.value.row[Y.title]===l.row[Y.title]&&!s)return{newRow:null,updatedProperty:[]};if(!l)return{newRow:null,updateProperty:[]};const m=le(l.row,te.value.columns);return r?(Z.value=[...Z.value,l],xe.value=xe.value.filter(T=>le(T.row,te.value.columns)!==m)):Z.value=Z.value.map(T=>le(T.row,te.value.columns)===m?l:T),{newRow:l,updateProperty:x}},Se=e=>{!O("dataEdit")||!D.value||ke(e,!1)},Ue=lt((e,r,s)=>{he(e,r,s)},500),Ee=e=>{var l,x;if(!O("dataEdit")||!R.value)return;const{top:r,height:s,width:y,left:i}=ie.value.getBoundingClientRect(),g=(e.clientY-r-window.scrollY)/s,M=(e.clientX-i-window.scrollX)/y,_=R.value.row[R.value.rowMeta.range.fk_to_col.title],k=R.value.row[R.value.rowMeta.range.fk_from_col.title],Y=(l=R.value.rowMeta.range)==null?void 0:l.fk_from_col,u=(x=R.value.rowMeta.range)==null?void 0:x.fk_to_col,a=Math.floor(g*c.value.length),d=Math.floor(M*L.value);let o=[],f;if(ce.value==="right"){let m=c.value[a]?n(c.value[a][d]).endOf("day"):null;if(o=[u.title],n(m).isBefore(k)&&(m=n(k).clone().endOf("day")),!m)return;f={...R.value,row:{...R.value.row,[u.title]:n(m).format("YYYY-MM-DD HH:mm:ssZ")}}}else{let m=c.value[a]?n(c.value[a][d]):null;if(o=[Y.title],n(m).isAfter(_)&&(m=n(_).clone()),!m)return;f={...R.value,row:{...R.value.row,[Y.title]:n(m).format("YYYY-MM-DD HH:mm:ssZ")}}}const v=le(f.row,te.value.columns);Z.value=Z.value.map(m=>le(m.row,te.value.columns)===v?f:m),f&&Ue(f,o,!1)},Ce=()=>{ue.value=!1,ce.value=void 0,R.value=void 0,document.removeEventListener("mousemove",Ee),document.removeEventListener("mouseup",Ce)},je=(e,r,s)=>{var y;!O("dataEdit")||W.value||(y=s.rowMeta.range)!=null&&y.is_readonly||(ue.value=!0,ce.value=e,R.value=s,document.addEventListener("mousemove",Ee),document.addEventListener("mouseup",Ce))},Te=e=>{var i;if(clearTimeout(De.value),!O("dataEdit")||!D.value||!X.value||(i=D.value.rowMeta.range)!=null&&i.is_readonly)return;e.preventDefault(),A.value.style.boxShadow="none";const{newRow:r,updateProperty:s}=ke(e,!1,!0);document.querySelectorAll(".draggable-record").forEach(g=>{g.style.visibility="",g.style.opacity="100%"}),A.value&&(A.value.style.boxShadow="none",X.value=!1,W.value=null,A.value=null),D.value=void 0,he(r,s,!1),de.value=null,be("c:calendar:month:drag-record"),document.removeEventListener("mousemove",Se),document.removeEventListener("mouseup",Te)},Xe=(e,r)=>{if(ue.value||!r.rowMeta.id)return;let s=e.target;X.value=!1,De.value=setTimeout(()=>{var g;if(!O("dataEdit")||(g=r.rowMeta.range)!=null&&g.is_readonly)return;for(X.value=!0;!s.classList.contains("draggable-record");)s=s.parentElement;document.querySelectorAll(".draggable-record").forEach(M=>{M.getAttribute("data-unique-id").includes(r.rowMeta.id)||(M.style.opacity="30%")}),X.value=!0,A.value=s,W.value=r.rowMeta.id,D.value=r,document.addEventListener("mousemove",Se),document.addEventListener("mouseup",Te)},200);const y=()=>{clearTimeout(De.value),document.removeEventListener("mouseup",y),X.value||re("expandRecord",r)};document.addEventListener("mouseup",y)},Ke=e=>{var s,y;if(!O("dataEdit"))return;e.preventDefault();const r=(s=e.dataTransfer)==null?void 0:s.getData("text/plain");if(r){const{record:i,isWithoutDates:g}=JSON.parse(r);if((y=i.rowMeta.range)!=null&&y.is_readonly)return;D.value=i;const{newRow:M,updateProperty:_}=ke(e,g);A.value&&(A.value.style.boxShadow="none",A.value=null),he(M,_,!1),be("c:calendar:day:drag-record")}},Ge=e=>{D.value=void 0,W.value=null,R.value=void 0,ue.value=!1,ce.value=void 0,de.value=null,se.value=e},Je=e=>{Pe.value="selectedDate",se.value=e,$e.value=!0},q=e=>se.value?n(e).isSame(se.value,"day"):!1,Qe=e=>{if(!O("dataEdit")||!B.value)return;const r=B.value[0].fk_from_col;if(!r)return;const s={row:{[r.title]:e.format("YYYY-MM-DD HH:mm:ssZ")}};re("newRecord",s)};return(e,r)=>{const s=mt,y=wt,i=Dt,g=pt,M=_t,_=Mt,k=kt,Y=Yt,u=rt("e");return t(B)?(h(),b("div",xt,[V("div",{class:F(["grid",{"grid-cols-7":t(L)===7,"grid-cols-5":t(L)===5}])},[(h(!0),b($,null,J(t(Ae),(a,d)=>(h(),b("div",{key:d,class:"text-center bg-gray-50 py-1 border-r-1 last:border-r-0 border-gray-200 font-semibold leading-4 uppercase text-[10px] text-gray-500"},Q(a),1))),128))],2),V("div",{ref_key:"calendarGridContainer",ref:ie,class:F([{"grid-rows-5":t(c).length===5,"grid-rows-6":t(c).length===6,"grid-rows-7":t(c).length===7},"grid"]),style:{height:"calc(100% - 1.59rem)"},onDrop:Ke},[(h(!0),b($,null,J(t(c),(a,d)=>(h(),b("div",{key:d,class:F([{"grid-cols-7":t(L)===7,"grid-cols-5":t(L)===5},"grid grow"]),"data-testid":"nc-calendar-month-week"},[(h(!0),b($,null,J(a,(o,f)=>{var v;return h(),b($,null,[t(L)!==5||o.get("day")!==0&&o.get("day")!==6?(h(),b("div",{key:`${d}-${f}`,class:F([{"border-brand-500 border-1 !border-r-1 border-b-1":q(o)||t(de)&&t(n)(o).isSame(t(de),"day"),"!text-gray-400":!Ze(o),"!bg-gray-50 !hover:bg-gray-100":o.get("day")===0||o.get("day")===6,"border-t-1":d===0},"text-right relative group last:border-r-0 transition text-sm h-full border-r-1 border-b-1 border-gray-200 font-medium hover:bg-gray-50 text-gray-800 bg-white"]),"data-testid":"nc-calendar-month-day",onClick:l=>Ge(o),onDblclick:l=>Qe(o)},[t(O)("dataEdit")?(h(),b("div",Rt,[V("span",{class:F({"block group-hover:hidden":!q(o)&&[t(I).DateTime,t(I).Date].includes(t(j)),hidden:q(o)&&[t(I).DateTime,t(I).Date].includes(t(j))})},null,2),t(B).length>1?(h(),U(M,{key:0,"auto-close":""},{overlay:z(()=>[ee(g,{class:"w-64"},{default:z(()=>[ee(y,null,{default:z(()=>[st(" Select date field to add ")]),_:1}),(h(!0),b($,null,J(t(B),(l,x)=>(h(),U(y,{key:x,class:"text-gray-800 font-semibold text-sm",onClick:()=>{const m={row:{[l.fk_from_col.title]:t(n)(o).format("YYYY-MM-DD HH:mm:ssZ")}};re("newRecord",m)}},{default:z(()=>[V("div",St,[ee(i,{"column-meta":l.fk_from_col},null,8,["column-meta"]),V("span",Et,Q(l.fk_from_col.title),1)])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),default:z(()=>[ee(s,{class:F([{"!block":q(o),"!hidden":!q(o)},"!group-hover:block rounded"]),size:"small",type:"secondary"},{default:z(()=>[(h(),U(ze(("iconMap"in e?e.iconMap:t(Oe)).plus),{class:"h-4 w-4"}))]),_:2},1032,["class"])]),_:2},1024)):[t(I).DateTime,t(I).Date].includes(t(j))?(h(),U(s,{key:1,class:F([{"!block":q(o),"!hidden":!q(o)},"!group-hover:block !w-6 !h-6 !rounded"]),size:"xsmall",type:"secondary",onClick:()=>{const l={row:{[t(B)[0].fk_from_col.title]:o.format("YYYY-MM-DD HH:mm:ssZ")}};re("newRecord",l)}},{default:z(()=>[(h(),U(ze(("iconMap"in e?e.iconMap:t(Oe)).plus)))]),_:2},1032,["class","onClick"])):N("",!0),V("span",{class:F([{"bg-brand-50 text-brand-500 !font-bold":o.isSame(t(n)(),"date")},"px-1.3 py-1 text-sm leading-3 font-medium rounded-lg"])},Q(o.format("DD")),3)])):N("",!0),t(O)("dataEdit")?N("",!0):(h(),b("div",Ct,Q(t(n)(o).format("DD")),1)),t(me).count[t(n)(o).format("YYYY-MM-DD")]&&((v=t(me).count[t(n)(o).format("YYYY-MM-DD")])!=null&&v.overflow)&&!t(W)?it((h(),U(s,{key:2,class:"!absolute bottom-1 right-1 text-center min-w-4.5 mx-auto z-3 text-gray-500",size:"xxsmall",type:"secondary",onClick:l=>Je(o)},{default:z(()=>{var l;return[V("span",Tt," + "+Q((l=t(me).count[t(n)(o).format("YYYY-MM-DD")])==null?void 0:l.overflowCount),1)]}),_:2},1032,["onClick"])),[[u,"['c:calendar:month-view-more']"]]):N("",!0)],42,bt)):N("",!0)],64)}),256))],2))),128))],34),V("div",It,[(h(!0),b($,null,J(t(me).records,(a,d)=>{var o;return h(),b($,{key:d},[((o=a.rowMeta.style)==null?void 0:o.display)!=="none"?(h(),b("div",{key:0,"data-testid":`nc-calendar-month-record-${a.row[t(Be).title]}`,"data-unique-id":a.rowMeta.id,style:ut({...a.rowMeta.style,zIndex:a.rowMeta.id===t(W)?100:0}),class:"absolute group draggable-record transition cursor-pointer pointer-events-auto",onMouseleave:r[0]||(r[0]=f=>ge.value=null),onMouseover:f=>ge.value=a.rowMeta.id,onMousedown:dt(f=>Xe(f,a),["stop"])},[ee(Y,{row:a},{default:z(()=>{var f,v,l,x,m;return[ee(k,{hover:t(ge)===a.rowMeta.id||a.rowMeta.id===t(W),position:a.rowMeta.position,record:a,resize:!!((f=a.rowMeta.range)!=null&&f.fk_to_col)&&t(O)("dataEdit"),selected:((l=(v=t(D))==null?void 0:v.rowMeta)==null?void 0:l.id)===a.rowMeta.id||((m=(x=t(R))==null?void 0:x.rowMeta)==null?void 0:m.id)===a.rowMeta.id,onResizeStart:je},ct({default:z(()=>[(h(!0),b($,null,J(t(We),(w,E)=>(h(),b($,{key:E},[("isRowEmpty"in e?e.isRowEmpty:t(gt))(a,w)?N("",!0):(h(),U(_,{key:0,modelValue:a.row[w.title],"onUpdate:modelValue":H=>a.row[w.title]=H,class:"text-xs",bold:Me(w).bold,column:w,italic:Me(w).italic,underline:Me(w).underline},null,8,["modelValue","onUpdate:modelValue","bold","column","italic","underline"]))],64))),128))]),_:2},[[t(I).DateTime,t(I).LastModifiedTime,t(I).CreatedTime].includes(t(j))?{name:"time",fn:z(()=>{var w;return[V("span",Ot,Q(t(n)(a.row[(w=a.rowMeta.range)==null?void 0:w.fk_from_col.title]).format("h:mma").slice(0,-1)),1)]}),key:"0"}:void 0]),1032,["hover","position","record","resize","selected"])]}),_:2},1032,["row"])],44,zt)):N("",!0)],64)}),128))])])):N("",!0)}}}),qt=vt(Lt,[["__scopeId","data-v-5a445c37"]]);export{qt as default};
