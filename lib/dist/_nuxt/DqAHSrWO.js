import{e as $t,a5 as It,r as U,az as Ge,g2 as Yt,aB as Qt,aC as Jt,hK as Kt,ax as rt,cL as dt,f as G,c$ as e,aA as Xt,aD as Zt,N as a,o,Q as _,O as Tt,c as b,a7 as Wt,T as ee,S as X,W as Z,_ as Ot,jg as he,jh as Bt,h0 as ea,da as ta,bL as we,gT as Ut,dz as At,J as aa,cW as la,cX as sa,d7 as jt,d6 as Rt,d0 as tt,ji as ia,je as na,F as qe,ah as Ze,ai as We,y as Nt,ab as bt,ba as oa,ag as ua,hJ as ra,i8 as da,aw as ca,jf as pa,g as ma,k as fa,a$ as va,M as ya,a as M,a6 as ot,b as le,w,V as ht,ao as K,jd as wt,U as se,d as pe,t as q,R as V,at as ze,P as $e,f$ as ut,Y as _a,Z as ga,$ as Ta,X as ba,a4 as ha}from"./DZZ6t_j4.js";import{_ as wa}from"./sz1d3zjm.js";import{_ as ka}from"./BLgccLvp.js";import{_ as xa}from"./vK-WmZ7a.js";import{_ as Ma}from"./DnSVh-oD.js";import{_ as Ca}from"./BtLb9F6G.js";import{x as kt,d as xt,e as Mt,n as Ct,m as Ft,j as Fa,h as Da,G as La,o as Va,t as Sa,u as $a,s as Oa,p as Ba,J as Ua,y as Aa,k as ja,w as Ra,K as Na}from"./C4K5fdHe.js";import Pa from"./BC4FfNUJ.js";import Dt from"./BfEabL6Z.js";import Ga from"./_UtSxoDP.js";import za from"./8CPSAnYl.js";import qa from"./wnVheyFD.js";import Ea from"./B_hXH8Ph.js";import Ha from"./CwCOKBa8.js";import Ia from"./ZFfr47_V.js";import Ya from"./Dw0oE3Jr.js";import Lt from"./Cj0Ygd-o.js";import Vt from"./DXGe1EHQ.js";import Qa from"./BL8INA0H.js";import{_ as Ja}from"./bWYzyg0p.js";import St from"./BGrG97ky.js";import{_ as Ka,S as Xa}from"./D_MsYLkT.js";import{a as Pt}from"./B05h-4V9.js";import{a as Za}from"./i4aLU0Nw.js";import{C as Wa}from"./DNgdBwTe.js";const el=$t({__name:"FilterInput",props:{column:{},filter:{}},emits:["updateFilterValue"],setup(d,{emit:me}){var A,Te,be;const D=d,S=me,x=It(D,"column"),ge=U(!0);Ge(Yt,x),Ge(Jt,Qt(ge)),Ge(Kt,U(!1));const k={isSingleSelect:Da,isMultiSelect:La,isDate:xt,isYear:Ft,isDateTime:Mt,isTime:Ct,isRating:Va,isDuration:Sa,isPercent:$a,isCurrency:Oa,isDecimal:Ba,isReadonlyDateTime:Ua,isInt:kt,isFloat:Aa,isTextArea:ja,isLinks:g=>g.uidt===e.Links,isUser:Ra,isReadonlyUser:Na},{sqlUis:L}=rt(dt()),C=U((A=x.value)!=null&&A.source_id&&L.value[(Te=x.value)==null?void 0:Te.source_id]?L.value[(be=x.value)==null?void 0:be.source_id]:Object.values(L.value)[0]),R=G(()=>x.value&&C.value.getAbstractType(x.value)),z=g=>{const j=k[g];return!x.value||!j?!1:j(x.value,R.value)},W=G({get:()=>D.filter.value,set:g=>{S("updateFilterValue",g)}}),$=[{value:!0,label:"true"},{value:!1,label:"false"},{value:null,label:"unset"}],xe=g=>["anyof","nanyof"].includes(g)?Dt:Pa,v=g=>["daysAgo","daysFromNow","pastNumberOfDays","nextNumberOfDays"].includes(g)?Lt:Ga,B=G(()=>({isSingleSelect:xe(D.filter.comparison_op),isMultiSelect:Dt,isDate:v(D.filter.comparison_sub_op),isYear:za,isDateTime:v(D.filter.comparison_sub_op),isReadonlyDateTime:v(D.filter.comparison_sub_op),isTime:qa,isRating:Ea,isDuration:Ha,isPercent:Ia,isCurrency:Ya,isDecimal:Lt,isInt:Vt,isFloat:Qa,isLinks:Vt,isUser:St,isReadonlyUser:St})),E=G(()=>Object.keys(B.value).find(g=>z(g))),H=G(()=>{var g,j;switch(E.value){case"isSingleSelect":case"isMultiSelect":return{disableOptionCreation:!0};case"isPercent":case"isDecimal":case"isFloat":case"isLinks":case"isInt":return{class:"h-32px"};case"isDuration":return{showValidationError:!1};case"isUser":return{forceMulti:!0};case"isReadonlyUser":return["anyof","nanyof"].includes(D.filter.comparison_op)?{forceMulti:!0}:{};case"isCurrency":return{hidePrefix:!0};case"isRating":return{style:{minWidth:`${(((j=(g=x.value)==null?void 0:g.meta)==null?void 0:j.max)||5)*19}px`}};default:return{}}}),ue=G(()=>{var g;return x.value&&(((g=x.value)==null?void 0:g.uidt)===e.Links||kt(x.value,R)||xt(x.value,R)||Mt(x.value,R)||Ct(x.value,R)||Ft(x.value,R))}),ie=U(!1);Ge(Xt,U(!0)),Ge(Zt,U(!0));const I=G(()=>E.value==="isSingleSelect"||E.value==="isMultiSelect");return(g,j)=>{const ke=Ka;return a(x)&&("isBoolean"in g?g.isBoolean:a(Fa))(a(x),a(R))?(o(),_(ke,{key:0,value:a(W),"onUpdate:value":j[0]||(j[0]=Q=>Tt(W)?W.value=Q:null),disabled:g.filter.readOnly,options:$},null,8,["value","disabled"])):(o(),b("div",{key:1,class:X(["bg-white border-1 flex flex-grow min-h-4 h-full px-1 items-center nc-filter-input-wrapper !rounded-lg",{"px-2":a(ue),"border-brand-500":a(ie),"!max-w-100":a(I)}]),onMouseup:j[4]||(j[4]=Z(()=>{},["stop"]))},[(o(),_(ee(a(E)?a(B)[a(E)]:Ja),Wt({modelValue:a(W),"onUpdate:modelValue":j[1]||(j[1]=Q=>Tt(W)?W.value=Q:null),disabled:g.filter.readOnly,placeholder:"Enter a value",column:a(x),class:"flex !rounded-lg"},a(H),{location:"filter",onFocus:j[2]||(j[2]=Q=>ie.value=!0),onBlur:j[3]||(j[3]=Q=>ie.value=!1)}),null,16,["modelValue","disabled","column"]))],34))}}}),tl=Ot(el,[["__scopeId","data-v-1d04f633"]]),al=d=>Bt(d)||d===e.Time?"=":[e.SingleSelect,e.Collaborator,e.LinkToAnotherRecord,e.Date,e.CreatedTime,e.LastModifiedTime,e.DateTime].includes(d)?"is":"is equal",ll=d=>Bt(d)||d===e.Time?"!=":[e.SingleSelect,e.Collaborator,e.LinkToAnotherRecord,e.Date,e.CreatedTime,e.LastModifiedTime,e.DateTime].includes(d)?"is not":"is not equal",sl=d=>d===e.Attachment?"filenames contain":"is like",il=d=>d===e.Attachment?"filenames don't contain":"is not like",nl=d=>[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(d)?"is after":">",ol=d=>[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(d)?"is before":"<",ul=d=>[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(d)?"is on or after":">=",rl=d=>[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(d)?"is on or before":"<=",Ee=(d,me)=>[{text:"is checked",value:"checked",ignoreVal:!0,includedTypes:[e.Checkbox]},{text:"is not checked",value:"notchecked",ignoreVal:!0,includedTypes:[e.Checkbox]},{text:al(d),value:"eq",ignoreVal:!1,excludedTypes:[e.Checkbox,e.MultiSelect,e.Attachment,e.User,e.CreatedBy,e.LastModifiedBy]},{text:ll(d),value:"neq",ignoreVal:!1,excludedTypes:[e.Checkbox,e.MultiSelect,e.Attachment,e.User,e.CreatedBy,e.LastModifiedBy]},{text:sl(d),value:"like",ignoreVal:!1,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time,...he]},{text:il(d),value:"nlike",ignoreVal:!1,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time,...he]},{text:"is empty",value:"empty",ignoreVal:!0,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time,...he]},{text:"is not empty",value:"notempty",ignoreVal:!0,excludedTypes:[e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time,...he]},{text:"is null",value:"null",ignoreVal:!0,excludedTypes:[...he,e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time]},{text:"is not null",value:"notnull",ignoreVal:!0,excludedTypes:[...he,e.Checkbox,e.SingleSelect,e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy,e.Collaborator,e.Attachment,e.LinkToAnotherRecord,e.Lookup,e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime,e.Time]},{text:"contains all of",value:"allof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"contains any of",value:"anyof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.SingleSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"does not contain all of",value:"nallof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:"does not contain any of",value:"nanyof",ignoreVal:!1,includedTypes:[e.MultiSelect,e.SingleSelect,e.User,e.CreatedBy,e.LastModifiedBy]},{text:nl(d),value:"gt",ignoreVal:!1,includedTypes:[...he,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:ol(d),value:"lt",ignoreVal:!1,includedTypes:[...he,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:ul(d),value:"gte",ignoreVal:!1,includedTypes:[...he,e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime,e.Time]},{text:rl(d),value:"lte",ignoreVal:!1,includedTypes:[...he,e.Date,e.DateTime,e.Time,e.CreatedTime,e.LastModifiedTime]},{text:"is within",value:"isWithin",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"is blank",value:"blank",ignoreVal:!0,excludedTypes:[e.Checkbox,e.Links,e.Rollup]},{text:"is not blank",value:"notblank",ignoreVal:!0,excludedTypes:[e.Checkbox,e.Links,e.Rollup]}],et=(d,me)=>{const D=me&&ea(me);return d==="isWithin"?[{text:"the past week",value:"pastWeek",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past month",value:"pastMonth",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past year",value:"pastYear",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next week",value:"nextWeek",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next month",value:"nextMonth",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next year",value:"nextYear",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the next number of days",value:"nextNumberOfDays",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"the past number of days",value:"pastNumberOfDays",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]}]:[{text:"today",value:"today",ignoreVal:!0,includedTypes:[...D?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"tomorrow",value:"tomorrow",ignoreVal:!0,includedTypes:[...D?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"yesterday",value:"yesterday",ignoreVal:!0,includedTypes:[...D?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one week ago",value:"oneWeekAgo",ignoreVal:!0,includedTypes:[...D?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one week from now",value:"oneWeekFromNow",ignoreVal:!0,includedTypes:[...D?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"one month ago",value:"oneMonthAgo",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"one month from now",value:"oneMonthFromNow",ignoreVal:!0,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]},{text:"number of days ago",value:"daysAgo",ignoreVal:!1,includedTypes:[...D?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:"number of days from now",value:"daysFromNow",ignoreVal:!1,includedTypes:[...D?[]:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]]},{text:D?"exact month":"exact date",value:"exactDate",ignoreVal:!1,includedTypes:[e.Date,e.DateTime,e.LastModifiedTime,e.CreatedTime]}]};function dl(){return"default"}function cl(d,me=500,D=dl,S={}){const x=new Map;return(...ge)=>{const k=D(...ge);if(!x.has(k)){const C=ta(d,me,S);x.set(k,C)}return x.get(k)(...ge)}}function pl(d,me,D,S,x,ge,k,L,C,R,z){const W={},$=U(me),xe=U(x),v=U({}),B=we(Ut),{nestedFilters:E,allFilters:H,isForm:ue}=Pt(),{baseMeta:ie}=rt(dt()),I=we(At,U(!1)),{$api:A,$e:Te}=Nt(),{isUIAllowed:be}=aa(),{metas:g,getMeta:j}=la(),{addUndo:ke,clone:Q,defineViewScope:Ae}=sa(),He=U([...xe.value||[]]),N=G(()=>I.value||!be("filterSync")||!be("filterChildrenRead")),c=G({get:()=>N.value&&!L&&!k||ue.value&&!k?xe.value:He.value,set:i=>{if(ue.value&&!k){xe.value=i;return}else if(N.value){xe.value=i,!L&&!k&&(ge||(E.value=i),E.value=[...E.value]),B==null||B.trigger();return}He.value=i}}),je=G(()=>c.value.filter(i=>i.status!=="delete")),Me=we(jt,U()),te=we(Rt,U()),{showSystemFields:Ie,metaColumnById:De}=Za(),fe=G(()=>{var i,n;return(n=(i=Me.value)==null?void 0:i.columns)==null?void 0:n.filter(u=>{var r;return tt((r=De==null?void 0:De.value)==null?void 0:r[u.id])?Ie.value:u.uidt===e.QrCode||u.uidt===e.Barcode||u.uidt===e.ID||u.system?!1:!(u.colOptions&&u.system)})}),Oe=G(()=>{var i,n,u,r;return(n=(i=Me.value)==null?void 0:i.columns)!=null&&n.length?(r=(u=Me.value)==null?void 0:u.columns)==null?void 0:r.reduce((y,f)=>{if(f.uidt===e.Formula){const F=ia({formulaColumn:f});y[f.id]=F||f.uidt}else v.value[f.id]?y[f.id]=v.value[f.id].uidt:y[f.id]=f.uidt;return y},{}):{}}),Le=U([]);na(c,i=>{Le.value=Q(i)});const at=(i,n)=>Object.entries(n).filter(([u,r])=>i[u]!==r&&u in i).reduce((u,[r,y])=>({...u,[r]:y}),{}),Re=(i,n)=>{const u=["empty","notempty","null","notnull"].includes(n.value),r=Oe.value[i.fk_column_id];return n.includedTypes?i.fk_column_id&&n.includedTypes.includes(r)?u?ie.value.showNullAndEmptyInFilter:!0:!1:n.excludedTypes?i.fk_column_id&&!n.excludedTypes.includes(r)?u?ie.value.showNullAndEmptyInFilter:!0:!1:u?ie.value.showNullAndEmptyInFilter:!0},lt=(i,n)=>{const u=Oe.value[i.fk_column_id];if(n.includedTypes)return i.fk_column_id&&n.includedTypes.includes(u);if(n.excludedTypes)return i.fk_column_id&&!n.excludedTypes.includes(u)},Be=()=>{var n,u,r,y,f,F;const i=new Set(c.value.slice(1).map(O=>O.logical_op));return{comparison_op:(r=(u=Ee((n=fe.value)==null?void 0:n[0].uidt).filter(O=>{var Y;return Re({fk_column_id:(Y=fe.value)==null?void 0:Y[0].id},O)}))==null?void 0:u[0])==null?void 0:r.value,value:null,status:"create",logical_op:i.size===1?i.values().next().value:"and",fk_column_id:((F=(f=(y=R==null?void 0:R.value)==null?void 0:y.filter(O=>!tt(O)))==null?void 0:f[0])==null?void 0:F.id)??void 0,...z!=null&&z.value?{fk_parent_column_id:z.value}:{}}},st=()=>{const i=new Set(c.value.slice(1).map(n=>n.logical_op));return{is_group:!0,status:"create",logical_op:i.size===1?i.values().next().value:"and",...z!=null&&z.value?{fk_parent_column_id:z.value,children:[]}:{}}},Ye=async i=>{const n=[],u=[];for(const r of i)if(r.id&&r.is_group){const y=A.dbTableFilter.childrenRead(r.id).then(f=>{const F=f.list;return u.push(...F),Ye(F)});n.push(y)}await Promise.all(n),!L&&!k&&H.value.push(...u)},Qe=async({hookId:i,isLink:n,isWebhook:u,loadAllFilters:r}={})=>{var y;if((y=d.value)!=null&&y.id&&!(N.value||ue.value&&!u))try{u||i?$.value?c.value=(await A.dbTableFilter.childrenRead($.value)).list:i&&!ge&&(c.value=(await A.dbTableWebhookFilter.read(i)).list):n||C!=null&&C.value?$.value?c.value=(await A.dbTableFilter.childrenRead($.value)).list:C!=null&&C.value&&!ge&&(c.value=(await A.dbTableLinkFilter.read(C==null?void 0:C.value)).list):$.value?c.value=(await A.dbTableFilter.childrenRead($.value)).list:(c.value=(await A.dbTableFilter.read(d.value.id)).list,r&&(H.value=[...c.value],await Ye(H.value)))}catch(f){console.log(f),Ze.error(await We(f))}},re=async({hookId:i,linkId:n})=>{var u,r;try{for(const[y,f]of Object.entries(c.value))if(f.status==="delete")await A.dbTableFilter.delete(f.id),f.is_group?Ve(f):!L&&!k&&(H.value=H.value.filter(F=>F.id!==f.id));else if(f.status==="update")await A.dbTableFilter.update(f.id,{...f,fk_parent_id:$.value});else if(f.status==="create"){const F=(u=c.value[+y])==null?void 0:u.children;i?c.value[+y]=await A.dbTableWebhookFilter.create(i,{...f,children:void 0,fk_parent_id:$.value}):n||C!=null&&C.value?c.value[+y]=await A.dbTableLinkFilter.create(n||C.value,{...f,children:void 0,fk_parent_id:$.value}):c.value[+y]=await A.dbTableFilter.create((r=d==null?void 0:d.value)==null?void 0:r.id,{...f,fk_parent_id:$.value}),F&&(c.value[+y].children=F),!L&&!k&&H.value.push(c.value[+y])}!k&&!L&&(S==null||S())}catch(y){console.log(y),Ze.error(await We(y))}},Ue=cl(ve,500,(i,n)=>n);async function ve(i,n,u=!1,r=!1,y=!1){var f,F;if(W[n])return Ue(i,n,u,r,y);if(Array.from({length:n}).some((O,Y)=>W[Y]))return Ue(i,n,u,r,y);if(W[n]=!0,!(!d.value&&!(C!=null&&C.value))){if(!r&&!(ue.value&&!k)){const O=Le.value[n];if(O){const Y=Q(at(i,O));Object.keys(Y).length>0&&ke({undo:{fn:(ne,Fe)=>{const ae=c.value[n];ae&&(ae[ne]=Fe,ve(ae,n,u,!0))},args:[Object.keys(Y)[0],Object.values(Y)[0]]},redo:{fn:(ne,Fe)=>{const ae=c.value[n];ae&&(ae[ne]=Fe,ve(ae,n,u,!0))},args:[Object.keys(Y)[0],i[Object.keys(Y)[0]]]},scope:Ae({view:te.value})})}}try{if(N.value)c.value[n]={...i},c.value=[...c.value];else if(!(D!=null&&D.value)&&!u)i.status=i.id?"update":"create";else if((f=c.value[n])!=null&&f.id&&((F=c.value[n])==null?void 0:F.status)!=="create")await A.dbTableFilter.update(c.value[n].id,{...i,fk_parent_id:$.value}),Te("a:filter:update",{logical:i.logical_op,comparison:i.comparison_op,link:!!L,webHook:!!k});else{if(C!=null&&C.value){const O=await A.dbTableLinkFilter.create(C.value,{...i,fk_parent_id:$.value});c.value[n]={...c.value[n],fk_parent_id:$.value,id:O.id,status:void 0}}else{const O=await A.dbTableFilter.create(d.value.id,{...i,fk_parent_id:$.value});c.value[n]={...c.value[n],fk_parent_id:$.value,id:O.id,status:void 0}}!L&&!k&&H.value.push(c.value[+n])}}catch(O){console.log(O),Ze.error(await We(O))}finally{W[n]=!1}Le.value=Q(c.value),!k&&!y&&!L&&(S==null||S())}}function Ve(i){if(!L&&!k)return;H.value.filter(u=>u.fk_parent_id===i.id).forEach(u=>{u.is_group&&Ve(u)}),H.value=H.value.filter(u=>u.id!==i.id&&u.fk_parent_id!==i.id)}const Ce=async(i,n,u=!1)=>{if(i.status="delete",!u&&!i.is_group&&!(ue.value&&!k)&&ke({undo:{fn:async r=>{r.status="create",c.value.splice(n,0,r),await ve(r,n,!1,!0)},args:[Q(i)]},redo:{fn:async r=>{await Ce(c.value[r],r,!0)},args:[n]},scope:Ae({view:te.value})}),N.value)c.value.splice(n,1),c.value=[...c.value],!k&&!L&&(S==null||S());else{if(i.id)if(!(D!=null&&D.value))i.status="delete";else try{await A.dbTableFilter.delete(i.id),!k&&!L&&(S==null||S());const r=c.value.findIndex(y=>y.id===i.id);r>-1&&c.value.splice(r,1)}catch(r){console.log(r),Ze.error(await We(r))}else c.value.splice(n,1);Te("a:filter:delete",{length:je.value.length,link:!!L,webHook:!!k})}i.is_group?Ve(i):!L&&!k&&(H.value=H.value.filter(r=>r.id!==i.id))},Ne=async(i=!1,n={})=>{c.value.push(n!=null&&n.fk_column_id?{...Be(),...n}:Be()),!i&&!(ue.value&&!k)&&ke({undo:{fn:async function(r){this.redo.args=[r,Q(c.value[r])],await Ce(c.value[r],r,!0)},args:[c.value.length-1]},redo:{fn:async(u,r)=>{r.status="create",c.value.splice(u,0,r),await ve(r,u,!1,!0)},args:[]},scope:Ae({view:te.value})}),Le.value=Q(c.value),Te("a:filter:add",{length:c.value.length,link:!!L,webHook:!!k})},ye=async()=>{const i=Be(),n=st();N.value&&(n.children=[i]),c.value.push(n);const u=c.value.length-1;await ve(c.value[u],u),Le.value=Q(c.value),Te("a:filter:add",{length:c.value.length,group:!0,link:!!L,webHook:!!k})};return qe(()=>{var i,n,u,r,y,f;return!(d!=null&&d.value)||!((n=g==null?void 0:g.value)!=null&&n[(i=d==null?void 0:d.value)==null?void 0:i.fk_model_id])?0:((f=(y=(r=g==null?void 0:g.value)==null?void 0:r[(u=d==null?void 0:d.value)==null?void 0:u.fk_model_id])==null?void 0:y.columns)==null?void 0:f.length)||0},async(i,n)=>{i&&i<n&&await Qe()}),{filters:c,nonDeletedFilters:je,loadFilters:Qe,sync:re,deleteFilter:Ce,saveOrUpdate:ve,addFilter:Ne,addFilterGroup:ye,saveOrUpdateDebounced:Ue,isComparisonOpAllowed:Re,isComparisonSubOpAllowed:lt,loadBtLookupTypes:async()=>{var n,u,r,y;const i={};try{for(const f of((n=Me.value)==null?void 0:n.columns)||[]){if(f.uidt!==e.Lookup)continue;let F=f;for(;F&&F.uidt===e.Lookup;){const O=(r=(u=await j(F.fk_model_id))==null?void 0:u.columns)==null?void 0:r.find(ne=>ne.id===F.colOptions.fk_relation_column_id);if(!O)break;const Y=await j((O==null?void 0:O.colOptions).fk_related_model_id);if(F=(y=Y==null?void 0:Y.columns)==null?void 0:y.find(ne=>ne.id===F.colOptions.fk_lookup_column_id),(F==null?void 0:F.id)===f.id)break}i[f.id]=F}v.value=i}catch(f){console.error(f)}},btLookupTypesMap:v,types:Oe}}const ml=ba(()=>ha(()=>Promise.resolve().then(()=>Hl),void 0,import.meta.url).then(d=>d.default||d)),fl={key:0,class:"flex min-w-full w-min items-center gap-1 mb-2"},vl={class:"flex items-center gap-1"},yl={class:"flex items-center gap-1"},_l={class:"flex items-center gap-1"},gl={class:"flex items-center gap-1"},Tl={key:0,class:"flex flex-col min-w-full w-min gap-y-2"},bl={key:0,class:"flex items-center nc-filter-where-label ml-1"},hl={class:"flex items-center w-full justify-between w-full gap-2"},wl={class:"truncate flex-1 capitalize"},kl={key:0,class:"flex items-center !min-w-18 !max-w-18 pl-3 nc-filter-where-label"},xl={class:"flex items-center w-full justify-between w-full gap-2"},Ml={class:"truncate flex-1 capitalize"},Cl={class:"flex items-center w-full justify-between w-full gap-2"},Fl={class:"truncate flex-1"},Dl={key:0,class:"flex flex-grow"},Ll={class:"flex items-center w-full justify-between w-full gap-2 max-w-40"},Vl={class:"flex items-center flex-grow"},Sl={key:0,class:"flex-grow"},$l={key:2,class:"flex-grow"},Ol={class:"relative overflow-visible min-h-17 w-10"},Bl={class:"absolute -top-21 flex flex-col min-h-34.5 w-70 p-1.5 bg-white rounded-lg border-1 border-gray-200 justify-start overflow-hidden",style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},Ul=["onClick"],Al={class:"flex flex-row items-center justify-between w-full"},jl=["onClick"],Rl={class:"flex flex-row items-center justify-between w-full"},Nl={class:"flex items-center gap-1"},Pl={class:"flex items-center gap-1"},Gl={class:"flex items-center gap-1"},zl={class:"flex items-center gap-1"},ql=$t({__name:"ColumnFilter",props:{nestedLevel:{default:0},parentId:{default:void 0},autoSave:{type:Boolean,default:!0},hookId:{default:void 0},showLoading:{type:Boolean,default:!0},modelValue:{},webHook:{type:Boolean,default:!1},link:{type:Boolean,default:!1},draftFilter:{},isOpen:{type:Boolean},rootMeta:{},linkColId:{default:void 0},parentColId:{default:void 0},actionBtnType:{default:"text"},filterOption:{},visibilityError:{default:()=>({})},disableAddNewFilter:{type:Boolean,default:!1}},emits:["update:filtersLength","update:draftFilter","update:modelValue"],setup(d,{expose:me,emit:D}){var vt,yt;const S=d,x=D,ge=S.modelValue,k=[e.QrCode,e.Barcode,e.Button],L=bt(S,"draftFilter",x),C=bt(S,"modelValue",x),{nestedLevel:R,parentId:z,autoSave:W,hookId:$,showLoading:xe,webHook:v,link:B,linkColId:E,parentColId:H,visibilityError:ue,disableAddNewFilter:ie}=oa(S),I=G(()=>R.value>0),{t:A}=ua(),Te=[{value:"and",text:A("general.and")},{value:"or",text:A("general.or")}],be=we(jt,U()),g=we(Rt,U()),j=we(Ut),ke=we(ra),Q=we(At,U(!1)),{$e:Ae}=Nt(),{nestedFilters:He,isForm:N}=Pt(),c=C.value||!B.value&&!v.value&&He.value||[],je=G(()=>{var t;return(t=be.value)==null?void 0:t.columns}),Me=G(()=>(je.value||[]).filter(t=>{if(B.value&&tt(t)&&!t.pk&&!da(t))return!1;const l=S.filterOption?S.filterOption(t):!0;return!k.includes(t.uidt)&&l})),{filters:te,nonDeletedFilters:Ie,deleteFilter:De,saveOrUpdate:fe,loadFilters:Oe,addFilter:Le,addFilterGroup:at,sync:Re,saveOrUpdateDebounced:lt,isComparisonOpAllowed:Be,isComparisonSubOpAllowed:st,loadBtLookupTypes:Ye,btLookupTypesMap:Qe,types:re}=pl(g,z,G(()=>W.value),()=>{j.trigger({shouldShowLoading:xe.value,offset:0,isFormFieldFilters:N.value&&!v.value}),ke==null||ke.trigger()},c,S.nestedLevel>0,v.value,B.value,E,Me,H),{getPlanLimit:Ue}=ca(),ve=U(),Ve=U(),Ce=U(),Ne=U(!1),ye=t=>{var l;return Qe.value[t.fk_column_id]||((l=je.value)==null?void 0:l.find(p=>p.id===t.fk_column_id))},it=U({}),i=(t,l)=>{var p,h,T,J;return!(t.id||t.comparison_op&&((h=et(t.comparison_op,(p=l==null?void 0:l.meta)==null?void 0:p.date_format).find(oe=>oe.value===t.comparison_sub_op))!=null&&h.ignoreVal)||(J=Ee(re.value[l.id],(T=l==null?void 0:l.meta)==null?void 0:T.date_format).find(oe=>oe.value===t.comparison_op))!=null&&J.ignoreVal||t.value)},n=(t,l)=>{var h;const p=ye(t);p&&(p.uidt===e.SingleSelect&&["anyof","nanyof"].includes(it.value[t.id])&&["eq","neq"].includes(t.comparison_op)?t.value=null:["blank","notblank","empty","notempty","null","notnull"].includes(t.comparison_op)?(t.value=null,t.comparison_sub_op=null):Je(re.value[p.id])&&(t.value=null,et(t.comparison_op,(h=p==null?void 0:p.meta)==null?void 0:h.date_format).map(T=>T.value).includes(t.comparison_sub_op)||(t.comparison_op==="isWithin"?t.comparison_sub_op="pastNumberOfDays":t.comparison_sub_op="exactDate")),i(t,p)||fe(t,l),it.value[t.id]=t.comparison_op,Ae("a:filter:update",{logical:t.logical_op,comparison:t.comparison_op,comparison_sub_op:t.comparison_sub_op,link:!!B.value,webHook:!!v.value}))};qe(()=>{var t;return(t=g.value)==null?void 0:t.id},(t,l)=>{!I.value&&t!==l&&($!=null&&$.value||!v.value)&&(E!=null&&E.value||!B.value)&&Oe({hookId:$.value,isWebhook:v.value,linkColId:a(E),isLink:B.value})});const u=we(pa,U({}));qe(()=>Ie.value.length,t=>{u.value[(z==null?void 0:z.value)??"root"]=[...Ie.value],x("update:filtersLength",t??0)});const r=G(()=>Object.values(u.value).reduce((t,l)=>t+l.filter(p=>!p.is_group).length,0)),y=async(t,l=!1,p=!0)=>{var h;if(!p)for(let T=te.value.length-1;T>=0;T--)await De(te.value[T],T);if(B.value){if(!t&&!S.nestedLevel)return;await Re({linkId:t,nested:l})}else await Re({hookId:t,nested:l});if((h=ve.value)!=null&&h.length)for(const T of ve.value)T.parentId&&await T.applyChanges(t,!0,void 0)},f=(t,l)=>{var h,T;const p=ye(t);p&&(ut(p)?pt(t,l).catch(()=>{}):t.fk_value_col_id=null,t.comparison_op=(T=Ee(re.value[p.id],(h=p==null?void 0:p.meta)==null?void 0:h.date_format).find(J=>Be(t,J)))==null?void 0:T.value,Je(re.value[p.id])&&!["blank","notblank"].includes(t.comparison_op)?t.comparison_op==="isWithin"?t.comparison_sub_op="pastNumberOfDays":t.comparison_sub_op="exactDate":t.comparison_sub_op=null,t.value=null,i(t,p)||fe(t,l))},F=(t,l,p)=>{l.value=t,lt(l,p)};me({applyChanges:y,parentId:z});const O=()=>{var t;(t=Ve.value)==null||t.scrollTo({top:Ve.value.scrollHeight,behavior:"smooth"})},Y=()=>{var t;I.value&&((t=Ce==null?void 0:Ce.value)==null||t.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}))},ne=async t=>{await Le(!1,t),t&&f(te.value[te.value.length-1],te.value.length-1),I.value?Y():O()},Fe=async()=>{await at(),I.value?Y():O()},ae=t=>{var p,h,T,J,oe;const l=ye(t);return t.comparison_op?t.comparison_sub_op?!((T=et(t.comparison_op,(h=(p=ye(t))==null?void 0:p.meta)==null?void 0:h.date_format).find(de=>de.value===t.comparison_sub_op))!=null&&T.ignoreVal):!((oe=Ee(re.value[l==null?void 0:l.id],(J=l==null?void 0:l.meta)==null?void 0:J.date_format).find(de=>de.value===t.comparison_op))!=null&&oe.ignoreVal):!1};ma(async()=>{await Promise.all([(async()=>{ge||await Oe({hookId:$==null?void 0:$.value,isWebhook:v.value,linkColId:a(E),isLink:B.value})})(),Ye()]),Ne.value=!0}),fa(()=>{z.value&&delete u.value[z.value]});function Je(t){return[e.Date,e.DateTime,e.CreatedTime,e.LastModifiedTime].includes(t)}qe([L,Ne],async()=>{var p,h;if(!Ne.value||!((p=L.value)!=null&&p.fk_column_id))return;await ne(L.value),await va(),O();const t=document.querySelectorAll(`.nc-filter-wrapper-${L.value.fk_column_id}`);if(L.value={},!t.length)return;const l=(h=t[t.length-1])==null?void 0:h.querySelector(".nc-filter-value-select input");l&&setTimeout(()=>{var T,J;(T=l==null?void 0:l.focus)==null||T.call(l),(J=l==null?void 0:l.click)==null||J.call(l)},100)},{deep:!0,immediate:!0});const _e=G(()=>te.value.filter(t=>t.status!=="delete")),Ke=G(()=>new Set(_e.value.slice(1).map(t=>t.logical_op)).size>1),ct=async(t,l)=>{l===1&&_e.value.slice(2).every(p=>p.logical_op!==t.logical_op)&&await Promise.all(_e.value.slice(2).map(async(p,h)=>{p.logical_op=t.logical_op,await fe(p,h+2,!1,!1,!0)})),await fe(t,l)};qe(te,t=>{t&&t!==C.value&&(C.value=t)},{immediate:!0});async function pt(t,l){t.dynamic=!1,t.fk_value_col_id=null,await fe(t,l)}const{sqlUis:mt}=rt(dt()),nt=(vt=be.value)!=null&&vt.source_id?mt.value[(yt=be.value)==null?void 0:yt.source_id]:Object.values(mt.value)[0],ft=t=>{const l=ye(t);if(ut(l)||[e.Attachment,e.Rating,e.Checkbox,e.QrCode,e.Barcode,e.Collaborator,e.GeoData,e.SpecificDBType].includes(l.uidt))return!1;const p=nt.getAbstractType(l);return["integer","float","text","string"].includes(p)?!t.comparison_op||["eq","lt","gt","lte","gte","like","nlike","neq"].includes(t.comparison_op):!1},Gt=t=>{var p,h;const l=ye(t);return l?(h=(p=S.rootMeta)==null?void 0:p.columns)==null?void 0:h.filter(T=>{if(k.includes(T.uidt)||ut(T)||tt(T)&&!T.pk)return!1;const J=nt.getAbstractType(T),oe=nt.getAbstractType(l);return[J,oe].every(de=>["float","integer"].includes(de))||[J,oe].every(de=>["text","string"].includes(de))?!0:oe===J}):[]},zt=async(t,l)=>{t.dynamic=ft(t)&&ae(t),await fe(t,l)};return(t,l)=>{const p=_a,h=ga,T=wa,J=ka,oe=xa,de=Xa,Xe=Ma,qt=ml,_t=Ta,gt=Ca,Et=Wa,Ht=tl,Se=ya("e");return o(),b("div",{"data-testid":"nc-filter",class:X(["menu-filter-dropdown w-min",{"max-h-[max(80vh,500px)] min-w-122 py-2 pl-4":!a(I),"!min-w-127.5":a(N)&&!a(v),"!min-w-full !w-full !pl-0":!a(I)&&a(v),"min-w-full":a(I)}])},[a(I)?(o(),b("div",fl,[M("div",{class:X([`nc-filter-logical-op-level-${a(R)}`])},[ot(t.$slots,"start",{},void 0,!0)],2),l[9]||(l[9]=M("div",{class:"flex-grow"},null,-1)),le(oe,{trigger:["hover"],"overlay-class-name":"nc-dropdown-filter-group-sub-menu",disabled:a(ie)},{overlay:w(()=>[le(J,null,{default:w(()=>[!("isEeUI"in t?t.isEeUI:a(ht))&&!a(Q)?(o(),b(K,{key:0},[a(r)<a(Ue)(a(wt).FILTER_LIMIT)?(o(),b(K,{key:0},[le(T,{"data-testid":"add-filter-menu",onClick:Z(ne,["stop"])},{default:w(()=>[M("div",vl,[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).plus))),pe(" "+q(a(N)&&!a(v)?t.$t("activity.addCondition"):t.$t("activity.addFilter")),1)])]),_:1}),a(R)<5?(o(),_(T,{key:0,"data-testid":"add-filter-group-menu",onClick:Z(Fe,["stop"])},{default:w(()=>[M("div",yl,[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).plusSquare))),pe(" "+q(a(N)&&!a(v)?t.$t("activity.addConditionGroup"):t.$t("activity.addFilterGroup")),1)])]),_:1})):V("",!0)],64)):V("",!0)],64)):(o(),b(K,{key:1},[le(T,{"data-testid":"add-filter-menu",onClick:Z(ne,["stop"])},{default:w(()=>[M("div",_l,[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).plus))),pe(" "+q(a(N)&&!a(v)?t.$t("activity.addCondition"):t.$t("activity.addFilter")),1)])]),_:1}),!a(v)&&a(R)<5?(o(),_(T,{key:0,"data-testid":"add-filter-group-menu",onClick:Z(Fe,["stop"])},{default:w(()=>[M("div",gl,[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).plusSquare))),pe(" "+q(a(N)&&!a(v)?t.$t("activity.addConditionGroup"):t.$t("activity.addFilterGroup")),1)])]),_:1})):V("",!0)],64))]),_:1})]),default:w(()=>[le(h,{size:"xs",type:"text",disabled:a(ie)},{default:w(()=>[le(p,{icon:"plus",class:"cursor-pointer"})]),_:1},8,["disabled"])]),_:1},8,["disabled"]),M("div",null,[ot(t.$slots,"end",{},void 0,!0)])])):V("",!0),a(_e)&&a(_e).length?(o(),b("div",{key:1,ref_key:"wrapperDomRef",ref:Ve,class:X(["flex flex-col gap-y-1.5 nc-filter-grid min-w-full w-min",{"max-h-420px nc-scrollbar-thin nc-filter-top-wrapper pr-4 my-2 py-1":!a(I),"!pr-0":a(v)&&!a(I)}]),onClick:l[4]||(l[4]=Z(()=>{},["stop"]))},[(o(!0),b(K,null,ze(a(te),(s,P)=>(o(),b(K,{key:P},[s.status!=="delete"?(o(),b(K,{key:0},[s.is_group?(o(),b("div",Tl,[M("div",{class:X(["flex rounded-lg p-2 min-w-full w-min border-1",[`nc-filter-nested-level-${a(R)}`]])},[s.id||s.children||!a(W)?(o(),_(qt,{key:P,ref_for:!0,ref_key:"localNestedFilters",ref:ve,modelValue:s.children,"onUpdate:modelValue":m=>s.children=m,"nested-level":a(R)+1,"parent-id":s.id,"auto-save":a(W),"web-hook":a(v),link:a(B),"show-loading":!1,"root-meta":t.rootMeta,"link-col-id":a(E),"parent-col-id":a(H),"filter-option":t.filterOption,"visibility-error":a(ue),"disable-add-new-filter":a(ie)},{start:w(()=>[a(_e).indexOf(s)?(o(),b("div",{key:`${P}nested`,class:"flex nc-filter-logical-op"},[$e((o(),_(Xe,{value:s.logical_op,"onUpdate:value":m=>s.logical_op=m,"dropdown-match-select-width":!1,class:X(["min-w-18 capitalize",{"nc-disabled-logical-op":s.readOnly||P>1&&!a(Ke),"!max-w-18":!a(v),"!w-full":a(v)}]),placeholder:"Group op","dropdown-class-name":"nc-dropdown-filter-logical-op-group",disabled:P>1&&!a(Ke),onClick:l[0]||(l[0]=Z(()=>{},["stop"])),onChange:m=>ct(s,P)},{default:w(()=>[(o(),b(K,null,ze(Te,m=>le(de,{key:m.value,value:m.value},{default:w(()=>[M("div",hl,[M("div",wl,q(m.text),1),s.logical_op===m.value?(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):V("",!0)])]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value","disabled","class","onChange"])),[[Se,["c:filter:logical-op:select"]]])])):(o(),b("span",bl,q(t.$t("labels.where")),1))]),end:w(()=>[s.readOnly?V("",!0):$e((o(),_(h,{key:P,type:"text",size:"small",class:"nc-filter-item-remove-btn cursor-pointer",onClick:Z(m=>a(De)(s,P),["stop"])},{default:w(()=>[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).deleteListItem)))]),_:2},1032,["onClick"])),[[Se,["c:filter:delete",{link:!!a(B),webHook:!!a(v)}]]])]),_:2},1032,["modelValue","onUpdate:modelValue","nested-level","parent-id","auto-save","web-hook","link","root-meta","link-col-id","parent-col-id","filter-option","visibility-error","disable-add-new-filter"])):V("",!0)],2)])):(o(),b("div",{key:1,class:X(["flex flex-row gap-x-0 w-full nc-filter-wrapper",`nc-filter-wrapper-${s.fk_column_id}`])},[a(_e).indexOf(s)?$e((o(),_(Xe,{key:1,value:s.logical_op,"onUpdate:value":m=>s.logical_op=m,"dropdown-match-select-width":!1,class:X(["h-full !max-w-18 !min-w-18 capitalize",{"nc-disabled-logical-op":s.readOnly||a(_e).indexOf(s)>1&&!a(Ke)}]),"hide-details":"",disabled:s.readOnly||a(_e).indexOf(s)>1&&!a(Ke),"dropdown-class-name":"nc-dropdown-filter-logical-op",onChange:m=>ct(s,P),onClick:l[1]||(l[1]=Z(()=>{},["stop"]))},{default:w(()=>[(o(),b(K,null,ze(Te,m=>le(de,{key:m.value,value:m.value},{default:w(()=>[M("div",xl,[M("div",Ml,q(m.text),1),s.logical_op===m.value?(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):V("",!0)])]),_:2},1032,["value"])),64))]),_:2},1032,["value","onUpdate:value","disabled","class","onChange"])),[[Se,["c:filter:logical-op:select",{link:!!a(B),webHook:!!a(v)}]]]):(o(),b("div",kl,q(t.$t("labels.where")),1)),a(N)&&!a(v)&&!a(Me).find(m=>(m==null?void 0:m.id)===s.fk_column_id)?(o(),_(_t,{key:2,class:"flex-1 flex items-center gap-2 px-2 !text-red-500 cursor-pointer",disabled:!s.fk_column_id||!a(ue)[s.fk_column_id]},{title:w(()=>[pe(q(a(ue)[s.fk_column_id]??""),1)]),default:w(()=>[le(p,{icon:"alertTriangle",class:"flex-none"}),pe(" "+q(t.$t("title.fieldInaccessible")),1)]),_:2},1032,["disabled"])):(o(),b(K,{key:3},[(o(),_(gt,{key:`${P}_6`,modelValue:s.fk_column_id,"onUpdate:modelValue":m=>s.fk_column_id=m,class:X([{"max-w-32":!a(v),"!w-full":a(v)},"nc-filter-field-select min-w-32 max-h-8"]),columns:a(Me),disabled:s.readOnly,meta:a(be),onClick:l[2]||(l[2]=Z(()=>{},["stop"])),onChange:m=>f(s,P)},null,8,["modelValue","onUpdate:modelValue","class","columns","disabled","meta","onChange"])),$e((o(),_(Xe,{value:s.comparison_op,"onUpdate:value":m=>s.comparison_op=m,"dropdown-match-select-width":!1,class:X(["caption nc-filter-operation-select !min-w-26.75 max-h-8",{"!max-w-26.75":!a(v),"!w-full":a(v)}]),placeholder:t.$t("labels.operation"),density:"compact",variant:"solo",disabled:s.readOnly,"hide-details":"","dropdown-class-name":"nc-dropdown-filter-comp-op !max-w-80",onChange:m=>n(s,P)},{default:w(()=>{var m,Pe;return[(o(!0),b(K,null,ze(("comparisonOpList"in t?t.comparisonOpList:a(Ee))(a(re)[s.fk_column_id],(Pe=(m=ye(s))==null?void 0:m.meta)==null?void 0:Pe.date_format),ce=>(o(),b(K,{key:ce.value},[a(Be)(s,ce)?(o(),_(de,{key:0,value:ce.value},{default:w(()=>[M("div",Cl,[M("div",Fl,q(ce.text),1),s.comparison_op===ce.value?(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):V("",!0)])]),_:2},1032,["value"])):V("",!0)],64))),128))]}),_:2},1032,["value","onUpdate:value","placeholder","class","disabled","onChange"])),[[Se,["c:filter:comparison-op:select",{link:!!a(B),webHook:!!a(v)}]]]),["blank","notblank"].includes(s.comparison_op)?(o(),b("div",Dl)):Je(a(re)[s.fk_column_id])?$e((o(),_(Xe,{key:1,value:s.comparison_sub_op,"onUpdate:value":m=>s.comparison_sub_op=m,"dropdown-match-select-width":!1,class:X(["caption nc-filter-sub_operation-select min-w-28",{"flex-grow w-full":!ae(s),"max-w-28":ae(s)&&!a(v)}]),placeholder:t.$t("labels.operationSub"),density:"compact",variant:"solo",disabled:s.readOnly,"hide-details":"","dropdown-class-name":"nc-dropdown-filter-comp-sub-op",onChange:m=>n(s,P)},{default:w(()=>{var m,Pe;return[(o(!0),b(K,null,ze(("comparisonSubOpList"in t?t.comparisonSubOpList:a(et))(s.comparison_op,(Pe=(m=ye(s))==null?void 0:m.meta)==null?void 0:Pe.date_format),ce=>(o(),b(K,{key:ce.value},[a(st)(s,ce)?(o(),_(de,{key:0,value:ce.value},{default:w(()=>[M("div",Ll,[le(_t,{"show-on-truncate-only":"",class:"truncate flex-1"},{title:w(()=>[pe(q(ce.text),1)]),default:w(()=>[pe(" "+q(ce.text),1)]),_:2},1024),s.comparison_sub_op===ce.value?(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):V("",!0)])]),_:2},1032,["value"])):V("",!0)],64))),128))]}),_:2},1032,["value","onUpdate:value","class","placeholder","disabled","onChange"])),[[Se,["c:filter:sub-comparison-op:select",{link:!!a(B),webHook:!!a(v)}]]]):V("",!0),M("div",Vl,[a(B)&&(s.dynamic||s.fk_value_col_id)?(o(),b("div",Sl,[ae(s)?(o(),_(gt,{key:0,modelValue:s.fk_value_col_id,"onUpdate:modelValue":m=>s.fk_value_col_id=m,class:"nc-filter-field-select min-w-32 w-full max-h-8",columns:Gt(s),meta:t.rootMeta,onChange:m=>a(fe)(s,P)},null,8,["modelValue","onUpdate:modelValue","columns","meta","onChange"])):V("",!0)])):(o(),b(K,{key:1},[s.field&&a(re)[s.field]==="boolean"?(o(),_(Et,{key:0,checked:s.value,"onUpdate:checked":m=>s.value=m,dense:"",disabled:s.readOnly,onChange:m=>a(fe)(s,P)},null,8,["checked","onUpdate:checked","disabled","onChange"])):V("",!0),ae(s)?(o(),_(Ht,{key:1,class:X(["nc-filter-value-select rounded-md min-w-34",{"!w-full":a(v)}]),column:{...ye(s),uidt:a(re)[s.fk_column_id]},filter:s,onUpdateFilterValue:m=>F(m,s,P),onClick:l[3]||(l[3]=Z(()=>{},["stop"]))},null,8,["class","column","filter","onUpdateFilterValue"])):Je(a(re)[s.fk_column_id])?V("",!0):(o(),b("div",$l))],64)),a(B)?(o(),_(oe,{key:2,class:"nc-settings-dropdown h-full flex items-center min-w-0 rounded-lg",trigger:["click"],placement:"bottom"},{overlay:w(()=>[M("div",Ol,[M("div",Bl,[M("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-grid group",onClick:m=>pt(s,P)},[M("div",Al,[l[10]||(l[10]=M("div",{class:"flex flex-row items-center justify-start gap-x-3"},"Static condition",-1)),!s.dynamic&&!s.fk_value_col_id?(o(),_(p,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):V("",!0)]),l[11]||(l[11]=M("div",{class:"flex flex-row text-xs text-gray-400"},"Filter based on static value",-1))],8,Ul),$e((o(),b("div",{class:X(["px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-form group",ft(s)&&ae(s)?"cursor-pointer":"cursor-not-allowed"]),onClick:m=>zt(s,P)},[M("div",Rl,[l[12]||(l[12]=M("div",{class:"flex flex-row items-center justify-start gap-x-2.5"},"Dynamic condition",-1)),s.dynamic||s.fk_value_col_id?(o(),_(p,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):V("",!0)]),l[13]||(l[13]=M("div",{class:"flex flex-row text-xs text-gray-400"},"Filter based on dynamic value",-1))],10,jl)),[[Se,["c:filter:dynamic-filter"]]])])])]),default:w(()=>[le(h,{type:"text",size:"small"},{default:w(()=>[le(p,{icon:"settings"})]),_:1})]),_:2},1024)):V("",!0)])],64)),s.readOnly?V("",!0):$e((o(),_(h,{key:4,type:"text",size:"small",class:"nc-filter-item-remove-btn self-center",onClick:Z(m=>a(De)(s,P),["stop"])},{default:w(()=>[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).deleteListItem)))]),_:2},1032,["onClick"])),[[Se,["c:filter:delete",{link:!!a(B),webHook:!!a(v)}]]])],2))],64)):V("",!0)],64))),128))],2)):V("",!0),a(I)?V("",!0):(o(),b(K,{key:2},[("isEeUI"in t?t.isEeUI:a(ht))&&!a(Q)?(o(),b(K,{key:0},[a(r)<a(Ue)(a(wt).FILTER_LIMIT)?(o(),b("div",{key:0,class:X(["flex gap-2",{"mt-1 mb-2":a(te).length}])},[le(h,{size:"small",type:t.actionBtnType,disabled:a(ie),class:"nc-btn-focus","data-testid":"add-filter",onClick:l[5]||(l[5]=Z(s=>ne(),["stop"]))},{default:w(()=>[M("div",Nl,[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).plus))),pe(" "+q(a(N)&&!a(v)?t.$t("activity.addCondition"):t.$t("activity.addFilter")),1)])]),_:1},8,["type","disabled"]),a(R)<5?(o(),_(h,{key:0,class:"nc-btn-focus",disabled:a(ie),type:t.actionBtnType,size:"small","data-testid":"add-filter-group",onClick:l[6]||(l[6]=Z(s=>Fe(),["stop"]))},{default:w(()=>[M("div",Pl,[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).plus))),pe(" "+q(a(N)&&!a(v)?t.$t("activity.addConditionGroup"):t.$t("activity.addFilterGroup")),1)])]),_:1},8,["disabled","type"])):V("",!0)],2)):V("",!0)],64)):(o(),b("div",{key:1,ref_key:"addFiltersRowDomRef",ref:Ce,class:X(["flex gap-2",{"mt-1 mb-2":a(te).length}])},[le(h,{class:"nc-btn-focus",size:"small",type:t.actionBtnType,"data-testid":"add-filter",onClick:l[7]||(l[7]=Z(s=>ne(),["stop"]))},{default:w(()=>[M("div",Gl,[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).plus))),pe(" "+q(a(N)&&!a(v)?t.$t("activity.addCondition"):t.$t("activity.addFilter")),1)])]),_:1},8,["type"]),!a(B)&&!a(v)&&a(R)<5?(o(),_(h,{key:0,class:"nc-btn-focus",type:t.actionBtnType,size:"small","data-testid":"add-filter-group",onClick:l[8]||(l[8]=Z(s=>Fe(),["stop"]))},{default:w(()=>[M("div",zl,[(o(),_(ee(("iconMap"in t?t.iconMap:a(se)).plus))),pe(" "+q(a(N)&&!a(v)?t.$t("activity.addConditionGroup"):t.$t("activity.addFilterGroup")),1)])]),_:1},8,["type"])):V("",!0)],2))],64)),!a(_e)||!a(_e).length?(o(),b("div",{key:3,class:X(["flex flex-row text-gray-400 mt-2",{"ml-1":a(I),"ml-0.5":!a(I)}])},q(a(N)&&!a(v)?t.$t("title.noConditionsAdded"):t.$t("title.noFiltersAdded")),3)):V("",!0),ot(t.$slots,"default",{},void 0,!0)],2)}}}),El=Ot(ql,[["__scopeId","data-v-68708470"]]),Hl=Object.freeze(Object.defineProperty({__proto__:null,default:El},Symbol.toStringTag,{value:"Module"}));export{Hl as C,El as _,pl as u};
