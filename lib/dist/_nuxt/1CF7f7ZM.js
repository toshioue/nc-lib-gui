const __vite__fileDeps=["./CV9BO7Kp.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./uhBJvRY2.js","./D_MsYLkT.js","./BCJFTkwv.js","./BQQOEPN4.js","./CB1aB6F1.js","./B5RRVMt5.js","./vll-Pnjv.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as Y,ag as Z,ax as ee,cL as se,L as te,aq as ae,r as b,gf as _,f as k,g as oe,F as le,a$ as ie,o as d,Q as f,w as n,a as s,N as a,c as u,t as r,R as B,T as w,U,b as l,a7 as ne,ao as re,at as de,a8 as ce,gD as me,d as $,X as ue,a4 as ve,ah as y,ai as fe,aT as pe,y as _e}from"./DZZ6t_j4.js";import{_ as ye}from"./DgixBgIx.js";import{u as xe}from"./uhBJvRY2.js";import{h as he}from"./C3jLTHF4.js";import{u as ge}from"./EqBqqo9-.js";import{_ as be}from"./Bd2huW26.js";import{F as j}from"./BYINaHrJ.js";import"./DKN1hQ6S.js";import{I as ke}from"./BQuyMdA-.js";import{_ as we}from"./CXD-Dj4T.js";import{_ as Ue}from"./dfem9Uc_.js";import{S as $e,_ as Me}from"./D_MsYLkT.js";import"./D9tFZoTQ.js";import"./vll-Pnjv.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./BQQOEPN4.js";import"./DyDFI6NE.js";import"./BCJFTkwv.js";import"./CB1aB6F1.js";const Te=ue(()=>ve(()=>import("./CV9BO7Kp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url).then(c=>c.default||c)),Ce={class:"flex flex-col p-6","data-testid":"invite-user-and-share-base-modal"},Re={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 border-gray-100 w-full"},Ee={key:0,class:"select-none font-medium"},Ie={class:"px-2 mt-1.5"},Be={key:0,class:"flex flex-col mt-1 border-b-1 pb-5"},je={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},Fe={class:"flex flex-row justify-between items-center py-1"},Se={class:"flex pl-2 text-green-700 text-xs","data-testid":"invite-modal-invitation-url"},Ve={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2"},Ne={class:"flex flex-row justify-start mt-4 ml-2"},De={class:"flex flex-row justify-center items-center space-x-0.5"},Le={class:"text-xs text-gray-600"},ze={key:1,class:"flex flex-col pb-4"},Ae={key:0,class:"flex flex-row items-center pl-2 pb-1 h-[1rem]"},Pe={class:"text-xs ml-0.5 mt-0.5"},qe={class:"border-1 py-3 px-4 rounded-md mt-1"},Oe={class:"flex flex-row space-x-4"},We={class:"flex flex-col w-3/4"},Ge={class:"ml-1 mb-1 text-xs text-gray-500"},Ke={class:"flex flex-col w-1/4"},Qe={class:"ml-1 mb-1 text-xs text-gray-500"},Xe={class:"flex flex-row h-full justify-start items-center"},He={class:"flex flex-row justify-end"},Je={key:0},Ye={key:1,class:"flex flex-row justify-center items-center space-x-1.5"},Ze={class:"flex"},es={class:"flex flex-row justify-end gap-x-2 border-t-1 border-gray-100 pt-3"},bs=Y({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(c,{emit:F}){const M=F,{t:p}=Z(),{base:v}=ee(se()),{isMobileMode:S}=te(),{$api:T,$e:x}=_e(),{copy:V}=ae(),{dashboardUrl:N}=xe(),t=b({emails:void 0,role:_.VIEWER,invitationToken:void 0}),C=b(),D=j.useForm,L=k(()=>({emails:[he]})),{validateInfos:z}=D(t.value,L);oe(()=>{var e;!t.value.emails&&((e=c.selectedUser)!=null&&e.email)&&(t.value.emails=c.selectedUser.email,t.value.role=c.selectedUser.roles)});const h=()=>{M("closed"),t.value={role:_.VIEWER}},A=async()=>{var e,i;if(x("a:user:invite",{role:t.value.role}),!!v.value.id){await((e=C.value)==null?void 0:e.validateFields());try{if((i=c.selectedUser)!=null&&i.id)await T.auth.baseUserUpdate(v.value.id,c.selectedUser.id,{roles:t.value.role,email:c.selectedUser.email,base_id:v.value.id,baseName:v.value.title}),h();else{const o=await T.auth.baseUserAdd(v.value.id,{roles:t.value.role,email:t.value.emails});t.value.invitationToken=o==null?void 0:o.invite_token}M("reload"),y.success(p("msg.success.userDetailsUpdated"))}catch(o){console.error(o),y.error(await fe(o))}}},g=k(()=>t.value.invitationToken?`${N.value}#/signup/${t.value.invitationToken}`:null),P=async()=>{if(g.value){try{await V(g.value),y.success(p("msg.success.shareableURLCopied"))}catch(e){y.error(e.message)}x("c:shared-base:copy-url")}},q=()=>{x("c:user:invite-more"),t.value.invitationToken=void 0,t.value.role=_.VIEWER,t.value.emails=void 0},R=b();return ge(k(()=>c.show),e=>{e.key==="Escape"&&h()},{immediate:!0}),le(()=>c.show,async e=>{var i,o;e&&(await ie(),(o=(i=R.value)==null?void 0:i.$el)==null||o.focus())},{immediate:!0}),(e,i)=>{const o=pe,O=we,E=be,W=ke,I=Ue,G=$e,K=Me,Q=j,X=Te,H=ye;return d(),f(H,{centered:"",visible:e.show,onCancel:h},{default:n(()=>[s("div",Ce,[s("div",Re,[a(S)?B("",!0):(d(),u("div",Ee,r(e.$t("activity.share")),1))]),s("div",Ie,[a(t).invitationToken?(d(),u("div",Be,[s("div",je,[(d(),f(w(("iconMap"in e?e.iconMap:a(U)).account))),i[2]||(i[2]=s("div",{class:"text-xs ml-0.5 mt-0.5"},"Copy Invite Token",-1))]),l(O,{class:"mt-1",type:"success","show-icon":""},{message:n(()=>[s("div",Fe,[s("div",Se,r(a(g)),1),l(o,{type:"text",class:"!rounded-md -mt-0.5",onClick:P},{icon:n(()=>[(d(),f(w(("iconMap"in e?e.iconMap:a(U)).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),s("div",Ve,r(e.$t("msg.info.userInviteNoSMTP"))+" "+r(a(t).invitationToken&&a(t).emails),1),s("div",Ne,[l(o,{size:"small",outlined:"",onClick:q},{default:n(()=>[s("div",De,[l(E,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),s("div",Le,r(e.$t("activity.inviteMore")),1)])]),_:1})])])):(d(),u("div",ze,[e.selectedUser?(d(),u("div",Ae,[(d(),f(w(("iconMap"in e?e.iconMap:a(U)).account))),s("div",Pe,r(e.selectedUser?e.$t("activity.editUser"):e.$t("activity.inviteTeam")),1)])):B("",!0),l(Q,{ref_key:"formRef",ref:C,"validate-on-rule-change":!1,model:a(t),"validate-trigger":"onBlur",onFinish:A},{default:n(()=>[s("div",qe,[s("div",Oe,[s("div",We,[l(I,ne(a(z).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:a(p)("msg.plsInputEmail")}]}),{default:n(()=>[s("div",Ge,r(e.$t("datatype.Email"))+":",1),l(W,{ref_key:"emailField",ref:R,value:a(t).emails,"onUpdate:value":i[0]||(i[0]=m=>a(t).emails=m),size:"middle","validate-trigger":"onBlur",placeholder:e.$t("labels.email"),disabled:!!e.selectedUser},null,8,["value","placeholder","disabled"])]),_:1},16,["rules"])]),s("div",Ke,[l(I,{name:"role",rules:[{required:!0,message:a(p)("msg.roleRequired")}]},{default:n(()=>[s("div",Qe,r(e.$t("labels.selectUserRole")),1),l(K,{value:a(t).role,"onUpdate:value":i[1]||(i[1]=m=>a(t).role=m),size:"middle",class:"nc-user-roles !rounded-md","dropdown-class-name":"nc-dropdown-user-role"},{default:n(()=>[(d(!0),u(re,null,de(a(_),(m,J)=>(d(),f(G,{key:J,value:m,class:"nc-role-option"},{default:n(()=>[s("div",Xe,[s("div",{class:"px-3 py-1 flex rounded-full text-xs",style:ce({backgroundColor:a(me)[m]})},r(m),5)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["rules"])])]),s("div",He,[l(o,{type:"primary","html-type":"submit",class:"!rounded-md"},{default:n(()=>[e.selectedUser?(d(),u("div",Je,r(e.$t("general.save")),1)):(d(),u("div",Ye,[l(E,{class:"flex h-[0.8rem]"}),s("div",null,r(e.$t("activity.invite")),1)]))]),_:1})])])]),_:1},8,["model"])])),s("div",Ze,[l(X)])]),s("div",es,[l(o,{key:"back",class:"!rounded-md",onClick:e.cancel},{default:n(()=>[$(r(e.$t("general.cancel")),1)]),_:1},8,["onClick"]),l(o,{class:"!rounded-md"},{default:n(()=>i[3]||(i[3]=[$("Manage base access")])),_:1}),l(o,{key:"submit",class:"!rounded-md",type:"primary",loading:e.loading},{default:n(()=>[$(r(e.$t("activity.share")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])}}});export{bs as default};
