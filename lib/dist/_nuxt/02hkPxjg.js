const __vite__fileDeps=["./DXof0zKo.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css","./D51uA4Lq.js","./DpDIhxXu.js","./BBXMuneh.js","./VirtualCell.BYk4C8Tn.css","./DQfYvTkb.js","./r2PN1Hfg.js","./CO8XXsKl.js","./vIgbYHAs.js","./boyBAVNN.js","./D7yS5JAk.js","./Cell.DUBzJZSm.css","./CJNyL6pj.js","./VirtualCell.DaTWCMZu.css","./CBOrWF0V.js","./Dqwep-0C.js","./Cell.CE2XxAOg.css","./Bys73o5q.js","./5JSD4rKf.js","./CZSp73nk.js","./D8rpj5Lr.js","./BcZAlRJW.js","./BQQOEPN4.js","./BohSct8s.js","./C8c9012h.js","./hvq8FVej.js","./Pagination.D7qN7qzC.css","./BR5dm4Ez.js","./CHLXm8Ls.js","./cCmEAZwU.js","./JRGWYtLw.js","./Bcy-XIkn.js","./DPaOlBFV.js","./BIsWr_mR.js","./BZz6iAla.js","./Pagination.Sdu4RSaT.css","./C1WkfNyL.js","./DBOeGHNL.js","./MenuItem.C7h59s4s.css","./C6pQ4eSP.js","./VVwMOds3.js","./Divider.DqtSqZhb.css","./Bxm040c6.js","./Menu.CQ8GNWeI.css","./CiTH7PYd.js","./H9SMaBKT.js","./DivDataCell.1yCNpUg3.css","./Do1LnTan.js","./UserIcon.DEVmGavY.css","./DRVKgtZT.js","./Cw6_lRNR.js","./Badge.D0-UrqG9.css","./DGBAbsZ-.js","./Cy50pBgZ.js","./links.C8uCzV-l.css","./Dwil3It4.js","./DgdUBGGc.js","./DzMG5wJt.js","./DvfxijkH.js","./BtFqRdSP.js","./BPivYv4D.js","./BK3iCpwL.js","./DFiWgQ57.js","./CAuyt8bq.js","./Tabs.DaLSLYpn.css","./WttlrBnq.js","./S1x-kZdE.js","./DeleteModal.SEMJ_gSK.css","./CpJUN2HL.js","./BcpeJQoi.js","./CnN16FGu.js","./ahvdY77A.js","./index.MCJqUXFi.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as Ge,bN as I,r as c,da as He,d9 as We,hn as Je,gD as Ke,dK as Qe,ho as Xe,dB as Ye,az as Ze,cR as et,aB as R,aF as tt,hM as ot,hL as at,hU as nt,hK as st,hh as lt,M as rt,u as it,N as ut,g as b,df as dt,ij as J,L as ct,l as mt,b1 as _t,ic as pt,H as ft,d7 as yt,O as vt,o as n,c as r,b as p,w as d,P as t,S as i,R as we,V as K,W as Q,d as T,t as X,T as w,a as m,U as Y,aa as wt,aq as v,av as S,co as gt,fP as Z,Q as F,dI as ge,hT as he,Z as g,a6 as h,$ as ht,a0 as kt,ft as xt,p as It,e as bt,_ as Rt}from"./Cgw6cdOy.js";import{_ as Vt}from"./DBOeGHNL.js";import{_ as Dt}from"./C6pQ4eSP.js";import{_ as Ct}from"./Bxm040c6.js";import{_ as Et}from"./CiTH7PYd.js";import{a as jt}from"./DFiWgQ57.js";import{a as St}from"./CrH1vpRf.js";import{u as Pt}from"./BcWX645D.js";import{D as zt,C as ke}from"./BBXMuneh.js";import{j as xe,e as At,d as Lt}from"./D7yS5JAk.js";import{i as $t}from"./C00NHga8.js";import{_ as Nt}from"./Cfg3mPCN.js";import{S as Mt}from"./cCmEAZwU.js";import{_ as Tt}from"./SnuQkHMZ.js";import"./VVwMOds3.js";import"./CO8XXsKl.js";import"./DpDIhxXu.js";import"./CHLXm8Ls.js";const Ft=g(()=>h(()=>import("./DXof0zKo.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(s=>s.default||s)),Ot=g(()=>h(()=>import("./D51uA4Lq.js"),__vite__mapDeps([3,1,2,4,5,6]),import.meta.url).then(s=>s.default||s)),Ut=g(()=>h(()=>import("./DQfYvTkb.js"),__vite__mapDeps([7,1,2,8,9,10,4,11,12,5,13]),import.meta.url).then(s=>s.default||s)),Bt=g(()=>h(()=>import("./CJNyL6pj.js"),__vite__mapDeps([14,1,2,4,12,15]),import.meta.url).then(s=>s.default||s)),qt=g(()=>h(()=>import("./CBOrWF0V.js"),__vite__mapDeps([16,1,2,17,5,18]),import.meta.url).then(s=>s.default||s)),Gt=g(()=>h(()=>import("./Bys73o5q.js"),__vite__mapDeps([19,8,9,1,2,10,4,11,12]),import.meta.url).then(s=>s.default||s)),Ht=g(()=>h(()=>import("./5JSD4rKf.js"),__vite__mapDeps([20,21,1,2,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]),import.meta.url).then(s=>s.default||s)),Wt=g(()=>h(()=>import("./C1WkfNyL.js"),__vite__mapDeps([38,1,2,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,33,34,24,27,26,35,36,56,57,58,59,60,61,9,12,62,8,10,4,11,63,64,65,66,67,68,69,70,71,72,73,31,30,74]),import.meta.url).then(s=>s.default||s)),Ie=s=>(It("data-v-f0e4ead6"),s=s(),bt(),s),Jt={class:"flex items-center gap-2"},Kt={class:"flex items-center gap-2"},Qt={key:0,class:"flex flex-col h-full"},Xt={class:"nc-gallery-container-skeleton grid gap-3 p-3"},Yt={key:1,class:"nc-gallery-container grid gap-3 p-3"},Zt=Ie(()=>m("a",null,[m("div",null,[m("div")])],-1)),eo={class:"z-10 arrow"},to={class:"z-10 arrow"},oo={key:1,class:"h-52 w-full !flex flex-row !border-b-1 !border-gray-200 items-center justify-center"},ao=Ie(()=>m("img",{class:"object-contain w-[48px] h-[48px]",src:Nt},null,-1)),no=[ao],so={class:"flex flex-col gap-3 !children:pointer-events-none"},lo={key:0,class:"nc-card-display-value-wrapper"},ro=["onClick"],io={class:"flex flex-col rounded-lg w-full"},uo={class:"flex flex-row w-full justify-start"},co={class:"nc-card-col-header w-full !children:text-gray-500"},mo={key:0,class:"flex flex-row w-full text-gray-800 items-center justify-start min-h-7 py-1"},_o={key:1,class:"flex flex-row w-full h-7 pl-1 items-center justify-start"},po={class:"flex items-center gap-2"},fo=Ge({__name:"Gallery",setup(s){const f=I(He,c()),P=I(We,c()),O=I(Je),z=I(Ke),V=I(Xe,Qe()),U=I(Ye,c(!1)),{isViewDataLoading:A}=Ze(et()),{isSqlView:ee,xWhere:be}=jt(),D=c(!1),C=c(),te=c(),{loadData:oe,paginationData:B,formattedData:q,loadGalleryData:ae,galleryData:G,changePage:Re,deleteRow:Ve,navigateToSiblingRow:ne}=St(f,P,be);R(tt,c(!1)),R(ot,c(!0)),R(at,c(!1)),R(nt,c(!1)),R(st,c(1));const se=I(lt,c([])),L=rt(),le=it(),{getPossibleAttachmentSrc:De}=Pt(),{isMobileMode:Ce}=ut(),Ee=b(()=>se.value.filter(e=>!zt(e))),y=b(()=>{var e,o;return((o=(e=f.value)==null?void 0:e.columns)==null?void 0:o.find(u=>u.pv&&se.value.includes(u)))??null}),E=b(()=>{var e,o;return(e=f.value)!=null&&e.columnsById?f.value.columnsById[(o=G.value)==null?void 0:o.fk_cover_image_col_id]:{}}),je=b(()=>{var o,u;const e=((u=dt((o=G.value)==null?void 0:o.meta))==null?void 0:u.fk_cover_image_object_fit)||J.FIT;if(e===J.FIT)return"!object-contain";if(e===J.COVER)return"!object-cover"}),{isUIAllowed:re}=ct(),Se=b(()=>re("dataEdit")),ie=c(!1),$=b({get:()=>ie.value,set:e=>{Se.value&&(ie.value=e)}}),j=c(null),Pe=(e,o)=>{ee.value||(e.preventDefault(),o&&(j.value=o))},ue=e=>{var o;if(!((o=E.value)!=null&&o.title)||!e.row[E.value.title])return[];try{const u=typeof e.row[E.value.title]=="string"?JSON.parse(e.row[E.value.title]):e.row[E.value.title];return Array.isArray(u)?u.flat().map(_=>typeof _=="string"?JSON.parse(_):_).filter(_=>_&&!Array.isArray(_)&&typeof _=="object"&&Object.keys(_).length):[]}catch{return[]}},N=(e,o)=>{const u=At(e.row,f.value.columns);te.value=o,u&&!U.value?(C.value=void 0,le.push({query:{...L.query,rowId:u}})):(C.value=e,D.value=!0)},de=async(e,o)=>{const u=e.target;u.closest(".arrow")||u.closest(".slick-dots")||N(o)},ce=async()=>{var e;N({row:{...Lt((e=f.value)==null?void 0:e.columns)},oldRow:{},rowMeta:{new:!0}})},ze=(e,o)=>{ke(e)&&o.stopPropagation()};V==null||V.on(ce),mt(()=>V.off(ce));const M=b({get(){return!!L.query.rowId},set(e){e||le.push({query:{...L.query,rowId:void 0}})}}),H=c(!1);return O==null||O.on(async()=>{await ae(),H.value=!0,_t(()=>{H.value=!1})}),z==null||z.on(async e=>{await oe({...(e==null?void 0:e.offset)!==void 0?{offset:e.offset}:{}})}),R(pt,z),ft(P,async e=>{A.value=!0;try{(e==null?void 0:e.type)===yt.GALLERY&&(await oe(),await ae())}finally{A.value=!1}},{immediate:!0}),(e,o)=>{const u=Vt,_=Dt,Ae=Ct,Le=Mt,me=ht,W=kt,$e=Ft,Ne=Tt,_e=Ot,pe=Ut,Me=Bt,Te=qt,Fe=xt,Oe=Gt,Ue=Et,Be=Ht,fe=Wt,ye=vt("e");return n(),r(v,null,[p(Ue,{visible:t($),"onUpdate:visible":o[3]||(o[3]=a=>F($)?$.value=a:null),trigger:t(ee)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:d(()=>[p(Ae,{onClick:o[2]||(o[2]=a=>$.value=!1)},{default:d(()=>{var a;return[t(j)?(n(),i(u,{key:0,onClick:o[0]||(o[0]=k=>N(t(j).row))},{default:d(()=>[we((n(),r("div",Jt,[(n(),i(K(("iconMap"in e?e.iconMap:t(Q)).expand),{class:"flex"})),T(" "+X(e.$t("activity.expandRecord")),1)])),[[ye,["a:row:expand-record"]]])]),_:1})):w("",!0),p(_),((a=t(j))==null?void 0:a.index)!==void 0?(n(),i(u,{key:1,class:"!text-red-600 !hover:bg-red-50",onClick:o[1]||(o[1]=k=>t(Ve)(t(j).index))},{default:d(()=>[we((n(),r("div",Kt,[(n(),i(K(("iconMap"in e?e.iconMap:t(Q)).delete),{class:"flex"})),T(" "+X(e.$t("activity.deleteRow")),1)])),[[ye,["a:row:delete"]]])]),_:1})):w("",!0)]}),_:1})]),default:d(()=>[m("div",{class:Y(["flex flex-col w-full nc-gallery nc-scrollbar-md bg-gray-50",{"!overflow-hidden":t(A)}]),"data-testid":"nc-gallery-wrapper",style:wt({height:t(Ce)?"calc(100% - var(--topbar-height))":"calc(100% - var(--topbar-height) + 0.6rem)"})},[t(A)?(n(),r("div",Qt,[m("div",Xt,[(n(!0),r(v,null,S(Array(20),a=>(n(),i(Le,{key:a,class:"!min-w-60.5 !h-96 !rounded-md overflow-hidden"}))),128))])])):(n(),r("div",Yt,[(n(!0),r(v,null,S(t(q),(a,k)=>(n(),r("div",{key:`record-${a.row.id}`},[p(Oe,{row:a},{default:d(()=>{var ve;return[p(Fe,{class:"!rounded-xl h-full border-gray-200 border-1 group overflow-hidden break-all max-w-[450px] cursor-pointer","body-style":{padding:"16px !important"},"data-testid":`nc-gallery-card-${a.row.id}`,onClick:l=>de(l,a),onContextmenu:l=>Pe(l,{row:a,index:k})},gt({default:d(()=>[m("div",so,[t(y)?(n(),r("h2",lo,[("isRowEmpty"in e?e.isRowEmpty:t(xe))(a,t(y))?(n(),r(v,{key:1},[T(" - ")],64)):(n(),r(v,{key:0},[t(Z)(t(y))?(n(),i(_e,{key:0,modelValue:a.row[t(y).title],"onUpdate:modelValue":l=>a.row[t(y).title]=l,class:"!text-brand-500",column:t(y),row:a},null,8,["modelValue","onUpdate:modelValue","column","row"])):(n(),i(pe,{key:1,modelValue:a.row[t(y).title],"onUpdate:modelValue":l=>a.row[t(y).title]=l,class:"!text-brand-500",column:t(y),"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))],64))])):w("",!0),(n(!0),r(v,null,S(t(Ee),l=>(n(),r("div",{key:`record-${a.row.id}-${l.id}`,class:Y({"!children:pointer-events-auto":("isButton"in e?e.isButton:t(ke))(l)}),onClick:x=>ze(l,x)},[m("div",io,[m("div",uo,[m("div",co,[t(Z)(l)?(n(),i(Me,{key:0,column:l,"hide-menu":!0},null,8,["column"])):(n(),i(Te,{key:1,column:l,"hide-menu":!0},null,8,["column"]))])]),("isRowEmpty"in e?e.isRowEmpty:t(xe))(a,l)?(n(),r("div",_o,"-")):(n(),r("div",mo,[t(Z)(l)?(n(),i(_e,{key:0,modelValue:a.row[l.title],"onUpdate:modelValue":x=>a.row[l.title]=x,column:l,row:a,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column","row"])):(n(),i(pe,{key:1,modelValue:a.row[l.title],"onUpdate:modelValue":x=>a.row[l.title]=x,column:l,"edit-enabled":!1,"read-only":!0,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column"]))]))])],10,ro))),128))])]),_:2},[(ve=t(G))!=null&&ve.fk_cover_image_col_id?{name:"cover",fn:d(()=>[!t(H)&&ue(a).length?(n(),i(Ne,{key:0,class:"gallery-carousel !border-b-1 !border-gray-200 min-h-52",arrows:""},{customPaging:d(()=>[Zt]),prevArrow:d(()=>[m("div",eo,[p(W,{type:"secondary",size:"xsmall",class:"!absolute !left-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:d(()=>[p(me,{icon:"arrowLeft",class:"text-gray-700 w-4 h-4"})]),_:1})])]),nextArrow:d(()=>[m("div",to,[p(W,{type:"secondary",size:"xsmall",class:"!absolute !right-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:d(()=>[p(me,{icon:"arrowRight",class:"text-gray-700 w-4 h-4"})]),_:1})])]),default:d(()=>[(n(!0),r(v,null,S(ue(a),(l,x)=>(n(),r(v,null,[("isImage"in e?e.isImage:t($t))(l.title,l.mimetype??l.type)?(n(),i($e,{key:`carousel-${a.row.id}-${x}`,class:Y(["h-52",[`${t(je)}`]]),srcs:t(De)(l,"card_cover"),onClick:qe=>de(qe,a)},null,8,["class","srcs","onClick"])):w("",!0)],64))),256))]),_:2},1024)):(n(),r("div",oo,no))]),key:"0"}:void 0]),1032,["data-testid","onClick","onContextmenu"])]}),_:2},1032,["row"])]))),128)),t(q).length<=4?(n(!0),r(v,{key:0},S(Array(8-t(q).length),a=>(n(),r("div",{key:a,class:"nc-empty-card"}))),128)):w("",!0)]))],6)]),_:1},8,["visible","trigger"]),p(Be,{"pagination-data":t(B),"onUpdate:paginationData":o[4]||(o[4]=a=>F(B)?B.value=a:null),"align-count-on-right":"","show-api-timing":"","change-page":t(Re),class:""},{"add-record":d(()=>[t(re)("dataInsert")?(n(),i(W,{key:0,size:"xs",type:"secondary",class:"ml-2",onClick:t(V).trigger},{default:d(()=>[m("div",po,[(n(),i(K(("iconMap"in e?e.iconMap:t(Q)).plus),{class:""})),T(" "+X(e.$t("activity.newRecord")),1)])]),_:1},8,["onClick"])):w("",!0)]),_:1},8,["pagination-data","change-page"]),(n(),i(ge,null,{default:d(()=>[t(C)&&t(D)?(n(),i(fe,{key:0,modelValue:t(D),"onUpdate:modelValue":o[5]||(o[5]=a=>F(D)?D.value=a:null),row:t(C),"load-row":!t(U),state:t(te),meta:t(f),view:t(P)},null,8,["modelValue","row","load-row","state","meta","view"])):w("",!0)]),_:1})),(n(),i(ge,null,{default:d(()=>{var a;return[t(M)&&((a=t(f))!=null&&a.id)?(n(),i(fe,{key:0,modelValue:t(M),"onUpdate:modelValue":o[6]||(o[6]=k=>F(M)?M.value=k:null),row:t(C)??{row:{},oldRow:{},rowMeta:{}},meta:t(f),"load-row":!t(U),"row-id":t(L).query.rowId,view:t(P),"show-next-prev-icons":"","expand-form":N,onNext:o[7]||(o[7]=k=>t(ne)(("NavigateDir"in e?e.NavigateDir:t(he)).NEXT)),onPrev:o[8]||(o[8]=k=>t(ne)(("NavigateDir"in e?e.NavigateDir:t(he)).PREV))},null,8,["modelValue","row","meta","load-row","row-id","view"])):w("",!0)]}),_:1}))],64)}}}),Ao=Rt(fo,[["__scopeId","data-v-f0e4ead6"]]);export{Ao as default};
