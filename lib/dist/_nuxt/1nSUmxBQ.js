const __vite__fileDeps=["./CHlP32pW.js","./D-yb_G2t.js","./CGFlARNL.js","./B2hUoZAs.js","./entry.B8GgT5QA.css","./fS-pjH0A.js","./DSjSw5ad.js","./BXXS6TCz.js","./BeKg4PXl.js","./CaxUP45y.js","./1orNHd0L.js","./BQQOEPN4.js","./R1pHeCcp.js","./BGKYJ52S.js","./C9qKCFvP.js","./Select.Ct6CicDJ.css","./D1iILnOh.js","./B_8aIjz8.js","./FieldListAutoCompleteDropdown.B9RfDcmT.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as ee,ba as me,bL as $,r as h,d0 as oe,g as B,cU as b,cV as te,hh as _e,fw as se,fI as Z,o as i,c as C,b as y,P as t,c$ as fe,d1 as ve,N as ye,H as be,h9 as H,O as ge,U as c,w as u,a as g,Y as x,V as M,W as V,al as he,am as we,t as I,S as L,R as W,Q as K,d as ke,T as Be,Z as Ce,a5 as Oe,an as X,a2 as Ge,ap as Se,$ as xe,A as Te,_ as De}from"./B2hUoZAs.js";import{_ as Me}from"./DtM1gwl8.js";import{a as ne}from"./D1iILnOh.js";import{a as re}from"./DR8NwF4k.js";import{_ as Ve}from"./BeKg4PXl.js";import{_ as Ie}from"./e4fIiYA_.js";import{a as Le}from"./Bye44sky.js";import{u as $e}from"./CR-MWfkw.js";import{g as Ne}from"./BYWCj_AN.js";import{D as Ee}from"./z-Xby7zn.js";import{S as Ue}from"./CaxUP45y.js";import"./B4WiVz4N.js";import"./CGFlARNL.js";import"./fS-pjH0A.js";import"./DSjSw5ad.js";import"./BXXS6TCz.js";import"./CGB_6kIS.js";import"./BWYzyVlv.js";import"./CwHJfKcC.js";import"./BQQOEPN4.js";import"./C9qKCFvP.js";import"./BGKYJ52S.js";import"./i4toF4kp.js";import"./kd0F6MQ0.js";import"./B_8aIjz8.js";import"./1orNHd0L.js";import"./R1pHeCcp.js";const Re={class:"nc-group-by-create-modal"},Ae=ee({__name:"CreateGroupBy",props:{isParentOpen:{type:Boolean},columns:{}},emits:["created"],setup(O,{emit:T}){const N=O,E=T,{isParentOpen:G,columns:D}=me(N),S=$(oe,h()),{showSystemFields:U,metaColumnById:_}=ne(),{groupBy:R}=re(),A=B(()=>{var l,m;return((m=D.value||((l=S.value)==null?void 0:l.columns))==null?void 0:m.filter(r=>{var w;return r.uidt===b.Links?!0:te((w=_==null?void 0:_.value)==null?void 0:w[r.id])?r!=null&&r.colOptions||_e(r)?!1:U.value:r.uidt===b.QrCode||r.uidt===b.Barcode||r.uidt===b.ID?!1:!(se(r)&&![Z.BELONGS_TO,Z.ONE_TO_ONE].includes(r.colOptions.type))}).filter(r=>!R.value.find(w=>{var p;return((p=w.column)==null?void 0:p.id)===r.id})))??[]}),a=l=>{E("created",l)};return(l,m)=>{const r=Me;return i(),C("div",Re,[y(r,{"is-parent-open":t(G),"search-input-placeholder":l.$t("msg.selectFieldToGroup"),options:t(A),"toolbar-menu":"groupBy",onSelected:a},null,8,["is-parent-open","search-input-placeholder","options"])])}}}),Fe=Ce(()=>Oe(()=>import("./CHlP32pW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url).then(O=>O.default||O)),ze={class:"flex items-center gap-1"},Pe={class:"flex items-center gap-2"},je={key:0,class:"text-capitalize !text-[13px] font-medium"},Ye={key:0,class:"bg-brand-50 text-brand-500 py-1 px-2 text-md rounded-md"},Qe={key:1,class:"flex flex-col bg-white overflow-auto nc-group-by-list menu-filter-dropdown w-100 p-4","data-testid":"nc-group-by-menu"},He={class:"w-full flex items-center justify-between gap-2"},We={class:"truncate flex-1"},Ze={class:"flex gap-1 items-center"},qe=ee({__name:"GroupByMenu",setup(O){const T=$(oe,h()),N=$(fe,h()),E=$(ve,h(!1)),{gridViewCols:G,updateGridViewColumn:D,metaColumnById:S,showSystemFields:U}=ne(),{fieldsToGroupBy:_,groupByLimit:R}=re(),{$e:A}=Te(),a=h([]),l=B(()=>{const o=[];return Object.values(G.value).forEach(e=>{e.group_by&&o.push({fk_column_id:e.fk_column_id,sort:e.group_by_sort||"asc",order:e.group_by_order||1})}),o.sort((e,s)=>e.order-s.order),o}),m=B(()=>l.value.map(o=>o.fk_column_id).filter(o=>o)),{eventBus:r}=Le(),{isMobileMode:w}=ye(),p=h(!1),q=B(()=>{var o;return((o=T.value)==null?void 0:o.columns)||[]}),ae=B(()=>q.value.reduce((o,e)=>(o[e.id]=e,o),{})),ie=B(()=>{var o;return(o=q.value)==null?void 0:o.filter(e=>{var s;return e.uidt===b.Links?!0:te((s=S==null?void 0:S.value)==null?void 0:s[e.id])?U.value:e.uidt===b.QrCode||e.uidt===b.Barcode||e.uidt===b.ID?!1:!(se(e)&&e.colOptions.type!==Z.BELONGS_TO)}).filter(e=>!l.value.find(s=>s.fk_column_id===e.id))}),le=o=>{var e;return o&&((e=ae.value[o])==null?void 0:e.uidt)||""},f=h(!1);$e(f);const k=async()=>{var o;if((o=N.value)!=null&&o.id)try{for(const e of a.value){if(!e.fk_column_id)continue;const s=G.value[e.fk_column_id];s&&(!s.group_by||s.group_by_order!==e.order||s.group_by_sort!==e.sort)&&await D(e.fk_column_id,{group_by:!0,group_by_order:e.order,group_by_sort:e.sort})}for(const e of l.value){if(!e.fk_column_id||a.value.find(v=>v.fk_column_id===e.fk_column_id))continue;const s=G.value[e.fk_column_id];s&&s.group_by&&await D(e.fk_column_id,{group_by:!1,group_by_order:void 0,group_by_sort:void 0})}A("a:group-by:update",{groupBy:l.value}),r.emit(H.GROUP_BY_RELOAD)}catch{X.error("There was an error while updating view!")}else X.error("View not found!!!")},F=o=>{a.value.push({fk_column_id:o.id,sort:"asc",order:a.value.length+1}),k(),p.value=!1},ue=async o=>{if(m.value.length===0){f.value=!1;return}const e=a.value.findIndex(s=>s.fk_column_id===o.fk_column_id);a.value.splice(+e,1),await k()};be(f,()=>{f.value?a.value=[...l.value]:p.value=!1}),r.on(async(o,e)=>{if(e!=null&&e.id){if(o===H.GROUP_BY_ADD)F(e);else if(o===H.GROUP_BY_REMOVE){if(m.value.length===0)return;a.value=a.value.filter(s=>s.fk_column_id!==e.id),await k()}}});const de=async o=>{const{newIndex:e,oldIndex:s}=o.moved,v=[...a.value],z=v.splice(s,1)[0];v.splice(e,0,z??[]);const P=v.map((j,Y)=>({...j,order:Y+1}));a.value=[...P],await k()};return(o,e)=>{const s=Ge,v=Ae,z=Fe,P=Ue,j=Ve,Y=Se,ce=xe,J=Ie,Q=ge("e");return i(),c(J,{visible:t(f),"onUpdate:visible":e[6]||(e[6]=n=>K(f)?f.value=n:null),"offset-y":"",trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-group-by-menu nc-toolbar-dropdown overflow-hidden"},{overlay:u(()=>[t(a).length?(i(),C("div",Qe,[g("div",{class:"max-h-100",onClick:e[3]||(e[3]=x(()=>{},["stop"]))},[y(t(Ee),{"model-value":t(a),"item-key":"fk_column_id","ghost-class":"bg-gray-50",onChange:e[2]||(e[2]=n=>de(n))},{item:u(({element:n})=>[(i(),C("div",{key:n.fk_column_id,class:"flex first:mb-0 !mb-1.5 !last:mb-0 items-center"},[y(s,{type:"secondary",size:"small",class:"!border-r-transparent !rounded-r-none"},{default:u(()=>[(i(),c(M(("iconMap"in o?o.iconMap:t(V)).drag)))]),_:1}),y(z,{modelValue:n.fk_column_id,"onUpdate:modelValue":d=>n.fk_column_id=d,class:"caption nc-sort-field-select !w-36",columns:t(_),"allow-empty":!0,meta:t(T),onChange:k,onClick:e[0]||(e[0]=x(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns","meta"]),y(j,{ref:"",value:n.sort,"onUpdate:value":d=>n.sort=d,class:"flex flex-grow-1 w-full nc-sort-dir-select",label:o.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir",disabled:!n.fk_column_id,onChange:k,onClick:e[1]||(e[1]=x(()=>{},["stop"]))},{default:u(()=>[(i(!0),C(he,null,we(("getSortDirectionOptions"in o?o.getSortDirectionOptions:t(Ne))(le(n.fk_column_id),!0),(d,pe)=>(i(),c(P,{key:pe,value:d.value},{default:u(()=>[g("div",He,[g("div",We,I(d.text),1),n.sort===d.value?(i(),c(M(("iconMap"in o?o.iconMap:t(V)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):L("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","label","disabled"]),y(Y,{placement:"top",title:"Remove",class:"flex-none"},{default:u(()=>[W((i(),c(s,{class:"nc-group-by-item-remove-btn !border-l-transparent !rounded-l-none min-w-40",size:"small",type:"secondary",onClick:x(d=>ue(n),["stop"])},{default:u(()=>[(i(),c(M(("iconMap"in o?o.iconMap:t(V)).deleteListItem)))]),_:2},1032,["onClick"])),[[Q,["c:group-by:remove"]]])]),_:2},1024)]))]),_:1},8,["model-value"])]),t(ie).length&&t(_).length>t(a).length&&t(a).length<t(R)?(i(),c(J,{key:0,visible:t(p),"onUpdate:visible":e[5]||(e[5]=n=>K(p)?p.value=n:null),trigger:["click"],"overlay-class-name":"nc-toolbar-dropdown"},{overlay:u(()=>[y(v,{"is-parent-open":t(p),columns:t(_),onCreated:F},null,8,["is-parent-open","columns"])]),default:u(()=>[W((i(),c(s,{type:"text",size:"small",style:{width:"fit-content"},class:"nc-add-group-by-btn mt-2 !text-brand-500",onClick:e[4]||(e[4]=x(n=>p.value=!0,["stop"]))},{default:u(()=>[g("div",Ze,[y(ce,{icon:"plus"}),ke(" "+I(o.$t("activity.addSubGroup")),1)])]),_:1})),[[Q,["c:group-by:add"]]])]),_:1},8,["visible"])):L("",!0)])):(i(),c(v,{key:0,"is-parent-open":t(f),columns:t(_),onCreated:F},null,8,["is-parent-open","columns"]))]),default:u(()=>{var n;return[g("div",{class:Be({"nc-active-btn":(n=t(m))==null?void 0:n.length})},[W((i(),c(s,{disabled:t(E),class:"nc-group-by-menu-btn nc-toolbar-btn !border-0 !h-7",size:"small",type:"secondary"},{default:u(()=>{var d;return[g("div",ze,[g("div",Pe,[(i(),c(M(("iconMap"in o?o.iconMap:t(V)).group),{class:"h-4 w-4"})),t(w)?L("",!0):(i(),C("span",je,I(o.$t("activity.group")),1))]),(d=t(m))!=null&&d.length?(i(),C("span",Ye,I(t(m).length),1)):L("",!0)])]}),_:1},8,["disabled"])),[[Q,["c:group-by"]]])],2)]}),_:1},8,["visible"])}}}),Oo=De(qe,[["__scopeId","data-v-64e2c253"]]);export{Oo as default};
