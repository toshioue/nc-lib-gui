import G from"./BV5EkxN-.js";import H from"./CtMydB5S.js";import{f as q,cX as z,a7 as E,cY as W,g as k,d2 as p,hs as A,d1 as c,fr as X,fQ as w,n as j,fO as J,o as h,S,w as V,c as K,aq as Z,av as I,P as y,a as N,V as B,U as ee,b as te,d as ae,t as F,W as le,T as se,Q as oe,a1 as re}from"./3QBYHahY.js";import{_ as ie}from"./D7hrRKCy.js";import{a as ne}from"./CfxEkdGP.js";import{i as ue,a as de}from"./DPqnb67u.js";import{S as me}from"./BEpKpjF5.js";const pe={class:"flex items-center w-full justify-between w-full gap-2 max-w-50"},ce={class:"flex gap-1.5 flex-1 items-center truncate items-center h-full"},Se=q({__name:"FieldListAutoCompleteDropdown",props:{modelValue:{},isSort:{type:Boolean},columns:{},allowEmpty:{type:Boolean},meta:{}},emits:["update:modelValue"],setup(O,{emit:R}){var M,C;const L=z(O,["modelValue","isSort","allowEmpty"]),D=R,P=E(L,"columns"),v=E(L,"meta"),{metas:Y}=W(),d=k({get:()=>O.modelValue,set:a=>D("update:modelValue",a)}),{showSystemFields:x,metaColumnById:l,fieldsMap:u,isLocalMode:T}=ne(),b=k(()=>{var a,r,i,n,m;return(m=(n=((a=P.value)==null?void 0:a.filter(e=>{var t,s,o;return!(T.value&&(e!=null&&e.id)&&u.value[e.id]&&(!((t=u.value[e.id])!=null&&t.initialShow)||!x.value&&p((s=l==null?void 0:l.value)==null?void 0:s[e.id]))||p((o=l==null?void 0:l.value)==null?void 0:o[e.id])&&A(e,v.value)||e.uidt===c.Button)}))||((i=(r=v.value)==null?void 0:r.columns)==null?void 0:i.filter(e=>{var t,s,o;return T.value&&(e!=null&&e.id)&&u.value[e.id]&&(!((t=u.value[e.id])!=null&&t.initialShow)||!x.value&&p((s=l==null?void 0:l.value)==null?void 0:s[e.id]))?!1:e.uidt===c.Links?!0:p((o=l==null?void 0:l.value)==null?void 0:o[e.id])?A(e,v.value)?!1:d.value===e.id||x.value:e.uidt===c.QrCode||e.uidt===c.Barcode||e.uidt===c.ID||e.uidt===c.Button?!1:O.isSort?!(X(e)&&e.colOptions.type!==w.BELONGS_TO):!(e.colOptions&&e.system)})))==null?void 0:n.sort((e,t)=>{var _,g;let s=0,o=0,f=0;return p(e)&&(s=1),p(t)&&(o=1),e!=null&&e.id&&(t!=null&&t.id)&&((_=u.value[e.id])==null?void 0:_.order)!==void 0&&((g=u.value[t.id])==null?void 0:g.order)!==void 0&&(f=u.value[e.id].order-u.value[t.id].order),s-o||f}))==null?void 0:m.map(e=>({value:e.id,label:e.title,icon:j(J(e)?G:H,{columnMeta:e}),c:e}))}),Q=(a,r)=>{var i;return(i=r.label.toLowerCase())==null?void 0:i.includes(a.toLowerCase())};!d.value&&O.allowEmpty!==!0&&(d.value=((C=(M=b.value)==null?void 0:M[0])==null?void 0:C.value)||"");const U={[w.BELONGS_TO]:"text-blue-500",[w.ONE_TO_ONE]:"text-purple-500",[w.HAS_MANY]:"text-orange-500",[w.MANY_TO_MANY]:"text-pink-500"},$=k(()=>{var a,r;return((r=(a=v.value)==null?void 0:a.columns)==null?void 0:r.reduce((i,n)=>{var m,e,t,s;if(n&&ue(n)||de(n)){const o=(t=(e=(m=Y.value)==null?void 0:m[v.value.id])==null?void 0:e.columns)==null?void 0:t.find(f=>{var _;return f.id===((_=n.colOptions)==null?void 0:_.fk_relation_column_id)});o&&(i[n.id]=U[(s=o.colOptions)==null?void 0:s.type])}return i},{}))||{}});return(a,r)=>{const i=re,n=me,m=ie;return h(),S(m,{value:y(d),"onUpdate:value":r[0]||(r[0]=e=>oe(d)?d.value=e:null),"dropdown-match-select-width":!1,"show-search":"",placeholder:a.$t("placeholder.selectField"),"filter-option":Q,"dropdown-class-name":"nc-dropdown-toolbar-field-list"},{default:V(()=>[(h(!0),K(Z,null,I(y(b),e=>(h(),S(n,{key:e.value,label:e.label,value:e.value},{default:V(()=>[N("div",pe,[N("div",ce,[(h(),S(B(e.icon),{class:ee(["!w-3.5 !h-3.5 !mx-0",y($)[e.value]||"!text-gray-500"])},null,8,["class"])),te(i,{style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},class:"max-w-[15rem] truncate select-none","show-on-truncate-only":""},{title:V(()=>[ae(F(e.label),1)]),default:V(()=>[N("span",null,F(e.label),1)]),_:2},1024)]),y(d)===e.value?(h(),S(B(("iconMap"in a?a.iconMap:y(le)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):se("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["value","placeholder"])}}});export{Se as _};
