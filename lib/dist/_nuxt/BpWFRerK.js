const __vite__fileDeps=["./B2oiPo1U.js","./3QBYHahY.js","./entry.Ic44fwRn.css","./C2piJvdv.js","./cVaGn03F.js","./LockType.C1lKbPeu.css","./CQG617t7.js","./P3kwmRxC.js","./CWtzMcwx.js","./DAKhk9t6.js","./Bk0xUMNV.js","./CGxepfeV.js","./xnDaHwV-.js","./wEQwkVjR.js","./ceYq-xax.js","./CmN9vPg3.js","./BQQOEPN4.js","./kHOslGNR.js","./DPgYHC40.js","./BsWDDIqE.js","./Dg1gNFnz.js","./Ci1lK5Ee.js","./CyuhXrst.js","./Cu_tC_Dm.js","./CdYx1kPu.js","./3ezdMRmZ.js","./QuickImport.nWfi1EI3.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as ne,cX as xe,ad as we,cQ as ie,cZ as Le,r as j,at as Me,g as E,F as Se,b1 as Te,o as i,S as w,w as o,a as y,b as a,t as r,P as e,a9 as De,aL as Re,Y as Ee,d as v,Q as ye,aj as q,ak as le,d7 as be,a0 as ke,A as re,_ as ge,cU as $e,ar as je,c as p,T as h,L as Ue,bN as Oe,dA as Pe,ai as ze,az as _e,cM as Ae,dB as $,as as Fe,O as Ne,aq as x,d6 as S,R as J,av as ve,U as Be,V as Ge,W as Qe,$ as qe,a1 as Ke,ab as Ze,Z as ce,a6 as de,p as We,e as Xe}from"./3QBYHahY.js";import{_ as Ye}from"./C95Svpv6.js";import{F as fe}from"./DAKhk9t6.js";import{_ as He}from"./BsWDDIqE.js";import"./kHOslGNR.js";import{_ as Je}from"./Bk0xUMNV.js";import{_ as et}from"./BkiSZLeF.js";import{_ as tt}from"./DQEIlAel.js";import{_ as ot}from"./leimKhvx.js";import{_ as at}from"./DdUr8XSo.js";import{_ as st}from"./CoNP9Geb.js";import{_ as it}from"./PcgFfkcK.js";import{u as nt}from"./BVQBF9Vn.js";const lt={class:"flex flex-row items-center gap-x-2"},rt={class:"text-gray-900 font-semibold"},ct={class:"mt-1"},dt={class:"flex flex-row justify-end gap-x-2 mt-5"},ut=ne({__name:"ViewDescriptionUpdate",props:{modelValue:{type:Boolean},view:{},sourceId:{}},emits:["update:modelValue","updated"],setup(n,{emit:U}){const u=xe(n,["view"]),b=U,{$e:C,$api:L}=re(),m=we(u,"modelValue",b),{loadViews:O}=ie(),{addUndo:T,defineProjectScope:P}=Le(),s=j(),_=j(!1),z=fe.useForm,d=Me({description:""}),A=E(()=>({description:[{validator:(c,l)=>new Promise((I,F)=>{I()})}]})),{validateInfos:K}=z(d,A);Se(()=>{var c;(c=n.view)!=null&&c.description&&(d.description=`${n.view.description}`),Te(()=>{var I;const l=(I=s.value)==null?void 0:I.$el;l&&(l.setSelectionRange(0,d.description.length),l.focus())})},{flush:"post"});const D=async(c=!1)=>{if(n.view){d.description&&(d.description=d.description.trim()),_.value=!0;try{await L.dbView.update(n.view.id,{description:d.description}),m.value=!1,c||T({redo:{fn:l=>{d.description=l,D(!0,!0)},args:[d.description]},undo:{fn:l=>{d.description=l,D(!0,!0)},args:[n.view.description]},scope:P({view:n.view})}),await O({tableId:n.view.fk_model_id,ignoreLoading:!0,force:!0}),C("a:view:description:update"),m.value=!1}catch(l){q.error(await le(l))}_.value=!1}};return(c,l)=>{const I=be,F=He,ee=Je,te=fe,N=ke,B=Ye;return i(),w(B,{visible:e(m),"onUpdate:visible":l[4]||(l[4]=V=>ye(m)?m.value=V:null),size:"small","show-separator":!1},{header:o(()=>{var V;return[y("div",lt,[a(I,{meta:c.view,class:"mt-0.5 !text-2xl"},null,8,["meta"]),y("span",rt,r((V=c.view)==null?void 0:V.title),1)])]}),default:o(()=>{var V,G,Z,W;return[y("div",ct,[a(te,{layout:"vertical",model:e(d),name:"create-new-table-form"},{default:o(()=>[a(ee,De({label:c.$t("labels.description")},e(K).description),{default:o(()=>[a(F,{ref_key:"inputEl",ref:s,value:e(d).description,"onUpdate:value":l[0]||(l[0]=X=>e(d).description=X),class:"nc-input-sm !py-2 nc-text-area !text-gray-800 nc-input-shadow","hide-details":"",size:"small",placeholder:c.$t("msg.info.enterTableDescription"),onKeydown:l[1]||(l[1]=Re(Ee(()=>D(),["exact"]),["enter"]))},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1},8,["model"]),y("div",dt,[a(N,{type:"secondary",size:"small",onClick:l[2]||(l[2]=X=>m.value=!1)},{default:o(()=>[v(r(c.$t("general.cancel")),1)]),_:1}),a(N,{key:"submit",type:"primary",size:"small",disabled:((G=(V=e(K))==null?void 0:V.description)==null?void 0:G.validateStatus)==="error"||((Z=e(d).description)==null?void 0:Z.trim())===((W=c.view)==null?void 0:W.description),loading:e(_),onClick:l[3]||(l[3]=()=>D())},{default:o(()=>[v(r(c.$t("general.save")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),Gt=ge(ut,[["__scopeId","data-v-b1252ebc"]]),pt={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700"},mt={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-3",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},_t={key:0},vt={key:1},Qt=ne({__name:"ViewDelete",props:{modelValue:{type:Boolean},view:{}},emits:["update:modelValue","deleted"],setup(n,{emit:U}){const u=n,b=U,{refreshCommandPalette:C}=$e(),{view:L}=u,m=we(u,"modelValue",b),{api:O}=je(),{$e:T}=re();async function P(){if(u.view)try{await O.dbView.delete(u.view.id),m.value=!1,b("deleted"),T("a:view:delete",{view:u.view.type})}catch(s){q.error(await le(s))}finally{C()}}return(s,_)=>{const z=be,d=et;return i(),w(d,{visible:e(m),"onUpdate:visible":_[0]||(_[0]=A=>ye(m)?m.value=A:null),"entity-name":s.$t("objects.view"),"on-delete":P},{"entity-preview":o(()=>[e(L)?(i(),p("div",pt,[a(z,{meta:u.view,class:"nc-view-icon w-4 min-h-4"},null,8,["meta"]),y("div",mt,[e(L).is_default?(i(),p("span",_t,r(s.$t("labels.defaultView")),1)):(i(),p("span",vt,r(e(L).title),1))])])):h("",!0)]),_:1},8,["visible","entity-name"])}}}),ft=ce(()=>de(()=>import("./B2oiPo1U.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(n=>n.default||n)),wt=ce(()=>de(()=>import("./cVaGn03F.js"),__vite__mapDeps([4,1,2,5]),import.meta.url).then(n=>n.default||n)),yt=ce(()=>de(()=>import("./CQG617t7.js").then(n=>n.Q),__vite__mapDeps([6,1,2,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url).then(n=>n.default||n)),bt=n=>(We("data-v-391f8735"),n=n(),Xe(),n),kt={class:"flex text-xs font-bold text-gray-500 ml-1"},gt={class:"nc-base-menu-item group"},$t={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},ht={class:"nc-base-menu-item group nc-view-context-download-option"},Ct={class:"flex flex-row items-center gap-x-3"},It={class:"nc-base-menu-item flex !flex-shrink group !py-1 !px-1 rounded-md bg-brand-50"},Vt=bt(()=>y("div",{class:"flex flex-grow"},null,-1)),xt={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},Lt={key:1},Mt=ne({__name:"ViewActionMenu",props:{view:{},table:{},inSidebar:{type:Boolean,default:!1}},emits:["rename","closeModal","delete","descriptionUpdate"],setup(n,{emit:U}){const u=n,b=U,{isUIAllowed:C,isDataReadOnly:L}=Ue(),m=Oe(Pe,j(!1)),{$api:O,$e:T}=re(),{t:P}=ze(),s=E(()=>u.view),_=E(()=>u.table),{viewsByTable:z}=_e(ie()),{loadViews:d,navigateToView:A}=ie(),{base:K}=_e(Ae()),{refreshCommandPalette:D}=$e(),c=E(()=>{var t;return((t=s.value)==null?void 0:t.lock_type)||$.Collaborative}),l=E(()=>z.value.get(_.value.id)),I=j(!1),F=E(()=>{var t;return(t=_.value)==null?void 0:t.source_id}),ee=()=>{b("rename")},te=()=>{b("descriptionUpdate")},N=["csv","excel"],B=N.reduce((t,g)=>(t[g]=j(!1),t),{}),V=t=>{c.value!==$.Locked&&(b("closeModal"),t.value=!0)};async function G(t){if(T("a:grid:lockmenu",{lockType:t,sidebar:u.inSidebar}),!!s.value){if(t==="personal")return q.info(P("msg.toast.futureRelease"));try{s.value.lock_type=t,await O.dbView.update(s.value.id,{lock_type:t}),q.success(`Successfully Switched to ${t} view`)}catch(g){q.error(await le(g))}b("closeModal")}}function Z(){b("closeModal");const t=j(!0),{close:g}=nt(tt,{modelValue:t,title:s.value.title,type:s.value.type,tableId:_.value.id,selectedViewId:s.value.id,groupingFieldColumnId:s.value.view.fk_grp_col_id,views:l,description:s.value.description,calendarRange:s.value.view.calendar_range,coverImageColumnId:s.value.view.fk_cover_image_col_id,"onUpdate:modelValue":f,onCreated:async Q=>{f(),D(),await d({force:!0,tableId:_.value.id}),A({view:Q,tableId:_.value.id,baseId:K.value.id,hardReload:Q.type===S.FORM}),T("a:view:create",{view:Q.type,sidebar:u.inSidebar})}});function f(){t.value=!1,g(1e3)}}const{copy:W}=Fe(),X=async()=>{await W(s.value.id),I.value=!0},he=async()=>{b("delete")};return(t,g)=>{const f=qe,Q=ke,oe=Ke,Y=ot,M=at,ae=st,Ce=ft,se=wt,ue=Ze,Ie=yt,Ve=it,H=Ne("e");return e(s)?(i(),w(Ve,{key:0,"data-testid":`view-sidebar-view-actions-${e(s).alias||e(s).title}`,class:"!min-w-70","data-id":"toolbar-actions"},{default:o(()=>{var pe,me;return[a(oe,null,{title:o(()=>[v(r(t.$t("labels.clickToCopyViewID")),1)]),default:o(()=>{var k;return[y("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:X},[y("div",kt,r(t.$t("labels.viewIdColon",{viewId:(k=e(s))==null?void 0:k.id})),1),a(Q,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(I)?(i(),w(f,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(i(),w(f,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),!((pe=e(s))!=null&&pe.is_default)&&e(C)("viewCreateOrEdit")?(i(),p(x,{key:0},[a(Y),t.inSidebar?(i(),p(x,{key:0},[e(c)!==e($).Locked?(i(),w(M,{key:0,onClick:ee},{default:o(()=>[a(f,{icon:"rename"}),v(" "+r(t.$t("general.renameEntity",{entity:e(s).type!==e(S).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})):(i(),w(oe,{key:1},{title:o(()=>[v(r(t.$t("msg.info.disabledAsViewLocked")),1)]),default:o(()=>[a(M,{class:"!cursor-not-allowed !text-gray-400"},{default:o(()=>[a(f,{icon:"rename"}),v(" "+r(t.$t("general.renameEntity",{entity:e(s).type!==e(S).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})]),_:1})),e(c)!==e($).Locked?(i(),w(M,{key:2,onClick:te},{default:o(()=>[a(f,{icon:"ncAlignLeft"}),v(" "+r(t.$t("general.edit"))+" "+r(t.$t("labels.description")),1)]),_:1})):h("",!0)],64)):h("",!0),a(M,{onClick:Z},{default:o(()=>[a(f,{class:"nc-view-copy-icon",icon:"duplicate"}),v(" "+r(t.$t("general.duplicateEntity",{entity:e(s).type!==e(S).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})],64)):h("",!0),e(s).type!==e(S).FORM?(i(),p(x,{key:1},[a(Y),e(C)("csvTableImport")&&!e(m)&&!e(L)?(i(),w(ae,{key:"upload"},{title:o(()=>[J((i(),p("div",gt,[a(f,{icon:"upload"}),v(" "+r(t.$t("general.upload")),1)])),[[H,["c:navdraw:preview-as",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>[]),default:o(()=>[y("div",$t,r(t.$t("activity.uploadData")),1),(i(!0),p(x,null,ve(e(B),(k,R)=>(i(),p(x,null,[e(C)(`${R}TableImport`)&&!e(m)?(i(),w(M,{key:R,onClick:St=>V(k)},{default:o(()=>[J((i(),p("div",{class:Be([{disabled:e(c)===e($).Locked},"nc-base-menu-item"])},[(i(),w(Ge(("iconMap"in t?t.iconMap:e(Qe)).cloudUpload))),v(" "+r(`${t.$t("general.upload")} ${R.toUpperCase()}`),1)],2)),[[H,[`a:upload:${R}`,{sidebar:u.inSidebar}]]])]),_:2},1032,["onClick"])):h("",!0)],64))),256))]),_:1})):h("",!0),a(ae,{key:"download"},{title:o(()=>[J((i(),p("div",ht,[a(f,{icon:"download"}),v(" "+r(t.$t("general.download")),1)])),[[H,["c:download",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>[]),default:o(()=>[a(Ce)]),_:1})],64)):h("",!0),e(C)("viewCreateOrEdit")?(i(),p(x,{key:2},[a(Y),a(ae,{key:"lock-type",class:"scrollbar-thin-dull max-h-90vh overflow-auto !py-0"},{title:o(()=>[J((i(),p("div",Ct,[y("div",null,r(t.$t("labels.viewMode")),1),y("div",It,[a(se,{type:e(c),class:"flex nc-view-actions-lock-type !text-brand-500 !flex-shrink","hide-tick":""},null,8,["type"])]),Vt])),[[H,["c:navdraw:preview-as",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>[]),default:o(()=>[y("div",xt,r(t.$t("labels.viewMode")),1),a(ue,{class:"!mx-1 !py-2 !rounded-md nc-view-action-lock-subaction max-w-[100px]"},{default:o(()=>[a(se,{type:e($).Collaborative,onClick:g[0]||(g[0]=k=>G(e($).Collaborative))},null,8,["type"])]),_:1}),a(ue,{class:"!mx-1 !py-2 !rounded-md nc-view-action-lock-subaction"},{default:o(()=>[a(se,{type:e($).Locked,onClick:g[1]||(g[1]=k=>G(e($).Locked))},null,8,["type"])]),_:1})]),_:1})],64)):h("",!0),!e(s).is_default&&e(C)("viewCreateOrEdit")?(i(),p(x,{key:3},[a(Y),e(c)===e($).Locked?(i(),w(oe,{key:0},{title:o(()=>[v(r(t.$t("msg.info.disabledAsViewLocked")),1)]),default:o(()=>[a(M,{class:"!cursor-not-allowed !text-gray-400"},{default:o(()=>[a(f,{class:"nc-view-delete-icon",icon:"delete"}),v(" "+r(t.$t("general.deleteEntity",{entity:e(s).type!==e(S).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})]),_:1})):(i(),w(M,{key:1,class:"!hover:bg-red-50 !text-red-500",onClick:he},{default:o(()=>[a(f,{class:"nc-view-delete-icon",icon:"delete"}),v(" "+r(t.$t("general.deleteEntity",{entity:e(s).type!==e(S).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1}))],64)):h("",!0),(me=e(_))!=null&&me.base_id&&e(F)?(i(),p(x,{key:4},ve(N,k=>a(Ie,{key:k,modelValue:e(B)[k].value,"onUpdate:modelValue":R=>e(B)[k].value=R,"import-data-only":!0,"import-type":k,"base-id":e(_).base_id,"source-id":e(F)},null,8,["modelValue","onUpdate:modelValue","import-type","base-id","source-id"])),64)):h("",!0)]}),_:1},8,["data-testid"])):(i(),p("span",Lt))}}}),qt=ge(Mt,[["__scopeId","data-v-391f8735"]]);export{qt as _,Qt as a,Gt as b};
