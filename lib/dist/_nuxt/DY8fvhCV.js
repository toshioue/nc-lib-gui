import{f as Ce,az as I,cR as Me,r as p,cQ as He,ai as Te,n as De,bV as We,g as $,H as S,b1 as Be,i as Oe,O as Ie,o as l,c as m,a as c,P as o,b as n,w as i,Q as C,d as f,t as r,B as Se,dq as Ne,R as N,S as _,Y as G,T as y,aq as q,cr as je,V as Q,W as E,aj as ze,$ as Ue,a0 as Ve,a1 as Le,h0 as Re,dr as Ye,_ as Ge}from"./3QBYHahY.js";import{_ as qe}from"./4uOUlFJU.js";import{_ as Qe}from"./DdUr8XSo.js";import{_ as Ee}from"./PcgFfkcK.js";import{_ as Fe}from"./Kma333Sh.js";import{_ as Pe}from"./5_MZ2zba.js";import{_ as Ae}from"./BkiSZLeF.js";import{u as F,_ as Je}from"./CtQJu3r-.js";import{u as Ke}from"./CUFZaymE.js";import"./kHOslGNR.js";import{I as Xe}from"./CmN9vPg3.js";import"./DD1BMgnW.js";import"./xnDaHwV-.js";import"./CJ26qO3d.js";import"./CsJPQclb.js";import"./2yzrrcqg.js";import"./DHn6lT7K.js";import"./C95Svpv6.js";import"./CWtzMcwx.js";import"./DAKhk9t6.js";import"./Bk0xUMNV.js";import"./CGxepfeV.js";import"./wEQwkVjR.js";import"./BEpKpjF5.js";import"./BQQOEPN4.js";import"./3ezdMRmZ.js";import"./DPgYHC40.js";import"./BsWDDIqE.js";import"./ceYq-xax.js";const Ze={class:"nc-webhook-wrapper w-full p-4"},et={class:"max-w-250 h-full w-full mx-auto"},tt={key:0},ot={class:"w-full mb-4 flex justify-between gap-3"},at={class:"flex-1 flex gap-2"},nt={class:"flex items-center gap-2"},st={class:"flex gap-2 items-center"},lt={style:{height:"calc(100vh - (var(--topbar-height) * 3.5))"},class:""},it={key:0,class:"flex-col flex items-center gap-6 justify-center w-full h-full py-12 px-4 border-1 rounded-xl border-gray-200"},rt={class:"text-gray-700 font-bold text-center text-2xl"},ct={class:"text-gray-700 text-center max-w-[24rem]"},dt={class:"flex items-center gap-2"},ut={class:"text-red-500"},pt={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700 mb-4"},mt={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-2.5",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},vt={key:1,class:"text-small leading-[18px] mb-2 text-gray-500"},ft={key:1,class:"h-full w-full flex flex-col justify-center items-center",style:{height:"calc(100vh - (var(--topbar-height) * 2))"}},_t=Ce({__name:"Webhooks",setup(yt){const{activeTable:j}=I(Me()),{sorts:P,sortDirection:A,loadSorts:J,handleGetSortedData:K,saveOrUpdate:z}=Ke("Webhook"),b=p(),{hooks:M,isHooksLoading:X}=I(F()),{loadHooksList:Z,deleteHook:ee,copyHook:te,saveHooks:oe}=F(),{activeView:ae}=I(He()),{t:a}=Te(),v=p(!1),ne=p(null),se=De(We,{style:{fontSize:"2.5rem"},spin:!0}),k=p(""),g=p(!1),U=p(!1),H=$(()=>M.value.find(e=>e.id===k.value)),le=async()=>{if(U.value=!0,!!k.value)try{await ee(k.value)}finally{U.value=!1,g.value=!1,k.value=""}},ie=p(void 0),T=p(!1),re=async e=>{if(!T.value){T.value=!0;try{await te(e)}finally{T.value=!1}}},ce=e=>{k.value=e,g.value=!0},h=p(""),de=$(()=>M.value.filter(e=>{var t;return(t=e.title)==null?void 0:t.toLowerCase().includes(h.value.toLowerCase())})),ue=$(()=>K(de.value,P.value));S(g,()=>{g.value&&Be(()=>{var e,t;(t=(e=ne.value)==null?void 0:e.$el)==null||t.focus()})}),S(v,e=>{e||(b.value=void 0)}),S(()=>{var e;return(e=j.value)==null?void 0:e.id},async()=>{var e;(e=j.value)!=null&&e.id&&(ie.value=void 0,await Z())},{immediate:!0});const pe=async e=>{if(e.event==="manual"&&e.operation==="trigger"){ze.error(a("msg.error.manualTriggerHook"));return}const t=Object.assign({},e);e.active=!e.active,await oe({hook:e,ogHook:t})},V=async()=>{v.value=!0},L=e=>{b.value=e,v.value=!0},me=()=>{v.value=!1,b.value=void 0};Oe(async()=>{J()});const D=$({get:()=>A.value,set:e=>{if(Object.keys(e).length===0){z({});return}const[t,d]=Object.entries(e)[0];z({field:t,direction:d})}}),R=p([{text:[a("general.on"),a("labels.recordInsert")],value:["after","insert"]},{text:[a("general.on"),a("labels.recordUpdate")],value:["after","update"]},{text:[a("general.on"),a("labels.recordDelete")],value:["after","delete"]},{text:[a("general.onMultiple"),a("labels.recordInsert")],value:["after","bulkInsert"]},{text:[a("general.onMultiple"),a("labels.recordUpdate")],value:["after","bulkUpdate"]},{text:[a("general.onMultiple"),a("labels.recordDelete")],value:["after","bulkDelete"]},{text:[a("general.manual"),a("general.trigger")],value:["manual","trigger"]}]),ve=[{key:"active",title:a("general.active"),width:90,minWidth:90},{key:"name",title:a("general.name"),minWidth:252,showOrderBy:!0,dataIndex:"title"},{key:"type",title:a("general.type"),basis:"25%",minWidth:200,showOrderBy:!0,dataIndex:"webhook-operation-type"},{key:"created_at",title:a("labels.addedOn"),width:180,minWidth:180,showOrderBy:!0,dataIndex:"created_at"},{key:"action",title:"",width:80,minWidth:80}],fe=e=>({onClick:()=>L(e)}),_e=e=>{var t,d;return((d=(t=R.value.find(w=>w.value.includes(e.event)&&w.value.includes(e.operation)))==null?void 0:t.text)==null?void 0:d.join(" "))||`Before ${e.operation}`};return(e,t)=>{const d=Ue,w=Xe,x=Ve,ye=qe,Y=Le,W=Qe,ge=Re,ke=Ee,be=Fe,he=Pe,we=Ae,xe=Je,$e=Ye,B=Ie("e");return l(),m("div",Ze,[c("div",et,[o(ae)&&!o(X)?(l(),m("div",tt,[c("div",ot,[c("div",at,[n(w,{value:o(h),"onUpdate:value":t[0]||(t[0]=s=>C(h)?h.value=s:null),class:"w-full nc-input-sm nc-input-border-on-value !max-w-84",size:"small",placeholder:e.$t("title.searchWebhook"),"allow-clear":""},{prefix:i(()=>[n(d,{icon:"search",class:"mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value","placeholder"]),n(x,{class:"px-2",type:"text",size:"small",onClick:t[1]||(t[1]=s=>("navigateTo"in e?e.navigateTo:o(Se))("https://docs.nocodb.com/category/webhook/",{open:"navigateToBlankTargetOpenOption"in e?e.navigateToBlankTargetOpenOption:o(Ne)}))},{default:i(()=>[c("div",nt,[f(r(e.$t("title.docs"))+" ",1),n(d,{icon:"externalLink"})])]),_:1})]),N((l(),_(x,{type:"secondary",size:"small",class:"!text-brand-500 !hover:text-brand-600","data-testid":"nc-new-webhook",onClick:V},{default:i(()=>[c("div",st,[n(d,{icon:"plus"}),f(" "+r(e.$t("activity.newWebhook")),1)])]),_:1})),[[B,["c:actions:webhook"]]])]),c("div",lt,[o(M).length?(l(),_(he,{key:1,"order-by":o(D),"onUpdate:orderBy":t[4]||(t[4]=s=>C(D)?D.value=s:null),columns:ve,data:o(ue),"custom-row":fe,class:"h-full","body-row-class-name":"nc-view-sidebar-webhook-item"},{bodyCell:i(({column:s,record:u})=>[n(Y,{disabled:u.event!=="manual"},{title:i(()=>[f(r(e.$t("msg.error.manualTriggerHook")),1)]),default:i(()=>[s.key==="active"?N((l(),m("div",{key:0,onClick:t[2]||(t[2]=G(()=>{},["stop"]))},[n(ye,{size:"small",disabled:u.event==="manual",checked:!!u.active,onChange:O=>pe(u)},null,8,["disabled","checked","onChange"])])),[[B,["c:actions:webhook"]]]):y("",!0)]),_:2},1032,["disabled"]),s.key==="name"?(l(),_(Y,{key:0,class:"truncate max-w-full text-gray-800 font-semibold text-sm","show-on-truncate-only":""},{title:i(()=>[f(r(u.title),1)]),default:i(()=>[f(r(u.title)+" ",1)]),_:2},1024)):y("",!0),s.key==="type"?(l(),m(q,{key:1},[f(r(_e(u)),1)],64)):y("",!0),s.key==="created_at"?(l(),m(q,{key:2},[f(r(o(je)(u.created_at).format("DD MMM YYYY")),1)],64)):y("",!0),s.key==="action"?(l(),_(be,{key:3,"overlay-class-name":"nc-webhook-item-action-dropdown"},{overlay:i(()=>[n(ke,{class:"w-48"},{default:i(()=>[n(W,{key:"edit","data-testid":"nc-webhook-item-action-edit",onClick:O=>L(u)},{default:i(()=>[n(d,{icon:"edit",class:"text-gray-800"}),c("span",null,r(e.$t("general.edit")),1)]),_:2},1032,["onClick"]),n(W,{key:"duplicate","data-testid":"nc-webhook-item-action-duplicate",onClick:O=>re(u)},{default:i(()=>[n(d,{icon:"duplicate",class:"text-gray-800"}),c("span",null,r(e.$t("general.duplicate")),1)]),_:2},1032,["onClick"]),n(ge,{class:"my-1.5"}),n(W,{key:"delete",class:"!hover:bg-red-50","data-testid":"nc-webhook-item-action-delete",onClick:O=>ce(u.id)},{default:i(()=>[c("div",ut,[n(d,{icon:"delete",class:"group-hover:text-accent -ml-0.25 -mt-0.75 mr-0.5"}),f(" "+r(e.$t("general.delete")),1)])]),_:2},1032,["onClick"])]),_:2},1024)]),default:i(()=>[n(x,{type:"secondary",size:"small",class:"!w-8 !h-8","data-testid":"nc-webhook-item-action",onClick:t[3]||(t[3]=G(()=>{},["stop"]))},{default:i(()=>[(l(),_(Q(("iconMap"in e?e.iconMap:o(E)).threeDotVertical),{class:"text-gray-700"}))]),_:1})]),_:2},1024)):y("",!0)]),_:1},8,["order-by","data"])):(l(),m("div",it,[c("div",rt,r(e.$t("msg.createWebhookMsg1")),1),c("div",ct,r(e.$t("msg.createWebhookMsg2")),1),N((l(),_(x,{class:"flex max-w-40",type:"primary",size:"small",onClick:V},{default:i(()=>[c("div",dt,[n(d,{icon:"plus",class:"flex-none"}),c("span",null,r(e.$t("activity.newWebhook")),1)])]),_:1})),[[B,["c:actions:webhook"]]])]))]),n(we,{visible:o(g),"onUpdate:visible":t[5]||(t[5]=s=>C(g)?g.value=s:null),"entity-name":e.$t("objects.webhook"),"on-delete":le},{"entity-preview":i(()=>{var s;return[o(H)?(l(),m("div",pt,[(l(),_(Q(("iconMap"in e?e.iconMap:o(E)).hook),{class:"text-gray-600"})),c("div",mt,r(o(H).title),1)])):y("",!0),((s=o(H))==null?void 0:s.event)==="manual"?(l(),m("span",vt,r(e.$t("msg.warning.webhookDelete")),1)):y("",!0)]}),_:1},8,["visible","entity-name"]),o(v)?(l(),_(xe,{key:0,value:o(v),"onUpdate:value":t[6]||(t[6]=s=>C(v)?v.value=s:null),hook:o(b),"event-list":o(R),onClose:me},null,8,["value","hook","event-list"])):y("",!0)])):(l(),m("div",ft,[n($e,{size:"large",indicator:o(se)},null,8,["indicator"])]))])])}}}),Ft=Ge(_t,[["__scopeId","data-v-23f273e2"]]);export{Ft as default};
