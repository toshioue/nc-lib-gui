const __vite__fileDeps=["./DPiqpjtP.js","./BLdk6lRf.js","./entry.B8GgT5QA.css","./CwyeWFQa.js","./BrF0EXdL.js","./CBNgcPSC.js","./BQQOEPN4.js","./DTv03lbO.js","./C-Z2v8Hi.js","./BD_L_KCX.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as X,ai as Y,at as ee,cB as se,N as te,ah as ae,r as g,fW as _,g as k,i as oe,H as le,a_ as ie,o as r,U as f,w as i,a as s,P as a,c as u,t as n,S as I,V as w,W as U,b as l,a7 as ne,al as re,am as ce,a8 as de,fZ as me,d as M,Z as ue,a5 as ve,an as y,ao as fe,aS as pe,A as _e}from"./BLdk6lRf.js";import{_ as ye}from"./B0-3_x1m.js";import{u as he}from"./CwyeWFQa.js";import{g as xe}from"./DD6KJAAC.js";import{u as be}from"./CdmoJR0j.js";import{_ as ge}from"./DbqyGbkB.js";import{F as S}from"./JCToPTxN.js";import"./JimKVLH8.js";import{I as ke}from"./DWFLnnq8.js";import{_ as we}from"./B2oTMMt7.js";import{_ as Ue}from"./BLwY008C.js";import{S as Me,_ as $e}from"./BrF0EXdL.js";import"./wBAlULwF.js";import"./BD_L_KCX.js";import"./C-Z2v8Hi.js";import"./BTh9o-aK.js";import"./BQQOEPN4.js";import"./ETGzLqdt.js";import"./CBNgcPSC.js";import"./DTv03lbO.js";const Ce=ue(()=>ve(()=>import("./DPiqpjtP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url).then(c=>c.default||c)),Te={class:"flex flex-col p-6","data-testid":"invite-user-and-share-base-modal"},Ee={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 border-gray-100 w-full"},Re={key:0,class:"select-none font-medium"},Be={class:"px-2 mt-1.5"},Ie={key:0,class:"flex flex-col mt-1 border-b-1 pb-5"},Se={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},je=s("div",{class:"text-xs ml-0.5 mt-0.5"},"Copy Invite Token",-1),Ve={class:"flex flex-row justify-between items-center py-1"},Fe={class:"flex pl-2 text-green-700 text-xs","data-testid":"invite-modal-invitation-url"},Ne={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2"},ze={class:"flex flex-row justify-start mt-4 ml-2"},Ae={class:"flex flex-row justify-center items-center space-x-0.5"},De={class:"text-xs text-gray-600"},Pe={key:1,class:"flex flex-col pb-4"},Le={key:0,class:"flex flex-row items-center pl-2 pb-1 h-[1rem]"},We={class:"text-xs ml-0.5 mt-0.5"},qe={class:"border-1 py-3 px-4 rounded-md mt-1"},Oe={class:"flex flex-row space-x-4"},Ge={class:"flex flex-col w-3/4"},Ze={class:"ml-1 mb-1 text-xs text-gray-500"},He={class:"flex flex-col w-1/4"},Ke={class:"ml-1 mb-1 text-xs text-gray-500"},Je={class:"flex flex-row h-full justify-start items-center"},Qe={class:"flex flex-row justify-end"},Xe={key:0},Ye={key:1,class:"flex flex-row justify-center items-center space-x-1.5"},es={class:"flex"},ss={class:"flex flex-row justify-end gap-x-2 border-t-1 border-gray-100 pt-3"},ks=X({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(c,{emit:j}){const $=j,{t:p}=Y(),{base:v}=ee(se()),{isMobileMode:V}=te(),{$api:C,$e:h}=_e(),{copy:F}=ae(),{dashboardUrl:N}=he(),t=g({emails:void 0,role:_.VIEWER,invitationToken:void 0}),T=g(),z=S.useForm,A=k(()=>({emails:[xe]})),{validateInfos:D}=z(t.value,A);oe(()=>{var e;!t.value.emails&&((e=c.selectedUser)!=null&&e.email)&&(t.value.emails=c.selectedUser.email,t.value.role=c.selectedUser.roles)});const x=()=>{$("closed"),t.value={role:_.VIEWER}},P=async()=>{var e,d;if(h("a:user:invite",{role:t.value.role}),!!v.value.id){await((e=T.value)==null?void 0:e.validateFields());try{if((d=c.selectedUser)!=null&&d.id)await C.auth.baseUserUpdate(v.value.id,c.selectedUser.id,{roles:t.value.role,email:c.selectedUser.email,base_id:v.value.id,baseName:v.value.title}),x();else{const o=await C.auth.baseUserAdd(v.value.id,{roles:t.value.role,email:t.value.emails});t.value.invitationToken=o==null?void 0:o.invite_token}$("reload"),y.success(p("msg.success.userDetailsUpdated"))}catch(o){console.error(o),y.error(await fe(o))}}},b=k(()=>t.value.invitationToken?`${N.value}#/signup/${t.value.invitationToken}`:null),L=async()=>{if(b.value){try{await F(b.value),y.success(p("msg.success.shareableURLCopied"))}catch(e){y.error(e.message)}h("c:shared-base:copy-url")}},W=()=>{h("c:user:invite-more"),t.value.invitationToken=void 0,t.value.role=_.VIEWER,t.value.emails=void 0},E=g();return be(k(()=>c.show),e=>{e.key==="Escape"&&x()},{immediate:!0}),le(()=>c.show,async e=>{var d,o;e&&(await ie(),(o=(d=E.value)==null?void 0:d.$el)==null||o.focus())},{immediate:!0}),(e,d)=>{const o=pe,q=we,R=ge,O=ke,B=Ue,G=Me,Z=$e,H=S,K=Ce,J=ye;return r(),f(J,{centered:"",visible:e.show,onCancel:x},{default:i(()=>[s("div",Te,[s("div",Ee,[a(V)?I("",!0):(r(),u("div",Re,n(e.$t("activity.share")),1))]),s("div",Be,[a(t).invitationToken?(r(),u("div",Ie,[s("div",Se,[(r(),f(w(("iconMap"in e?e.iconMap:a(U)).account))),je]),l(q,{class:"mt-1",type:"success","show-icon":""},{message:i(()=>[s("div",Ve,[s("div",Fe,n(a(b)),1),l(o,{type:"text",class:"!rounded-md -mt-0.5",onClick:L},{icon:i(()=>[(r(),f(w(("iconMap"in e?e.iconMap:a(U)).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),s("div",Ne,n(e.$t("msg.info.userInviteNoSMTP"))+" "+n(a(t).invitationToken&&a(t).emails),1),s("div",ze,[l(o,{size:"small",outlined:"",onClick:W},{default:i(()=>[s("div",Ae,[l(R,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),s("div",De,n(e.$t("activity.inviteMore")),1)])]),_:1})])])):(r(),u("div",Pe,[e.selectedUser?(r(),u("div",Le,[(r(),f(w(("iconMap"in e?e.iconMap:a(U)).account))),s("div",We,n(e.selectedUser?e.$t("activity.editUser"):e.$t("activity.inviteTeam")),1)])):I("",!0),l(H,{ref_key:"formRef",ref:T,"validate-on-rule-change":!1,model:a(t),"validate-trigger":"onBlur",onFinish:P},{default:i(()=>[s("div",qe,[s("div",Oe,[s("div",Ge,[l(B,ne(a(D).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:a(p)("msg.plsInputEmail")}]}),{default:i(()=>[s("div",Ze,n(e.$t("datatype.Email"))+":",1),l(O,{ref_key:"emailField",ref:E,value:a(t).emails,"onUpdate:value":d[0]||(d[0]=m=>a(t).emails=m),size:"middle","validate-trigger":"onBlur",placeholder:e.$t("labels.email"),disabled:!!e.selectedUser},null,8,["value","placeholder","disabled"])]),_:1},16,["rules"])]),s("div",He,[l(B,{name:"role",rules:[{required:!0,message:a(p)("msg.roleRequired")}]},{default:i(()=>[s("div",Ke,n(e.$t("labels.selectUserRole")),1),l(Z,{value:a(t).role,"onUpdate:value":d[1]||(d[1]=m=>a(t).role=m),size:"middle",class:"nc-user-roles !rounded-md","dropdown-class-name":"nc-dropdown-user-role"},{default:i(()=>[(r(!0),u(re,null,ce(a(_),(m,Q)=>(r(),f(G,{key:Q,value:m,class:"nc-role-option"},{default:i(()=>[s("div",Je,[s("div",{class:"px-3 py-1 flex rounded-full text-xs",style:de({backgroundColor:a(me)[m]})},n(m),5)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["rules"])])]),s("div",Qe,[l(o,{type:"primary","html-type":"submit",class:"!rounded-md"},{default:i(()=>[e.selectedUser?(r(),u("div",Xe,n(e.$t("general.save")),1)):(r(),u("div",Ye,[l(R,{class:"flex h-[0.8rem]"}),s("div",null,n(e.$t("activity.invite")),1)]))]),_:1})])])]),_:1},8,["model"])])),s("div",es,[l(K)])]),s("div",ss,[l(o,{key:"back",class:"!rounded-md",onClick:e.cancel},{default:i(()=>[M(n(e.$t("general.cancel")),1)]),_:1},8,["onClick"]),l(o,{class:"!rounded-md"},{default:i(()=>[M("Manage base access")]),_:1}),l(o,{key:"submit",class:"!rounded-md",type:"primary",loading:e.loading},{default:i(()=>[M(n(e.$t("activity.share")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])}}});export{ks as default};
