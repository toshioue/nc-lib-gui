const __vite__fileDeps=["./BOl0IRyd.js","./B2hUoZAs.js","./entry.B8GgT5QA.css","./Header.x-GI6b6n.css","./HcX_dx7g.js","./BnPwsD6I.js","./BNDnQ_SZ.js","./MeGaiume.js","./CDs976Da.js","./ListItem.BO1P2ool.css","./BfyDMjkl.js","./DerldqwU.js","./MenuItem.C7h59s4s.css","./BQN-xhuP.js","./7hPDkg8v.js","./Divider.DqtSqZhb.css","./DfZ7_DBQ.js","./Menu.CQ8GNWeI.css","./e4fIiYA_.js","./BrvbRDBc.js","./DivDataCell.1yCNpUg3.css","./3I_Awkws.js","./UserIcon.JKLzA6N5.css","./D1Sy-L_y.js","./lNF0bL0F.js","./Badge.D0-UrqG9.css","./D9EHdJGP.js","./Cy50pBgZ.js","./BWYzyVlv.js","./CwHJfKcC.js","./BQQOEPN4.js","./C9qKCFvP.js","./BGKYJ52S.js","./i4toF4kp.js","./kd0F6MQ0.js","./links.C8uCzV-l.css","./aFQEf_70.js","./Tabs.DaLSLYpn.css","./B_8aIjz8.js","./nk4tSM_m.js","./B-HHpLTx.js","./fS-pjH0A.js","./boyBAVNN.js","./BVocwMJB.js","./Bye44sky.js","./BLNfZKv8.js","./C0IYadH8.js","./Bhv5f4lm.js","./BPB61pKE.js","./BjshTetX.js","./DFYMF386.js","./DeleteModal.SEMJ_gSK.css","./CEs-fTPr.js","./OX0YKNjC.js","./m0P-hxAq.js","./index.BSNjFO1V.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as et,ac as tt,N as ot,ai as st,bL as U,r as y,az as at,fC as nt,fH as lt,hf as rt,L as it,at as dt,cB as ct,H as F,i2 as Ce,g as T,fw as Ie,fI as J,i as ut,cp as mt,O as pt,o as n,c as _,a as l,P as t,b as k,w as P,Y as j,al as W,am as ee,U as C,aF as te,t as $,R as oe,d as se,S,Q as ft,dQ as _t,T as vt,Z as ne,a5 as le,n as ae,an as ht,$ as yt,a2 as kt,h6 as Oe,cV as wt,_ as gt}from"./B2hUoZAs.js";import{_ as xt}from"./DEpWCId1.js";import{a as bt}from"./C-lc5-5u.js";import{a as Lt}from"./nk4tSM_m.js";import{i as Te,C as Rt}from"./BXXS6TCz.js";import{e as Ct}from"./MeGaiume.js";import{_ as It}from"./DpNZ3ZQf.js";import"./BWYzyVlv.js";import{I as Ot}from"./CwHJfKcC.js";import{S as Tt}from"./BAskgGqK.js";import"./B093it4u.js";import{S as St}from"./OX0YKNjC.js";import"./CaxUP45y.js";import"./1orNHd0L.js";import"./BQQOEPN4.js";import"./R1pHeCcp.js";import"./BGKYJ52S.js";import"./C9qKCFvP.js";import"./B_8aIjz8.js";import"./DCTfzikA.js";import"./B-HHpLTx.js";import"./fS-pjH0A.js";import"./boyBAVNN.js";import"./Cbc39be_.js";import"./CZHF7Hd-.js";import"./By21eAqY.js";import"./cvW-uYte.js";import"./fKrvpb1C.js";import"./i4toF4kp.js";import"./kd0F6MQ0.js";import"./m0P-hxAq.js";const Vt=""+new URL("link-records.BXQG6er6.png",import.meta.url).href,Et=ne(()=>le(()=>import("./BOl0IRyd.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(m=>m.default||m)),Nt=ne(()=>le(()=>import("./HcX_dx7g.js"),__vite__mapDeps([4,1,2,5,6,7,8,9]),import.meta.url).then(m=>m.default||m)),zt=ne(()=>le(()=>import("./BfyDMjkl.js"),__vite__mapDeps([10,1,2,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,7,43,44,45,46,47,48,49,50,51,52,53,54,55]),import.meta.url).then(m=>m.default||m)),At={class:"flex flex-col h-full"},Ft={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},Pt={key:0,class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center py-0.5 rounded-md"},$t={key:1},Mt={key:0},Dt={class:"cursor-pointer"},Bt={class:"flex items-center"},Ut={class:"flex flex-col gap-2 flex-grow justify-center"},jt={class:"flex flex-row gap-6 w-10/12"},Kt={key:1,class:"h-full flex flex-col gap-2 my-auto items-center justify-center text-gray-500 text-center"},Qt=["alt"],Yt={class:"text-base text-gray-700 font-bold"},Gt={class:"text-gray-700"},qt={class:"flex items-center gap-1"},Ht={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between gap-3 min-h-11"},Xt={class:"flex items-center gap-2"},Zt={class:"flex items-center gap-1"},Jt={class:"flex items-center gap-1"},Wt={key:0,class:"flex justify-center items-center"},eo=et({__name:"LinkedItems",props:{modelValue:{type:Boolean},cellValue:{},column:{},items:{}},emits:["update:modelValue","attachRecord"],setup(m,{emit:Se}){const V=m,K=Se,Q=tt(V,"modelValue",K),{isMobileMode:Y}=ot(),{t:re}=st(),E=U(at,y(!1)),M=U(nt,y(!1)),D=y(!1),u=U(lt,y()),N=U(rt,y(!1)),I=y(),{isDataReadOnly:Ve}=it(),{isSharedBase:Ee}=dt(ct()),{childrenList:w,childrenListCount:x,loadChildrenList:ie,childrenListPagination:r,childrenExcludedOffsetCount:Ne,childrenListOffsetCount:ze,relatedTableDisplayValueProp:de,displayValueTypeAndFormatProp:Ae,unlink:Fe,isChildrenListLoading:Pe,isChildrenListLinked:ce,isChildrenLoading:G,relatedTableMeta:p,link:$e,meta:ue,row:b,resetChildrenListOffsetCount:q}=bt(),{isNew:v,state:z,removeLTARRef:Me,addLTARRef:De}=Lt();F([Q,E],e=>{(e[0]||e[1])&&!v.value&&ie(!0),e[0]||q()},{immediate:!0});const Be=async(e,o)=>{v.value?await Me(e,u==null?void 0:u.value):await Fe(e,{},!1,o)},Ue=async(e,o)=>{v.value?await De(e,u==null?void 0:u.value):await $e(e,{},!1,o)},je=Ce(Oe,e=>(p.value.columns??[]).filter(o=>Te(o))[0]),Ke=Ce(Oe,e=>(p.value.columns??[]).filter(o=>!wt(o)&&!Rt(o)&&!Ie(o)&&!Te(o)).sort((o,a)=>{var i,f;return((i=o.meta)==null?void 0:i.defaultViewColOrder)!==void 0&&((f=a.meta)==null?void 0:f.defaultViewColOrder)!==void 0?o.meta.defaultViewColOrder-a.meta.defaultViewColOrder:0}).slice(0,Y.value?1:3)),h=y(!1),L=y({}),Qe=T(()=>{var i,f,R,g;if(v.value)return{};const e=(i=u==null?void 0:u.value)==null?void 0:i.colOptions,o=(R=(f=p==null?void 0:p.value)==null?void 0:f.columns)==null?void 0:R.find(O=>{if(!Ie(O))return!1;const d=O==null?void 0:O.colOptions;return(d==null?void 0:d.fk_related_model_id)!==ue.value.id?!1:e.type===J.MANY_TO_MANY&&(d==null?void 0:d.type)===J.MANY_TO_MANY?e.fk_parent_column_id===d.fk_child_column_id&&e.fk_child_column_id===d.fk_parent_column_id:e.fk_parent_column_id===d.fk_parent_column_id&&e.fk_child_column_id===d.fk_child_column_id});if(!o)return{};const a=o==null?void 0:o.colOptions;return a?a.type===J.BELONGS_TO?{[o.title]:(g=b==null?void 0:b.value)==null?void 0:g.row}:{[o.title]:(b==null?void 0:b.value)&&[b.value.row]}:{}}),A=T(()=>{var e;return((e=u.value)==null?void 0:e.title)||""}),me=e=>{N.value||E.value||(L.value=e,h.value=!0)},Ye=()=>{L.value={},h.value=!0,D.value=!0},Ge=e=>{var a;const o=ae("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[ae("span",{class:"font-semibold"},re("activity.recordCreatedLinked")),ae("span",{class:"text-gray-500"},re("activity.gotSavedLinkedSuccessfully",{tableName:(a=p.value)==null?void 0:a.title,recordTitle:e[de.value]}))]);ht.success(o)},qe=T(()=>{var e,o;return(o=(e=u.value)==null?void 0:e.colOptions)==null?void 0:o.type});F(()=>V.cellValue,()=>{v.value&&ie()}),F(h,()=>{h.value||(D.value=!1),Ne.value=0,ze.value=0});const He=T(()=>V.items<10&&r.page===1?V.items:x.value<10&&r.page===1?x.value||10:Math.ceil(x.value/10)===r.page?x.value%10:10),Xe=T(()=>{var e,o;return E.value||v.value?(o=(e=z.value)==null?void 0:e[A.value])==null?void 0:o.length:G.value?V.items:x.value}),H=T(()=>{var e,o,a,i;return((o=(e=w.value)==null?void 0:e.pageInfo)==null?void 0:o.totalRows)||v.value&&((i=(a=z.value)==null?void 0:a[A.value])==null?void 0:i.length)}),pe=(e,o)=>{Ee.value||N.value||M.value&&!E.value||(v.value||ce.value[parseInt(o)]?Be(e,parseInt(o)):Ue(e,parseInt(o)))};F([I,H],()=>{var e;(!(N.value||M.value)||H.value)&&((e=I.value)==null||e.focus())});const fe=e=>{var o,a,i,f,R;if(e.key==="Escape")Q.value=!1;else if(e.key==="ArrowDown"){e.preventDefault();try{(a=(o=e.target)==null?void 0:o.nextElementSibling)==null||a.focus()}catch{}}else if(e.key==="ArrowUp"){e.preventDefault();try{(f=(i=e.target)==null?void 0:i.previousElementSibling)==null||f.focus()}catch{}}else if(!h.value&&e.key!=="Tab"&&e.key!=="Shift"&&e.key!=="Enter"&&e.key!==" ")try{(R=I.value)==null||R.focus()}catch{}};ut(()=>{window.addEventListener("keydown",fe),setTimeout(()=>{var e;(e=I.value)==null||e.focus()},100)});const _e=y();F(r,()=>{var e;(e=_e.value)==null||e.scrollTo({top:0,behavior:"smooth"})}),mt(()=>{q(),r.query="",window.removeEventListener("keydown",fe)});const Ze=()=>{r.page=1,q()};return(e,o)=>{var ve,he,ye,ke,we,ge,xe,be,Le;const a=yt,i=Ot,f=Et,R=Tt,g=St,O=Nt,d=It,X=kt,Je=xt,We=zt,Z=pt("e");return n(),_("div",{class:vt(["nc-modal-child-list h-full w-full",{active:t(Q)}]),onKeydown:o[7]||(o[7]=te(j(()=>{},["stop"]),["enter"]))},[l("div",At,[l("div",Ft,[t(E)?(n(),_("div",$t,"Â ")):(n(),_("div",Pt,[k(i,{ref_key:"filterQueryRef",ref:I,value:t(r).query,"onUpdate:value":o[0]||(o[0]=s=>t(r).query=s),bordered:!1,placeholder:"Search linked records...",class:"w-full min-h-4 !pl-0",size:"small",onChange:Ze,onKeydownCapture:o[1]||(o[1]=j(s=>{var c;s.key==="Escape"&&((c=t(I))==null||c.blur())},["stop"]))},{prefix:P(()=>[k(a,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"])])),k(f,{"data-testid":"nc-link-count-info","linked-records":t(Xe),"related-table-title":(ve=t(p))==null?void 0:ve.title,relation:t(qe),"table-title":(he=t(ue))==null?void 0:he.title},null,8,["linked-records","related-table-title","relation","table-title"])]),l("div",{ref_key:"childrenListRef",ref:_e,class:"flex-1 overflow-auto nc-scrollbar-thin"},[t(H)||t(G)?(n(),_("div",Mt,[l("div",Dt,[t(G)?(n(!0),_(W,{key:0},ee(Array.from({length:t(He)}),(s,c)=>(n(),_("div",{key:c,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:bg-gray-50"},[l("div",Bt,[k(R,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),l("div",Ut,[k(g,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),l("div",jt,[(n(),_(W,null,ee([1,2,3],B=>k(g,{key:B,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(n(!0),_(W,{key:1},ee(((ye=t(w))==null?void 0:ye.list)??((ke=t(z))==null?void 0:ke[t(A)])??[],(s,c)=>{var B;return n(),C(O,{key:c,attachment:t(je),"display-value-type-and-format-prop":t(Ae),fields:t(Ke),"is-linked":(B=t(w))!=null&&B.list?t(ce)[Number.parseInt(c)]:!0,"is-loading":t(Pe)[Number.parseInt(c)],"related-table-display-value-prop":t(de),row:s,"data-testid":"nc-child-list-item",onLinkOrUnlink:Re=>pe(s,c),onExpand:Re=>me(s),onKeydown:[te(j(Re=>pe(s,c),["prevent","stop"]),["space"]),te(j(()=>me(s),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"])}),128))])])):(n(),_("div",Kt,[l("img",{alt:e.$t("msg.clickLinkRecordsToAddLinkFromTable"),class:"!w-[158px] flex-none",src:Vt},null,8,Qt),l("div",Yt,$(e.$t("msg.noLinkedRecords")),1),l("div",Gt,$(e.$t("msg.clickLinkRecordsToAddLinkFromTable")),1),!t(N)&&(t(x)<1||(((we=t(w))==null?void 0:we.list)??((ge=t(z))==null?void 0:ge[t(A)])??[]).length>0)?oe((n(),C(X,{key:0,"data-testid":"nc-child-list-button-link-to",size:"small",onClick:o[2]||(o[2]=s=>K("attachRecord"))},{default:P(()=>[l("div",qt,[k(d),se(" "+$(e.$t("title.linkRecords")),1)])]),_:1})),[[Z,["c:links:link"]]]):S("",!0)]))],512),l("div",Ht,[l("div",Xt,[!t(M)&&!t(Ve)?oe((n(),C(X,{key:0,size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",onClick:Ye},{default:P(()=>[l("div",Zt,[t(Y)?S("",!0):(n(),C(d,{key:0,class:"h-4 w-4"})),se(" "+$(e.$t("activity.newRecord")),1)])]),_:1})),[[Z,["c:row-expand:open"]]]):S("",!0),!t(N)&&(t(x)>0||(((xe=t(w))==null?void 0:xe.list)??((be=t(z))==null?void 0:be[t(A)])??[]).length>0)?oe((n(),C(X,{key:1,"data-testid":"nc-child-list-button-link-to",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",size:"small",type:"secondary",onClick:o[3]||(o[3]=s=>K("attachRecord"))},{default:P(()=>[l("div",Jt,[k(a,{icon:"link2",class:"!xs:hidden h-4 w-4"}),se(" "+$(t(Y)?e.$t("title.linkMore"):e.$t("title.linkMoreRecords")),1)])]),_:1})),[[Z,["c:links:link"]]]):S("",!0)]),!t(v)&&((Le=t(w))!=null&&Le.pageInfo)&&+t(w).pageInfo.totalRows>t(r).size?(n(),_("div",Wt,[k(Je,{current:t(r).page,"onUpdate:current":o[4]||(o[4]=s=>t(r).page=s),"page-size":t(r).size,"onUpdate:pageSize":o[5]||(o[5]=s=>t(r).size=s),total:+t(w).pageInfo.totalRows,mode:"simple"},null,8,["current","page-size","total"])])):S("",!0)])]),(n(),C(_t,null,{default:P(()=>{var s;return[t(L)&&t(h)?(n(),C(We,{key:0,modelValue:t(h),"onUpdate:modelValue":o[6]||(o[6]=c=>ft(h)?h.value=c:null),"load-row":!t(M),"close-after-save":t(D),meta:t(p),"new-record-header":t(D)?e.$t("activity.tableNameCreateNewRecord",{tableName:(s=t(p))==null?void 0:s.title}):void 0,row:{row:t(L),oldRow:t(L),rowMeta:Object.keys(t(L)).length>0?{}:{new:!0}},state:t(Qe),"row-id":("extractPkFromRow"in e?e.extractPkFromRow:t(Ct))(t(L),t(p).columns),"use-meta-fields":"","new-record-submit-btn-text":"Create & Link",onCreatedRecord:Ge},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","state","row-id"])):S("",!0)]}),_:1}))],34)}}}),No=gt(eo,[["__scopeId","data-v-41e5931f"]]);export{No as default};
