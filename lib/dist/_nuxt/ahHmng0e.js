import{f as oe,ai as ue,N as re,bN as f,fQ as ie,r as o,hr as ce,hH as de,aC as ve,aE as fe,hL as me,aF as pe,gQ as ye,gV as ke,g as C,df as De,i3 as ge,cs as b,F as he,af as Q,H as q,d3 as we,i1 as Ce,i as be,cC as $e,aG as Ie,iN as Ve,o as $,c as H,b as Me,w as L,a as U,P as t,S as B,Q as z,a9 as Ee,Y as K,T as A,U as je,aq as Fe,$ as Ye,_ as Pe}from"./Cgw6cdOy.js";import{_ as xe}from"./odmV3s9h.js";import{_ as Ne}from"./CiTH7PYd.js";import"./Mq7h2J0k.js";import"./BM5CMLBx.js";const Oe=["title"],Se=["value","placeholder","readonly"],Ue={class:"w-[256px]"},Be={key:0,class:"absolute inset-0 z-90 cursor-pointer"},ze=oe({__name:"DatePicker",props:{modelValue:{},isPk:{type:Boolean},showCurrentDateOption:{type:[Boolean,String]}},emits:["update:modelValue","currentDate"],setup(p,{emit:J}){const x=J,{t:G}=ue(),{showNull:N,isMobileMode:W}=re(),I=f(ie,null),h=f(ce,o(!1)),V=f(de,o(!1)),M=f(ve,o(!1)),c=f(fe,o(!1)),y=f(me,o(!1)),X=f(pe,o(!1)),Z=f(ye,o(!1)),E=f(ke,o(!1)),j=o(!1),d=o(),g=C(()=>{var e,a;return((a=De((e=I==null?void 0:I.value)==null?void 0:e.meta))==null?void 0:a.date_format)??"YYYY-MM-DD"}),O=C(()=>ge(g.value)?"month":""),F=o(!1),l=o(!1),r=o(),n=C({get(){if(!p.modelValue||F.value)return;if(!b(p.modelValue).isValid()){j.value=!0;return}const e=O.value==="month"?g:"YYYY-MM-DD";return b(/^\d+$/.test(p.modelValue)?+p.modelValue:p.modelValue,e)},set(e){if(F.value=!1,!e){x("update:modelValue",null);return}O.value==="month"&&(e=b(e).date(1)),e.isValid()&&x("update:modelValue",e==null?void 0:e.format("YYYY-MM-DD")),l.value=!1}});he(()=>{n.value&&(r.value=n.value)});const v=`picker_${Math.floor(Math.random()*99999)}`;Q(d,e=>{var a,s,u;(a=e.target)!=null&&a.closest(`.${v}, .nc-${v}`)||((u=(s=d.value)==null?void 0:s.blur)==null||u.call(s),l.value=!1)});const ee=e=>{var a,s;(a=e==null?void 0:e.relatedTarget)!=null&&a.closest(`.${v}, .nc-${v}`)||(s=e==null?void 0:e.target)!=null&&s.closest(`.${v}, .nc-${v}`)||(l.value=!1)},ae=()=>{l.value=!0};q(l,e=>{var a,s;e?(c.value=!0,(s=(a=d.value)==null?void 0:a.focus)==null||s.call(a),Q(document.querySelector(`.${v}`),u=>{var m;(m=u==null?void 0:u.target)!=null&&m.closest(`.nc-${v}`)||(l.value=!1)})):F.value=!1},{flush:"post"}),q(c,e=>{y.value&&e&&!l.value&&(l.value=!0)});const te=C(()=>(X.value||E.value)&&!j.value||y.value&&!N.value&&!j.value&&!we(I.value)&&M.value||V.value?g.value:p.modelValue===null&&N.value?G("general.null").toUpperCase():j.value?G("msg.invalidDate"):""),Y=C(()=>h.value||(h.value||n.value&&p.isPk)&&!M.value&&!c.value?!1:l.value),k=f(Ce,null),S=()=>{h.value||l.value||(l.value=M.value||c.value)};be(()=>{k==null||k.on(S)}),$e(()=>{k==null||k.on(S)});const le=()=>{k||S()},se=(e,a)=>{var s,u,m,i,D,w,P,T;switch(e.key!=="Enter"&&e.key!=="Tab"&&e.stopPropagation(),e.key){case"Enter":e.preventDefault(),Z.value&&e.stopPropagation(),n.value=r.value,l.value=!a,l.value||(c.value=!1,y.value&&!E.value&&!V.value&&((u=(s=d.value)==null?void 0:s.blur)==null||u.call(s)));return;case"Escape":a?(l.value=!1,c.value=!1,y.value&&!E.value&&!V.value&&((i=(m=d.value)==null?void 0:m.blur)==null||i.call(m))):(c.value=!1,(w=(D=d.value)==null?void 0:D.blur)==null||w.call(D));return;case"Tab":l.value=!1,y.value&&(c.value=!1,(T=(P=d.value)==null?void 0:P.blur)==null||T.call(P));return;default:!a&&/^[0-9a-z]$/i.test(e.key)&&(l.value=!0)}};Ie(document,"keydown",e=>{if(M.value&&!(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||!y.value||E.value||V.value||Ve()))switch(e.key){case";":n.value=b(new Date),e.preventDefault();break;default:!Y.value&&d.value&&/^[0-9a-z]$/i.test(e.key)&&(F.value=!0,d.value.focus(),c.value=!0,l.value=!0)}});const ne=e=>{const a=e.target.value;if(!a){r.value=void 0;return}const s=b(a,g.value);s.isValid()&&(r.value=s)};function _(e){r.value=e,n.value=e,l.value=!1}const R=e=>{x("currentDate",e),l.value=!1};return(e,a)=>{const s=Ye,u=xe,m=Ne;return $(),H(Fe,null,[Me(m,{visible:t(Y),"auto-close":!1,trigger:["click"],class:je(["nc-cell-field",[`nc-${v}`,{"nc-null":e.modelValue===null&&t(N)}]]),"overlay-class-name":`${v} nc-picker-date ${t(l)?"active":""} !min-w-[260px]`},{overlay:L(()=>[U("div",Ue,[t(O)==="month"?($(),B(u,{key:0,"page-date":t(r),"onUpdate:pageDate":a[4]||(a[4]=i=>z(r)?r.value=i:null),"selected-date":t(n),"onUpdate:selectedDate":a[5]||(a[5]=i=>z(n)?n.value=i:null),"is-open":t(Y),type:"month",size:"medium","show-current-date-option":e.showCurrentDateOption,onCurrentDate:R},null,8,["page-date","selected-date","is-open","show-current-date-option"])):($(),B(u,{key:1,"page-date":t(r),"onUpdate:pageDate":a[6]||(a[6]=i=>z(r)?r.value=i:null),"is-open":t(Y),"selected-date":t(n),type:"date",size:"medium","show-current-date-option":e.showCurrentDateOption,"onUpdate:selectedDate":_,onCurrentDate:R},null,8,["page-date","is-open","selected-date","show-current-date-option"]))])]),default:L(()=>{var i,D;return[U("div",Ee(e.$attrs,{title:(i=t(n))==null?void 0:i.format(t(g)),class:"nc-date-picker h-full flex items-center justify-between ant-picker-input relative"}),[U("input",{ref_key:"datePickerRef",ref:d,type:"text",value:((D=t(n))==null?void 0:D.format(t(g)))??"",placeholder:t(te),class:"nc-date-input border-none outline-none !text-current bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:t(h)||!!t(W),onBlur:ee,onFocus:ae,onKeydown:a[0]||(a[0]=w=>se(w,t(l))),onMouseup:a[1]||(a[1]=K(()=>{},["stop"])),onMousedown:a[2]||(a[2]=K(()=>{},["stop"])),onClick:le,onInput:ne},null,40,Se),t(n)&&!t(h)?($(),B(s,{key:0,icon:"closeCircle",class:"nc-clear-date-icon nc-action-icon absolute right-0 top-[50%] transform -translate-y-1/2 invisible cursor-pointer",onClick:a[3]||(a[3]=K(w=>_(),["stop"]))})):A("",!0)],16,Oe)]}),_:1},8,["visible","class","overlay-class-name"]),!t(c)&&t(y)?($(),H("div",Be)):A("",!0)],64)}}}),Qe=Pe(ze,[["__scopeId","data-v-12321df5"]]);export{Qe as default};
