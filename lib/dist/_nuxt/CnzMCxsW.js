const __vite__fileDeps=["./DusGfiAj.js","./nEPQs079.js","./entry.B8GgT5QA.css","./Gr6cVSxP.js","./DeleteModal.SEMJ_gSK.css","./eSDe9FnP.js","./CZJAloFU.js","./B_7Ene6-.js","./D4bBQlhl.js","./BzWD3wIg.js","./5fs2TD9N.js","./BTGvCRQH.js","./COktFmkf.js","./DYYbRAhI.js","./BdIpmjdG.js","./ByzT15Y-.js","./BQQOEPN4.js","./DKtVUO_j.js","./DzMAdbS0.js","./QHUCxglU.js","./DGtfac4d.js","./CFgyk-dW.js","./BLe4UTYD.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{o,c as h,a as t,f as me,ai as _e,ag as fe,at as ve,cB as ye,ah as xe,L as he,au as we,r as p,eJ as ge,hr as be,O as ke,P as n,b as r,U as i,w as l,d as O,t as d,Q as z,T as $e,R as P,V as y,W as x,S as g,al as q,am as Ue,a8 as F,fZ as W,fR as Z,an as m,ao as A,dh as Me,aS as Ce,ca as Re,a1 as Ie,a9 as Se,aa as je,af as ze,Z as Ae,a5 as Be,A as De}from"./nEPQs079.js";import{u as Ee}from"./eSDe9FnP.js";import{_ as Te}from"./W4oBzPwL.js";import{_ as Pe}from"./BUJRO5Cs.js";import"./BdIpmjdG.js";import{I as Le}from"./ByzT15Y-.js";import{_ as Ne}from"./DJpQD7nd.js";import"./DKtVUO_j.js";import"./DzMAdbS0.js";import"./BQQOEPN4.js";import"./COktFmkf.js";import"./QHUCxglU.js";import"./QTd5iuHu.js";import"./CFgyk-dW.js";import"./BTGvCRQH.js";import"./BLe4UTYD.js";import"./B-HMHOhf.js";const Ve={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Oe=t("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0c.41-.41.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"},null,-1),qe=[Oe];function Fe(M,b){return o(),h("svg",Ve,[...qe])}const We={name:"ic-round-search",render:Fe},Ze=Ae(()=>Be(()=>import("./DusGfiAj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url).then(M=>M.default||M)),Je={key:0,class:"h-full w-full flex items-center justify-center"},Qe={key:1,class:"flex flex-col w-full px-6"},Ge={class:"flex flex-col h-full"},He=t("div",{class:"flex flex-row justify-center mt-2 text-center w-full text-base"}," This action will remove this user from this base ",-1),Ke={class:"flex mt-6 justify-end space-x-2"},Xe={class:"flex flex-row mb-4 mx-4 justify-between pb-2"},Ye={class:"flex w-1/3"},es={class:"flex flex-row space-x-1"},ss={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},ts={class:"text-gray-500"},as={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},os={class:"px-5"},ns={class:"flex flex-row border-b-1 pb-2 px-2"},ls={class:"flex flex-row w-3/6 space-x-1 items-center pl-1"},is={class:"text-gray-600 text-xs space-x-1"},rs={class:"flex flex-row justify-start w-2/6 space-x-1 items-center pl-1"},cs={class:"text-gray-600 text-xs"},ds={class:"flex flex-row w-1/6 justify-end items-center pl-1"},us={class:"text-gray-600 text-xs"},ps={class:"flex w-3/6 flex-wrap nc-user-email"},ms={class:"flex w-2/6 justify-start gap-2 flex-wrap ml-4"},_s={class:"flex w-1/6 flex-wrap justify-end"},fs={class:"flex flex-row items-center"},vs={class:"flex flex-row items-center h-[1.2rem]"},ys=["onClick"],xs={class:"text-xs pl-2"},hs=["onClick"],ws={class:"text-xs pl-2"},Ps=me({__name:"UserManagement",setup(M){const{t:b}=_e(),{$e:C}=De(),{api:R}=fe(),{base:_}=ve(ye()),{copy:J}=xe(),{isUIAllowed:Q}=he(),{dashboardUrl:G}=Ee(),{clearBasesUser:H}=we(),B=p(null),w=p(null),k=p(!1),f=p(!1),D=p(!1),L=p(0),$=p(1),I=p(10),U=p(""),v=async(e=$.value,s=I.value)=>{var u,S;try{if(!((u=_.value)!=null&&u.id))return;const c=await R.auth.baseUserList((S=_.value)==null?void 0:S.id,{query:{limit:s,offset:(e-1)*s,query:U.value}});if(!c.users)return;L.value=c.users.pageInfo.totalRows??0,B.value=c.users.list}catch(c){m.error(await A(c))}},K=async e=>{var s;try{if(!((s=_.value)!=null&&s.id))return;e.roles||(e.roles="editor"),await R.auth.baseUserAdd(_.value.id,e),H(),m.success(b("msg.success.userAddedToProject")),await v()}catch(u){m.error(await A(u))}C("a:user:add")},X=async()=>{var e,s;try{if(!((e=_.value)!=null&&e.id)||!((s=w.value)!=null&&s.id))return;await R.auth.baseUserRemove(_.value.id,w.value.id),m.success(b("msg.success.userDeletedFromProject")),await v(),f.value=!1}catch(u){m.error(await A(u))}finally{f.value=!1}C("a:user:delete")},Y=e=>{w.value=e,k.value=!0},ee=()=>{w.value=null,k.value=!0},se=e=>{w.value=e,f.value=!0},te=async e=>{var s;if((s=_.value)!=null&&s.id){try{await R.auth.baseUserResendInvite(_.value.id,e.id),m.success(b("msg.success.inviteEmailSent")),await v()}catch(u){m.error(await A(u))}C("a:user:resend-invite")}},ae=async e=>{if(e.invite_token){try{await J(`${G.value}#/signup/${e.invite_token}`),m.success(b("msg.success.inviteURLCopied"))}catch(s){m.error(s.message)}C("c:user:copy-url")}};ge(async()=>{B.value||(D.value=!0,await v(),D.value=!1)}),be(U,()=>{$.value=1,v()},{debounce:300,maxWait:600});const N=e=>{var s;return(s=e.main_roles)==null?void 0:s.split(",").includes(Z.SUPER_ADMIN)};return(e,s)=>{const u=Me,S=Ze,c=Ce,oe=Re,ne=We,le=Le,ie=Pe,E=Ie,re=Te,V=Se,ce=je,de=ze,ue=Ne,T=ke("e");return n(D)?(o(),h("div",Je,[r(u,{size:"large"})])):(o(),h("div",Qe,[(o(),i(S,{key:`${n(k)}`,show:n(k),"selected-user":n(w),onClosed:s[0]||(s[0]=a=>k.value=!1),onReload:s[1]||(s[1]=a=>v())},null,8,["show","selected-user"])),r(oe,{visible:n(f),"onUpdate:visible":s[3]||(s[3]=a=>z(f)?f.value=a:null),class:$e([{active:n(f)},"!rounded-md"]),closable:!1,width:"28rem",centered:"",footer:null,"wrap-class-name":"nc-modal-delete-user"},{default:l(()=>[t("div",Ge,[He,t("div",Ke,[r(c,{class:"!rounded-md",onClick:s[2]||(s[2]=a=>f.value=!1)},{default:l(()=>[O(d(e.$t("general.cancel")),1)]),_:1}),r(c,{class:"!rounded-md",type:"primary",danger:"",onClick:X},{default:l(()=>[O(d(e.$t("general.confirm")),1)]),_:1})])])]),_:1},8,["visible","class"]),t("div",Xe,[t("div",Ye,[r(le,{value:n(U),"onUpdate:value":s[4]||(s[4]=a=>z(U)?U.value=a:null),placeholder:e.$t("placeholder.filterByEmail")},{prefix:l(()=>[r(ne,{class:"text-gray-400"})]),_:1},8,["value","placeholder"])]),t("div",es,[P((o(),i(c,{size:"middle",type:"text",onClick:s[5]||(s[5]=a=>v())},{default:l(()=>[t("div",ss,[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).reload),{class:"text-gray-500"})),t("div",ts,d(e.$t("general.reload")),1)])]),_:1})),[[T,["a:user:reload"]]]),n(Q)("newUser")?P((o(),i(c,{key:0,size:"middle",type:"primary",class:"nc-invite-team !rounded-md",onClick:ee},{default:l(()=>[t("div",as,[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).accountPlus),{class:"mr-1"})),t("div",null,d(e.$t("activity.inviteTeam")),1)])]),_:1})),[[T,["c:user:invite"]]]):g("",!0)])]),t("div",os,[t("div",ns,[t("div",ls,[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).email),{class:"flex text-gray-500 -mt-0.5"})),t("div",is,d(e.$t("labels.email")),1)]),t("div",rs,[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).role),{class:"flex text-gray-500 -mt-0.5"})),t("div",cs,d(e.$t("objects.role")),1)]),t("div",ds,[t("div",us,d(e.$t("labels.actions")),1)])]),(o(!0),h(q,null,Ue(n(B),(a,pe)=>(o(),h("div",{key:pe,class:"flex flex-row items-center border-b-1 py-2 px-2 nc-user-row"},[t("div",ps,d(a.email),1),t("div",ms,[N(a)?(o(),h("div",{key:0,class:"rounded-full px-3 py-1 nc-user-role",style:F({backgroundColor:n(W)[n(Z).SUPER_ADMIN]})}," Super Admin ",4)):g("",!0),a.roles?(o(),h("div",{key:1,class:"rounded-full px-3 py-1 nc-user-role",style:F({backgroundColor:n(W)[a.roles]})},d(e.$t(`objects.roleType.${a.roles}`)),5)):g("",!0)]),t("div",_s,[N(a)?g("",!0):(o(),h(q,{key:0},[a.base_id?(o(),i(E,{key:0,placement:"bottom"},{title:l(()=>[t("span",null,d(e.$t("activity.editUser")),1)]),default:l(()=>[r(c,{type:"text",class:"!rounded-md nc-user-edit",onClick:j=>Y(a)},{icon:l(()=>[r(ie,{class:"flex mx-auto h-[1rem] text-gray-500"})]),_:2},1032,["onClick"])]),_:2},1024)):g("",!0),a.base_id?(o(),i(E,{key:2,placement:"bottom"},{title:l(()=>[t("span",null,d(e.$t("activity.deleteUser")),1)]),default:l(()=>[P((o(),i(c,{type:"text",class:"!rounded-md nc-user-delete",onClick:j=>se(a)},{icon:l(()=>[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).delete),{class:"flex mx-auto h-[1.1rem] text-gray-500"}))]),_:2},1032,["onClick"])),[[T,["c:user:delete"]]])]),_:2},1024)):(o(),i(E,{key:1,placement:"bottom"},{title:l(()=>[t("span",null,d(e.$t("activity.addUserToProject")),1)]),default:l(()=>[r(c,{type:"text",class:"!rounded-md nc-user-invite",onClick:j=>K(a)},{icon:l(()=>[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).plus),{class:"flex mx-auto h-[1.1rem] text-gray-500"}))]),_:2},1032,["onClick"])]),_:2},1024)),a.invite_token?(o(),i(de,{key:3,trigger:["click"],class:"flex",placement:"bottomRight","overlay-class-name":"nc-dropdown-user-mgmt"},{overlay:l(()=>[r(ce,null,{default:l(()=>[r(V,null,{default:l(()=>[t("div",{class:"flex flex-row items-center py-3",onClick:j=>te(a)},[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).sendEmail),{class:"flex h-[1rem] text-gray-500"})),t("div",xs,d(e.$t("activity.resendInvite")),1)],8,ys)]),_:2},1024),r(V,null,{default:l(()=>[t("div",{class:"flex flex-row items-center py-3",onClick:j=>ae(a)},[(o(),i(y(("iconMap"in e?e.iconMap:n(x)).copy),{class:"flex h-[1rem] text-gray-500"})),t("div",ws,d(e.$t("activity.copyInviteURL")),1)],8,hs)]),_:2},1024)]),_:2},1024)]),default:l(()=>[t("div",fs,[r(c,{type:"text",class:"!px-0"},{default:l(()=>[t("div",vs,[r(re)])]),_:1})])]),_:2},1024)):g("",!0)],64))])]))),128)),r(ue,{current:n($),"onUpdate:current":s[6]||(s[6]=a=>z($)?$.value=a:null),"page-size":n(I),"onUpdate:pageSize":s[7]||(s[7]=a=>z(I)?I.value=a:null),"hide-on-single-page":"",class:"mt-4",total:+n(L),"show-less-items":"",onChange:v},null,8,["current","page-size","total"])])]))}}});export{Ps as default};
