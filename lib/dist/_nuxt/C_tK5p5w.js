import{e as X,ag as Y,ax as L,cL as ee,bL as te,r as v,gi as ae,f as b,ay as se,L as ne,g as le,o as n,c as r,a as d,b as i,w as l,d as m,t as a,N as o,Q as y,T as x,U as k,O as ie,S as V,ao as oe,R as U,ah as B,ai as ce,$ as de,aT as pe,Z as re,d5 as me,y as ue}from"./DZZ6t_j4.js";import{_ as fe}from"./DfeSAprs.js";import{_ as _e}from"./CynerQ2m.js";import{_ as he}from"./CY3l82lI.js";import"./DKN1hQ6S.js";import{I as ve}from"./BQuyMdA-.js";import"./DNgdBwTe.js";import"./eX8_g88K.js";import"./vll-Pnjv.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./BQQOEPN4.js";import"./DyDFI6NE.js";const ye={class:"h-full flex flex-row w-full items-center justify-center"},be={class:"w-full h-full flex flex-col"},we={class:"flex flex-row items-center w-full mb-4 gap-2 justify-between"},ge={class:"flex"},xe={class:"flex items-center gap-2 text-gray-600 font-light"},ke={class:"flex flex-row items-center w-full gap-x-1"},$e={class:"flex"},Ce={key:1,class:"flex flex-row gap-x-2"},Ie={class:"flex"},Ne={key:0,class:"flex items-center gap-2 max-w-full"},Te={class:"min-w-5 flex items-center justify-center"},Me={key:1,class:"flex items-center gap-2 max-w-full"},je={class:"min-w-5 flex items-center justify-center"},Le={key:2},Ve={key:0},Ue={key:1},Ze=X({__name:"UIAcl",props:{sourceId:{}},setup(R){const A=R,{t:u}=Y(),{$api:$,$e:S}=ue(),{base:W}=L(ee()),z=te(ae,v()),_=b(()=>{var e;return z.value??((e=W.value)==null?void 0:e.id)}),{bases:E}=L(se()),C=b(()=>E.value.get(_.value)??{}),{includeM2M:G}=ne(),D=v(["editor","commenter","viewer"]),w=v(!1),f=v([]),h=v(""),I=b(()=>f.value.filter(e=>(e==null?void 0:e.source_id)===A.sourceId&&(typeof(e==null?void 0:e._ptn)=="string"&&e._ptn.toLowerCase().includes(h.value.toLowerCase())||typeof(e==null?void 0:e.title)=="string"&&e.title.toLowerCase().includes(h.value.toLowerCase())))),g=b(()=>D.value.reduce((e,c)=>({...e,[c]:f.value.filter(p=>p.disabled[c]).length===0}),{})),F=e=>{const c=!g.value[e];f.value.forEach(p=>{p.disabled[e]=c,p.edited=!0})};async function N(){try{if(!_.value)return;w.value=!0,f.value=await $.base.modelVisibilityList(_.value,{includeM2M:G.value})}catch(e){console.error(e)}finally{w.value=!1}}async function H(){try{if(!_.value)return;await $.base.modelVisibilitySet(_.value,f.value.filter(e=>e.edited)),B.success(u("msg.success.updatedUIACL"))}catch(e){B.error(await ce(e))}S("a:proj-meta:ui-acl")}const O=(e,c)=>{e.disabled[c]=!e.disabled[c],e.edited=!0};le(async()=>{f.value.length===0&&await N()});const P=[{key:"name",title:u("labels.tableName"),name:"Table Name",minWidth:220,padding:"0px 12px",dataIndex:"_ptn"},{key:"name",title:u("labels.viewName"),name:"View Name",minWidth:220,padding:"0px 12px",dataIndex:"title"},{key:"action",title:u("objects.roleType.editor"),name:"editor",width:120,minWidth:120,padding:"0px 12px"},{key:"action",title:u("objects.roleType.commenter"),name:"commenter",width:135,minWidth:135,padding:"0px 12px"},{key:"action",title:u("objects.roleType.viewer"),name:"viewer",width:120,minWidth:120,padding:"0px 12px"}];return(e,c)=>{const p=de,Q=ve,Z=pe,q=re,T=fe,M=_e,J=me,K=he;return n(),r("div",ye,[d("div",be,[i(p,{class:"mb-4 first-letter:capital font-bold max-w-100 truncate","show-on-truncate-only":""},{title:l(()=>[m(a(o(C).title),1)]),default:l(()=>[d("span",null," UI ACL : "+a(o(C).title),1)]),_:1}),d("div",we,[i(Q,{value:o(h),"onUpdate:value":c[0]||(c[0]=s=>ie(h)?h.value=s:null),placeholder:e.$t("placeholder.searchModels"),"allow-clear":"",class:"nc-acl-search nc-input-border-on-value !w-[400px] nc-input-sm"},{prefix:l(()=>[(n(),y(x(("iconMap"in e?e.iconMap:o(k)).search),{class:"text-gray-600"}))]),_:1},8,["value","placeholder"]),d("div",ge,[i(Z,{type:"text",ghost:"",class:"self-start !rounded-md nc-acl-reload",onClick:N},{default:l(()=>[d("div",xe,[(n(),y(x(("iconMap"in e?e.iconMap:o(k)).reload),{class:V({"animate-infinite animate-spin !text-success":o(w)})},null,8,["class"])),m(" "+a(e.$t("general.reload")),1)])]),_:1}),i(q,{size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:H},{default:l(()=>[d("div",ke,[(n(),y(x(("iconMap"in e?e.iconMap:o(k)).save))),d("div",$e,a(e.$t("general.save")),1)])]),_:1})])]),i(K,{columns:P,data:o(I),"row-height":"44px","header-row-height":"44px",class:"h-[calc(100%_-_88px)] w-full"},{headerCell:l(({column:s})=>[s.key==="name"?(n(),r(oe,{key:0},[m(a(s.title),1)],64)):U("",!0),s.key==="action"?(n(),r("div",Ce,[i(T,{checked:o(g)[s.name],"onUpdate:checked":t=>o(g)[s.name]=t,disabled:!o(I).length,class:"!m-0 !top-0",onChange:t=>F(s.name)},null,8,["checked","onUpdate:checked","disabled","onChange"]),d("div",Ie,a(s.title),1)])):U("",!0)]),bodyCell:l(({column:s,record:t})=>{var j;return[s.name==="Table Name"?(n(),r("div",Ne,[d("div",Te,[i(M,{meta:{meta:t.table_meta,type:t.ptype},class:"text-gray-500"},null,8,["meta"])]),i(p,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[m(a(t._ptn),1)]),default:l(()=>[m(" "+a(t._ptn),1)]),_:2},1024)])):s.name==="View Name"?(n(),r("div",Me,[d("div",je,[(j=t==null?void 0:t.meta)!=null&&j.icon?(n(),y(M,{key:0,meta:{meta:t.meta,type:"view"},class:"text-gray-500 !text-sm !children:w-5 !children:h-5"},null,8,["meta"])):(n(),y(J,{key:1,meta:t,class:"text-gray-500"},null,8,["meta"]))]),i(p,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[m(a(t.is_default?e.$t("title.defaultView"):t.title),1)]),default:l(()=>[m(" "+a(t.is_default?e.$t("title.defaultView"):t.title),1)]),_:2},1024)])):(n(),r("div",Le,[i(p,null,{title:l(()=>[t.disabled[s.name]?(n(),r("span",Ve,a(e.$t("labels.clickToMake"))+" '"+a(t.title)+"' "+a(e.$t("labels.visibleForRole"))+" "+a(s.name)+" "+a(e.$t("labels.inUI"))+" dashboard",1)):(n(),r("span",Ue,a(e.$t("labels.clickToHide"))+" '"+a(t.title)+"' "+a(e.$t("labels.forRole"))+":"+a(s.name)+" "+a(e.$t("labels.inUI")),1))]),default:l(()=>[i(T,{checked:!t.disabled[s.name],class:V(`nc-acl-${t.title}-${s.name}-chkbox !ml-0.25`),onChange:Be=>O(t,s.name)},null,8,["checked","class","onChange"])]),_:2},1024)]))]}),_:1},8,["data"])])])}}});export{Ze as default};
