import{e as R,r as h,ag as D,g as ee,N as s,o as l,c as n,b as f,a as i,S as se,R as U,t as S,w as v,ao as k,at as g,d as A,Q as p,T as J,U as L,a7 as te,dp as le,ic as ae,aT as oe,Z as re,y as ne,ah as b,ai as V}from"./DZZ6t_j4.js";import"./DKN1hQ6S.js";import{I as ie}from"./BQuyMdA-.js";import{F as pe}from"./BYINaHrJ.js";import{_ as ce}from"./DyDFI6NE.js";import{_ as ue}from"./DGj1ycqW.js";import{_ as de}from"./CDWovrGB.js";import{_ as _e}from"./dfem9Uc_.js";import"./B5RRVMt5.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./D9tFZoTQ.js";import"./BCJFTkwv.js";const ye={key:0,class:"flex flex-row w-full justify-center items-center h-52"},fe={key:1,class:"flex flex-col"},ve={class:"w-full relative"},me={class:"flex flex-row justify-center pb-4 mb-2 border-b-1 w-full gap-x-1"},he=["alt","src"],ke={class:"font-semibold text-lg"},ge={class:"absolute -right-2 -top-0.5"},be={key:0,class:"flex flex-row justify-center"},xe={class:"text-center font-normal mb-2"},we={key:0,class:"text-red-600"},Ce={key:4,class:"absolute flex flex-col justify-start mt-2 -right-6 top-0"},Ue=["colspan"],Se={class:"flex flex-row space-x-4 justify-center mt-4"},Le=R({__name:"AppInstall",props:{id:{}},emits:["saved","close"],setup(N,{emit:E}){const $=E,{$api:x}=ne(),M=h(),{t:w}=D(),a=h(null),r=h({}),C=h(!0),y=h(null),z={labelCol:{span:14,pull:4},wrapperCol:{span:20,pull:4}},Q=()=>r.value.push({}),Z=async()=>{var o,u;y.value="save";try{await((o=M.value)==null?void 0:o.validateFields()),await x.plugin.update(N.id,{input:JSON.stringify(r.value),active:!0}),$("saved"),b.success(((u=a.value)==null?void 0:u.formDetails.msgOnInstall)||w("msg.success.pluginSettingsSaved"))}catch(m){b.error(await V(m))}finally{y.value=null}},G=async()=>{y.value="test";try{a.value&&(await x.plugin.test({input:JSON.stringify(r.value),title:a.value.title,category:a.value.category})?b.success(w("msg.success.pluginTested")):b.info(w("msg.info.invalidCredentials")))}catch(o){b.error(await V(o))}finally{y.value=null}},H=async o=>{switch(o){case"save":await Z();break;case"test":await G();break}},K=async()=>{try{C.value=!0;const o=await x.plugin.read(N.id),u=JSON.parse(o.input_schema??"{}"),m=u.array?[{}]:{},_=typeof o.input=="string"?JSON.parse(o.input):m;"secure"in _&&typeof _.secure=="string"&&(_.secure=_.secure==="true"),a.value={...o,formDetails:u,parsedInput:_},r.value=a.value.parsedInput}catch(o){console.log(o)}finally{C.value=!1}},W=o=>r.value.splice(o,1);return ee(async()=>{a.value||await K()}),(o,u)=>{var O;const m=le,_=ae,q=oe,j=ce,B=ue,F=de,T=ie,I=_e,X=re,Y=pe;return s(C)?(l(),n("div",ye,[f(m,{size:"large"})])):(l(),n("div",fe,[i("div",ve,[i("div",me,[s(a).logo?(l(),n("div",{key:0,class:se(["mr-1 flex items-center justify-center",[s(a).title==="SES"?"p-2 bg-[#242f3e]":""]])},[i("img",{alt:s(a).title||"plugin",src:s(a).logo,class:"h-6"},null,8,he)],2)):U("",!0),i("span",ke,S(s(a).formDetails.title),1)]),i("div",ge,[f(q,{type:"text",class:"!rounded-md mr-1",onClick:u[0]||(u[0]=e=>$("close"))},{icon:v(()=>[f(_,{class:"flex mx-auto"})]),_:1})])]),f(Y,te({ref_key:"formRef",ref:M},(O=s(a))!=null&&O.formDetails.array?{}:z,{model:s(r),class:"mx-4 mt-3"}),{default:v(()=>[s(a).formDetails.array?(l(),n("div",be,[i("table",null,[i("thead",null,[i("tr",null,[(l(!0),n(k,null,g(s(a).formDetails.items,(e,c)=>(l(),n("th",{key:c},[i("div",xe,[A(S(e.label)+" ",1),e.required?(l(),n("span",we,"*")):U("",!0)])]))),128))])]),i("tbody",null,[(l(!0),n(k,null,g(s(a).parsedInput,(e,c)=>(l(),n("tr",{key:c},[(l(!0),n(k,null,g(s(a).formDetails.items,(t,P)=>(l(),n("td",{key:P,class:"px-2"},[f(I,{class:"relative mb-3",name:[`${c}`,t.key],rules:[{required:t.required,message:`${t.label} is required`}]},{default:v(()=>[t.type==="Password"?(l(),p(j,{key:0,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):t.type==="LongText"?(l(),p(B,{key:1,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):t.type==="Checkbox"?(l(),p(F,{key:2,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):(l(),p(T,{key:3,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])),c!==0&&P===s(a).formDetails.items.length-1?(l(),n("div",Ce,[(l(),p(J(("iconMap"in o?o.iconMap:s(L)).delete),{class:"hover:text-red-400 cursor-pointer",onClick:d=>W(c)},null,8,["onClick"]))])):U("",!0)]),_:2},1032,["name","rules"])]))),128))]))),128))]),i("tfoot",null,[i("tr",null,[i("td",{colspan:s(a).formDetails.items.length,class:"text-center"},[f(q,{type:"default",class:"!bg-gray-100 rounded-md border-none mr-1",onClick:Q},{icon:v(()=>[(l(),p(J(("iconMap"in o?o.iconMap:s(L)).plus),{class:"flex mx-auto"}))]),_:1})],8,Ue)])])])])):(l(!0),n(k,{key:1},g(s(a).formDetails.items,(e,c)=>(l(),p(I,{key:c,label:e.label,name:e.key,rules:[{required:e.required,message:`${e.label} is required`}]},{default:v(()=>[e.type==="Password"?(l(),p(j,{key:0,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="LongText"?(l(),p(B,{key:1,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="Checkbox"?(l(),p(F,{key:2,checked:s(r)[e.key],"onUpdate:checked":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["checked","onUpdate:checked","placeholder"])):(l(),p(T,{key:3,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label","name","rules"]))),128)),i("div",Se,[(l(!0),n(k,null,g(s(a).formDetails.actions,(e,c)=>(l(),p(X,{key:c,class:"!px-5",loading:s(y)===e.key,type:e.key==="save"?"primary":"default",disabled:!!s(y),onClick:t=>H(e.key)},{default:v(()=>[A(S(e.label),1)]),_:2},1032,["loading","type","disabled","onClick"]))),128))])]),_:1},16,["model"])]))}}});export{Le as default};
