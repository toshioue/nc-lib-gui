import P from"./BV5EkxN-.js";import Q from"./CtMydB5S.js";import{_ as Y}from"./BkiSZLeF.js";import{f as L,ad as O,bN as h,fP as H,r as g,d9 as R,cY as U,N as J,cM as q,cQ as W,o as v,S as x,w as k,P as o,c as X,fO as Z,a as r,t as c,T as z,Q as F,fr as ee,fQ as ae,aj as N,ak as G,A as K,ar as te,az as se,cR as oe,gC as le,g as ne,ae as ie,b as B,d as E,U as ce,aL as re,d0 as A,a0 as ue,hj as de}from"./3QBYHahY.js";import{_ as me}from"./CJ26qO3d.js";import{a as pe}from"./BteOdwRG.js";import{C as fe}from"./Dg1gNFnz.js";import{_ as _e}from"./CyuhXrst.js";const ve={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700 mb-4"},be={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.5",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ie=L({__name:"DeleteColumnModal",props:{visible:{type:Boolean},onDeleteColumn:{type:Function}},emits:["update:visible"],setup($,{emit:D}){const u=$,d=O(u,"visible",D),{$api:S,$e:l}=K(),e=h(H),m=h(R,g()),{getMeta:p}=U(),{includeM2M:M}=J(),{loadTables:T}=q(),V=W(),f=g(!1),I=async()=>{var s,n,i,a,t,_,C,y;if(e!=null&&e.value){f.value=!0;try{await S.dbTableColumn.delete((s=e==null?void 0:e.value)==null?void 0:s.id),await p((n=m==null?void 0:m.value)==null?void 0:n.id,!0),ee(e==null?void 0:e.value)&&((i=e.value)!=null&&i.colOptions)&&(await p(((a=e.value)==null?void 0:a.colOptions).fk_related_model_id,!0),M.value&&((t=e.value)==null?void 0:t.colOptions).type===ae.MANY_TO_MANY&&T()),V.updateViewCoverImageColumnId({metaId:(_=m.value)==null?void 0:_.id,columnIds:new Set([(C=e==null?void 0:e.value)==null?void 0:C.id])}),l("a:column:delete"),d.value=!1,(y=u.onDeleteColumn)==null||y.call(u)}catch(j){N.error(await G(j))}finally{f.value=!1}}};return(s,n)=>{const i=P,a=Q,t=Y;return v(),x(t,{visible:o(d),"onUpdate:visible":n[0]||(n[0]=_=>F(d)?d.value=_:null),"entity-name":s.$t("objects.column"),"on-delete":I},{"entity-preview":k(()=>[o(e)?(v(),X("div",ve,[o(Z)(o(e))?(v(),x(i,{key:0,class:"nc-view-icon"})):(v(),x(a,{key:1,class:"nc-view-icon"})),r("div",be,c(o(e).title),1)])):z("",!0)]),_:1},8,["visible","entity-name"])}}}),ye={class:"prose-xl font-bold self-center"},we=r("div",{class:"mt-4"},"Are you sure you want to duplicate the field?",-1),ke={class:"prose-md self-center text-gray-500 mt-4"},ge={class:"text-xs p-2"},xe={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},je=L({__name:"ColumnDuplicate",props:{modelValue:{type:Boolean},column:{},extra:{}},emits:["update:modelValue"],setup($,{expose:D,emit:u}){const b=$,d=u,{api:S}=te(),l=O(b,"modelValue",d),{$e:e,$poller:m}=K();se(oe());const p=h(le),{eventBus:M}=pe(),{getMeta:T}=U(),V=h(R,g()),f=g({includeData:!0}),I=ne(()=>{const{includeData:a}=f.value;return{excludeData:!a}}),s=g(!1),n=async()=>{await T(V.value.id,!0),M.emit(de.FIELD_RELOAD),p==null||p.trigger()},i=async()=>{try{s.value=!0;const a=await S.dbTable.duplicateColumn(b.column.base_id,b.column.id,{options:I.value,extra:b.extra});m.subscribe({id:a.id},async t=>{t.status!=="close"&&(t.status===A.COMPLETED?(n(),s.value=!1,l.value=!1):t.status===A.FAILED&&(N.error("There was an error duplicating the column."),n(),s.value=!1,l.value=!1))}),e("a:column:duplicate")}catch(a){N.error(await G(a)),s.value=!1,l.value=!1}};return ie("Enter",()=>{l.value&&i()}),D({duplicate:i}),(a,t)=>{const _=_e,C=fe,y=ue,j=me;return v(),x(j,{visible:o(l),"onUpdate:visible":t[2]||(t[2]=w=>F(l)?l.value=w:null),class:ce([{active:o(l)},"!w-[30rem]"]),closable:!o(s),"mask-closable":!o(s),keyboard:!o(s),centered:"","wrap-class-name":"nc-modal-column-duplicate",footer:null,onKeydown:t[3]||(t[3]=re(w=>l.value=!1,["esc"]))},{default:k(()=>[r("div",null,[r("div",ye,c(a.$t("general.duplicate"))+" "+c(a.$t("objects.column")),1),we,r("div",ke,c(a.$t("title.advancedSettings")),1),B(_,{class:"!m-0 !p-0 !my-2"}),r("div",ge,[B(C,{checked:o(f).includeData,"onUpdate:checked":t[0]||(t[0]=w=>o(f).includeData=w),disabled:o(s)},{default:k(()=>[E(c(a.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"])])]),r("div",xe,[o(s)?z("",!0):(v(),x(y,{key:"back",type:"secondary",onClick:t[1]||(t[1]=w=>l.value=!1)},{default:k(()=>[E(c(a.$t("general.cancel")),1)]),_:1})),B(y,{key:"submit",type:"primary",loading:o(s),onClick:i},{default:k(()=>[E(c(a.$t("general.confirm")),1)]),_:1},8,["loading"])])]),_:1},8,["visible","class","closable","mask-closable","keyboard"])}}});export{Ie as _,je as a};
