import{e as oe,ag as ue,L as re,bL as f,g2 as ie,r as o,hK as ce,h_ as de,aA as ve,aC as fe,i2 as me,aD as pe,h5 as ye,ha as De,f as I,dc as ke,h0 as ge,cq as $,D as he,ad as L,F as T,d0 as we,il as Ce,g as be,cA as Ie,aE as $e,j4 as Ve,o as V,c as q,b as Me,w as Q,a as K,N as t,Q as N,O as U,a7 as je,W as z,R as W,S as Ee,ao as Ye,Y as Fe,_ as Pe}from"./DZZ6t_j4.js";import{_ as xe}from"./CdfAcTJv.js";import{_ as Oe}from"./vK-WmZ7a.js";import"./CToWLgER.js";import"./jD721dGr.js";const Se=["title"],Be=["value","placeholder","readonly"],Ke={class:"w-[256px]"},Ne={key:0,class:"absolute inset-0 z-90 cursor-pointer"},Ue=oe({__name:"DatePicker",props:{modelValue:{},isPk:{type:Boolean},showCurrentDateOption:{type:[Boolean,String]}},emits:["update:modelValue","currentDate"],setup(y,{emit:H}){const x=H,{t:_}=ue(),{showNull:O,isMobileMode:J}=re(),M=f(ie,null),h=f(ce,o(!1)),w=f(de,o(!1)),j=f(ve,o(!1)),c=f(fe,o(!1)),p=f(me,o(!1)),X=f(pe,o(!1)),Z=f(ye,o(!1)),C=f(De,o(!1)),E=o(!1),d=o(),g=I(()=>{var e,a;return((a=ke((e=M==null?void 0:M.value)==null?void 0:e.meta))==null?void 0:a.date_format)??"YYYY-MM-DD"}),S=I(()=>ge(g.value)?"month":""),Y=o(!1),l=o(!1),r=o(),s=I({get(){if(!y.modelValue||Y.value)return;if(!$(y.modelValue).isValid()){E.value=!0;return}const e=S.value==="month"?g:"YYYY-MM-DD";return $(/^\d+$/.test(y.modelValue)?+y.modelValue:y.modelValue,e)},set(e){if(Y.value=!1,!e){x("update:modelValue",null);return}S.value==="month"&&(e=$(e).date(1)),e.isValid()&&x("update:modelValue",e==null?void 0:e.format("YYYY-MM-DD")),l.value=!1}});he(()=>{s.value&&(r.value=s.value)});const v=`picker_${Math.floor(Math.random()*99999)}`;L(d,e=>{var a,n,u;(a=e.target)!=null&&a.closest(`.${v}, .nc-${v}`)||((u=(n=d.value)==null?void 0:n.blur)==null||u.call(n),l.value=!1)});const ee=e=>{var a,n;(a=e==null?void 0:e.relatedTarget)!=null&&a.closest(`.${v}, .nc-${v}`)||(n=e==null?void 0:e.target)!=null&&n.closest(`.${v}, .nc-${v}`)||(l.value=!1)},ae=()=>{l.value=!0};T(l,e=>{var a,n;e?(c.value=!0,(n=(a=d.value)==null?void 0:a.focus)==null||n.call(a),L(document.querySelector(`.${v}`),u=>{var m;(m=u==null?void 0:u.target)!=null&&m.closest(`.nc-${v}`)||(l.value=!1)})):Y.value=!1},{flush:"post"}),T(c,e=>{p.value&&e&&!l.value&&(l.value=!0)});const te=I(()=>(X.value||C.value)&&!E.value||p.value&&!O.value&&!E.value&&!we(M.value)&&j.value||w.value?g.value:y.modelValue===null&&O.value?_("general.null").toUpperCase():E.value?_("msg.invalidDate"):""),F=I(()=>h.value||(h.value||s.value&&y.isPk)&&!j.value&&!c.value?!1:l.value),D=f(Ce,null),B=()=>{h.value||l.value||(l.value=j.value||c.value)};be(()=>{D==null||D.on(B)}),Ie(()=>{D==null||D.on(B)});const le=()=>{D||B()},ne=(e,a)=>{var n,u,m,i,k,b,P,A;switch(e.key!=="Enter"&&e.key!=="Tab"&&e.stopPropagation(),e.key){case"Enter":e.preventDefault(),Z.value&&e.stopPropagation(),s.value=r.value,l.value=!a,l.value||(c.value=!1,p.value&&!C.value&&!w.value&&((u=(n=d.value)==null?void 0:n.blur)==null||u.call(n)));return;case"Escape":a?(l.value=!1,c.value=!1,p.value&&!C.value&&!w.value&&((i=(m=d.value)==null?void 0:m.blur)==null||i.call(m))):(c.value=!1,(b=(k=d.value)==null?void 0:k.blur)==null||b.call(k));return;case"Tab":l.value=!1,p.value&&(c.value=!1,(A=(P=d.value)==null?void 0:P.blur)==null||A.call(P));return;default:!a&&/^[0-9a-z]$/i.test(e.key)&&(l.value=!0)}};$e(document,"keydown",e=>{if(j.value&&!(e.altKey||e.shiftKey||!p.value||C.value||w.value||Ve())){if(e.metaKey||e.ctrlKey)if(e.key===";")p.value&&!C.value&&!w.value&&(s.value=$(new Date),e.preventDefault());else return;!F.value&&d.value&&/^[0-9a-z]$/i.test(e.key)&&(Y.value=!0,d.value.focus(),c.value=!0,l.value=!0)}});const se=e=>{const a=e.target.value;if(!a){r.value=void 0;return}const n=$(a,g.value);n.isValid()&&(r.value=n)};function R(e){r.value=e,s.value=e,l.value=!1}const G=e=>{x("currentDate",e),l.value=!1};return(e,a)=>{const n=Fe,u=xe,m=Oe;return V(),q(Ye,null,[Me(m,{visible:t(F),"auto-close":!1,trigger:["click"],class:Ee(["nc-cell-field",[`nc-${v}`,{"nc-null":e.modelValue===null&&t(O)}]]),"overlay-class-name":`${v} nc-picker-date ${t(l)?"active":""} !min-w-[260px]`},{overlay:Q(()=>[K("div",Ke,[t(S)==="month"?(V(),N(u,{key:0,"page-date":t(r),"onUpdate:pageDate":a[4]||(a[4]=i=>U(r)?r.value=i:null),"selected-date":t(s),"onUpdate:selectedDate":a[5]||(a[5]=i=>U(s)?s.value=i:null),"is-open":t(F),type:"month",size:"medium","show-current-date-option":e.showCurrentDateOption,onCurrentDate:G},null,8,["page-date","selected-date","is-open","show-current-date-option"])):(V(),N(u,{key:1,"page-date":t(r),"onUpdate:pageDate":a[6]||(a[6]=i=>U(r)?r.value=i:null),"is-open":t(F),"selected-date":t(s),type:"date",size:"medium","show-current-date-option":e.showCurrentDateOption,"onUpdate:selectedDate":R,onCurrentDate:G},null,8,["page-date","is-open","selected-date","show-current-date-option"]))])]),default:Q(()=>{var i,k;return[K("div",je(e.$attrs,{title:(i=t(s))==null?void 0:i.format(t(g)),class:"nc-date-picker h-full flex items-center justify-between ant-picker-input relative"}),[K("input",{ref_key:"datePickerRef",ref:d,type:"text",value:((k=t(s))==null?void 0:k.format(t(g)))??"",placeholder:t(te),class:"nc-date-input border-none outline-none !text-current bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:t(h)||!!t(J),onBlur:ee,onFocus:ae,onKeydown:a[0]||(a[0]=b=>ne(b,t(l))),onMouseup:a[1]||(a[1]=z(()=>{},["stop"])),onMousedown:a[2]||(a[2]=z(()=>{},["stop"])),onClick:le,onInput:se},null,40,Be),t(s)&&!t(h)?(V(),N(n,{key:0,icon:"closeCircle",class:"nc-clear-date-icon nc-action-icon absolute right-0 top-[50%] transform -translate-y-1/2 invisible cursor-pointer",onClick:a[3]||(a[3]=z(b=>R(),["stop"]))})):W("",!0)],16,Se)]}),_:1},8,["visible","class","overlay-class-name"]),!t(c)&&t(p)?(V(),q("div",Ne)):W("",!0)],64)}}}),Le=Pe(Ue,[["__scopeId","data-v-fa5e59d0"]]);export{Le as default};
