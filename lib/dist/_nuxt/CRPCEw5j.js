const __vite__fileDeps=["./Did2aa5l.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./RichTextOptions.CZoe1RIi.css","./CWm929xG.js","./C9Sjn86N.js","./C4K5fdHe.js","./ByVBARmO.js","./PlainCell.1kvaRUkA.css","./Co32XBKZ.js","./BDAIZopQ.js","./VirtualCell.Dgszrgh-.css","./Dby8gS7l.js","./37hePIet.js","./Cell.CE2XxAOg.css","./BIhr-Z4C.js","./VirtualCell.BYk4C8Tn.css","./DG2ZH8TR.js","./CA74dF2b.js","./GMLocJHP.js","./qW2V2r_p.js","./boyBAVNN.js","./Cell.DUBzJZSm.css","./B9n4-CGo.js","./DivDataCell.1yCNpUg3.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{am as xe,aP as ae,e as je,ar as Ba,r as $,g as ht,a$ as ze,F as Ne,cA as ua,f as Se,hV as Ua,aQ as mt,aU as At,al as Ue,b as i,aV as fa,cx as ja,cz as Ha,c7 as va,ix as Ka,aj as Wa,aX as ma,bL as Ae,ak as Ya,fD as Ot,az as lt,cb as Lt,cc as qa,i2 as Ga,cU as Xa,ab as pa,aE as Zt,ad as ya,M as it,o as n,c as g,N as e,t as U,R as X,ao as Ie,Q as L,S as _e,W as ft,P as Ce,w as y,Y as wt,Z as Pt,X as Je,a4 as Qe,L as _t,J as xt,iy as ha,K as wa,ax as Xe,ay as It,d7 as zt,u as _a,a as f,at as pt,d as he,T as Te,U as Ve,O as Ge,aJ as Dt,gf as yt,aL as xa,$ as Ft,_ as gt,ag as ga,dz as ba,cL as Ja,gO as Qa,d4 as st,d6 as Za,cX as en,dJ as rt,iw as vt,c$ as Tt,cq as Ke,V as tn,ah as Oe,ai as Be,cW as an,g$ as nt,f$ as Ye,y as nn,fU as on,cO as ln,a5 as We,gT as sn,il as rn,iz as cn,d0 as ut,i4 as dn,ha as un,ca as ea,aF as ta,fE as aa,a7 as fn,hA as vn,i8 as mn,i9 as pn,aK as yn}from"./DZZ6t_j4.js";import{_ as Ca}from"./sz1d3zjm.js";import{_ as ka}from"./TJfB7GlU.js";import{_ as $a}from"./BLgccLvp.js";import{_ as Bt}from"./vK-WmZ7a.js";import hn from"./B9n4-CGo.js";import{_ as Sa}from"./DnwRMKX3.js";import{_ as Ra}from"./B6xrG0q8.js";import{T as wn,S as _n,U as xn,L as gn,P as bn,u as Cn,E as kn,g as $n,_ as Sn}from"./BmNyaTYf.js";import{m as Rn}from"./Dwil3It4.js";import{t as En}from"./Cy50pBgZ.js";import{u as Ea}from"./uhBJvRY2.js";import{u as Ma}from"./DS_HXCWn.js";import{u as Mn,a as On}from"./Bgw0NQgX.js";import{t as Nt}from"./2FgppHLC.js";import{u as Ln}from"./GMLocJHP.js";import{u as Dn}from"./CA74dF2b.js";import{e as qe,p as Tn,r as Vn}from"./BDAIZopQ.js";import{a as Oa}from"./C4o9gerC.js";import{_ as An}from"./Ck-cgwga.js";import{_ as Nn}from"./BqKQ8afS.js";import{a as Pn}from"./i4aLU0Nw.js";import{u as In}from"./B05h-4V9.js";import{u as zn}from"./qW2V2r_p.js";import{u as Fn}from"./EqBqqo9-.js";import{g as na,a as Bn,j as Un,i as jn,h as Hn}from"./ByVBARmO.js";import{_ as oa}from"./Bdv7ru7D.js";import{S as Kn}from"./BmtvKY7O.js";import"./0azk-b-q.js";import"./B89oU1M4.js";import"./DKN1hQ6S.js";import"./BQuyMdA-.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";import"./CMIIcM5i.js";import"./boyBAVNN.js";import"./DgixBgIx.js";import"./CXD-Dj4T.js";import"./DXQuLwNn.js";var La=function(){return{prefixCls:String,width:ae.oneOfType([ae.string,ae.number]),height:ae.oneOfType([ae.string,ae.number]),style:{type:Object,default:void 0},class:String,placement:{type:String},wrapperClassName:String,level:{type:[String,Array]},levelMove:{type:[Number,Function,Array]},duration:String,ease:String,showMask:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},maskStyle:{type:Object,default:void 0},afterVisibleChange:Function,keyboard:{type:Boolean,default:void 0},contentWrapperStyle:{type:Object,default:void 0},autofocus:{type:Boolean,default:void 0},open:{type:Boolean,default:void 0}}},Wn=function(){return xe(xe({},La()),{},{forceRender:{type:Boolean,default:void 0},getContainer:ae.oneOfType([ae.string,ae.func,ae.object,ae.looseBool])})},Yn=function(){return xe(xe({},La()),{},{getContainer:Function,getOpenCount:Function,scrollLocker:ae.any,switchScrollingEffect:Function})};function qn(o){return Array.isArray(o)?o:[o]}var Da={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend"},Gn=Object.keys(Da).filter(function(o){if(typeof document>"u")return!1;var t=document.getElementsByTagName("html")[0];return o in(t?t.style:{})})[0],la=Da[Gn];function sa(o,t,r,S){o.addEventListener?o.addEventListener(t,r,S):o.attachEvent&&o.attachEvent("on".concat(t),r)}function ra(o,t,r,S){o.removeEventListener?o.removeEventListener(t,r,S):o.attachEvent&&o.detachEvent("on".concat(t),r)}function Xn(o,t){var r=typeof o=="function"?o(t):o;return Array.isArray(r)?r.length===2?r:[r[0],r[1]]:[r]}var ia=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},Vt=!(typeof window<"u"&&window.document&&window.document.createElement),Jn=function o(t,r,S,p){if(!r||r===document||r instanceof Document)return!1;if(r===t.parentNode)return!0;var Q=Math.max(Math.abs(S),Math.abs(p))===Math.abs(p),K=Math.max(Math.abs(S),Math.abs(p))===Math.abs(S),P=r.scrollHeight-r.clientHeight,C=r.scrollWidth-r.clientWidth,x=document.defaultView.getComputedStyle(r),ve=x.overflowY==="auto"||x.overflowY==="scroll",I=x.overflowX==="auto"||x.overflowX==="scroll",j=P&&ve,u=C&&I;return Q&&(!j||j&&(r.scrollTop>=P&&p<0||r.scrollTop<=0&&p>0))||K&&(!u||u&&(r.scrollLeft>=C&&S<0||r.scrollLeft<=0&&S>0))?o(t,r.parentNode,S,p):!1},Qn=["width","height","open","prefixCls","placement","level","levelMove","ease","duration","getContainer","onChange","afterVisibleChange","showMask","maskClosable","maskStyle","keyboard","getOpenCount","scrollLocker","contentWrapperStyle","style","class"],ot={},ca=je({compatConfig:{MODE:3},inheritAttrs:!1,props:Yn(),emits:["close","handleClick","change"],setup:function(t,r){var S=r.emit,p=r.slots,Q=Ba({startPos:{x:null,y:null}}),K,P=$(),C=$(),x=$(),ve=$(),I=$(),j=[],u="drawer_id_".concat(Number((Date.now()+Math.random()).toString().replace(".",Math.round(Math.random()*9).toString())).toString(16)),M=!Vt&&Ha?{passive:!1}:!1;ht(function(){ze(function(){var h=t.open,s=t.getContainer,m=t.showMask,O=t.autofocus,N=s==null?void 0:s();if(le(t),h&&(N&&N.parentNode===document.body&&(ot[u]=h),A(),ze(function(){O&&W()}),m)){var q;(q=t.scrollLocker)===null||q===void 0||q.lock()}})}),Ne(function(){return t.level},function(){le(t)},{flush:"post"}),Ne(function(){return t.open},function(){var h=t.open,s=t.getContainer,m=t.scrollLocker,O=t.showMask,N=t.autofocus,q=s==null?void 0:s();q&&q.parentNode===document.body&&(ot[u]=!!h),A(),h?(N&&W(),O&&(m==null||m.lock())):m==null||m.unLock()},{flush:"post"}),ua(function(){var h,s=t.open;delete ot[u],s&&(fe(!1),document.body.style.touchAction=""),(h=t.scrollLocker)===null||h===void 0||h.unLock()}),Ne(function(){return t.placement},function(h){h&&(I.value=null)});var W=function(){var s,m;(s=C.value)===null||s===void 0||(m=s.focus)===null||m===void 0||m.call(s)},Y=function(s){s.touches.length>1||(Q.startPos={x:s.touches[0].clientX,y:s.touches[0].clientY})},R=function(s){if(!(s.changedTouches.length>1)){var m=s.currentTarget,O=s.changedTouches[0].clientX-Q.startPos.x,N=s.changedTouches[0].clientY-Q.startPos.y;(m===x.value||m===ve.value||m===I.value&&Jn(m,s.target,O,N))&&s.cancelable&&s.preventDefault()}},Ee=function h(s){var m=s.target;ra(m,la,h),m.style.transition=""},$e=function(s){S("close",s)},z=function(s){s.keyCode===ja.ESC&&(s.stopPropagation(),$e(s))},l=function(s){var m=t.open,O=t.afterVisibleChange;s.target===P.value&&s.propertyName.match(/transform$/)&&(C.value.style.transition="",!m&&H()&&(document.body.style.overflowX="",x.value&&(x.value.style.left="",x.value.style.width="")),O&&O(!!m))},w=Se(function(){var h=t.placement,s=h==="left"||h==="right",m="translate".concat(s?"X":"Y");return{isHorizontal:s,placementName:m}}),A=function(){var s=t.open,m=t.width,O=t.height,N=w.value,q=N.isHorizontal,T=N.placementName,te=I.value?I.value.getBoundingClientRect()[q?"width":"height"]:0,d=(q?m:O)||te;Z(s,T,d)},fe=function(s,m,O,N){var q=t.placement,T=t.levelMove,te=t.duration,d=t.ease,v=t.showMask;j.forEach(function(we){we.style.transition="transform ".concat(te," ").concat(d),sa(we,la,Ee);var re=s?O:0;if(T){var be=Xn(T,{target:we,open:s});re=s?be[0]:be[1]||0}var F=typeof re=="number"?"".concat(re,"px"):re,B=q==="left"||q==="top"?F:"-".concat(F);B=v&&q==="right"&&N?"calc(".concat(B," + ").concat(N,"px)"):B,we.style.transform=re?"".concat(m,"(").concat(B,")"):""})},Z=function(s,m,O){if(!Vt){var N=document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth?Ua(!0):0;fe(s,m,O,N),_(N)}S("change",s)},_=function(s){var m=t.getContainer,O=t.showMask,N=t.open,q=m==null?void 0:m();if(q&&q.parentNode===document.body&&O){var T=["touchstart"],te=[document.body,x.value,ve.value,I.value];N&&document.body.style.overflow!=="hidden"?(s&&b(s),document.body.style.touchAction="none",te.forEach(function(d,v){d&&sa(d,T[v]||"touchmove",v?R:Y,M)})):H()&&(document.body.style.touchAction="",s&&E(s),te.forEach(function(d,v){d&&ra(d,T[v]||"touchmove",v?R:Y,M)}))}},b=function(s){var m=t.placement,O=t.duration,N=t.ease,q="width ".concat(O," ").concat(N),T="transform ".concat(O," ").concat(N);switch(C.value.style.transition="none",m){case"right":C.value.style.transform="translateX(-".concat(s,"px)");break;case"top":case"bottom":C.value.style.width="calc(100% - ".concat(s,"px)"),C.value.style.transform="translateZ(0)";break}clearTimeout(K),K=setTimeout(function(){C.value&&(C.value.style.transition="".concat(T,",").concat(q),C.value.style.width="",C.value.style.transform="")})},E=function(s){var m=t.placement,O=t.duration,N=t.ease;C.value.style.transition="none";var q,T="width ".concat(O," ").concat(N),te="transform ".concat(O," ").concat(N);switch(m){case"left":{C.value.style.width="100%",T="width 0s ".concat(N," ").concat(O);break}case"right":{C.value.style.transform="translateX(".concat(s,"px)"),C.value.style.width="100%",T="width 0s ".concat(N," ").concat(O),x.value&&(x.value.style.left="-".concat(s,"px"),x.value.style.width="calc(100% + ".concat(s,"px)"));break}case"top":case"bottom":{C.value.style.width="calc(100% + ".concat(s,"px)"),C.value.style.height="100%",C.value.style.transform="translateZ(0)",q="height 0s ".concat(N," ").concat(O);break}}clearTimeout(K),K=setTimeout(function(){C.value&&(C.value.style.transition="".concat(te,",").concat(q?"".concat(q,","):"").concat(T),C.value.style.transform="",C.value.style.width="",C.value.style.height="")})},H=function(){return!Object.keys(ot).some(function(s){return ot[s]})},le=function(s){var m=s.level,O=s.getContainer;if(!Vt){var N=O==null?void 0:O(),q=N?N.parentNode:null;if(j=[],m==="all"){var T=q?Array.prototype.slice.call(q.children):[];T.forEach(function(te){te.nodeName!=="SCRIPT"&&te.nodeName!=="STYLE"&&te.nodeName!=="LINK"&&te!==N&&j.push(te)})}else m&&qn(m).forEach(function(te){document.querySelectorAll(te).forEach(function(d){j.push(d)})})}},me=function(s){S("handleClick",s)},ge=$(!1);return Ne(C,function(){ze(function(){ge.value=!0})}),function(){var h,s,m,O=t.width,N=t.height,q=t.open,T=t.prefixCls,te=t.placement;t.level,t.levelMove,t.ease,t.duration,t.getContainer,t.onChange,t.afterVisibleChange;var d=t.showMask,v=t.maskClosable,we=t.maskStyle,re=t.keyboard;t.getOpenCount,t.scrollLocker;var be=t.contentWrapperStyle,F=t.style,B=t.class,se=mt(t,Qn),D=q&&ge.value,pe=At(T,(h={},Ue(h,"".concat(T,"-").concat(te),!0),Ue(h,"".concat(T,"-open"),D),Ue(h,B,!!B),Ue(h,"no-mask",!d),h)),ne=w.value.placementName,oe=te==="left"||te==="top"?"-100%":"100%",ye=D?"":"".concat(ne,"(").concat(oe,")");return i("div",xe(xe({},fa(se,["switchScrollingEffect","autofocus"])),{},{tabindex:-1,class:pe,style:F,ref:C,onKeydown:D&&re?z:void 0,onTransitionend:l}),[d&&i("div",{class:"".concat(T,"-mask"),onClick:v?$e:void 0,style:we,ref:x},null),i("div",{class:"".concat(T,"-content-wrapper"),style:xe({transform:ye,msTransform:ye,width:ia(O)?"".concat(O,"px"):O,height:ia(N)?"".concat(N,"px"):N},be),ref:P},[i("div",{class:"".concat(T,"-content"),ref:I},[(s=p.default)===null||s===void 0?void 0:s.call(p)]),p.handler?i("div",{onClick:me,ref:ve},[(m=p.handler)===null||m===void 0?void 0:m.call(p)]):null])])}}}),Zn=["afterVisibleChange","getContainer","wrapperClassName","forceRender"],eo=["visible","afterClose"],to=je({compatConfig:{MODE:3},inheritAttrs:!1,props:va(Wn(),{prefixCls:"drawer",placement:"left",getContainer:"body",level:"all",duration:".3s",ease:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",afterVisibleChange:function(){},showMask:!0,maskClosable:!0,maskStyle:{},wrapperClassName:"",keyboard:!0,forceRender:!1,autofocus:!0}),emits:["handleClick","close"],slots:["handler"],setup:function(t,r){var S=r.emit,p=r.slots,Q=$(null),K=function(x){S("handleClick",x)},P=function(x){S("close",x)};return function(){t.afterVisibleChange;var C=t.getContainer,x=t.wrapperClassName,ve=t.forceRender,I=mt(t,Zn),j=null;if(!C)return i("div",{class:x,ref:Q},[i(ca,xe(xe({},I),{},{open:t.open,getContainer:function(){return Q.value},onClose:P,onHandleClick:K}),p)]);var u=!!p.handler||ve;return(u||t.open||Q.value)&&(j=i(Ka,{visible:t.open,forceRender:u,getContainer:C,wrapperClassName:x},{default:function(W){var Y=W.visible,R=W.afterClose,Ee=mt(W,eo);return i(ca,xe(xe(xe({ref:Q},I),Ee),{},{open:Y!==void 0?Y:t.open,afterVisibleChange:R!==void 0?R:t.afterVisibleChange,onClose:P,onHandleClick:K}),p)}})),j}}}),ao=["width","height","visible","placement","mask","wrapClassName","class"],no=ma("top","right","bottom","left");ma("default","large");var da={distance:180},oo=function(){return{autofocus:{type:Boolean,default:void 0},closable:{type:Boolean,default:void 0},closeIcon:ae.any,destroyOnClose:{type:Boolean,default:void 0},forceRender:{type:Boolean,default:void 0},getContainer:ae.any,maskClosable:{type:Boolean,default:void 0},mask:{type:Boolean,default:void 0},maskStyle:{type:Object,default:void 0},wrapStyle:{type:Object,default:void 0},style:{type:Object,default:void 0},class:ae.any,wrapClassName:String,size:{type:String},drawerStyle:{type:Object,default:void 0},headerStyle:{type:Object,default:void 0},bodyStyle:{type:Object,default:void 0},contentWrapperStyle:{type:Object,default:void 0},title:ae.any,visible:{type:Boolean,default:void 0},width:ae.oneOfType([ae.string,ae.number]),height:ae.oneOfType([ae.string,ae.number]),zIndex:Number,prefixCls:String,push:ae.oneOfType([ae.looseBool,{type:Object}]),placement:ae.oneOf(no),keyboard:{type:Boolean,default:void 0},extra:ae.any,footer:ae.any,footerStyle:{type:Object,default:void 0},level:ae.any,levelMove:{type:[Number,Array,Function]},handle:ae.any,afterVisibleChange:Function,onAfterVisibleChange:Function,"onUpdate:visible":Function,onClose:Function}},lo=je({compatConfig:{MODE:3},name:"ADrawer",inheritAttrs:!1,props:va(oo(),{closable:!0,placement:"right",maskClosable:!0,mask:!0,level:null,keyboard:!0,push:da}),slots:["closeIcon","title","extra","footer","handle"],setup:function(t,r){var S=r.emit,p=r.slots,Q=r.attrs,K=$(!1),P=$(!1),C=$(null),x=Ae("parentDrawerOpts",null),ve=Ya("drawer",t),I=ve.prefixCls;Ot(!t.afterVisibleChange,"Drawer","`afterVisibleChange` prop is deprecated, please use `@afterVisibleChange` event instead"),Ot(t.wrapStyle===void 0,"Drawer","`wrapStyle` prop is deprecated, please use `style` instead"),Ot(t.wrapClassName===void 0,"Drawer","`wrapClassName` prop is deprecated, please use `class` instead");var j=function(){K.value=!0},u=function(){K.value=!1,ze(function(){M()})};lt("parentDrawerOpts",{setPush:j,setPull:u}),ht(function(){var _=t.visible;_&&x&&x.setPush()}),ua(function(){x&&x.setPull()}),Ne(function(){return t.visible},function(_){x&&(_?x.setPush():x.setPull())},{flush:"post"});var M=function(){var b,E;(b=C.value)===null||b===void 0||(E=b.domFocus)===null||E===void 0||E.call(b)},W=function(b){S("update:visible",!1),S("close",b)},Y=function(b){var E;(E=t.afterVisibleChange)===null||E===void 0||E.call(t,b),S("afterVisibleChange",b)},R=Se(function(){return t.destroyOnClose&&!t.visible}),Ee=function(){var b=R.value;b&&(t.visible||(P.value=!0))},$e=Se(function(){var _=t.push,b=t.placement,E;return typeof _=="boolean"?E=_?da.distance:0:E=_.distance,E=parseFloat(String(E||0)),b==="left"||b==="right"?"translateX(".concat(b==="left"?E:-E,"px)"):b==="top"||b==="bottom"?"translateY(".concat(b==="top"?E:-E,"px)"):null}),z=Se(function(){var _=t.visible,b=t.mask,E=t.placement,H=t.size,le=H===void 0?"default":H,me=t.width,ge=t.height;if(!_&&!b)return{};var h={};if(E==="left"||E==="right"){var s=le==="large"?736:378;h.width=typeof me>"u"?s:me,h.width=typeof h.width=="string"?h.width:"".concat(h.width,"px")}else{var m=le==="large"?736:378;h.height=typeof ge>"u"?m:ge,h.height=typeof h.height=="string"?h.height:"".concat(h.height,"px")}return h}),l=Se(function(){var _=t.zIndex,b=t.wrapStyle,E=t.mask,H=t.style,le=E?{}:z.value;return xe(xe(xe({zIndex:_,transform:K.value?$e.value:void 0},le),b),H)}),w=function(b){var E=t.closable,H=t.headerStyle,le=Lt(p,t,"extra"),me=Lt(p,t,"title");return!me&&!E?null:i("div",{class:At("".concat(b,"-header"),Ue({},"".concat(b,"-header-close-only"),E&&!me&&!le)),style:H},[i("div",{class:"".concat(b,"-header-title")},[A(b),me&&i("div",{class:"".concat(b,"-title")},[me])]),le&&i("div",{class:"".concat(b,"-extra")},[le])])},A=function(b){var E,H=t.closable,le=p.closeIcon?(E=p.closeIcon)===null||E===void 0?void 0:E.call(p):t.closeIcon;return H&&i("button",{key:"closer",onClick:W,"aria-label":"Close",class:"".concat(b,"-close")},[le===void 0?i(qa,null,null):le])},fe=function(b){var E;if(P.value&&!t.visible)return null;P.value=!1;var H=t.bodyStyle,le=t.drawerStyle,me={},ge=R.value;return ge&&(me.opacity=0,me.transition="opacity .3s"),i("div",{class:"".concat(b,"-wrapper-body"),style:xe(xe({},me),le),onTransitionend:Ee},[w(b),i("div",{key:"body",class:"".concat(b,"-body"),style:H},[(E=p.default)===null||E===void 0?void 0:E.call(p)]),Z(b)])},Z=function(b){var E=Lt(p,t,"footer");if(!E)return null;var H="".concat(b,"-footer");return i("div",{class:H,style:t.footerStyle},[E])};return function(){var _;t.width,t.height;var b=t.visible,E=t.placement,H=t.mask,le=t.wrapClassName,me=t.class,ge=mt(t,ao),h=H?z.value:{},s=H?"":"no-mask",m=xe(xe(xe(xe({},Q),fa(ge,["size","closeIcon","closable","destroyOnClose","drawerStyle","headerStyle","bodyStyle","title","push","wrapStyle","onAfterVisibleChange","onClose","onUpdate:visible"])),h),{},{onClose:W,afterVisibleChange:Y,handler:!1,prefixCls:I.value,open:b,showMask:H,placement:E,class:At((_={},Ue(_,me,me),Ue(_,le,!!le),Ue(_,s,!!s),_)),style:l.value,ref:C});return i(to,m,{handler:t.handle?function(){return t.handle}:p.handle,default:function(){return fe(I.value)}})}}});const so=Wa(lo),ro=Je(()=>Qe(()=>import("./Did2aa5l.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(o=>o.default||o)),io={key:0,class:"truncate"},co={key:0},uo={key:1,class:"flex justify-between pt-1 rich-text-bottom-bar items-center"},fo=je({__name:"RichComment",props:{hideOptions:{type:Boolean,default:!0},value:{},readOnly:{type:Boolean},syncValueChange:{type:Boolean},autofocus:{type:Boolean},placeholder:{},renderAsText:{type:Boolean}},emits:["update:value","focus","blur","save"],setup(o,{expose:t,emit:r}){const S=o,p=r,Q=Ae(Ga,$(!1)),K=$(!1),P=Xa(),C=new wn({});C.addRule("lineBreak",{filter:l=>l.nodeName==="BR",replacement:()=>"<br />"}),C.addRule("strikethrough",{filter:["s"],replacement:l=>`~${l}~`}),C.keep(["u","del"]);const x=$(null),ve=$(null),I=pa(S,"value",p,{defaultValue:""}),j=[_n.configure({heading:!1,codeBlock:!1,code:!1}),xn,gn,bn.configure({emptyEditorClass:"is-editor-empty",placeholder:S.placeholder})],u=Cn({extensions:j,onUpdate:({editor:l})=>{let w=C.turndown(l.getHTML().replaceAll(/<p><\/p>/g,"<br />"));((l==null?void 0:l.isActive("bulletList"))||(l==null?void 0:l.isActive("orderedList"))||(l==null?void 0:l.isActive("blockquote")))&&w.endsWith("<br />")&&(w=w.slice(0,-6)),w=w.replaceAll(/\n\n<br \/>\n\n/g,`<br>

`),I.value=w==="<br />"?"":`${w}`},editable:!S.readOnly,autofocus:S.autofocus,onFocus:()=>{K.value=!0,p("focus"),W()},onBlur:l=>{const w=l==null?void 0:l.event.relatedTarget;w&&(w!=null&&w.closest(".comment-bubble-menu, .nc-rich-text-comment, .tippy-box, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .nc-mention-list, .tippy-content, .nc-comment-rich-editor")||(K.value=!1,p("blur")))}}),M=(l,w)=>{if(!u.value)return;const A=u.value.view.state.selection,fe=l?Rn.parse(l):"<p></p>",Z=$n(fe,j);u.value.chain().setContent(Z).setTextSelection(A.to).run(),setTimeout(()=>{var _;if(w){const b=u.value.state.doc.nodeSize;(_=u.value)==null||_.chain().setTextSelection(b-1).run()}u.value.state.history$.prevRanges=null,u.value.state.history$.done.eventCount=0},100)};function W(){var l;!S.readOnly&&!P.shift.value&&((l=u.value)==null||l.chain().focus().run(),M(I.value,!0))}S.syncValueChange&&Ne([I,u],()=>{M(I.value)}),Zt(x,"focusout",l=>{var A;const w=l==null?void 0:l.relatedTarget;((A=w==null?void 0:w.classList)!=null&&A.contains("tiptap")||!(w!=null&&w.closest(".comment-bubble-menu, .nc-rich-text-comment, .tippy-box, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .nc-mention-list, .tippy-content, .nc-comment-rich-editor")))&&(K.value=!1,p("blur"))},!0),Zt(ve,"focusout",l=>{var A;const w=l==null?void 0:l.relatedTarget;!w&&((A=l.target)!=null&&A.closest(".comment-bubble-menu, .nc-comment-save-btn, .nc-mention-list, .mention, .rich-text-bottom-bar, .tippy-content, .nc-comment-rich-editor"))||w!=null&&w.closest(".comment-bubble-menu, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .tippy-content, .nc-mention-list, .nc-comment-rich-editor")||(K.value=!1,p("blur"))},!0),ya(x,l=>{if(!K.value)return;const w=l==null?void 0:l.target;w!=null&&w.closest(".tippy-content, .nc-rich-text-comment, .nc-comment-save-btn, .nc-mention-list, .rich-text-bottom-bar, .mention, .comment-bubble-menu, .nc-comment-rich-editor")||(K.value=!1,p("blur"))});const Y=$(!1),R=l=>{u.value&&(Y.value?Y.value=!1:u.value.isActive("bulletList")||u.value.isActive("orderedList")||u.value.isActive("blockquote")?l.stopPropagation():p("save"))},Ee=l=>{var A,fe,Z;((A=u.value)==null?void 0:A.isActive("bulletList"))||((fe=u.value)==null?void 0:fe.isActive("orderedList"))||((Z=u.value)==null?void 0:Z.isActive("blockquote"))?(Y.value=!0,setTimeout(()=>{Y.value=!1},1e3)):R(l)},$e=l=>{l.altKey&&l.key==="Enter"||l.shiftKey&&l.key==="Enter"?l.stopPropagation():l.key==="Enter"?Ee(l):l.key==="Escape"&&(K.value=!1,p("blur"))},z=l=>{l.preventDefault(),l.stopPropagation(),p("save")};return t({setEditorContent:M}),ht(()=>{S.readOnly&&setTimeout(()=>{document.querySelectorAll(".nc-rich-link-tooltip").forEach(l=>{const w=Object.values(l.attributes).find(A=>A.name==="data-tooltip");w&&En(l,{content:`<span class="tooltip">${w.value}</span>`,placement:"top",allowHTML:!0,arrow:!0,animation:"fade",duration:0})})},1e3)}),(l,w)=>{var E,H;const A=Sn,fe=ro,Z=wt,_=Pt,b=it("e");return n(),g("div",{class:_e([{readonly:l.readOnly,"nc-rich-text-grid":e(Q)},"nc-rich-text-comment flex flex-col w-full h-full"]),tabindex:1,onFocus:W},[l.renderAsText?(n(),g("div",io,[e(u)?(n(),g("span",co,U(((E=e(u))==null?void 0:E.getText())??""),1)):X("",!0)])):(n(),g(Ie,{key:1},[e(u)?(n(),L(A,{key:0,ref_key:"richTextLinkOptionRef",ref:ve,editor:e(u),"is-comment":!0,"is-form-field":!0,onBlur:w[0]||(w[0]=le=>K.value=!1)},null,8,["editor"])):X("",!0),i(e(kn),{ref_key:"editorDom",ref:x,editor:e(u),class:_e([{"p-1":!S.readOnly,"px-[0.25rem]":S.readOnly},"flex flex-col nc-comment-rich-editor w-full scrollbar-thin scrollbar-thumb-gray-200 nc-truncate scrollbar-track-transparent"]),onKeydown:ft($e,["stop"])},null,8,["editor","class"]),l.hideOptions?X("",!0):(n(),g("div",uo,[i(fe,{editor:e(u),class:"!bg-transparent"},null,8,["editor"]),Ce((n(),L(_,{disabled:!((H=e(I))!=null&&H.length),class:"!disabled:bg-gray-100 nc-comment-save-btn !h-7 !w-7 !shadow-none",size:"xsmall",onClick:z},{default:y(()=>[i(Z,{icon:"send"})]),_:1},8,["disabled"])),[[b,["a:row-expand:comment:save"]]])]))],64))],34)}}}),vo={key:0,class:"flex flex-col items-center justify-center w-full h-full"},mo={key:1,class:"flex flex-col h-full"},po={key:0,class:"flex flex-col my-1 text-center justify-center h-full nc-scrollbar-thin"},yo={class:"text-center text-3xl text-gray-700"},ho={class:"font-medium text-center my-6 text-gray-500"},wo={class:"flex items-start justify-between"},_o={class:"flex h-[28px] items-center gap-3 w-[calc(100%_-_40px)]"},xo={class:"truncate text-gray-800 font-medium !text-small !leading-[18px] overflow-hidden"},go={class:"bg-white rounded-lg"},bo={class:"flex items-center gap-4 py-3 px-2"},Co={class:"flex flex-col"},ko={class:"font-semibold text-gray-800"},$o={class:"text-xs text-gray-600"},So={key:0,class:"px-3 rounded-b-lg !text-[13px] items-center text-gray-600 flex gap-1 bg-gray-100 py-1.5"},Ro={class:"text-xs text-gray-500"},Eo={class:"flex items-center"},Mo={class:"flex gap-2 items-center"},Oo={class:"flex gap-2 items-center"},Lo={class:"flex gap-2 items-center"},Do={key:1},To={key:1,class:"space-y-1 pl-9"},Vo={key:2,class:"px-3 pb-3 nc-comment-input !rounded-br-2xl gap-2 flex"},Ao=je({__name:"Comments",setup(o){const{user:t,appInfo:r}=_t(),{dashboardUrl:S}=Ea(),{isUIAllowed:p}=xt(),{copy:Q}=ha(),K=wa(),P=Se(()=>p("commentEdit")),{isExpandedFormCommentMode:C}=Xe(Ma()),x=It(),{basesUser:ve}=Xe(x),I=Ae(zt,$()),{deleteComment:j,resolveComment:u,isCommentsLoading:M,comments:W,loadComments:Y,updateComment:R,saveComment:Ee,primaryKey:$e}=Mn(),z=$(),l=$(),w=$(!1),A=$(!1),fe=$(null),Z=$(),_=$(""),b=_a(),E=Se(()=>{var d,v;return(d=I.value)!=null&&d.base_id?ve.value.get((v=I.value)==null?void 0:v.base_id)||[]:[]});function H(){l.value&&l.value.scrollTo({top:l.value.scrollHeight,behavior:"smooth"})}const le=async()=>{var v,we,re,be;if(!_.value.trim())return;for(;_.value.endsWith("<br />")||_.value.endsWith(`
`);)_.value.endsWith("<br />")?_.value=_.value.slice(0,-6):_.value=_.value.slice(0,-2);A.value=!0,W.value=[...W.value,{id:`temp-${new Date().getTime()}`,comment:_.value,created_at:new Date().toISOString(),created_by:(v=t.value)==null?void 0:v.id,created_by_email:(we=t.value)==null?void 0:we.email,created_display_name:((re=t.value)==null?void 0:re.display_name)??""}];const d=_.value;_.value="",(be=Z==null?void 0:Z.value)==null||be.setEditorContent("",!0),await ze(()=>{H()});try{await Ee(d),await ze(()=>{C.value=!0}),H()}catch(F){console.error(F)}},me=async d=>{var v;await Q(encodeURI(`${S==null?void 0:S.value}#/${K.params.typeOrId}/${K.params.baseId}/${(v=I.value)==null?void 0:v.id}?rowId=${$e.value}&commentId=${d.id}`))};function ge(d){const v=document.querySelector(`.${d}`);v&&v.scrollIntoView({behavior:"smooth",block:"center"})}function h(d){w.value&&(d.preventDefault(),d.stopPropagation(),z.value=void 0,Y(),w.value=!1,z.value=void 0)}function s(d){z.value={...d},w.value=!0,ze(()=>{ge(d.id)})}const m=Se({get(){var d;return((d=z.value)==null?void 0:d.comment)||""},set(d){z.value&&(z.value.comment=d)}});async function O(){var v;if(!w.value||!((v=z.value)!=null&&v.comment))return;for(;z.value.comment.endsWith("<br />")||z.value.comment.endsWith(`
`);)z.value.comment.endsWith("<br />")?z.value.comment=z.value.comment.slice(0,-6):z.value.comment=z.value.comment.slice(0,-2);A.value=!0;const d={...z.value};w.value=!1,z.value=void 0,await R(d.id,{comment:d.comment}),Y()}const N=d=>{var v,we;return d.created_by===((v=t.value)==null?void 0:v.id)?"You":(we=d.created_display_name)!=null&&we.trim()?d.created_display_name||"Shared source":d.created_by_email?d.created_by_email:"Shared source"},q=d=>d.updated_at!==d.created_at&&d.updated_at?`[(edited)](a~~~###~~~Edited_${Nt(d.updated_at).replace(" ","_")}) `:"";function T(){fe.value&&(fe.value=null)}Ne(l,()=>{setTimeout(()=>{ze(()=>{const d=b.currentRoute.value.query,v=d.commentId;v?(b.push({query:{rowId:d.rowId}}),ge(v),fe.value=v,ya(document.querySelector(`.${fe.value}`),T)):H()})},100)});const te=d=>{const v=E.value.find(we=>we.email===d);return v?v.roles||yt.NO_ACCESS:yt.NO_ACCESS};return(d,v)=>{const we=xa,re=wt,be=Sa,F=Ra,B=Bt,se=Pt,D=Ca,pe=ka,ne=$a,oe=Ft,ye=fo,ee=it("e");return n(),g("div",{class:_e(["h-full",{"pb-1":!e(P)}])},[e(M)?(n(),g("div",vo,[i(we,{size:"xlarge"})])):(n(),g("div",mo,[e(W).length===0?(n(),g("div",po,[f("div",yo,[i(re,{icon:"commentHere"})]),f("div",ho,U(e(P)?d.$t("activity.startCommenting"):d.$t("activity.noCommentsYet")),1)])):(n(),g("div",{key:1,ref_key:"commentsWrapperEl",ref:l,class:"flex flex-col h-full py-1 nc-scrollbar-thin"},[(n(!0),g(Ie,null,pt(e(W),V=>{var ce,ke,Me;return n(),g("div",{key:V.id,class:_e([`${V.id}`,"nc-comment-item"]),onMouseover:T},[f("div",{class:_e([{"hover:bg-gray-100":((ce=e(z))==null?void 0:ce.id)!==V.id,"nc-hovered-comment bg-gray-100":e(fe)===V.id},"group gap-3 overflow-hidden px-3 py-2 transition-colors"])},[f("div",wo,[f("div",{class:_e(["flex items-start gap-3 flex-1",{"w-[calc(100%)] group-hover:w-[calc(100%_-_50px)]":!e(r).ee,"w-[calc(100%_-_44px)] group-hover:w-[calc(100%_-_72px)]":e(r).ee&&V.resolved_by,"w-[calc(100%_-_16px)] group-hover:w-[calc(100%_-_72px)]":e(r).ee&&!V.resolved_by&&e(P),"w-[calc(100%_-_16px)] group-hover:w-[calc(100%_-_44px)]":e(r).ee&&!V.resolved_by&&!e(P)}])},[i(be,{email:V.created_by_email,name:V.created_display_name,class:"mt-0.5",size:"medium"},null,8,["email","name"]),f("div",_o,[i(B,{placement:"topLeft",trigger:["hover"],class:"flex-none max-w-[calc(100%_-_72px)]"},{overlay:y(()=>[f("div",go,[f("div",bo,[i(be,{class:"!w-8 !h-8 border-1 border-gray-200 rounded-full",name:V.created_display_name,email:V.created_by_email},null,8,["name","email"]),f("div",Co,[f("div",ko,U(N(V)),1),f("div",$o,U(V.created_by_email),1)])]),e(p)("dataEdit")?(n(),g("div",So,[v[5]||(v[5]=he(" Has ")),i(F,{size:"sm",border:!1,role:te(V.created_by_email)},null,8,["role"]),v[6]||(v[6]=he(" role in base "))])):X("",!0)])]),default:y(()=>[f("div",xo,U(N(V)),1)]),_:2},1024),f("div",Ro,U(("timeAgo"in d?d.timeAgo:e(Nt))(V.created_at)),1)])],2),f("div",Eo,[e(z)?X("",!0):(n(),L(B,{key:0,class:"nc-comment-more-actions !hidden !group-hover:block","overlay-class-name":"!min-w-[160px]",placement:"bottomRight"},{overlay:y(()=>[i(ne,null,{default:y(()=>[e(t)&&V.created_by_email===e(t).email&&e(P)?Ce((n(),L(D,{key:0,class:"text-gray-700",onClick:de=>s(V)},{default:y(()=>[f("div",Mo,[(n(),L(Te(("iconMap"in d?d.iconMap:e(Ve)).rename),{class:"cursor-pointer"})),he(" "+U(d.$t("general.edit")),1)])]),_:2},1032,["onClick"])),[[ee,["c:comment-expand:comment:edit"]]]):X("",!0),Ce((n(),L(D,{class:"text-gray-700",onClick:de=>me(V)},{default:y(()=>[f("div",Oo,[(n(),L(Te(("iconMap"in d?d.iconMap:e(Ve)).copy),{class:"cursor-pointer"})),he(" "+U(d.$t("general.copy"))+" URL ",1)])]),_:2},1032,["onClick"])),[[ee,["c:comment-expand:comment:copy"]]]),e(t)&&V.created_by_email===e(t).email&&e(P)?(n(),g(Ie,{key:1},[i(pe),Ce((n(),L(D,{class:"!text-red-500 !hover:bg-red-50",onClick:de=>e(j)(V.id)},{default:y(()=>[f("div",Lo,[(n(),L(Te(("iconMap"in d?d.iconMap:e(Ve)).delete),{class:"cursor-pointer"})),he(" "+U(d.$t("general.delete")),1)])]),_:2},1032,["onClick"])),[[ee,["c:row-expand:comment:delete"]]])],64)):X("",!0)]),_:2},1024)]),default:y(()=>[i(se,{class:"nc-expand-form-more-actions !hover:bg-gray-200 !w-7 !h-7 !bg-transparent",size:"xsmall",type:"text"},{default:y(()=>[i(re,{class:"text-md",icon:"threeDotVertical"})]),_:1})]),_:2},1024)),e(r).ee?(n(),g("div",Do,[!V.resolved_by&&e(P)?(n(),L(oe,{key:0},{title:y(()=>v[7]||(v[7]=[he("Click to resolve ")])),default:y(()=>[i(se,{class:"nc-resolve-comment-btn !w-7 !h-7 !bg-transparent !hover:bg-gray-200 !hidden !group-hover:block",size:"xsmall",type:"text",onClick:de=>e(u)(V.id)},{default:y(()=>[i(re,{class:"text-md",icon:"checkCircle"})]),_:2},1032,["onClick"])]),_:2},1024)):V.resolved_by?(n(),L(oe,{key:1},{title:y(()=>[he(U(`Resolved by ${V.resolved_display_name}`),1)]),default:y(()=>[i(se,{class:"!h-7 !w-7 !bg-transparent !hover:bg-gray-200 text-semibold",size:"xsmall",type:"text",onClick:de=>e(u)(V.id)},{default:y(()=>[i(re,{class:"text-md rounded-full bg-[#17803D] text-white",icon:"checkFill"})]),_:2},1032,["onClick"])]),_:2},1024)):X("",!0)])):X("",!0)])]),f("div",{class:_e([{"mt-3":V.id===((ke=e(z))==null?void 0:ke.id)},"flex-1 flex flex-col gap-1 max-w-[calc(100%)]"])},[V.id===((Me=e(z))==null?void 0:Me.id)&&e(P)?(n(),L(ye,{key:0,value:e(m),"onUpdate:value":v[0]||(v[0]=de=>Ge(m)?m.value=de:null),autofocus:"","hide-options":!1,class:"expanded-form-comment-edit-input cursor-text expanded-form-comment-input !py-2 !px-2 !m-0 w-full !border-1 !border-gray-200 !rounded-lg !bg-white !text-gray-800 !text-small !leading-18px !max-h-[240px]","data-testid":"expanded-form-comment-input","sync-value-change":"",onSave:O,onKeydown:[Dt(h,["esc"]),Dt(ft(O,["exact","prevent"]),["enter"])],onBlur:v[1]||(v[1]=()=>{z.value=void 0,w.value=!1})},null,8,["value","onKeydown"])):(n(),g("div",To,[i(ye,{value:`${V.comment}  ${q(V)}`,class:"!text-small !leading-18px !text-gray-800 -ml-1","read-only":"","sync-value-change":""},null,8,["value"])]))],2)],2)],34)}),128))],512)),e(P)?(n(),g("div",Vo,[i(ye,{ref_key:"commentInputRef",ref:Z,value:e(_),"onUpdate:value":v[2]||(v[2]=V=>Ge(_)?_.value=V:null),"hide-options":!1,placeholder:"Comment...",class:"expanded-form-comment-input !py-2 !px-2 cursor-text border-1 rounded-lg w-full bg-transparent !text-gray-800 !text-small !leading-18px !max-h-[240px]",autofocus:e(C),"data-testid":"expanded-form-comment-input",onFocus:v[3]||(v[3]=V=>C.value=!1),onKeydown:[v[4]||(v[4]=ft(()=>{},["stop"])),Dt(ft(le,["exact","prevent"]),["enter"])],onSave:le},null,8,["value","autofocus","onKeydown"])])):X("",!0)]))],2)}}}),No=gt(Ao,[["__scopeId","data-v-08bc97ea"]]),[Po,Io]=Ln((o,t)=>{var d,v,we,re,be,F;const{$e:r,$state:S,$api:p}=nn(),{t:Q}=ga(),K=Ae(ba,$(!1)),P=$([]),C=$(!1),x=$(!0),ve=$(0),I=$(new Set),j=It(),{basesUser:u}=Xe(j),{base:M}=Xe(Ja()),W=Se(()=>o.value.base_id?u.value.get(o.value.base_id)||[]:[]),{sharedView:Y}=Qa(),R=$(!Y.value||((d=Y.value)==null?void 0:d.type)===st.GALLERY||((v=Y.value)==null?void 0:v.type)===st.KANBAN||(re=(we=t.value)==null?void 0:we.rowMeta)!=null&&re.new?t.value:{row:{},oldRow:{},rowMeta:{}});(F=(be=R.value)==null?void 0:be.rowMeta)!=null&&F.fromExpandedForm&&(R.value.rowMeta.fromExpandedForm=!0);const Ee=Dn(R),$e=Ae(Za,$()),{addUndo:z,clone:l,defineViewScope:w}=en(),A=Ae(vt,rt()),{comments:fe,resolveComment:Z,loadComments:_,updateComment:b,deleteComment:E,saveComment:H,isCommentsLoading:le}=On(o,R),{isUIAllowed:me}=xt(),ge=Se(()=>{var B,se,D,pe;if((B=R==null?void 0:R.value)!=null&&B.row){const ne=(D=(se=o==null?void 0:o.value)==null?void 0:se.columns)==null?void 0:D.find(ee=>ee.pv);if(!ne)return;const oe=(pe=R.value.row)==null?void 0:pe[ne.title],ye=ne.uidt;if(ye===Tt.Date)return(/^\d+$/.test(oe)?Ke(+oe):Ke(oe)).format("YYYY-MM-DD");if(ye===Tt.DateTime)return(/^\d+$/.test(oe)?Ke(+oe):Ke(oe)).format("YYYY-MM-DD HH:mm");if(ye===Tt.Time){let ee=Ke(oe);return ee.isValid()||(ee=Ke(oe,"HH:mm:ss")),ee.isValid()||(ee=Ke(`1999-01-01 ${oe}`)),ee.isValid()?ee.format("HH:mm:ss"):oe}return oe}}),h=Se(()=>qe(R.value.row,o.value.columns)),s=async(B,se=!0)=>{var pe,ne;if(!me("auditListRow")||tn||!R.value&&!B)return;const D=B??qe(R.value.row,o.value.columns);if(D)try{se&&(C.value=!0);const oe=((ne=(pe=(await p.utils.auditList({row_id:D,fk_model_id:o.value.id})).list)==null?void 0:pe.reverse)==null?void 0:ne.call(pe))||[];P.value=oe.map(ye=>{const ee=W.value.find(V=>V.email===ye.user);return{...ye,created_display_name:(ee==null?void 0:ee.display_name)??((ee==null?void 0:ee.email)??"").split("@")[0],created_by_email:ee==null?void 0:ee.email}})}catch(oe){Oe.error(await Be(oe))}finally{C.value=!1}},m=B=>{var se,D;return((D=(se=S.user)==null?void 0:se.value)==null?void 0:D.email)===B},O=async()=>{var B;if(((B=$e.value)==null?void 0:B.type)===st.KANBAN){const{loadKanbanData:se}=Oa();await se()}};return{...Ee,loadComments:_,deleteComment:E,loadAudits:s,comments:fe,audits:P,isAuditLoading:C,resolveComment:Z,isCommentsLoading:le,saveComment:H,isYou:m,commentsDrawer:x,row:R,deleteRowById:async B=>{try{const se=B??qe(R.value.row,o.value.columns),D=await p.dbTableRow.delete(nt,M.value.id,o.value.id,encodeURIComponent(se));if(D.message)return Oe.info(`Record delete failed: ${`Unable to delete record with ID ${B} because of the following:
              
${D.message.join(`
`)}.

              Clear the data first & try again`})}`),!1}catch(se){Oe.error(`${Q("msg.error.deleteFailed")}: ${await Be(se)}`)}},displayValue:ge,save:async(B={},se=!1,{kanbanClbk:D}={})=>{var oe,ye,ee,V;if(!o.value.id)return;let pe;const ne=((oe=R.value.rowMeta)==null?void 0:oe.new)??!1;if(ne){const{getMeta:ce}=an(),{missingRequiredColumns:ke,insertObj:Me}=await Tn({meta:o.value,ltarState:B,getMeta:ce,row:R.value.row,throwError:!0});if(ke.size)return;if(pe=await p.dbTableRow.create("noco",o.value.base_id,o.value.id,{...Me,...B||{}}),Object.assign(R.value,{row:pe,rowMeta:{...R.value.rowMeta,new:!1},oldRow:{...pe}}),!se){const de=qe(pe,(ye=o.value)==null?void 0:ye.columns),ie=Vn(R.value.row,(ee=o.value)==null?void 0:ee.columns);z({redo:{fn:async ue=>{await p.dbTableRow.create("noco",M.value.id,o.value.id,{...ie,...ue}),await O(),A==null||A.trigger()},args:[l(Me)]},undo:{fn:async ue=>{var tt,Ze;const ct=await p.dbViewRow.delete("noco",M.value.id,(tt=o.value)==null?void 0:tt.id,(Ze=$e.value)==null?void 0:Ze.id,encodeURIComponent(ue));if(ct.message)throw new Error(ct.message);await O(),A==null||A.trigger()},args:[de]},scope:w({view:$e.value})})}}else{const ce=[...I.value].reduce((ke,Me)=>(ke[Me]=R.value.row[Me],ke),{});if(Object.keys(ce).length){const ke=qe(R.value.row,o.value.columns);if(!ke)return Oe.info("Update not allowed for table which doesn't have primary Key");if(await p.dbTableRow.update(nt,M.value.id,o.value.id,encodeURIComponent(ke),ce),!se){const Me=[...I.value].reduce((de,ie)=>(de[ie]=R.value.oldRow[ie],de),{});z({redo:{fn:async(de,ie)=>{await p.dbTableRow.update(nt,M.value.id,o.value.id,encodeURIComponent(de),ie),await O(),A==null||A.trigger()},args:[ke,l(ce)]},undo:{fn:async(de,ie)=>{await p.dbTableRow.update(nt,M.value.id,o.value.id,encodeURIComponent(de),ie),await O(),A==null||A.trigger()},args:[ke,l(Me)]},scope:w({view:$e.value})})}x.value&&await Promise.all([_(),s()])}else{Oe.info(Q("msg.info.noColumnsToUpdate"));return}}return((V=$e.value)==null?void 0:V.type)===st.KANBAN&&D&&D(R.value,ne),I.value=new Set,r("a:row-expand:add"),pe},changedColumns:I,loadRow:async(B,se=!1,D=!1)=>{var oe,ye,ee,V,ce,ke,Me,de;if((ye=(oe=R==null?void 0:R.value)==null?void 0:oe.rowMeta)!=null&&ye.new||K.value||!((ee=o.value)!=null&&ee.id))return;const pe=B??qe(R.value.row,o.value.columns);if(!pe)return;let ne={};try{ne=await p.dbTableRow.read(nt,(((V=M==null?void 0:M.value)==null?void 0:V.id)??((ce=o.value)==null?void 0:ce.base_id))||((Me=(ke=Y.value)==null?void 0:ke.view)==null?void 0:Me.base_id),o.value.id,encodeURIComponent(pe),{getHiddenColumn:!0})}catch(ie){if(((de=ie.response)==null?void 0:de.status)===404){const ue=_a();Oe.error(Q("msg.noRecordFound")),ue.replace({query:{}})}else Oe.error(`${await Be(ie)}`)}try{se&&(ne={...R.value.row,...(o.value.columns??[]).reduce((ie,ue)=>(Ye(ue)&&ue.title&&ue.title in ne&&(ie[ue.title]=ne[ue.title]),ie),{})}),D&&(ne=Object.keys(ne).reduce((ie,ue)=>(Object.prototype.hasOwnProperty.call(R.value.row,ue)?ie[ue]=R.value.row[ue]:ie[ue]=ne[ue],ie),{})),Object.assign(R.value,{row:ne,oldRow:{...ne},rowMeta:{...R.value.rowMeta}})}catch{Oe.error(`${Q("msg.error.errorLoadingRecord")}`)}},primaryKey:h,saveRowAndStay:ve,updateComment:b,clearColumns:()=>{I.value=new Set}}},"expanded-form-store");function zo(){const o=Io();if(o==null)throw new Error("Please call `useExpandedFormStore` on the appropriate parent component");return o}const Fo={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Bo=f("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1),Uo=[Bo];function jo(o,t){return n(),g("svg",Fo,[...Uo])}const Ho={name:"mdi-history",render:jo},Ko={class:"h-full pb-1"},Wo={key:0,class:"flex flex-col items-center justify-center w-full h-full"},Yo={key:0,class:"flex flex-col text-center justify-center h-full"},qo={class:"text-center text-3xl text-gray-600"},Go={class:"group gap-3 overflow-hidden px-3 py-2 hover:bg-gray-100"},Xo={class:"flex items-start justify-between"},Jo={class:"flex items-start gap-3 flex-1 w-full"},Qo={class:"flex h-[28px] items-center gap-3 w-[calc(100%_-_40px)]"},Zo={class:"truncate text-gray-800 font-medium !text-small !leading-[18px] overflow-hidden"},el={class:"bg-white rounded-lg"},tl={class:"flex items-center gap-4 py-3 px-2"},al={class:"flex flex-col"},nl={class:"font-semibold text-gray-800"},ol={class:"text-xs text-gray-600"},ll={key:0,class:"px-3 rounded-b-lg !text-[13px] items-center text-gray-600 flex gap-1 bg-gray-100 py-1.5"},sl={class:"text-xs text-gray-500"},rl={class:"!text-[13px] text-gray-500 !leading-5 !pl-9"},il=je({__name:"Audits",setup(o){const{user:t}=_t(),{isUIAllowed:r}=xt(),S=It(),{basesUser:p}=Xe(S),Q=Ae(zt,$()),K=Se(()=>{var u,M;return(u=Q.value)!=null&&u.base_id?p.value.get((M=Q.value)==null?void 0:M.base_id)||[]:[]}),{audits:P,isAuditLoading:C}=zo(),x=$(null);function ve(u){var W;if(!u)return;const M=(W=x.value)==null?void 0:W.querySelector(`.nc-audit-item.${u}`);M&&M.scrollIntoView({behavior:"smooth",block:"center"})}const I=u=>{var M,W;return u.user===((M=t.value)==null?void 0:M.email)?"You":(W=u.created_display_name)!=null&&W.trim()?u.created_display_name||"Shared source":u.user?u.user:"Shared source"},j=u=>{const M=K.value.find(W=>W.email===u);return M?M.roles||yt.NO_ACCESS:yt.NO_ACCESS};return Ne(()=>P.value.length,u=>{ze(()=>{setTimeout(()=>{var M;ve((M=P.value[u-1])==null?void 0:M.id)},100)})}),(u,M)=>{const W=xa,Y=Ho,R=Sa,Ee=Ra,$e=Bt,z=it("dompurify-html");return n(),g("div",Ko,[e(C)?(n(),g("div",Wo,[i(W,{size:"xlarge"})])):(n(),g("div",{key:1,ref_key:"auditsWrapperEl",ref:x,class:"flex flex-col h-full py-1 nc-scrollbar-thin"},[e(P).length===0?(n(),g("div",Yo,[f("div",qo,[i(Y)]),M[0]||(M[0]=f("div",{class:"font-bold text-center my-1 text-gray-600"},"See changes to this record",-1))])):X("",!0),(n(!0),g(Ie,null,pt(e(P),l=>(n(),g("div",{key:l.id,class:_e([`${l.id}`,"nc-audit-item"])},[f("div",Go,[f("div",Xo,[f("div",Jo,[i(R,{email:l.created_by_email,name:l.created_display_name,class:"mt-0.5",size:"medium"},null,8,["email","name"]),f("div",Qo,[i($e,{placement:"topLeft",trigger:["hover"],class:"flex-none max-w-[calc(100%_-_72px)]"},{overlay:y(()=>[f("div",el,[f("div",tl,[i(R,{class:"!w-8 !h-8 border-1 border-gray-200 rounded-full",name:l.created_display_name,email:l.created_by_email},null,8,["name","email"]),f("div",al,[f("div",nl,U(I(l)),1),f("div",ol,U(l.created_by_email),1)])]),e(r)("dataEdit")?(n(),g("div",ll,[M[1]||(M[1]=he(" Has ")),i(Ee,{size:"sm",border:!1,role:j(l.created_by_email)},null,8,["role"]),M[2]||(M[2]=he(" role in base "))])):X("",!0)])]),default:y(()=>[f("div",Zo,U(I(l)),1)]),_:2},1024),f("div",sl,U(("timeAgo"in u?u.timeAgo:e(Nt))(l.created_at)),1)])])]),Ce(f("div",rl,null,512),[[z,l.details]])])],2))),128))],512))])}}}),cl=gt(il,[["__scopeId","data-v-fc57eef5"]]),dl={class:"flex flex-col bg-white !h-full w-full rounded-br-2xl overflow-hidden"},ul={class:"flex items-center gap-2"},fl={class:"flex items-center gap-2 text-gray-400"},vl={key:1,class:"flex items-center gap-2"},ml=je({__name:"index",setup(o){const{appInfo:t}=_t(),r=$("comments");return(S,p)=>{const Q=wt,K=No,P=on,C=Ft,x=cl,ve=An,I=it("e");return n(),g("div",dl,[i(ve,{activeKey:e(r),"onUpdate:activeKey":p[0]||(p[0]=j=>Ge(r)?r.value=j:null),class:"h-full"},{default:y(()=>[i(P,{key:"comments",class:"w-full h-full"},{tab:y(()=>[Ce((n(),g("div",ul,[i(Q,{icon:"messageCircle",class:"w-4 h-4"}),p[1]||(p[1]=f("span",{class:"<lg:hidden"}," Comments ",-1))])),[[I,["c:row-expand:comment"]]])]),default:y(()=>[i(K)]),_:1}),i(P,{key:"audits",class:"w-full",disabled:e(t).ee},{tab:y(()=>[e(t).ee?(n(),L(C,{key:0,class:"tab flex-1"},{title:y(()=>[he(U(S.$t("title.comingSoon")),1)]),default:y(()=>[Ce((n(),g("div",fl,[i(Q,{icon:"audit",class:"w-4 h-4"}),p[2]||(p[2]=f("span",{class:"<lg:hidden"}," Audits ",-1))])),[[I,["c:row-expand:audit"]]])]),_:1})):Ce((n(),g("div",vl,[i(Q,{icon:"audit",class:"w-4 h-4"}),p[3]||(p[3]=f("span",{class:"<lg:hidden"}," Audits ",-1))])),[[I,["c:row-expand:audit"]]])]),default:y(()=>[i(x)]),_:1},8,["disabled"])]),_:1},8,["activeKey"])])}}}),pl=gt(ml,[["__scopeId","data-v-261ec6b7"]]),yl={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},hl=f("path",{fill:"currentColor",d:"M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6z"},null,-1),wl=[hl];function _l(o,t){return n(),g("svg",yl,[...wl])}const xl={name:"mdi-chevron-down",render:_l},gl=Je(()=>Qe(()=>import("./CWm929xG.js"),__vite__mapDeps([4,1,2,5,6,7,8]),import.meta.url).then(o=>o.default||o)),bl=Je(()=>Qe(()=>import("./Co32XBKZ.js"),__vite__mapDeps([9,1,2,7,10,11]),import.meta.url).then(o=>o.default||o)),Cl=Je(()=>Qe(()=>import("./Dby8gS7l.js"),__vite__mapDeps([12,1,2,13,6,14]),import.meta.url).then(o=>o.default||o)),kl=Je(()=>Qe(()=>import("./BIhr-Z4C.js"),__vite__mapDeps([15,1,2,7,6,16]),import.meta.url).then(o=>o.default||o)),$l=Je(()=>Qe(()=>import("./DG2ZH8TR.js"),__vite__mapDeps([17,1,2,18,19,20,7,21,10,6,22]),import.meta.url).then(o=>o.default||o)),Sl=Je(()=>Qe(()=>import("./B9n4-CGo.js"),__vite__mapDeps([23,1,2,24]),import.meta.url).then(o=>o.default||o)),Rl={class:"h-[85vh] xs:max-h-full xs:h-full max-h-215 flex flex-col"},El={key:0,class:"flex-none h-4 flex items-center justify-center"},Ml={class:"flex min-h-7 flex-shrink-0 w-full items-center nc-expanded-form-header relative p-4 xs:px-2 xs:py-0 xs:min-h-[48px] justify-between"},Ol={class:"flex-1 flex gap-4 lg:w-100 <lg:max-w-[calc(100%_-_178px)] xs:max-w-[calc(100%_-_44px)]"},Ll={class:"flex gap-2"},Dl={key:0,class:"flex items-center"},Tl={key:0,class:"flex items-center truncate font-bold text-gray-800 text-base overflow-hidden"},Vl={key:1,class:"flex items-center font-bold text-gray-800 text-base max-w-[300px] xs:w-auto xs:max-w-[calc(100%_-_82px)] overflow-hidden"},Al={class:"truncate"},Nl={class:"flex gap-2"},Pl={class:"xs:px-1"},Il={"data-testid":"nc-expanded-form-copy-url",class:"flex items-center"},zl={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},Fl={"data-testid":"nc-expanded-form-copy-url",class:"flex gap-2 items-center"},Bl={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-duplicate"},Ul={class:"-ml-0.25"},jl={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-delete"},Hl={class:"-ml-0.25"},Kl=["col-id","data-testid"],Wl={class:"flex items-start flex-row sm:gap-x-2 <lg:flex-col <lg:w-full nc-expanded-cell min-h-[37px]"},Yl={class:"w-45 <lg:w-full <lg:px-0 <lg:mb-1 h-[37px] xs:h-auto flex items-center rounded-lg overflow-hidden"},ql={key:0,class:"flex w-full <lg:px-1 items-center py-6"},Gl=["data-testid"],Xl={class:"flex items-start flex-row sm:gap-x-2 <lg:flex-col <lg:w-full nc-expanded-cell min-h-[37px]"},Jl={class:"w-45 <lg:w-full <lg:px-0 h-[37px] xs:h-auto flex items-center rounded-lg overflow-hidden"},Ql={key:0,class:"p-2"},Zl={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},es={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-copy-url"},ts={"data-testid":"nc-expanded-form-delete"},as={key:1},ns={key:2,class:"p-2"},os={class:"xs:px-1"},ls={key:1,class:"p-2"},ss={class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700"},rs={class:"text-ellipsis overflow-hidden select-none w-full pl-1.75 break-keep whitespace-nowrap"},is={class:""},cs={class:"flex flex-row items-center gap-x-2 text-base font-bold"},ds={class:"flex font-medium mt-2"},us={class:"flex flex-row justify-end gap-x-2 mt-5"},fs={name:"ExpandedForm"},vs=je({...fs,props:{modelValue:{type:Boolean},state:{},meta:{},loadRow:{type:Boolean},useMetaFields:{type:Boolean},row:{},rowId:{},view:{},showNextPrevIcons:{type:Boolean},firstRow:{type:Boolean},lastRow:{type:Boolean},closeAfterSave:{type:Boolean},newRecordHeader:{},skipReload:{type:Boolean},newRecordSubmitBtnText:{},expandForm:{type:Function},maintainDefaultViewOrder:{type:Boolean}},emits:["update:modelValue","cancel","next","prev","createdRecord","updateRowCommentCount"],setup(o,{emit:t}){const r=o,S=t,{activeView:p}=Xe(ln()),Q=$(0),K=$(),{dashboardUrl:P}=Ea(),{copy:C}=ha(),{isMobileMode:x}=_t(),{fieldsMap:ve,isLocalMode:I}=Pn(),{t:j}=ga(),u=We(r,"rowId"),M=We(r,"row"),W=We(r,"state"),Y=We(r,"meta"),R=We(r,"lastRow"),Ee=We(r,"firstRow"),$e=We(r,"maintainDefaultViewOrder"),z=wa(),l=Ae(ba,$(!1)),w=$(!1),A=$(!1),fe=$(!1),{isUIAllowed:Z}=xt(),_=Se(()=>!Z("dataEdit")||l.value),b=$(),E=Ae(vt,rt()),H=Ae(sn,rt()),{addOrEditStackRow:le}=Oa(),{isExpandedFormCommentMode:me}=Xe(Ma());lt(rn,void 0);const ge=a=>{S(a),T.value=!0},h=cn(vn,a=>r.useMetaFields?$e.value?(Y.value.columns??[]).filter(c=>!ut(c)).sort((c,G)=>{var J,Re;return(((J=c.meta)==null?void 0:J.defaultViewColOrder)??1/0)-(((Re=G.meta)==null?void 0:Re.defaultViewColOrder)??1/0)}):(Y.value.columns??[]).filter(c=>!ut(c)):(a==null?void 0:a.value)??[]),s=Se(()=>{var a,c;return((c=(a=Y.value)==null?void 0:a.columns)==null?void 0:c.find(G=>{var J;return G.pv&&((J=h.value)==null?void 0:J.includes(G))}))??null}),m=Se(()=>{var a;return(((a=Y.value)==null?void 0:a.columns)??[]).filter(c=>{var G,J;return!((G=h.value)!=null&&G.includes(c))&&(I.value&&(c!=null&&c.id)&&ve.value[c.id]?(J=ve.value[c.id])==null?void 0:J.initialShow:!0)}).filter(c=>!ut(c))}),O=$(!1),N=()=>{O.value=!O.value},q=Ae(dn,$(!1));lt(zt,Y);const T=$(!0),te=$(!1),{commentsDrawer:d,changedColumns:v,deleteRowById:we,displayValue:re,state:be,isNew:F,loadRow:B,primaryKey:se,row:D,comments:pe,save:ne,loadComments:oe,loadAudits:ye,clearColumns:ee}=Po(Y,M);H.on(async()=>{await B(u.value,!1,!0)});const V=$(!1);In($({}),Y),zn(Y),Ne(W,()=>{W.value?be.value=W.value:be.value={}},{immediate:!0});const ce=pa(r,"modelValue",S,{defaultValue:!1}),ke=()=>{var a,c;Z("dataEdit")?v.value.size>0?ue.value=!0:((c=(a=D.value)==null?void 0:a.rowMeta)!=null&&c.new&&S("cancel"),ce.value=!1):ce.value=!1},Me=()=>{V.value=!0,w.value=!0,A.value=!0;const a={...D.value.row};delete a.ncRecordId;const c=Object.assign({},{row:a,oldRow:{},rowMeta:{new:!0}});setTimeout(async()=>{D.value=c,V.value=!1,Oe.success(j("msg.success.rowDuplicatedWithoutSavedYet"))},500)},de=async()=>{var a,c;te.value=!0;try{let G;((a=p.value)==null?void 0:a.type)===st.KANBAN&&(G=(J,Re)=>{le(J,Re)}),F.value?await ne(be.value,void 0,{kanbanClbk:G}):(await ne(void 0,void 0,{kanbanClbk:G}),B()),r.skipReload||(E==null||E.trigger(),H==null||H.trigger()),w.value=!1,r.closeAfterSave?ce.value=!1:A.value&&(qe(D.value.row,Y.value.columns)!==u.value&&((c=r==null?void 0:r.expandForm)==null||c.call(r,D.value)),setTimeout(()=>{A.value=!1},500)),S("createdRecord",D.value.row)}catch(G){F.value?Oe.error(`Add row failed: ${await Be(G)}`):Oe.error(`${j("msg.error.rowUpdateFailed")}: ${await Be(G)}`)}te.value=!1},ie=$(!1),ue=$(!1),ct=()=>{var a,c,G,J;ie.value&&(ge("next"),(c=(a=D.value)==null?void 0:a.rowMeta)!=null&&c.new&&S("cancel"),ie.value=!1),ue.value&&(ue.value=!1,(J=(G=D.value)==null?void 0:G.rowMeta)!=null&&J.new&&S("cancel"),ce.value=!1),ee()},tt=async()=>{if(v.value.size>0){ie.value=!0;return}ge("next")},Ze=async()=>{var a;await C(encodeURI(`${P==null?void 0:P.value}#/${z.params.typeOrId}/${z.params.baseId}/${(a=Y.value)==null?void 0:a.id}${r.view?`/${r.view.title}`:""}?rowId=${se.value}`)),fe.value=!0},Ta=async()=>{ie.value&&(w.value=!1,await de(),ge("next"),ie.value=!1),ue.value&&(ue.value=!1,await de(),ce.value=!1)},bt=Ae(vt,rt()),Le=rt();if(Le.on(()=>{bt==null||bt.trigger({shouldShowLoading:!1}),!F.value&&(B(void 0,!0),ye(u.value,!1))}),lt(vt,Le),q.value&&D.value.rowMeta.new)for(const[a,c]of Object.entries(D.value.row))c&&v.value.add(a);lt(un,ce);const Ct=async a=>{await Promise.allSettled([oe(a,!1),ye(a),B(a)]),T.value=!1},kt=$();ht(async()=>{fe.value=!1,T.value=!0;const a=!me.value;let c=!1;r.loadRow&&!r.rowId?(await Ct(),c=!0):r.rowId&&r.loadRow&&!c?await Ct(r.rowId):D.value=r.row,T.value=!1,a&&F.value&&setTimeout(()=>{var G,J,Re;(Re=(J=(G=kt.value)==null?void 0:G.$el)==null?void 0:J.querySelector("input,select,textarea"))==null||Re.focus()},300)});const at=()=>{setTimeout(async()=>{D.value={row:{},oldRow:{},rowMeta:{new:!0}},be.value={},Q.value++,ce.value=!0},500)};Fn(ce,async a=>{var c,G,J;if(a.altKey)if(a.key==="ArrowLeft"){if(a.stopPropagation(),Ee.value)return;ge("prev")}else if(a.key==="ArrowRight"){if(a.stopPropagation(),R.value)return;tt()}else if(a.code==="KeyS"){(c=document.activeElement)==null||c.blur(),a.stopPropagation();try{F.value?(await ne(be.value),Le==null||Le.trigger(null)):(await de(),Le==null||Le.trigger(null))}catch(Re){F.value?Oe.error(`Add row failed: ${await Be(Re)}`):Oe.error(`${j("msg.error.rowUpdateFailed")}: ${await Be(Re)}`)}}else a.code==="KeyN"&&((J=(G=document.activeElement)==null?void 0:G.blur)==null||J.call(G),v.value.size>0?ea.confirm({title:j("msg.saveChanges"),okText:j("general.save"),cancelText:j("labels.discard"),onOk:async()=>{await de(),Le==null||Le.trigger(null),at()},onCancel:()=>{at()}}):F.value?ea.confirm({title:"Do you want to save the record?",okText:j("general.save"),cancelText:j("labels.discard"),onOk:async()=>{try{await ne(be.value),Le==null||Le.trigger(null),at()}catch(Re){Oe.error(`${j("msg.error.rowUpdateFailed")}: ${await Be(Re)}`)}},onCancel:()=>{at()}}):at())},{immediate:!0});const et=$(!1),Ut=()=>{et.value=!0},Va=async()=>{et.value=!1,ce.value=!1,await we(se.value||void 0),Oe.success(j("msg.rowDeleted")),await H.trigger({shouldShowLoading:!1}),ke(),et.value=!1};Ne(u,async a=>{await Ct(a)});const $t=Se(()=>!F.value&&d.value&&Z("commentList")),dt=Se({get:()=>ue.value||ie.value,set:a=>{ue.value=a}}),Aa=a=>{let c=!1;document.querySelectorAll(".ant-select-dropdown").forEach(G=>{c=c||G.checkVisibility()}),!c&&(v.value.size===0&&!w.value?(ce.value=a,q.value&&S("cancel")):!a&&Z("dataEdit")?dt.value=!0:ce.value=a)},St=a=>Bn(a)||na(a)||Un(a)||jn(a)||Hn(a)||ut(a)||mn(a)||pn(a);Ne([b,T],()=>{if(x.value)return;const a=b.value;a&&!T.value&&(a.scrollTop=a.scrollHeight,setTimeout(()=>{a.scrollTop=0},125))});const Na=Se(()=>x.value?{placement:"bottom"}:{}),Rt=()=>yn()?"⌥":"ALT";return Ne(()=>pe.value.length,a=>{S("updateRowCommentCount",a)}),(a,c)=>{const G=wt,J=Pt,Re=Ft,Et=Kn,jt=gl,He=Ca,Ht=ka,Kt=$a,Wt=Bt,Yt=bl,qt=Cl,Gt=kl,Xt=$l,Pa=hn,Ia=Sl,za=pl,Fa=Nn,Pe=it("e");return n(),g(Ie,null,[(n(),L(Te(e(x)?e(so):oa),fn({"body-style":{padding:0},class:[{active:e(ce)},"nc-drawer-expanded-form"],closable:!1,footer:null,visible:e(ce),width:e(d)&&e(Z)("commentList")?"min(80vw,1280px)":"min(70vw,768px)",size:e(x)?"medium":"small"},e(Na),{"onUpdate:visible":Aa}),{default:y(()=>{var Fe,Jt,Qt;return[f("div",Rl,[e(x)?(n(),g("div",El,[f("div",{class:"flex-none h-full flex items-center justify-center cursor-pointer",onClick:ke},c[13]||(c[13]=[f("div",{class:"w-[72px] h-[2px] rounded-full bg-[#49494a]"},null,-1)]))])):X("",!0),f("div",Ml,[f("div",Ol,[f("div",Ll,[r.showNextPrevIcons?(n(),L(Re,{key:0},{title:y(()=>[he(U(Rt())+" + ← ",1)]),default:y(()=>[i(J,{disabled:e(Ee)||e(T),class:"nc-prev-arrow !w-7 !h-7 !text-gray-500 !disabled:text-gray-300",type:"text",size:"xsmall",onClick:c[0]||(c[0]=k=>ge("prev"))},{default:y(()=>[i(G,{icon:"chevronDown",class:"transform rotate-180"})]),_:1},8,["disabled"])]),_:1})):X("",!0),r.showNextPrevIcons?(n(),L(Re,{key:1},{title:y(()=>[he(U(Rt())+" + → ",1)]),default:y(()=>[i(J,{disabled:e(R)||e(T),class:"nc-next-arrow !w-7 !h-7 !text-gray-500 !disabled:text-gray-300",type:"text",size:"xsmall",onClick:tt},{default:y(()=>[i(G,{icon:"chevronDown"})]),_:1},8,["disabled"])]),_:1})):X("",!0)]),e(T)?(n(),g("div",Dl,[i(Et,{active:"",class:"!h-6 !sm:mr-14 !w-52 !rounded-md !overflow-hidden",size:"small"})])):(n(),g("div",{key:1,class:_e(["flex-1 flex items-center gap-3 max-w-[calc(100%_-_108px)] xs:flex-row-reverse xs:justify-end",{"xs:max-w-[calc(100%_-_52px)]":e(F),"xs:max-w-[calc(100%_-_82px)]":!e(F)}])},[(Fe=e(M).rowMeta)!=null&&Fe.new||r.newRecordHeader?(n(),g("div",Tl,U(r.newRecordHeader??a.$t("activity.newRecord")),1)):e(re)&&!((Qt=(Jt=e(M))==null?void 0:Jt.rowMeta)!=null&&Qt.new)?(n(),g("div",Vl,[f("span",Al,[i(jt,{modelValue:e(re),"onUpdate:modelValue":c[1]||(c[1]=k=>Ge(re)?re.value=k:null),column:e(s)},null,8,["modelValue","column"])])])):X("",!0)],2))]),f("div",Nl,[!e(x)&&e(Z)("dataEdit")?(n(),L(Re,{key:0},{title:y(()=>[he(U(Rt())+" + S ",1)]),default:y(()=>[Ce((n(),L(J,{disabled:e(v).size===0&&!e(w),loading:e(te),class:"nc-expand-form-save-btn !xs:text-base !h-7 !px-2","data-testid":"nc-expanded-form-save",type:"primary",size:"xsmall",onClick:de},{default:y(()=>[f("div",Pl,U(a.newRecordSubmitBtnText??"Save Record"),1)]),_:1},8,["disabled","loading"])),[[Pe,["c:row-expand:save"]]])]),_:1})):X("",!0),i(Re,null,{title:y(()=>[he(U(e(fe)?a.$t("labels.copiedRecordURL"):a.$t("labels.copyRecordURL")),1)]),default:y(()=>[!e(F)&&e(u)&&!e(x)?(n(),L(J,{key:0,disabled:e(T),class:"!<lg:hidden text-gray-700 !h-7 !w-7",type:"text",size:"xsmall",onClick:c[2]||(c[2]=k=>Ze())},{default:y(()=>[Ce((n(),g("div",Il,[e(fe)?(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).check),{key:0,class:"cursor-pointer nc-duplicate-row h-4 w-4"})):(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).copy),{key:1,class:"cursor-pointer nc-duplicate-row h-4 w-4"}))])),[[Pe,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):X("",!0)]),_:1}),!e(F)&&e(u)&&!e(x)?(n(),L(Wt,{key:1,placement:"bottomRight"},{overlay:y(()=>[i(Kt,null,{default:y(()=>[i(He,{class:"text-gray-700",onClick:c[3]||(c[3]=k=>e(B)())},{default:y(()=>[Ce((n(),g("div",zl,[(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).reload),{class:"cursor-pointer"})),he(" "+U(a.$t("general.reload"))+" "+U(a.$t("objects.record")),1)])),[[Pe,["c:row-expand:reload"]]])]),_:1}),!e(F)&&e(u)?(n(),L(He,{key:0,type:"secondary",class:"!lg:hidden text-gray-700",disabled:e(T),onClick:c[4]||(c[4]=k=>Ze())},{default:y(()=>[Ce((n(),g("div",Fl,[(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).copy),{class:"cursor-pointer"})),he(" "+U(a.$t("labels.copyRecordURL")),1)])),[[Pe,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):X("",!0),e(Z)("dataEdit")?(n(),L(He,{key:1,class:"text-gray-700",onClick:c[5]||(c[5]=k=>e(F)?()=>{}:Me())},{default:y(()=>[Ce((n(),g("div",Bl,[(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).duplicate),{class:"cursor-pointer nc-duplicate-row"})),f("span",Ul,U(a.$t("labels.duplicateRecord")),1)])),[[Pe,["c:row-expand:duplicate"]]])]),_:1})):X("",!0),e(Z)("dataEdit")?(n(),L(Ht,{key:2})):X("",!0),e(Z)("dataEdit")?(n(),L(He,{key:3,class:"!text-red-500 !hover:bg-red-50",onClick:c[6]||(c[6]=k=>!e(F)&&Ut())},{default:y(()=>[Ce((n(),g("div",jl,[(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).delete),{class:"cursor-pointer nc-delete-row"})),f("span",Hl,U(a.$t("general.deleteEntity",{entity:a.$t("objects.record").toLowerCase()})),1)])),[[Pe,["c:row-expand:delete"]]])]),_:1})):X("",!0)]),_:1})]),default:y(()=>[i(J,{type:"text",size:"xsmall",class:"nc-expand-form-more-actions !w-7 !h-7",disabled:e(T)},{default:y(()=>[i(G,{icon:"threeDotVertical",class:_e(["text-md",e(T)?"text-gray-300":"text-gray-700"])},null,8,["class"])]),_:1},8,["disabled"])]),_:1})):X("",!0),i(J,{class:"nc-expand-form-close-btn !w-7 !h-7","data-testid":"nc-expanded-form-close",type:"text",size:"xsmall",onClick:ke},{default:y(()=>[i(G,{class:"text-md text-gray-700 h-4 w-4",icon:"close"})]),_:1})])]),f("div",{ref_key:"wrapper",ref:K,class:"flex flex-grow flex-row h-[calc(100%_-_4rem)] w-full border-t-1 border-gray-200"},[f("div",{class:_e([{"w-full":!e($t),"flex-1":e($t)},"h-full flex xs:w-full flex-col overflow-hidden"])},[f("div",{ref_key:"expandedFormScrollWrapper",ref:b,class:"flex flex-col flex-grow gap-6 h-full max-h-full nc-scrollbar-thin items-center w-full p-4 xs:px-4 xs:pt-4 xs:pb-2 xs:gap-6 children:max-w-[588px] <lg:children:max-w-[450px]"},[(n(!0),g(Ie,null,pt(e(h),(k,Mt)=>Ce((n(),g("div",{key:k.title,class:_e([`nc-expand-col-${k.title}`,"nc-expanded-form-row w-full"]),"col-id":k.id,"data-testid":`nc-expand-col-${k.title}`},[f("div",Wl,[f("div",Yl,[e(Ye)(k)?(n(),L(Yt,{key:0,column:k,class:"nc-expanded-cell-header h-full flex-none"},null,8,["column"])):(n(),L(qt,{key:1,column:k,class:"nc-expanded-cell-header flex-none"},null,8,["column"]))]),e(T)?(n(),L(Et,{key:0,active:"",class:"h-[37px] flex-none <lg:!w-full lg:flex-1 !rounded-lg !overflow-hidden",size:"small"})):(n(),g(Ie,{key:1},[k.title?(n(),L(Pa,{key:0,ref_for:!0,ref:Mt?null:De=>kt.value=De,class:_e(["bg-white flex-1 <lg:w-full px-1 min-h-[37px] flex items-center relative",{"!select-text nc-system-field":St(k),"!select-text nc-readonly-div-data-cell":e(_)}])},{default:y(()=>[e(Ye)(k)?(n(),L(Gt,{key:0,modelValue:e(D).row[k.title],"onUpdate:modelValue":De=>e(D).row[k.title]=De,class:_e({"px-1":St(k)}),column:k,"read-only":e(_),row:e(D)},null,8,["modelValue","onUpdate:modelValue","class","column","read-only","row"])):(n(),L(Xt,{key:1,modelValue:e(D).row[k.title],"onUpdate:modelValue":[De=>e(D).row[k.title]=De,De=>e(v).add(k.title)],active:!0,column:k,"edit-enabled":!0,"read-only":e(_)},null,8,["modelValue","onUpdate:modelValue","column","read-only"]))]),_:2},1032,["class"])):X("",!0)],64))])],10,Kl)),[[ta,!e(Ye)(k)||!e(F)||e(aa)(k)]])),128)),e(m).length>0?(n(),g("div",ql,[c[14]||(c[14]=f("div",{class:"flex-grow h-px mr-1 bg-gray-100"},null,-1)),i(J,{size:e(x)?"medium":"small",class:"flex-shrink !text-sm overflow-hidden !text-gray-500 !font-weight-500",type:"secondary",onClick:N},{default:y(()=>[he(U(e(O)?`Hide ${e(m).length} hidden`:`Show ${e(m).length} hidden`)+" "+U(e(m).length>1?"fields":"field")+" ",1),i(e(xl),{class:_e([e(O)?"transform rotate-180":"","ml-1"])},null,8,["class"])]),_:1},8,["size"]),c[15]||(c[15]=f("div",{class:"flex-grow h-px ml-1 bg-gray-100"},null,-1))])):X("",!0),e(m).length>0&&e(O)?(n(!0),g(Ie,{key:1},pt(e(m),(k,Mt)=>Ce((n(),g("div",{key:`${k.id}-${k.title}`,class:_e([`nc-expand-col-${k.title}`,"nc-expanded-form-row w-full"]),"data-testid":`nc-expand-col-${k.title}`},[f("div",Xl,[f("div",Jl,[e(Ye)(k)?(n(),L(Yt,{key:0,column:k,"is-hidden-col":"",class:"nc-expanded-cell-header flex-none"},null,8,["column"])):(n(),L(qt,{key:1,column:k,"is-hidden-col":"",class:"nc-expanded-cell-header flex-none"},null,8,["column"]))]),e(T)?(n(),L(Et,{key:0,active:"",class:"h-[37px] flex-none <lg:!w-full lg:flex-1 !rounded-lg !overflow-hidden",size:"small"})):(n(),g(Ie,{key:1},[k.title?(n(),L(Ia,{key:0,ref_for:!0,ref:Mt?null:De=>kt.value=De,class:_e(["bg-white flex-1 <lg:w-full px-1 min-h-[37px] flex items-center relative",{"!select-text nc-system-field":St(k),"!bg-gray-50 !select-text nc-readonly-div-data-cell":e(_)}])},{default:y(()=>[e(Ye)(k)?(n(),L(Gt,{key:0,modelValue:e(D).row[k.title],"onUpdate:modelValue":De=>e(D).row[k.title]=De,column:k,"read-only":e(_),row:e(D)},null,8,["modelValue","onUpdate:modelValue","column","read-only","row"])):(n(),L(Xt,{key:1,modelValue:e(D).row[k.title],"onUpdate:modelValue":[De=>e(D).row[k.title]=De,De=>e(v).add(k.title)],active:!0,column:k,"edit-enabled":!0,"read-only":e(_)},null,8,["modelValue","onUpdate:modelValue","column","read-only"]))]),_:2},1032,["class"])):X("",!0)],64))])],10,Gl)),[[ta,("isFormula"in a?a.isFormula:e(na))(k)||!e(Ye)(k)||!e(F)||e(aa)(k)]])),128)):X("",!0)],512),e(Z)("dataEdit")?(n(),g("div",{key:0,class:_e(["w-full flex items-center justify-end px-2 xs:p-0 xs:gap-x-4 xs:justify-between",{"xs(border-t-1 border-gray-200)":!e(F)}])},[!e(F)&&e(x)?(n(),g("div",Ql,[i(Wt,{placement:"bottomRight",class:"p-2"},{overlay:y(()=>[i(Kt,null,{default:y(()=>[i(He,{class:"text-gray-700",onClick:c[7]||(c[7]=k=>e(B)())},{default:y(()=>[Ce((n(),g("div",Zl,[(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).reload),{class:"cursor-pointer"})),he(" "+U(a.$t("general.reload")),1)])),[[Pe,["c:row-expand:reload"]]])]),_:1}),e(u)?(n(),L(He,{key:0,class:"text-gray-700",onClick:c[8]||(c[8]=k=>e(F)?()=>{}:Ze())},{default:y(()=>[Ce((n(),g("div",es,[(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).copy),{class:"cursor-pointer nc-duplicate-row"})),he(" "+U(a.$t("labels.copyRecordURL")),1)])),[[Pe,["c:row-expand:copy-url"]]])]),_:1})):X("",!0),i(Ht),e(Z)("dataEdit")&&!e(F)?Ce((n(),L(He,{key:1,class:"!text-red-500 !hover:bg-red-50",onClick:c[9]||(c[9]=k=>!e(F)&&Ut())},{default:y(()=>[f("div",ts,[(n(),L(Te(("iconMap"in a?a.iconMap:e(Ve)).delete),{class:"cursor-pointer nc-delete-row"})),c[16]||(c[16]=he(" Delete record "))])]),_:1})),[[Pe,["c:row-expand:delete"]]]):X("",!0)]),_:1})]),default:y(()=>[i(J,{disabled:e(T),class:"nc-expand-form-more-actions",type:"secondary",size:"small"},{default:y(()=>[i(G,{class:_e([e(T)?"text-gray-300":"text-gray-700","text-md"]),icon:"threeDotVertical"},null,8,["class"])]),_:1},8,["disabled"])]),_:1})])):X("",!0),e(F)&&e(x)?(n(),g("div",as)):X("",!0),e(x)?(n(),g("div",ns,[Ce((n(),L(J,{disabled:e(v).size===0&&!e(w),loading:e(te),class:_e(["nc-expand-form-save-btn !xs:text-sm !px-2",{"!h-7":!e(x)}]),"data-testid":"nc-expanded-form-save",type:"primary",size:e(x)?"small":"xsmall",onClick:de},{default:y(()=>[f("div",os,U(a.newRecordSubmitBtnText??e(F)?"Create Record":"Save Record"),1)]),_:1},8,["disabled","loading","class","size"])),[[Pe,["c:row-expand:save"]]])])):X("",!0)],2)):(n(),g("div",ls))],2),e($t)&&!e(A)?(n(),g("div",{key:0,class:_e([{active:e(d)&&e(Z)("commentList")},"nc-comments-drawer border-l-1 relative border-gray-200 bg-gray-50 w-1/3 max-w-[340px] min-w-0 h-full xs:hidden rounded-br-2xl"])},[i(za)],2)):X("",!0)],512)])]}),_:1},16,["class","visible","width","size"])),i(Fa,{visible:e(et),"onUpdate:visible":c[11]||(c[11]=Fe=>Ge(et)?et.value=Fe:null),"entity-name":"Record","on-delete":()=>Va()},{"entity-preview":y(()=>[f("span",null,[f("div",ss,[f("div",rs,[i(jt,{modelValue:e(re),"onUpdate:modelValue":c[10]||(c[10]=Fe=>Ge(re)?re.value=Fe:null),column:e(s)},null,8,["modelValue","column"])])])])]),_:1},8,["visible","on-delete"]),i(oa,{visible:e(dt),"onUpdate:visible":c[12]||(c[12]=Fe=>Ge(dt)?dt.value=Fe:null),size:"small"},{default:y(()=>[f("div",is,[f("div",cs,U(a.$t("tooltip.saveChanges")),1),f("div",ds,U(a.$t("activity.doYouWantToSaveTheChanges")),1),f("div",us,[i(J,{type:"secondary",size:"small",onClick:ct},{default:y(()=>[he(U(a.$t("labels.discard")),1)]),_:1}),i(J,{key:"submit",type:"primary",size:"small",loading:e(te),onClick:Ta},{default:y(()=>[he(U(a.$t("tooltip.saveChanges")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])],64)}}}),ar=gt(vs,[["__scopeId","data-v-16cb9fbe"]]);export{ar as default};
