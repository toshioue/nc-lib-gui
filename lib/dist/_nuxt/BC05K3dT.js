import Ue from"./CGFlARNL.js";import Ye from"./DSjSw5ad.js";import{f as ze,bL as Y,r as N,c$ as Ke,d0 as Te,hb as Pe,g6 as Qe,N as He,d1 as We,fC as Ze,ai as qe,cP as Je,cQ as Xe,h9 as Ae,g as z,cZ as d,i5 as fe,d4 as _e,H as Ie,cU as we,O as ea,o as r,U as f,w as c,a as g,Y as E,P as s,c as A,t as h,b as w,Q as ee,al as ae,am as Ce,T as K,V as D,S as I,d as S,W,R as Le,an as aa,ao as ta,n as sa,fG as la,$ as oa,a2 as ia,ap as na,aG as ra,p as da,e as ca,A as ua,_ as pa}from"./B2hUoZAs.js";import{_ as ma}from"./DerldqwU.js";import{_ as va}from"./DfZ7_DBQ.js";import{_ as fa}from"./e4fIiYA_.js";import{_ as _a}from"./BJs4TgOI.js";import{a as wa}from"./D1iILnOh.js";import{a as ga}from"./Bye44sky.js";import{i as ya}from"./BXXS6TCz.js";import{u as ba}from"./CR-MWfkw.js";import{_ as ha}from"./CGB_6kIS.js";import{D as xa}from"./z-Xby7zn.js";import"./BWYzyVlv.js";import{I as ka}from"./CwHJfKcC.js";import{S as Aa,_ as Ia}from"./CaxUP45y.js";import"./fS-pjH0A.js";import"./pcWi62uI.js";import"./C9qKCFvP.js";import"./B_8aIjz8.js";import"./BGKYJ52S.js";import"./i4toF4kp.js";import"./BQQOEPN4.js";import"./kd0F6MQ0.js";import"./1orNHd0L.js";import"./R1pHeCcp.js";const Ne=Z=>(da("data-v-b56680cd"),Z=Z(),ca(),Z),Ca={class:"flex items-center gap-1"},La={class:"flex items-center gap-2"},Na={key:2,class:"text-capitalize !text-[13px] font-medium"},Sa={key:0,class:"bg-brand-50 text-brand-500 py-1 px-2 text-md rounded-md"},$a={key:0,class:"flex items-center gap-2 px-2 mb-4 w-80"},Ma={class:"pl-2 flex text-sm select-none text-gray-600"},Oa={class:"flex-1 nc-dropdown-cover-image-wrapper flex items-stretch border-1 border-gray-200 rounded-lg transition-all duration-0.3s max-w-[206px]"},Ra={class:"w-full flex gap-2 items-center justify-between max-w-[400px]"},Ea={class:"flex items-center px-2 border-l-1 border-gray-200 cursor-pointer"},Fa={class:"flex flex-col mt-2 pb-2 nc-scrollbar-thin max-h-[47vh] px-2"},Da={class:"nc-fields-list"},Va={key:0,class:"px-2 py-6 text-gray-500 flex flex-col items-center gap-6 text-center"},ja=Ne(()=>g("img",{src:ha,class:"!w-[164px] flex-none",alt:"No search results found"},null,-1)),Ba=["data-testid"],Ga=["onClick"],Ua={key:0,class:"flex mr-2"},Ya=Ne(()=>g("div",{class:"flex-1"},null,-1)),za={key:1,class:"flex px-2 gap-2 py-2"},Ka=ze({__name:"FieldsMenu",setup(Z){const l=Y(Ke,N()),ge=Y(Te,N()),V=Y(Pe,void 0),te=Y(Qe,void 0),{isMobileMode:Se}=He(),$e=Y(We,N(!1)),se=Y(Ze,N(!1)),{$api:T,$e:Me}=ua(),{t:ye}=qe(),{metas:be,getMeta:Oe}=Je(),{showSystemFields:q,fields:p,filteredFieldList:J,filterQuery:j,showAll:le,hideAll:oe,saveOrUpdate:Re,metaColumnById:B,loadViewColumns:ie,toggleFieldStyles:ne,toggleFieldVisibility:Ee}=wa(),{eventBus:Fe,isDefaultView:De}=ga(),{addUndo:G,defineViewScope:U}=Xe();Fe.on(e=>{(e===Ae.FIELD_RELOAD||e===Ae.MAPPED_BY_COLUMN_CHANGE)&&ie()});const re=z(()=>{var e,a;return(a=(e=J.value)==null?void 0:e.filter(o=>!o.show))==null?void 0:a.length}),Ve=z(()=>{var a,o,n,u;if(((a=l.value)==null?void 0:a.type)!==d.GRID&&((o=l.value)==null?void 0:o.type)!==d.CALENDAR)return null;const e=(n=Object.values(B.value))==null?void 0:n.find(m=>m==null?void 0:m.pv);return(u=J.value)==null?void 0:u.find(m=>m.fk_column_id===(e==null?void 0:e.id))}),de=async(e,a=!1)=>{try{if(!p.value||(a||G({undo:{fn:()=>{if(!p.value)return;const o=p.value[e.moved.newIndex];p.value[e.moved.newIndex]=p.value[e.moved.oldIndex],p.value[e.moved.oldIndex]=o,de({moved:{newIndex:e.moved.oldIndex,oldIndex:e.moved.newIndex}},!0)},args:[]},redo:{fn:()=>{if(!p.value)return;const o=p.value[e.moved.oldIndex];p.value[e.moved.oldIndex]=p.value[e.moved.newIndex],p.value[e.moved.newIndex]=o,de(e,!0)},args:[]},scope:U({view:l.value})}),p.value.length<2))return;await Promise.all(p.value.map(async(o,n)=>{o.order!==n+1&&(o.order=n+1,await Re(o,n,!0,!!De.value))})),await ie(),Me("a:fields:reorder")}catch(o){aa.error(await ta(o))}},P=N([]),ce=async e=>{var a,o,n,u,m,x,i,y,C,_,L,b,M;(((a=l.value)==null?void 0:a.type)===d.GALLERY||((o=l.value)==null?void 0:o.type)===d.KANBAN||((n=l.value)==null?void 0:n.type)===d.CALENDAR)&&((u=l.value)!=null&&u.id)&&((m=l.value)!=null&&m.view)&&(((x=l.value)==null?void 0:x.type)===d.GALLERY?(await T.dbView.galleryUpdate((i=l.value)==null?void 0:i.id,{fk_cover_image_col_id:e}),l.value.view.fk_cover_image_col_id=e):((y=l.value)==null?void 0:y.type)===d.KANBAN?(await T.dbView.kanbanUpdate((C=l.value)==null?void 0:C.id,{fk_cover_image_col_id:e}),l.value.view.fk_cover_image_col_id=e):((_=l.value)==null?void 0:_.type)===d.CALENDAR&&(await T.dbView.calendarUpdate((L=l.value)==null?void 0:L.id,{fk_cover_image_col_id:e}),l.value.view.fk_cover_image_col_id=e),await(V==null?void 0:V.trigger()),e&&!((M=(b=p.value)==null?void 0:b.find(k=>k.fk_column_id===e))!=null&&M.show)&&await(te==null?void 0:te.trigger({shouldShowLoading:!1})))},$=z({get:()=>{var a,o,n,u,m;const e=(((a=l.value)==null?void 0:a.type)===d.GALLERY||((o=l.value)==null?void 0:o.type)===d.KANBAN)&&((n=l.value)!=null&&n.view)?((u=l.value)==null?void 0:u.view).fk_cover_image_col_id:void 0;return(m=P.value)!=null&&m.find(x=>x.value===e)?e:e===null?null:void 0},set:async e=>{e!==$.value&&(G({undo:{fn:await ce,args:[$.value]},redo:{fn:await ce,args:[e]},scope:U({view:l.value})}),await ce(e))}}),ue=async e=>{var a,o,n,u,m,x,i,y,C,_,L;if(!(![d.GALLERY,d.KANBAN].includes((a=l.value)==null?void 0:a.type)||!((o=l.value)!=null&&o.id)||!((n=l.value)!=null&&n.view))){if(((u=l.value)==null?void 0:u.type)===d.GALLERY){const b={..._e((x=(m=l.value)==null?void 0:m.view)==null?void 0:x.meta),fk_cover_image_object_fit:e};await T.dbView.galleryUpdate((i=l.value)==null?void 0:i.id,{meta:b}),l.value.view.meta=b}else if(((y=l.value)==null?void 0:y.type)===d.KANBAN){const b={..._e((_=(C=l.value)==null?void 0:C.view)==null?void 0:_.meta),fk_cover_image_object_fit:e};await T.dbView.kanbanUpdate((L=l.value)==null?void 0:L.id,{meta:b}),l.value.view.meta=b}await(V==null?void 0:V.trigger())}},je=[{value:fe.FIT,label:ye("labels.fitImage")},{value:fe.COVER,label:ye("labels.coverImageArea")}],F=N({isOpen:!1,isSaving:null}),Q=z({get:()=>{var e,a,o,n,u;return[d.GALLERY,d.KANBAN].includes((e=l.value)==null?void 0:e.type)&&((a=l.value)!=null&&a.view)?((u=_e((n=(o=l.value)==null?void 0:o.view)==null?void 0:n.meta))==null?void 0:u.fk_cover_image_object_fit)||fe.FIT:void 0},set:async e=>{e!==Q.value&&(F.value.isSaving=e,G({undo:{fn:ue,args:[Q.value]},redo:{fn:ue,args:[e]},scope:U({view:l.value})}),await ue(e)),F.value.isSaving=null,F.value.isOpen=!1}}),Be=()=>{G({undo:{fn:async()=>{await oe()},args:[]},redo:{fn:async()=>{await le()},args:[]},scope:U({view:l.value})}),le()},Ge=()=>{G({undo:{fn:async()=>{await le()},args:[]},redo:{fn:async()=>{await oe()},args:[]},scope:U({view:l.value})}),oe()},pe=z({get:()=>{var e;return(e=J.value)==null?void 0:e.every(a=>a.show)},set:async e=>{e?await Be():await Ge()}}),he=e=>sa(la(e)?Ue:Ye,{columnMeta:e}),H=N(!1),me=z({get:()=>q.value,set:e=>{G({undo:{fn:a=>{q.value=!a},args:[e]},redo:{fn:a=>{q.value=a},args:[e]},scope:U({view:l.value})}),q.value=e}}),ve=N(!1),xe=N();return Ie(H,e=>{e&&(j.value="",setTimeout(()=>{var a;(a=xe.value)==null||a.focus()},100))}),Ie(p,async e=>{var x;if(!e||se.value||![d.GALLERY,d.KANBAN].includes((x=l.value)==null?void 0:x.type))return;const a=e.filter(i=>i.fk_column_id&&B.value[i.fk_column_id].uidt===we.Attachment).map(i=>({value:i.fk_column_id,label:i.title}))??[];P.value=[{value:null,label:"No Image"},...a];const o=e.filter(i=>i.fk_column_id&&B.value[i.fk_column_id].uidt===we.Lookup).map(i=>B.value[i.fk_column_id]),n=new Set,u=async(i,y,C)=>{var L,b,M,k,O,R,t;const _=C||(L=ge.value)!=null&&L.id?(k=(M=be.value[C||((b=ge.value)==null?void 0:b.id)])==null?void 0:M.columns)==null?void 0:k.find(v=>{var X;return v.id===((X=y==null?void 0:y.colOptions)==null?void 0:X.fk_relation_column_id)}):void 0;if((O=_==null?void 0:_.colOptions)!=null&&O.fk_related_model_id){await Oe(_.colOptions.fk_related_model_id);const v=(t=(R=be.value[_.colOptions.fk_related_model_id])==null?void 0:R.columns)==null?void 0:t.find(X=>{var ke;return X.id===((ke=y==null?void 0:y.colOptions)==null?void 0:ke.fk_lookup_column_id)});v&&ya(v)?n.add(i.id):v&&(v==null?void 0:v.uidt)===we.Lookup&&await u(i,v,_.colOptions.fk_related_model_id)}};await Promise.allSettled(o.map(i=>u(i,i)));const m=o.filter(i=>n.has(i==null?void 0:i.id)).map(i=>({value:i.id,label:i.title}));P.value=[...P.value,...m]},{immediate:!0}),ba(H),(e,a)=>{const o=oa,n=ia,u=na,m=Aa,x=Ia,i=ra,y=ma,C=va,_=fa,L=ka,b=_a,M=ea("e");return r(),f(_,{visible:s(H),"onUpdate:visible":a[14]||(a[14]=k=>ee(H)?H.value=k:null),trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-fields-menu nc-toolbar-dropdown"},{overlay:c(()=>{var k,O,R;return[g("div",{class:"pt-2 bg-white w-full min-w-72 max-w-80 rounded-lg nc-table-toolbar-menu","data-testid":"nc-fields-menu",onClick:a[13]||(a[13]=E(()=>{},["stop"]))},[!s(se)&&(((k=s(l))==null?void 0:k.type)===s(d).GALLERY||((O=s(l))==null?void 0:O.type)===s(d).KANBAN)?(r(),A("div",$a,[g("div",Ma,h(e.$t("labels.coverImageField")),1),g("div",Oa,[w(x,{value:s($),"onUpdate:value":a[0]||(a[0]=t=>ee($)?$.value=t:null),class:"flex-1 max-w-[calc(100%_-_33px)]","dropdown-class-name":"nc-dropdown-cover-image !rounded-lg",bordered:!1,onClick:a[1]||(a[1]=E(()=>{},["stop"]))},{suffixIcon:c(()=>[w(o,{class:"text-gray-700",icon:"arrowDown"})]),default:c(()=>[(r(!0),A(ae,null,Ce(s(P),t=>(r(),f(m,{key:t.value,value:t.value},{default:c(()=>[g("div",Ra,[g("div",{class:K(["flex-1 flex items-center gap-1",{"max-w-[calc(100%_-_20px)]":s($)===t.value,"max-w-full":s($)!==t.value}])},[t.value?(r(),f(D(he(s(B)[t.value])),{key:0,class:"!w-3.5 !h-3.5 !text-gray-700 !ml-0"})):I("",!0),w(u,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:c(()=>[S(h(t.label),1)]),default:c(()=>[S(h(t.label),1)]),_:2},1024)],2),s($)===t.value?(r(),f(o,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):I("",!0)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s(Q)?(r(),f(_,{key:0,visible:s(F).isOpen,"onUpdate:visible":a[2]||(a[2]=t=>s(F).isOpen=t),placement:"bottomRight"},{overlay:c(()=>[w(C,{class:"nc-cover-image-object-fit-dropdown-menu min-w-[168px]"},{default:c(()=>[(r(),A(ae,null,Ce(je,t=>w(y,{key:t.value,class:"!children:w-full",onClick:E(v=>Q.value=t.value,["stop"])},{default:c(()=>[g("span",null,h(t.label),1),t.value===s(F).isSaving?(r(),f(i,{key:0,size:"regular",class:"flex-none"})):t.value===s(Q)?(r(),f(o,{key:1,icon:"check",class:"flex-none text-primary w-4 h-4"})):I("",!0)]),_:2},1032,["onClick"])),64))]),_:1})]),default:c(()=>[g("button",Ea,[w(o,{icon:"settings",class:K(["h-4 w-4",{"!text-brand-500":s(F).isOpen}])},null,8,["class"])])]),_:1},8,["visible"])):I("",!0)])])):I("",!0),g("div",{class:"px-2",onClick:a[4]||(a[4]=E(()=>{},["stop"]))},[w(L,{ref_key:"fieldsMenuSearchRef",ref:xe,value:s(j),"onUpdate:value":a[3]||(a[3]=t=>ee(j)?j.value=t:null),placeholder:e.$t("placeholder.searchFields"),class:"nc-toolbar-dropdown-search-field-input"},{prefix:c(()=>[w(o,{icon:"search",class:"nc-search-icon h-3.5 w-3.5 mr-1"})]),_:1},8,["value","placeholder"])]),g("div",Fa,[g("div",Da,[(R=s(p))!=null&&R.filter(t=>t.title.toLowerCase().includes(s(j).toLowerCase())).length?I("",!0):(r(),A("div",Va,[ja,S(" "+h(e.$t("title.noResultsMatchedYourSearch")),1)])),w(s(xa),{modelValue:s(p),"onUpdate:modelValue":a[7]||(a[7]=t=>ee(p)?p.value=t:null),"item-key":"id","ghost-class":"nc-fields-menu-items-ghost",onChange:a[8]||(a[8]=t=>de(t)),onStart:a[9]||(a[9]=t=>ve.value=!0),onEnd:a[10]||(a[10]=t=>ve.value=!1)},{item:c(({element:t})=>[s(J).filter(v=>s(l).type!==s(d).CALENDAR?v!==s(Ve):!0).includes(t)?(r(),A("div",{key:t.id,"data-testid":`nc-fields-menu-${t.title}`,class:"pl-2 flex flex-row items-center rounded-md hover:bg-gray-100",onClick:a[6]||(a[6]=E(()=>{},["stop"]))},[(r(),f(D(("iconMap"in e?e.iconMap:s(W)).drag),{class:"cursor-move !h-3.75 text-gray-600 mr-1"})),Le((r(),A("div",{class:"flex flex-row items-center w-full truncate cursor-pointer ml-1 py-[5px] pr-2",onClick:()=>{t.show=!t.show,s(Ee)(t.show,t)}},[(r(),f(D(he(s(B)[t.fk_column_id])),{class:"!w-3.5 !h-3.5 !text-gray-500"})),w(u,{class:"flex-1 pl-1 pr-2 truncate","show-on-truncate-only":"",disabled:s(ve)},{title:c(()=>[S(h(t.title),1)]),default:c(()=>[S(h(t.title),1)]),_:2},1032,["disabled"]),s(l).type===s(d).CALENDAR?(r(),A("div",Ua,[w(n,{class:K([{"!bg-gray-800 !text-white":t.bold},"!rounded-r-none !w-5 !h-5"]),size:"xxsmall",type:"secondary",onClick:E(v=>s(ne)(t,"bold",!t.bold),["stop"])},{default:c(()=>[(r(),f(D(("iconMap"in e?e.iconMap:s(W)).bold),{class:"!w-3 !h-3"}))]),_:2},1032,["class","onClick"]),w(n,{class:K([{"!bg-gray-800 !text-white":t.italic},"!rounded-x-none !border-x-0 !w-5 !h-5"]),size:"xxsmall",type:"secondary",onClick:E(v=>s(ne)(t,"italic",!t.italic),["stop"])},{default:c(()=>[(r(),f(D(("iconMap"in e?e.iconMap:s(W)).italic),{class:"!w-3 !h-3"}))]),_:2},1032,["class","onClick"]),w(n,{class:K([{"!bg-gray-800 !text-white":t.underline},"!rounded-l-none !w-5 !h-5"]),size:"xxsmall",type:"secondary",onClick:E(v=>s(ne)(t,"underline",!t.underline),["stop"])},{default:c(()=>[(r(),f(D(("iconMap"in e?e.iconMap:s(W)).underline),{class:"!w-3 !h-3"}))]),_:2},1032,["class","onClick"])])):I("",!0),w(b,{checked:t.show,disabled:t.isViewEssentialField,size:"xsmall",onChange:a[5]||(a[5]=v=>e.$t("a:fields:show-hide"))},null,8,["checked","disabled"])],8,Ga)),[[M,["a:fields:show-hide"]]]),Ya],8,Ba)):I("",!0)]),_:1},8,["modelValue"])])]),s(j)?I("",!0):(r(),A("div",za,[w(n,{class:"nc-fields-show-all-fields",size:"small",type:"ghost",onClick:a[11]||(a[11]=t=>pe.value=!s(pe))},{default:c(()=>[S(h(s(pe)?e.$t("general.hideAll"):e.$t("general.showAll"))+" "+h(e.$t("objects.fields").toLowerCase()),1)]),_:1}),s(se)?I("",!0):(r(),f(n,{key:0,class:"nc-fields-show-system-fields",size:"small",type:"ghost",onClick:a[12]||(a[12]=t=>me.value=!s(me))},{default:c(()=>[S(h(s(me)?e.$t("title.hideSystemFields"):e.$t("activity.showSystemFields")),1)]),_:1}))]))])]}),default:c(()=>[g("div",{class:K({"nc-active-btn":s(re)})},[Le((r(),f(n,{disabled:s($e),class:"nc-fields-menu-btn nc-toolbar-btn !h-7 !border-0",size:"small",type:"secondary"},{default:c(()=>{var k,O,R,t;return[g("div",Ca,[g("div",La,[((k=s(l))==null?void 0:k.type)===s(d).KANBAN||((O=s(l))==null?void 0:O.type)===s(d).GALLERY?(r(),f(o,{key:0,class:"h-4 w-4",icon:"creditCard"})):(r(),f(D(("iconMap"in e?e.iconMap:s(W)).fields),{key:1,class:"h-4 w-4"})),s(Se)?I("",!0):(r(),A("span",Na,[((R=s(l))==null?void 0:R.type)===s(d).KANBAN||((t=s(l))==null?void 0:t.type)===s(d).GALLERY?(r(),A(ae,{key:0},[S(h(e.$t("title.editCards")),1)],64)):(r(),A(ae,{key:1},[S(h(e.$t("objects.fields")),1)],64))]))]),s(re)?(r(),A("span",Sa,h(s(re)),1)):I("",!0)])]}),_:1},8,["disabled"])),[[M,["c:fields"]]])],2)]),_:1},8,["visible"])}}}),wt=pa(Ka,[["__scopeId","data-v-b56680cd"]]);export{wt as default};
