import{f as xe,cY as $e,az as Ae,cQ as Ce,cU as Ne,bc as Ve,r as G,ad as Fe,ai as De,ar as Le,g as ue,d6 as i,at as Re,eA as Ie,H as Me,e2 as Ge,b1 as Te,i as Ee,d1 as g,fN as Se,O as Be,o as t,S as w,w as u,a as _,b as y,P as a,c as d,aq as m,d as v,t as r,T as C,aL as Oe,av as J,V as Pe,W as Ke,Y as Ue,R as qe,Q as ze,aj as Ye,d7 as je,a1 as He,$ as Qe,a0 as We,p as Je,e as Xe,_ as Ze}from"./3QBYHahY.js";import{_ as ea}from"./ISaCd8Ij.js";import{_ as aa}from"./D7hrRKCy.js";import{_ as la}from"./C95Svpv6.js";import{i as ta}from"./D4iSzjWt.js";import"./kHOslGNR.js";import{I as sa}from"./CmN9vPg3.js";import{S as oa}from"./BEpKpjF5.js";import{F as ia}from"./DAKhk9t6.js";import{_ as na}from"./Bk0xUMNV.js";import{_ as da}from"./BsWDDIqE.js";const Z=P=>(Je("data-v-d448948b"),P=P(),Xe(),P),ra={class:"flex w-full flex-row justify-between items-center"},ca={class:"flex font-bold text-base gap-x-3 items-center"},ua=["href"],_a={class:"mt-1"},fa=["title"],ma={class:"flex-1 flex items-center gap-1 max-w-[calc(100%_-_24px)]"},pa=["title"],va={class:"flex-1 flex items-center gap-1 max-w-[calc(100%_-_24px)]"},ya={class:"text-gray-800"},ga={class:"flex w-full gap-2 justify-between items-center"},wa={class:"flex gap-2 items-center"},ka=Z(()=>_("div",{class:"flex-1"},null,-1)),ba={key:0,class:"flex flex-row p-4 border-gray-200 border-1 gap-x-4 rounded-lg w-full"},ha={class:"text-gray-500 flex gap-4"},xa={class:"flex flex-col gap-1"},$a=Z(()=>_("h2",{class:"font-semibold text-sm mb-0 text-gray-800"},"Calendar is readonly",-1)),Aa={class:"text-gray-500 font-default text-sm"},Ca={key:1,class:"flex flex-row p-4 border-gray-200 border-1 gap-x-4 rounded-lg w-full"},Na={class:"text-gray-500 flex gap-4"},Va={class:"flex flex-col gap-1"},Fa=Z(()=>_("h2",{class:"font-semibold text-sm mb-0 text-gray-800"},"Suitable fields not present",-1)),Da={class:"text-gray-500 font-default text-sm"},La={class:"flex gap-3 text-gray-800 h-7 mt-4 mb-1 items-center justify-between"},Ra={class:"text-[13px]"},Ia={class:"flex flex-row w-full justify-between gap-x-2 mt-5"},Ma={class:"flex !text-gray-700 items-center gap-2"},Ga={class:"first-letter:capitalize"},Ta={key:1},Ea={class:"flex gap-2 items-center"},Sa=xe({__name:"ViewCreate",props:{modelValue:{type:Boolean},type:{},title:{},selectedViewId:{default:void 0},groupingFieldColumnId:{default:void 0},geoDataFieldColumnId:{default:void 0},description:{},tableId:{},calendarRange:{default:void 0},coverImageColumnId:{default:void 0}},emits:["update:modelValue","created"],setup(P,{emit:_e}){const b=P,ee=_e,{metas:ae,getMeta:le}=$e(),{viewsByTable:fe}=Ae(Ce()),{refreshCommandPalette:me}=Ne(),{selectedViewId:q,groupingFieldColumnId:te,geoDataFieldColumnId:se,tableId:F,coverImageColumnId:z}=Ve(b),R=G(),Y=G(),oe=G(),K=Fe(b,"modelValue",ee),{t:D}=De(),{api:E}=Le(),X=G(!1),ie=ue(()=>fe.value.get(F.value)??[]),S=G(!0),pe={[i.KANBAN]:D("msg.warning.kanbanNoFields"),[i.MAP]:D("msg.warning.mapNoFields"),[i.CALENDAR]:D("msg.warning.calendarNoFields")},e=Re({title:b.title||"",type:b.type,copy_from_id:null,fk_grp_col_id:null,fk_geo_data_col_id:null,calendar_range:b.calendarRange||[],fk_cover_image_col_id:null,description:b.description||""}),p=G([]),ve=[{required:!0,message:`${D("labels.viewName")} ${D("general.required").toLowerCase()}`},{validator:(l,o)=>new Promise((c,h)=>{ie.value.every(x=>x.title!==o)?c(!0):h(new Error("View name should be unique"))}),message:"View name should be unique"}],ye=[{required:!0,message:`${D("general.groupingField")} ${D("general.required")}`}],ge=[{required:!0,message:`${D("general.geoDataField")} ${D("general.required")}`}],ne=ue(()=>({[i.GRID]:"grid",[i.GALLERY]:"gallery",[i.FORM]:"form",[i.KANBAN]:"kanban",[i.MAP]:"map",[i.CALENDAR]:"calendar"})[b.type]);Ie(we),Me(()=>b.type,l=>{e.type=l});function we(){e.title=`${Ge(ne.value)}`;const l=ie.value.filter(o=>o.title.startsWith(e.title)).length;l&&(e.title=`${e.title}-${l}`),q.value&&(e.copy_from_id=q==null?void 0:q.value),Te(()=>{var c;const o=(c=Y.value)==null?void 0:c.$el;o&&(o.focus(),o.select())})}async function de(){var o;let l=null;try{l=await((o=oe.value)==null?void 0:o.validateFields())}catch(c){console.error(c)}if(e.title&&(e.title=e.title.trim()),l&&e.type){if(!F.value)return;try{let c=null;switch(X.value=!0,e.type){case i.GRID:c=await E.dbView.gridCreate(F.value,e);break;case i.GALLERY:c=await E.dbView.galleryCreate(F.value,e);break;case i.FORM:c=await E.dbView.formCreate(F.value,e);break;case i.KANBAN:c=await E.dbView.kanbanCreate(F.value,e);break;case i.MAP:c=await E.dbView.mapCreate(F.value,e);break;case i.CALENDAR:c=await E.dbView.calendarCreate(F.value,{...e,calendar_range:e.calendar_range.map(h=>({fk_from_column_id:h.fk_from_column_id,fk_to_column_id:h.fk_to_column_id}))});break}c&&ee("created",c)}catch(c){Ye.error(c.message)}finally{await me()}K.value=!1,setTimeout(()=>{X.value=!1},500)}}const T=G(!1),ke=()=>{e.description="",T.value=!1},be=()=>{T.value?T.value=!1:(T.value=!0,setTimeout(()=>{var l;(l=Y.value)==null||l.focus()},100))},V=G(!1);Ee(async()=>{var l,o,c,h,x,B;if(e.copy_from_id&&(T.value=!0),[i.GALLERY,i.KANBAN,i.MAP,i.CALENDAR].includes(b.type)){V.value=!0;try{if(R.value=await le(F.value),b.type===i.MAP&&(p.value=R.value.columns.filter(n=>n.uidt===g.GeoData).map(n=>({value:n.id,label:n.title})),se.value?e.fk_geo_data_col_id=se.value:(l=p.value)!=null&&l.length?e.fk_geo_data_col_id=(c=(o=p.value)==null?void 0:o[0])==null?void 0:c.value:S.value=!1),b.type===i.GALLERY){p.value=[{value:null,label:"No Image"},...(R.value.columns||[]).filter(f=>f.uidt===g.Attachment).map(f=>({value:f.id,label:f.title,uidt:f.uidt}))];const n=(h=R.value.columns||[])==null?void 0:h.filter(f=>f.uidt===g.Lookup),k=new Set,$=async(f,N,j)=>{var H,s,U,A,M,Q,re;const I=j||(H=R.value)!=null&&H.id?(A=(U=ae.value[j||((s=R.value)==null?void 0:s.id)])==null?void 0:U.columns)==null?void 0:A.find(L=>{var W;return L.id===((W=N==null?void 0:N.colOptions)==null?void 0:W.fk_relation_column_id)}):void 0;if((M=I==null?void 0:I.colOptions)!=null&&M.fk_related_model_id){await le(I.colOptions.fk_related_model_id);const L=(re=(Q=ae.value[I.colOptions.fk_related_model_id])==null?void 0:Q.columns)==null?void 0:re.find(W=>{var ce;return W.id===((ce=N==null?void 0:N.colOptions)==null?void 0:ce.fk_lookup_column_id)});L&&ta(L)?k.add(f.id):L&&(L==null?void 0:L.uidt)===g.Lookup&&await $(f,L,I.colOptions.fk_related_model_id)}};await Promise.allSettled(n.map(f=>$(f,f)));const O=n.filter(f=>k.has(f==null?void 0:f.id)).map(f=>({value:f.id,label:f.title,uidt:f.uidt}));p.value=[...p.value,...O],z.value?e.fk_cover_image_col_id=z.value:p.value.length>1&&!e.copy_from_id?e.fk_cover_image_col_id=p.value[1].value:e.fk_cover_image_col_id=null}b.type===i.KANBAN&&(p.value=R.value.columns.filter(n=>n.uidt===g.SingleSelect).map(n=>({value:n.id,label:n.title,uidt:n.uidt})),te.value?e.fk_grp_col_id=te.value:(x=p.value)!=null&&x.length?e.fk_grp_col_id=p.value[0].value:S.value=!1,z.value?e.fk_cover_image_col_id=z.value:p.value.length>1&&!e.copy_from_id?e.fk_cover_image_col_id=p.value[1].value:e.fk_cover_image_col_id=null),b.type===i.CALENDAR&&(p.value=R.value.columns.filter(n=>{var k,$;return[g.DateTime,g.Date,g.CreatedTime,g.LastModifiedTime].includes(n.uidt)||n.uidt===g.Formula&&(($=(k=n.colOptions)==null?void 0:k.parsed_tree)==null?void 0:$.dataType)===Se.DATE}).map(n=>({value:n.id,label:n.title,uidt:n.uidt})).sort((n,k)=>{const $={[g.DateTime]:1,[g.Date]:2,[g.Formula]:3,[g.CreatedTime]:4,[g.LastModifiedTime]:5};return($[n.uidt]||6)-($[k.uidt]||6)}),(B=p.value)!=null&&B.length?e.calendar_range.length===0&&(e.calendar_range=[{fk_from_column_id:p.value[0].value,fk_to_column_id:null}]):S.value=!1)}catch(n){console.error(n)}finally{V.value=!1}}});const he=l=>l?l.some(o=>{var h;console.log(o);const c=(h=p.value)==null?void 0:h.find(x=>x.value===(o==null?void 0:o.fk_from_column_id));return!c||![g.DateTime,g.Date].includes(c.uidt)}):!1;return(l,o)=>{const c=je,h=sa,x=na,B=ea,n=He,k=Qe,$=oa,O=aa,f=ia,N=We,j=da,I=la,H=Be("e");return t(),w(I,{visible:a(K),"onUpdate:visible":o[6]||(o[6]=s=>ze(K)?K.value=s:null),class:"nc-view-create-modal","show-separator":!1,size:[a(i).MAP].includes(a(e).type)?"medium":"small"},{header:u(()=>[_("div",ra,[_("div",ca,[y(c,{meta:{type:a(e).type},class:"nc-view-icon !text-[24px] !leading-6 max-h-6 max-w-6"},null,8,["meta"]),a(e).type===a(i).GRID?(t(),d(m,{key:0},[a(e).copy_from_id?(t(),d(m,{key:0},[v(r(l.$t("labels.duplicateGridView")),1)],64)):(t(),d(m,{key:1},[v(r(l.$t("labels.createGridView")),1)],64))],64)):a(e).type===a(i).GALLERY?(t(),d(m,{key:1},[a(e).copy_from_id?(t(),d(m,{key:0},[v(r(l.$t("labels.duplicateGalleryView")),1)],64)):(t(),d(m,{key:1},[v(r(l.$t("labels.createGalleryView")),1)],64))],64)):a(e).type===a(i).FORM?(t(),d(m,{key:2},[a(e).copy_from_id?(t(),d(m,{key:0},[v(r(l.$t("labels.duplicateFormView")),1)],64)):(t(),d(m,{key:1},[v(r(l.$t("labels.createFormView")),1)],64))],64)):a(e).type===a(i).KANBAN?(t(),d(m,{key:3},[a(e).copy_from_id?(t(),d(m,{key:0},[v(r(l.$t("labels.duplicateKanbanView")),1)],64)):(t(),d(m,{key:1},[v(r(l.$t("labels.createKanbanView")),1)],64))],64)):a(e).type===a(i).CALENDAR?(t(),d(m,{key:4},[a(e).copy_from_id?(t(),d(m,{key:0},[v(r(l.$t("labels.duplicateCalendarView")),1)],64)):(t(),d(m,{key:1},[v(r(l.$t("labels.createCalendarView")),1)],64))],64)):(t(),d(m,{key:5},[a(e).copy_from_id?(t(),d(m,{key:0},[v(r(l.$t("labels.duplicateMapView")),1)],64)):(t(),d(m,{key:1},[v(r(l.$t("labels.duplicateView")),1)],64))],64))]),a(e).copy_from_id?C("",!0):(t(),d("a",{key:0,class:"text-sm !text-gray-600 !font-default !hover:text-gray-600",href:`https://docs.nocodb.com/views/view-types/${a(ne)}`,target:"_blank"}," Docs ",8,ua))])]),default:u(()=>[_("div",_a,[a(S)?(t(),w(f,{key:0,ref_key:"formValidator",ref:oe,model:a(e),layout:"vertical",class:"flex flex-col gap-y-5"},{default:u(()=>[y(x,{rules:ve,name:"title"},{default:u(()=>[y(h,{ref_key:"inputEl",ref:Y,value:a(e).title,"onUpdate:value":o[0]||(o[0]=s=>a(e).title=s),placeholder:l.$t("labels.viewName"),autofocus:"",class:"nc-input-sm nc-input-shadow",onKeydown:Oe(de,["enter"])},null,8,["value","placeholder"])]),_:1}),a(e).type===a(i).GALLERY&&!a(e).copy_from_id?(t(),w(x,{key:0,label:`${l.$t("labels.coverImageField")}`,name:"fk_cover_image_col_id"},{default:u(()=>[y(O,{value:a(e).fk_cover_image_col_id,"onUpdate:value":o[1]||(o[1]=s=>a(e).fk_cover_image_col_id=s),disabled:a(V),loading:a(V),"dropdown-match-select-width":"","not-found-content":l.$t("placeholder.selectGroupFieldNotFound"),placeholder:l.$t("placeholder.selectCoverImageField"),class:"nc-select-shadow w-full nc-gallery-cover-image-field-select"},{default:u(()=>[(t(!0),d(m,null,J(a(p),s=>(t(),w($,{key:s.value,value:s.value},{default:u(()=>[_("div",{class:"w-full flex gap-2 items-center justify-between",title:s.label},[_("div",ma,[s.value?(t(),w(B,{key:0,column:s,class:"!ml-0"},null,8,["column"])):C("",!0),y(n,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:u(()=>[v(r(s.label),1)]),default:u(()=>[v(r(s.label),1)]),_:2},1024)]),a(e).fk_cover_image_col_id===s.value?(t(),w(k,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):C("",!0)],8,fa)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled","loading","not-found-content","placeholder"])]),_:1},8,["label"])):C("",!0),a(e).type===a(i).KANBAN&&!a(e).copy_from_id?(t(),w(x,{key:1,label:l.$t("general.groupingField"),rules:ye,name:"fk_grp_col_id"},{default:u(()=>[y(O,{value:a(e).fk_grp_col_id,"onUpdate:value":o[2]||(o[2]=s=>a(e).fk_grp_col_id=s),disabled:a(V),loading:a(V),"dropdown-match-select-width":"","not-found-content":l.$t("placeholder.selectGroupFieldNotFound"),placeholder:l.$t("placeholder.selectGroupField"),class:"nc-select-shadow w-full nc-kanban-grouping-field-select"},{default:u(()=>[(t(!0),d(m,null,J(a(p),s=>(t(),w($,{key:s.value,value:s.value},{default:u(()=>[_("div",{class:"w-full flex gap-2 items-center justify-between",title:s.label},[_("div",va,[y(B,{column:s,class:"!ml-0"},null,8,["column"]),y(n,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:u(()=>[v(r(s.label),1)]),default:u(()=>[v(r(s.label),1)]),_:2},1024)]),a(e).fk_grp_col_id===s.value?(t(),w(k,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):C("",!0)],8,pa)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled","loading","not-found-content","placeholder"])]),_:1},8,["label"])):C("",!0),a(e).type===a(i).MAP?(t(),w(x,{key:2,label:l.$t("general.geoDataField"),rules:ge,name:"fk_geo_data_col_id"},{default:u(()=>[y(O,{value:a(e).fk_geo_data_col_id,"onUpdate:value":o[3]||(o[3]=s=>a(e).fk_geo_data_col_id=s),disabled:a(V),loading:a(V),"not-found-content":l.$t("placeholder.selectGeoFieldNotFound"),options:a(p),placeholder:l.$t("placeholder.selectGeoField"),class:"nc-select-shadow w-full"},null,8,["value","disabled","loading","not-found-content","options","placeholder"])]),_:1},8,["label"])):C("",!0),a(e).type===a(i).CALENDAR&&!a(e).copy_from_id?(t(),d(m,{key:3},[(t(!0),d(m,null,J(a(e).calendar_range,(s,U)=>(t(),d("div",{key:`range-${U}`,class:"flex w-full items-center gap-2"},[_("span",ya,r(l.$t("labels.organiseBy")),1),y(O,{value:s.fk_from_column_id,"onUpdate:value":A=>s.fk_from_column_id=A,disabled:a(V),loading:a(V),class:"nc-select-shadow nc-from-select"},{default:u(()=>[(t(!0),d(m,null,J([...a(p)].filter(A=>{if(U===0)return!0;const M=a(p).find(Q=>Q.value===a(e).calendar_range[0].fk_from_column_id);return(M==null?void 0:M.uidt)===A.uidt}),(A,M)=>(t(),w($,{key:M,class:"w-40",value:A.value},{default:u(()=>[_("div",ga,[_("div",wa,[y(B,{column:A,class:"!ml-0"},null,8,["column"]),y(n,{class:"truncate flex-1 max-w-18",placement:"top","show-on-truncate-only":""},{title:u(()=>[v(r(A.label),1)]),default:u(()=>[v(" "+r(A.label),1)]),_:2},1024)]),ka,A.value===s.fk_from_column_id?(t(),w(Pe(("iconMap"in l?l.iconMap:a(Ke)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary min-w-4 h-4"})):C("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","disabled","loading"])]))),128)),he(a(e).calendar_range)?(t(),d("div",ba,[_("div",ha,[y(k,{class:"min-w-6 h-6 text-orange-500",icon:"info"}),_("div",xa,[$a,_("span",Aa,r(l.$t("msg.info.calendarReadOnly")),1)])])])):C("",!0)],64)):C("",!0)]),_:1},8,["model"])):a(S)?C("",!0):(t(),d("div",Ca,[_("div",Na,[y(k,{class:"min-w-6 h-6 text-orange-500",icon:"alertTriangle"}),_("div",Va,[Fa,_("span",Da,r(pe[a(e).type]),1)])])])),a(T)?(t(),w(x,{key:2},{default:u(()=>[_("div",La,[_("span",Ra,r(l.$t("labels.description")),1),y(N,{type:"text",class:"!h-6 !w-5",size:"xsmall",onClick:ke},{default:u(()=>[y(k,{icon:"delete",class:"text-gray-700 w-3.5 h-3.5"})]),_:1})]),y(j,{ref_key:"inputEl",ref:Y,value:a(e).description,"onUpdate:value":o[4]||(o[4]=s=>a(e).description=s),class:"nc-input-sm nc-input-text-area nc-input-shadow px-3 !text-gray-800 max-h-[150px] min-h-[100px]","hide-details":"","data-testid":"create-table-title-input",placeholder:l.$t("msg.info.enterViewDescription")},null,8,["value","placeholder"])]),_:1})):C("",!0),_("div",Ia,[a(T)?(t(),d("div",Ta)):(t(),w(N,{key:0,size:"small",type:"text",onClick:Ue(be,["stop"])},{default:u(()=>[_("div",Ma,[y(k,{icon:"plus",class:"h-4 w-4"}),_("span",Ga,r(l.$t("labels.addDescription")),1)])]),_:1})),_("div",Ea,[y(N,{type:"secondary",size:"small",onClick:o[5]||(o[5]=s=>K.value=!1)},{default:u(()=>[v(r(l.$t("general.cancel")),1)]),_:1}),qe((t(),w(N,{disabled:!a(S),loading:a(X),type:"primary",size:"small",onClick:de},{loading:u(()=>[v(r(l.$t("labels.creatingView")),1)]),default:u(()=>[v(r(l.$t("labels.createView"))+" ",1)]),_:1},8,["disabled","loading"])),[[H,[a(e).copy_from_id?"a:view:duplicate":"a:view:create"]]])])])])]),_:1},8,["visible","size"])}}}),Wa=Ze(Sa,[["__scopeId","data-v-d448948b"]]);export{Wa as _};
