import H from"./DDp3Vqr0.js";import Y from"./DL47xb_5.js";import{f as $,cO as G,ab as b,cP as Q,g as V,cV as _,hg as T,cU as w,fw as z,fH as m,n as W,fF as j,o as d,U as v,w as y,c as q,al as J,am as K,P as p,a as O,V as L,T as X,b as Z,d as I,t as g,W as ee,S as te,Q as le,ap as ae}from"./DKhUGBot.js";import{_ as se}from"./C600yAEI.js";import{a as oe}from"./BMlI7u7p.js";import{i as ne,a as re}from"./lyxpGZoZ.js";import{S as ie}from"./CX4Cv_ut.js";const ue={class:"flex items-center w-full justify-between w-full gap-2 max-w-50"},ce={class:"flex gap-1.5 flex-1 items-center truncate items-center h-full"},ye=$({__name:"FieldListAutoCompleteDropdown",props:{modelValue:{},isSort:{type:Boolean},columns:{},allowEmpty:{type:Boolean},meta:{}},emits:["update:modelValue"],setup(f,{emit:E}){var k,C;const x=G(f,["modelValue","isSort","allowEmpty"]),M=E,B=b(x,"columns"),h=b(x,"meta"),{metas:F}=Q(),n=V({get:()=>f.modelValue,set:t=>M("update:modelValue",t)}),{showSystemFields:A,metaColumnById:i}=oe(),S=V(()=>{var t,l,a,s,r;return(r=(s=((t=B.value)==null?void 0:t.filter(e=>{var o;return!(_((o=i==null?void 0:i.value)==null?void 0:o[e.id])&&T(e))}))||((a=(l=h.value)==null?void 0:l.columns)==null?void 0:a.filter(e=>{var o;return e.uidt===w.Links?!0:_((o=i==null?void 0:i.value)==null?void 0:o[e.id])?T(e)?!1:n.value===e.id||A.value:e.uidt===w.QrCode||e.uidt===w.Barcode||e.uidt===w.ID?!1:f.isSort?!(z(e)&&e.colOptions.type!==m.BELONGS_TO):!(e.colOptions&&e.system)})))==null?void 0:s.sort((e,o)=>{let u=0,c=0;return _(e)&&(u=1),_(o)&&(c=1),u-c}))==null?void 0:r.map(e=>({value:e.id,label:e.title,icon:W(j(e)?H:Y,{columnMeta:e}),c:e}))}),R=(t,l)=>{var a;return(a=l.label.toLowerCase())==null?void 0:a.includes(t.toLowerCase())};!n.value&&f.allowEmpty!==!0&&(n.value=((C=(k=S.value)==null?void 0:k[0])==null?void 0:C.value)||"");const P={[m.BELONGS_TO]:"text-blue-500",[m.ONE_TO_ONE]:"text-purple-500",[m.HAS_MANY]:"text-orange-500",[m.MANY_TO_MANY]:"text-pink-500"},D=V(()=>{var t,l;return((l=(t=h.value)==null?void 0:t.columns)==null?void 0:l.reduce((a,s)=>{var r,e,o,u;if(s&&ne(s)||re(s)){const c=(o=(e=(r=F.value)==null?void 0:r[h.value.id])==null?void 0:e.columns)==null?void 0:o.find(U=>{var N;return U.id===((N=s.colOptions)==null?void 0:N.fk_relation_column_id)});c&&(a[s.id]=P[(u=c.colOptions)==null?void 0:u.type])}return a},{}))||{}});return(t,l)=>{const a=ae,s=ie,r=se;return d(),v(r,{value:p(n),"onUpdate:value":l[0]||(l[0]=e=>le(n)?n.value=e:null),"dropdown-match-select-width":!1,"show-search":"",placeholder:t.$t("placeholder.selectField"),"filter-option":R,"dropdown-class-name":"nc-dropdown-toolbar-field-list"},{default:y(()=>[(d(!0),q(J,null,K(p(S),e=>(d(),v(s,{key:e.value,label:e.label,value:e.value},{default:y(()=>[O("div",ue,[O("div",ce,[(d(),v(L(e.icon),{class:X(["!w-3.5 !h-3.5 !mx-0",p(D)[e.value]||"!text-gray-500"])},null,8,["class"])),Z(a,{style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},class:"max-w-[15rem] truncate select-none","show-on-truncate-only":""},{title:y(()=>[I(g(e.label),1)]),default:y(()=>[O("span",null,g(e.label),1)]),_:2},1024)]),p(n)===e.value?(d(),v(L(("iconMap"in t?t.iconMap:p(ee)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):te("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["value","placeholder"])}}});export{ye as _};
