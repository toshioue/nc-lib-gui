import{e as Ce,ax as I,cP as Me,r as p,cO as Te,ag as De,m as He,bT as Oe,f as $,F as S,a$ as We,g as Be,M as Ie,o as l,c as m,a as c,N as o,b as n,w as i,O as C,d as f,t as r,z as Se,dn as Ne,P as N,Q as _,W as G,R as y,ao as F,cq as Ue,T as P,U as q,ah as ze,Y as je,Z as Le,$ as Ve,hi as Re,dp as Ye,_ as Ge}from"./DZZ6t_j4.js";import{_ as Fe}from"./CJNscGy3.js";import{_ as Pe}from"./sz1d3zjm.js";import{_ as qe}from"./BLgccLvp.js";import{_ as Ee}from"./vK-WmZ7a.js";import{_ as Qe}from"./CY3l82lI.js";import{_ as Ze}from"./BqKQ8afS.js";import{u as E,_ as Ae}from"./B4ZLG6hR.js";import{u as Je}from"./YRNmwX8m.js";import"./DKN1hQ6S.js";import{I as Ke}from"./BQuyMdA-.js";import"./CDWovrGB.js";import"./vll-Pnjv.js";import"./DgixBgIx.js";import"./CXD-Dj4T.js";import"./Ck-cgwga.js";import"./CyRMlOXW.js";import"./Bdv7ru7D.js";import"./C3jLTHF4.js";import"./BYINaHrJ.js";import"./dfem9Uc_.js";import"./BCJFTkwv.js";import"./D9tFZoTQ.js";import"./D_MsYLkT.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";const Xe={class:"nc-webhook-wrapper w-full p-4"},et={class:"max-w-250 h-full w-full mx-auto"},tt={key:0},ot={class:"w-full mb-4 flex justify-between gap-3"},at={class:"flex-1 flex gap-2"},nt={class:"flex items-center gap-2"},st={class:"flex gap-2 items-center"},lt={style:{height:"calc(100vh - (var(--topbar-height) * 3.5))"},class:""},it={key:0,class:"flex-col flex items-center gap-6 justify-center w-full h-full py-12 px-4 border-1 rounded-xl border-gray-200"},rt={class:"text-gray-700 font-bold text-center text-2xl"},ct={class:"text-gray-700 text-center max-w-[24rem]"},dt={class:"flex items-center gap-2"},ut={class:"text-red-500"},pt={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700 mb-4"},mt={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-2.5",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},vt={key:1,class:"text-small leading-[18px] mb-2 text-gray-500"},ft={key:1,class:"h-full w-full flex flex-col justify-center items-center",style:{height:"calc(100vh - (var(--topbar-height) * 2))"}},_t=Ce({__name:"Webhooks",setup(yt){const{activeTable:U}=I(Me()),{sorts:Q,sortDirection:Z,loadSorts:A,handleGetSortedData:J,saveOrUpdate:z}=Je("Webhook"),b=p(),{hooks:M,isHooksLoading:K}=I(E()),{loadHooksList:X,deleteHook:ee,copyHook:te,saveHooks:oe}=E(),{activeView:ae}=I(Te()),{t:a}=De(),v=p(!1),ne=p(null),se=He(Oe,{style:{fontSize:"2.5rem"},spin:!0}),k=p(""),g=p(!1),j=p(!1),T=$(()=>M.value.find(e=>e.id===k.value)),le=async()=>{if(j.value=!0,!!k.value)try{await ee(k.value)}finally{j.value=!1,g.value=!1,k.value=""}},ie=p(void 0),D=p(!1),re=async e=>{if(!D.value){D.value=!0;try{await te(e)}finally{D.value=!1}}},ce=e=>{k.value=e,g.value=!0},h=p(""),de=$(()=>M.value.filter(e=>{var t;return(t=e.title)==null?void 0:t.toLowerCase().includes(h.value.toLowerCase())})),ue=$(()=>J(de.value,Q.value));S(g,()=>{g.value&&We(()=>{var e,t;(t=(e=ne.value)==null?void 0:e.$el)==null||t.focus()})}),S(v,e=>{e||(b.value=void 0)}),S(()=>{var e;return(e=U.value)==null?void 0:e.id},async()=>{var e;(e=U.value)!=null&&e.id&&(ie.value=void 0,await X())},{immediate:!0});const pe=async e=>{if(e.event==="manual"&&e.operation==="trigger"){ze.error(a("msg.error.manualTriggerHook"));return}const t=Object.assign({},e);e.active=!e.active,await oe({hook:e,ogHook:t})},L=async()=>{v.value=!0},V=e=>{b.value=e,v.value=!0},me=()=>{v.value=!1,b.value=void 0};Be(async()=>{A()});const H=$({get:()=>Z.value,set:e=>{if(Object.keys(e).length===0){z({});return}const[t,d]=Object.entries(e)[0];z({field:t,direction:d})}}),R=p([{text:[a("general.on"),a("labels.recordInsert")],value:["after","insert"]},{text:[a("general.on"),a("labels.recordUpdate")],value:["after","update"]},{text:[a("general.on"),a("labels.recordDelete")],value:["after","delete"]},{text:[a("general.onMultiple"),a("labels.recordInsert")],value:["after","bulkInsert"]},{text:[a("general.onMultiple"),a("labels.recordUpdate")],value:["after","bulkUpdate"]},{text:[a("general.onMultiple"),a("labels.recordDelete")],value:["after","bulkDelete"]},{text:[a("general.manual"),a("general.trigger")],value:["manual","trigger"]}]),ve=[{key:"active",title:a("general.active"),width:90,minWidth:90},{key:"name",title:a("general.name"),minWidth:252,showOrderBy:!0,dataIndex:"title"},{key:"type",title:a("general.type"),basis:"25%",minWidth:200,showOrderBy:!0,dataIndex:"webhook-operation-type"},{key:"created_at",title:a("labels.addedOn"),width:180,minWidth:180,showOrderBy:!0,dataIndex:"created_at"},{key:"action",title:"",width:80,minWidth:80}],fe=e=>({onClick:()=>V(e)}),_e=e=>{var t,d;return((d=(t=R.value.find(w=>w.value.includes(e.event)&&w.value.includes(e.operation)))==null?void 0:t.text)==null?void 0:d.join(" "))||`Before ${e.operation}`};return(e,t)=>{const d=je,w=Ke,x=Le,ye=Fe,Y=Ve,O=Pe,ge=Re,ke=qe,be=Ee,he=Qe,we=Ze,xe=Ae,$e=Ye,W=Ie("e");return l(),m("div",Xe,[c("div",et,[o(ae)&&!o(K)?(l(),m("div",tt,[c("div",ot,[c("div",at,[n(w,{value:o(h),"onUpdate:value":t[0]||(t[0]=s=>C(h)?h.value=s:null),class:"w-full nc-input-sm nc-input-border-on-value !max-w-84",size:"small",placeholder:e.$t("title.searchWebhook"),"allow-clear":""},{prefix:i(()=>[n(d,{icon:"search",class:"mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value","placeholder"]),n(x,{class:"px-2",type:"text",size:"small",onClick:t[1]||(t[1]=s=>("navigateTo"in e?e.navigateTo:o(Se))("https://docs.nocodb.com/category/webhook/",{open:"navigateToBlankTargetOpenOption"in e?e.navigateToBlankTargetOpenOption:o(Ne)}))},{default:i(()=>[c("div",nt,[f(r(e.$t("title.docs"))+" ",1),n(d,{icon:"externalLink"})])]),_:1})]),N((l(),_(x,{type:"secondary",size:"small",class:"!text-brand-500 !hover:text-brand-600","data-testid":"nc-new-webhook",onClick:L},{default:i(()=>[c("div",st,[n(d,{icon:"plus"}),f(" "+r(e.$t("activity.newWebhook")),1)])]),_:1})),[[W,["c:actions:webhook"]]])]),c("div",lt,[o(M).length?(l(),_(he,{key:1,"order-by":o(H),"onUpdate:orderBy":t[4]||(t[4]=s=>C(H)?H.value=s:null),columns:ve,data:o(ue),"custom-row":fe,class:"h-full","body-row-class-name":"nc-view-sidebar-webhook-item"},{bodyCell:i(({column:s,record:u})=>[n(Y,{disabled:u.event!=="manual"},{title:i(()=>[f(r(e.$t("msg.error.manualTriggerHook")),1)]),default:i(()=>[s.key==="active"?N((l(),m("div",{key:0,onClick:t[2]||(t[2]=G(()=>{},["stop"]))},[n(ye,{size:"small",disabled:u.event==="manual",checked:!!u.active,onChange:B=>pe(u)},null,8,["disabled","checked","onChange"])])),[[W,["c:actions:webhook"]]]):y("",!0)]),_:2},1032,["disabled"]),s.key==="name"?(l(),_(Y,{key:0,class:"truncate max-w-full text-gray-800 font-semibold text-sm","show-on-truncate-only":""},{title:i(()=>[f(r(u.title),1)]),default:i(()=>[f(r(u.title)+" ",1)]),_:2},1024)):y("",!0),s.key==="type"?(l(),m(F,{key:1},[f(r(_e(u)),1)],64)):y("",!0),s.key==="created_at"?(l(),m(F,{key:2},[f(r(o(Ue)(u.created_at).format("DD MMM YYYY")),1)],64)):y("",!0),s.key==="action"?(l(),_(be,{key:3,"overlay-class-name":"nc-webhook-item-action-dropdown"},{overlay:i(()=>[n(ke,{class:"w-48"},{default:i(()=>[n(O,{key:"edit","data-testid":"nc-webhook-item-action-edit",onClick:B=>V(u)},{default:i(()=>[n(d,{icon:"edit",class:"text-gray-800"}),c("span",null,r(e.$t("general.edit")),1)]),_:2},1032,["onClick"]),n(O,{key:"duplicate","data-testid":"nc-webhook-item-action-duplicate",onClick:B=>re(u)},{default:i(()=>[n(d,{icon:"duplicate",class:"text-gray-800"}),c("span",null,r(e.$t("general.duplicate")),1)]),_:2},1032,["onClick"]),n(ge,{class:"my-1.5"}),n(O,{key:"delete",class:"!hover:bg-red-50","data-testid":"nc-webhook-item-action-delete",onClick:B=>ce(u.id)},{default:i(()=>[c("div",ut,[n(d,{icon:"delete",class:"group-hover:text-accent -ml-0.25 -mt-0.75 mr-0.5"}),f(" "+r(e.$t("general.delete")),1)])]),_:2},1032,["onClick"])]),_:2},1024)]),default:i(()=>[n(x,{type:"secondary",size:"small",class:"!w-8 !h-8","data-testid":"nc-webhook-item-action",onClick:t[3]||(t[3]=G(()=>{},["stop"]))},{default:i(()=>[(l(),_(P(("iconMap"in e?e.iconMap:o(q)).threeDotVertical),{class:"text-gray-700"}))]),_:1})]),_:2},1024)):y("",!0)]),_:1},8,["order-by","data"])):(l(),m("div",it,[c("div",rt,r(e.$t("msg.createWebhookMsg1")),1),c("div",ct,r(e.$t("msg.createWebhookMsg2")),1),N((l(),_(x,{class:"flex max-w-40",type:"primary",size:"small",onClick:L},{default:i(()=>[c("div",dt,[n(d,{icon:"plus",class:"flex-none"}),c("span",null,r(e.$t("activity.newWebhook")),1)])]),_:1})),[[W,["c:actions:webhook"]]])]))]),n(we,{visible:o(g),"onUpdate:visible":t[5]||(t[5]=s=>C(g)?g.value=s:null),"entity-name":e.$t("objects.webhook"),"on-delete":le},{"entity-preview":i(()=>{var s;return[o(T)?(l(),m("div",pt,[(l(),_(P(("iconMap"in e?e.iconMap:o(q)).hook),{class:"text-gray-600"})),c("div",mt,r(o(T).title),1)])):y("",!0),((s=o(T))==null?void 0:s.event)==="manual"?(l(),m("span",vt,r(e.$t("msg.warning.webhookDelete")),1)):y("",!0)]}),_:1},8,["visible","entity-name"]),o(v)?(l(),_(xe,{key:0,value:o(v),"onUpdate:value":t[6]||(t[6]=s=>C(v)?v.value=s:null),hook:o(b),"event-list":o(R),onClose:me},null,8,["value","hook","event-list"])):y("",!0)])):(l(),m("div",ft,[n($e,{size:"large",indicator:o(se)},null,8,["indicator"])]))])])}}}),Et=Ge(_t,[["__scopeId","data-v-23f273e2"]]);export{Et as default};
