import{e as Y,r as E,az as te,jf as ne,f as U,jj as de,dc as pe,N as e,o as v,c as S,a,t as u,Q as V,w as c,S as B,b as f,O as Q,d as L,R as $,Y as le,$ as re,bL as ce,d7 as ue,ba as me,ay as fe,ax as ve,c$ as k,cm as _e,T as oe,U as G,a8 as ie,dg as D,Z as ge,_ as be,M as ye,P,jp as se,ao as he}from"./DZZ6t_j4.js";import{_ as we}from"./DqAHSrWO.js";import{_ as xe}from"./vK-WmZ7a.js";import{u as ae}from"./DCmcl80_.js";import{_ as $e}from"./DnwRMKX3.js";import{D as ke}from"./Dg0-TbNo.js";import"./DKN1hQ6S.js";import{I as Fe}from"./BQuyMdA-.js";import{T as Se}from"./DKoVb009.js";import{u as Ce}from"./BJrIHEse.js";import{R as Oe,_ as Le}from"./CFvUUxCy.js";import{_ as Ve}from"./CDWovrGB.js";import"./sz1d3zjm.js";import"./BLgccLvp.js";import"./DnSVh-oD.js";import"./D_MsYLkT.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";import"./vll-Pnjv.js";import"./BtLb9F6G.js";import"./hZgTYrdl.js";import"./ByVBARmO.js";import"./37hePIet.js";import"./C4K5fdHe.js";import"./i4aLU0Nw.js";import"./GMLocJHP.js";import"./BC4FfNUJ.js";import"./EqBqqo9-.js";import"./eX8_g88K.js";import"./BfEabL6Z.js";import"./DO2z7KR_.js";import"./DNgdBwTe.js";import"./_UtSxoDP.js";import"./CdfAcTJv.js";import"./CToWLgER.js";import"./jD721dGr.js";import"./8CPSAnYl.js";import"./wnVheyFD.js";import"./CbkSs5Gy.js";import"./B_hXH8Ph.js";import"./BDAIZopQ.js";import"./CwCOKBa8.js";import"./C9Sjn86N.js";import"./ZFfr47_V.js";import"./CmWcz5yS.js";import"./Dw0oE3Jr.js";import"./Cj0Ygd-o.js";import"./DXGe1EHQ.js";import"./BL8INA0H.js";import"./bWYzyg0p.js";import"./BGrG97ky.js";import"./B05h-4V9.js";import"./CEmZpw8Z.js";import"./RXURfzjs.js";import"./DQfemegE.js";import"./8DEek4Fb.js";import"./Bdv7ru7D.js";import"./xByXWphG.js";import"./BqKQ8afS.js";import"./DgixBgIx.js";import"./CXD-Dj4T.js";import"./0azk-b-q.js";import"./B89oU1M4.js";import"./CMIIcM5i.js";import"./B0udi9ji.js";import"./Bvfp7LPc.js";import"./BCU2uY6p.js";import"./C3jLTHF4.js";import"./BYINaHrJ.js";import"./dfem9Uc_.js";import"./D9tFZoTQ.js";import"./CA74dF2b.js";import"./qW2V2r_p.js";import"./boyBAVNN.js";import"./DGj1ycqW.js";import"./t0mbNaqp.js";import"./DyDFI6NE.js";const Re={key:0,class:"flex flex-col"},Ue={class:"flex flex-col gap-3"},qe={class:"flex items-center justify-between"},Me={class:"text-gray-800 font-medium"},Te={class:"flex flex-col"},Ae={class:"text-sm text-gray-500"},je={key:0,class:"mt-2 visibility-condition-input-error text-red-500"},Ie=Y({__name:"visibility",setup(H){const{visibleColumns:R,activeField:l,allViewFilters:h,localColumns:q,localColumnsMapByFkColumnId:y}=ae(),C=E(!1),A=E({});te(ne,A);const _=U(()=>q.value.reduce((d,o)=>{var t;return o!=null&&o.fk_column_id&&((t=o==null?void 0:o.label)!=null&&t.trim())&&(d[o.fk_column_id]=o.label),d},{}));te(de,_);const n=U(()=>{var d,o,t;return((t=(o=pe((d=l.value)==null?void 0:d.meta))==null?void 0:o.visibility)==null?void 0:t.errors)||{}}),g=U(()=>Object.keys(n.value).length),b=U(()=>{var d,o;return(d=l.value)!=null&&d.fk_column_id&&!h.value[l.value.fk_column_id]&&(h.value[l.value.fk_column_id]=[]),h.value[`${(o=l.value)==null?void 0:o.fk_column_id}`]}),r=U(()=>{var d;return!!(R.value.length&&R.value[0].id===((d=l.value)==null?void 0:d.id))}),M=d=>{var p,m,i;const o=d.id!==((p=l.value)==null?void 0:p.fk_column_id),t=d.id&&y.value[d.id]?(y.value[d.id].order??1/0)<(((m=l.value)==null?void 0:m.order)??1/0):!1,w=(i=y.value[d.id])==null?void 0:i.show;return o&&t&&w};return(d,o)=>{const t=le,w=re,p=we,m=xe;return e(l)?(v(),S("div",Re,[a("div",Ue,[a("div",qe,[a("div",Me,u(d.$t("labels.showOnConditions")),1),a("div",Te,[e(b)?(v(),V(m,{key:0,visible:e(C),"onUpdate:visible":o[1]||(o[1]=i=>Q(C)?C.value=i:null),placement:"bottomLeft",disabled:e(r)&&!e(b).length&&!e(C),"overlay-class-name":"nc-form-field-visibility-dropdown"},{overlay:c(()=>[a("div",{class:B(["nc-form-field-visibility-dropdown-container",{"py-2":!e(b).length}])},[f(p,{ref:"fieldVisibilityRef",modelValue:e(b),"onUpdate:modelValue":o[0]||(o[0]=i=>Q(b)?b.value=i:null),class:"w-full","auto-save":!0,"data-testid":"nc-filter-menu","show-loading":!1,"parent-col-id":e(l).fk_column_id,"filter-option":M,"visibility-error":e(n),"disable-add-new-filter":e(r)},null,8,["modelValue","parent-col-id","visibility-error","disable-add-new-filter"])],2)]),default:c(()=>[f(w,{placement:"left",disabled:!e(r)},{title:c(()=>o[2]||(o[2]=[L(" Cannot add conditions to the first field in a form. ")])),default:c(()=>[a("div",{class:B(["nc-form-field-visibility-btn border-1 rounded-lg py-1 px-3 flex items-center justify-between gap-2 !min-w-[170px] transition-all cursor-pointer select-none text-sm",{"!border-brand-500 shadow-selected":e(C),"border-gray-200":!e(C),"bg-[#F0F3FF]":e(b).length,"opacity-70 cursor-default nc-disabled":e(r)&&!e(b).length}]),"data-testid":"nc-form-field-visibility-btn"},[a("div",{class:B(["nc-form-field-visibility-conditions-count flex-1",{"text-brand-500 ":e(b).length}])},u(e(b).length?`${e(b).length} condition${e(b).length!==1?"s":""}`:"No conditions"),3),e(g)?(v(),V(t,{key:0,icon:"alertTriangle",class:"flex-none !text-red-500"})):$("",!0),f(t,{icon:"settings",class:B(["flex-none w-4 h-4",{"text-brand-500 ":e(b).length}])},null,8,["class"])],2)]),_:1},8,["disabled"])]),_:1},8,["visible","disabled"])):$("",!0)])]),a("div",null,[a("div",Ae,u(d.$t("labels.showFieldOnConditionsMet")),1),e(g)?(v(),S("div",je," Error conditions will not be used for determining field visibility. ")):$("",!0)])])])):$("",!0)}}}),Ne={class:"w-full h-full nc-col-select-option nc-form-scrollbar"},ze={key:0},Be={key:1,class:"flex items-stretch gap-2 pr-2 pl-3 py-1.5 rounded-t-lg border-1 border-b-0 border-gray-200"},De=["data-testid"],Ee=["onClick"],He={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ge={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Pe={class:"px-0.5 py-2 text-gray-500 text-center"},Qe={class:"px-0.5 py-2 text-gray-500 text-center"},Ye=Y({__name:"LimitOptions",props:{modelValue:{},formFieldState:{},column:{},isRequired:{type:Boolean}},emits:["update:modelValue","update:formFieldState"],setup(H,{emit:R}){const l=H,h=R,q=ce(ue),{column:y,formFieldState:C}=me(l),A=fe(),{basesUser:_}=ve(A),n=U(()=>q.value.base_id?_.value.get(q.value.base_id)||[]:[]),g=E(""),b=E(!1),r=U({get:()=>{var w,p;let o=1;const t=(l.modelValue||[]).reduce((m,i)=>(o<((i==null?void 0:i.order)??0)&&(o=i.order),{...m,[i.id]:i}),{})??{};if(k.User===y.value.uidt){const m=(n.value||[]).filter(i=>!(i!=null&&i.deleted)).map(i=>{var x,F;return{id:i.id,email:i.email,display_name:i.display_name,order:i.id&&t[i.id]?((x=t[i.id])==null?void 0:x.order)??i.order:o++,show:i.id&&t[i.id]?(F=t[i.id])==null?void 0:F.show:!(l.modelValue||[]).length}}).sort((i,x)=>i.order-x.order);return(l.modelValue||[]).length!==m.length&&h("update:modelValue",m.map(i=>({id:i.id,order:i.order,show:i.show}))),m}else if([k.SingleSelect,k.MultiSelect].includes(y.value.uidt)){const m=(((w=y.value.colOptions)==null?void 0:w.options)||[]).map(i=>{var x,F;return{...i,order:i.id&&t[i.id]?((x=t[i.id])==null?void 0:x.order)??i.order:o++,show:i.id&&t[i.id]?(F=t[i.id])==null?void 0:F.show:!(l.modelValue||[]).length}}).sort((i,x)=>i.order!==void 0&&x.order!==void 0?i.order-x.order:0);return(l.modelValue||[]).length!==(((p=y.value.colOptions)==null?void 0:p.options)||[]).length&&h("update:modelValue",m.map(i=>({id:i.id,order:i.order,show:i.show}))),m}return[]},set:o=>{const t=(C.value||"").split(","),w=[];h("update:modelValue",o.map(p=>(p.show||(y.value.uidt===k.User&&t.includes(p.id)?w.push(p.id):p!=null&&p.title&&t.includes(p.title)&&w.push(p.title)),{id:p.id,order:p.order,show:p.show}))),h("update:formFieldState",t.filter(p=>!w.includes(p)).join(","))}});async function M(o){var x,F;const{moved:{newIndex:t=0,oldIndex:w=0,element:p}}=o;let m;!r.value.length||r.value.length===1?m=1:r.value.length-1===t?m=Math.max(...r.value.map(O=>(O==null?void 0:O.order)??0))+1:t===0?m=Math.min(...r.value.map(O=>(O==null?void 0:O.order)??0))/2:m=(parseFloat(String(((x=r.value[t-1])==null?void 0:x.order)??0))+parseFloat(String(((F=r.value[t+1])==null?void 0:F.order)??0)))/2;const i=isNaN(Number(m))?w:m;p.order=i,r.value=[...r.value]}const d=o=>{l.isRequired&&!o||(r.value=r.value.map(t=>({...t,show:o})))};return(o,t)=>{var O,Z;const w=le,p=Fe,m=ge,i=re,x=$e,F=Se;return v(),S("div",Ne,[e(r).length>12?(v(),S("div",ze,[f(p,{value:e(g),"onUpdate:value":t[1]||(t[1]=s=>Q(g)?g.value=s:null),class:"!h-9 !px-3 !py-1 !rounded-lg mb-2",placeholder:`${o.$t("placeholder.searchOptions")}...`,name:"nc-form-field-limit-option-search-input","data-testid":"nc-form-field-limit-option-search-input"},{prefix:c(()=>[f(w,{icon:"search",class:"mr-2 h-4 w-4 text-gray-500 group-hover:text-black"})]),suffix:c(()=>[e(g).length>0?(v(),V(w,{key:0,icon:"close",class:"ml-2 h-4 w-4 text-gray-500 group-hover:text-black","data-testid":"nc-form-field-clear-search",onClick:t[0]||(t[0]=s=>g.value="")})):$("",!0)]),_:1},8,["value","placeholder"])])):$("",!0),e(r).length?(v(),S("div",Be,[f(i,{disabled:!o.isRequired},{title:c(()=>[L(u(o.$t("msg.info.preventHideAllOptions")),1)]),default:c(()=>[f(m,{type:"secondary",size:"xxsmall",class:"!border-none !px-2 !text-xs !text-gray-500 !disabled:text-gray-300",disabled:o.isRequired||e(r).filter(s=>!s.show).length===e(r).length,onClick:t[2]||(t[2]=s=>d(!1))},{default:c(()=>[L(u(o.$t("general.hideAll")),1)]),_:1},8,["disabled"])]),_:1},8,["disabled"]),a("div",null,[f(m,{type:"secondary",size:"xxsmall",class:"!border-none !px-2 !text-xs !text-gray-500 !disabled:text-gray-300",disabled:e(r).filter(s=>s.show).length===e(r).length,onClick:t[3]||(t[3]=s=>d(!0))},{default:c(()=>[L(u(o.$t("general.showAll")),1)]),_:1},8,["disabled"])])])):$("",!0),e(r).length?(v(),V(e(ke),{key:2,"model-value":e(r),"item-key":"id",handle:".nc-child-draggable-icon","ghost-class":"nc-form-field-limit-option-ghost",class:"rounded-b-lg border-1 border-gray-200 !max-h-[224px] overflow-y-auto nc-form-scrollbar",onChange:t[4]||(t[4]=s=>M(s)),onStart:t[5]||(t[5]=s=>b.value=!0),onEnd:t[6]||(t[6]=s=>b.value=!1)},_e({item:c(({element:s})=>{var j,I,N,J,K,W,X;return[(e(y).uidt===e(k).User?(I=((j=s==null?void 0:s.display_name)==null?void 0:j.trim())||(s==null?void 0:s.email))!=null&&I.toLowerCase().includes(e(g).toLowerCase()):(N=s.title)!=null&&N.toLowerCase().includes(e(g).toLowerCase()))?(v(),S("div",{key:s.id,class:B(["w-full h-10 px-2 py-1.5 flex flex-row items-center gap-3 border-b-1 last:border-none border-gray-200",[`nc-form-field-${(J=e(y).title)==null?void 0:J.replaceAll(" ","")}-limit-option-${(K=s.title)==null?void 0:K.replaceAll(" ","")}`,`${s.show?"hover:bg-gray-50":"bg-gray-100"}`]]),"data-testid":`nc-form-field-${(W=e(y).title)==null?void 0:W.replaceAll(" ","")}-limit-option-${(X=s.title)==null?void 0:X.replaceAll(" ","")}`},[(v(),V(oe(("iconMap"in o?o.iconMap:e(G)).drag),{class:"nc-child-draggable-icon flex-none cursor-move !h-4 !w-4 text-gray-600"})),f(i,{disabled:!o.isRequired||!(s.show&&o.isRequired&&e(r).filter(T=>T.show).length===1)},{title:c(()=>[L(u(o.$t("msg.info.preventHideAllOptions")),1)]),default:c(()=>[a("div",{class:"!border-none !px-2",onClick:()=>{s.show&&o.isRequired&&e(r).filter(T=>T.show).length===1||(s.show=!s.show,r.value=[...e(r)])}},[(v(),V(oe(s.show?("iconMap"in o?o.iconMap:e(G)).eye:("iconMap"in o?o.iconMap:e(G)).eyeSlash),{class:"flex-none cursor-pointer !h-4 !w-4 text-gray-600"}))],8,Ee)]),_:2},1032,["disabled"]),e(y).uidt===e(k).User?(v(),V(F,{key:0,class:"rounded-tag max-w-[calc(100%_-_70px)] !pl-0",color:"'#ccc'"},{default:c(()=>{var T,ee;return[a("span",{style:ie({color:e(D).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(D).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:"flex items-stretch gap-2"},[a("div",null,[f(x,{size:"auto",name:(T=s.display_name)!=null&&T.trim()?(ee=s.display_name)==null?void 0:ee.trim():"",email:s.email,class:"!text-[0.65rem]"},null,8,["name","email"])]),f(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:c(()=>{var z;return[L(u(((z=s.display_name)==null?void 0:z.trim())||(s==null?void 0:s.email)),1)]}),default:c(()=>{var z;return[a("span",He,u(((z=s.display_name)==null?void 0:z.trim())||(s==null?void 0:s.email)),1)]}),_:2},1024)],4)]}),_:2},1024)):(v(),V(F,{key:1,class:"rounded-tag max-w-[calc(100%_-_70px)]",color:s.color},{default:c(()=>[a("span",{style:ie({color:e(D).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(D).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"})},[f(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:c(()=>[L(u(s.title),1)]),default:c(()=>[a("span",Ge,u(s.title),1)]),_:2},1024)],4)]),_:2},1032,["color"]))],10,De)):$("",!0)]}),_:2},[e(r).length?e(r).length&&e(g)&&!((Z=(O=e(r))==null?void 0:O.filter(s=>{var j,I,N;return e(y).uidt===e(k).User?(I=((j=s==null?void 0:s.display_name)==null?void 0:j.trim())||(s==null?void 0:s.email))==null?void 0:I.toLowerCase().includes(e(g).toLowerCase()):(N=s.title)==null?void 0:N.toLowerCase().includes(e(g).toLowerCase())}))!=null&&Z.length)?{name:"footer",fn:c(()=>[a("div",Qe,u(o.$t("title.noOptionsFound"))+" with title `"+u(e(g))+"`",1)]),key:"1"}:void 0:{name:"footer",fn:c(()=>[a("div",Pe,u(o.$t("title.noOptionsFound")),1)]),key:"0"}]),1032,["model-value"])):$("",!0)])}}}),Ze=be(Ye,[["__scopeId","data-v-831129b0"]]),Je={class:"nc-form-field-settings p-4 flex flex-col gap-4 border-b border-gray-200"},Ke={class:"text-sm font-bold text-gray-800"},We={class:"flex flex-col gap-6"},Xe={class:"flex items-center justify-between gap-3"},et={key:0,class:"!my-0 nc-form-input-enable-scanner-form-item"},tt={class:"flex items-center justify-between gap-3"},ot={class:"nc-form-input-enable-scanner text-gray-800 font-medium"},it={key:1,class:"w-full flex items-start justify-between gap-3"},st={class:"flex-1 max-w-[calc(100%_-_40px)]"},lt={class:"font-medium text-gray-800"},rt={class:"text-gray-500 mt-1"},at={key:0,class:"mt-3"},nt={key:0,class:"nc-form-field-appearance-settings p-4 flex flex-col gap-4 border-b border-gray-200"},dt={class:"text-sm font-bold text-gray-800"},pt={class:"flex flex-col gap-6"},jo=Y({__name:"field-settings",setup(H){const{formState:R,activeField:l,updateColMeta:h,isRequired:q}=ae(),{betaFeatureToggleState:y}=Ce(),C=_=>{l.value&&(l.value.meta.isList=_,h(l.value))},A=_=>y.show&&[k.SingleLineText,k.Number,k.Email,k.URL,k.LongText].includes(_);return(_,n)=>{const g=Ve,b=Ie,r=Ze,M=Oe,d=Le,o=ye("e");return e(l)?(v(),S(he,{key:0},[a("div",Je,[a("div",Ke,u(_.$t("objects.field"))+" "+u(_.$t("activity.validations").toLowerCase()),1),a("div",We,[a("div",Xe,[a("div",{class:"nc-form-input-required text-gray-800 font-medium",onClick:n[0]||(n[0]=()=>{e(l).required=!e(l).required,e(h)(e(l))})},u(_.$t("general.required"))+" "+u(_.$t("objects.field").toLowerCase()),1),P(f(g,{checked:e(l).required,"onUpdate:checked":n[1]||(n[1]=t=>e(l).required=t),size:"small","data-testid":"nc-form-input-required",onChange:n[2]||(n[2]=t=>e(h)(e(l)))},null,8,["checked"]),[[o,["a:form-view:field:mark-required"]]])]),A(e(l).uidt)?(v(),S("div",et,[a("div",tt,[a("div",ot,u(_.$t("general.enableScanner")),1),P(f(g,{checked:e(l).enable_scanner,"onUpdate:checked":n[3]||(n[3]=t=>e(l).enable_scanner=t),"data-testid":"nc-form-input-enable-scanner",size:"small",onChange:n[4]||(n[4]=t=>e(h)(e(l)))},null,8,["checked"]),[[o,["a:form-view:field:mark-enable-scanner"]]])])])):$("",!0),f(b),e(se)(e(l).uidt)?(v(),S("div",it,[a("div",st,[a("div",lt,u(_.$t("labels.limitOptions")),1),a("div",rt,u(_.$t("labels.limitOptionsSubtext"))+".",1),e(l).meta.isLimitOption?(v(),S("div",at,[f(r,{"model-value":e(l).meta.limitOptions,"onUpdate:modelValue":[n[5]||(n[5]=t=>e(l).meta.limitOptions=t),n[6]||(n[6]=t=>e(h)(e(l)))],"form-field-state":e(R)[e(l).title]||"",column:e(l),"is-required":e(q)(e(l),e(l).required),"onUpdate:formFieldState":n[7]||(n[7]=t=>{e(R)[e(l).title]=t})},null,8,["model-value","form-field-state","column","is-required"])])):$("",!0)]),P(f(g,{checked:e(l).meta.isLimitOption,"onUpdate:checked":n[8]||(n[8]=t=>e(l).meta.isLimitOption=t),size:"small",class:"flex-none nc-form-switch-focus",onChange:n[9]||(n[9]=t=>e(h)(e(l)))},null,8,["checked"]),[[o,["a:form-view:field:limit-options"]]])])):$("",!0)])]),e(se)(e(l).uidt)?(v(),S("div",nt,[a("div",dt,u(_.$t("general.appearance")),1),a("div",pt,[a("div",null,[n[10]||(n[10]=a("div",{class:"text-gray-800 font-medium"},"Options layout",-1)),f(d,{value:!!e(l).meta.isList,class:"nc-form-field-layout !mt-3 max-w-[calc(100%_-_40px)]","onUpdate:value":C},{default:c(()=>[f(M,{value:!1},{default:c(()=>[L(u(_.$t("general.dropdown")),1)]),_:1}),f(M,{value:!0},{default:c(()=>[L(u(_.$t("general.list")),1)]),_:1})]),_:1},8,["value"])])])])):$("",!0)],64)):$("",!0)}}});export{jo as default};
