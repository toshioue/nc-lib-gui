import{_ as te}from"./C-O9ejkO.js";import{_ as oe}from"./DgSeK08O.js";import{r as E,g as z,H as se,i as ae,f as M,o as l,c as u,b as y,w as b,aq as q,av as H,P as s,t as _,T as A,a,aa as ne,S as N,a9 as le,co as re,U as ce,$ as R,a1 as ie,ds as j,_ as G,ad as ue,fc as pe,d as L,cs as de,a0 as me,p as _e,e as fe}from"./Cgw6cdOy.js";import{_ as he}from"./CJBRTPd8.js";import{_ as ve}from"./DQEz7g1o.js";import{_ as ye}from"./zKWQxcjd.js";import{u as ge}from"./CO8XXsKl.js";import{d as we}from"./G4Pt-Lbf.js";import{F as Y}from"./DpYA1Dpy.js";import"./Bcy-XIkn.js";import{I as xe}from"./DPaOlBFV.js";import{_ as be}from"./BZz6iAla.js";import{_ as ke}from"./dmcxUY_0.js";import{_ as Se}from"./C6pQ4eSP.js";import{a as Ie,A as U}from"./C9Wup3nv.js";import"./D8rpj5Lr.js";import"./BcZAlRJW.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";import"./hvq8FVej.js";import"./BiBN5Lxt.js";import"./LSbsNkd9.js";import"./BIsWr_mR.js";import"./VVwMOds3.js";var p=(c=>(c.Input="input",c.Select="select",c.Switch="switch",c.Space="space",c.Password="password",c))(p||{});const Z="form-builder-non-categorized",[Te,$e]=ge(c=>{const{formSchema:F,onSubmit:g,initialState:m}=c,C=Y.useForm,P=E(),f=E(!1),w=E(!1),o=z(()=>{const n={};for(const t of F)t.category=t.category||Z,n[t.category]||(n[t.category]=[]),n[t.category].push(t);return n}),i=(n,t,I)=>{const v=t.split("."),e=v.pop();if(!e)return;const r=v.reduce((T,$)=>(T[$]||(T[$]={}),T[$]),n);r[e]=I},h=()=>{const n={};for(const t of F)t.model&&(t.type===p.Switch?i(n,t.model,t.defaultValue??!1):t.type===p.Select?i(n,t.model,t.defaultValue??[]):i(n,t.model,t.defaultValue??""));return n},d=E(h()),B=z(()=>{const n={};for(const t of F)t.model&&t.required&&(n[t.model]=[{required:!0,message:`${t.label} is required`}]);return{title:[{required:!0,message:"Integration title is required"}],...n}}),{validate:x,validateInfos:k}=C(d,B),O=async()=>{var n,t,I,v,e;try{await x()}catch(r){return(e=(v=(I=(t=(n=P.value)==null?void 0:n.$el.querySelector(".ant-form-item-explain-error"))==null?void 0:t.parentNode)==null?void 0:I.parentNode)==null?void 0:v.querySelector("input"))==null||e.focus(),{success:!1,details:r}}f.value=!0;try{return{success:!0,result:await(g==null?void 0:g())}}catch(r){return{success:!1,details:r}}finally{f.value=!1}};function D(){if(!(m!=null&&m.value))return!1;const n=we(m.value,d.value);return!(typeof n=="object"&&Object.keys(n).length===0)}return se(d,()=>{D()?w.value=!0:w.value=!1},{deep:!0}),ae(async()=>{f.value=!0,d.value={...h(),...(m==null?void 0:m.value)??{}},f.value=!1}),{form:P,formState:d,initialState:m,formElementsCategorized:o,isLoading:f,isChanged:w,validateInfos:k,validate:x,submit:O}},"form-builder-helper");function Fe(){const c=$e();if(c==null)throw new Error("Please call `useProvideFormBuilderHelper` on the appropriate parent component");return c}const Be={class:"nc-form-builder nc-scrollbar-thin relative"},Ae={key:0,class:"nc-form-section-title"},Ne={class:"nc-form-section-body"},Ce={class:"flex flex-wrap"},Oe={class:"flex items-center gap-1"},De={key:0,class:"text-red-500"},Pe={class:"text-xs"},qe={class:"flex items-center"},Ee={class:"ml-[6px] font-bold"},ze={class:"text-xs"},He={key:0,class:"w-full mt-1 pl-[35px]"},Ue={class:"text-xs text-gray-500"},Ve={key:4,class:"w-full mt-1"},Le={class:"text-xs text-gray-500"},Me={class:"flex items-center justify-center h-full w-full !bg-white !bg-opacity-85 z-1000"},Re=M({__name:"index",setup(c){const{form:F,formState:g,formElementsCategorized:m,isLoading:C,validateInfos:P}=Fe(),f=o=>o.split(".").reduce((i,h)=>i[h],g.value),w=(o,i)=>{const h=o.split("."),d=h.pop();if(!d)return;const B=h.reduce((x,k)=>(x[k]||(x[k]={}),x[k]),g.value);B[d]=i};return(o,i)=>{const h=R,d=ie,B=xe,x=be,k=he,O=ve,D=ke,n=Y,t=j,I=ye;return l(),u("div",Be,[y(n,{ref_key:"form",ref:F,model:s(g),"hide-required-mark":"",layout:"vertical",class:"flex flex-col gap-4"},{default:b(()=>[(l(!0),u(q,null,H(Object.keys(s(m)),v=>(l(),u("div",{key:v,class:"nc-form-section"},[v!==("FORM_BUILDER_NON_CATEGORIZED"in o?o.FORM_BUILDER_NON_CATEGORIZED:s(Z))?(l(),u("div",Ae,_(v),1)):A("",!0),a("div",Ne,[a("div",Ce,[(l(!0),u(q,null,H(s(m)[v],e=>(l(),u(q,{key:e.model},[e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:s(p)).Space?(l(),u("div",{key:0,style:ne(`width:${+e.width||100}%`),class:"w-full"},null,4)):(l(),N(D,le({key:1,ref_for:!0},s(P)[e.model],{class:"nc-form-item",style:`width:${+e.width||100}%`,required:!1,"data-testid":`nc-form-input-${e.model}`}),re({default:b(()=>[e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:s(p)).Input?(l(),N(B,{key:0,autocomplete:"off",class:"!w-full",value:f(e.model),"onUpdate:value":r=>w(e.model,r)},null,8,["value","onUpdate:value"])):e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:s(p)).Password?(l(),N(x,{key:1,readonly:"",onfocus:"this.removeAttribute('readonly');",onblur:"this.setAttribute('readonly', true);",autocomplete:"off",value:f(e.model),"onUpdate:value":r=>w(e.model,r)},null,8,["value","onUpdate:value"])):e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:s(p)).Select?(l(),N(k,{key:2,value:f(e.model),options:e.options,"onUpdate:value":r=>w(e.model,r)},null,8,["value","options","onUpdate:value"])):e.type===("FormBuilderInputType"in o?o.FormBuilderInputType:s(p)).Switch?(l(),u("div",{key:3,class:ce(["flex flex-col p-2",e.border?"border-1 rounded-lg shadow":""])},[a("div",qe,[y(O,{checked:!!f(e.model),"onUpdate:checked":r=>w(e.model,r)},null,8,["checked","onUpdate:checked"]),a("span",Ee,_(e.label),1),e.helpText?(l(),N(d,{key:0},{title:b(()=>[a("div",ze,_(e.helpText),1)]),default:b(()=>[y(h,{icon:"info",class:"text-gray-500 h-4 ml-1"})]),_:2},1024)):A("",!0)]),e.helpText&&!e.showHintAsTooltip?(l(),u("div",He,[a("div",Ue,_(e.helpText),1)])):A("",!0)],2)):A("",!0),e.helpText&&e.type!==("FormBuilderInputType"in o?o.FormBuilderInputType:s(p)).Switch&&!e.showHintAsTooltip?(l(),u("div",Ve,[a("div",Le,_(e.helpText),1)])):A("",!0)]),_:2},[[("FormBuilderInputType"in o?o.FormBuilderInputType:s(p)).Switch].includes(e.type)?void 0:{name:"label",fn:b(()=>[a("div",Oe,[a("span",null,_(e.label),1),e.required?(l(),u("span",De,"*")):A("",!0),e.helpText&&e.showHintAsTooltip?(l(),N(d,{key:1},{title:b(()=>[a("div",Pe,_(e.helpText),1)]),default:b(()=>[y(h,{icon:"info",class:"text-gray-500 h-4"})]),_:2},1024)):A("",!0)])]),key:"0"}]),1040,["style","data-testid"]))],64))),128))])])]))),128))]),_:1},8,["model"]),y(I,{"model-value":s(C),inline:"",transition:"",class:"!bg-opacity-15"},{default:b(()=>[a("div",Me,[y(t,{size:"large"})])]),_:1},8,["model-value"])])}}}),je=G(Re,[["__scopeId","data-v-dbf4ad9d"]]),Ge=c=>(_e("data-v-4941accd"),c=c(),fe(),c),Ye={class:"flex flex-col h-full h-[calc(100vh_-_40px)]","data-testid":"nc-setup-config"},Ze={class:"flex gap-3 items-center"},Ke={"data-rec":"true"},Je={class:"h-full flex h-[calc(100%_-_48px)]"},Qe={class:"nc-config-left-panel nc-scrollbar-thin relative h-full flex flex-col"},We={class:"w-full flex items-center gap-3 border-gray-200 py-6 px-6"},Xe={class:"font-semibold text-base"},et=Ge(()=>a("div",{class:"flex-grow"},null,-1)),tt={class:"flex gap-2"},ot={class:"h-[calc(100%_-_48px)] flex py-4 flex-col p-6 overflow-auto"},st={key:0,class:"flex flex-row w-full justify-center items-center h-52"},at={key:1,class:"flex"},nt={class:"nc-config-right-panel"},lt={class:"flex-grow flex flex-col gap-3"},rt={class:"text-gray-500 text-capitalize"},ct=["href"],it={class:"text-gray-500 text-capitalize"},ut={class:""},pt=M({__name:"Config",props:{id:{},modelValue:{type:Boolean}},emits:["saved","close","update:modelValue"],async setup(c,{emit:F}){let g,m;const C=c,f=ue(C,"modelValue",F),{readPluginDetails:w,activePluginFormData:o,activePlugin:i,isLoading:h,loadingAction:d,testSettings:B,saveSettings:x}=Ie();[g,m]=pe(()=>w(C.id)),await g,m();const k={Input:p.Input,Select:p.Select,Checkbox:p.Switch,LongText:p.Input,Password:p.Password},{formState:O,validate:D,validateInfos:n}=Te({formSchema:[...i.value.formDetails.items.flatMap((e,r)=>[{type:k[e.type]||p.Input,label:e.label,placeholder:e.placeholder,model:e.key,required:e.required,helpText:e.help_text,width:"48",border:!1,showHintAsTooltip:!0},...r%2?[]:[{type:p.Space,width:"4"}]])],initialState:o}),t=async e=>{try{switch(e){case U.Save:await D(),o.value=O.value,await x(),f.value=!1;break;case U.Test:await D(),o.value=O.value,await B();break}}catch(r){console.log(r)}finally{d.value=null}},I=z(()=>Object.values(n||{}).every(e=>e.validateStatus!=="error")),v=z(()=>{var e,r,T,$;return[{title:"Application Setup",url:`https://docs.nocodb.com/account-settings/oss-specific-details#configure-${(r=(e=i.value)==null?void 0:e.category)==null?void 0:r.toLowerCase()}`},...(($=(T=i.value)==null?void 0:T.formDetails)==null?void 0:$.docs)||[]]});return(e,r)=>{const T=te,$=oe,K=me,J=j,Q=je,W=R,X=Se;return l(),u("div",Ye,[y($,null,{title:b(()=>[a("div",Ze,[y(T,{app:s(i),class:"h-8 w-8"},null,8,["app"]),a("span",Ke,_(s(i).title),1)])]),_:1}),a("div",Je,[a("div",Qe,[a("div",We,[a("span",Xe,_(e.$t("labels.configuration")),1),et,a("div",tt,[(l(!0),u(q,null,H(s(i).formDetails.actions,(S,ee)=>{var V;return l(),N(K,{key:ee,loading:s(d)===S.key,type:S.key===("Action"in e?e.Action:s(U)).Save?"primary":"default",size:"small",disabled:!!s(d)||!s(I),"data-testid":`nc-setup-config-action-${(V=S.key)==null?void 0:V.toLowerCase()}`,onClick:dt=>t(S.key)},{default:b(()=>[L(_(S.label),1)]),_:2},1032,["loading","type","disabled","data-testid","onClick"])}),128))])]),a("div",ot,[s(h)||!s(i)?(l(),u("div",st,[y(J,{size:"large"})])):(l(),u("div",at,[y(Q,{class:"w-229 px-2 mx-auto"})]))])]),a("div",nt,[a("div",lt,[a("div",rt,_(e.$t("labels.documentation")),1),(l(!0),u(q,null,H(s(v),S=>(l(),u("a",{key:S.title,href:S.url,target:"_blank",rel:"noopener noreferrer",class:"!no-underline !text-current flex gap-2 items-center"},[y(W,{icon:"bookOpen",class:"text-gray-500"}),L(" "+_(S.title),1)],8,ct))),128)),y(X),a("div",it,_(e.$t("labels.modifiedOn")),1),a("div",ut,_(s(de)(s(i).created_at).format("DD MMM YYYY HH:mm")),1)])])])])}}}),zt=G(pt,[["__scopeId","data-v-4941accd"]]);export{zt as default};
