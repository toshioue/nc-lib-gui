import{_ as Pe}from"./odmV3s9h.js";import{_ as je}from"./BSzBZdFZ.js";import{_ as Ee}from"./CiTH7PYd.js";import{f as Ne,cu as V,cN as Se,N as Te,bN as $,r as c,hr as Ue,aC as Be,aE as Ke,hL as Oe,aF as He,gQ as Re,ai as Ae,hH as ze,gV as Ge,fQ as qe,g as h,df as D,ct as be,cs as n,F as Le,d3 as ge,af as we,H as $e,i1 as Qe,i as Xe,cC as We,aG as Ze,iN as Je,o as H,c as De,a as P,b as _e,w as Me,U as R,P as t,S as ae,Q as ea,Y as j,T as he,a9 as aa,aq as ta,$ as la,_ as sa}from"./Cgw6cdOy.js";import"./Mq7h2J0k.js";import"./BM5CMLBx.js";const oa=["title"],ua=["value","placeholder","readonly"],na=["value","placeholder","readonly"],ra={key:0,class:"absolute inset-0 z-90 cursor-pointer"},ia=Ne({__name:"DateTimePicker",props:{modelValue:{},isPk:{type:Boolean},showCurrentDateOption:{type:[Boolean,String]},isUpdatedFromCopyNPaste:{}},emits:["update:modelValue","currentDate"],setup(v,{emit:ke}){const J=ke,te={[V[0]]:"hh:mm A",[V[1]]:"hh:mm:ss A",[V[2]]:"hh:mm:ss.SSS A"},{isMssql:Ve,isXcdbBase:xe}=Se(),{showNull:_,isMobileMode:le}=Te(),U=$(Ue,c(!1)),A=$(Be,c(!1)),p=$(Ke,c(!1)),x=$(Oe,c(!1)),E=$(He,c(!1)),Ce=$(Re,c(!1)),{t:se}=Ae(),B=$(ze,c(!1)),K=$(Ge,c(!1)),s=$(qe),z=c(!1),y=c(),M=c(),oe=h(()=>{var l,o,m,i;const a=((o=D((l=s==null?void 0:s.value)==null?void 0:l.meta))==null?void 0:o.date_format)??be[0],e=((i=D((m=s==null?void 0:s.value)==null?void 0:m.meta))==null?void 0:i.time_format)??V[0];return`${a} ${e}`}),ee=h(()=>{var a,e;return((e=D((a=s==null?void 0:s.value)==null?void 0:a.meta))==null?void 0:e.date_format)??be[0]}),w=h(()=>{var a,e;return((e=D((a=s==null?void 0:s.value)==null?void 0:a.meta))==null?void 0:e.time_format)??V[0]});let N=v.modelValue?n(v.modelValue).utc().local():void 0;const G=c(!1),r=c(!1),f=c(),b=c(!0),u=h({get(){var e;if(!v.modelValue||G.value)return;if(!n(v.modelValue).isValid()){z.value=!0;return}const a=xe(s.value.source_id);if(s.value.title in(v.isUpdatedFromCopyNPaste??{}))return N=n(v.modelValue).utc().local(),N;if(!a)return/^\d+$/.test(v.modelValue)?n(+v.modelValue):n(v.modelValue);if(Ve(s.value.source_id))return n(v.modelValue);if((e=s==null?void 0:s.value)!=null&&e.cdf)return n(v.modelValue).utc().local();if(N){const l=N;return N=void 0,l}return n(v.modelValue).utc().local()},set(a){if(G.value=!1,!a){J("update:modelValue",null);return}a.isValid()&&(N=n(a),J("update:modelValue",n(a).utc().format("YYYY-MM-DD HH:mm:ssZ")))}});Le(()=>{u.value&&(f.value=u.value)});const k=h(()=>ge(s.value)||U.value||u.value&&v.isPk),C=h(()=>U.value||k.value||U.value||u.value&&v.isPk?!1:r.value&&(A.value||p.value)),S=`picker_${Math.floor(Math.random()*99999)}`;we(y,a=>{var e,l,o,m,i;(e=a.target)!=null&&e.closest(`.${S}, .nc-${S}`)||((o=(l=y.value)==null?void 0:l.blur)==null||o.call(l),(i=(m=M.value)==null?void 0:m.blur)==null||i.call(m),r.value=!1)});const ue=a=>{b.value=a,r.value=!0};$e(r,a=>{var e,l,o,m;a?(p.value=!0,b.value?(l=(e=y.value)==null?void 0:e.focus)==null||l.call(e):(m=(o=M.value)==null?void 0:o.focus)==null||m.call(o),we(document.querySelector(`.${S}`),i=>{var g;(g=i==null?void 0:i.target)!=null&&g.closest(`.nc-${S}`)||(r.value=!1)})):G.value=!1},{flush:"post"});const T=h(()=>(E.value||K.value)&&!z.value||x.value&&!_.value&&!z.value&&!ge(s.value)&&A.value||B.value?{dateTime:oe.value,date:ee.value,time:D(s.value.meta).is12hrFormat?`${w.value} AM`:w.value}:v.modelValue===null&&_.value?se("general.null").toUpperCase():z.value?se("msg.invalidDate"):""),F=$(Qe,null),q=()=>{U.value||r.value||(r.value=A.value||p.value)};Xe(()=>{F==null||F.on(q)}),We(()=>{F==null||F.on(q)});const ne=(a,e=!1)=>{b.value=e,!F&&q()},re=(a,e,l=!1)=>{var o,m,i,g,Y,O,I,d,L,fe,Q,me,X,ce,W,pe,Z,ye;switch(a.key!=="Enter"&&a.stopPropagation(),a.key){case"Enter":a.preventDefault(),Ce.value&&a.stopPropagation(),u.value=f.value,l?((O=(Y=y.value)==null?void 0:Y.blur)==null||O.call(Y),r.value=!1,p.value=!1):(a.stopPropagation(),(m=(o=M.value)==null?void 0:o.blur)==null||m.call(o),b.value=!1,(g=(i=y.value)==null?void 0:i.focus)==null||g.call(i),q());return;case"Escape":e?(r.value=!1,p.value=!1,x.value&&!K.value&&!B.value&&(l?(d=(I=y.value)==null?void 0:I.blur)==null||d.call(I):(fe=(L=M.value)==null?void 0:L.blur)==null||fe.call(L))):(p.value=!1,l?(me=(Q=y.value)==null?void 0:Q.blur)==null||me.call(Q):(ce=(X=M.value)==null?void 0:X.blur)==null||ce.call(X));return;case"Tab":r.value=!1,x.value&&!K.value&&!B.value&&(l?(pe=(W=y.value)==null?void 0:W.blur)==null||pe.call(W):(ye=(Z=M.value)==null?void 0:Z.blur)==null||ye.call(Z),a.shiftKey&&l||!a.shiftKey&&!l?p.value=!1:a.stopPropagation());return;default:!e&&/^[0-9a-z]$/i.test(a.key)&&(r.value=!0)}};Ze(document,"keydown",a=>{var e,l;if(A.value&&!(a.altKey||a.ctrlKey||a.shiftKey||a.metaKey||!x.value||K.value||B.value||Je()))switch(a.key){case";":u.value=n(new Date),a.preventDefault();break;default:!C.value&&(y.value||M.value)&&/^[0-9a-z]$/i.test(a.key)&&(G.value=!0,b.value?(e=y.value)==null||e.focus():(l=M.value)==null||l.focus(),p.value=!0,r.value=!0)}}),$e(p,a=>{x.value&&a&&!r.value&&(b.value=!0,r.value=!0)});const ie=(a,e)=>{let l=a.target.value;if(e){if(!l){f.value=void 0;return}const o=n(l,ee.value);o.isValid()&&(u.value?f.value=n(`${o.format("YYYY-MM-DD")} ${u.value.format(w.value)}`):f.value=o)}if(!e){if(!l){f.value=n(n().format("YYYY-MM-DD"));return}l=D(s.value.meta).is12hrFormat?l.trim().toUpperCase().replace(/(AM|PM)$/," $1").replace(/\s+/g," "):l.trim();const o=n(l,D(s.value.meta).is12hrFormat?te[w.value]:w.value);o.isValid()&&(f.value=n(`${(f.value??n()).format("YYYY-MM-DD")} ${o.format(w.value)}`))}};function de(a){if(a&&u.value){const e=n(`${a.format("YYYY-MM-DD")} ${u.value.format(w.value)}`);f.value=e,u.value=e}else f.value=a,u.value=a;r.value=!1}function Fe(a){if(a.isValid()){if(u.value){const e=n(`${u.value.format("YYYY-MM-DD")} ${a.format("HH:mm")}:00`);f.value=e,u.value=e}else{const e=n(`${n().format("YYYY-MM-DD")} ${a.format("HH:mm")}:00`);f.value=e,u.value=e}r.value=!1}}const Ye=h(()=>({[V[0]]:{12:"max-w-[85px]",24:"max-w-[65px]"},[V[1]]:{12:"max-w-[100px]",24:"max-w-[80px]"},[V[2]]:{12:"max-w-[130px]",24:"max-w-[110px]"}})[w.value][D(s.value.meta).is12hrFormat?12:24]),Ie=h(()=>{var a;return((a=u.value)==null?void 0:a.format(D(s.value.meta).is12hrFormat?te[w.value]:w.value))??""}),ve=a=>{r.value=!1,J("currentDate",a)};return(a,e)=>{const l=Pe,o=je,m=Ee,i=la;return H(),De(ta,null,[P("div",aa(a.$attrs,{class:"nc-cell-field relative"}),[_e(m,{visible:t(C),placement:t(b)?"bottomLeft":"bottomRight","auto-close":!1,trigger:["click"],class:R(["nc-cell-picker-datetime",[`nc-${S}`,{"nc-null":a.modelValue===null&&t(_)}]]),"overlay-class-name":`${S} nc-picker-datetime ${t(r)?"active":""} !min-w-[0] overflow-hidden`},{overlay:Me(()=>[P("div",{class:R(["min-w-[72px]",{"w-[256px]":t(b)}])},[t(b)?(H(),ae(l,{key:0,"page-date":t(f),"onUpdate:pageDate":e[12]||(e[12]=g=>ea(f)?f.value=g:null),"selected-date":t(u),"is-open":t(C),type:"date",size:"medium","show-current-date-option":a.showCurrentDateOption,"onUpdate:selectedDate":de,onCurrentDate:ve},null,8,["page-date","selected-date","is-open","show-current-date-option"])):(H(),ae(o,{key:1,"selected-date":t(u),"min-granularity":30,"is-min-granularity-picker":"","is12hr-format":!!("parseProp"in a?a.parseProp:t(D))(t(s).meta).is12hrFormat,"is-open":t(C),"show-current-date-option":a.showCurrentDateOption,"onUpdate:selectedDate":Fe,onCurrentDate:ve},null,8,["selected-date","is12hr-format","is-open","show-current-date-option"]))],2)]),default:Me(()=>{var g,Y,O,I;return[P("div",{title:(g=t(u))==null?void 0:g.format(t(oe)),class:R(["nc-date-picker ant-picker-input flex relative !w-auto gap-2",{"justify-between":!t(k)}])},[P("div",{class:R(["flex-none rounded-md box-border w-[60%] max-w-[110px]",{"py-0":t(E),"py-0.5":!t(E)&&!t(k),"bg-gray-100":t(b)&&t(C),"hover:bg-gray-100 px-1":!t(k)}])},[P("input",{ref_key:"datePickerRef",ref:y,value:((Y=t(u))==null?void 0:Y.format(t(ee)))??"",placeholder:typeof t(T)=="string"?t(T):(O=t(T))==null?void 0:O.date,class:"nc-date-input w-full !truncate border-transparent outline-none !text-current !bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:!!t(le)||t(k),onFocus:e[0]||(e[0]=d=>ue(!0)),onKeydown:e[1]||(e[1]=d=>re(d,t(C),!0)),onMouseup:e[2]||(e[2]=j(()=>{},["stop"])),onMousedown:e[3]||(e[3]=j(()=>{},["stop"])),onClick:e[4]||(e[4]=j(d=>ne(d,!0),["stop"])),onInput:e[5]||(e[5]=d=>ie(d,!0))},null,40,ua)],2),P("div",{class:R(["flex-none rounded-md box-border flex-1",[`${t(Ye)}`,{"py-0":t(E),"py-0.5":!t(E)&&!t(k),"bg-gray-100":!t(b)&&t(C),"hover:bg-gray-100 px-1":!t(k)}]])},[P("input",{ref_key:"timePickerRef",ref:M,value:t(Ie),placeholder:typeof t(T)=="string"?t(T):(I=t(T))==null?void 0:I.time,class:"nc-time-input w-full !truncate border-transparent outline-none !text-current !bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:!!t(le)||t(k),onFocus:e[6]||(e[6]=d=>ue(!1)),onKeydown:e[7]||(e[7]=d=>re(d,t(r))),onMouseup:e[8]||(e[8]=j(()=>{},["stop"])),onMousedown:e[9]||(e[9]=j(()=>{},["stop"])),onClick:e[10]||(e[10]=j(d=>ne(d,!1),["stop"])),onInput:e[11]||(e[11]=d=>ie(d,!1))},null,40,na)],2)],10,oa)]}),_:1},8,["visible","placement","class","overlay-class-name"]),t(u)&&(t(K)||t(E)||!t(x)||t(B))&&!t(U)?(H(),ae(i,{key:0,icon:"closeCircle",class:"nc-clear-date-time-icon nc-action-icon h-4 w-4 absolute right-0 top-[50%] transform -translate-y-1/2 invisible cursor-pointer",onClick:e[13]||(e[13]=j(g=>de(),["stop"]))})):he("",!0)],16),!t(p)&&t(x)?(H(),De("div",ra)):he("",!0)],64)}}}),ya=sa(ia,[["__scopeId","data-v-dc83f724"]]);export{ya as default};
