import{_ as xe}from"./Do1LnTan.js";import{f as ke,N as Ce,bN as b,da as Ie,fQ as Se,hr as $e,r as k,aE as Ae,aC as Me,aA as Re,cN as Le,az as ne,g as I,aF as Ee,hH as je,hK as Ve,hN as Be,L as Ue,df as K,H as oe,i1 as ze,i as He,cC as Ne,aG as Te,o as u,c as _,P as a,S as B,w as m,aq as U,av as O,V as ie,U as p,b as x,a as y,aa as H,dj as S,d as Q,t as $,T as D,Q as re,n as Ke,Y as ce,a1 as De,$ as qe,du as Pe,_ as Ge}from"./Cgw6cdOy.js";import{u as de}from"./CnN16FGu.js";import{B as Fe}from"./BBXMuneh.js";import{M as Oe}from"./yuUjrAi0.js";import{C as Qe,a as Je}from"./KNudlHpk.js";import{R as Ye,_ as We}from"./BttyO-T4.js";import{T as Xe}from"./BBFld1ZO.js";import{S as Ze,_ as ea}from"./D8rpj5Lr.js";import"./CitraFSq.js";import"./hvq8FVej.js";import"./BcZAlRJW.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";const aa={key:0,class:"w-full max-w-full"},la={class:"flex-none"},sa={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},ta=ke({__name:"User",props:{modelValue:{},rowIndex:{},location:{},forceMulti:{type:Boolean}},emits:["update:modelValue"],setup(J,{emit:ue}){const Y=ue,{isMobileMode:me}=Ce(),W=b(Ie),w=b(Se),N=b($e),X=b(Ae,k(!1)),Z=b(Me,k(!1)),fe=Re(),pe=Le(),{basesUser:ve}=ne(fe),{idUserMap:ye}=ne(pe),ee=I(()=>W.value.base_id?ve.value.get(W.value.base_id)||[]:[]),T=I(()=>Z.value||X.value),q=b(Ee,k(!1)),P=b(je,k(!1)),R=I(()=>{var e;return J.forceMulti||((e=w.value.meta)==null?void 0:e.is_multi)}),A=b(Ve,k(void 0)),L=k(),c=k(!1),E=b(Be,k(!1)),ae=k(),{isUIAllowed:we}=Ue(),j=I(()=>{var n,r,d;let e=1;const l=(((n=K(w.value.meta))==null?void 0:n.limitOptions)||[]).reduce((o,i)=>(e<((i==null?void 0:i.order)??0)&&(e=i.order),{...o,[i.id]:i}),{})??{},t=[];return!P.value&&q.value&&((r=K(w.value.meta))!=null&&r.isLimitOption)&&(((d=K(w.value.meta))==null?void 0:d.limitOptions)||[]).length?t.push(...(ee.value||[]).filter(o=>{var i,z;return((i=l[o.id])==null?void 0:i.show)!==void 0?(z=l[o.id])==null?void 0:z.show:!1}).map(o=>{var i;return{id:o.id,email:o.email,display_name:o.display_name,deleted:o.deleted,order:o.id&&l[o.id]?((i=l[o.id])==null?void 0:i.order)??o.order:e++}}).sort((o,i)=>o.order-i.order)):t.push(...(ee.value||[]).map(o=>({id:o.id,email:o.email,display_name:o.display_name,deleted:o.deleted,order:e++})).sort((o,i)=>o.order-i.order)),t}),le=I(()=>we("dataEdit")),h=I(()=>(le.value||q.value)&&T.value),g=I({get:()=>{let e=[],l=J.modelValue;if(typeof l=="string"&&/^\s*[{[]/.test(l))try{l=JSON.parse(l)}catch{}return typeof l=="string"?e=l.split(",").map(n=>n.trim()).reduce((n,r)=>{const d=j.value.find(o=>o.id===r||o.email===r);return d&&n.push({label:(d==null?void 0:d.display_name)||(d==null?void 0:d.email),value:d.id}),n},[]):e=l?(Array.isArray(l)?l:[l]).reduce((t,n)=>{const r=(n==null?void 0:n.display_name)||(n==null?void 0:n.email);return r&&t.push({label:r,value:n.id}),t},[]):[],e},set:e=>{const l=[];e&&e.length&&e.forEach(t=>{const n=j.value.find(r=>r.id===t);n&&l.push(n.id)}),R.value?Y("update:modelValue",e!=null&&e.length?l.join(","):null):(Y("update:modelValue",e!=null&&e.length?l[l.length-1]:null),c.value=!1)}}),G=I(()=>{var e,l;return R.value?(g.value||[]).map(t=>t.value):((l=(e=g.value||[])==null?void 0:e[0])==null?void 0:l.value)||""});oe(c,(e,l)=>{var t,n,r,d,o,i;e||(ae.value=""),h.value&&(e?(i=(o=(d=L.value)==null?void 0:d.$el)==null?void 0:o.querySelector("input"))==null||i.focus():(r=(n=(t=L.value)==null?void 0:t.$el)==null?void 0:n.querySelector("input"))==null||r.blur())}),oe(T,(e,l)=>{e||(c.value=!1)}),de(Z,e=>{var l;switch(e.key){case"Escape":c.value=!1;break;case"Enter":h.value&&T.value&&!c.value&&(c.value=!0);break;case" ":break;case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":case"Delete":break;default:if(!h.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)&&((l=e.key)==null?void 0:l.length)===1&&!Pe()&&(e.stopPropagation(),c.value=!0);break}}),de(c,e=>{e.key==="Escape"&&(c.value=!1)});const he=()=>{var e,l,t;ae.value=(t=(l=(e=L.value)==null?void 0:e.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:t.value},ge=(e,l)=>{var t,n;((t=e.target)!=null&&t.classList.contains("ant-tag-close-icon")||(n=e.target)!=null&&n.closest(".ant-tag-close-icon"))&&(e.stopPropagation(),l())},M=b(ze,null),be=()=>{M||(c.value=h.value&&!c.value)},se=()=>{c.value=h.value&&!c.value};He(()=>{M==null||M.on(se)}),Ne(()=>{M==null||M.on(se)}),Te(document,"click",e=>{var l;c.value&&L.value&&!L.value.$el.contains(e.target)&&!((l=document.querySelector(".nc-dropdown-user-select-cell.active"))!=null&&l.contains(e.target))&&(X.value=!1,c.value=!1)},!0);const _e=(e,l)=>{const t=j.value.find(r=>r.id===l.value),n=(t==null?void 0:t.display_name)||(t==null?void 0:t.email);if(n)return n.toLowerCase().includes(e.toLowerCase())},V=e=>{var l,t;return!((t=(l=ye.value)==null?void 0:l[e])!=null&&t.deleted)};return(e,l)=>{var z;const t=xe,n=De,r=Xe,d=qe,o=Ze,i=ea;return u(),_("div",{class:p(["nc-cell-field nc-user-select h-full w-full flex items-center",{"read-only":a(N)}]),onClick:be},[!a(P)&&a(q)&&((z=("parseProp"in e?e.parseProp:a(K))(a(w).meta))!=null&&z.isList)?(u(),_("div",aa,[(u(),B(ie(a(R)?a(Je):a(We)),{value:a(G),"onUpdate:value":[l[0]||(l[0]=s=>re(G)?G.value=s:null),l[1]||(l[1]=s=>{g.value=a(R)?s:[s]})],disabled:a(N)||!a(h),class:"nc-field-layout-list"},{default:m(()=>[(u(!0),_(U,null,O(a(j),s=>(u(),_(U,{key:s.id||s.email},[s.deleted?D("",!0):(u(),B(ie(a(R)?a(Qe):a(Ye)),{key:s.id||s.email,value:s.id,"data-testid":`select-option-${a(w).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:p(`nc-select-option-${a(w).title}-${s.email}`)},{default:m(()=>[x(r,{class:"rounded-tag max-w-full !pl-0",color:"'#ccc'"},{default:m(()=>{var v,C;return[y("span",{style:H({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"flex items-stretch gap-2 text-small"},[y("div",null,[x(t,{size:"auto",name:(v=s.display_name)!=null&&v.trim()?(C=s.display_name)==null?void 0:C.trim():"",email:s.email,class:"!text-[0.65rem]",disabled:!V(s.id)},null,8,["name","email","disabled"])]),x(n,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>{var f;return[Q($(((f=s.display_name)==null?void 0:f.trim())||s.email),1)]}),default:m(()=>{var f;return[y("span",{class:p(["text-ellipsis overflow-hidden",{"text-gray-600":!V(s.id||s.email)}]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},$(((f=s.display_name)==null?void 0:f.trim())||s.email),3)]}),_:2},1024)],4)]}),_:2},1024)]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},40,["value","disabled"])),!a(R)&&a(g).length?(u(),_("div",{key:0,class:"inline-block px-2 pt-2 cursor-pointer text-xs text-gray-500 hover:text-gray-800",onClick:l[2]||(l[2]=s=>g.value=[])},$(e.$t("labels.clearSelection")),1)):D("",!0)])):(u(),_(U,{key:1},[a(T)?(u(),B(i,{key:1,ref_key:"aselect",ref:L,value:a(g),"onUpdate:value":l[4]||(l[4]=s=>re(g)?g.value=s:null),mode:"multiple",class:p(["w-full overflow-hidden",{"caret-transparent":!a(le)}]),placeholder:a(P)?e.$t("labels.optional"):"",bordered:!1,"clear-icon":"","show-search":!a(me),"show-arrow":a(h)&&!a(N),open:a(c)&&a(h),disabled:a(N)||!a(h),"dropdown-class-name":`nc-dropdown-user-select-cell !min-w-156px ${a(c)?"active":""}`,"filter-option":_e,onSearch:he,onKeydown:l[5]||(l[5]=ce(()=>{},["stop"]))},{suffixIcon:m(()=>[x(d,{icon:"arrowDown",class:"text-gray-700 nc-select-expand-btn"})]),tagRender:m(({label:s,value:v,onClose:C})=>{var f,te;return[a(j).find(F=>F.id===v)?(u(),B(r,{key:0,class:p(["rounded-tag nc-selected-option !pl-0",{"!my-0":!a(A)||a(A)===1}]),style:{display:"flex",alignItems:"center"},color:"'#ccc'",closable:a(h)&&((((f=a(g))==null?void 0:f.length)??0)>1||!((te=a(w))!=null&&te.rqd)),"close-icon":("h"in e?e.h:a(Ke))(a(Oe),{class:["ms-close-icon"]}),onClick:F=>ge(F,C),onClose:C},{default:m(()=>[y("span",{style:H({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:p(["flex items-stretch gap-2",{"text-sm":a(E),"text-small":!a(E)}])},[y("div",null,[x(t,{size:"auto",name:s!=null&&s.includes("@")?"":s.trim(),email:s,class:"!text-[0.65rem]",disabled:!V(v)},null,8,["name","email","disabled"])]),y("span",{class:p({"text-gray-600":!V(v)})},$(s),3)],6)]),_:2},1032,["class","closable","close-icon","onClick","onClose"])):D("",!0)]}),default:m(()=>[(u(!0),_(U,null,O(a(j),s=>(u(),_(U,{key:s.id||s.email},[s.deleted?D("",!0):(u(),B(o,{key:0,value:s.id,"data-testid":`select-option-${a(w).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:p(`nc-select-option-${a(w).title}-${s.email}`),onClick:l[3]||(l[3]=ce(()=>{},["stop"]))},{default:m(()=>[x(r,{class:p(["rounded-tag max-w-full !pl-0",{"!my-0":!a(A)||a(A)===1}]),color:"'#ccc'"},{default:m(()=>{var v,C;return[y("span",{style:H({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:p(["flex items-stretch gap-2",{"text-sm":a(E),"text-small":!a(E)}])},[y("div",null,[x(t,{size:"auto",name:(v=s.display_name)!=null&&v.trim()?(C=s.display_name)==null?void 0:C.trim():"",email:s.email,class:"!text-[0.65rem]"},null,8,["name","email"])]),x(n,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>{var f;return[Q($(((f=s.display_name)==null?void 0:f.trim())||s.email),1)]}),default:m(()=>{var f;return[y("span",sa,$(((f=s.display_name)==null?void 0:f.trim())||s.email),1)]}),_:2},1024)],6)]}),_:2},1032,["class"])]),_:2},1032,["value","data-testid","class"]))],64))),128))]),_:1},8,["value","placeholder","show-search","show-arrow","open","disabled","class","dropdown-class-name"])):(u(),_("div",{key:0,class:"flex flex-wrap",style:H({display:"-webkit-box","max-width":"100%","-webkit-line-clamp":("rowHeightTruncateLines"in e?e.rowHeightTruncateLines:a(Fe))(a(A)),"-webkit-box-orient":"vertical",overflow:"hidden"})},[(u(!0),_(U,null,O(a(g),s=>(u(),B(r,{key:s.value,class:p(["rounded-tag max-w-full !pl-0",{"!my-0":!a(A)||a(A)===1}]),color:"'#ccc'"},{default:m(()=>{var v;return[y("span",{style:H({color:a(S).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":a(S).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String()}),class:p(["flex items-stretch gap-2",{"text-sm":a(E),"text-small":!a(E)}])},[y("div",la,[x(t,{disabled:!V(s.value),size:"auto",name:(v=s.label)!=null&&v.includes("@")?"":s.label.trim(),email:s.label,class:"!text-[0.65rem]"},null,8,["disabled","name","email"])]),x(n,{class:"truncate max-w-full","show-on-truncate-only":""},{title:m(()=>[Q($(s.label),1)]),default:m(()=>[y("span",{class:p(["text-ellipsis overflow-hidden",{"text-gray-600":!V(s.value)}]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},$(s.label),3)]),_:2},1024)],6)]}),_:2},1032,["class"]))),128))],4))],64))],2)}}}),_a=Ge(ta,[["__scopeId","data-v-5cb3ffc8"]]);export{_a as default};
