import{aJ as ot,r as R,ag as at,N as z,H,an as K,ga as L,f as D,ab as V,o as s,c as h,a as p,a6 as q,P as t,t as S,S as T,U as b,w as c,b as m,T as I,Y as E,d as P,$ as F,a2 as G,ap as st,q as Q,gI as J,gJ as nt,at as it,a8 as U,al as A,am as Y,Q as rt,dH as ct,_ as lt,ba as dt}from"./nEPQs079.js";import{_ as pt}from"./BMD-JIxU.js";import{_ as ut}from"./COUq3J8q.js";import{_ as mt}from"./C6cwFr3C.js";import{_ as Z}from"./CNqbIxb7.js";import{a as tt}from"./B4uVmeYG.js";import{_ as _t}from"./DLssrORw.js";import{t as ft}from"./BThhIoag.js";import{_ as vt}from"./BDH4PFIz.js";import{W as X}from"./CbkeA9B5.js";const{Axios:qt,AxiosError:Qt,CanceledError:Yt,isCancel:Xt,CancelToken:yt,VERSION:Zt,all:te,Cancel:ee,isAxiosError:oe,spread:ae,toFormData:se,AxiosHeaders:ne,HttpStatusCode:ie,formToJSON:re,getAdapter:ce,mergeConfig:le}=tt,O=ot("notificationStore",()=>{const n=R([]),r=R([]),o=R(),u=R(),l=R(0),f=R("unread"),{api:_,isLoading:w}=at(),{token:i}=z();let v=null,y;const $=async()=>{try{if(!i.value)return;y=yt.source();const e=await _.notification.poll({cancelToken:y.token});e.status==="success"&&(f.value==="unread"&&(r.value=[JSON.parse(e.data),...r.value]),l.value=l.value+1),v=setTimeout($,0)}catch(e){if(tt.isCancel(e))return;v=setTimeout($,2e3)}},g=async e=>{try{const a=await _.notification.list({is_read:!0,limit:10,offset:e?n.value.length:0});e?n.value=[...n.value,...a.list]:n.value=a.list,o.value=a.pageInfo,l.value=Number(a.unreadCount)}catch(a){console.log(a)}},k=async e=>{try{const a=await _.notification.list({is_read:!1,limit:10,offset:e?r.value.length:0});e?r.value=[...r.value,...a.list]:r.value=a.list,u.value=a.pageInfo,l.value=Number(a.unreadCount)}catch(a){console.log(a)}},x=(e,a)=>{a?(n.value=n.value.filter(d=>d.id!==e.id),r.value=[e,...r.value].sort((d,N)=>new Date(N.created_at).getTime()-new Date(d.created_at).getTime()),l.value=l.value+1):(n.value=[e,...n.value].sort((d,N)=>new Date(N.created_at).getTime()-new Date(d.created_at).getTime()),r.value=r.value.filter(d=>d.id!==e.id),l.value=l.value-1)},C=async(e,a)=>{if(a)return;const d=e.is_read;try{await _.notification.update(e.id,{is_read:!d}),e.is_read=!d,x(e,d)}catch(N){K.error(`Failed to update Notification: ${await L(N)}`)}},W=async e=>{e.is_read||(await _.notification.markAllAsRead(),await Promise.allSettled([g(),k()]))},B=async e=>{try{n.value=n.value.filter(a=>a.id!==e.id),await _.notification.delete(e.id)}catch(a){n.value=[e,...n.value],K.error(`Failed to delete Notification: ${await L(a)}`)}};H(f,async e=>{e==="read"?await g():await k()});const M=()=>{v&&(clearTimeout(v),v=null),y==null||y.cancel(),y=null},j=async()=>{await Promise.allSettled([g(),k()]),window.isPlaywright||(M(),$().catch(e=>console.log(e)))};return H(i,async(e,a)=>{try{e&&e!==a?await j():e||M()}catch(d){console.error(d)}},{immediate:!0}),{unreadNotifications:r,readNotifications:n,loadUnReadNotifications:k,loadReadNotifications:g,deleteNotification:B,readPageInfo:o,unreadPageInfo:u,isLoading:w,notificationTab:f,toggleRead:C,markAllAsRead:W,unreadCount:l}}),gt={class:"flex pl-6 pr-4 w-full overflow-x-hidden group py-4 hover:bg-gray-50 gap-3 relative cursor-pointer"},xt={class:"w-9.625"},ht=p("img",{src:_t,alt:"NocoDB",class:"w-8"},null,-1),Nt={class:"text-[13px] min-h-12 w-full leading-5"},bt={key:0,class:"text-xs whitespace-nowrap absolute right-4.1 bottom-5 text-gray-600"},wt={class:"flex items-start"},kt=p("span",null,"Mark as read",-1),et=D({__name:"Wrapper",props:{item:{}},setup(n){const o=V(n,"item"),{isMobileMode:u}=z(),l=O(),{toggleRead:f,deleteNotification:_}=l;return(w,i)=>{const v=F,y=G,$=st,g=pt,k=ut,x=mt,C=Z;return s(),h("div",gt,[p("div",xt,[q(w.$slots,"avatar",{},()=>[ht])]),p("div",Nt,[q(w.$slots,"default")]),t(o)?(s(),h("div",bt,S(t(ft)(t(o).created_at)),1)):T("",!0),p("div",wt,[t(o).is_read?(s(),b(C,{key:1,class:I([{"!opacity-100":t(u)},"transition-all duration-100 opacity-0 !group-hover:opacity-100"])},{overlay:c(()=>[m(x,null,{default:c(()=>[m(g,{onClick:i[2]||(i[2]=E(()=>t(f)(t(o)),["stop"]))},{default:c(()=>[P(" Mark as unread ")]),_:1}),m(k),m(g,{class:"!text-red-500 !hover:bg-red-50",onClick:i[3]||(i[3]=E(W=>t(_)(t(o)),["stop"]))},{default:c(()=>[P(" Delete ")]),_:1})]),_:1})]),default:c(()=>[m(y,{size:"xsmall",type:"secondary",onClick:i[1]||(i[1]=E(()=>{},["stop"]))},{default:c(()=>[m(v,{icon:"threeDotVertical"})]),_:1})]),_:1},8,["class"])):(s(),b($,{key:0},{title:c(()=>[kt]),default:c(()=>[m(y,{class:I([{"!opacity-100":t(u)},"!border-0 transition-all duration-100 opacity-0 !group-hover:opacity-100"]),type:"secondary",size:"xsmall",onClick:i[0]||(i[0]=E(()=>t(f)(t(o)),["stop"]))},{default:c(()=>[m(v,{icon:"check",class:"text-gray-700"})]),_:1},8,["class"])]),_:1}))])])}}}),$t=p("div",null,[P("Welcome to "),p("span",{class:"font-semibold"},"NocoDB!"),P(" Weâ€™re excited to have you onboard.")],-1),It=D({__name:"Welcome",props:{item:{}},setup(n){const o=V(n,"item");return(u,l)=>{const f=et;return s(),b(f,{item:t(o)},{default:c(()=>[$t]),_:1},8,["item"])}}}),Ct={class:"font-semibold"},Rt={class:"font-semibold"},St=D({__name:"ProjectInvite",props:{item:{}},setup(n){const r=n,{navigateToProject:o}=z(),u=V(r,"item");return(l,f)=>{const _=et;return s(),b(_,{item:t(u),onClick:f[0]||(f[0]=w=>t(o)({baseId:t(u).body.base.id}))},{default:c(()=>[p("div",null,[p("span",Ct,S(t(u).body.user.display_name??t(u).body.user.email),1),P(" has invited you to collaborate on "),p("span",Rt,S(t(u).body.base.title),1),P(" base. ")])]),_:1},8,["item"])}}}),At={key:4},Tt=D({__name:"Item",props:{item:{}},setup(n){const o=V(n,"item"),u=O(),{toggleRead:l}=u;return(f,_)=>{const w=It,i=St,v=Q("NotificationItemWorkspaceInvite"),y=Q("NotificationItemMentionEvent");return s(),h("div",{class:"select-none",onClick:_[0]||(_[0]=$=>t(l)(t(o),t(o).is_read))},[t(o).type===t(J).WELCOME?(s(),b(w,{key:0,item:t(o)},null,8,["item"])):t(o).type===t(J).PROJECT_INVITE?(s(),b(i,{key:1,item:t(o)},null,8,["item"])):t(o).type===t(J).WORKSPACE_INVITE?(s(),b(v,{key:2,item:t(o)},null,8,["item"])):["mention"].includes(t(o).type)?(s(),b(y,{key:3,item:t(o)},null,8,["item"])):(s(),h("span",At))])}}}),Et={class:"space-y-3"},Pt={class:"flex px-6 justify-between items-center"},Dt={class:"text-sm !text-gray-500"},Mt={class:"text-sm text-gray-500"},Wt=D({__name:"Card",setup(n){const r=O(),{isMobileMode:o}=z(),u=R(),{height:l}=nt(u),{loadUnReadNotifications:f,loadReadNotifications:_,markAllAsRead:w}=r,{unreadNotifications:i,readNotifications:v,readPageInfo:y,unreadPageInfo:$,notificationTab:g}=it(r);return(k,x)=>{var e;const C=F,W=G,B=Tt,M=ct,j=vt;return s(),h("div",{ref_key:"container",ref:u,style:U([{"box-shadow":"0px -12px 16px -4px rgba(0, 0, 0, 0.1), 0px -4px 6px -2px rgba(0, 0, 0, 0.06)"},t(o)?"":"width: min(80svw, 520px);"]),class:I([{"max-h-[70vh] h-[620px]":!t(o),"h-[100svh] w-[100svw]":t(o)},"!rounded-lg pt-4"])},[p("div",Et,[p("div",Pt,[p("span",{class:"text-md font-bold text-gray-800",onClick:x[0]||(x[0]=E(()=>{},["stop"]))},S(k.$t("general.notification"))+"s ",1),t(o)?(s(),b(W,{key:0,size:"small",type:"secondary"},{default:c(()=>[m(C,{icon:"close",class:"text-gray-700"})]),_:1})):T("",!0)]),t(g)!=="read"?(s(),h("div",{key:0,class:I([{"text-gray-400":!((e=t(i))!=null&&e.length)},"cursor-pointer right-5 pointer-events-auto top-12.5 z-2 absolute text-[13px] text-gray-600 font-weight-semibold"]),onClick:x[1]||(x[1]=E((...a)=>t(w)&&t(w)(...a),["stop"]))},S(k.$t("activity.markAllAsRead")),3)):T("",!0),m(j,{activeKey:t(g),"onUpdate:activeKey":x[4]||(x[4]=a=>rt(g)?g.value=a:null)},{default:c(()=>[m(M,{key:"unread"},{tab:c(()=>[p("span",{class:I([{"font-semibold":t(g)==="unread"},"text-xs"])}," Unread ",2)]),default:c(()=>{var a,d;return[p("div",{class:I(["overflow-y-auto",{"flex flex-col items-center min-h-[48svh] justify-center":!((a=t(i))!=null&&a.length)}]),style:U(`height: ${t(l)-72}px`)},[(d=t(i))!=null&&d.length?(s(),h(A,{key:1},[(s(!0),h(A,null,Y(t(i),N=>(s(),b(B,{key:N.id,item:N},null,8,["item"]))),128)),t(i)&&t($)&&t($).totalRows>t(i).length?(s(),b(t(X),{key:0,onInfinite:x[2]||(x[2]=N=>t(f)(!0))})):T("",!0)],64)):(s(),h(A,{key:0},[p("div",Dt,S(k.$t("msg.noNewNotifications")),1),m(C,{icon:"inbox",class:"!text-40px !text-gray-500"})],64))],6)]}),_:1}),m(M,{key:"read"},{tab:c(()=>[p("span",{class:I([{"font-semibold":t(g)==="read"},"text-xs"])}," Read ",2)]),default:c(()=>{var a,d;return[p("div",{class:I(["overflow-y-auto",{"flex flex-col items-center min-h-[48svh] justify-center":!((a=t(v))!=null&&a.length)}]),style:U(t(o)?"":`height: ${t(l)-72}px`)},[(d=t(v))!=null&&d.length?(s(),h(A,{key:1},[(s(!0),h(A,null,Y(t(v),N=>(s(),b(B,{key:N.id,item:N},null,8,["item"]))),128)),t(v)&&t(y)&&t(y).totalRows>t(v).length?(s(),b(t(X),{key:0,onInfinite:x[3]||(x[3]=N=>t(_)(!0))})):T("",!0)],64)):(s(),h(A,{key:0},[p("div",Mt,S(k.$t("msg.noNewNotifications")),1),m(C,{icon:"inbox",class:"!text-40px text-gray-500"})],64))],6)]}),_:1})]),_:1},8,["activeKey"])])],6)}}}),Bt=lt(Wt,[["__scopeId","data-v-02e83c3f"]]),zt={class:"cursor-pointer flex items-center"},de=D({__name:"Menu",setup(n){const r=O(),{unreadCount:o}=dt(r);return(u,l)=>{const f=F,_=G,w=Bt,i=Z;return s(),h("div",zt,[m(i,{"overlay-class-name":"!shadow-none",placement:"bottomRight",trigger:["click"]},{overlay:c(()=>[m(w)]),default:c(()=>[m(_,{size:"small",class:"!border-none !bg-gray-50",type:"secondary"},{default:c(()=>[t(o)?(s(),h("span",{key:t(o),class:"bg-red-500 w-2 h-2 border-1 border-white rounded-[6px] absolute top-[5px] left-[15px]"})):T("",!0),m(f,{icon:"notification"})]),_:1})]),_:1})])}}});export{de as _};
