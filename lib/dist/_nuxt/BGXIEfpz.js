const __vite__fileDeps=["./Dws9chxf.js","./3QBYHahY.js","./entry.Ic44fwRn.css","./RichTextOptions.CZoe1RIi.css","./m8rA889u.js","./C9Sjn86N.js","./D4iSzjWt.js","./DPqnb67u.js","./PlainCell.DrVmydsK.css","./e9_Ufzts.js","./BYmqikBK.js","./VirtualCell.DaTWCMZu.css","./CjWFO-CW.js","./CtMydB5S.js","./Cell.CE2XxAOg.css","./Df02Q_8o.js","./VirtualCell.BYk4C8Tn.css","./fm4Ai8Gq.js","./T74iQZdg.js","./CSl6euFG.js","./Bj2FvocX.js","./boyBAVNN.js","./Cell.DUBzJZSm.css","./CmSmNSNp.js","./DivDataCell.1yCNpUg3.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{ao as xe,aR as ae,f as Ue,at as Ka,r as $,i as ht,b1 as ze,H as Ne,cB as pa,g as Se,hB as Wa,aS as mt,aW as Vt,an as je,b as i,aX as ya,cy as Ya,cA as qa,c9 as ha,ic as Ga,al as Xa,aZ as _a,bN as Ve,am as Za,fq as Ot,aB as lt,cd as Dt,ce as Qa,hK as Ja,cW as en,ad as wa,aG as na,af as xa,O as it,o,c as g,P as e,t as j,T as X,aq as Pe,S as O,U as we,Y as ft,R as Ce,w as m,$ as _t,a0 as It,Z as Ze,a6 as Qe,N as wt,L as xt,id as ga,M as ba,az as Xe,aA as Pt,d9 as zt,u as Ca,a as f,av as pt,d as he,V as Te,W as Ae,Q as Ge,aL as Lt,g2 as yt,aN as ka,a1 as Bt,_ as gt,ai as $a,dA as Sa,cM as tn,gz as an,d6 as st,d8 as nn,cZ as on,dJ as rt,ib as vt,d1 as Tt,cr as Ke,X as ln,aj as Oe,ak as Fe,cY as sn,gK as nt,fO as Ye,A as rn,p as Ft,e as jt,fH as cn,cQ as dn,a7 as We,gC as un,i0 as fn,ie as vn,d2 as ut,hM as mn,gU as pn,cc as oa,aH as la,fr as sa,a9 as yn,hg as hn,hQ as _n,hR as wn,aM as xn}from"./3QBYHahY.js";import{_ as Ra}from"./DdUr8XSo.js";import{_ as Ma}from"./leimKhvx.js";import{_ as Ea}from"./PcgFfkcK.js";import{_ as Ut}from"./Kma333Sh.js";import gn from"./CmSmNSNp.js";import{_ as Oa}from"./DmzaAQYu.js";import{_ as Da}from"./Wbpa_-L5.js";import{T as bn,S as Cn,U as kn,L as $n,P as Sn,u as Rn,E as Mn,g as En,_ as On}from"./Bczc_1bi.js";import{m as Dn}from"./Dwil3It4.js";import{t as Ln}from"./Cy50pBgZ.js";import{u as La}from"./Cy5w9qev.js";import{u as Ta}from"./DsWDg2xe.js";import{u as Tn,a as An}from"./CL-Lp6PG.js";import{t as Nt}from"./DkE_qgY_.js";import{u as Vn}from"./CSl6euFG.js";import{u as Nn}from"./T74iQZdg.js";import{e as qe,p as In,r as Pn}from"./BYmqikBK.js";import{a as Aa}from"./-3s5K4B9.js";import{_ as zn}from"./2yzrrcqg.js";import{_ as Bn}from"./BkiSZLeF.js";import{a as Fn}from"./CfxEkdGP.js";import{u as jn}from"./BteOdwRG.js";import{u as Un}from"./Bj2FvocX.js";import{u as Hn}from"./DGM-hiY9.js";import{g as ra,a as Kn,j as Wn,i as Yn,h as qn}from"./DPqnb67u.js";import{_ as ia}from"./C95Svpv6.js";import{S as Gn}from"./Giw8WUI1.js";import"./CyuhXrst.js";import"./DHsWytsD.js";import"./kHOslGNR.js";import"./CmN9vPg3.js";import"./BQQOEPN4.js";import"./xnDaHwV-.js";import"./DPgYHC40.js";import"./BsWDDIqE.js";import"./ceYq-xax.js";import"./Uiq3YTcq.js";import"./boyBAVNN.js";import"./CJ26qO3d.js";import"./CsJPQclb.js";import"./DEVpQDRz.js";var Va=function(){return{prefixCls:String,width:ae.oneOfType([ae.string,ae.number]),height:ae.oneOfType([ae.string,ae.number]),style:{type:Object,default:void 0},class:String,placement:{type:String},wrapperClassName:String,level:{type:[String,Array]},levelMove:{type:[Number,Function,Array]},duration:String,ease:String,showMask:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},maskStyle:{type:Object,default:void 0},afterVisibleChange:Function,keyboard:{type:Boolean,default:void 0},contentWrapperStyle:{type:Object,default:void 0},autofocus:{type:Boolean,default:void 0},open:{type:Boolean,default:void 0}}},Xn=function(){return xe(xe({},Va()),{},{forceRender:{type:Boolean,default:void 0},getContainer:ae.oneOfType([ae.string,ae.func,ae.object,ae.looseBool])})},Zn=function(){return xe(xe({},Va()),{},{getContainer:Function,getOpenCount:Function,scrollLocker:ae.any,switchScrollingEffect:Function})};function Qn(n){return Array.isArray(n)?n:[n]}var Na={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend"},Jn=Object.keys(Na).filter(function(n){if(typeof document>"u")return!1;var t=document.getElementsByTagName("html")[0];return n in(t?t.style:{})})[0],ca=Na[Jn];function da(n,t,r,S){n.addEventListener?n.addEventListener(t,r,S):n.attachEvent&&n.attachEvent("on".concat(t),r)}function ua(n,t,r,S){n.removeEventListener?n.removeEventListener(t,r,S):n.attachEvent&&n.detachEvent("on".concat(t),r)}function eo(n,t){var r=typeof n=="function"?n(t):n;return Array.isArray(r)?r.length===2?r:[r[0],r[1]]:[r]}var fa=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},At=!(typeof window<"u"&&window.document&&window.document.createElement),to=function n(t,r,S,x){if(!r||r===document||r instanceof Document)return!1;if(r===t.parentNode)return!0;var Q=Math.max(Math.abs(S),Math.abs(x))===Math.abs(x),K=Math.max(Math.abs(S),Math.abs(x))===Math.abs(S),I=r.scrollHeight-r.clientHeight,C=r.scrollWidth-r.clientWidth,w=document.defaultView.getComputedStyle(r),ve=w.overflowY==="auto"||w.overflowY==="scroll",P=w.overflowX==="auto"||w.overflowX==="scroll",U=I&&ve,d=C&&P;return Q&&(!U||U&&(r.scrollTop>=I&&x<0||r.scrollTop<=0&&x>0))||K&&(!d||d&&(r.scrollLeft>=C&&S<0||r.scrollLeft<=0&&S>0))?n(t,r.parentNode,S,x):!1},ao=["width","height","open","prefixCls","placement","level","levelMove","ease","duration","getContainer","onChange","afterVisibleChange","showMask","maskClosable","maskStyle","keyboard","getOpenCount","scrollLocker","contentWrapperStyle","style","class"],ot={},va=Ue({compatConfig:{MODE:3},inheritAttrs:!1,props:Zn(),emits:["close","handleClick","change"],setup:function(t,r){var S=r.emit,x=r.slots,Q=Ka({startPos:{x:null,y:null}}),K,I=$(),C=$(),w=$(),ve=$(),P=$(),U=[],d="drawer_id_".concat(Number((Date.now()+Math.random()).toString().replace(".",Math.round(Math.random()*9).toString())).toString(16)),A=!At&&qa?{passive:!1}:!1;ht(function(){ze(function(){var p=t.open,s=t.getContainer,v=t.showMask,E=t.autofocus,N=s==null?void 0:s();if(le(t),p&&(N&&N.parentNode===document.body&&(ot[d]=p),V(),ze(function(){E&&W()}),v)){var q;(q=t.scrollLocker)===null||q===void 0||q.lock()}})}),Ne(function(){return t.level},function(){le(t)},{flush:"post"}),Ne(function(){return t.open},function(){var p=t.open,s=t.getContainer,v=t.scrollLocker,E=t.showMask,N=t.autofocus,q=s==null?void 0:s();q&&q.parentNode===document.body&&(ot[d]=!!p),V(),p?(N&&W(),E&&(v==null||v.lock())):v==null||v.unLock()},{flush:"post"}),pa(function(){var p,s=t.open;delete ot[d],s&&(fe(!1),document.body.style.touchAction=""),(p=t.scrollLocker)===null||p===void 0||p.unLock()}),Ne(function(){return t.placement},function(p){p&&(P.value=null)});var W=function(){var s,v;(s=C.value)===null||s===void 0||(v=s.focus)===null||v===void 0||v.call(s)},Y=function(s){s.touches.length>1||(Q.startPos={x:s.touches[0].clientX,y:s.touches[0].clientY})},M=function(s){if(!(s.changedTouches.length>1)){var v=s.currentTarget,E=s.changedTouches[0].clientX-Q.startPos.x,N=s.changedTouches[0].clientY-Q.startPos.y;(v===w.value||v===ve.value||v===P.value&&to(v,s.target,E,N))&&s.cancelable&&s.preventDefault()}},Me=function p(s){var v=s.target;ua(v,ca,p),v.style.transition=""},$e=function(s){S("close",s)},z=function(s){s.keyCode===Ya.ESC&&(s.stopPropagation(),$e(s))},l=function(s){var v=t.open,E=t.afterVisibleChange;s.target===I.value&&s.propertyName.match(/transform$/)&&(C.value.style.transition="",!v&&H()&&(document.body.style.overflowX="",w.value&&(w.value.style.left="",w.value.style.width="")),E&&E(!!v))},y=Se(function(){var p=t.placement,s=p==="left"||p==="right",v="translate".concat(s?"X":"Y");return{isHorizontal:s,placementName:v}}),V=function(){var s=t.open,v=t.width,E=t.height,N=y.value,q=N.isHorizontal,L=N.placementName,te=P.value?P.value.getBoundingClientRect()[q?"width":"height"]:0,c=(q?v:E)||te;J(s,L,c)},fe=function(s,v,E,N){var q=t.placement,L=t.levelMove,te=t.duration,c=t.ease,_=t.showMask;U.forEach(function(_e){_e.style.transition="transform ".concat(te," ").concat(c),da(_e,ca,Me);var re=s?E:0;if(L){var be=eo(L,{target:_e,open:s});re=s?be[0]:be[1]||0}var B=typeof re=="number"?"".concat(re,"px"):re,F=q==="left"||q==="top"?B:"-".concat(B);F=_&&q==="right"&&N?"calc(".concat(F," + ").concat(N,"px)"):F,_e.style.transform=re?"".concat(v,"(").concat(F,")"):""})},J=function(s,v,E){if(!At){var N=document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth?Wa(!0):0;fe(s,v,E,N),h(N)}S("change",s)},h=function(s){var v=t.getContainer,E=t.showMask,N=t.open,q=v==null?void 0:v();if(q&&q.parentNode===document.body&&E){var L=["touchstart"],te=[document.body,w.value,ve.value,P.value];N&&document.body.style.overflow!=="hidden"?(s&&b(s),document.body.style.touchAction="none",te.forEach(function(c,_){c&&da(c,L[_]||"touchmove",_?M:Y,A)})):H()&&(document.body.style.touchAction="",s&&R(s),te.forEach(function(c,_){c&&ua(c,L[_]||"touchmove",_?M:Y,A)}))}},b=function(s){var v=t.placement,E=t.duration,N=t.ease,q="width ".concat(E," ").concat(N),L="transform ".concat(E," ").concat(N);switch(C.value.style.transition="none",v){case"right":C.value.style.transform="translateX(-".concat(s,"px)");break;case"top":case"bottom":C.value.style.width="calc(100% - ".concat(s,"px)"),C.value.style.transform="translateZ(0)";break}clearTimeout(K),K=setTimeout(function(){C.value&&(C.value.style.transition="".concat(L,",").concat(q),C.value.style.width="",C.value.style.transform="")})},R=function(s){var v=t.placement,E=t.duration,N=t.ease;C.value.style.transition="none";var q,L="width ".concat(E," ").concat(N),te="transform ".concat(E," ").concat(N);switch(v){case"left":{C.value.style.width="100%",L="width 0s ".concat(N," ").concat(E);break}case"right":{C.value.style.transform="translateX(".concat(s,"px)"),C.value.style.width="100%",L="width 0s ".concat(N," ").concat(E),w.value&&(w.value.style.left="-".concat(s,"px"),w.value.style.width="calc(100% + ".concat(s,"px)"));break}case"top":case"bottom":{C.value.style.width="calc(100% + ".concat(s,"px)"),C.value.style.height="100%",C.value.style.transform="translateZ(0)",q="height 0s ".concat(N," ").concat(E);break}}clearTimeout(K),K=setTimeout(function(){C.value&&(C.value.style.transition="".concat(te,",").concat(q?"".concat(q,","):"").concat(L),C.value.style.transform="",C.value.style.width="",C.value.style.height="")})},H=function(){return!Object.keys(ot).some(function(s){return ot[s]})},le=function(s){var v=s.level,E=s.getContainer;if(!At){var N=E==null?void 0:E(),q=N?N.parentNode:null;if(U=[],v==="all"){var L=q?Array.prototype.slice.call(q.children):[];L.forEach(function(te){te.nodeName!=="SCRIPT"&&te.nodeName!=="STYLE"&&te.nodeName!=="LINK"&&te!==N&&U.push(te)})}else v&&Qn(v).forEach(function(te){document.querySelectorAll(te).forEach(function(c){U.push(c)})})}},me=function(s){S("handleClick",s)},ge=$(!1);return Ne(C,function(){ze(function(){ge.value=!0})}),function(){var p,s,v,E=t.width,N=t.height,q=t.open,L=t.prefixCls,te=t.placement;t.level,t.levelMove,t.ease,t.duration,t.getContainer,t.onChange,t.afterVisibleChange;var c=t.showMask,_=t.maskClosable,_e=t.maskStyle,re=t.keyboard;t.getOpenCount,t.scrollLocker;var be=t.contentWrapperStyle,B=t.style,F=t.class,se=mt(t,ao),D=q&&ge.value,pe=Vt(L,(p={},je(p,"".concat(L,"-").concat(te),!0),je(p,"".concat(L,"-open"),D),je(p,F,!!F),je(p,"no-mask",!c),p)),ne=y.value.placementName,oe=te==="left"||te==="top"?"-100%":"100%",ye=D?"":"".concat(ne,"(").concat(oe,")");return i("div",xe(xe({},ya(se,["switchScrollingEffect","autofocus"])),{},{tabindex:-1,class:pe,style:B,ref:C,onKeydown:D&&re?z:void 0,onTransitionend:l}),[c&&i("div",{class:"".concat(L,"-mask"),onClick:_?$e:void 0,style:_e,ref:w},null),i("div",{class:"".concat(L,"-content-wrapper"),style:xe({transform:ye,msTransform:ye,width:fa(E)?"".concat(E,"px"):E,height:fa(N)?"".concat(N,"px"):N},be),ref:I},[i("div",{class:"".concat(L,"-content"),ref:P},[(s=x.default)===null||s===void 0?void 0:s.call(x)]),x.handler?i("div",{onClick:me,ref:ve},[(v=x.handler)===null||v===void 0?void 0:v.call(x)]):null])])}}}),no=["afterVisibleChange","getContainer","wrapperClassName","forceRender"],oo=["visible","afterClose"],lo=Ue({compatConfig:{MODE:3},inheritAttrs:!1,props:ha(Xn(),{prefixCls:"drawer",placement:"left",getContainer:"body",level:"all",duration:".3s",ease:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",afterVisibleChange:function(){},showMask:!0,maskClosable:!0,maskStyle:{},wrapperClassName:"",keyboard:!0,forceRender:!1,autofocus:!0}),emits:["handleClick","close"],slots:["handler"],setup:function(t,r){var S=r.emit,x=r.slots,Q=$(null),K=function(w){S("handleClick",w)},I=function(w){S("close",w)};return function(){t.afterVisibleChange;var C=t.getContainer,w=t.wrapperClassName,ve=t.forceRender,P=mt(t,no),U=null;if(!C)return i("div",{class:w,ref:Q},[i(va,xe(xe({},P),{},{open:t.open,getContainer:function(){return Q.value},onClose:I,onHandleClick:K}),x)]);var d=!!x.handler||ve;return(d||t.open||Q.value)&&(U=i(Ga,{visible:t.open,forceRender:d,getContainer:C,wrapperClassName:w},{default:function(W){var Y=W.visible,M=W.afterClose,Me=mt(W,oo);return i(va,xe(xe(xe({ref:Q},P),Me),{},{open:Y!==void 0?Y:t.open,afterVisibleChange:M!==void 0?M:t.afterVisibleChange,onClose:I,onHandleClick:K}),x)}})),U}}}),so=["width","height","visible","placement","mask","wrapClassName","class"],ro=_a("top","right","bottom","left");_a("default","large");var ma={distance:180},io=function(){return{autofocus:{type:Boolean,default:void 0},closable:{type:Boolean,default:void 0},closeIcon:ae.any,destroyOnClose:{type:Boolean,default:void 0},forceRender:{type:Boolean,default:void 0},getContainer:ae.any,maskClosable:{type:Boolean,default:void 0},mask:{type:Boolean,default:void 0},maskStyle:{type:Object,default:void 0},wrapStyle:{type:Object,default:void 0},style:{type:Object,default:void 0},class:ae.any,wrapClassName:String,size:{type:String},drawerStyle:{type:Object,default:void 0},headerStyle:{type:Object,default:void 0},bodyStyle:{type:Object,default:void 0},contentWrapperStyle:{type:Object,default:void 0},title:ae.any,visible:{type:Boolean,default:void 0},width:ae.oneOfType([ae.string,ae.number]),height:ae.oneOfType([ae.string,ae.number]),zIndex:Number,prefixCls:String,push:ae.oneOfType([ae.looseBool,{type:Object}]),placement:ae.oneOf(ro),keyboard:{type:Boolean,default:void 0},extra:ae.any,footer:ae.any,footerStyle:{type:Object,default:void 0},level:ae.any,levelMove:{type:[Number,Array,Function]},handle:ae.any,afterVisibleChange:Function,onAfterVisibleChange:Function,"onUpdate:visible":Function,onClose:Function}},co=Ue({compatConfig:{MODE:3},name:"ADrawer",inheritAttrs:!1,props:ha(io(),{closable:!0,placement:"right",maskClosable:!0,mask:!0,level:null,keyboard:!0,push:ma}),slots:["closeIcon","title","extra","footer","handle"],setup:function(t,r){var S=r.emit,x=r.slots,Q=r.attrs,K=$(!1),I=$(!1),C=$(null),w=Ve("parentDrawerOpts",null),ve=Za("drawer",t),P=ve.prefixCls;Ot(!t.afterVisibleChange,"Drawer","`afterVisibleChange` prop is deprecated, please use `@afterVisibleChange` event instead"),Ot(t.wrapStyle===void 0,"Drawer","`wrapStyle` prop is deprecated, please use `style` instead"),Ot(t.wrapClassName===void 0,"Drawer","`wrapClassName` prop is deprecated, please use `class` instead");var U=function(){K.value=!0},d=function(){K.value=!1,ze(function(){A()})};lt("parentDrawerOpts",{setPush:U,setPull:d}),ht(function(){var h=t.visible;h&&w&&w.setPush()}),pa(function(){w&&w.setPull()}),Ne(function(){return t.visible},function(h){w&&(h?w.setPush():w.setPull())},{flush:"post"});var A=function(){var b,R;(b=C.value)===null||b===void 0||(R=b.domFocus)===null||R===void 0||R.call(b)},W=function(b){S("update:visible",!1),S("close",b)},Y=function(b){var R;(R=t.afterVisibleChange)===null||R===void 0||R.call(t,b),S("afterVisibleChange",b)},M=Se(function(){return t.destroyOnClose&&!t.visible}),Me=function(){var b=M.value;b&&(t.visible||(I.value=!0))},$e=Se(function(){var h=t.push,b=t.placement,R;return typeof h=="boolean"?R=h?ma.distance:0:R=h.distance,R=parseFloat(String(R||0)),b==="left"||b==="right"?"translateX(".concat(b==="left"?R:-R,"px)"):b==="top"||b==="bottom"?"translateY(".concat(b==="top"?R:-R,"px)"):null}),z=Se(function(){var h=t.visible,b=t.mask,R=t.placement,H=t.size,le=H===void 0?"default":H,me=t.width,ge=t.height;if(!h&&!b)return{};var p={};if(R==="left"||R==="right"){var s=le==="large"?736:378;p.width=typeof me>"u"?s:me,p.width=typeof p.width=="string"?p.width:"".concat(p.width,"px")}else{var v=le==="large"?736:378;p.height=typeof ge>"u"?v:ge,p.height=typeof p.height=="string"?p.height:"".concat(p.height,"px")}return p}),l=Se(function(){var h=t.zIndex,b=t.wrapStyle,R=t.mask,H=t.style,le=R?{}:z.value;return xe(xe(xe({zIndex:h,transform:K.value?$e.value:void 0},le),b),H)}),y=function(b){var R=t.closable,H=t.headerStyle,le=Dt(x,t,"extra"),me=Dt(x,t,"title");return!me&&!R?null:i("div",{class:Vt("".concat(b,"-header"),je({},"".concat(b,"-header-close-only"),R&&!me&&!le)),style:H},[i("div",{class:"".concat(b,"-header-title")},[V(b),me&&i("div",{class:"".concat(b,"-title")},[me])]),le&&i("div",{class:"".concat(b,"-extra")},[le])])},V=function(b){var R,H=t.closable,le=x.closeIcon?(R=x.closeIcon)===null||R===void 0?void 0:R.call(x):t.closeIcon;return H&&i("button",{key:"closer",onClick:W,"aria-label":"Close",class:"".concat(b,"-close")},[le===void 0?i(Qa,null,null):le])},fe=function(b){var R;if(I.value&&!t.visible)return null;I.value=!1;var H=t.bodyStyle,le=t.drawerStyle,me={},ge=M.value;return ge&&(me.opacity=0,me.transition="opacity .3s"),i("div",{class:"".concat(b,"-wrapper-body"),style:xe(xe({},me),le),onTransitionend:Me},[y(b),i("div",{key:"body",class:"".concat(b,"-body"),style:H},[(R=x.default)===null||R===void 0?void 0:R.call(x)]),J(b)])},J=function(b){var R=Dt(x,t,"footer");if(!R)return null;var H="".concat(b,"-footer");return i("div",{class:H,style:t.footerStyle},[R])};return function(){var h;t.width,t.height;var b=t.visible,R=t.placement,H=t.mask,le=t.wrapClassName,me=t.class,ge=mt(t,so),p=H?z.value:{},s=H?"":"no-mask",v=xe(xe(xe(xe({},Q),ya(ge,["size","closeIcon","closable","destroyOnClose","drawerStyle","headerStyle","bodyStyle","title","push","wrapStyle","onAfterVisibleChange","onClose","onUpdate:visible"])),p),{},{onClose:W,afterVisibleChange:Y,handler:!1,prefixCls:P.value,open:b,showMask:H,placement:R,class:Vt((h={},je(h,me,me),je(h,le,!!le),je(h,s,!!s),h)),style:l.value,ref:C});return i(lo,v,{handler:t.handle?function(){return t.handle}:x.handle,default:function(){return fe(P.value)}})}}});const uo=Xa(co),fo=Ze(()=>Qe(()=>import("./Dws9chxf.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(n=>n.default||n)),vo={key:0,class:"truncate"},mo={key:0},po={key:1,class:"flex justify-between pt-1 rich-text-bottom-bar items-center"},yo=Ue({__name:"RichComment",props:{hideOptions:{type:Boolean,default:!0},value:{},readOnly:{type:Boolean},syncValueChange:{type:Boolean},autofocus:{type:Boolean},placeholder:{},renderAsText:{type:Boolean}},emits:["update:value","focus","blur","save"],setup(n,{expose:t,emit:r}){const S=n,x=r,Q=Ve(Ja,$(!1)),K=$(!1),I=en(),C=new bn({});C.addRule("lineBreak",{filter:l=>l.nodeName==="BR",replacement:()=>"<br />"}),C.addRule("strikethrough",{filter:["s"],replacement:l=>`~${l}~`}),C.keep(["u","del"]);const w=$(null),ve=$(null),P=wa(S,"value",x,{defaultValue:""}),U=[Cn.configure({heading:!1,codeBlock:!1,code:!1}),kn,$n,Sn.configure({emptyEditorClass:"is-editor-empty",placeholder:S.placeholder})],d=Rn({extensions:U,onUpdate:({editor:l})=>{let y=C.turndown(l.getHTML().replaceAll(/<p><\/p>/g,"<br />"));((l==null?void 0:l.isActive("bulletList"))||(l==null?void 0:l.isActive("orderedList"))||(l==null?void 0:l.isActive("blockquote")))&&y.endsWith("<br />")&&(y=y.slice(0,-6)),y=y.replaceAll(/\n\n<br \/>\n\n/g,`<br>

`),P.value=y==="<br />"?"":`${y}`},editable:!S.readOnly,autofocus:S.autofocus,onFocus:()=>{K.value=!0,x("focus"),W()},onBlur:l=>{const y=l==null?void 0:l.event.relatedTarget;y&&(y!=null&&y.closest(".comment-bubble-menu, .nc-rich-text-comment, .tippy-box, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .nc-mention-list, .tippy-content, .nc-comment-rich-editor")||(K.value=!1,x("blur")))}}),A=(l,y)=>{if(!d.value)return;const V=d.value.view.state.selection,fe=l?Dn.parse(l):"<p></p>",J=En(fe,U);d.value.chain().setContent(J).setTextSelection(V.to).run(),setTimeout(()=>{var h;if(y){const b=d.value.state.doc.nodeSize;(h=d.value)==null||h.chain().setTextSelection(b-1).run()}d.value.state.history$.prevRanges=null,d.value.state.history$.done.eventCount=0},100)};function W(){var l;!S.readOnly&&!I.shift.value&&((l=d.value)==null||l.chain().focus().run(),A(P.value,!0))}S.syncValueChange&&Ne([P,d],()=>{A(P.value)}),na(w,"focusout",l=>{var V;const y=l==null?void 0:l.relatedTarget;((V=y==null?void 0:y.classList)!=null&&V.contains("tiptap")||!(y!=null&&y.closest(".comment-bubble-menu, .nc-rich-text-comment, .tippy-box, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .nc-mention-list, .tippy-content, .nc-comment-rich-editor")))&&(K.value=!1,x("blur"))},!0),na(ve,"focusout",l=>{var V;const y=l==null?void 0:l.relatedTarget;!y&&((V=l.target)!=null&&V.closest(".comment-bubble-menu, .nc-comment-save-btn, .nc-mention-list, .mention, .rich-text-bottom-bar, .tippy-content, .nc-comment-rich-editor"))||y!=null&&y.closest(".comment-bubble-menu, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .tippy-content, .nc-mention-list, .nc-comment-rich-editor")||(K.value=!1,x("blur"))},!0),xa(w,l=>{if(!K.value)return;const y=l==null?void 0:l.target;y!=null&&y.closest(".tippy-content, .nc-rich-text-comment, .nc-comment-save-btn, .nc-mention-list, .rich-text-bottom-bar, .mention, .comment-bubble-menu, .nc-comment-rich-editor")||(K.value=!1,x("blur"))});const Y=$(!1),M=l=>{d.value&&(Y.value?Y.value=!1:d.value.isActive("bulletList")||d.value.isActive("orderedList")||d.value.isActive("blockquote")?l.stopPropagation():x("save"))},Me=l=>{var V,fe,J;((V=d.value)==null?void 0:V.isActive("bulletList"))||((fe=d.value)==null?void 0:fe.isActive("orderedList"))||((J=d.value)==null?void 0:J.isActive("blockquote"))?(Y.value=!0,setTimeout(()=>{Y.value=!1},1e3)):M(l)},$e=l=>{l.altKey&&l.key==="Enter"||l.shiftKey&&l.key==="Enter"?l.stopPropagation():l.key==="Enter"?Me(l):l.key==="Escape"&&(K.value=!1,x("blur"))},z=l=>{l.preventDefault(),l.stopPropagation(),x("save")};return t({setEditorContent:A}),ht(()=>{S.readOnly&&setTimeout(()=>{document.querySelectorAll(".nc-rich-link-tooltip").forEach(l=>{const y=Object.values(l.attributes).find(V=>V.name==="data-tooltip");y&&Ln(l,{content:`<span class="tooltip">${y.value}</span>`,placement:"top",allowHTML:!0,arrow:!0,animation:"fade",duration:0})})},1e3)}),(l,y)=>{var R,H;const V=On,fe=fo,J=_t,h=It,b=it("e");return o(),g("div",{class:we([{readonly:l.readOnly,"nc-rich-text-grid":e(Q)},"nc-rich-text-comment flex flex-col w-full h-full"]),tabindex:1,onFocus:W},[l.renderAsText?(o(),g("div",vo,[e(d)?(o(),g("span",mo,j(((R=e(d))==null?void 0:R.getText())??""),1)):X("",!0)])):(o(),g(Pe,{key:1},[e(d)?(o(),O(V,{key:0,ref_key:"richTextLinkOptionRef",ref:ve,editor:e(d),"is-comment":!0,"is-form-field":!0,onBlur:y[0]||(y[0]=le=>K.value=!1)},null,8,["editor"])):X("",!0),i(e(Mn),{ref_key:"editorDom",ref:w,editor:e(d),class:we([{"p-1":!S.readOnly,"px-[0.25rem]":S.readOnly},"flex flex-col nc-comment-rich-editor w-full scrollbar-thin scrollbar-thumb-gray-200 nc-truncate scrollbar-track-transparent"]),onKeydown:ft($e,["stop"])},null,8,["editor","class"]),l.hideOptions?X("",!0):(o(),g("div",po,[i(fe,{editor:e(d),class:"!bg-transparent"},null,8,["editor"]),Ce((o(),O(h,{disabled:!((H=e(P))!=null&&H.length),class:"!disabled:bg-gray-100 nc-comment-save-btn !h-7 !w-7 !shadow-none",size:"xsmall",onClick:z},{default:m(()=>[i(J,{icon:"send"})]),_:1},8,["disabled"])),[[b,["a:row-expand:comment:save"]]])]))],64))],34)}}}),ho={key:0,class:"flex flex-col items-center justify-center w-full h-full"},_o={key:1,class:"flex flex-col h-full"},wo={key:0,class:"flex flex-col my-1 text-center justify-center h-full nc-scrollbar-thin"},xo={class:"text-center text-3xl text-gray-700"},go={class:"font-medium text-center my-6 text-gray-500"},bo={class:"flex items-start justify-between"},Co={class:"flex h-[28px] items-center gap-3 w-[calc(100%_-_40px)]"},ko={class:"truncate text-gray-800 font-medium !text-small !leading-[18px] overflow-hidden"},$o={class:"bg-white rounded-lg"},So={class:"flex items-center gap-4 py-3 px-2"},Ro={class:"flex flex-col"},Mo={class:"font-semibold text-gray-800"},Eo={class:"text-xs text-gray-600"},Oo={key:0,class:"px-3 rounded-b-lg !text-[13px] items-center text-gray-600 flex gap-1 bg-gray-100 py-1.5"},Do={class:"text-xs text-gray-500"},Lo={class:"flex items-center"},To={class:"flex gap-2 items-center"},Ao={class:"flex gap-2 items-center"},Vo={class:"flex gap-2 items-center"},No={key:1},Io={key:1,class:"space-y-1 pl-9"},Po={key:2,class:"px-3 pb-3 nc-comment-input !rounded-br-2xl gap-2 flex"},zo=Ue({__name:"Comments",setup(n){const{user:t,appInfo:r}=wt(),{dashboardUrl:S}=La(),{isUIAllowed:x}=xt(),{copy:Q}=ga(),K=ba(),I=Se(()=>x("commentEdit")),{isExpandedFormCommentMode:C}=Xe(Ta()),w=Pt(),{basesUser:ve}=Xe(w),P=Ve(zt,$()),{deleteComment:U,resolveComment:d,isCommentsLoading:A,comments:W,loadComments:Y,updateComment:M,saveComment:Me,primaryKey:$e}=Tn(),z=$(),l=$(),y=$(!1),V=$(!1),fe=$(null),J=$(),h=$(""),b=Ca(),R=Se(()=>{var c,_;return(c=P.value)!=null&&c.base_id?ve.value.get((_=P.value)==null?void 0:_.base_id)||[]:[]});function H(){l.value&&l.value.scrollTo({top:l.value.scrollHeight,behavior:"smooth"})}const le=async()=>{var _,_e,re,be;if(!h.value.trim())return;for(;h.value.endsWith("<br />")||h.value.endsWith(`
`);)h.value.endsWith("<br />")?h.value=h.value.slice(0,-6):h.value=h.value.slice(0,-2);V.value=!0,W.value=[...W.value,{id:`temp-${new Date().getTime()}`,comment:h.value,created_at:new Date().toISOString(),created_by:(_=t.value)==null?void 0:_.id,created_by_email:(_e=t.value)==null?void 0:_e.email,created_display_name:((re=t.value)==null?void 0:re.display_name)??""}];const c=h.value;h.value="",(be=J==null?void 0:J.value)==null||be.setEditorContent("",!0),await ze(()=>{H()});try{await Me(c),await ze(()=>{C.value=!0}),H()}catch(B){console.error(B)}},me=async c=>{var _;await Q(encodeURI(`${S==null?void 0:S.value}#/${K.params.typeOrId}/${K.params.baseId}/${(_=P.value)==null?void 0:_.id}?rowId=${$e.value}&commentId=${c.id}`))};function ge(c){const _=document.querySelector(`.${c}`);_&&_.scrollIntoView({behavior:"smooth",block:"center"})}function p(c){y.value&&(c.preventDefault(),c.stopPropagation(),z.value=void 0,Y(),y.value=!1,z.value=void 0)}function s(c){z.value={...c},y.value=!0,ze(()=>{ge(c.id)})}const v=Se({get(){var c;return((c=z.value)==null?void 0:c.comment)||""},set(c){z.value&&(z.value.comment=c)}});async function E(){var _;if(!y.value||!((_=z.value)!=null&&_.comment))return;for(;z.value.comment.endsWith("<br />")||z.value.comment.endsWith(`
`);)z.value.comment.endsWith("<br />")?z.value.comment=z.value.comment.slice(0,-6):z.value.comment=z.value.comment.slice(0,-2);V.value=!0;const c={...z.value};y.value=!1,z.value=void 0,await M(c.id,{comment:c.comment}),Y()}const N=c=>{var _,_e;return c.created_by===((_=t.value)==null?void 0:_.id)?"You":(_e=c.created_display_name)!=null&&_e.trim()?c.created_display_name||"Shared source":c.created_by_email?c.created_by_email:"Shared source"},q=c=>c.updated_at!==c.created_at&&c.updated_at?`[(edited)](a~~~###~~~Edited_${Nt(c.updated_at).replace(" ","_")}) `:"";function L(){fe.value&&(fe.value=null)}Ne(l,()=>{setTimeout(()=>{ze(()=>{const c=b.currentRoute.value.query,_=c.commentId;_?(b.push({query:{rowId:c.rowId}}),ge(_),fe.value=_,xa(document.querySelector(`.${fe.value}`),L)):H()})},100)});const te=c=>{const _=R.value.find(_e=>_e.email===c);return _?_.roles||yt.NO_ACCESS:yt.NO_ACCESS};return(c,_)=>{const _e=ka,re=_t,be=Oa,B=Da,F=Ut,se=It,D=Ra,pe=Ma,ne=Ea,oe=Bt,ye=yo,ee=it("e");return o(),g("div",{class:we(["h-full",{"pb-1":!e(I)}])},[e(A)?(o(),g("div",ho,[i(_e,{size:"xlarge"})])):(o(),g("div",_o,[e(W).length===0?(o(),g("div",wo,[f("div",xo,[i(re,{icon:"commentHere"})]),f("div",go,j(e(I)?c.$t("activity.startCommenting"):c.$t("activity.noCommentsYet")),1)])):(o(),g("div",{key:1,ref_key:"commentsWrapperEl",ref:l,class:"flex flex-col h-full py-1 nc-scrollbar-thin"},[(o(!0),g(Pe,null,pt(e(W),T=>{var ce,ke,Ee;return o(),g("div",{key:T.id,class:we([`${T.id}`,"nc-comment-item"]),onMouseover:L},[f("div",{class:we([{"hover:bg-gray-100":((ce=e(z))==null?void 0:ce.id)!==T.id,"nc-hovered-comment bg-gray-100":e(fe)===T.id},"group gap-3 overflow-hidden px-3 py-2 transition-colors"])},[f("div",bo,[f("div",{class:we(["flex items-start gap-3 flex-1",{"w-[calc(100%)] group-hover:w-[calc(100%_-_50px)]":!e(r).ee,"w-[calc(100%_-_44px)] group-hover:w-[calc(100%_-_72px)]":e(r).ee&&T.resolved_by,"w-[calc(100%_-_16px)] group-hover:w-[calc(100%_-_72px)]":e(r).ee&&!T.resolved_by&&e(I),"w-[calc(100%_-_16px)] group-hover:w-[calc(100%_-_44px)]":e(r).ee&&!T.resolved_by&&!e(I)}])},[i(be,{email:T.created_by_email,name:T.created_display_name,class:"mt-0.5",size:"medium"},null,8,["email","name"]),f("div",Co,[i(F,{placement:"topLeft",trigger:["hover"],class:"flex-none max-w-[calc(100%_-_72px)]"},{overlay:m(()=>[f("div",$o,[f("div",So,[i(be,{class:"!w-8 !h-8 border-1 border-gray-200 rounded-full",name:T.created_display_name,email:T.created_by_email},null,8,["name","email"]),f("div",Ro,[f("div",Mo,j(N(T)),1),f("div",Eo,j(T.created_by_email),1)])]),e(x)("dataEdit")?(o(),g("div",Oo,[he(" Has "),i(B,{size:"sm",border:!1,role:te(T.created_by_email)},null,8,["role"]),he(" role in base ")])):X("",!0)])]),default:m(()=>[f("div",ko,j(N(T)),1)]),_:2},1024),f("div",Do,j(("timeAgo"in c?c.timeAgo:e(Nt))(T.created_at)),1)])],2),f("div",Lo,[e(z)?X("",!0):(o(),O(F,{key:0,class:"nc-comment-more-actions !hidden !group-hover:block","overlay-class-name":"!min-w-[160px]",placement:"bottomRight"},{overlay:m(()=>[i(ne,null,{default:m(()=>[e(t)&&T.created_by_email===e(t).email&&e(I)?Ce((o(),O(D,{key:0,class:"text-gray-700",onClick:de=>s(T)},{default:m(()=>[f("div",To,[(o(),O(Te(("iconMap"in c?c.iconMap:e(Ae)).rename),{class:"cursor-pointer"})),he(" "+j(c.$t("general.edit")),1)])]),_:2},1032,["onClick"])),[[ee,["c:comment-expand:comment:edit"]]]):X("",!0),Ce((o(),O(D,{class:"text-gray-700",onClick:de=>me(T)},{default:m(()=>[f("div",Ao,[(o(),O(Te(("iconMap"in c?c.iconMap:e(Ae)).copy),{class:"cursor-pointer"})),he(" "+j(c.$t("general.copy"))+" URL ",1)])]),_:2},1032,["onClick"])),[[ee,["c:comment-expand:comment:copy"]]]),e(t)&&T.created_by_email===e(t).email&&e(I)?(o(),g(Pe,{key:1},[i(pe),Ce((o(),O(D,{class:"!text-red-500 !hover:bg-red-50",onClick:de=>e(U)(T.id)},{default:m(()=>[f("div",Vo,[(o(),O(Te(("iconMap"in c?c.iconMap:e(Ae)).delete),{class:"cursor-pointer"})),he(" "+j(c.$t("general.delete")),1)])]),_:2},1032,["onClick"])),[[ee,["c:row-expand:comment:delete"]]])],64)):X("",!0)]),_:2},1024)]),default:m(()=>[i(se,{class:"nc-expand-form-more-actions !hover:bg-gray-200 !w-7 !h-7 !bg-transparent",size:"xsmall",type:"text"},{default:m(()=>[i(re,{class:"text-md",icon:"threeDotVertical"})]),_:1})]),_:2},1024)),e(r).ee?(o(),g("div",No,[!T.resolved_by&&e(I)?(o(),O(oe,{key:0},{title:m(()=>[he("Click to resolve ")]),default:m(()=>[i(se,{class:"nc-resolve-comment-btn !w-7 !h-7 !bg-transparent !hover:bg-gray-200 !hidden !group-hover:block",size:"xsmall",type:"text",onClick:de=>e(d)(T.id)},{default:m(()=>[i(re,{class:"text-md",icon:"checkCircle"})]),_:2},1032,["onClick"])]),_:2},1024)):T.resolved_by?(o(),O(oe,{key:1},{title:m(()=>[he(j(`Resolved by ${T.resolved_display_name}`),1)]),default:m(()=>[i(se,{class:"!h-7 !w-7 !bg-transparent !hover:bg-gray-200 text-semibold",size:"xsmall",type:"text",onClick:de=>e(d)(T.id)},{default:m(()=>[i(re,{class:"text-md rounded-full bg-[#17803D] text-white",icon:"checkFill"})]),_:2},1032,["onClick"])]),_:2},1024)):X("",!0)])):X("",!0)])]),f("div",{class:we([{"mt-3":T.id===((ke=e(z))==null?void 0:ke.id)},"flex-1 flex flex-col gap-1 max-w-[calc(100%)]"])},[T.id===((Ee=e(z))==null?void 0:Ee.id)&&e(I)?(o(),O(ye,{key:0,value:e(v),"onUpdate:value":_[0]||(_[0]=de=>Ge(v)?v.value=de:null),autofocus:"","hide-options":!1,class:"expanded-form-comment-edit-input cursor-text expanded-form-comment-input !py-2 !px-2 !m-0 w-full !border-1 !border-gray-200 !rounded-lg !bg-white !text-gray-800 !text-small !leading-18px !max-h-[240px]","data-testid":"expanded-form-comment-input","sync-value-change":"",onSave:E,onKeydown:[Lt(p,["esc"]),Lt(ft(E,["exact","prevent"]),["enter"])],onBlur:_[1]||(_[1]=()=>{z.value=void 0,y.value=!1})},null,8,["value","onKeydown"])):(o(),g("div",Io,[i(ye,{value:`${T.comment}  ${q(T)}`,class:"!text-small !leading-18px !text-gray-800 -ml-1","read-only":"","sync-value-change":""},null,8,["value"])]))],2)],2)],34)}),128))],512)),e(I)?(o(),g("div",Po,[i(ye,{ref_key:"commentInputRef",ref:J,value:e(h),"onUpdate:value":_[2]||(_[2]=T=>Ge(h)?h.value=T:null),"hide-options":!1,placeholder:"Comment...",class:"expanded-form-comment-input !py-2 !px-2 cursor-text border-1 rounded-lg w-full bg-transparent !text-gray-800 !text-small !leading-18px !max-h-[240px]",autofocus:e(C),"data-testid":"expanded-form-comment-input",onFocus:_[3]||(_[3]=T=>C.value=!1),onKeydown:[_[4]||(_[4]=ft(()=>{},["stop"])),Lt(ft(le,["exact","prevent"]),["enter"])],onSave:le},null,8,["value","autofocus","onKeydown"])])):X("",!0)]))],2)}}}),Bo=gt(zo,[["__scopeId","data-v-08bc97ea"]]),[Fo,jo]=Vn((n,t)=>{var c,_,_e,re,be,B;const{$e:r,$state:S,$api:x}=rn(),{t:Q}=$a(),K=Ve(Sa,$(!1)),I=$([]),C=$(!1),w=$(!0),ve=$(0),P=$(new Set),U=Pt(),{basesUser:d}=Xe(U),{base:A}=Xe(tn()),W=Se(()=>n.value.base_id?d.value.get(n.value.base_id)||[]:[]),{sharedView:Y}=an(),M=$(!Y.value||((c=Y.value)==null?void 0:c.type)===st.GALLERY||((_=Y.value)==null?void 0:_.type)===st.KANBAN||(re=(_e=t.value)==null?void 0:_e.rowMeta)!=null&&re.new?t.value:{row:{},oldRow:{},rowMeta:{}});(B=(be=M.value)==null?void 0:be.rowMeta)!=null&&B.fromExpandedForm&&(M.value.rowMeta.fromExpandedForm=!0);const Me=Nn(M),$e=Ve(nn,$()),{addUndo:z,clone:l,defineViewScope:y}=on(),V=Ve(vt,rt()),{comments:fe,resolveComment:J,loadComments:h,updateComment:b,deleteComment:R,saveComment:H,isCommentsLoading:le}=An(n,M),{isUIAllowed:me}=xt(),ge=Se(()=>{var F,se,D,pe;if((F=M==null?void 0:M.value)!=null&&F.row){const ne=(D=(se=n==null?void 0:n.value)==null?void 0:se.columns)==null?void 0:D.find(ee=>ee.pv);if(!ne)return;const oe=(pe=M.value.row)==null?void 0:pe[ne.title],ye=ne.uidt;if(ye===Tt.Date)return(/^\d+$/.test(oe)?Ke(+oe):Ke(oe)).format("YYYY-MM-DD");if(ye===Tt.DateTime)return(/^\d+$/.test(oe)?Ke(+oe):Ke(oe)).format("YYYY-MM-DD HH:mm");if(ye===Tt.Time){let ee=Ke(oe);return ee.isValid()||(ee=Ke(oe,"HH:mm:ss")),ee.isValid()||(ee=Ke(`1999-01-01 ${oe}`)),ee.isValid()?ee.format("HH:mm:ss"):oe}return oe}}),p=Se(()=>qe(M.value.row,n.value.columns)),s=async(F,se=!0)=>{var pe,ne;if(!me("auditListRow")||ln||!M.value&&!F)return;const D=F??qe(M.value.row,n.value.columns);if(D)try{se&&(C.value=!0);const oe=((ne=(pe=(await x.utils.auditList({row_id:D,fk_model_id:n.value.id})).list)==null?void 0:pe.reverse)==null?void 0:ne.call(pe))||[];I.value=oe.map(ye=>{const ee=W.value.find(T=>T.email===ye.user);return{...ye,created_display_name:(ee==null?void 0:ee.display_name)??((ee==null?void 0:ee.email)??"").split("@")[0],created_by_email:ee==null?void 0:ee.email}})}catch(oe){Oe.error(await Fe(oe))}finally{C.value=!1}},v=F=>{var se,D;return((D=(se=S.user)==null?void 0:se.value)==null?void 0:D.email)===F},E=async()=>{var F;if(((F=$e.value)==null?void 0:F.type)===st.KANBAN){const{loadKanbanData:se}=Aa();await se()}};return{...Me,loadComments:h,deleteComment:R,loadAudits:s,comments:fe,audits:I,isAuditLoading:C,resolveComment:J,isCommentsLoading:le,saveComment:H,isYou:v,commentsDrawer:w,row:M,deleteRowById:async F=>{try{const se=F??qe(M.value.row,n.value.columns),D=await x.dbTableRow.delete(nt,A.value.id,n.value.id,encodeURIComponent(se));if(D.message)return Oe.info(`Record delete failed: ${`Unable to delete record with ID ${F} because of the following:
              
${D.message.join(`
`)}.

              Clear the data first & try again`})}`),!1}catch(se){Oe.error(`${Q("msg.error.deleteFailed")}: ${await Fe(se)}`)}},displayValue:ge,save:async(F={},se=!1,{kanbanClbk:D}={})=>{var oe,ye,ee,T;if(!n.value.id)return;let pe;const ne=((oe=M.value.rowMeta)==null?void 0:oe.new)??!1;if(ne){const{getMeta:ce}=sn(),{missingRequiredColumns:ke,insertObj:Ee}=await In({meta:n.value,ltarState:F,getMeta:ce,row:M.value.row,throwError:!0});if(ke.size)return;if(pe=await x.dbTableRow.create("noco",n.value.base_id,n.value.id,{...Ee,...F||{}}),Object.assign(M.value,{row:pe,rowMeta:{...M.value.rowMeta,new:!1},oldRow:{...pe}}),!se){const de=qe(pe,(ye=n.value)==null?void 0:ye.columns),ie=Pn(M.value.row,(ee=n.value)==null?void 0:ee.columns);z({redo:{fn:async ue=>{await x.dbTableRow.create("noco",A.value.id,n.value.id,{...ie,...ue}),await E(),V==null||V.trigger()},args:[l(Ee)]},undo:{fn:async ue=>{var tt,Je;const ct=await x.dbViewRow.delete("noco",A.value.id,(tt=n.value)==null?void 0:tt.id,(Je=$e.value)==null?void 0:Je.id,encodeURIComponent(ue));if(ct.message)throw new Error(ct.message);await E(),V==null||V.trigger()},args:[de]},scope:y({view:$e.value})})}}else{const ce=[...P.value].reduce((ke,Ee)=>(ke[Ee]=M.value.row[Ee],ke),{});if(Object.keys(ce).length){const ke=qe(M.value.row,n.value.columns);if(!ke)return Oe.info("Update not allowed for table which doesn't have primary Key");if(await x.dbTableRow.update(nt,A.value.id,n.value.id,encodeURIComponent(ke),ce),!se){const Ee=[...P.value].reduce((de,ie)=>(de[ie]=M.value.oldRow[ie],de),{});z({redo:{fn:async(de,ie)=>{await x.dbTableRow.update(nt,A.value.id,n.value.id,encodeURIComponent(de),ie),await E(),V==null||V.trigger()},args:[ke,l(ce)]},undo:{fn:async(de,ie)=>{await x.dbTableRow.update(nt,A.value.id,n.value.id,encodeURIComponent(de),ie),await E(),V==null||V.trigger()},args:[ke,l(Ee)]},scope:y({view:$e.value})})}w.value&&await Promise.all([h(),s()])}else{Oe.info(Q("msg.info.noColumnsToUpdate"));return}}return((T=$e.value)==null?void 0:T.type)===st.KANBAN&&D&&D(M.value,ne),P.value=new Set,r("a:row-expand:add"),pe},changedColumns:P,loadRow:async(F,se=!1,D=!1)=>{var oe,ye,ee,T,ce,ke,Ee,de;if((ye=(oe=M==null?void 0:M.value)==null?void 0:oe.rowMeta)!=null&&ye.new||K.value||!((ee=n.value)!=null&&ee.id))return;const pe=F??qe(M.value.row,n.value.columns);if(!pe)return;let ne={};try{ne=await x.dbTableRow.read(nt,(((T=A==null?void 0:A.value)==null?void 0:T.id)??((ce=n.value)==null?void 0:ce.base_id))||((Ee=(ke=Y.value)==null?void 0:ke.view)==null?void 0:Ee.base_id),n.value.id,encodeURIComponent(pe),{getHiddenColumn:!0})}catch(ie){if(((de=ie.response)==null?void 0:de.status)===404){const ue=Ca();Oe.error(Q("msg.noRecordFound")),ue.replace({query:{}})}else Oe.error(`${await Fe(ie)}`)}try{se&&(ne={...M.value.row,...(n.value.columns??[]).reduce((ie,ue)=>(Ye(ue)&&ue.title&&ue.title in ne&&(ie[ue.title]=ne[ue.title]),ie),{})}),D&&(ne=Object.keys(ne).reduce((ie,ue)=>(Object.prototype.hasOwnProperty.call(M.value.row,ue)?ie[ue]=M.value.row[ue]:ie[ue]=ne[ue],ie),{})),Object.assign(M.value,{row:ne,oldRow:{...ne},rowMeta:{...M.value.rowMeta}})}catch{Oe.error(`${Q("msg.error.errorLoadingRecord")}`)}},primaryKey:p,saveRowAndStay:ve,updateComment:b,clearColumns:()=>{P.value=new Set}}},"expanded-form-store");function Uo(){const n=jo();if(n==null)throw new Error("Please call `useExpandedFormStore` on the appropriate parent component");return n}const Ho={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ko=f("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1),Wo=[Ko];function Yo(n,t){return o(),g("svg",Ho,[...Wo])}const qo={name:"mdi-history",render:Yo},Go=n=>(Ft("data-v-fc57eef5"),n=n(),jt(),n),Xo={class:"h-full pb-1"},Zo={key:0,class:"flex flex-col items-center justify-center w-full h-full"},Qo={key:0,class:"flex flex-col text-center justify-center h-full"},Jo={class:"text-center text-3xl text-gray-600"},el=Go(()=>f("div",{class:"font-bold text-center my-1 text-gray-600"},"See changes to this record",-1)),tl={class:"group gap-3 overflow-hidden px-3 py-2 hover:bg-gray-100"},al={class:"flex items-start justify-between"},nl={class:"flex items-start gap-3 flex-1 w-full"},ol={class:"flex h-[28px] items-center gap-3 w-[calc(100%_-_40px)]"},ll={class:"truncate text-gray-800 font-medium !text-small !leading-[18px] overflow-hidden"},sl={class:"bg-white rounded-lg"},rl={class:"flex items-center gap-4 py-3 px-2"},il={class:"flex flex-col"},cl={class:"font-semibold text-gray-800"},dl={class:"text-xs text-gray-600"},ul={key:0,class:"px-3 rounded-b-lg !text-[13px] items-center text-gray-600 flex gap-1 bg-gray-100 py-1.5"},fl={class:"text-xs text-gray-500"},vl={class:"!text-[13px] text-gray-500 !leading-5 !pl-9"},ml=Ue({__name:"Audits",setup(n){const{user:t}=wt(),{isUIAllowed:r}=xt(),S=Pt(),{basesUser:x}=Xe(S),Q=Ve(zt,$()),K=Se(()=>{var d,A;return(d=Q.value)!=null&&d.base_id?x.value.get((A=Q.value)==null?void 0:A.base_id)||[]:[]}),{audits:I,isAuditLoading:C}=Uo(),w=$(null);function ve(d){var W;if(!d)return;const A=(W=w.value)==null?void 0:W.querySelector(`.nc-audit-item.${d}`);A&&A.scrollIntoView({behavior:"smooth",block:"center"})}const P=d=>{var A,W;return d.user===((A=t.value)==null?void 0:A.email)?"You":(W=d.created_display_name)!=null&&W.trim()?d.created_display_name||"Shared source":d.user?d.user:"Shared source"},U=d=>{const A=K.value.find(W=>W.email===d);return A?A.roles||yt.NO_ACCESS:yt.NO_ACCESS};return Ne(()=>I.value.length,d=>{ze(()=>{setTimeout(()=>{var A;ve((A=I.value[d-1])==null?void 0:A.id)},100)})}),(d,A)=>{const W=ka,Y=qo,M=Oa,Me=Da,$e=Ut,z=it("dompurify-html");return o(),g("div",Xo,[e(C)?(o(),g("div",Zo,[i(W,{size:"xlarge"})])):(o(),g("div",{key:1,ref_key:"auditsWrapperEl",ref:w,class:"flex flex-col h-full py-1 nc-scrollbar-thin"},[e(I).length===0?(o(),g("div",Qo,[f("div",Jo,[i(Y)]),el])):X("",!0),(o(!0),g(Pe,null,pt(e(I),l=>(o(),g("div",{key:l.id,class:we([`${l.id}`,"nc-audit-item"])},[f("div",tl,[f("div",al,[f("div",nl,[i(M,{email:l.created_by_email,name:l.created_display_name,class:"mt-0.5",size:"medium"},null,8,["email","name"]),f("div",ol,[i($e,{placement:"topLeft",trigger:["hover"],class:"flex-none max-w-[calc(100%_-_72px)]"},{overlay:m(()=>[f("div",sl,[f("div",rl,[i(M,{class:"!w-8 !h-8 border-1 border-gray-200 rounded-full",name:l.created_display_name,email:l.created_by_email},null,8,["name","email"]),f("div",il,[f("div",cl,j(P(l)),1),f("div",dl,j(l.created_by_email),1)])]),e(r)("dataEdit")?(o(),g("div",ul,[he(" Has "),i(Me,{size:"sm",border:!1,role:U(l.created_by_email)},null,8,["role"]),he(" role in base ")])):X("",!0)])]),default:m(()=>[f("div",ll,j(P(l)),1)]),_:2},1024),f("div",fl,j(("timeAgo"in d?d.timeAgo:e(Nt))(l.created_at)),1)])])]),Ce(f("div",vl,null,512),[[z,l.details]])])],2))),128))],512))])}}}),pl=gt(ml,[["__scopeId","data-v-fc57eef5"]]),Ht=n=>(Ft("data-v-261ec6b7"),n=n(),jt(),n),yl={class:"flex flex-col bg-white !h-full w-full rounded-br-2xl overflow-hidden"},hl={class:"flex items-center gap-2"},_l=Ht(()=>f("span",{class:"<lg:hidden"}," Comments ",-1)),wl={class:"flex items-center gap-2 text-gray-400"},xl=Ht(()=>f("span",{class:"<lg:hidden"}," Audits ",-1)),gl={key:1,class:"flex items-center gap-2"},bl=Ht(()=>f("span",{class:"<lg:hidden"}," Audits ",-1)),Cl=Ue({__name:"index",setup(n){const{appInfo:t}=wt(),r=$("comments");return(S,x)=>{const Q=_t,K=Bo,I=cn,C=Bt,w=pl,ve=zn,P=it("e");return o(),g("div",yl,[i(ve,{activeKey:e(r),"onUpdate:activeKey":x[0]||(x[0]=U=>Ge(r)?r.value=U:null),class:"h-full"},{default:m(()=>[i(I,{key:"comments",class:"w-full h-full"},{tab:m(()=>[Ce((o(),g("div",hl,[i(Q,{icon:"messageCircle",class:"w-4 h-4"}),_l])),[[P,["c:row-expand:comment"]]])]),default:m(()=>[i(K)]),_:1}),i(I,{key:"audits",class:"w-full",disabled:e(t).ee},{tab:m(()=>[e(t).ee?(o(),O(C,{key:0,class:"tab flex-1"},{title:m(()=>[he(j(S.$t("title.comingSoon")),1)]),default:m(()=>[Ce((o(),g("div",wl,[i(Q,{icon:"audit",class:"w-4 h-4"}),xl])),[[P,["c:row-expand:audit"]]])]),_:1})):Ce((o(),g("div",gl,[i(Q,{icon:"audit",class:"w-4 h-4"}),bl])),[[P,["c:row-expand:audit"]]])]),default:m(()=>[i(w)]),_:1},8,["disabled"])]),_:1},8,["activeKey"])])}}}),kl=gt(Cl,[["__scopeId","data-v-261ec6b7"]]),$l={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Sl=f("path",{fill:"currentColor",d:"M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6z"},null,-1),Rl=[Sl];function Ml(n,t){return o(),g("svg",$l,[...Rl])}const El={name:"mdi-chevron-down",render:Ml},Ol=Ze(()=>Qe(()=>import("./m8rA889u.js"),__vite__mapDeps([4,1,2,5,6,7,8]),import.meta.url).then(n=>n.default||n)),Dl=Ze(()=>Qe(()=>import("./e9_Ufzts.js"),__vite__mapDeps([9,1,2,7,10,11]),import.meta.url).then(n=>n.default||n)),Ll=Ze(()=>Qe(()=>import("./CjWFO-CW.js"),__vite__mapDeps([12,1,2,13,6,14]),import.meta.url).then(n=>n.default||n)),Tl=Ze(()=>Qe(()=>import("./Df02Q_8o.js"),__vite__mapDeps([15,1,2,7,6,16]),import.meta.url).then(n=>n.default||n)),Al=Ze(()=>Qe(()=>import("./fm4Ai8Gq.js"),__vite__mapDeps([17,1,2,18,19,20,7,21,10,6,22]),import.meta.url).then(n=>n.default||n)),Vl=Ze(()=>Qe(()=>import("./CmSmNSNp.js"),__vite__mapDeps([23,1,2,24]),import.meta.url).then(n=>n.default||n)),Kt=n=>(Ft("data-v-8c5776f1"),n=n(),jt(),n),Nl={class:"h-[85vh] xs:max-h-full xs:h-full max-h-215 flex flex-col"},Il={key:0,class:"flex-none h-4 flex items-center justify-center"},Pl=Kt(()=>f("div",{class:"w-[72px] h-[2px] rounded-full bg-[#49494a]"},null,-1)),zl=[Pl],Bl={class:"flex min-h-7 flex-shrink-0 w-full items-center nc-expanded-form-header relative p-4 xs:px-2 xs:py-0 xs:min-h-[48px] justify-between"},Fl={class:"flex-1 flex gap-4 lg:w-100 <lg:max-w-[calc(100%_-_178px)] xs:max-w-[calc(100%_-_44px)]"},jl={class:"flex gap-2"},Ul={key:0,class:"flex items-center"},Hl={key:0,class:"flex items-center truncate font-bold text-gray-800 text-base overflow-hidden"},Kl={key:1,class:"flex items-center font-bold text-gray-800 text-base max-w-[300px] xs:w-auto xs:max-w-[calc(100%_-_82px)] overflow-hidden"},Wl={class:"truncate"},Yl={class:"flex gap-2"},ql={class:"xs:px-1"},Gl={"data-testid":"nc-expanded-form-copy-url",class:"flex items-center"},Xl={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},Zl={"data-testid":"nc-expanded-form-copy-url",class:"flex gap-2 items-center"},Ql={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-duplicate"},Jl={class:"-ml-0.25"},es={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-delete"},ts={class:"-ml-0.25"},as=["col-id","data-testid"],ns={class:"flex items-start flex-row sm:gap-x-2 <lg:flex-col <lg:w-full nc-expanded-cell min-h-[37px]"},os={class:"w-45 <lg:w-full <lg:px-0 <lg:mb-1 h-[37px] xs:h-auto flex items-center rounded-lg overflow-hidden"},ls={key:0,class:"flex w-full <lg:px-1 items-center py-6"},ss=Kt(()=>f("div",{class:"flex-grow h-px mr-1 bg-gray-100"},null,-1)),rs=Kt(()=>f("div",{class:"flex-grow h-px ml-1 bg-gray-100"},null,-1)),is=["data-testid"],cs={class:"flex items-start flex-row sm:gap-x-2 <lg:flex-col <lg:w-full nc-expanded-cell min-h-[37px]"},ds={class:"w-45 <lg:w-full <lg:px-0 h-[37px] xs:h-auto flex items-center rounded-lg overflow-hidden"},us={key:0,class:"p-2"},fs={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},vs={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-copy-url"},ms={"data-testid":"nc-expanded-form-delete"},ps={key:1},ys={key:2,class:"p-2"},hs={class:"xs:px-1"},_s={key:1,class:"p-2"},ws={class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700"},xs={class:"text-ellipsis overflow-hidden select-none w-full pl-1.75 break-keep whitespace-nowrap"},gs={class:""},bs={class:"flex flex-row items-center gap-x-2 text-base font-bold"},Cs={class:"flex font-medium mt-2"},ks={class:"flex flex-row justify-end gap-x-2 mt-5"},$s={name:"ExpandedForm"},Ss=Ue({...$s,props:{modelValue:{type:Boolean},state:{},meta:{},loadRow:{type:Boolean},useMetaFields:{type:Boolean},row:{},rowId:{},view:{},showNextPrevIcons:{type:Boolean},firstRow:{type:Boolean},lastRow:{type:Boolean},closeAfterSave:{type:Boolean},newRecordHeader:{},skipReload:{type:Boolean},newRecordSubmitBtnText:{},expandForm:{type:Function},maintainDefaultViewOrder:{type:Boolean}},emits:["update:modelValue","cancel","next","prev","createdRecord","updateRowCommentCount"],setup(n,{emit:t}){const r=n,S=t,{activeView:x}=Xe(dn()),Q=$(0),K=$(),{dashboardUrl:I}=La(),{copy:C}=ga(),{isMobileMode:w}=wt(),{fieldsMap:ve,isLocalMode:P}=Fn(),{t:U}=$a(),d=We(r,"rowId"),A=We(r,"row"),W=We(r,"state"),Y=We(r,"meta"),M=We(r,"lastRow"),Me=We(r,"firstRow"),$e=We(r,"maintainDefaultViewOrder"),z=ba(),l=Ve(Sa,$(!1)),y=$(!1),V=$(!1),fe=$(!1),{isUIAllowed:J}=xt(),h=Se(()=>!J("dataEdit")||l.value),b=$(),R=Ve(vt,rt()),H=Ve(un,rt()),{addOrEditStackRow:le}=Aa(),{isExpandedFormCommentMode:me}=Xe(Ta());lt(fn,void 0);const ge=a=>{S(a),L.value=!0},p=vn(hn,a=>r.useMetaFields?$e.value?(Y.value.columns??[]).filter(u=>!ut(u)).sort((u,G)=>{var Z,Re;return(((Z=u.meta)==null?void 0:Z.defaultViewColOrder)??1/0)-(((Re=G.meta)==null?void 0:Re.defaultViewColOrder)??1/0)}):(Y.value.columns??[]).filter(u=>!ut(u)):(a==null?void 0:a.value)??[]),s=Se(()=>{var a,u;return((u=(a=Y.value)==null?void 0:a.columns)==null?void 0:u.find(G=>{var Z;return G.pv&&((Z=p.value)==null?void 0:Z.includes(G))}))??null}),v=Se(()=>{var a;return(((a=Y.value)==null?void 0:a.columns)??[]).filter(u=>{var G,Z;return!((G=p.value)!=null&&G.includes(u))&&(P.value&&(u!=null&&u.id)&&ve.value[u.id]?(Z=ve.value[u.id])==null?void 0:Z.initialShow:!0)}).filter(u=>!ut(u))}),E=$(!1),N=()=>{E.value=!E.value},q=Ve(mn,$(!1));lt(zt,Y);const L=$(!0),te=$(!1),{commentsDrawer:c,changedColumns:_,deleteRowById:_e,displayValue:re,state:be,isNew:B,loadRow:F,primaryKey:se,row:D,comments:pe,save:ne,loadComments:oe,loadAudits:ye,clearColumns:ee}=Fo(Y,A);H.on(async()=>{await F(d.value,!1,!0)});const T=$(!1);jn($({}),Y),Un(Y),Ne(W,()=>{W.value?be.value=W.value:be.value={}},{immediate:!0});const ce=wa(r,"modelValue",S,{defaultValue:!1}),ke=()=>{var a,u;J("dataEdit")?_.value.size>0?ue.value=!0:((u=(a=D.value)==null?void 0:a.rowMeta)!=null&&u.new&&S("cancel"),ce.value=!1):ce.value=!1},Ee=()=>{T.value=!0,y.value=!0,V.value=!0;const a={...D.value.row};delete a.ncRecordId;const u=Object.assign({},{row:a,oldRow:{},rowMeta:{new:!0}});setTimeout(async()=>{D.value=u,T.value=!1,Oe.success(U("msg.success.rowDuplicatedWithoutSavedYet"))},500)},de=async()=>{var a,u;te.value=!0;try{let G;((a=x.value)==null?void 0:a.type)===st.KANBAN&&(G=(Z,Re)=>{le(Z,Re)}),B.value?await ne(be.value,void 0,{kanbanClbk:G}):(await ne(void 0,void 0,{kanbanClbk:G}),F()),r.skipReload||(R==null||R.trigger(),H==null||H.trigger()),y.value=!1,r.closeAfterSave?ce.value=!1:V.value&&(qe(D.value.row,Y.value.columns)!==d.value&&((u=r==null?void 0:r.expandForm)==null||u.call(r,D.value)),setTimeout(()=>{V.value=!1},500)),S("createdRecord",D.value.row)}catch(G){B.value?Oe.error(`Add row failed: ${await Fe(G)}`):Oe.error(`${U("msg.error.rowUpdateFailed")}: ${await Fe(G)}`)}te.value=!1},ie=$(!1),ue=$(!1),ct=()=>{var a,u,G,Z;ie.value&&(ge("next"),(u=(a=D.value)==null?void 0:a.rowMeta)!=null&&u.new&&S("cancel"),ie.value=!1),ue.value&&(ue.value=!1,(Z=(G=D.value)==null?void 0:G.rowMeta)!=null&&Z.new&&S("cancel"),ce.value=!1),ee()},tt=async()=>{if(_.value.size>0){ie.value=!0;return}ge("next")},Je=async()=>{var a;await C(encodeURI(`${I==null?void 0:I.value}#/${z.params.typeOrId}/${z.params.baseId}/${(a=Y.value)==null?void 0:a.id}${r.view?`/${r.view.title}`:""}?rowId=${se.value}`)),fe.value=!0},Ia=async()=>{ie.value&&(y.value=!1,await de(),ge("next"),ie.value=!1),ue.value&&(ue.value=!1,await de(),ce.value=!1)},bt=Ve(vt,rt()),De=rt();if(De.on(()=>{bt==null||bt.trigger({shouldShowLoading:!1}),!B.value&&(F(void 0,!0),ye(d.value,!1))}),lt(vt,De),q.value&&D.value.rowMeta.new)for(const[a,u]of Object.entries(D.value.row))u&&_.value.add(a);lt(pn,ce);const Ct=async a=>{await Promise.allSettled([oe(a,!1),ye(a),F(a)]),L.value=!1},kt=$();ht(async()=>{fe.value=!1,L.value=!0;const a=!me.value;let u=!1;r.loadRow&&!r.rowId?(await Ct(),u=!0):r.rowId&&r.loadRow&&!u?await Ct(r.rowId):D.value=r.row,L.value=!1,a&&B.value&&setTimeout(()=>{var G,Z,Re;(Re=(Z=(G=kt.value)==null?void 0:G.$el)==null?void 0:Z.querySelector("input,select,textarea"))==null||Re.focus()},300)});const at=()=>{setTimeout(async()=>{D.value={row:{},oldRow:{},rowMeta:{new:!0}},be.value={},Q.value++,ce.value=!0},500)};Hn(ce,async a=>{var u,G,Z;if(a.altKey)if(a.key==="ArrowLeft")a.stopPropagation(),ge("prev");else if(a.key==="ArrowRight")a.stopPropagation(),tt();else if(a.code==="KeyS"){(u=document.activeElement)==null||u.blur(),a.stopPropagation();try{B.value?(await ne(be.value),De==null||De.trigger(null)):(await de(),De==null||De.trigger(null))}catch(Re){B.value?Oe.error(`Add row failed: ${await Fe(Re)}`):Oe.error(`${U("msg.error.rowUpdateFailed")}: ${await Fe(Re)}`)}}else a.code==="KeyN"&&((Z=(G=document.activeElement)==null?void 0:G.blur)==null||Z.call(G),_.value.size>0?oa.confirm({title:U("msg.saveChanges"),okText:U("general.save"),cancelText:U("labels.discard"),onOk:async()=>{await de(),De==null||De.trigger(null),at()},onCancel:()=>{at()}}):B.value?oa.confirm({title:"Do you want to save the record?",okText:U("general.save"),cancelText:U("labels.discard"),onOk:async()=>{try{await ne(be.value),De==null||De.trigger(null),at()}catch(Re){Oe.error(`${U("msg.error.rowUpdateFailed")}: ${await Fe(Re)}`)}},onCancel:()=>{at()}}):at())},{immediate:!0});const et=$(!1),Wt=()=>{et.value=!0},Pa=async()=>{et.value=!1,ce.value=!1,await _e(se.value||void 0),Oe.success(U("msg.rowDeleted")),await H.trigger({shouldShowLoading:!1}),ke(),et.value=!1};Ne(d,async a=>{await Ct(a)});const $t=Se(()=>!B.value&&c.value&&J("commentList")),dt=Se({get:()=>ue.value||ie.value,set:a=>{ue.value=a}}),za=a=>{let u=!1;document.querySelectorAll(".ant-select-dropdown").forEach(G=>{u=u||G.checkVisibility()}),!u&&(_.value.size===0&&!y.value?(ce.value=a,q.value&&S("cancel")):!a&&J("dataEdit")?dt.value=!0:ce.value=a)},St=a=>Kn(a)||ra(a)||Wn(a)||Yn(a)||qn(a)||ut(a)||_n(a)||wn(a);Ne([b,L],()=>{if(w.value)return;const a=b.value;a&&!L.value&&(a.scrollTop=a.scrollHeight,setTimeout(()=>{a.scrollTop=0},125))});const Ba=Se(()=>w.value?{placement:"bottom"}:{}),Rt=()=>xn()?"":"ALT";return Ne(()=>pe.value.length,a=>{S("updateRowCommentCount",a)}),(a,u)=>{const G=_t,Z=It,Re=Bt,Mt=Gn,Yt=Ol,He=Ra,qt=Ma,Gt=Ea,Xt=Ut,Zt=Dl,Qt=Ll,Jt=Tl,ea=Al,Fa=gn,ja=Vl,Ua=kl,Ha=Bn,Ie=it("e");return o(),g(Pe,null,[(o(),O(Te(e(w)?e(uo):ia),yn({"body-style":{padding:0},class:[{active:e(ce)},"nc-drawer-expanded-form"],closable:!1,footer:null,visible:e(ce),width:e(c)&&e(J)("commentList")?"min(80vw,1280px)":"min(70vw,768px)",size:e(w)?"medium":"small"},e(Ba),{"onUpdate:visible":za}),{default:m(()=>{var Be,ta,aa;return[f("div",Nl,[e(w)?(o(),g("div",Il,[f("div",{class:"flex-none h-full flex items-center justify-center cursor-pointer",onClick:ke},zl)])):X("",!0),f("div",Bl,[f("div",Fl,[f("div",jl,[r.showNextPrevIcons?(o(),O(Re,{key:0},{title:m(()=>[he(j(Rt())+" +  ",1)]),default:m(()=>[i(Z,{disabled:e(Me)||e(L),class:"nc-prev-arrow !w-7 !h-7 !text-gray-500 !disabled:text-gray-300",type:"text",size:"xsmall",onClick:u[0]||(u[0]=k=>ge("prev"))},{default:m(()=>[i(G,{icon:"chevronDown",class:"transform rotate-180"})]),_:1},8,["disabled"])]),_:1})):X("",!0),r.showNextPrevIcons?(o(),O(Re,{key:1},{title:m(()=>[he(j(Rt())+" +  ",1)]),default:m(()=>[i(Z,{disabled:e(M)||e(L),class:"nc-next-arrow !w-7 !h-7 !text-gray-500 !disabled:text-gray-300",type:"text",size:"xsmall",onClick:tt},{default:m(()=>[i(G,{icon:"chevronDown"})]),_:1},8,["disabled"])]),_:1})):X("",!0)]),e(L)?(o(),g("div",Ul,[i(Mt,{active:"",class:"!h-6 !sm:mr-14 !w-52 !rounded-md !overflow-hidden",size:"small"})])):(o(),g("div",{key:1,class:we(["flex-1 flex items-center gap-3 max-w-[calc(100%_-_108px)] xs:flex-row-reverse xs:justify-end",{"xs:max-w-[calc(100%_-_52px)]":e(B),"xs:max-w-[calc(100%_-_82px)]":!e(B)}])},[(Be=e(A).rowMeta)!=null&&Be.new||r.newRecordHeader?(o(),g("div",Hl,j(r.newRecordHeader??a.$t("activity.newRecord")),1)):e(re)&&!((aa=(ta=e(A))==null?void 0:ta.rowMeta)!=null&&aa.new)?(o(),g("div",Kl,[f("span",Wl,[i(Yt,{modelValue:e(re),"onUpdate:modelValue":u[1]||(u[1]=k=>Ge(re)?re.value=k:null),column:e(s)},null,8,["modelValue","column"])])])):X("",!0)],2))]),f("div",Yl,[!e(w)&&e(J)("dataEdit")?(o(),O(Re,{key:0},{title:m(()=>[he(j(Rt())+" + S ",1)]),default:m(()=>[Ce((o(),O(Z,{disabled:e(_).size===0&&!e(y),loading:e(te),class:"nc-expand-form-save-btn !xs:text-base !h-7 !px-2","data-testid":"nc-expanded-form-save",type:"primary",size:"xsmall",onClick:de},{default:m(()=>[f("div",ql,j(a.newRecordSubmitBtnText??"Save Record"),1)]),_:1},8,["disabled","loading"])),[[Ie,["c:row-expand:save"]]])]),_:1})):X("",!0),i(Re,null,{title:m(()=>[he(j(e(fe)?a.$t("labels.copiedRecordURL"):a.$t("labels.copyRecordURL")),1)]),default:m(()=>[!e(B)&&e(d)&&!e(w)?(o(),O(Z,{key:0,disabled:e(L),class:"!<lg:hidden text-gray-700 !h-7 !w-7",type:"text",size:"xsmall",onClick:u[2]||(u[2]=k=>Je())},{default:m(()=>[Ce((o(),g("div",Gl,[e(fe)?(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).check),{key:0,class:"cursor-pointer nc-duplicate-row h-4 w-4"})):(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).copy),{key:1,class:"cursor-pointer nc-duplicate-row h-4 w-4"}))])),[[Ie,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):X("",!0)]),_:1}),!e(B)&&e(d)&&!e(w)?(o(),O(Xt,{key:1,placement:"bottomRight"},{overlay:m(()=>[i(Gt,null,{default:m(()=>[i(He,{class:"text-gray-700",onClick:u[3]||(u[3]=k=>e(F)())},{default:m(()=>[Ce((o(),g("div",Xl,[(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).reload),{class:"cursor-pointer"})),he(" "+j(a.$t("general.reload"))+" "+j(a.$t("objects.record")),1)])),[[Ie,["c:row-expand:reload"]]])]),_:1}),!e(B)&&e(d)?(o(),O(He,{key:0,type:"secondary",class:"!lg:hidden text-gray-700",disabled:e(L),onClick:u[4]||(u[4]=k=>Je())},{default:m(()=>[Ce((o(),g("div",Zl,[(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).copy),{class:"cursor-pointer"})),he(" "+j(a.$t("labels.copyRecordURL")),1)])),[[Ie,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):X("",!0),e(J)("dataEdit")?(o(),O(He,{key:1,class:"text-gray-700",onClick:u[5]||(u[5]=k=>e(B)?()=>{}:Ee())},{default:m(()=>[Ce((o(),g("div",Ql,[(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).duplicate),{class:"cursor-pointer nc-duplicate-row"})),f("span",Jl,j(a.$t("labels.duplicateRecord")),1)])),[[Ie,["c:row-expand:duplicate"]]])]),_:1})):X("",!0),e(J)("dataEdit")?(o(),O(qt,{key:2})):X("",!0),e(J)("dataEdit")?(o(),O(He,{key:3,class:"!text-red-500 !hover:bg-red-50",onClick:u[6]||(u[6]=k=>!e(B)&&Wt())},{default:m(()=>[Ce((o(),g("div",es,[(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).delete),{class:"cursor-pointer nc-delete-row"})),f("span",ts,j(a.$t("general.deleteEntity",{entity:a.$t("objects.record").toLowerCase()})),1)])),[[Ie,["c:row-expand:delete"]]])]),_:1})):X("",!0)]),_:1})]),default:m(()=>[i(Z,{type:"text",size:"xsmall",class:"nc-expand-form-more-actions !w-7 !h-7",disabled:e(L)},{default:m(()=>[i(G,{icon:"threeDotVertical",class:we(["text-md",e(L)?"text-gray-300":"text-gray-700"])},null,8,["class"])]),_:1},8,["disabled"])]),_:1})):X("",!0),i(Z,{class:"nc-expand-form-close-btn !w-7 !h-7","data-testid":"nc-expanded-form-close",type:"text",size:"xsmall",onClick:ke},{default:m(()=>[i(G,{class:"text-md text-gray-700 h-4 w-4",icon:"close"})]),_:1})])]),f("div",{ref_key:"wrapper",ref:K,class:"flex flex-grow flex-row h-[calc(100%_-_4rem)] w-full border-t-1 border-gray-200"},[f("div",{class:we([{"w-full":!e($t),"flex-1":e($t)},"h-full flex xs:w-full flex-col overflow-hidden"])},[f("div",{ref_key:"expandedFormScrollWrapper",ref:b,class:"flex flex-col flex-grow gap-6 h-full max-h-full nc-scrollbar-thin items-center w-full p-4 xs:px-4 xs:pt-4 xs:pb-2 xs:gap-6 children:max-w-[588px] <lg:children:max-w-[450px]"},[(o(!0),g(Pe,null,pt(e(p),(k,Et)=>Ce((o(),g("div",{key:k.title,class:we([`nc-expand-col-${k.title}`,"nc-expanded-form-row w-full"]),"col-id":k.id,"data-testid":`nc-expand-col-${k.title}`},[f("div",ns,[f("div",os,[e(Ye)(k)?(o(),O(Zt,{key:0,column:k,class:"nc-expanded-cell-header h-full flex-none"},null,8,["column"])):(o(),O(Qt,{key:1,column:k,class:"nc-expanded-cell-header flex-none"},null,8,["column"]))]),e(L)?(o(),O(Mt,{key:0,active:"",class:"h-[37px] flex-none <lg:!w-full lg:flex-1 !rounded-lg !overflow-hidden",size:"small"})):(o(),g(Pe,{key:1},[k.title?(o(),O(Fa,{key:0,ref_for:!0,ref:Et?null:Le=>kt.value=Le,class:we(["bg-white flex-1 <lg:w-full px-1 min-h-[37px] flex items-center relative",{"!select-text nc-system-field":St(k),"!select-text nc-readonly-div-data-cell":e(h)}])},{default:m(()=>[e(Ye)(k)?(o(),O(Jt,{key:0,modelValue:e(D).row[k.title],"onUpdate:modelValue":Le=>e(D).row[k.title]=Le,class:we({"px-1":St(k)}),column:k,"read-only":e(h),row:e(D)},null,8,["modelValue","onUpdate:modelValue","class","column","read-only","row"])):(o(),O(ea,{key:1,modelValue:e(D).row[k.title],"onUpdate:modelValue":[Le=>e(D).row[k.title]=Le,Le=>e(_).add(k.title)],active:!0,column:k,"edit-enabled":!0,"read-only":e(h)},null,8,["modelValue","onUpdate:modelValue","column","read-only"]))]),_:2},1032,["class"])):X("",!0)],64))])],10,as)),[[la,!e(Ye)(k)||!e(B)||e(sa)(k)]])),128)),e(v).length>0?(o(),g("div",ls,[ss,i(Z,{size:e(w)?"medium":"small",class:"flex-shrink !text-sm overflow-hidden !text-gray-500 !font-weight-500",type:"secondary",onClick:N},{default:m(()=>[he(j(e(E)?`Hide ${e(v).length} hidden`:`Show ${e(v).length} hidden`)+" "+j(e(v).length>1?"fields":"field")+" ",1),i(e(El),{class:we([e(E)?"transform rotate-180":"","ml-1"])},null,8,["class"])]),_:1},8,["size"]),rs])):X("",!0),e(v).length>0&&e(E)?(o(!0),g(Pe,{key:1},pt(e(v),(k,Et)=>Ce((o(),g("div",{key:`${k.id}-${k.title}`,class:we([`nc-expand-col-${k.title}`,"nc-expanded-form-row w-full"]),"data-testid":`nc-expand-col-${k.title}`},[f("div",cs,[f("div",ds,[e(Ye)(k)?(o(),O(Zt,{key:0,column:k,"is-hidden-col":"",class:"nc-expanded-cell-header flex-none"},null,8,["column"])):(o(),O(Qt,{key:1,column:k,"is-hidden-col":"",class:"nc-expanded-cell-header flex-none"},null,8,["column"]))]),e(L)?(o(),O(Mt,{key:0,active:"",class:"h-[37px] flex-none <lg:!w-full lg:flex-1 !rounded-lg !overflow-hidden",size:"small"})):(o(),g(Pe,{key:1},[k.title?(o(),O(ja,{key:0,ref_for:!0,ref:Et?null:Le=>kt.value=Le,class:we(["bg-white flex-1 <lg:w-full px-1 min-h-[37px] flex items-center relative",{"!select-text nc-system-field":St(k),"!bg-gray-50 !select-text nc-readonly-div-data-cell":e(h)}])},{default:m(()=>[e(Ye)(k)?(o(),O(Jt,{key:0,modelValue:e(D).row[k.title],"onUpdate:modelValue":Le=>e(D).row[k.title]=Le,column:k,"read-only":e(h),row:e(D)},null,8,["modelValue","onUpdate:modelValue","column","read-only","row"])):(o(),O(ea,{key:1,modelValue:e(D).row[k.title],"onUpdate:modelValue":[Le=>e(D).row[k.title]=Le,Le=>e(_).add(k.title)],active:!0,column:k,"edit-enabled":!0,"read-only":e(h)},null,8,["modelValue","onUpdate:modelValue","column","read-only"]))]),_:2},1032,["class"])):X("",!0)],64))])],10,is)),[[la,("isFormula"in a?a.isFormula:e(ra))(k)||!e(Ye)(k)||!e(B)||e(sa)(k)]])),128)):X("",!0)],512),e(J)("dataEdit")?(o(),g("div",{key:0,class:we(["w-full flex items-center justify-end px-2 xs:p-0 xs:gap-x-4 xs:justify-between",{"xs(border-t-1 border-gray-200)":!e(B)}])},[!e(B)&&e(w)?(o(),g("div",us,[i(Xt,{placement:"bottomRight",class:"p-2"},{overlay:m(()=>[i(Gt,null,{default:m(()=>[i(He,{class:"text-gray-700",onClick:u[7]||(u[7]=k=>e(F)())},{default:m(()=>[Ce((o(),g("div",fs,[(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).reload),{class:"cursor-pointer"})),he(" "+j(a.$t("general.reload")),1)])),[[Ie,["c:row-expand:reload"]]])]),_:1}),e(d)?(o(),O(He,{key:0,class:"text-gray-700",onClick:u[8]||(u[8]=k=>e(B)?()=>{}:Je())},{default:m(()=>[Ce((o(),g("div",vs,[(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).copy),{class:"cursor-pointer nc-duplicate-row"})),he(" "+j(a.$t("labels.copyRecordURL")),1)])),[[Ie,["c:row-expand:copy-url"]]])]),_:1})):X("",!0),i(qt),e(J)("dataEdit")&&!e(B)?Ce((o(),O(He,{key:1,class:"!text-red-500 !hover:bg-red-50",onClick:u[9]||(u[9]=k=>!e(B)&&Wt())},{default:m(()=>[f("div",ms,[(o(),O(Te(("iconMap"in a?a.iconMap:e(Ae)).delete),{class:"cursor-pointer nc-delete-row"})),he(" Delete record ")])]),_:1})),[[Ie,["c:row-expand:delete"]]]):X("",!0)]),_:1})]),default:m(()=>[i(Z,{disabled:e(L),class:"nc-expand-form-more-actions",type:"secondary",size:"small"},{default:m(()=>[i(G,{class:we([e(L)?"text-gray-300":"text-gray-700","text-md"]),icon:"threeDotVertical"},null,8,["class"])]),_:1},8,["disabled"])]),_:1})])):X("",!0),e(B)&&e(w)?(o(),g("div",ps)):X("",!0),e(w)?(o(),g("div",ys,[Ce((o(),O(Z,{disabled:e(_).size===0&&!e(y),loading:e(te),class:we(["nc-expand-form-save-btn !xs:text-sm !px-2",{"!h-7":!e(w)}]),"data-testid":"nc-expanded-form-save",type:"primary",size:e(w)?"small":"xsmall",onClick:de},{default:m(()=>[f("div",hs,j(a.newRecordSubmitBtnText??e(B)?"Create Record":"Save Record"),1)]),_:1},8,["disabled","loading","class","size"])),[[Ie,["c:row-expand:save"]]])])):X("",!0)],2)):(o(),g("div",_s))],2),e($t)&&!e(V)?(o(),g("div",{key:0,class:we([{active:e(c)&&e(J)("commentList")},"nc-comments-drawer border-l-1 relative border-gray-200 bg-gray-50 w-1/3 max-w-[340px] min-w-0 h-full xs:hidden rounded-br-2xl"])},[i(Ua)],2)):X("",!0)],512)])]}),_:1},16,["class","visible","width","size"])),i(Ha,{visible:e(et),"onUpdate:visible":u[11]||(u[11]=Be=>Ge(et)?et.value=Be:null),"entity-name":"Record","on-delete":()=>Pa()},{"entity-preview":m(()=>[f("span",null,[f("div",ws,[f("div",xs,[i(Yt,{modelValue:e(re),"onUpdate:modelValue":u[10]||(u[10]=Be=>Ge(re)?re.value=Be:null),column:e(s)},null,8,["modelValue","column"])])])])]),_:1},8,["visible","on-delete"]),i(ia,{visible:e(dt),"onUpdate:visible":u[12]||(u[12]=Be=>Ge(dt)?dt.value=Be:null),size:"small"},{default:m(()=>[f("div",gs,[f("div",bs,j(a.$t("tooltip.saveChanges")),1),f("div",Cs,j(a.$t("activity.doYouWantToSaveTheChanges")),1),f("div",ks,[i(Z,{type:"secondary",size:"small",onClick:ct},{default:m(()=>[he(j(a.$t("labels.discard")),1)]),_:1}),i(Z,{key:"submit",type:"primary",size:"small",loading:e(te),onClick:Ia},{default:m(()=>[he(j(a.$t("tooltip.saveChanges")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])],64)}}}),pr=gt(Ss,[["__scopeId","data-v-8c5776f1"]]);export{pr as default};
