import H from"./hZgTYrdl.js";import Q from"./37hePIet.js";import{e as z,cV as W,a5 as g,bL as q,r as J,jj as K,cW as X,f as N,d0 as c,hM as A,c$ as p,fE as Z,g3 as w,m as I,f$ as ee,o as h,Q as S,w as V,c as te,ao as ae,at as le,N as y,a as k,T as F,S as se,b as oe,d as re,t as R,U as ie,R as ne,O as ue,$ as de}from"./DZZ6t_j4.js";import{_ as me}from"./DnSVh-oD.js";import{a as ce}from"./i4aLU0Nw.js";import{i as pe,a as fe}from"./ByVBARmO.js";import{S as ve}from"./D_MsYLkT.js";const _e={class:"flex items-center w-full justify-between w-full gap-2 max-w-50"},we={class:"flex gap-1.5 flex-1 items-center truncate items-center h-full"},ke=z({__name:"FieldListAutoCompleteDropdown",props:{modelValue:{},isSort:{type:Boolean},columns:{},allowEmpty:{type:Boolean},meta:{}},emits:["update:modelValue"],setup(O,{emit:B}){var T,C;const L=W(O,["modelValue","isSort","allowEmpty"]),$=B,D=g(L,"columns"),f=g(L,"meta"),j=q(K,J({})),{metas:P}=X(),d=N({get:()=>O.modelValue,set:a=>$("update:modelValue",a)}),{showSystemFields:x,metaColumnById:l,fieldsMap:u,isLocalMode:b}=ce(),M=N(()=>{var a,r,i,n,m;return(m=(n=((a=D.value)==null?void 0:a.filter(e=>{var t,s,o;return!(b.value&&(e!=null&&e.id)&&u.value[e.id]&&(!((t=u.value[e.id])!=null&&t.initialShow)||!x.value&&c((s=l==null?void 0:l.value)==null?void 0:s[e.id]))||c((o=l==null?void 0:l.value)==null?void 0:o[e.id])&&A(e,f.value)||e.uidt===p.Button)}))||((i=(r=f.value)==null?void 0:r.columns)==null?void 0:i.filter(e=>{var t,s,o;return b.value&&(e!=null&&e.id)&&u.value[e.id]&&(!((t=u.value[e.id])!=null&&t.initialShow)||!x.value&&c((s=l==null?void 0:l.value)==null?void 0:s[e.id]))?!1:e.uidt===p.Links?!0:c((o=l==null?void 0:l.value)==null?void 0:o[e.id])?A(e,f.value)?!1:d.value===e.id||x.value:e.uidt===p.QrCode||e.uidt===p.Barcode||e.uidt===p.ID||e.uidt===p.Button?!1:O.isSort?!(Z(e)&&e.colOptions.type!==w.BELONGS_TO):!(e.colOptions&&e.system)})))==null?void 0:n.sort((e,t)=>{var _,E;let s=0,o=0,v=0;return c(e)&&(s=1),c(t)&&(o=1),e!=null&&e.id&&(t!=null&&t.id)&&((_=u.value[e.id])==null?void 0:_.order)!==void 0&&((E=u.value[t.id])==null?void 0:E.order)!==void 0&&(v=u.value[e.id].order-u.value[t.id].order),s-o||v}))==null?void 0:m.map(e=>({value:e.id,label:j.value[e.id]||e.title,icon:I(ee(e)?H:Q,{columnMeta:e}),c:e}))}),U=(a,r)=>{var i;return(i=r.label.toLowerCase())==null?void 0:i.includes(a.toLowerCase())};!d.value&&O.allowEmpty!==!0&&(d.value=((C=(T=M.value)==null?void 0:T[0])==null?void 0:C.value)||"");const Y={[w.BELONGS_TO]:"text-blue-500",[w.ONE_TO_ONE]:"text-purple-500",[w.HAS_MANY]:"text-orange-500",[w.MANY_TO_MANY]:"text-pink-500"},G=N(()=>{var a,r;return((r=(a=f.value)==null?void 0:a.columns)==null?void 0:r.reduce((i,n)=>{var m,e,t,s;if(n&&pe(n)||fe(n)){const o=(t=(e=(m=P.value)==null?void 0:m[f.value.id])==null?void 0:e.columns)==null?void 0:t.find(v=>{var _;return v.id===((_=n.colOptions)==null?void 0:_.fk_relation_column_id)});o&&(i[n.id]=Y[(s=o.colOptions)==null?void 0:s.type])}return i},{}))||{}});return(a,r)=>{const i=de,n=ve,m=me;return h(),S(m,{value:y(d),"onUpdate:value":r[0]||(r[0]=e=>ue(d)?d.value=e:null),"dropdown-match-select-width":!1,"show-search":"",placeholder:a.$t("placeholder.selectField"),"filter-option":U,"dropdown-class-name":"nc-dropdown-toolbar-field-list"},{default:V(()=>[(h(!0),te(ae,null,le(y(M),e=>(h(),S(n,{key:e.value,label:e.label,value:e.value},{default:V(()=>[k("div",_e,[k("div",we,[(h(),S(F(e.icon),{class:se(["!w-3.5 !h-3.5 !mx-0",y(G)[e.value]||"!text-gray-500"])},null,8,["class"])),oe(i,{style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},class:"max-w-[15rem] truncate select-none","show-on-truncate-only":""},{title:V(()=>[re(R(e.label),1)]),default:V(()=>[k("span",null,R(e.label),1)]),_:2},1024)]),y(d)===e.value?(h(),S(F(("iconMap"in a?a.iconMap:y(ie)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):ne("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["value","placeholder"])}}});export{ke as _};
