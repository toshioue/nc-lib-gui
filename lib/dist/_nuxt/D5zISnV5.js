import{f as ee,N as ae,bN as d,fQ as le,r as n,hr as te,aC as se,aE as ne,hH as ue,hL as oe,aF as re,gQ as ie,gV as ce,ai as fe,g as _,cs as j,F as ve,af as S,H as B,d3 as de,aG as pe,iN as me,o as x,c as K,b as z,w as G,a as F,P as s,Q as O,a9 as ye,Y as M,S as ke,T,U as Ye,aq as be,$ as ge,_ as $e}from"./Cgw6cdOy.js";import{_ as Ie}from"./BM5CMLBx.js";import{_ as we}from"./CiTH7PYd.js";const Ce=["title"],Ve=["value","placeholder","readonly"],he={class:"w-[256px]"},Ee={key:0,class:"absolute inset-0 z-90 cursor-pointer"},_e=ee({__name:"YearPicker",props:{modelValue:{},isPk:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(b,{emit:U}){const P=U,{showNull:h,isMobileMode:R}=ae(),H=d(le,null),k=d(te,n(!1)),g=d(se,n(!1)),r=d(ne,n(!1)),$=d(ue,n(!1)),m=d(oe,n(!1)),Q=d(re,n(!1)),q=d(ie,n(!1)),I=d(ce,n(!1)),w=n(!1),i=n(),C=n(!1),{t:D}=fe(),t=n(!1),p=n(),u=_({get(){if(!b.modelValue||C.value)return;const e=j(b.modelValue.toString(),"YYYY");if(!e.isValid()){w.value=!0;return}return e},set(e){if(C.value=!1,!e){P("update:modelValue",null);return}e!=null&&e.isValid()&&P("update:modelValue",e.format("YYYY")),t.value=!1}});ve(()=>{u.value&&(p.value=u.value)});const c=`picker_${Math.floor(Math.random()*99999)}`;S(i,e=>{var a,l,o;(a=e.target)!=null&&a.closest(`.${c}, .nc-${c}`)||((o=(l=i.value)==null?void 0:l.blur)==null||o.call(l),t.value=!1)});const L=e=>{var a,l;(a=e==null?void 0:e.relatedTarget)!=null&&a.closest(`.${c}, .nc-${c}`)||(l=e==null?void 0:e.target)!=null&&l.closest(`.${c}, .nc-${c}`)||(t.value=!1)};B(t,e=>{var a,l;e?(r.value=!0,(l=(a=i.value)==null?void 0:a.focus)==null||l.call(a),S(document.querySelector(`.${c}`),o=>{var f;(f=o==null?void 0:o.target)!=null&&f.closest(`.nc-${c}`)||(t.value=!1)})):C.value=!1},{flush:"post"}),B(r,e=>{m.value&&e&&!t.value&&(t.value=!0)});const A=_(()=>(Q.value||I.value)&&!w.value||m.value&&!h.value&&!w.value&&!de(H.value)&&g.value||$.value?"YYYY":b.modelValue===null&&h.value?D("general.null").toUpperCase():w.value?D("msg.invalidTime"):""),E=_(()=>k.value||(k.value||u.value&&b.isPk)&&!g.value&&!r.value?!1:t.value),J=()=>{k.value||t.value||(t.value=g.value||r.value)},W=(e,a)=>{var l,o,f,v,y,Y,V,N;switch(e.key!=="Enter"&&e.key!=="Tab"&&e.stopPropagation(),e.key){case"Enter":e.preventDefault(),q.value&&e.stopPropagation(),u.value=p.value,t.value=!a,t.value||(r.value=!1,m.value&&!I.value&&!$.value&&((o=(l=i.value)==null?void 0:l.blur)==null||o.call(l)));return;case"Tab":t.value=!1,m.value&&(r.value=!1,(v=(f=i.value)==null?void 0:f.blur)==null||v.call(f));return;case"Escape":a?(t.value=!1,r.value=!1,m.value&&!I.value&&!$.value&&((Y=(y=i.value)==null?void 0:y.blur)==null||Y.call(y))):(r.value=!1,(N=(V=i.value)==null?void 0:V.blur)==null||N.call(V));return;default:!a&&/^[0-9a-z]$/i.test(e.key)&&(t.value=!0)}};pe(document,"keydown",e=>{if(g.value&&!(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||!m.value||I.value||$.value||me()))switch(e.key){case";":u.value=j(new Date),e.preventDefault();break;default:!E.value&&i.value&&/^[0-9a-z]$/i.test(e.key)&&(C.value=!0,i.value.focus(),r.value=!0,t.value=!0)}});const X=e=>{const a=e.target.value;if(!a){p.value=void 0;return}const l=j(a,"YYYY");l.isValid()&&(p.value=l)};function Z(e){p.value=e,u.value=e,t.value=!1}return(e,a)=>{const l=ge,o=Ie,f=we;return x(),K(be,null,[z(f,{visible:s(E),"auto-close":!1,trigger:["click"],disabled:s(k),class:Ye(["nc-cell-field",[`nc-${c}`,{"nc-null":e.modelValue===null&&s(h)}]]),"overlay-class-name":`${c} nc-picker-year ${s(t)?"active":""} !min-w-[260px]`},{overlay:G(()=>[F("div",he,[z(o,{"page-date":s(p),"onUpdate:pageDate":a[4]||(a[4]=v=>O(p)?p.value=v:null),"selected-date":s(u),"onUpdate:selectedDate":a[5]||(a[5]=v=>O(u)?u.value=v:null),"is-open":s(E),"is-year-picker":"","is-cell-input-field":"",size:"medium"},null,8,["page-date","selected-date","is-open"])])]),default:G(()=>{var v,y;return[F("div",ye(e.$attrs,{title:(v=s(u))==null?void 0:v.format("YYYY"),class:"nc-year-picker flex items-center justify-between ant-picker-input relative"}),[F("input",{ref_key:"datePickerRef",ref:i,type:"text",value:((y=s(u))==null?void 0:y.format("YYYY"))??"",placeholder:s(A),class:"nc-year-input border-none outline-none !text-current bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:s(k)||!!s(R),onBlur:L,onKeydown:a[0]||(a[0]=Y=>W(Y,s(t))),onMouseup:a[1]||(a[1]=M(()=>{},["stop"])),onMousedown:a[2]||(a[2]=M(()=>{},["stop"])),onClick:J,onInput:X},null,40,Ve),s(u)&&!s(k)?(x(),ke(l,{key:0,icon:"closeCircle",class:"nc-clear-year-icon nc-action-icon absolute right-0 top-[50%] transform -translate-y-1/2 invisible cursor-pointer",onClick:a[3]||(a[3]=M(Y=>Z(),["stop"]))})):T("",!0)],16,Ce)]}),_:1},8,["visible","disabled","class","overlay-class-name"]),!s(r)&&s(m)?(x(),K("div",Ee)):T("",!0)],64)}}}),Me=$e(_e,[["__scopeId","data-v-cdab2e2f"]]);export{Me as default};
