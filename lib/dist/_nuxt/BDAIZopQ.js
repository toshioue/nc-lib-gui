import{c$ as t,U as c,g3 as b,dc as g,d0 as C,f$ as L}from"./DZZ6t_j4.js";function S(e){return e!==null&&typeof e=="object"&&!I(e)}function O(e){return S(e)&&Object.keys(e).length===0}function I(e){return Array.isArray(e)}function R(e){return I(e)&&e.length===0}function A(e){return typeof e=="string"}function j(e){return typeof e>"u"}function B(e){return e===null}const P=[{name:t.Links,icon:c.cellLinks,virtual:1},{name:t.LinkToAnotherRecord,icon:c.cellLinks,virtual:1,deprecated:1},{name:t.Lookup,icon:c.cellLookup,virtual:1},{name:t.SingleLineText,icon:c.cellText},{name:t.LongText,icon:c.cellLongText},{name:t.Number,icon:c.cellNumber},{name:t.Decimal,icon:c.cellDecimal},{name:t.Attachment,icon:c.cellAttachment},{name:t.Checkbox,icon:c.cellCheckbox},{name:t.MultiSelect,icon:c.cellMultiSelect},{name:t.SingleSelect,icon:c.cellSingleSelect},{name:t.Date,icon:c.cellDate},{name:t.Year,icon:c.cellYear},{name:t.Time,icon:c.cellTime},{name:t.PhoneNumber,icon:c.cellPhone},{name:t.Email,icon:c.cellEmail},{name:t.URL,icon:c.cellUrl},{name:t.Currency,icon:c.cellCurrency},{name:t.Percent,icon:c.cellPercent},{name:t.Duration,icon:c.cellDuration},{name:t.Rating,icon:c.cellRating},{name:t.Formula,icon:c.cellFormula,virtual:1},{name:t.Rollup,icon:c.cellRollup,virtual:1},{name:t.DateTime,icon:c.cellDatetime},{name:t.QrCode,icon:c.cellQrCode,virtual:1},{name:t.Barcode,icon:c.cellBarcode,virtual:1},{name:t.Geometry,icon:c.cellGeometry},{name:t.GeoData,icon:c.geoData},{name:t.JSON,icon:c.cellJson},{name:t.SpecificDBType,icon:c.cellDb},{name:t.User,icon:c.cellUser},{name:t.Button,icon:c.cellButton,virtual:1},{name:t.CreatedTime,icon:c.cellSystemDate},{name:t.LastModifiedTime,icon:c.cellSystemDate},{name:t.CreatedBy,icon:c.cellSystemUser},{name:t.LastModifiedBy,icon:c.cellSystemUser}],M=e=>([...P,{name:t.CreatedTime,icon:c.cellSystemDate},{name:t.ID,icon:c.cellSystemKey},{name:t.ForeignKey,icon:c.cellLinks}].find(n=>n.name===e)||{}).icon,T=e=>{var n;return e&&e.rqd&&!x(e==null?void 0:e.cdf)&&!e.ai&&!((n=e.meta)!=null&&n.ag)},U=(e,n)=>e.uidt===t.LinkToAnotherRecord&&e.colOptions&&e.colOptions.type===b.BELONGS_TO&&T(n.find(i=>i.id===e.colOptions.fk_child_column_id)),N=(e,n)=>T(e)&&(n[e.title]===void 0||n[e.title]===null),q=(e,n)=>{let i=e,l=1;for(;n.find(r=>r.title===i);)i=`${e}_${l}`,l++;return i},$=e=>{let n;return typeof e=="object"?n=e.uidt:n=e,[t.LongText,t.SingleLineText,t.Number,t.PhoneNumber,t.Email,t.Decimal,t.Currency,t.Percent,t.Duration,t.JSON,t.URL,t.SpecificDBType].includes(n)},F=e=>{switch(e.uidt){case t.Formula:return!!e.colOptions.error;case t.Button:{const n=e.colOptions;if(n.type==="webhook")return!n.fk_webhook_id;if(n.type==="url")return!!n.error}}if(e.uidt===t.Formula)return!!e.colOptions.error},p=[{checked:"mdi-check-bold",unchecked:"mdi-crop-square"},{checked:"mdi-check-circle-outline",unchecked:"mdi-checkbox-blank-circle-outline"},{checked:"mdi-star",unchecked:"mdi-star-outline"},{checked:"mdi-heart",unchecked:"mdi-heart-outline"},{checked:"mdi-moon-full",unchecked:"mdi-moon-new"},{checked:"mdi-thumb-up",unchecked:"mdi-thumb-up-outline"},{checked:"mdi-flag",unchecked:"mdi-flag-outline"}],h=[{full:"mdi-star",empty:"mdi-star-outline"},{full:"mdi-heart",empty:"mdi-heart-outline"},{full:"mdi-moon-full",empty:"mdi-moon-new"},{full:"mdi-thumb-up",empty:"mdi-thumb-up-outline"},{full:"mdi-flag",empty:"mdi-flag-outline"}];function v(e=null){const n=g(e),i={checked:"mdi-check-circle-outline",unchecked:"mdi-checkbox-blank-circle-outline"};return n.icon?(i.checked=n.icon.checked||i.checked,i.unchecked=n.icon.unchecked||i.unchecked):typeof n.iconIdx=="number"&&p[n.iconIdx]&&(i.checked=p[n.iconIdx].checked,i.unchecked=p[n.iconIdx].unchecked),i}function G(e=null){const n=g(e),i={full:"mdi-star",empty:"mdi-star-outline"};return n.icon?(i.full=n.icon.full||i.full,i.empty=n.icon.empty||i.empty):typeof n.iconIdx=="number"&&h[n.iconIdx]&&(i.full=h[n.iconIdx].full,i.empty=h[n.iconIdx].empty),i}const x=e=>!(B(e)||j(e)||A(e)&&e===""||R(e)||O(e)),V=(e,n)=>{if(!e||!n)return null;const i=n.filter(l=>l.pk);if(i.length>1)return i.map(l=>{var r,u;return((u=(r=e==null?void 0:e[l.title])==null?void 0:r.toString)==null?void 0:u.call(r).replaceAll("_","\\_"))??null}).join("___");if(i.length){const l=(e==null?void 0:e[i[0].title])??null;return l===null?null:`${l}`}},J=(e,n)=>{const i={},l=n==null?void 0:n.filter(r=>r.pk);if(e&&l&&l.length)for(const r of l)r.title&&(i[r.title]=e[r.title]);return i},Q=e=>!e&&!Array.isArray(e)?null:e.filter(n=>n.pk).map(n=>n.title).join("___"),K=(e,n)=>{for(const[i,l]of Object.entries(n))if(Object.keys(e).every(r=>e[r]===l.row[r]))return parseInt(i);return-1};async function Y({getMeta:e,row:n,meta:i,ltarState:l,throwError:r,undo:u=!1}){var k;const a=new Set,D=await((k=i.columns)==null?void 0:k.reduce(async(_,o)=>{const s=await _;if(l&&o.uidt===t.LinkToAnotherRecord&&o.colOptions.type===b.BELONGS_TO&&l[o.title]){const m=o.colOptions,d=i.columns.find(f=>m.fk_child_column_id===f.id),y=await e(m.fk_related_model_id);y&&d&&(s[d.title]=l[o.title][y.columns.find(f=>f.id===m.fk_parent_column_id).title],a.delete(d.title))}return N(o,n)&&a.add(o.title),(!o.ai||u)&&(n==null?void 0:n[o.title])!==null&&(s[o.title]=n==null?void 0:n[o.title]),s},Promise.resolve({})));if(r&&a.size)throw new Error(`Missing required columns: ${[...a].join(", ")}`);return{missingRequiredColumns:a,insertObj:D}}const z=(e=[])=>e.reduce((i,l)=>{if(!C(l)&&!L(l)&&![t.Rollup,t.Lookup,t.Formula,t.Barcode,t.QrCode].includes(l.uidt)&&x(l==null?void 0:l.cdf)&&!/^\w+\(\)|CURRENT_TIMESTAMP$/.test(l.cdf)){const r=l.cdf;i[l.title]=typeof r=="string"?r.replace(/^'|'$/g,""):r}return i},{}),H=(e,n)=>{if(!e||!n)return!0;const i=e.row[n.title];return i==null||i===""?!0:Array.isArray(i)&&i.length===0};export{$ as a,U as b,N as c,A as d,V as e,z as f,M as g,K as h,x as i,Q as j,H as k,q as l,G as m,S as n,h as o,Y as p,v as q,J as r,p as s,F as t,P as u};
