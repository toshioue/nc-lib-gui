import{f as R,r as h,ai as D,i as ee,P as s,o as l,c as n,b as f,a as i,T as se,S,t as U,w as v,al as k,am as g,d as T,U as p,V,W as J,a7 as te,dh as le,hD as ae,aS as oe,a2 as re,A as ne,an as b,ao as L}from"./B2hUoZAs.js";import{_ as ie}from"./i4toF4kp.js";import"./BWYzyVlv.js";import{I as pe}from"./CwHJfKcC.js";import{F as ce}from"./By21eAqY.js";import{_ as ue}from"./kd0F6MQ0.js";import{_ as de}from"./pcWi62uI.js";import{_ as _e}from"./cvW-uYte.js";import"./BQQOEPN4.js";import"./C9qKCFvP.js";import"./BGKYJ52S.js";import"./fKrvpb1C.js";import"./1orNHd0L.js";const ye={key:0,class:"flex flex-row w-full justify-center items-center h-52"},fe={key:1,class:"flex flex-col"},ve={class:"w-full relative"},me={class:"flex flex-row justify-center pb-4 mb-2 border-b-1 w-full gap-x-1"},he=["alt","src"],ke={class:"font-semibold text-lg"},ge={class:"absolute -right-2 -top-0.5"},be={key:0,class:"flex flex-row justify-center"},xe={class:"text-center font-normal mb-2"},we={key:0,class:"text-red-600"},Ce={key:4,class:"absolute flex flex-col justify-start mt-2 -right-6 top-0"},Se=["colspan"],Ue={class:"flex flex-row space-x-4 justify-center mt-4"},Je=R({__name:"AppInstall",props:{id:{}},emits:["saved","close"],setup(N,{emit:E}){const $=E,{$api:x}=ne(),M=h(),{t:w}=D(),a=h(null),r=h({}),C=h(!0),y=h(null),z={labelCol:{span:14,pull:4},wrapperCol:{span:20,pull:4}},W=()=>r.value.push({}),G=async()=>{var o,u;y.value="save";try{await((o=M.value)==null?void 0:o.validateFields()),await x.plugin.update(N.id,{input:JSON.stringify(r.value),active:!0}),$("saved"),b.success(((u=a.value)==null?void 0:u.formDetails.msgOnInstall)||w("msg.success.pluginSettingsSaved"))}catch(m){b.error(await L(m))}finally{y.value=null}},H=async()=>{y.value="test";try{a.value&&(await x.plugin.test({input:JSON.stringify(r.value),title:a.value.title,category:a.value.category})?b.success(w("msg.success.pluginTested")):b.info(w("msg.info.invalidCredentials")))}catch(o){b.error(await L(o))}finally{y.value=null}},K=async o=>{switch(o){case"save":await G();break;case"test":await H();break}},Q=async()=>{try{C.value=!0;const o=await x.plugin.read(N.id),u=JSON.parse(o.input_schema??"{}"),m=u.array?[{}]:{},_=typeof o.input=="string"?JSON.parse(o.input):m;"secure"in _&&typeof _.secure=="string"&&(_.secure=_.secure==="true"),a.value={...o,formDetails:u,parsedInput:_},r.value=a.value.parsedInput}catch(o){console.log(o)}finally{C.value=!1}},X=o=>r.value.splice(o,1);return ee(async()=>{a.value||await Q()}),(o,u)=>{var I;const m=le,_=ae,q=oe,j=ue,B=ie,F=de,P=pe,A=_e,Y=re,Z=ce;return s(C)?(l(),n("div",ye,[f(m,{size:"large"})])):(l(),n("div",fe,[i("div",ve,[i("div",me,[s(a).logo?(l(),n("div",{key:0,class:se(["mr-1 flex items-center justify-center",[s(a).title==="SES"?"p-2 bg-[#242f3e]":""]])},[i("img",{alt:s(a).title||"plugin",src:s(a).logo,class:"h-6"},null,8,he)],2)):S("",!0),i("span",ke,U(s(a).formDetails.title),1)]),i("div",ge,[f(q,{type:"text",class:"!rounded-md mr-1",onClick:u[0]||(u[0]=e=>$("close"))},{icon:v(()=>[f(_,{class:"flex mx-auto"})]),_:1})])]),f(Z,te({ref_key:"formRef",ref:M},(I=s(a))!=null&&I.formDetails.array?{}:z,{model:s(r),class:"mx-4 mt-3"}),{default:v(()=>[s(a).formDetails.array?(l(),n("div",be,[i("table",null,[i("thead",null,[i("tr",null,[(l(!0),n(k,null,g(s(a).formDetails.items,(e,c)=>(l(),n("th",{key:c},[i("div",xe,[T(U(e.label)+" ",1),e.required?(l(),n("span",we,"*")):S("",!0)])]))),128))])]),i("tbody",null,[(l(!0),n(k,null,g(s(a).parsedInput,(e,c)=>(l(),n("tr",{key:c},[(l(!0),n(k,null,g(s(a).formDetails.items,(t,O)=>(l(),n("td",{key:O,class:"px-2"},[f(A,{class:"relative mb-3",name:[`${c}`,t.key],rules:[{required:t.required,message:`${t.label} is required`}]},{default:v(()=>[t.type==="Password"?(l(),p(j,{key:0,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):t.type==="LongText"?(l(),p(B,{key:1,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):t.type==="Checkbox"?(l(),p(F,{key:2,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):(l(),p(P,{key:3,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])),c!==0&&O===s(a).formDetails.items.length-1?(l(),n("div",Ce,[(l(),p(V(("iconMap"in o?o.iconMap:s(J)).delete),{class:"hover:text-red-400 cursor-pointer",onClick:d=>X(c)},null,8,["onClick"]))])):S("",!0)]),_:2},1032,["name","rules"])]))),128))]))),128))]),i("tr",null,[i("td",{colspan:s(a).formDetails.items.length,class:"text-center"},[f(q,{type:"default",class:"!bg-gray-100 rounded-md border-none mr-1",onClick:W},{icon:v(()=>[(l(),p(V(("iconMap"in o?o.iconMap:s(J)).plus),{class:"flex mx-auto"}))]),_:1})],8,Se)])])])):(l(!0),n(k,{key:1},g(s(a).formDetails.items,(e,c)=>(l(),p(A,{key:c,label:e.label,name:e.key,rules:[{required:e.required,message:`${e.label} is required`}]},{default:v(()=>[e.type==="Password"?(l(),p(j,{key:0,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="LongText"?(l(),p(B,{key:1,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="Checkbox"?(l(),p(F,{key:2,checked:s(r)[e.key],"onUpdate:checked":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["checked","onUpdate:checked","placeholder"])):(l(),p(P,{key:3,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label","name","rules"]))),128)),i("div",Ue,[(l(!0),n(k,null,g(s(a).formDetails.actions,(e,c)=>(l(),p(Y,{key:c,class:"!px-5",loading:s(y)===e.key,type:e.key==="save"?"primary":"default",disabled:!!s(y),onClick:t=>K(e.key)},{default:v(()=>[T(U(e.label),1)]),_:2},1032,["loading","type","disabled","onClick"]))),128))])]),_:1},16,["model"])]))}}});export{Je as default};
