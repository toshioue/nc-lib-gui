const __vite__fileDeps=["./4uFY_Pf0.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css","./DgdUBGGc.js","./D8rpj5Lr.js","./BcZAlRJW.js","./BQQOEPN4.js","./BohSct8s.js","./C8c9012h.js","./hvq8FVej.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as X,ai as Y,az as ee,cN as se,N as te,as as ae,r as g,g3 as _,g as k,i as oe,H as le,b1 as ie,o as r,S as p,w as i,a as s,P as a,c as u,t as n,T as j,V as w,W as U,b as l,a9 as ne,aq as re,av as ce,aa as de,gp as me,d as M,Z as ue,a6 as ve,aj as y,ak as pe,aV as fe,A as _e}from"./Cgw6cdOy.js";import{_ as ye}from"./S1x-kZdE.js";import{u as he}from"./DgdUBGGc.js";import{h as xe}from"./DCaZaUH5.js";import{u as be}from"./CnN16FGu.js";import{_ as ge}from"./CGa6nQ65.js";import{F as B}from"./DpYA1Dpy.js";import"./Bcy-XIkn.js";import{I as ke}from"./DPaOlBFV.js";import{_ as we}from"./CpJUN2HL.js";import{_ as Ue}from"./dmcxUY_0.js";import{S as Me,_ as $e}from"./D8rpj5Lr.js";import"./LSbsNkd9.js";import"./hvq8FVej.js";import"./C8c9012h.js";import"./BIsWr_mR.js";import"./BQQOEPN4.js";import"./BZz6iAla.js";import"./BcZAlRJW.js";import"./BohSct8s.js";const Ce=ue(()=>ve(()=>import("./4uFY_Pf0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url).then(c=>c.default||c)),Te={class:"flex flex-col p-6","data-testid":"invite-user-and-share-base-modal"},Ee={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 border-gray-100 w-full"},Re={key:0,class:"select-none font-medium"},Ie={class:"px-2 mt-1.5"},je={key:0,class:"flex flex-col mt-1 border-b-1 pb-5"},Be={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},Se=s("div",{class:"text-xs ml-0.5 mt-0.5"},"Copy Invite Token",-1),Ve={class:"flex flex-row justify-between items-center py-1"},Fe={class:"flex pl-2 text-green-700 text-xs","data-testid":"invite-modal-invitation-url"},Ne={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2"},ze={class:"flex flex-row justify-start mt-4 ml-2"},Ae={class:"flex flex-row justify-center items-center space-x-0.5"},De={class:"text-xs text-gray-600"},Pe={key:1,class:"flex flex-col pb-4"},Le={key:0,class:"flex flex-row items-center pl-2 pb-1 h-[1rem]"},qe={class:"text-xs ml-0.5 mt-0.5"},We={class:"border-1 py-3 px-4 rounded-md mt-1"},Oe={class:"flex flex-row space-x-4"},Ge={class:"flex flex-col w-3/4"},He={class:"ml-1 mb-1 text-xs text-gray-500"},Ke={class:"flex flex-col w-1/4"},Ze={class:"ml-1 mb-1 text-xs text-gray-500"},Je={class:"flex flex-row h-full justify-start items-center"},Qe={class:"flex flex-row justify-end"},Xe={key:0},Ye={key:1,class:"flex flex-row justify-center items-center space-x-1.5"},es={class:"flex"},ss={class:"flex flex-row justify-end gap-x-2 border-t-1 border-gray-100 pt-3"},ks=X({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(c,{emit:S}){const $=S,{t:f}=Y(),{base:v}=ee(se()),{isMobileMode:V}=te(),{$api:C,$e:h}=_e(),{copy:F}=ae(),{dashboardUrl:N}=he(),t=g({emails:void 0,role:_.VIEWER,invitationToken:void 0}),T=g(),z=B.useForm,A=k(()=>({emails:[xe]})),{validateInfos:D}=z(t.value,A);oe(()=>{var e;!t.value.emails&&((e=c.selectedUser)!=null&&e.email)&&(t.value.emails=c.selectedUser.email,t.value.role=c.selectedUser.roles)});const x=()=>{$("closed"),t.value={role:_.VIEWER}},P=async()=>{var e,d;if(h("a:user:invite",{role:t.value.role}),!!v.value.id){await((e=T.value)==null?void 0:e.validateFields());try{if((d=c.selectedUser)!=null&&d.id)await C.auth.baseUserUpdate(v.value.id,c.selectedUser.id,{roles:t.value.role,email:c.selectedUser.email,base_id:v.value.id,baseName:v.value.title}),x();else{const o=await C.auth.baseUserAdd(v.value.id,{roles:t.value.role,email:t.value.emails});t.value.invitationToken=o==null?void 0:o.invite_token}$("reload"),y.success(f("msg.success.userDetailsUpdated"))}catch(o){console.error(o),y.error(await pe(o))}}},b=k(()=>t.value.invitationToken?`${N.value}#/signup/${t.value.invitationToken}`:null),L=async()=>{if(b.value){try{await F(b.value),y.success(f("msg.success.shareableURLCopied"))}catch(e){y.error(e.message)}h("c:shared-base:copy-url")}},q=()=>{h("c:user:invite-more"),t.value.invitationToken=void 0,t.value.role=_.VIEWER,t.value.emails=void 0},E=g();return be(k(()=>c.show),e=>{e.key==="Escape"&&x()},{immediate:!0}),le(()=>c.show,async e=>{var d,o;e&&(await ie(),(o=(d=E.value)==null?void 0:d.$el)==null||o.focus())},{immediate:!0}),(e,d)=>{const o=fe,W=we,R=ge,O=ke,I=Ue,G=Me,H=$e,K=B,Z=Ce,J=ye;return r(),p(J,{centered:"",visible:e.show,onCancel:x},{default:i(()=>[s("div",Te,[s("div",Ee,[a(V)?j("",!0):(r(),u("div",Re,n(e.$t("activity.share")),1))]),s("div",Ie,[a(t).invitationToken?(r(),u("div",je,[s("div",Be,[(r(),p(w(("iconMap"in e?e.iconMap:a(U)).account))),Se]),l(W,{class:"mt-1",type:"success","show-icon":""},{message:i(()=>[s("div",Ve,[s("div",Fe,n(a(b)),1),l(o,{type:"text",class:"!rounded-md -mt-0.5",onClick:L},{icon:i(()=>[(r(),p(w(("iconMap"in e?e.iconMap:a(U)).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),s("div",Ne,n(e.$t("msg.info.userInviteNoSMTP"))+" "+n(a(t).invitationToken&&a(t).emails),1),s("div",ze,[l(o,{size:"small",outlined:"",onClick:q},{default:i(()=>[s("div",Ae,[l(R,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),s("div",De,n(e.$t("activity.inviteMore")),1)])]),_:1})])])):(r(),u("div",Pe,[e.selectedUser?(r(),u("div",Le,[(r(),p(w(("iconMap"in e?e.iconMap:a(U)).account))),s("div",qe,n(e.selectedUser?e.$t("activity.editUser"):e.$t("activity.inviteTeam")),1)])):j("",!0),l(K,{ref_key:"formRef",ref:T,"validate-on-rule-change":!1,model:a(t),"validate-trigger":"onBlur",onFinish:P},{default:i(()=>[s("div",We,[s("div",Oe,[s("div",Ge,[l(I,ne(a(D).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:a(f)("msg.plsInputEmail")}]}),{default:i(()=>[s("div",He,n(e.$t("datatype.Email"))+":",1),l(O,{ref_key:"emailField",ref:E,value:a(t).emails,"onUpdate:value":d[0]||(d[0]=m=>a(t).emails=m),size:"middle","validate-trigger":"onBlur",placeholder:e.$t("labels.email"),disabled:!!e.selectedUser},null,8,["value","placeholder","disabled"])]),_:1},16,["rules"])]),s("div",Ke,[l(I,{name:"role",rules:[{required:!0,message:a(f)("msg.roleRequired")}]},{default:i(()=>[s("div",Ze,n(e.$t("labels.selectUserRole")),1),l(H,{value:a(t).role,"onUpdate:value":d[1]||(d[1]=m=>a(t).role=m),size:"middle",class:"nc-user-roles !rounded-md","dropdown-class-name":"nc-dropdown-user-role"},{default:i(()=>[(r(!0),u(re,null,ce(a(_),(m,Q)=>(r(),p(G,{key:Q,value:m,class:"nc-role-option"},{default:i(()=>[s("div",Je,[s("div",{class:"px-3 py-1 flex rounded-full text-xs",style:de({backgroundColor:a(me)[m]})},n(m),5)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["rules"])])]),s("div",Qe,[l(o,{type:"primary","html-type":"submit",class:"!rounded-md"},{default:i(()=>[e.selectedUser?(r(),u("div",Xe,n(e.$t("general.save")),1)):(r(),u("div",Ye,[l(R,{class:"flex h-[0.8rem]"}),s("div",null,n(e.$t("activity.invite")),1)]))]),_:1})])])]),_:1},8,["model"])])),s("div",es,[l(Z)])]),s("div",ss,[l(o,{key:"back",class:"!rounded-md",onClick:e.cancel},{default:i(()=>[M(n(e.$t("general.cancel")),1)]),_:1},8,["onClick"]),l(o,{class:"!rounded-md"},{default:i(()=>[M("Manage base access")]),_:1}),l(o,{key:"submit",class:"!rounded-md",type:"primary",loading:e.loading},{default:i(()=>[M(n(e.$t("activity.share")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])}}});export{ks as default};
