import{_ as h}from"./CJBRTPd8.js";import{f as S,r as f,g as b,d7 as j,i as L,o as P,c as U,b as u,P as i,w as V,d as C,a0 as D}from"./Cgw6cdOy.js";import{a as N}from"./iEPEi51w.js";import"./D8rpj5Lr.js";import"./BcZAlRJW.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";import"./hvq8FVej.js";import"./DBOeGHNL.js";import"./C6pQ4eSP.js";import"./VVwMOds3.js";import"./Bxm040c6.js";import"./CiTH7PYd.js";import"./CO8XXsKl.js";import"./DFiWgQ57.js";import"./D7yS5JAk.js";import"./Bcy-XIkn.js";import"./DPaOlBFV.js";import"./BIsWr_mR.js";import"./BZz6iAla.js";import"./ahvdY77A.js";import"./C0xV_Bo1.js";import"./Dwil3It4.js";import"./OF3g5mdA.js";import"./tqKkZMzS.js";import"./CAuyt8bq.js";import"./DvfxijkH.js";import"./DCTaz0D2.js";import"./DzMG5wJt.js";import"./BK3iCpwL.js";import"./boyBAVNN.js";import"./CGpPc2co.js";import"./CevRfOSd.js";import"./CCkm5jiV.js";import"./BcpeJQoi.js";import"./DpOBhFIe.js";import"./vIgbYHAs.js";import"./DpDIhxXu.js";const R={class:"flex flex-col gap-2 p-2 border-1 rounded-lg"},ye=S({__name:"index",setup(T){const{extension:s,tables:m,getViewsForTable:w,getData:I}=N(),r=f([]),e=f({}),_=b(()=>m.value.map(t=>({label:t.title,value:t.id}))),x=b(()=>e.value.tableId?r.value.filter(t=>t.type===j.GRID).map(t=>({label:t.is_default?"Default":t.title,value:t.id}))||[]:[]),c=async()=>{e.value.tableId&&(r.value=await w(e.value.tableId))},y=async t=>{var o;e.value.tableId=t,await c(),e.value.viewId=(o=r.value.find(a=>a.is_default))==null?void 0:o.id,await s.value.kvStore.set("exportPayload",e.value)},g=async t=>{e.value.viewId=t,await s.value.kvStore.set("exportPayload",e.value)},k=async()=>{if(!e.value.tableId||!e.value.viewId)return;const t=[];I({tableId:e.value.tableId,viewId:e.value.viewId,eachPage:(o,a)=>{t.push(...o),a()},done:()=>{const o=JSON.stringify(t,null,2),a=new Blob([o],{type:"application/json"}),n=URL.createObjectURL(a),l=document.createElement("a"),v=m.value.find(d=>d.id===e.value.tableId),p=r.value.find(d=>d.id===e.value.viewId);v&&p?l.download=`${v.title} - ${p.is_default?"Default":p.title}.json`:l.download="data.json",l.href=n,l.click(),URL.revokeObjectURL(n)}})};return L(()=>{e.value=s.value.kvStore.get("exportPayload")||{},c()}),(t,o)=>{const a=h,n=D;return P(),U("div",R,[u(a,{value:i(e).tableId,"onUpdate:value":o[0]||(o[0]=l=>i(e).tableId=l),options:i(_),placeholder:"-select table-",onChange:y},null,8,["value","options"]),u(a,{value:i(e).viewId,"onUpdate:value":o[1]||(o[1]=l=>i(e).viewId=l),options:i(x),placeholder:"-select view-",onChange:g},null,8,["value","options"]),u(n,{onClick:k},{default:V(()=>[C("Export")]),_:1})])}}});export{ye as default};
