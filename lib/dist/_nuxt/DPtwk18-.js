import{f as Z,ba as me,bL as _,r as p,c$ as ee,d0 as te,g as V,cU as m,cV as se,hh as fe,fw as oe,fI as E,o,c as u,b as D,P as s,d1 as ve,g6 as _e,fC as he,N as be,as as Se,hC as ye,h9 as ge,H as ke,i as we,O as Ce,U as r,w as c,a as v,Y as k,al as x,am as X,R as O,t as I,V as L,W as M,S as U,Q as Y,X as Oe,iL as Ie,d as J,T as K,iQ as Le,a2 as Me,_ as Te}from"./nEPQs079.js";import{_ as $e}from"./DTSy8UbI.js";import{a as ne}from"./BfMXOlc4.js";import{u as ae}from"./B2IWgAhL.js";import{_ as xe}from"./BT21mFZ1.js";import{_ as Ue}from"./BLh6tVRa.js";import{_ as Ve}from"./CNqbIxb7.js";import{a as De}from"./vKaAFL5T.js";import{u as Ee}from"./BEYj_-yX.js";import{g as Ne}from"./tr4puWW3.js";import{S as Be}from"./CFgyk-dW.js";import"./q2KABjd6.js";import"./CBZqTOye.js";import"./BQDKbNwe.js";import"./-QMWbHL6.js";import"./C3R8onno.js";import"./BZvBjxVv.js";import"./BdIpmjdG.js";import"./ByzT15Y-.js";import"./BQQOEPN4.js";import"./COktFmkf.js";import"./DKtVUO_j.js";import"./DzMAdbS0.js";import"./QHUCxglU.js";import"./-Hb63wRq.js";import"./BTGvCRQH.js";import"./BLe4UTYD.js";const Re={class:"nc-sort-create-modal"},je=Z({__name:"CreateSort",props:{isParentOpen:{type:Boolean}},emits:["created"],setup(A,{emit:T}){const N=A,B=T,{isParentOpen:w}=me(N),R=_(ee,p()),j=_(te,p()),{showSystemFields:l,metaColumnById:h}=ne(),{sorts:$}=ae(R),F=V(()=>{var f,b;return((b=(f=j.value)==null?void 0:f.columns)==null?void 0:b.filter(n=>{var g;return n.uidt===m.Links?!0:se((g=h==null?void 0:h.value)==null?void 0:g[n.id])?fe(n)?!1:l.value:n.uidt===m.QrCode||n.uidt===m.Barcode||n.uidt===m.ID?!1:!(oe(n)&&![E.BELONGS_TO,E.ONE_TO_ONE].includes(n.colOptions.type))}).filter(n=>!$.value.find(g=>g.fk_column_id===n.id)))??[]}),P=f=>{B("created",f)};return(f,b)=>{const n=$e;return o(),u("div",Re,[D(n,{"is-parent-open":s(w),"search-input-placeholder":f.$t("msg.selectFieldToSort"),options:s(F),"toolbar-menu":"sort",onSelected:P},null,8,["is-parent-open","search-input-placeholder","options"])])}}}),Fe={class:"flex items-center gap-1"},Pe={class:"flex items-center gap-2"},ze={key:0,class:"text-capitalize !text-[13px] font-medium"},Ae={key:0,class:"bg-brand-50 text-brand-500 py-1 px-2 text-md rounded-md"},Qe={key:1,class:"pt-2 pb-2 pl-4 nc-filter-list max-h-[max(80vh,30rem)] min-w-102","data-testid":"nc-sorts-menu"},Ge={class:"w-full flex items-center justify-between gap-2"},We={class:"truncate flex-1"},He={class:"flex gap-1 items-center"},qe={key:1},Xe={class:"flex gap-1 items-center"},Ye=Z({__name:"SortListMenu",setup(A){const T=_(te,p()),N=_(ee,p()),B=_(ve,p(!1)),w=_(_e),R=_(he,p(!1)),{eventBus:j}=De(),{sorts:l,saveOrUpdate:h,loadSorts:$,addSort:F,deleteSort:P}=ae(N,()=>w==null?void 0:w.trigger()),{showSystemFields:f,metaColumnById:b}=ne(),n=p(!1),{isMobileMode:g}=be(),{getPlanLimit:ie}=Se(),Q=_(ye,p(!1));j.on(e=>{e===ge.SORT_RELOAD&&$()});const z=V(()=>{var e;return((e=T.value)==null?void 0:e.columns)||[]}),G=V(()=>z.value.reduce((e,t)=>(e[t.id]=t,e),{})),re=V(()=>{var e;return(e=z.value)==null?void 0:e.filter(t=>{var i;return t.uidt===m.Links?!0:se((i=b==null?void 0:b.value)==null?void 0:i[t.id])?f.value:t.uidt===m.QrCode||t.uidt===m.Barcode||t.uidt===m.ID?!1:!(oe(t)&&![E.BELONGS_TO,E.ONE_TO_ONE].includes(t.colOptions.type))}).filter(t=>!l.value.find(i=>i.fk_column_id===t.id))}),le=e=>{if(!e||!G.value[e])return"";const t=G.value[e];let i=t.uidt;return t.uidt===m.Formula&&(i=Le({formulaColumn:t})||i),i||""},S=p(!1);Ee(S);const W=e=>{F(!0,e);const t=l.value[l.value.length-1];h(t,l.value.length-1),n.value=!1};return ke(S,()=>{S.value||(n.value=!1)}),we(()=>{$()}),(e,t)=>{const i=Me,H=je,de=xe,ce=Be,ue=Ue,q=Ve,C=Ce("e");return o(),r(q,{visible:s(S),"onUpdate:visible":t[6]||(t[6]=a=>Y(S)?S.value=a:null),trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-sort-menu nc-toolbar-dropdown"},{overlay:c(()=>[s(l).length?(o(),u("div",Qe,[v("div",{class:"sort-grid max-h-120 nc-scrollbar-thin pr-4 my-2 py-1",onClick:t[2]||(t[2]=k(()=>{},["stop"]))},[(o(!0),u(x,null,X(s(l),(a,y)=>(o(),u(x,{key:y},[D(de,{modelValue:a.fk_column_id,"onUpdate:modelValue":[d=>a.fk_column_id=d,d=>s(h)(a,y)],class:"flex caption nc-sort-field-select w-44 flex-grow",columns:s(z),"is-sort":"",meta:s(T),onClick:t[0]||(t[0]=k(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns","meta"]),D(ue,{value:a.direction,"onUpdate:value":d=>a.direction=d,class:"shrink grow-0 nc-sort-dir-select",label:e.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir !rounded-lg",onClick:t[1]||(t[1]=k(()=>{},["stop"])),onSelect:d=>s(h)(a,y)},{default:c(()=>[(o(!0),u(x,null,X(("getSortDirectionOptions"in e?e.getSortDirectionOptions:s(Ne))(le(a.fk_column_id)),(d,pe)=>O((o(),r(ce,{key:pe,value:d.value},{default:c(()=>[v("div",Ge,[v("div",We,I(d.text),1),a.direction===d.value?(o(),r(L(("iconMap"in e?e.iconMap:s(M)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):U("",!0)])]),_:2},1032,["value"])),[[C,["c:sort:operation:select"]]])),128))]),_:2},1032,["value","onUpdate:value","label","onSelect"]),O((o(),r(i,{type:"text",size:"small",class:"nc-sort-item-remove-btn !max-w-8",onClick:k(d=>s(P)(a,y),["stop"])},{default:c(()=>[(o(),r(L(("iconMap"in e?e.iconMap:s(M)).deleteListItem)))]),_:2},1032,["onClick"])),[[C,["c:sort:delete"]]])],64))),128))]),s(re).length?(o(),r(q,{key:0,visible:s(n),"onUpdate:visible":t[5]||(t[5]=a=>Y(n)?n.value=a:null),trigger:["click"],"overlay-class-name":"nc-toolbar-dropdown"},{overlay:c(()=>[D(H,{"is-parent-open":s(n),onCreated:W},null,8,["is-parent-open"])]),default:c(()=>[("isEeUI"in e?e.isEeUI:s(Oe))&&!s(R)?(o(),u(x,{key:0},[s(l).length<s(ie)(s(Ie).SORT_LIMIT)?O((o(),r(i,{key:0,class:"!text-brand-500 mt-1 mb-2",type:"text",size:"small",onClick:t[3]||(t[3]=k(a=>n.value=!0,["stop"]))},{default:c(()=>[v("div",He,[(o(),r(L(("iconMap"in e?e.iconMap:s(M)).plus))),J(" "+I(e.$t("activity.addSort")),1)])]),_:1})),[[C,["c:sort:add"]]]):(o(),u("span",qe))],64)):O((o(),r(i,{key:1,class:"!text-brand-500 mt-1 mb-2",type:"text",size:"small",onClick:t[4]||(t[4]=k(a=>n.value=!0,["stop"]))},{default:c(()=>[v("div",Xe,[(o(),r(L(("iconMap"in e?e.iconMap:s(M)).plus))),J(" "+I(e.$t("activity.addSort")),1)])]),_:1})),[[C,["c:sort:add"]]])]),_:1},8,["visible"])):U("",!0)])):(o(),r(H,{key:0,"is-parent-open":s(S),onCreated:W},null,8,["is-parent-open"]))]),default:c(()=>{var a;return[v("div",{class:K({"nc-active-btn":(a=s(l))==null?void 0:a.length})},[O((o(),r(i,{class:K([{"!border-1 !rounded-md":s(Q),"!border-0":!s(Q)},"nc-sort-menu-btn nc-toolbar-btn !h-7"]),disabled:s(B),size:"small",type:"secondary"},{default:c(()=>{var y;return[v("div",Fe,[v("div",Pe,[(o(),r(L(("iconMap"in e?e.iconMap:s(M)).sort),{class:"h-4 w-4 text-inherit"})),s(g)?U("",!0):(o(),u("span",ze,I(e.$t("activity.sort")),1))]),(y=s(l))!=null&&y.length?(o(),u("span",Ae,I(s(l).length),1)):U("",!0)])]}),_:1},8,["class","disabled"])),[[C,["c:sort"]]])],2)]}),_:1},8,["visible"])}}}),Ct=Te(Ye,[["__scopeId","data-v-1203381d"]]);export{Ct as default};
