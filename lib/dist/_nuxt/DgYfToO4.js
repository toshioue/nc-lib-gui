import{f as J,bL as u,r as m,fC as R,h6 as X,cB as G,at as h,d0 as O,c$ as P,cG as q,O as T,o,c as x,a as U,t as _,b as F,w as $,R as g,Y as W,P as a,h7 as i,U as v,V as A,W as N,d as M,al as Y,g3 as z,an as H,ao as K,aG as Q,a9 as Z,A as ee}from"./nEPQs079.js";import{F as se}from"./y_jQo2Jw.js";import{read as ae,writeFile as te}from"./CcZku21G.js";const oe={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},ce=J({__name:"ExportSubActions",setup(ie){const B=u(R,m(!1)),y=u(X,m([])),L=G(),{base:j}=h(L),{$api:D}=ee(),f=u(O,m()),w=u(P),{activeNestedFilters:b,activeSorts:E}=h(q()),n=m(void 0),S=async e=>{var c,p,C,V;let s=0,r=1;const l=e===i.EXCEL?"base64":"blob";n.value=e;try{for(;!isNaN(s)&&s>-1;){let d;if(B.value){const{exportFile:t}=z();d=await t(y.value,s,e,l,{sortsArr:E.value,filtersArr:b.value})}else d=await D.dbViewRow.export("noco",(c=j.value)==null?void 0:c.id,(p=f.value)==null?void 0:p.id,w==null?void 0:w.value.id,e,{responseType:l,query:{fields:y.value.map(t=>t.title),offset:s,sortArrJson:JSON.stringify(E.value),filterArrJson:JSON.stringify(b.value)}});const{data:k,headers:I}=d;if(e===i.EXCEL){const t=ae(k,{type:"base64"});te(t,`${(C=f.value)==null?void 0:C.title}_exported_${r++}.xlsx`)}else if(e===i.CSV){const t=new Blob([k],{type:"text/plain;charset=utf-8"});se.saveAs(t,`${(V=f.value)==null?void 0:V.title}_exported_${r++}.csv`)}s=+I["nc-export-offset"],setTimeout(()=>{n.value=void 0},200)}}catch(d){n.value=void 0,H.error(await K(d))}};return(e,s)=>{const r=Q,l=Z,c=T("e");return o(),x(Y,null,[U("div",oe,_(e.$t("labels.downloadData")),1),F(l,{class:"!mx-1 !py-2 !rounded-md"},{default:$(()=>[g((o(),x("div",{class:"flex flex-row items-center nc-base-menu-item !py-0",onClick:s[0]||(s[0]=W(p=>S(a(i).CSV),["stop"]))},[a(n)===a(i).CSV?(o(),v(r,{key:0,class:"!max-h-4.5 !-mt-1 !mr-0.7"})):(o(),v(A(("iconMap"in e?e.iconMap:a(N)).csv),{key:1})),M(" "+_(e.$t("activity.downloadCSV")),1)])),[[c,["a:download:csv"]]])]),_:1}),F(l,{class:"!mx-1 !py-2 !rounded-md"},{default:$(()=>[g((o(),x("div",{class:"flex flex-row items-center nc-base-menu-item !py-0",onClick:s[1]||(s[1]=p=>S(a(i).EXCEL))},[a(n)===a(i).EXCEL?(o(),v(r,{key:0,class:"!max-h-4.5 !-mt-1 !mr-0.7"})):(o(),v(A(("iconMap"in e?e.iconMap:a(N)).excel),{key:1})),M(" "+_(e.$t("activity.downloadExcel")),1)])),[[c,["a:download:excel"]]])]),_:1})],64)}}});export{ce as default};
