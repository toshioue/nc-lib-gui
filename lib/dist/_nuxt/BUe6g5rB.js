const __vite__fileDeps=["./DiWlI-Tv.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css","./Header.x-GI6b6n.css","./CM0ap5yD.js","./BcWX645D.js","./C00NHga8.js","./D7yS5JAk.js","./SnuQkHMZ.js","./ListItem.-o3YFXe-.css","./C1WkfNyL.js","./DBOeGHNL.js","./MenuItem.C7h59s4s.css","./C6pQ4eSP.js","./VVwMOds3.js","./Divider.DqtSqZhb.css","./Bxm040c6.js","./Menu.CQ8GNWeI.css","./CiTH7PYd.js","./H9SMaBKT.js","./DivDataCell.1yCNpUg3.css","./Do1LnTan.js","./UserIcon.DEVmGavY.css","./DRVKgtZT.js","./Cw6_lRNR.js","./Badge.D0-UrqG9.css","./DGBAbsZ-.js","./Cy50pBgZ.js","./Bcy-XIkn.js","./DPaOlBFV.js","./BQQOEPN4.js","./hvq8FVej.js","./C8c9012h.js","./BIsWr_mR.js","./BZz6iAla.js","./links.C8uCzV-l.css","./Dwil3It4.js","./DgdUBGGc.js","./DzMG5wJt.js","./DvfxijkH.js","./BtFqRdSP.js","./CO8XXsKl.js","./BPivYv4D.js","./r2PN1Hfg.js","./vIgbYHAs.js","./DpDIhxXu.js","./boyBAVNN.js","./BK3iCpwL.js","./DFiWgQ57.js","./CAuyt8bq.js","./Tabs.DaLSLYpn.css","./WttlrBnq.js","./S1x-kZdE.js","./DeleteModal.SEMJ_gSK.css","./CpJUN2HL.js","./BcpeJQoi.js","./CnN16FGu.js","./ahvdY77A.js","./cCmEAZwU.js","./CHLXm8Ls.js","./index.MCJqUXFi.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as tt,ad as ot,N as at,bN as E,fQ as st,az as nt,cN as lt,r as L,ai as rt,L as it,dB as dt,aF as ut,hQ as ct,dK as Ie,ic as pt,gD as mt,g as K,H as V,fs as Ee,fR as P,ig as Se,i as ft,cC as vt,O as _t,o as n,c as p,a as v,b as h,T as C,w as Q,P as o,Y as B,aq as D,av as Y,S as N,aL as H,t as G,R as yt,d as ht,Q as kt,dI as wt,U as gt,Z as J,a6 as W,n as Z,aj as xt,$ as bt,a0 as Lt,hh as Ce,d3 as Rt,A as It,_ as Et}from"./Cgw6cdOy.js";import{_ as St}from"./CZSp73nk.js";import{a as Ct}from"./BStsc-2E.js";import{a as Nt}from"./r2PN1Hfg.js";import{i as Ne,D as Ot}from"./BBXMuneh.js";import{e as zt}from"./D7yS5JAk.js";import{_ as At}from"./BS-JicVa.js";import{I as Tt}from"./DnXfnYY7.js";import"./Bcy-XIkn.js";import{I as Vt}from"./DPaOlBFV.js";import{S as Pt}from"./JRGWYtLw.js";import{S as Bt}from"./cCmEAZwU.js";import"./D8rpj5Lr.js";import"./BcZAlRJW.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";import"./hvq8FVej.js";import"./CO8XXsKl.js";import"./MA4kh5_N.js";import"./vIgbYHAs.js";import"./DpDIhxXu.js";import"./boyBAVNN.js";import"./B1jnz4_u.js";import"./DCaZaUH5.js";import"./DpYA1Dpy.js";import"./dmcxUY_0.js";import"./LSbsNkd9.js";import"./BIsWr_mR.js";import"./BZz6iAla.js";import"./CHLXm8Ls.js";const Dt=J(()=>W(()=>import("./DiWlI-Tv.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(_=>_.default||_)),Ft=J(()=>W(()=>import("./CM0ap5yD.js"),__vite__mapDeps([4,1,2,5,6,7,8,9]),import.meta.url).then(_=>_.default||_)),Ut=J(()=>W(()=>import("./C1WkfNyL.js"),__vite__mapDeps([10,1,2,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,7,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]),import.meta.url).then(_=>_.default||_)),Mt={class:"flex flex-col h-full"},$t={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},jt={class:"flex-1 gap-2 flex items-center"},qt={class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center py-0.5 rounded-md"},Kt={class:"flex-1 overflow-auto nc-scrollbar-thin"},Qt={class:"flex items-center"},Yt={class:"flex flex-col gap-2 flex-grow justify-center"},Ht={class:"flex flex-row gap-6 w-10/12"},Gt={key:1,class:"h-full my-auto py-2 flex flex-col gap-3 items-center justify-center text-gray-500"},Zt={key:0},Jt={key:1},Wt={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between min-h-11"},Xt={class:"flex"},eo={class:"flex items-center gap-1"},to={key:0,class:"flex items-center"},oo={key:1,class:"flex items-center"},ao=tt({__name:"UnLinkedItems",props:{modelValue:{type:Boolean},column:{},hideBackBtn:{type:Boolean}},emits:["update:modelValue","addNewRecord","attachLinkedRecord"],setup(_,{emit:Oe}){const ze=_,X=Oe,O=ot(ze,"modelValue",X),{isMobileMode:F}=at(),i=E(st),{isSharedBase:Ae}=nt(lt()),R=L(),{t:ee}=rt(),{$e:te}=It(),{isDataReadOnly:Te}=it(),{childrenExcludedList:I,isChildrenExcludedListLinked:x,childrenExcludedOffsetCount:Ve,childrenListOffsetCount:Pe,isChildrenExcludedListLoading:Be,isChildrenExcludedLoading:oe,childrenListCount:De,loadChildrenExcludedList:ae,loadChildrenList:se,childrenExcludedListPagination:l,relatedTableDisplayValueProp:ne,displayValueTypeAndFormatProp:Fe,link:Ue,relatedTableMeta:m,meta:le,unlink:Me,row:k,resetChildrenExcludedOffsetCount:U}=Ct(),{addLTARRef:re,isNew:z,removeLTARRef:$e,state:A}=Nt(),ie=E(dt,L(!1)),T=L(!1);oe.value=!0;const M=E(ut,L(!1)),de=E(ct,()=>{}),$=E(pt,Ie()),j=E(mt,Ie()),b=K(()=>{var t,e;return(e=(t=i.value)==null?void 0:t.colOptions)==null?void 0:e.type}),je=async(t,e)=>{z.value?(re(t,i==null?void 0:i.value),b.value==="oo"||b.value==="bt"?x.value.forEach((s,r)=>{s&&(x.value[r]=!1),e===r&&(x.value[r]=!0)}):x.value[e]=!0,de(),te("a:links:link")):await Ue(t,{},!1,e)},qe=async(t,e)=>{z.value?($e(t,i==null?void 0:i.value),x.value[e]=!1,de(),te("a:links:unlink")):await Me(t,{},!1,e)};V(O,(t,e)=>{t&&!e&&(l.query="",l.page=1,M.value||se(),ae(A.value,!0)),t||U()},{immediate:!0});const w=L(!1),S=L({}),Ke=K(()=>{var r,u,y,f;if(z.value)return{};const t=(r=i==null?void 0:i.value)==null?void 0:r.colOptions,e=(y=(u=m==null?void 0:m.value)==null?void 0:u.columns)==null?void 0:y.find(g=>{if(!Ee(g))return!1;const d=g==null?void 0:g.colOptions;return(d==null?void 0:d.fk_related_model_id)!==le.value.id?!1:t.type===P.MANY_TO_MANY&&(d==null?void 0:d.type)===P.MANY_TO_MANY?t.fk_parent_column_id===d.fk_child_column_id&&t.fk_child_column_id===d.fk_parent_column_id:t.fk_parent_column_id===d.fk_parent_column_id&&t.fk_child_column_id===d.fk_child_column_id});if(!e)return{};const s=e==null?void 0:e.colOptions;return s?s.type===P.BELONGS_TO||s.type===P.ONE_TO_ONE?{[e.title]:(f=k==null?void 0:k.value)==null?void 0:f.row}:{[e.title]:(k==null?void 0:k.value)&&[k.value.row]}:{}}),Qe=Se(Ce,t=>(m.value.columns??[]).filter(e=>Ne(e))[0]),Ye=Se(Ce,t=>(m.value.columns??[]).filter(e=>!Rt(e)&&!Ot(e)&&!Ee(e)&&!Ne(e)).sort((e,s)=>{var r,u;return(((r=e.meta)==null?void 0:r.defaultViewColOrder)??1/0)-(((u=s.meta)==null?void 0:u.defaultViewColOrder)??1/0)}).slice(0,F.value?1:3)),He=K(()=>{var t,e,s,r,u,y,f,g,d;return M.value||z.value?b.value==="bt"||b.value==="oo"?(e=A.value)!=null&&e[(t=i.value)==null?void 0:t.title]?1:0:((u=(r=A.value)==null?void 0:r[(s=i.value)==null?void 0:s.title])==null?void 0:u.length)??0:b.value==="bt"?(f=k.value)!=null&&f.row[(y=m.value)==null?void 0:y.title]?1:0:b.value==="oo"?(d=k.value)!=null&&d.row[(g=i.value)==null?void 0:g.title]?1:0:De.value??0});V(w,()=>{w.value||(T.value=!1,M.value||se(),ae(A.value)),Ve.value=0,Pe.value=0}),V(R,()=>{var t;(t=R.value)==null||t.focus()});const q=(t,e)=>{Ae.value||(x.value[Number.parseInt(e)]?qe(t,Number.parseInt(e)):je(t,Number.parseInt(e)))},Ge=()=>{S.value={},w.value=!0,T.value=!0},Ze=t=>{var s;re(t,i==null?void 0:i.value),$==null||$.trigger({shouldShowLoading:!1}),j==null||j.trigger({shouldShowLoading:!1});const e=Z("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[Z("span",{class:"font-semibold"},ee("activity.recordCreatedLinked")),Z("span",{class:"text-gray-500"},ee("activity.gotSavedLinkedSuccessfully",{tableName:(s=m.value)==null?void 0:s.title,recordTitle:t[ne.value]}))]);xt.success(e),O.value=!1},ue=t=>{var e,s,r,u,y;if(t.key==="Escape")O.value=!1;else if(t.key==="ArrowDown"){t.preventDefault();try{(s=(e=t.target)==null?void 0:e.nextElementSibling)==null||s.focus()}catch{}}else if(t.key==="ArrowUp"){t.preventDefault();try{(u=(r=t.target)==null?void 0:r.previousElementSibling)==null||u.focus()}catch{}}else if(!w.value&&t.key!=="Tab"&&t.key!=="Shift"&&t.key!=="Enter"&&t.key!==" ")try{(y=R.value)==null||y.focus()}catch{}},ce=L();V(l,()=>{var t;(t=ce.value)==null||t.scrollTo({top:0,behavior:"smooth"})}),ft(()=>{window.addEventListener("keydown",ue),setTimeout(()=>{var t;(t=R.value)==null||t.focus()},100)}),vt(()=>{U(),l.query="",window.removeEventListener("keydown",ue)});const Je=()=>{l.page=1,U()};return(t,e)=>{var me,fe,ve,_e,ye,he,ke,we,ge,xe,be,Le;const s=bt,r=Vt,u=Dt,y=Pt,f=Bt,g=Ft,d=At,We=Lt,pe=St,Xe=Ut,et=_t("e");return n(),p("div",{class:gt(["nc-modal-link-record h-full w-full overflow-hidden",{active:o(O)}]),onKeydown:e[8]||(e[8]=H(B(()=>{},["stop"]),["enter"]))},[v("div",Mt,[v("div",$t,[v("div",jt,[t.hideBackBtn?C("",!0):(n(),p("button",{key:0,class:"!text-brand-500 hover:!text-brand-700 p-1.5 flex",onClick:e[0]||(e[0]=a=>X("attachLinkedRecord"))},[h(s,{icon:"ncArrowLeft",class:"flex-none h-4 w-4"})])),v("div",qt,[h(r,{ref_key:"filterQueryRef",ref:R,value:o(l).query,"onUpdate:value":e[1]||(e[1]=a=>o(l).query=a),bordered:!1,placeholder:"Search records to link...",class:"w-full nc-excluded-search min-h-4 !pl-0",size:"small",onChange:Je,onKeydownCapture:e[2]||(e[2]=B(a=>{var c;a.key==="Escape"&&((c=o(R))==null||c.blur())},["stop"]))},{prefix:Q(()=>[h(s,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"])])]),h(u,{"data-testid":"nc-link-count-info","linked-records":o(He),"related-table-title":(me=o(m))==null?void 0:me.title,relation:o(b),"table-title":(fe=o(le))==null?void 0:fe.title},null,8,["linked-records","related-table-title","relation","table-title"])]),v("div",Kt,[(_e=(ve=o(I))==null?void 0:ve.pageInfo)!=null&&_e.totalRows?(n(),p("div",{key:0,ref_key:"childrenExcludedListRef",ref:ce},[o(oe)?(n(!0),p(D,{key:0},Y(Array.from({length:10}),(a,c)=>(n(),p("div",{key:c,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:bg-gray-50"},[v("div",Qt,[h(y,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),v("div",Yt,[h(f,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),v("div",Ht,[(n(),p(D,null,Y([1,2,3],Re=>h(f,{key:Re,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(n(!0),p(D,{key:1},Y(((ye=o(I))==null?void 0:ye.list)??[],(a,c)=>(n(),N(g,{key:c,attachment:o(Qe),"display-value-type-and-format-prop":o(Fe),fields:o(Ye),"is-linked":o(x)[Number.parseInt(c)],"is-loading":o(Be)[Number.parseInt(c)],"related-table-display-value-prop":o(ne),row:a,"data-testid":"nc-excluded-list-item",onLinkOrUnlink:Re=>q(a,c),onExpand:()=>{S.value=a,w.value=!0},onKeydown:[H(B(()=>q(a,c),["prevent","stop"]),["space"]),H(B(()=>q(a,c),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"]))),128))],512)):(n(),p("div",Gt,[h(o(Tt),{class:"w-16 h-16 mx-auto"}),o(l).query?(n(),p("p",Zt,G(t.$t("msg.noRecordsMatchYourSearchQuery")),1)):(n(),p("p",Jt,G(t.$t("msg.noRecordsAvailForLinking")),1))]))]),v("div",Wt,[v("div",Xt,[!o(ie)&&!o(Te)?yt((n(),N(We,{key:0,size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",onClick:Ge},{default:Q(()=>[v("div",eo,[o(F)?C("",!0):(n(),N(d,{key:0})),ht(" "+G(t.$t("activity.newRecord")),1)])]),_:1})),[[et,["c:row-expand:open"]]]):C("",!0)]),(he=o(I))!=null&&he.pageInfo&&+((we=(ke=o(I))==null?void 0:ke.pageInfo)==null?void 0:we.totalRows)>o(l).size?(n(),p(D,{key:0},[o(F)?(n(),p("div",to,[h(pe,{current:o(l).page,"onUpdate:current":e[3]||(e[3]=a=>o(l).page=a),"page-size":o(l).size,"onUpdate:pageSize":e[4]||(e[4]=a=>o(l).size=a),total:+((xe=(ge=o(I))==null?void 0:ge.pageInfo)==null?void 0:xe.totalRows),"entity-name":"links-excluded-list"},null,8,["current","page-size","total"])])):(n(),p("div",oo,[h(pe,{current:o(l).page,"onUpdate:current":e[5]||(e[5]=a=>o(l).page=a),"page-size":o(l).size,"onUpdate:pageSize":e[6]||(e[6]=a=>o(l).size=a),total:+((Le=(be=o(I))==null?void 0:be.pageInfo)==null?void 0:Le.totalRows),"entity-name":"links-excluded-list",mode:"simple"},null,8,["current","page-size","total"])]))],64)):C("",!0)])]),(n(),N(wt,null,{default:Q(()=>{var a;return[o(w)?(n(),N(Xe,{key:0,modelValue:o(w),"onUpdate:modelValue":e[7]||(e[7]=c=>kt(w)?w.value=c:null),"load-row":!o(ie),"close-after-save":o(T),meta:o(m),"new-record-header":o(T)?t.$t("activity.tableNameCreateNewRecord",{tableName:(a=o(m))==null?void 0:a.title}):void 0,row:{row:o(S),oldRow:{},rowMeta:Object.keys(o(S)).length>0?{}:{new:!0}},"row-id":("extractPkFromRow"in t?t.extractPkFromRow:o(zt))(o(S),o(m).columns),state:o(Ke),"use-meta-fields":"","maintain-default-view-order":"","skip-reload":!0,"new-record-submit-btn-text":"Create & Link",onCreatedRecord:Ze},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","row-id","state"])):C("",!0)]}),_:1}))],34)}}}),Po=Et(ao,[["__scopeId","data-v-94dad90b"]]);export{Po as default};
