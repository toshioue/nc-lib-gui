import{f as le,ai as ne,at as A,cB as oe,bL as ie,r as _,gS as ce,g as $,au as re,N as me,i as ue,o as s,c as r,a as l,b as o,w as n,d as b,t as a,P as i,U as y,V as C,W as I,Q as de,T as S,al as R,ak as U,S as M,am as pe,an as z,ao as _e,n as fe,ap as ve,aS as he,a2 as be,c_ as ye,a1 as we,A as ge}from"./DKhUGBot.js";import{_ as ke}from"./CzZu0lNg.js";import{_ as xe}from"./Cx8Z_l6r.js";import"./Cz8K5PX4.js";import{I as $e}from"./GPQ-Eg6I.js";import{_ as Ce}from"./D6MTqk13.js";import"./BqRqK2Ui.js";import"./CNjr3NNT.js";import"./CUg8TjpL.js";import"./BOlDoh1A.js";import"./BpnlUwoJ.js";import"./BQQOEPN4.js";import"./CxxuE4Yq.js";import"./B0emH2s-.js";import"./DPW1f6my.js";import"./D_FwWME_.js";import"./CX4Cv_ut.js";import"./DEJjMRn_.js";import"./DX_5E9FR.js";import"./gHfFefeo.js";import"./Qczbj6zB.js";import"./G7I_n9Op.js";const Ie={class:"h-full flex flex-row w-full items-center justify-center"},Me={class:"h-full flex flex-col"},Ne={class:"flex flex-row items-center w-full mb-4 gap-2 justify-between"},Te={class:"flex"},je={class:"flex items-center gap-2 text-gray-600 font-light"},Le={class:"flex flex-row items-center w-full gap-x-1"},Ve={class:"flex"},Be={class:"h-auto max-h-[calc(100%_-_102px)] overflow-y-auto nc-scrollbar-thin"},Ee={key:0,class:"flex flex-row gap-x-1"},Ae={class:"flex capitalize"},Se={key:0},Re={class:"flex items-center gap-1"},Ue={class:"min-w-5 flex items-center justify-center"},ze={key:1},De={class:"flex items-center gap-1"},Ge={class:"min-w-5 flex items-center justify-center"},Pe={key:0},Fe={key:0},He={key:1},_t=le({__name:"UIAcl",props:{sourceId:{}},setup(D){const G=D,{t:d}=ne(),{$api:N,$e:P}=ge(),{base:F}=A(oe()),H=ie(ce,_()),f=$(()=>{var e;return H.value??((e=F.value)==null?void 0:e.id)}),{bases:Q}=A(re()),T=$(()=>Q.value.get(f.value)??{}),{includeM2M:W}=me(),j=_(["editor","commenter","viewer"]),w=_(!1),g=_([]),v=_(""),p=_({editor:!1,commenter:!1,viewer:!1}),k=$(()=>g.value.filter(e=>(e==null?void 0:e.source_id)===G.sourceId&&(typeof(e==null?void 0:e._ptn)=="string"&&e._ptn.toLowerCase().includes(v.value.toLowerCase())||typeof(e==null?void 0:e.title)=="string"&&e.title.toLowerCase().includes(v.value.toLowerCase()))));async function L(){try{if(!f.value)return;w.value=!0,g.value=await N.base.modelVisibilityList(f.value,{includeM2M:W.value})}catch(e){console.error(e)}finally{w.value=!1}}async function q(){try{if(!f.value)return;await N.base.modelVisibilitySet(f.value,g.value.filter(e=>e.edited)),z.success(d("msg.success.updatedUIACL"))}catch(e){z.error(await _e(e))}P("a:proj-meta:ui-acl")}const J=(e,c)=>{e.disabled[c]=!e.disabled[c],e.edited=!0,p.value[c]=k.value.every(m=>!m.disabled[c])};ue(async()=>{g.value.length===0&&await L();for(const e of j.value)p.value[e]=k.value.every(c=>!c.disabled[e])});const h=e=>()=>fe("div",{class:"text-gray-500"},e),K=[{title:h(d("labels.tableName")),name:"Table Name"},{title:h(d("labels.viewName")),name:"View Name"},{title:h(d("objects.roleType.editor")),name:"editor",width:120},{title:h(d("objects.roleType.commenter")),name:"commenter",width:120},{title:h(d("objects.roleType.viewer")),name:"viewer",width:120}],O=e=>{p.value[e]=!p.value[e];const c=p.value[e];k.value.forEach(m=>{m.disabled[e]=!c,m.edited=!0})};return(e,c)=>{const m=ve,X=$e,Y=he,Z=be,V=ke,ee=U,B=xe,te=ye,ae=we,se=Ce;return s(),r("div",Ie,[l("div",Me,[o(m,{class:"mb-4 first-letter:capital font-bold max-w-100 truncate","show-on-truncate-only":""},{title:n(()=>[b(a(i(T).title),1)]),default:n(()=>[l("span",null," UI ACL : "+a(i(T).title),1)]),_:1}),l("div",Ne,[o(X,{value:i(v),"onUpdate:value":c[0]||(c[0]=t=>de(v)?v.value=t:null),placeholder:e.$t("placeholder.searchModels"),class:"nc-acl-search !w-[400px]"},{prefix:n(()=>[(s(),y(C(("iconMap"in e?e.iconMap:i(I)).search)))]),_:1},8,["value","placeholder"]),l("div",Te,[o(Y,{type:"text",ghost:"",class:"self-start !rounded-md nc-acl-reload",onClick:L},{default:n(()=>[l("div",je,[(s(),y(C(("iconMap"in e?e.iconMap:i(I)).reload),{class:S({"animate-infinite animate-spin !text-success":i(w)})},null,8,["class"])),b(" "+a(e.$t("general.reload")),1)])]),_:1}),o(Z,{size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:q},{default:n(()=>[l("div",Le,[(s(),y(C(("iconMap"in e?e.iconMap:i(I)).save))),l("div",Ve,a(e.$t("general.save")),1)])]),_:1})])]),l("div",Be,[o(se,{class:"w-full",size:"small","data-source":i(k),columns:K,pagination:!1,loading:i(w),sticky:"",bordered:"","custom-row":t=>({class:`nc-acl-table-row nc-acl-table-row-${t.title}`})},{headerCell:n(({column:t})=>[["editor","commenter","viewer"].includes(t.name)?(s(),r("div",Ee,[o(V,{checked:i(p)[t.name],onChange:()=>O(t.name)},null,8,["checked","onChange"]),l("div",Ae,a(t.name),1)])):(s(),r(R,{key:1},[b(a(t.name),1)],64))]),emptyText:n(()=>[o(ee,{image:("Empty"in e?e.Empty:i(U)).PRESENTED_IMAGE_SIMPLE,description:e.$t("labels.noData")},null,8,["image","description"])]),bodyCell:n(({record:t,column:x})=>{var E;return[x.name==="Table Name"?(s(),r("div",Se,[l("div",Re,[l("div",Ue,[o(B,{meta:{meta:t.table_meta,type:t.ptype},class:"text-gray-500"},null,8,["meta"])]),o(m,{class:"overflow-ellipsis min-w-0 shrink-1 truncate","show-on-truncate-only":""},{title:n(()=>[b(a(t._ptn),1)]),default:n(()=>[l("span",null,a(t._ptn),1)]),_:2},1024)])])):M("",!0),x.name==="View Name"?(s(),r("div",ze,[l("div",De,[l("div",Ge,[(E=t==null?void 0:t.meta)!=null&&E.icon?(s(),y(B,{key:0,meta:{meta:t.meta,type:"view"},class:"text-gray-500 !text-sm !children:w-5 !children:h-5"},null,8,["meta"])):(s(),y(te,{key:1,meta:t,class:"text-gray-500"},null,8,["meta"]))]),o(m,{class:"overflow-ellipsis min-w-0 shrink-1 truncate","show-on-truncate-only":""},{title:n(()=>[b(a(t.is_default?e.$t("title.defaultView"):t.title),1)]),default:n(()=>[l("span",null,a(t.is_default?e.$t("title.defaultView"):t.title),1)]),_:2},1024)])])):M("",!0),(s(!0),r(R,null,pe(i(j),u=>(s(),r("div",{key:u},[x.name===u?(s(),r("div",Pe,[o(ae,null,{title:n(()=>[t.disabled[u]?(s(),r("span",Fe,a(e.$t("labels.clickToMake"))+" '"+a(t.title)+"' "+a(e.$t("labels.visibleForRole"))+" "+a(u)+" "+a(e.$t("labels.inUI"))+" dashboard",1)):(s(),r("span",He,a(e.$t("labels.clickToHide"))+"'"+a(t.title)+"' "+a(e.$t("labels.forRole"))+":"+a(u)+" "+a(e.$t("labels.inUI")),1))]),default:n(()=>[o(V,{checked:!t.disabled[u],class:S(`nc-acl-${t.title}-${u}-chkbox !ml-0.25`),onChange:Qe=>J(t,u)},null,8,["checked","class","onChange"])]),_:2},1024)])):M("",!0)]))),128))]}),_:1},8,["data-source","loading","custom-row"])])])])}}});export{_t as default};
