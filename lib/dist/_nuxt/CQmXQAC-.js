const __vite__fileDeps=["./D_AnMzhu.js","./BtLb9F6G.js","./hZgTYrdl.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./ByVBARmO.js","./37hePIet.js","./C4K5fdHe.js","./DnSVh-oD.js","./D_MsYLkT.js","./BCJFTkwv.js","./BQQOEPN4.js","./CB1aB6F1.js","./B5RRVMt5.js","./vll-Pnjv.js","./Select.C8Fy0-eI.css","./i4aLU0Nw.js","./GMLocJHP.js","./FieldListAutoCompleteDropdown.B9RfDcmT.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as oe,ba as _e,bL as x,r as g,d7 as te,f as h,c$ as f,d0 as se,hM as fe,fE as ne,g3 as Z,o as i,c as B,b as _,N as t,d6 as ve,d8 as ye,ij as be,L as ge,F as he,hD as H,M as we,Q as d,w as l,a as b,W as T,T as L,U as $,ao as ke,at as Be,t as V,R as E,P as X,O as K,d as Ce,S as Oe,X as Ge,a4 as Se,ah as ee,Z as Me,$ as Te,Y as xe,y as De,_ as Ie}from"./DZZ6t_j4.js";import{_ as Le}from"./CzKSHp3Z.js";import{a as re}from"./i4aLU0Nw.js";import{a as ae}from"./BIg_TdrP.js";import{_ as $e}from"./DnSVh-oD.js";import{_ as Ve}from"./vK-WmZ7a.js";import{a as Ee}from"./B05h-4V9.js";import{u as Ne}from"./BlrQG98t.js";import{g as Re}from"./EMCYuzyZ.js";import{D as Ue}from"./Dg0-TbNo.js";import{S as Fe}from"./D_MsYLkT.js";import"./DC_VdAC1.js";import"./hZgTYrdl.js";import"./ByVBARmO.js";import"./37hePIet.js";import"./C4K5fdHe.js";import"./CR5b0rlC.js";import"./BVrX6sNU.js";import"./DKN1hQ6S.js";import"./BQuyMdA-.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";import"./GMLocJHP.js";import"./t0mbNaqp.js";import"./BCJFTkwv.js";import"./CB1aB6F1.js";const ze={class:"nc-group-by-create-modal"},Ae=oe({__name:"CreateGroupBy",props:{isParentOpen:{type:Boolean},columns:{}},emits:["created"],setup(C,{emit:D}){const N=C,R=D,{isParentOpen:U,columns:O}=_e(N),G=x(te,g()),{showSystemFields:S,metaColumnById:M}=re(),{groupBy:w}=ae(),F=h(()=>{var n,c;return((c=O.value||((n=G.value)==null?void 0:n.columns))==null?void 0:c.filter(r=>{var v;return r.uidt===f.Links?!0:se((v=M==null?void 0:M.value)==null?void 0:v[r.id])?r!=null&&r.colOptions||fe(r,G.value)?!1:S.value:r.uidt===f.QrCode||r.uidt===f.Barcode||r.uidt===f.ID?!1:!(ne(r)&&![Z.BELONGS_TO,Z.ONE_TO_ONE].includes(r.colOptions.type))}).filter(r=>!w.value.find(v=>{var I;return((I=v.column)==null?void 0:I.id)===r.id})))??[]}),z=n=>{R("created",n)};return(n,c)=>{const r=Le;return i(),B("div",ze,[_(r,{"is-parent-open":t(U),"search-input-placeholder":n.$t("msg.selectFieldToGroup"),options:t(F),"toolbar-menu":"groupBy",onSelected:z},null,8,["is-parent-open","search-input-placeholder","options"])])}}}),Pe=Ge(()=>Se(()=>import("./D_AnMzhu.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url).then(C=>C.default||C)),je={class:"flex items-center gap-1"},Ye={class:"flex items-center gap-2"},Qe={key:0,class:"text-capitalize !text-[13px] font-medium"},We={key:0,class:"bg-brand-50 text-brand-500 py-1 px-2 text-md rounded-md"},He={key:1,class:"flex flex-col bg-white overflow-auto nc-group-by-list menu-filter-dropdown w-100 p-4","data-testid":"nc-group-by-menu"},Xe={class:"w-full flex items-center justify-between gap-2"},Ze={class:"truncate flex-1"},qe={class:"flex gap-1 items-center"},Je=oe({__name:"GroupByMenu",setup(C){const D=x(te,g()),N=x(ve,g()),R=x(ye,g(!1)),U=x(be,h(()=>!1)),{gridViewCols:O,updateGridViewColumn:G,metaColumnById:S,showSystemFields:M}=re(),{fieldsToGroupBy:w,groupByLimit:F}=ae(),{$e:z}=De(),n=g([]),c=h(()=>{const o=[];return Object.values(O.value).forEach(e=>{e.group_by&&o.push({fk_column_id:e.fk_column_id,sort:e.group_by_sort||"asc",order:e.group_by_order||1})}),o.sort((e,s)=>e.order-s.order),o}),r=h(()=>c.value.map(o=>o.fk_column_id).filter(o=>o)),{eventBus:v}=Ee(),{isMobileMode:I}=ge(),y=g(!1),q=h(()=>{var o;return((o=D.value)==null?void 0:o.columns)||[]}),ie=h(()=>q.value.reduce((o,e)=>(o[e.id]=e,o),{})),le=h(()=>{var o;return(o=q.value)==null?void 0:o.filter(e=>{var s;return e.uidt===f.Links?!0:se((s=S==null?void 0:S.value)==null?void 0:s[e.id])?M.value:e.uidt===f.QrCode||e.uidt===f.Barcode||e.uidt===f.ID?!1:!(ne(e)&&e.colOptions.type!==Z.BELONGS_TO)}).filter(e=>!c.value.find(s=>s.fk_column_id===e.id))}),ue=o=>{var e;return o&&((e=ie.value[o])==null?void 0:e.uidt)||""},p=g(!1);Ne(p);const k=async()=>{var o;if((o=N.value)!=null&&o.id)try{for(const e of n.value){if(!e.fk_column_id)continue;const s=O.value[e.fk_column_id];s&&(!s.group_by||s.group_by_order!==e.order||s.group_by_sort!==e.sort)&&await G(e.fk_column_id,{group_by:!0,group_by_order:e.order,group_by_sort:e.sort})}for(const e of c.value){if(!e.fk_column_id||n.value.find(m=>m.fk_column_id===e.fk_column_id))continue;const s=O.value[e.fk_column_id];s&&s.group_by&&await G(e.fk_column_id,{group_by:!1,group_by_order:void 0,group_by_sort:void 0})}z("a:group-by:update",{groupBy:c.value}),v.emit(H.GROUP_BY_RELOAD)}catch{ee.error("There was an error while updating view!")}else ee.error("View not found!!!")},A=o=>{n.value.push({fk_column_id:o.id,sort:"asc",order:n.value.length+1}),k(),y.value=!1},de=async o=>{if(r.value.length===0){p.value=!1;return}const e=n.value.findIndex(s=>s.fk_column_id===o.fk_column_id);n.value.splice(+e,1),await k()};he(p,()=>{p.value?n.value=[...c.value]:y.value=!1}),v.on(async(o,e)=>{if(e!=null&&e.id){if(o===H.GROUP_BY_ADD)A(e);else if(o===H.GROUP_BY_REMOVE){if(r.value.length===0)return;n.value=n.value.filter(s=>s.fk_column_id!==e.id),await k()}}});const ce=async o=>{const{newIndex:e,oldIndex:s}=o.moved,m=[...n.value],P=m.splice(s,1)[0];m.splice(e,0,P??[]);const j=m.map((Y,Q)=>({...Y,order:Q+1}));n.value=[...j],await k()};return(o,e)=>{const s=Me,m=Ae,P=Pe,j=Fe,Y=$e,Q=Te,pe=xe,J=Ve,W=we("e");return i(),d(J,{visible:t(p),"onUpdate:visible":e[6]||(e[6]=a=>K(p)?p.value=a:null),"offset-y":"",trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-group-by-menu nc-toolbar-dropdown overflow-hidden"},{overlay:l(()=>[t(n).length?(i(),B("div",He,[b("div",{class:"max-h-100",onClick:e[3]||(e[3]=T(()=>{},["stop"]))},[_(t(Ue),{"model-value":t(n),"item-key":"fk_column_id","ghost-class":"bg-gray-50",onChange:e[2]||(e[2]=a=>ce(a))},{item:l(({element:a})=>[(i(),B("div",{key:a.fk_column_id,class:"flex first:mb-0 !mb-1.5 !last:mb-0 items-center"},[_(s,{type:"secondary",size:"small",class:"!border-r-transparent !rounded-r-none"},{default:l(()=>[(i(),d(L(("iconMap"in o?o.iconMap:t($)).drag)))]),_:1}),_(P,{modelValue:a.fk_column_id,"onUpdate:modelValue":u=>a.fk_column_id=u,class:"caption nc-sort-field-select !w-36",columns:t(w),"allow-empty":!0,meta:t(D),onChange:k,onClick:e[0]||(e[0]=T(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns","meta"]),_(Y,{ref:"",value:a.sort,"onUpdate:value":u=>a.sort=u,class:"flex flex-grow-1 w-full nc-sort-dir-select",label:o.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir",disabled:!a.fk_column_id,onChange:k,onClick:e[1]||(e[1]=T(()=>{},["stop"]))},{default:l(()=>[(i(!0),B(ke,null,Be(("getSortDirectionOptions"in o?o.getSortDirectionOptions:t(Re))(ue(a.fk_column_id),!0),(u,me)=>(i(),d(j,{key:me,value:u.value},{default:l(()=>[b("div",Xe,[b("div",Ze,V(u.text),1),a.sort===u.value?(i(),d(L(("iconMap"in o?o.iconMap:t($)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):E("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","label","disabled"]),_(Q,{placement:"top",title:"Remove",class:"flex-none"},{default:l(()=>[X((i(),d(s,{class:"nc-group-by-item-remove-btn !border-l-transparent !rounded-l-none min-w-40",size:"small",type:"secondary",onClick:T(u=>de(a),["stop"])},{default:l(()=>[(i(),d(L(("iconMap"in o?o.iconMap:t($)).deleteListItem)))]),_:2},1032,["onClick"])),[[W,["c:group-by:remove"]]])]),_:2},1024)]))]),_:1},8,["model-value"])]),t(le).length&&t(w).length>t(n).length&&t(n).length<t(F)?(i(),d(J,{key:0,visible:t(y),"onUpdate:visible":e[5]||(e[5]=a=>K(y)?y.value=a:null),trigger:["click"],"overlay-class-name":"nc-toolbar-dropdown"},{overlay:l(()=>[_(m,{"is-parent-open":t(y),columns:t(w),onCreated:A},null,8,["is-parent-open","columns"])]),default:l(()=>[X((i(),d(s,{type:"text",size:"small",style:{width:"fit-content"},class:"nc-add-group-by-btn mt-2 !text-brand-500",onClick:e[4]||(e[4]=T(a=>y.value=!0,["stop"]))},{default:l(()=>[b("div",qe,[_(pe,{icon:"plus"}),Ce(" "+V(o.$t("activity.addSubGroup")),1)])]),_:1})),[[W,["c:group-by:add"]]])]),_:1},8,["visible"])):E("",!0)])):(i(),d(m,{key:0,"is-parent-open":t(p),columns:t(w),onCreated:A},null,8,["is-parent-open","columns"]))]),default:l(()=>{var a;return[b("div",{class:Oe({"nc-active-btn":(a=t(r))==null?void 0:a.length})},[X((i(),d(s,{disabled:t(R),class:"nc-group-by-menu-btn nc-toolbar-btn !border-0 !h-7",size:"small",type:"secondary"},{default:l(()=>{var u;return[b("div",je,[b("div",Ye,[(i(),d(L(("iconMap"in o?o.iconMap:t($)).group),{class:"h-4 w-4"})),!t(I)&&!t(U)?(i(),B("span",Qe,V(o.$t("activity.group")),1)):E("",!0)]),(u=t(r))!=null&&u.length?(i(),B("span",We,V(t(r).length),1)):E("",!0)])]}),_:1},8,["disabled"])),[[W,["c:group-by"]]])],2)]}),_:1},8,["visible"])}}}),To=Ie(Je,[["__scopeId","data-v-1312d941"]]);export{To as default};
