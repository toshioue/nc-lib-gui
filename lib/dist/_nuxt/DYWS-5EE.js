const __vite__fileDeps=["./DB67bFVD.js","./B2hUoZAs.js","./entry.B8GgT5QA.css","./fS-pjH0A.js","./MeGaiume.js","./VirtualCell.BsQKIqYj.css","./CBS-34pK.js","./DSjSw5ad.js","./BXXS6TCz.js","./Cell.CYBwEWH5.css","./DAGOJ60z.js","./Cm3S8h4k.js","./DFYMF386.js","./DeleteModal.SEMJ_gSK.css","./B2tWagsz.js","./CGB_6kIS.js","./BWYzyVlv.js","./CwHJfKcC.js","./BQQOEPN4.js","./C9qKCFvP.js","./BGKYJ52S.js","./i4toF4kp.js","./kd0F6MQ0.js","./9Qsq7KWJ.js","./e4fIiYA_.js","./CZHF7Hd-.js","./By21eAqY.js","./cvW-uYte.js","./1orNHd0L.js","./fKrvpb1C.js","./BfdKY7dK.js","./z-Xby7zn.js","./DaczmVFk.js","./SelectOptions.JaHDUZhn.css","./DQQlYxjr.js","./CvDoTMIT.js","./fmNfCaCg.js","./CaxUP45y.js","./R1pHeCcp.js","./DRJOl617.js","./U6IX4jMM.js","./CGFlARNL.js","./D1iILnOh.js","./B_8aIjz8.js","./BJs4TgOI.js","./pcWi62uI.js","./Switch.CEh6YzqD.css","./C9Sjn86N.js","./aArC9wvG.js","./Df48od_3.js","./Coz9Ftud.js","./CSOC84UF.js","./BeKg4PXl.js","./Select.Ct6CicDJ.css","./iWNPo5ps.js","./BKCMEtlO.js","./EditOrAddProvider.CRN0tnY2.css","./B7f52wKv.js","./VirtualCell.CZh3Dt_h.css","./Dtgb-V7U.js","./nk4tSM_m.js","./B-HHpLTx.js","./boyBAVNN.js","./Cell.DV_4HH8i.css","./BlhRk6zn.js","./DlZ1svvA.js","./DEpWCId1.js","./Pagination.D7qN7qzC.css","./B4uVmeYG.js","./B093it4u.js","./m0P-hxAq.js","./OX0YKNjC.js","./BAskgGqK.js","./Pagination.Sdu4RSaT.css","./Bc4ZV0ZA.js","./DerldqwU.js","./MenuItem.C7h59s4s.css","./DfZ7_DBQ.js","./Menu.CQ8GNWeI.css","./BCTq0LyZ.js","./SubMenu.wOiIU45B.css","./BfyDMjkl.js","./BQN-xhuP.js","./7hPDkg8v.js","./Divider.DqtSqZhb.css","./BrvbRDBc.js","./DivDataCell.1yCNpUg3.css","./3I_Awkws.js","./UserIcon.JKLzA6N5.css","./D1Sy-L_y.js","./lNF0bL0F.js","./Badge.D0-UrqG9.css","./D9EHdJGP.js","./Cy50pBgZ.js","./links.C8uCzV-l.css","./aFQEf_70.js","./Tabs.DaLSLYpn.css","./BVocwMJB.js","./Bye44sky.js","./BLNfZKv8.js","./C0IYadH8.js","./Bhv5f4lm.js","./BPB61pKE.js","./BjshTetX.js","./CEs-fTPr.js","./index.BSNjFO1V.css","./dtCS7q_O.js","./DR8NwF4k.js","./Di2YdQXX.js","./DUCgVWMk.js","./DMylWvyY.js","./B3nR1Eu5.js","./CioeS9VM.js","./PaginationV2.C9R8276J.css","./DM1twmVN.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Dl=Object.defineProperty;var Al=(v,h,s)=>h in v?Dl(v,h,{enumerable:!0,configurable:!0,writable:!0,value:s}):v[h]=s;var fa=(v,h,s)=>(Al(v,typeof h!="symbol"?h+"":h,s),s);import{bL as Ie,r as _,h6 as ea,fC as ta,g3 as Ml,he as zn,g as U,hi as Pn,cU as $,hN as $n,fP as ba,an as ze,ga as Cl,A as Nn,f as So,av as St,hO as El,gy as Ll,o as l,c as A,a6 as Vl,P as e,dS as Ro,ai as Bo,d4 as Ht,hn as Fl,hP as On,ce as kt,g_ as zl,dC as Pl,ah as Nl,cP as In,N as Tn,cB as Sn,at as $o,ag as Gn,cQ as ka,L as Bn,aj as va,aA as Xt,hQ as Yt,cN as To,dj as Go,ao as Ol,gh as Il,hR as Tl,fG as jt,cV as ga,cf as Un,cg as ha,a as k,cG as oa,dm as Gl,h9 as Wt,ac as xa,ab as ao,d0 as aa,c$ as Ra,hf as Hn,d1 as Bl,hS as Yn,M as Ul,g6 as na,hc as Hl,hT as Wn,hU as Yl,hV as Wl,ae as Kl,H as ko,i as Zo,l as $a,hW as jl,ad as qo,O as Dn,a8 as We,S as B,T as Ee,R as Ce,aB as Io,b as T,w as C,X as ma,U as x,V as oo,W as _o,d as Fe,t as ee,fw as ya,al as qe,am as Ut,Q as Lt,Y as Et,cd as An,hX as Mn,cZ as Cn,Z as wt,a5 as gt,hz as Xl,hA as ql,a_ as Vo,hB as vo,aG as Ql,$ as Kn,a0 as Jl,af as Zl,dh as er,a2 as jn,hY as tr,p as or,e as ar,_ as Xn,u as qn,dQ as _a,hk as xo,hZ as nr,d9 as Qo,h_ as En,az as lr,hu as rr,ht as ir,hC as sr,hs as ur,h$ as dr,ba as cr}from"./B2hUoZAs.js";import Qn from"./BfyDMjkl.js";import{a as Uo}from"./Bye44sky.js";import{u as pr}from"./B_8aIjz8.js";import{a as la}from"./D1iILnOh.js";import{u as fr,a as vr}from"./dtCS7q_O.js";import{a as Ln,e as pt,c as mr,d as wr}from"./MeGaiume.js";import{a as gr}from"./DR8NwF4k.js";import{u as Jn}from"./C0IYadH8.js";import{_ as Zn}from"./DerldqwU.js";import{_ as el}from"./DfZ7_DBQ.js";import{_ as hr}from"./BQN-xhuP.js";import{_ as tl}from"./e4fIiYA_.js";import{u as yr}from"./BLNfZKv8.js";import{u as _r}from"./BfdKY7dK.js";import{a as br}from"./B-HHpLTx.js";import{c as no,d as lo,e as mo,i as kr,a as xr,g as Rr}from"./fS-pjH0A.js";import{p as $r}from"./Di2YdQXX.js";import{G as fo}from"./BXXS6TCz.js";import{_ as Sr}from"./DUCgVWMk.js";import{a as ol}from"./B4uVmeYG.js";import{S as Dr}from"./B093it4u.js";import{C as Ar}from"./DMylWvyY.js";import{T as Mr}from"./B3nR1Eu5.js";import{_ as Cr,C as Er}from"./CioeS9VM.js";const[Lr,Vr]=pr((v,h,s)=>{const{$api:M}=Nn(),n=Ie(ea,_([])),G=Ie(ta,_(!1)),{gridViewCols:L,updateGridViewColumn:E}=la(),{nestedFilters:Ke}=Uo(),{fetchAggregatedData:g}=Ml(),ue=_({}),p=Ie(zn),le=U(()=>n.value.map((y,W)=>({field:y,index:W})).filter(y=>y.index!==0).map(y=>{const W=L.value[y.field.id];return W?{value:ue.value[y.field.title]??null,field:W,column:y.field,index:y.index,width:`${Number((W.width??"").replace("px",""))}px`||"180px"}:{field:null,index:y.index}})),te=U(()=>{var m;return!((m=n.value)!=null&&m.length)||!L.value?{field:null,width:"180px"}:{value:ue.value[n.value[0].title]??null,column:n.value[0],field:L.value[n.value[0].id],width:`${Number((L.value[n.value[0].id].width??"").replace("px",""))+64}px`||"244px"}}),$e=m=>{var y,W;return m.uidt===$.Formula&&((W=(y=m.colOptions)==null?void 0:y.parsed_tree)!=null&&W.dataType)?$n(m.uidt,m.colOptions.parsed_tree):$n(m.uidt)},I=async m=>{await ba(h).toBeTruthy(y=>!!y,{timeout:1e4}).then(async()=>{try{const y=G.value?await g({where:s==null?void 0:s.value,filtersArr:Ke.value,...m?{aggregation:m}:{}}):await M.dbDataTableAggregate.dbDataTableAggregate(h.value.id,{viewId:v.value.id,where:s==null?void 0:s.value,...m?{aggregation:m}:{}});Object.assign(ue.value,y)}catch(y){console.log(y),ze.error(await Cl(y))}})},z=async(m,y)=>{var W;await(p==null?void 0:p.trigger({fields:[{title:((W=n.value.find(ke=>ke.id===m))==null?void 0:W.title)??"",aggregation:y}]})),await E(m,{aggregation:y})};return p==null||p.on(async m=>{if((!m||!(m!=null&&m.fields.length))&&await I(),m!=null&&m.fields){const y=m.fields.reduce((W,ke)=>{const re=n.value.find(ge=>ge.title===ke.title);return re!=null&&re.id&&(W[re.id]=ke.aggregation??L.value[re.id].aggregation??Pn.None),W},{});await I(Object.entries(y).map(([W,ke])=>({field:W,type:ke})))}}),{loadViewAggregate:I,isPublic:G,updateAggregate:z,getAggregations:$e,displayFieldComputed:te,visibleFieldsComputed:le}});function Fr(){const v=Vr();if(v==null)throw new Error("Please call `useProvideViewAggregate` on the appropriate parent component");return v}const zr=So({__name:"TableDataCell",setup(v){const h=_(),s=Ro();return St(El,s),St(Ll,h),(M,n)=>(l(),A("td",{ref_key:"el",ref:h,class:"select-none",onClick:n[0]||(n[0]=G=>e(s).trigger(G))},[Vl(M.$slots,"default")],512))}}),Pr=()=>{const{t:v}=Bo();return{paste:async()=>{try{if(!navigator.clipboard)throw new Error(v("msg.error.pasteFromClipboardError"));const s=await navigator.clipboard.readText(),M=new Event("paste",{bubbles:!1,cancelable:!0});return Object.defineProperty(M,"clipboardData",{value:{getData:()=>s||""}}),document.dispatchEvent(M),!0}catch{return ze.error(v("msg.error.pasteFromClipboardError")),!1}}}};class Vn{constructor(h=null,s=null){fa(this,"_start");fa(this,"_end");this._start=h,this._end=s??this._start}isEmpty(){return this._start==null||this._end==null}isSingleCell(){var h,s,M,n;return!this.isEmpty()&&((h=this._start)==null?void 0:h.col)===((s=this._end)==null?void 0:s.col)&&((M=this._start)==null?void 0:M.row)===((n=this._end)==null?void 0:n.row)}isSingleRow(){var h,s;return!this.isEmpty()&&((h=this._start)==null?void 0:h.row)===((s=this._end)==null?void 0:s.row)}isCellInRange(h){return!this.isEmpty()&&h.row>=this.start.row&&h.row<=this.end.row&&h.col>=this.start.col&&h.col<=this.end.col}isRowInRange(h){return!this.isEmpty()&&h>=this.start.row&&h<=this.end.row}isColInRange(h){return!this.isEmpty()&&h>=this.start.col&&h<=this.end.col}get start(){var h,s,M,n;return{row:Math.min(((h=this._start)==null?void 0:h.row)??NaN,((s=this._end)==null?void 0:s.row)??NaN),col:Math.min(((M=this._start)==null?void 0:M.col)??NaN,((n=this._end)==null?void 0:n.col)??NaN)}}get end(){var h,s,M,n;return{row:Math.max(((h=this._start)==null?void 0:h.row)??NaN,((s=this._end)==null?void 0:s.row)??NaN),col:Math.max(((M=this._start)==null?void 0:M.col)??NaN,((n=this._end)==null?void 0:n.col)??NaN)}}startRange(h){this._start=h,this._end=h}endRange(h){this._end=h}clear(){this._start=null,this._end=null}}function bo(v,h=!1,s=!1){var g,ue;const{to:M,value:n,column:G,files:L=[],oldValue:E}=v,Ke=h?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";if(n===""&&M!==$.Attachment)return null;switch(M){case $.SingleLineText:case $.LongText:return n.match(/^".*"$/)?n.slice(1,-1):n;case $.Number:{const p=Number(n);if(isNaN(p)){if(s)return null;throw new TypeError(`Cannot convert '${n}' to number`)}return p}case $.Rating:{const p=Number(n??0);if(isNaN(p)){if(s)return null;throw new TypeError(`Cannot convert '${n}' to rating`)}return p}case $.Checkbox:if(typeof n=="boolean")return n;if(typeof n=="string"){const p=n.trim().toLowerCase();if(p==="true"||p==="1")return!0;if(p==="false"||p==="0"||p==="")return!1}return null;case $.Date:case $.DateTime:{let p=kt(n,zl(n));if(p.isValid()||(p=kt(n,Pl(n))),!p.isValid()){if(s)return null;throw new Error(`Not a valid '${M}' value`)}return M===$.Date?p.format("YYYY-MM-DD"):p.utc().format("YYYY-MM-DD HH:mm:ssZ")}case $.Time:{let p=kt(n);if(p.isValid()||(p=kt(n,"HH:mm:ss")),p.isValid()||(p=kt(`1999-01-01 ${n}`)),!p.isValid()){if(s)return null;throw new Error("Not a valid time value")}return p.format(Ke)}case $.Year:{if(/^\d+$/.test(n))return+n;const p=kt(n);if(p.isValid())return p.format("YYYY");if(s)return null;throw new Error("Not a valid year value")}case $.Attachment:{const p=Ht(E),le=p&&Array.isArray(p)?p:[];if(!n&&!L.length)return le.length?void 0:null;let te=[];if(n){try{te=Ht(n),te=Array.isArray(te)?te:typeof te=="object"&&Object.keys(te).length?[te]:[]}catch{if(s)return null;throw new Error("Invalid attachment data")}if(te.some(m=>m&&!(m.url||m.data||m.path)))return null}const I={...{...v.appInfo.ee&&{maxNumberOfAttachments:Math.max(1,+v.appInfo.ncMaxAttachmentsAllowed||50)||50,maxAttachmentSize:Math.max(1,+v.appInfo.ncAttachmentFieldSize||20)||20,supportedAttachmentMimeTypes:["*"]}},...Ht(G==null?void 0:G.meta)},z=[];for(const m of n?te:L){if(v.appInfo.ee){if(te.length>I.maxNumberOfAttachments){ze.error(`You can only upload at most ${I.maxNumberOfAttachments} file${I.maxNumberOfAttachments>1?"s":""} to this cell.`);return}if(m.size>I.maxAttachmentSize*1024*1024){ze.error(`The size of ${m.name} exceeds the maximum file size ${I.maxAttachmentSize} MB.`);continue}if(!I.supportedAttachmentMimeTypes.includes("*")&&!I.supportedAttachmentMimeTypes.includes(m.type)&&!I.supportedAttachmentMimeTypes.includes(m.type.split("/")[0])){ze.error(`${m.name} has the mime type ${m.type} which is not allowed in this column.`);continue}}z.push(m)}if(le.length&&!z.length)return;if(n&&z.length){const m=[];for(const y of z)m.push({...y,title:On(y==null?void 0:y.title,[...le,...m].map(W=>(W==null?void 0:W.title)||(W==null?void 0:W.fileName)),y==null?void 0:y.mimetype)});return JSON.stringify([...le,...m])}else return L.length&&z.length?z:null}case $.SingleSelect:case $.MultiSelect:{if(n==="")return null;const p=(((g=G.colOptions)==null?void 0:g.options)||[]).map($e=>$e.title),te=n.split(",").filter($e=>p.includes($e));return te.length===0?null:te.join(",")}case $.User:case $.CreatedBy:case $.LastModifiedBy:{let p;try{try{p=typeof n=="string"?JSON.parse(n):n}catch{p=n}}catch{if(s)return null;throw new Error("Invalid user data")}return p||n}case $.LinkToAnotherRecord:{if(s)return;if(lo(G)||mo(G)){const p=typeof n=="string"?JSON.parse(n):n;if(!(p&&typeof p=="object"&&!Array.isArray(p)&&Object.keys(p))||(p==null?void 0:p.fk_related_model_id)!==((ue=G.colOptions)==null?void 0:ue.fk_related_model_id))throw new Error(`Unsupported conversion for ${M}`);return p}else throw new Error(`Unsupported conversion for ${M}`)}case $.Links:{if(s)return;if(no(G)){const p=typeof n=="string"?JSON.parse(n):n;if(!(p&&typeof p=="object"&&!Array.isArray(p)&&["rowId","columnId","fk_related_model_id","value"].every(le=>p.hasOwnProperty(le)))||(p==null?void 0:p.fk_related_model_id)!==G.colOptions.fk_related_model_id)throw new Error(`Unsupported conversion for ${M}`);return p}else throw new Error(`Unsupported conversion for ${M}`)}case $.Email:return Ht(G.meta).validate&&Fl(n)||n;case $.Lookup:case $.Rollup:case $.Formula:case $.QrCode:{if(s)return;throw new Error(`Unsupported conversion for ${M}`)}default:return n}}const wa=0;function Nr(v,h,s,M,n,G,L,E,Ke,g,ue,p,le,te,$e,I,z){const m=_(v),{t:y}=Bo(),{copy:W}=Nl(),{getMeta:ke}=In(),{appInfo:re}=Tn(),{isMysql:ge,isPg:ie}=Sn(),{base:pe}=$o(Sn()),{api:j}=Gn(),{addUndo:be,clone:f,defineViewScope:Se}=ka(),{isDataReadOnly:Ze}=Bn(),de=_(M),De=_(!1),et=_(!1),he=_($e),Te=_(I),i=va(new Vn),se=va(new Vn),a=va({row:null,col:null}),V=U(()=>{var r;return(r=e(h))==null?void 0:r.length}),oe=U(()=>!(a.row===null||a.col===null||isNaN(a.row)||isNaN(a.col)));function b(r,u){a.row===r&&a.col===u||(de.value=!1,a.row=r,a.col=u)}function F(r){const u=P(r),c=X(r);return`${u} ${c}`}function P(r){var u;return((u=Ht(r==null?void 0:r.meta))==null?void 0:u.date_format)??Un[0]}function X(r){var u;return((u=Ht(r==null?void 0:r.meta))==null?void 0:u.time_format)??ha[0]}const ve=(r,u)=>{var ne,ye;let c=u.title&&r.row[u.title]||"";if(u.uidt===$.Checkbox&&(c=!!c),[$.User,$.CreatedBy,$.LastModifiedBy].includes(u.uidt)&&c&&(c=Array.isArray(c)?c:[c].map(N=>N.email).join(", ")),(lo(u)||mo(u))&&(c={fk_related_model_id:u.colOptions.fk_related_model_id,value:c||null}),no(u)&&(c={rowId:pt(r.row,(ne=m.value)==null?void 0:ne.columns),columnId:u.id,fk_related_model_id:u.colOptions.fk_related_model_id,value:isNaN(+c)?0:+c}),typeof c=="object"?c=JSON.stringify(c):c=c.toString(),u.uidt===$.Formula&&(c=c.replace(/\b(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}[+-]\d{2}:\d{2})\b/g,N=>kt(N).utc().local().format("YYYY-MM-DD HH:mm"))),[$.DateTime,$.CreatedTime,$.LastModifiedTime].includes(u.uidt)){c=c.replace(/["']/g,"");const N=ge(u.source_id);let me=kt(c);if(me.isValid()||(me=kt(c,N?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),c=me.format(F(u)),!me.isValid())return""}if(u.uidt===$.Date){const N=(ye=Ht(u.meta))==null?void 0:ye.date_format;N&&Tl(N)?c=kt(c,N).format(N):c=kt(c,"YYYY-MM-DD").format(N)}if(u.uidt===$.Time){c=c.replace(/["']/g,"");const N=ge(u.source_id),me=ie(u.source_id);let _e=kt(c);if(_e.isValid()||(_e=kt(c,N?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),_e.isValid()||(_e=N||me?kt(c,"HH:mm:ss"):kt(c)),!_e.isValid())return"";c=_e.format(X(u))}return u.uidt===$.LongText&&(c=`"${c.replace(/"/g,'\\"')}"`),c},q=(r,u)=>{let c="<table>",ne="";const ye=[];return r.forEach((N,me)=>{let _e="<tr>";const Dt=[];u.forEach((Tt,rt)=>{const it=ve(N,Tt);_e+=`<td>${it}</td>`,ne=`${ne}${it}${u.length-1!==rt?"	":""}`,Dt.push(it)}),c+=`${_e}</tr>`,r.length-1!==me&&(ne=`${ne}
`),ye.push(Dt)}),c+="</table>",{html:c,text:ne,json:ye}},tt=async(r,u)=>{var me;const{html:c,text:ne}=q(r,u),ye=new Blob([c],{type:"text/html"}),N=new Blob([ne],{type:"text/plain"});return((me=navigator.clipboard)==null?void 0:me.write([new ClipboardItem({[ye.type]:ye,[N.type]:N})]))??W(ne)};async function xt(r){try{if(i.start!==null&&i.end!==null&&!i.isSingleCell()){const u=e(s).slice(i.start.row,i.end.row+1),c=e(h).slice(i.start.col,i.end.col+1);await tt(u,c),ze.success(y("msg.info.copiedToClipboard"))}else{const u=(r==null?void 0:r.row)??a.row,c=(r==null?void 0:r.col)??a.col;if(u!=null&&c!=null){const ne=e(s)[u],ye=e(h)[c],N=ve(ne,ye);await W(N),ze.success(y("msg.info.copiedToClipboard"))}}}catch{ze.error(y("msg.error.copyToClipboardError"))}}const It=U(()=>{const r={};if(se._start===null||se._end===null)return r;for(let u=se.start.row;u<=se.end.row;u++)for(let c=se.start.col;c<=se.end.col;c++)r[`${u}-${c}`]=!0;return r}),Vt=U(()=>{const r={};if(a.row!==null&&a.col!==null&&(r[`${a.row}-${a.col}`]=!0),i._start===null||i._end===null)return r;for(let u=i.start.row;u<=i.end.row;u++)for(let c=i.start.col;c<=i.end.col;c++)r[`${u}-${c}`]=!0;return r}),J=(r,u,c=!1)=>!r||!u?(c&&ze.info("Please select a cell to paste"),!1):jt(u)||ga(u)?(c&&ze.info(y("msg.info.pasteNotSupported")),!1):u.ai?(c&&ze.info(y("msg.info.autoIncFieldNotEditable")),!1):u.pk&&!r.rowMeta.new?(c&&ze.info(y("msg.info.editingPKnotSupported")),!1):!0;function Do(r,u,c){if(et.value){const ne=e(s)[u];if(!i._start||!i._end||ne.rowMeta.new)return;se.endRange({row:u,col:i._end.col}),g==null||g(u,c);return}De.value&&(i.endRange({row:u,col:c}),g==null||g(u,c),r.preventDefault())}function ae(r,u,c){if(!(((r==null?void 0:r.button)!==wa||(r==null?void 0:r.button)===wa&&r.ctrlKey)&&Vt.value[`${u}-${c}`])){if(de.value||(De.value=!0),G.value=!1,r.preventDefault(),r.shiftKey){(a.col===null||a.row===null)&&i.startRange({row:u,col:c}),i.endRange({row:u,col:c});return}i.startRange({row:u,col:c}),(a.row!==u||a.col!==c)&&(a.row=null,a.col=null)}}const nt=(r,u,c)=>{(!r.shiftKey||a.col===null||a.row===null)&&b(u,c),g==null||g(u,c)},dt=r=>{var u;if(et.value){if(et.value=!1,se._start===null||se._end===null)return;if(i._start!==null&&i._end!==null){const c={row:i._start.row,col:i._start.col},ne=e(s).slice(i.start.row,i.end.row+1),ye=e(h).slice(i.start.col,i.end.col+1),N=q(ne,ye).json,me=se._start.row<=se._end.row?1:-1;let _e=me===1?0:N.length-1;const Dt=[],Tt=[];for(let rt=se._start.row;me===1?rt<=se._end.row:rt>=se._end.row;rt+=me){if(Vt.value[`${rt}-${i.start.col}`])continue;const it=e(s)[rt];let At=0;for(let at=se.start.col;at<=se.end.col;at++){const Ae=e(h)[at];if(!J(it,Ae)){At++;continue}Tt.push(Ae.title);const Mt=bo({value:N[_e][At],to:Ae.uidt,column:Ae,appInfo:e(re)},ge((u=m.value)==null?void 0:u.source_id),!0);Mt!==void 0&&(it.row[Ae.title]=Mt,Dt.push(it)),At++}me===1?_e=_e<N.length-1?_e+1:0:_e=_e>=1?_e-1:N.length-1}le==null||le(Dt,Tt).then(()=>{se._start===null||se._end===null||(i.startRange(c),i.endRange(se._end),b(c.row,c.col),se.clear())})}else se.clear();return}De.value&&(De.value=!1,setTimeout(()=>{i._start&&(a.row!==i._start.row||a.col!==i._start.col)&&b(i._start.row,i._start.col)},0))},wo=async r=>{var c,ne,ye,N,me,_e,Dt,Tt,rt,it,At,at,Ae,Mt,io,so,uo,Gt,ce,O,ft,Le,st,ht,we,He,lt,ut,Me,ot,K,Z;if(await(ue==null?void 0:ue(r)))return!0;if(Yt()||!oe.value||a.row===null||a.col===null)return;const u=To()?r.metaKey:r.ctrlKey;switch(r.key){case"Tab":r.preventDefault(),i.clear(),r.shiftKey?a.col>0?(a.col--,de.value=!1):a.row>0&&(a.row--,a.col=e(V.value)-1,de.value=!1):a.col<e(V.value)-1?(a.col++,de.value=!1):a.row<e(s).length-1&&(a.row++,a.col=0,de.value=!1),g==null||g();break;case"Enter":r.preventDefault(),i.clear(),Ke(e(s)[a.row],e(h)[a.col]);break;case"Delete":case"Backspace":if(r.preventDefault(),Ze.value)return;i.isSingleCell()?(i.clear(),await L(a)):await E();break;case"ArrowRight":r.preventDefault(),r.shiftKey?u?(de.value=!1,i.endRange({row:((c=i._end)==null?void 0:c.row)??a.row,col:e(V.value)-1}),g==null||g((ne=i._end)==null?void 0:ne.row,(ye=i._end)==null?void 0:ye.col)):(((N=i._end)==null?void 0:N.col)??a.col)<e(V.value)-1&&(de.value=!1,i.endRange({row:((me=i._end)==null?void 0:me.row)??a.row,col:(((_e=i._end)==null?void 0:_e.col)??a.col)+1}),g==null||g((Dt=i._end)==null?void 0:Dt.row,(Tt=i._end)==null?void 0:Tt.col)):(i.clear(),a.col<e(V.value)-1&&(a.col++,i.startRange({row:a.row,col:a.col}),g==null||g(),de.value=!1));break;case"ArrowLeft":r.preventDefault(),r.shiftKey?u?(de.value=!1,i.endRange({row:((rt=i._end)==null?void 0:rt.row)??a.row,col:0}),g==null||g((it=i._end)==null?void 0:it.row,(At=i._end)==null?void 0:At.col)):(((at=i._end)==null?void 0:at.col)??a.col)>0&&(de.value=!1,i.endRange({row:((Ae=i._end)==null?void 0:Ae.row)??a.row,col:(((Mt=i._end)==null?void 0:Mt.col)??a.col)-1}),g==null||g((io=i._end)==null?void 0:io.row,(so=i._end)==null?void 0:so.col)):(i.clear(),a.col>0&&(a.col--,i.startRange({row:a.row,col:a.col}),g==null||g(),de.value=!1));break;case"ArrowUp":r.preventDefault(),r.shiftKey?u?(de.value=!1,i.endRange({row:0,col:((uo=i._end)==null?void 0:uo.col)??a.col}),g==null||g((Gt=i._end)==null?void 0:Gt.row,(ce=i._end)==null?void 0:ce.col)):(((O=i._end)==null?void 0:O.row)??a.row)>0&&(de.value=!1,i.endRange({row:(((ft=i._end)==null?void 0:ft.row)??a.row)-1,col:((Le=i._end)==null?void 0:Le.col)??a.col}),g==null||g((st=i._end)==null?void 0:st.row,(ht=i._end)==null?void 0:ht.col)):(i.clear(),a.row>0&&(a.row--,i.startRange({row:a.row,col:a.col}),g==null||g(),de.value=!1));break;case"ArrowDown":r.preventDefault(),r.shiftKey?u?(de.value=!1,i.endRange({row:e(s).length-1,col:((we=i._end)==null?void 0:we.col)??a.col}),g==null||g((He=i._end)==null?void 0:He.row,(lt=i._end)==null?void 0:lt.col)):(((ut=i._end)==null?void 0:ut.row)??a.row)<e(s).length-1&&(de.value=!1,i.endRange({row:(((Me=i._end)==null?void 0:Me.row)??a.row)+1,col:((ot=i._end)==null?void 0:ot.col)??a.col}),g==null||g((K=i._end)==null?void 0:K.row,(Z=i._end)==null?void 0:Z.col)):(i.clear(),a.row<e(s).length-1&&(a.row++,i.startRange({row:a.row,col:a.col}),g==null||g(),de.value=!1));break;default:{const Ne=e(s)[a.row],H=e(h)[a.col];if((!e(de)||!Ln(H))&&!Go()&&(To()?r.metaKey:r.ctrlKey))switch(r.keyCode){case 67:await xt();break;case 65:i.startRange({row:0,col:0}),i.endRange({row:e(s).length-1,col:e(V.value)-1});break}if(e(de)||r.ctrlKey||r.altKey||r.metaKey)return!0;if(r.key.length===1){if(!e(n)&&!Ne.rowMeta.new)return ze.info(y("msg.info.updateNotAllowedWithoutPK"));Ln(H)&&Ke(Ne,H)&&H.title&&(H.uidt===$.LongText?Ne.row[H.title]==="<br />"?Ne.row[H.title]=r.key:Ht(H.meta).richMode&&(Ne.row[H.title]=Ne.row[H.title]?Ne.row[H.title]+r.key:r.key):Ne.row[H.title]="")}}break}},Ao=()=>i.clear(),ro=i.clear.bind(i),go=async r=>{var c,ne,ye,N,me,_e,Dt,Tt,rt,it,At,at,Ae,Mt,io,so,uo,Gt;if(Ze.value||Go()||Yt()||!oe.value||e(de)||a.row===null||a.row===void 0||a.col===null||a.col===void 0)return;r.preventDefault();let u=((c=r.clipboardData)==null?void 0:c.getData("text/plain"))||"";u!=null&&u.endsWith(`
`)&&(u=u.replace(/\n$/,""));try{if(u!=null&&u.includes(`
`)||u!=null&&u.includes("	")){const ce=$r.parse(u,{delimiter:"	",escapeChar:"\\"});if(ce.errors.length>0)throw new Error(ce.errors[0].message);const O=ce.data,ft=Math.max(O.length,i.end.row-i.start.row+1),Le=ft,st=O[0].length,ht=e(h).slice(a.col,a.col+st),we=e(s).slice(a.row,a.row+ft),He=[];let lt=0,ut=!1;for(let Me=0;Me<Le;Me++){const ot=we[Me];if(!ot||ot.rowMeta.new)break;lt++;for(let K=0;K<st;K++){const Z=ht[K];if(!J(ot,Z)){(lo(Z)||mo(Z)||no(Z))&&!ut&&(ze.info(y("msg.info.groupPasteIsNotSupportedOnLinksColumn")),ut=!0);continue}He.push(Z.title);const Ne=bo({value:O[Me%O.length][K],to:Z.uidt,column:Z,appInfo:e(re),oldValue:Z.uidt===$.Attachment?ot.row[Z.title]:void 0},ge((ne=m.value)==null?void 0:ne.source_id),!0);Ne!==void 0&&(ot.row[Z.title]=Ne)}}await(le==null?void 0:le(we,He)),lt>0&&(i.startRange({row:a.row,col:a.col}),i.endRange({row:a.row+lt-1,col:a.col+st-1}))}else if(i.isSingleCell()){const ce=e(s)[a.row],O=e(h)[a.col];if(lo(O)){const Le=bo({value:u,to:O.uidt,column:O,appInfo:e(re)},ge((ye=m.value)==null?void 0:ye.source_id));if(Le===void 0)return;const st=(me=(N=m.value)==null?void 0:N.columns)==null?void 0:me.find(we=>{var He;return we.id===((He=O.colOptions)==null?void 0:He.fk_child_column_id)});if(!st)return;const ht=await ke(O.colOptions.fk_related_model_id);return ce.oldRow[O.title]=ce.row[O.title],ce.oldRow[st.title]=ce.row[O.title]?pt(ce.row[O.title],ht.columns):null,ce.row[O.title]=Le==null?void 0:Le.value,ce.row[st.title]=Le!=null&&Le.value?pt(Le.value,ht.columns):null,await(p==null?void 0:p({...a,updatedColumnTitle:st.title}))}if(no(O)){const Le=bo({value:u,to:O.uidt,column:O,appInfo:e(re)},ge((_e=m.value)==null?void 0:_e.source_id));if(Le===void 0)return;const st=pt(ce.row,(Dt=m.value)==null?void 0:Dt.columns);if(!st)return;const ht=ce.row[O.title];ce.row[O.title]=Le.value;let we;try{we=await j.dbDataTableRow.nestedListCopyPasteOrDeleteAll((Tt=m.value)==null?void 0:Tt.id,O.id,[{operation:"copy",rowId:Le.rowId,columnId:Le.columnId,fk_related_model_id:Le.fk_related_model_id},{operation:"paste",rowId:st,columnId:O.id,fk_related_model_id:O.colOptions.fk_related_model_id||Le.fk_related_model_id}],{viewId:(rt=he==null?void 0:he.value)==null?void 0:rt.id})}catch{ce.row[O.title]=ht;return}if(we&&(we!=null&&we.link)&&(we!=null&&we.unlink)&&Array.isArray(we.link)&&Array.isArray(we.unlink)){if(!we.link.length&&!we.unlink.length){ce.row[O.title]=ht;return}be({redo:{fn:async(He,lt,ut,Me,ot,K)=>{var Z,Ne,H,qt,co,Rt,Ft,Ge;if(((Z=Te.value)==null?void 0:Z.pageSize)===(Me==null?void 0:Me.pageSize)){((Ne=Te.value)==null?void 0:Ne.page)!==(Me==null?void 0:Me.page)&&await(z==null?void 0:z(Me==null?void 0:Me.page));const zt=pt(ut.row,(H=m.value)==null?void 0:H.columns),zo=e(s)[He.row],Qt=e(h)[He.col];if(zt===pt(zo.row,(qt=m.value)==null?void 0:qt.columns)&&Qt.id===lt.id)await Promise.all([K.link.length&&j.dbDataTableRow.nestedLink((co=m.value)==null?void 0:co.id,Qt.id,encodeURIComponent(zt),K.link,{viewId:(Rt=he==null?void 0:he.value)==null?void 0:Rt.id}),K.unlink.length&&j.dbDataTableRow.nestedUnlink((Ft=m.value)==null?void 0:Ft.id,Qt.id,encodeURIComponent(zt),K.unlink,{viewId:(Ge=he==null?void 0:he.value)==null?void 0:Ge.id})]),zo.row[Qt.title]=ot,await(p==null?void 0:p(He));else throw new Error(y("msg.recordCouldNotBeFound"))}else throw new Error(y("msg.pageSizeChanged"))},args:[f(a),f(O),f(ce),f(Te.value),f(Le.value),we]},undo:{fn:async(He,lt,ut,Me,ot,K)=>{var Z,Ne,H,qt,co,Rt;if(((Z=Te.value)==null?void 0:Z.pageSize)===Me.pageSize){((Ne=Te.value)==null?void 0:Ne.page)!==Me.page&&await(z==null?void 0:z(Me.page));const Ft=pt(ut.row,(H=m.value)==null?void 0:H.columns),Ge=e(s)[He.row],zt=e(h)[He.col];if(Ft===pt(Ge.row,(qt=m.value)==null?void 0:qt.columns)&&zt.id===lt.id)await Promise.all([K.unlink.length&&j.dbDataTableRow.nestedLink((co=m.value)==null?void 0:co.id,zt.id,encodeURIComponent(Ft),K.unlink),K.link.length&&j.dbDataTableRow.nestedUnlink((Rt=m.value)==null?void 0:Rt.id,zt.id,encodeURIComponent(Ft),K.link)]),Ge.row[zt.title]=ot,await(p==null?void 0:p(He));else throw new Error(y("msg.recordCouldNotBeFound"))}else throw new Error(y("msg.pageSizeChanged"))},args:[f(a),f(O),f(ce),f(Te.value),f(ht),we]},scope:Se({view:he==null?void 0:he.value})})}return await(p==null?void 0:p(a))}if(!J(ce,O,!0))return;const ft=bo({value:u,to:O.uidt,column:O,appInfo:e(re),files:O.uidt===$.Attachment&&((At=(it=r.clipboardData)==null?void 0:it.files)!=null&&At.length)?(at=r.clipboardData)==null?void 0:at.files:void 0,oldValue:ce.row[O.title]},ge((Ae=m.value)==null?void 0:Ae.source_id));if(O.uidt===$.Attachment&&((io=(Mt=r.clipboardData)==null?void 0:Mt.files)!=null&&io.length)&&(ft!=null&&ft.length)){const Le=await Mo(ft,O.id,ce.row[O.title]);ce.row[O.title]=Le?JSON.stringify(Le):null}else ft!==void 0&&(ce.row[O.title]=ft);await(p==null?void 0:p(a))}else{const ce=i.start,O=i.end,ft=Math.min(ce.row,O.row),Le=Math.max(ce.row,O.row),st=Math.min(ce.col,O.col),ht=Math.max(ce.col,O.col),we=e(h).slice(st,ht+1),He=e(s).slice(ft,Le+1),lt=[];let ut,Me=!1;const ot=(so=r.clipboardData)==null?void 0:so.files;for(const K of He)if(!(!K||K.rowMeta.new))for(const Z of we){if(!Z.title||!J(K,Z)){(lo(Z)||mo(pasteCol)||no(Z))&&!Me&&(ze.info(y("msg.info.groupPasteIsNotSupportedOnLinksColumn")),Me=!0);continue}if(ot!=null&&ot.length){if(Z.uidt!==$.Attachment)continue;if(ut===void 0){const Ne=bo({value:"",to:Z.uidt,column:Z,appInfo:e(re),files:ot,oldValue:K.row[Z.title]},ge((uo=m.value)==null?void 0:uo.source_id),!0);if(Ne!=null&&Ne.length){const H=await Mo(Ne,Z.id,K.row[Z.title]);ut=H?JSON.stringify(H):null}}}else ut=bo({value:u,to:Z.uidt,column:Z,appInfo:e(re),oldValue:K.row[Z.title]},ge((Gt=m.value)==null?void 0:Gt.source_id),!0);lt.push(Z.title),ut!==void 0&&(K.row[Z.title]=ut)}if(!lt.length)return;await(le==null?void 0:le(He,lt))}}catch(ce){console.error(ce),ze.error(await Ol(ce))}};function Fo(r){var u,c;(r==null?void 0:r.button)===wa&&(et.value=!0,i._start&&i._end&&(se.startRange({row:(u=i._start)==null?void 0:u.row,col:i._start.col}),se.endRange({row:(c=i._end)==null?void 0:c.row,col:i._end.col})),r.preventDefault())}async function Mo(r,u,c){var ye;const ne=[];try{const N=await j.storage.upload({path:[Il,pe.value.id,(ye=m.value)==null?void 0:ye.id,u].join("/")},{files:r});for(const me of N)ne.push({...me,title:On(me==null?void 0:me.title,[...Pe(c),...ne].map(_e=>(_e==null?void 0:_e.title)||(_e==null?void 0:_e.fileName)),me==null?void 0:me.mimetype)});return ne}catch(N){ze.error(N.message||y("msg.error.internalError"))}}function Pe(r){const u=Ht(r);return u&&Array.isArray(u)?u:[]}return Xt(document,"keydown",wo),Xt(document,"mouseup",dt),Xt(document,"paste",go),Xt(te,"mousedown",Fo),{isCellActive:oe,handleMouseDown:ae,handleMouseOver:Do,clearSelectedRange:ro,copyValue:xt,activeCell:a,handleCellClick:nt,resetSelectedRange:Ao,selectedRange:i,makeActive:b,isMouseDown:De,isFillMode:et,selectRangeMap:Vt,fillRangeMap:It}}const Or={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ir=k("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16z"},null,-1),Tr=[Ir];function Gr(v,h){return l(),A("svg",Or,[...Tr])}const Br={name:"mdi-message-outline",render:Gr},Ur={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Hr=k("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 4.1L14.1 6l1.4 1.4L16.9 6L18 7.1l-1.4 1.4L18 9.9L16.9 11l-1.4-1.4l-1.4 1.4L13 9.9l1.4-1.4zm-6.8.6h5v1.5h-5zm5.3 8.3h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2zm6.5 1.2h-5v-1.5h5zm0-2.4h-5v-1.5h5z"},null,-1),Yr=[Hr];function Wr(v,h){return l(),A("svg",Ur,[...Yr])}const Kr={name:"mdi-calculator-variant",render:Wr},jr={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Xr=k("path",{fill:"currentColor",d:"M2 12a9 9 0 0 0 9 9c2.39 0 4.68-.94 6.4-2.6l-1.5-1.5A6.7 6.7 0 0 1 11 19c-6.24 0-9.36-7.54-4.95-11.95S18 5.77 18 12h-3l4 4h.1l3.9-4h-3a9 9 0 0 0-18 0"},null,-1),qr=[Xr];function Qr(v,h){return l(),A("svg",jr,[...qr])}const Jr={name:"mdi-reload",render:Qr},Zr={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ei=k("path",{fill:"currentColor",d:"M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2zm-7 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm11 7h3V8h2v3h3v2h-3v3h-2v-3h-3z"},null,-1),ti=[ei];function oi(v,h){return l(),A("svg",Zr,[...ti])}const ai={name:"mdi-table-column-plus-after",render:oi},ni=({fields:v,tableBodyEl:h,gridWrapper:s})=>{const{eventBus:M,isDefaultView:n,meta:G}=Uo(),{addUndo:L,defineViewScope:E}=ka(),{activeView:Ke}=$o(oa()),{gridViewCols:g,updateGridViewColumn:ue}=la(),{leftSidebarWidth:p}=$o(Jn()),{width:le}=Gl(),te=_(!1),$e=_(null),I=_(null),z=_(null),m=(ie,pe)=>{var be;if(!((be=G.value)!=null&&be.columns))return;const j=G.value.columns.findIndex(f=>f.id===ie);j!==-1&&(G.value.columns[j].meta={...G.value.columns[j].meta||{},defaultViewColOrder:pe},G.value.columns=(G.value.columns||[]).map(f=>(f.id!==ie||(f.meta={...f.meta||{},defaultViewColOrder:pe}),f))),G.value.columnsById[ie]&&(G.value.columnsById[ie].meta={...G.value.columnsById[ie]||{},defaultViewColOrder:pe})},y=async(ie,pe)=>{const j=g.value[ie],be=g.value[pe];if(!j||!be)return;const f=v.value.findIndex(Te=>Te.id===pe),Se=f<v.value.length-1?v.value[f+1]:null,Ze=Se?g.value[Se.id]:null,de=v.value[v.value.length-1],De=g.value[de.id];if(Ze===null&&De===null)return;const et=Ze?be.order+(Ze.order-be.order)/2:De.order+1,he=j.order;j.order=et,n.value&&j.fk_column_id&&m(j.fk_column_id,et),L({undo:{fn:async()=>{v.value&&(j.order=he,n.value&&m(j.fk_column_id,he),await ue(ie,{order:he}),M.emit(Wt.FIELD_RELOAD))},args:[]},redo:{fn:async()=>{v.value&&(j.order=et,n.value&&m(j.fk_column_id,et),await ue(ie,{order:et}),M.emit(Wt.FIELD_RELOAD))},args:[]},scope:E({view:Ke.value})}),await ue(ie,{order:et},!0),M.emit(Wt.FIELD_RELOAD)},W=async()=>{te.value=!0;try{I.value.style.left="0px",I.value.style.height="0px",await y($e.value.id,z.value)}catch(ie){console.error("Failed to reorder column: ",ie)}finally{te.value=!1}$e.value=null,z.value=null};return{onDrag:ie=>{if(ie.preventDefault(),!ie.dataTransfer||!$e.value||!I.value)return;if(ie.clientX===0){W();return}const pe=I.value.getBoundingClientRect().top,be=document.elementsFromPoint(ie.clientX,pe).find(Ze=>Ze.classList.contains("nc-grid-column-header"));be&&(z.value=(be==null?void 0:be.getAttribute("data-col"))??null);const f=ie.clientX-p.value;f>=0&&(I.value.style.left=`${f.toString()}px`);const Se=parseFloat(getComputedStyle(document.documentElement).fontSize);f<p.value+1*Se?setTimeout(()=>{s.value.scrollLeft-=2.5},250):le.value-f-p.value<15*Se&&setTimeout(()=>{s.value.scrollLeft+=2.5},250)},onDragStart:(ie,pe)=>{var Ze;if(!pe.dataTransfer)return;const j=document.querySelector('[data-testid="drag-icon-placeholder"]');pe.dataTransfer.dropEffect="none",pe.dataTransfer.effectAllowed="none",pe.dataTransfer.setDragImage(j,10,10),pe.dataTransfer.clearData(),pe.dataTransfer.setData("text/plain",ie),$e.value=v.value.find(de=>de.id===ie)??null;const be=parseFloat(getComputedStyle(document.documentElement).fontSize),f=((Ze=h.value)==null?void 0:Ze.getBoundingClientRect().height)??6.1*be;I.value.style.height=`${f}px`;const Se=pe.clientX-p.value;Se>=0&&I.value&&(I.value.style.left=`${Se.toString()}px`)},onDragEnd:async ie=>{ie.preventDefault(),await ba(()=>!te.value).toBeTruthy(),!(!ie.dataTransfer||!$e.value||!z.value)&&W()},draggedCol:$e,dragColPlaceholderDomRef:I,toBeDroppedColId:z}},li=({changePage:v,paginationDataRef:h})=>{const{isViewDataLoading:s}=$o(oa()),M=()=>Math.ceil(h.value.totalRows/h.value.pageSize),n=async g=>{s.value=!0;try{await(v==null?void 0:v(g)),s.value=!1}catch(ue){if(ol.isCancel(ue))return;s.value=!1}};return{onLeft:async g=>{if(Yt()||!g.altKey)return;g.preventDefault();const ue=h.value.page-1;ue<1||await n(ue)},onRight:async g=>{if(Yt()||!g.altKey)return;g.preventDefault();const ue=h.value.page+1;ue>M()||await n(ue)},onUp:async g=>{Yt()||g.altKey&&(g.preventDefault(),await n(1))},onDown:async g=>{Yt()||g.altKey&&(g.preventDefault(),await n(M()))}}},ri=li,ii=wt(()=>gt(()=>import("./DB67bFVD.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(v=>v.default||v)),si=wt(()=>gt(()=>import("./CBS-34pK.js"),__vite__mapDeps([6,1,2,7,8,9]),import.meta.url).then(v=>v.default||v)),ui=wt(()=>gt(()=>import("./DAGOJ60z.js"),__vite__mapDeps([10,11,1,2,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,4,34,35,36,37,38,39,40,41,3,7,8,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56]),import.meta.url).then(v=>v.default||v)),di=wt(()=>gt(()=>import("./B7f52wKv.js"),__vite__mapDeps([57,1,2,3,8,58]),import.meta.url).then(v=>v.default||v)),ci=wt(()=>gt(()=>import("./Dtgb-V7U.js"),__vite__mapDeps([59,1,2,60,43,61,3,62,4,8,63]),import.meta.url).then(v=>v.default||v)),pi=wt(()=>gt(()=>import("./BlhRk6zn.js"),__vite__mapDeps([64,60,43,1,2,61,3,62,4]),import.meta.url).then(v=>v.default||v)),fi=wt(()=>gt(()=>import("./DlZ1svvA.js"),__vite__mapDeps([65,66,1,2,37,28,18,38,20,19,67,68,69,70,71,72,16,17,21,22,73]),import.meta.url).then(v=>v.default||v)),vi=wt(()=>gt(()=>import("./Bc4ZV0ZA.js"),__vite__mapDeps([74,1,2,75,76,77,78,24,79,80,47,68,69,70,71,72,81,82,83,84,85,86,87,88,89,90,91,92,93,16,17,18,19,20,21,22,94,95,96,43,60,61,3,62,4,97,98,99,100,101,102,103,12,13,104,105,42,106,107,30,108,8,109,110,50,111,112,113]),import.meta.url).then(v=>v.default||v)),Sa=v=>(or("data-v-6e021d12"),v=v(),ar(),v),mi=Sa(()=>k("div",{"data-testid":"drag-icon-placeholder",class:"absolute w-1 h-1 pointer-events-none opacity-0"},null,-1)),wi={class:"flex items-center justify-center bg-white/80 absolute l-0 t-0 w-full h-full z-10 pb-10 pointer-events-none"},gi={class:"flex flex-col items-center justify-center gap-2"},hi=["innerHTML"],yi={key:0},_i={class:"nc-grid-header"},bi={class:"w-full h-full flex pl-2 pr-1 items-center","data-testid":"nc-check-all"},ki=Sa(()=>k("span",{class:"flex-1"},null,-1)),xi={key:1,class:"text-gray-500"},Ri=["data-col","data-title"],$i=["data-col","data-title","onXcstartresizing","onXcresize","onXcresizing","onClick"],Si=["draggable","onDragstart"],Di={class:"absolute top-0 left-0 h-8 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},Ai={class:"h-full w-[60px] flex items-center justify-center"},Mi={class:"flex flex-row items-center py-3"},Ci={class:"text-xs pl-2"},Ei=["onClick"],Li={class:"text-xs pl-2"},Vi={class:"text-red-500 text-xs pl-2"},Fi={class:"text-xs pl-2"},zi={class:"flex flex-row items-center py-3"},Pi={class:"text-xs pl-2"},Ni=["onClick"],Oi={class:"text-xs pl-2"},Ii={class:"text-xs pl-2"},Ti={class:"nc-edit-or-add-provider-wrapper"},Gi={class:"!border-0 relative !xs:hidden",style:{borderWidth:"0px !important"}},Bi=["data-testid"],Ui=["data-testid"],Hi={class:"w-[60px] pl-2 pr-1 items-center flex gap-1"},Yi=Sa(()=>k("span",{class:"flex-1"},null,-1)),Wi=["data-testid"],Ki=["onClick"],ji={key:2,class:"cursor-pointer flex items-center border-1 border-gray-100 active:ring rounded p-1 hover:bg-gray-50"},Xi={key:0,class:"w-full"},qi={key:0,class:"w-full"},Qi=["colspan"],Ji={class:"flex gap-2 items-center"},Zi={key:0,class:"flex gap-2 items-center"},es={key:1,class:"flex gap-2 items-center"},ts={class:"flex gap-2 items-center"},os={class:"flex gap-2 items-center"},as={class:"flex gap-2 items-center"},ns={class:"flex gap-2 items-center"},ls={class:"flex gap-2 items-center"},rs={class:"flex gap-2 items-center"},is={class:"flex gap-2 items-center"},ss={class:"relative"},us={class:"flex ml-1"},ds={"data-testid":"nc-pagination-add-record",class:"flex items-center px-2 text-gray-600 hover:text-black"},cs={class:"relative overflow-visible min-h-17 w-10"},ps={class:"flex flex-row items-center justify-between w-full"},fs={class:"flex flex-row items-center justify-start gap-x-3"},vs={class:"flex flex-row text-xs text-gray-400 ml-7.25"},ms={class:"flex flex-row items-center justify-between w-full"},ws={class:"flex flex-row items-center justify-start gap-x-2.5"},gs={class:"flex flex-row text-xs text-gray-400 ml-7.05"},hs={key:0,class:"absolute bottom-12 left-2"},ys={class:"flex"},_s={class:"flex items-center gap-2"},bs={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},ks={class:"flex flex-row items-center justify-start gap-x-3"},xs={class:"flex flex-row items-center justify-start gap-x-3"},Fn=!1,Jo=10,Rs=So({__name:"Table",props:{data:{},paginationData:{},loadData:{type:Function},changePage:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},selectedAllRecords:{type:Boolean},deleteRangeOfRows:{type:Function},rowHeight:{},expandForm:{type:Function},deleteSelectedRows:{type:Function},removeRowIfNew:{type:Function},bulkUpdateRows:{type:Function},headerOnly:{type:Boolean},hideHeader:{type:Boolean},hideCheckbox:{type:Boolean},pagination:{},disableSkeleton:{type:Boolean},disableVirtualX:{type:Boolean},disableVirtualY:{type:Boolean}},emits:["update:selectedAllRecords","bulkUpdateDlg","toggleOptimisedQuery"],setup(v,{expose:h,emit:s}){const M=v,n=s,G=xa(M,"selectedAllRecords",n),L=ao(M,"paginationData"),E=ao(M,"data"),Ke=ao(M,"pagination"),g=ao(M,"headerOnly"),ue=ao(M,"hideHeader"),p=ao(M,"disableSkeleton"),le=ao(M,"disableVirtualX"),te=ao(M,"disableVirtualY"),{api:$e}=Gn(),{loadData:I,changePage:z,callAddEmptyRow:m,updateOrSaveRow:y,deleteRow:W,expandForm:ke,deleteSelectedRows:re,deleteRangeOfRows:ge,removeRowIfNew:ie,bulkUpdateRows:pe}=M,j=Ie(aa,_()),be=Ie(Ra,_()),f=Ie(ea,_([])),Se=Ie(Hn,_(!1)),Ze=Ie(Bl,_(!1)),de=Ie(ta,_(!1)),De=Ie(Yn,_(!1)),et=Ul(),he=Ie(na,Ro()),Te=Ie(Hl,Ro()),{isMobileMode:i}=Tn(),se=Ie(Wn,_()),{isPkAvail:a,isSqlView:V,eventBus:oe}=Uo(),{isViewDataLoading:b,isPaginationLoading:F}=$o(oa()),{$e:P}=Nn(),{t:X}=Bo(),{getMeta:ve}=In(),{addUndo:q,clone:tt,defineViewScope:xt}=ka(),{isViewColumnsLoading:It,updateGridViewColumn:Vt,gridViewCols:J,resizingColOldWith:Do}=la(),{isExpandedFormCommentMode:ae}=$o(yr()),{predictingNextColumn:nt,predictedNextColumn:dt,predictingNextFormulas:wo,predictedNextFormulas:Ao,predictNextColumn:ro,predictNextFormulas:go}=_r().table,{paste:Fo}=Pr(),{addLTARRef:Mo,syncLTARRefs:Pe,clearLTARCell:r,cleaMMCell:u}=br(),{loadViewAggregate:c}=Fr(),ne=_(null),ye=_(),N=_(),me=_(),_e=_(),{height:Dt,width:Tt}=Yl(N),rt=U(()=>It.value||!j.value),it=_(!1),{isUIAllowed:At,isDataReadOnly:at}=Bn(),Ae=U(()=>At("dataEdit")),Mt=U(()=>!Se.value&&!Ze.value&&At("fieldAdd")&&!V.value),{onDrag:io,onDragStart:so,onDragEnd:uo,draggedCol:Gt,dragColPlaceholderDomRef:ce,toBeDroppedColId:O}=ni({fields:f,tableBodyEl:me,gridWrapper:ye}),{onLeft:ft,onRight:Le,onUp:st,onDown:ht}=ri({paginationDataRef:L,changePage:z}),we=_(!1),He=_(!1),lt=_(!1),ut=_(!1),Me=_(),ot=_(!1),K=_(!0),Z=_(!1),Ne=_(null),H=_(!1),qt=_(!1),co=_(!1),Rt=U({get:()=>{var t;return(t=M.data)!=null&&t.some(o=>o.rowMeta.selected)&&at.value?!1:co.value},set:t=>{co.value=t}}),Ft=_(!1),Ge=_(null),zt=(t,o)=>{V.value||(t.preventDefault(),o&&(Ge.value=o))},zo=_(!1);St(Wl,zo);const Qt=_(!1);async function Aa(t,o=!1){if(at.value||!t||!Ae.value||!ya(f.value[t.col])&&jt(f.value[t.col])||Jt.value[t.col].isReadonly)return;const d=E.value[t.row],D=f.value[t.col];if(jt(D)){let Ve;no(D)&&d&&(Ve=await u(d,D)),q({undo:{fn:async(Y,_t,xe,Be,je)=>{var Re,Ue,$t,Kt,Nt;if(((Re=L.value)==null?void 0:Re.pageSize)===Be.pageSize){((Ue=L.value)==null?void 0:Ue.page)!==Be.page&&await(z==null?void 0:z(Be.page));const vt=pt(xe.row,($t=j.value)==null?void 0:$t.columns),Bt=E.value[Y.row],Ct=f.value[Y.col];if(Ct.title&&vt===pt(Bt.row,(Kt=j.value)==null?void 0:Kt.columns)&&Ct.id===_t.id)lo(Ct)||mo(Ct)?(Bt.row[Ct.title]=xe.row[Ct.title],await Mo(Bt,Bt.row[Ct.title],Ct),await Pe(Bt,Bt.row)):no(Ct)&&(await $e.dbDataTableRow.nestedLink((Nt=j.value)==null?void 0:Nt.id,Ct.id,encodeURIComponent(vt),je),Bt.row[Ct.title]=je!=null&&je.length?je==null?void 0:je.length:null),w.col=Y.col,w.row=Y.row,Oe==null||Oe();else throw new Error(X("msg.recordCouldNotBeFound"))}else throw new Error(X("msg.pageSizeChanged"))},args:[tt(t),tt(D),tt(d),tt(L.value),Ve]},redo:{fn:async(Y,_t,xe,Be)=>{var je,Re,Ue,$t;if(((je=L.value)==null?void 0:je.pageSize)===Be.pageSize){((Re=L.value)==null?void 0:Re.page)!==Be.page&&await(z==null?void 0:z(Be.page));const Kt=pt(xe.row,(Ue=j.value)==null?void 0:Ue.columns),Nt=E.value[Y.row],vt=f.value[Y.col];if(Kt===pt(Nt.row,($t=j.value)==null?void 0:$t.columns)&&vt.id===_t.id)lo(vt)||mo(vt)?await r(Nt,vt):no(vt)&&await u(Nt,vt),w.col=Y.col,w.row=Y.row,Oe==null||Oe();else throw new Error(X("msg.recordCouldNotBeFound"))}else throw new Error(X("msg.pageSizeChanged"))},args:[tt(t),tt(D),tt(d),tt(L.value)]},scope:xt({view:be.value})}),(lo(D)||mo(D))&&await r(d,D);return}if(D.title)switch(D.uidt){case $.Checkbox:d.row[D.title]=!1;break;case $.Rating:d.row[D.title]=0;break;default:d.row[D.title]=null;break}o||await(y==null?void 0:y(d,D.title))}function ra(t,o){if(!(!Ae.value||H.value||Fn||Se.value||ga(o))){if(!a.value&&!t.rowMeta.new){ze.info(X("msg.info.updateNotAllowedWithoutPK"));return}if(o.ai){ze.info(X("msg.info.autoIncFieldNotEditable"));return}if(o.pk&&!t.rowMeta.new){ze.info(X("msg.info.editingPKnotSupported"));return}if(![$.SingleSelect,$.MultiSelect].includes(o.uidt))return H.value=!0}}const po=U(()=>!Fn&&Ae.value&&!V.value&&!de.value),Ma=U(()=>{var t;return(t=f.value)==null?void 0:t.length}),nl=U(()=>{const t=[];return g.value!==!0?se.value||t.push("nc-scrollbar-x-lg !overflow-auto"):t.push("overflow-visible"),b.value&&t.push("!overflow-hidden"),t.join(" ")}),Ca=U(()=>{var o;let t=((o=f.value)==null?void 0:o.length)??40;return t=t||40,Array.from({length:t+1}).map(()=>({}))}),ll=U(()=>Array.from({length:40}).map(()=>({}))),Co=U(()=>p.value!==!0&&(b.value||F.value||rt.value)||!j.value),ia=U(()=>E.value.map(t=>f.value.map(o=>({isColumnRequiredAndNull:mr(o,t.row)})))),Ea=t=>ga(t)||kr(t)||xr(t)||Rr(t)||jt(t)||Xl(t)||ql(t),Jt=U(()=>f.value.map(t=>({isVirtualCol:jt(t),isReadonly:Ea(t)})));function rl(t){pa("smooth"),setTimeout(()=>{we.value=!0,Me.value=t},500)}const La=(t=!1)=>{Ne.value=null,we.value=!1,Me.value={},t&&setTimeout(()=>{pa("smooth")},200)};async function Va(){const t=Zt(E.value.length,!0);t&&(ke==null||ke(t,void 0,!0))}const il=()=>{Te.trigger()},Fa=()=>{K.value=!0,Zt()},Eo=()=>{K.value=!1,il()},sl=(t,o,d)=>{var Re,Ue;const D=o.getBoundingClientRect(),Ve=15,Y=((Re=o.querySelector("thead th:nth-child(1)"))==null?void 0:Re.getBoundingClientRect().width)??0,_t=((Ue=o.querySelector("thead th:nth-child(2)"))==null?void 0:Ue.getBoundingClientRect().width)??0,xe=Y+_t,Be={right:t.right+Y-D.width-o.scrollLeft,left:t.left+Y-o.scrollLeft-xe,bottom:t.bottom-D.height-o.scrollTop,top:t.top-o.scrollTop},je={top:0,left:0};return je.left=Be.right+((d==null?void 0:d.right)||0)>0?o.scrollLeft+Be.right+((d==null?void 0:d.right)||0)+Ve:Be.left-((d==null?void 0:d.left)||0)<0?o.scrollLeft+Be.left-((d==null?void 0:d.left)||0)-Ve:o.scrollLeft,je.top=Be.bottom+((d==null?void 0:d.bottom)||0)>0?o.scrollTop+Be.bottom+((d==null?void 0:d.bottom)||0)+Ve:Be.top-((d==null?void 0:d.top)||0)<0?o.scrollTop+Be.top-((d==null?void 0:d.top)||0)-Ve:o.scrollTop,je},{selectRangeMap:Ho,fillRangeMap:za,activeCell:w,handleMouseDown:Pa,handleMouseOver:Na,handleCellClick:ul,clearSelectedRange:Pt,copyValue:dl,isCellActive:Oa,resetSelectedRange:cl,makeActive:Yo,selectedRange:fe,isFillMode:Ia}=Nr(j,f,E,H,a,Rt,Aa,Ba,ra,Oe,async t=>{var Ve,Y,_t,xe,Be,je,Re,Ue,$t,Kt,Nt;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return t.preventDefault(),!0;if(Yt())return;if(Go())return!0;const d=To()?t.metaKey:t.ctrlKey,D=t.altKey;if(t.key===" "){const vt=Yt();if(Oa.value&&!H.value&&Ae.value&&w.row!==null&&!vt){t.preventDefault();const Bt=E.value[w.row];return ke==null||ke(Bt),!0}}else if(t.key==="Escape"){if(H.value)return H.value=!1,!0}else if(t.key==="Enter"){if(t.shiftKey)return!0;if(H.value)return H.value=!1,!0}else if(t.key==="Tab"){if(t.shiftKey&&w.row===0&&w.col===0&&!((Ve=L.value)!=null&&Ve.isFirstPage))return t.preventDefault(),await Po((((Y=L.value)==null?void 0:Y.pageSize)??25)-1,((_t=f.value)==null?void 0:_t.length)-1,-1),!0;if(!t.shiftKey&&w.row===E.value.length-1&&w.col===((xe=f.value)==null?void 0:xe.length)-1){if(t.preventDefault(),(Be=L.value)!=null&&Be.isLastPage&&po.value)return Qt.value=!0,!0;if(!((je=L.value)!=null&&je.isLastPage))return await Po(0,0,1),!0}}else if(!d&&!t.shiftKey&&t.key==="ArrowUp"){if(w.row===0&&!((Re=L.value)!=null&&Re.isFirstPage))return t.preventDefault(),await Po((((Ue=L.value)==null?void 0:Ue.pageSize)??25)-1,w.col,-1),!0}else if(!d&&!t.shiftKey&&t.key==="ArrowDown"&&w.row===E.value.length-1){if(t.preventDefault(),($t=L.value)!=null&&$t.isLastPage&&po.value)return Qt.value=!0,!0;if(!((Kt=L.value)!=null&&Kt.isLastPage))return await Po(0,w.col,1),!0}if(d){if(!Oa.value||t.shiftKey)return;switch(t.key){case"ArrowUp":return t.preventDefault(),Pt(),w.row=0,w.col=w.col??0,Oe==null||Oe(),H.value=!1,!0;case"ArrowDown":return t.preventDefault(),Pt(),w.row=E.value.length-1,w.col=w.col??0,Oe==null||Oe(),H.value=!1,!0;case"ArrowRight":return t.preventDefault(),Pt(),w.row=w.row??0,w.col=((Nt=f.value)==null?void 0:Nt.length)-1,Oe==null||Oe(),H.value=!1,!0;case"ArrowLeft":return t.preventDefault(),Pt(),w.row=w.row??0,w.col=0,Oe==null||Oe(),H.value=!1,!0}}if(D)switch(t.keyCode){case 82:{po.value&&(P("c:shortcut",{key:"ALT + R"}),Zt(),w.row=E.value.length-1,w.col=0,cl(),Vo(()=>{var vt;(vt=document.querySelector("td.cell.active"))==null||vt.scrollIntoView({behavior:"smooth"})}));break}case 67:{Mt.value&&(P("c:shortcut",{key:"ALT + C"}),pa(void 0),setTimeout(()=>{we.value=!0},250));break}}},async t=>{const o=E.value[t.row],d=t.col!==void 0?f.value[t.col]:null;!o||!d||!t.updatedColumnTitle&&jt(d)||(E.value[t.row].rowMeta.isUpdatedFromCopyNPaste={...E.value[t.row].rowMeta.isUpdatedFromCopyNPaste,[t.updatedColumnTitle||d.title]:!0},await(y==null?void 0:y(o,t.updatedColumnTitle||d.title)))},pe,_e,be,L,z);function Ta(t){Pt(),Yo(t??E.value.length-1,0),fe.startRange({row:w.row,col:w.col}),Oe==null||Oe()}async function pl(t){await(y==null?void 0:y(t))}function Zt(t,o=!1){const d=m==null?void 0:m(t);return!o&&d&&pl(d),Vo().then(()=>{Ta(t??E.value.length-1)}),d}const fl=t=>{try{W==null||W(t),fe.isRowInRange(t)&&Pt(),w.row===t&&(w.row=null,w.col=null)}catch(o){ze.error(o.message)}},vl=t=>{try{ae.value=!0;const o=E.value[t];ke&&ke(o),w.row=null,w.col=null,fe.clear()}catch(o){ze.error(o.message)}},ml=()=>{ge==null||ge(fe).then(()=>{Pt(),w.row=null,w.col=null})},Ga=t=>{if(it.value){it.value=!1;return}const o=f.value.findIndex(d=>d.id===t);o!==-1&&(Yo(0,o),fe.startRange({row:0,col:o}),fe.endRange({row:E.value.length-1,col:o}))};Kl(me,t=>{if(ot.value||it.value||Rt.value||w.row===null||w.col===null||Yt())return;const d=f.value[w.col];if(H.value&&(jt(d)||d.uidt===$.JSON)||Ia.value)return;const D=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-dropdown-user-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active,.nc-link-dropdown-root");t.target&&D&&(D===t.target||D!=null&&D.contains(t.target))||Go()||(Pt(),w.row=null,w.col=null)});const Wo=t=>{if(!(w.row===null||w.col===null)){switch(H.value=!1,Pt(),t){case vo.NEXT:w.row<E.value.length-1||Zt(),w.row++;break;case vo.PREV:w.row>0&&w.row--;break}Vo(()=>{Oe()})}};async function Ba(){if(!Ae.value||at.value)return;const t=fe.start,o=fe.end,d=Math.min(t.row,o.row),D=Math.max(t.row,o.row),Ve=Math.min(t.col,o.col),Y=Math.max(t.col,o.col),_t=f.value.slice(Ve,Y+1),xe=E.value.slice(d,D+1),Be=[];let je=!1;for(const Re of xe)for(const Ue of _t)if(!(!Re||!Ue||!Ue.title)){if(jt(Ue)){(lo(Ue)||mo(Ue)||no(Ue))&&!je&&(ze.info(X("msg.info.groupClearIsNotSupportedOnLinksColumn")),je=!0);continue}Ea(Ue)||(Re.row[Ue.title]=null,Be.push(Ue.title))}await(pe==null?void 0:pe(xe,Be))}const yt=U(()=>f.value.filter(t=>t.id&&J.value[t.id]&&J.value[t.id].width&&J.value[t.id].show).map(t=>+J.value[t.id].width.replace("px","")||200).reduce((t,o,d)=>(t.push(t[d]+o),t),[0])),Ye=U(()=>se.value||ye.value),Ua=_();function Oe(t,o){if(t=t??w.row,o=o??w.col,t!==null&&o!==null&&Ye.value){const d={top:t*fo[`${M.rowHeight}`],left:yt.value[o],right:o===f.value.length-1?yt.value[yt.value.length-1]+200:yt.value[o+1],bottom:(t+1)*fo[`${M.rowHeight}`]},D=sl(d,Ye.value,{top:9,bottom:(Dt.value||40)+9,right:9});if(De.value&&(D.top=Ye.value.scrollTop),o===0&&(D.left=0),t===E.value.length-1){Ye.value.scrollTo({top:De.value?Ye.value.scrollTop:Ye.value.scrollHeight,left:o===f.value.length-1?Ye.value.scrollWidth:D.left,behavior:"smooth"});return}if(o===f.value.length-1){Ye.value.scrollTo({top:D.top,left:Ye.value.scrollWidth,behavior:"smooth"});return}Ye.value.scrollTo({top:D.top,left:D.left,behavior:"smooth"})}}async function Po(t,o,d){var D;Pt(),d!==void 0&&((D=L.value)!=null&&D.page)?(await(z==null?void 0:z(L.value.page+d)),await Vo(),Yo(t,o)):(Yo(t,o),await Vo()),Oe==null||Oe()}const Ko=_([]),sa=async(t={})=>{var o;for(const d of t.data||E.value)if(!d.rowMeta.fromExpandedForm){if(d.rowMeta.new){const D=tt(d);await(y==null?void 0:y(d,"",d.rowMeta.ltarState||{},t))?d.rowMeta.changed=!1:t.keepNewRecords&&D.rowMeta.new&&Object.keys(D.row).length&&Ko.value.push(D);continue}if(d.rowMeta.changed){d.rowMeta.changed=!1;for(const D of((o=t.metaValue||j.value)==null?void 0:o.columns)??[])jt(D)||D.uidt===$.Attachment||D.title in d.row&&d.row[D.title]!==d.oldRow[D.title]&&await(y==null?void 0:y(d,D.title,{},t))}}},Ha=(t,o)=>{t&&Vt(t,{width:o.detail})},Ya=(t,o)=>{t&&(J.value[t].width=`${o.detail}`)},Wa=(t,o)=>{t&&(Do.value=o.detail,it.value=!0)},Ka=(t,o,d)=>{Me.value={title:t,uidt:o,colOptions:d},lt.value=!1},wl=U(()=>yt.value[yt.value.length-1]+64),gl=U(()=>E.value.length*fo[`${M.rowHeight}`]),ho=_({start:0,end:0}),Lo=_({start:0,end:0}),yo=()=>{if(!Ye.value||!ye.value){ho.value={start:0,end:0},Lo.value={start:0,end:0},setTimeout(yo,100);return}let t=0;if(le.value!==!0){let o=0,d=yt.value.length-1;for(;d!==o;){const Y=Math.floor((d-o)/2+o);if(yt.value[Y]<=Ye.value.scrollLeft&&yt.value[Y+1]>Ye.value.scrollLeft){t=Y;break}if(Y===o){t=d;break}else yt.value[Y]<=Ye.value.scrollLeft?o=Y:d=Y}let D=0,Ve=!1;for(let Y=t;Y<yt.value.length;Y++)if(yt.value[Y]>ye.value.clientWidth+Ye.value.scrollLeft){D=Y,Ve=!0;break}ho.value={start:Math.max(0,t-Jo),end:Ve?Math.min(f.value.length,D+Jo):f.value.length}}if(te.value!==!0){const o=fo[`${M.rowHeight}`],d=Math.max(0,Math.floor(Ye.value.scrollTop/o)-Jo),D=Math.min(E.value.length,d+Math.ceil(ye.value.clientHeight/o)+Jo);Lo.value={start:d,end:D}}},ja=U(()=>le.value?f.value.map((o,d)=>({field:o,index:d})).filter(o=>o.index!==0):f.value.slice(ho.value.start,ho.value.end).map((o,d)=>({field:o,index:d+ho.value.start})).filter(o=>o.index!==0)),hl=U(()=>te.value?E.value.map((t,o)=>({row:t,index:o})):E.value.slice(Lo.value.start,Lo.value.end).map((t,o)=>({row:t,index:o+Lo.value.start}))),eo=U(()=>ho.value.start>0?yt.value[ho.value.start]-yt.value[1]:0),yl=U(()=>fo[`${M.rowHeight}`]*Lo.value.start),Xa=_(),qa=_(),ua=()=>{Vo(()=>{const t=isNaN(fe.end.row)?w.row:fe.end.row,o=isNaN(fe.end.col)?w.col:fe.end.col;if(t!==null&&o!==null){if(!Ye.value||!ye.value)return;Xa.value=(t+1)*fo[`${M.rowHeight}`]+(ue.value?0:32),qa.value=64+yt.value[o+1]+(o===0?Math.max(0,Ye.value.scrollLeft-ye.value.offsetLeft):0)}})},jo=U(()=>fe.isEmpty()&&w.col&&Jt.value[w.col].isReadonly||!fe.isEmpty()&&Array.from({length:fe.end.col-fe.start.col+1}).every((t,o)=>Jt.value[fe.start.col+o].isReadonly)),_l=U(()=>{var t,o;return!at.value&&!Se.value&&!H.value&&(!fe.isEmpty()||w.row!==null&&w.col!==null)&&!((o=(t=E.value[(isNaN(fe.end.row)?w.row:fe.end.row)??-1])==null?void 0:t.rowMeta)!=null&&o.new)&&w.col!==null&&f.value[w.col]&&!b.value&&!F.value&&E.value.length&&!jo.value});ko([()=>fe.end.row,()=>fe.end.col,()=>w.row,()=>w.col],([t,o,d,D],[Ve,Y,_t,xe])=>{(t!==Ve||o!==Y||d!==_t||D!==xe)&&(yo(),ua())}),Zo(()=>{const t=new ResizeObserver(()=>{var o;ua(),w.row!==null&&!((o=E.value)!=null&&o[w.row])&&(Pt(),w.row=null,w.col=null)});ne.value&&t.observe(ne.value),ba(Ye).toBeTruthy().then(()=>yo())}),oe.on(async(t,o)=>{t===Wt.FIELD_ADD&&(Ne.value=o,we.value=!0),t===Wt.CLEAR_NEW_ROW&&(Pt(),w.row=null,w.col=null,ie==null||ie(o))});async function Qa(t){var o,d,D;if(t!=null&&t.shouldShowLoading&&(b.value=!0),(o=dt.value)!=null&&o.length){const Ve=(D=(d=j.value)==null?void 0:d.columns)==null?void 0:D.map(Y=>Y.title);dt.value=dt.value.filter(Y=>!(Ve!=null&&Ve.includes(Y.title)))}await sa({keepNewRecords:!0}),await(I==null?void 0:I({...(t==null?void 0:t.offset)!==void 0?{offset:t.offset}:{}},t==null?void 0:t.shouldShowLoading)),Ko.value.length&&(E.value.push(...Ko.value),Ko.value=[]),yo(),b.value=!1}let da=null;Xt(Ye,"scroll",t=>{Ua.value=t.target.scrollLeft,da&&cancelAnimationFrame(da),da=requestAnimationFrame(()=>{yo(),ua()})}),Xt(document,"mousedown",t=>{var o,d;(t.offsetX>((o=t.target)==null?void 0:o.clientWidth)||t.offsetY>((d=t.target)==null?void 0:d.clientHeight))&&(ot.value=!0),t.target.closest(".nc-grid-cell:not(.caption)")&&(qt.value=!0)}),Xt(document,"mouseup",()=>{qt.value=!1,setTimeout(()=>{ot.value=!1},100)}),Xt(document,"keydown",async t=>{const o=Yt();t.key==="Alt"&&!o&&(He.value=!0)}),Xt(document,"keyup",async t=>{var Ve,Y;const o=Yt();t.key==="Alt"&&!o&&(He.value=!1,ut.value=!1);const d=document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"),D=To()?t.metaKey:t.ctrlKey;Qt.value&&!o&&!d&&!Go()&&!D&&!t.shiftKey&&!t.altKey&&(t.key==="Tab"&&w.row===E.value.length-1&&w.col===((Ve=f.value)==null?void 0:Ve.length)-1||t.key==="ArrowDown"&&w.row===E.value.length-1&&((Y=L.value)!=null&&Y.isLastPage)&&po.value)&&(Zt(),await Po(E.value.length-1,0),Qt.value=!1)}),Xt(document,"keydown",async t=>{const o=To()?t.metaKey:t.ctrlKey;if(t.altKey&&!t.shiftKey&&!o)switch(t.keyCode){case 78:{po.value&&Zt();break}}}),$a(async()=>{const t=be.value,o=E.value;t&&ve(t.fk_model_id,!1,!0).then(d=>{const D=d;D&&sa({metaValue:D,viewMetaValue:t,data:o})}),he==null||he.off(Qa),Te==null||Te.off(Va)}),he==null||he.on(Qa),Te==null||Te.on(Va),ko(Rt,()=>{Rt.value?Ft.value=!1:(Ft.value=!0,Ge.value=null)}),ko(()=>et.params.viewId,()=>{b.value=!0}),ko(be,async(t,o)=>{try{if(t&&t.id!==(o==null?void 0:o.id)&&(t.fk_model_id===et.params.viewId||de.value)){if(Z.value=!0,o!=null&&o.id){const d=await ve(o.fk_model_id,!1,!0);d&&await sa({viewMetaValue:o,metaValue:d,data:E.value})}b.value=!0;try{De.value?await(I==null?void 0:I()):await Promise.allSettled([I==null?void 0:I(),c()]),yo()}catch(d){ol.isCancel(d)||(console.log(d),ze.error(X("msg.errorLoadingData")))}finally{b.value=!1}}}catch(d){console.log(d)}finally{Z.value=!1}},{immediate:!0}),ko([()=>f.value.length,()=>E.value.length],()=>{yo()}),St(jl,ut),h({scrollToRow:Ta,openColumnCreate:rl});const ca=(t,o)=>{ke&&ke(t,o),w.row=null,w.col=null,fe.clear()},Ja=(t,o,d)=>{const D=E.value[o];if(i.value)return ca(D,f.value[d]);ul(t,o,d)},bl=U(()=>{var t,o,d,D;if(F.value)return(t=L.value)!=null&&t.totalRows&&((o=L.value)!=null&&o.pageSize)?`Loading page<br/>${L.value.page} of ${Math.ceil(((d=L.value)==null?void 0:d.totalRows)/((D=L.value)==null?void 0:D.pageSize))}`:X("general.loading")});function pa(t){var o;Ye.value&&((o=Ye.value)==null||o.scrollTo({top:Ye.value.scrollTop,left:Ye.value.scrollWidth,behavior:t}))}return qo("ArrowLeft",ft),qo("ArrowRight",Le),qo("ArrowUp",st),qo("ArrowDown",ht),(t,o)=>{var ln,rn,sn,un,dn,cn;const d=Ql,D=Dr,Ve=Ar,Y=ii,_t=si,xe=Kn,Be=ai,je=Sr,Re=Zn,Ue=Jr,$t=el,Kt=Jl,Nt=Kr,vt=ui,Bt=Zl,Ct=er,Za=di,en=ci,tn=zr,kl=pi,on=hr,xl=Br,an=tl,Xo=jn,Rl=tr,$l=fi,Sl=vi,nn=Dn("xc-ver-resize"),Qe=Dn("e");return l(),A("div",{class:Ee(["flex flex-col",`${e(g)!==!0?"h-full w-full":""}`])},[mi,k("div",{ref_key:"dragColPlaceholderDomRef",ref:ce,class:Ee([{"hidden w-0 !h-0 left-0 !max-h-0 !max-w-0":!e(Gt)},"absolute flex items-center z-40 top-0 h-full bg-gray-50 pointer-events-none opacity-60"])},[e(Gt)?(l(),A("div",{key:0,style:We({"min-width":((ln=e(J)[e(Gt).id])==null?void 0:ln.width)||"200px","max-width":((rn=e(J)[e(Gt).id])==null?void 0:rn.width)||"200px",width:((sn=e(J)[e(Gt).id])==null?void 0:sn.width)||"200px"}),class:"border-r-1 border-l-1 border-gray-200 h-full"},null,4)):B("",!0)],2),k("div",{ref_key:"gridWrapper",ref:ye,class:Ee(["nc-grid-wrapper min-h-0 flex-1 relative",e(nl)])},[Ce(k("div",wi,[k("div",gi,[T(d,{size:"xlarge"}),k("span",{class:"text-center",innerHTML:e(bl)},null,8,hi)])],512),[[Io,e(F)&&!e(g)]]),T(an,{visible:e(Rt),"onUpdate:visible":o[35]||(o[35]=Je=>Lt(Rt)?Rt.value=Je:null),trigger:e(V)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:C(()=>[T($t,{class:"!rounded !py-0",onClick:o[34]||(o[34]=Je=>Rt.value=!1)},{default:C(()=>{var Je;return[("isEeUI"in t?t.isEeUI:e(ma))&&!e(Ft)&&!e(Ge)&&t.data.some(mt=>mt.rowMeta.selected)&&!e(at)?(l(),x(Re,{key:0,onClick:o[28]||(o[28]=mt=>n("bulkUpdateDlg"))},{default:C(()=>[Ce((l(),A("div",Ji,[(l(),x(oo(("iconMap"in t?t.iconMap:e(_o)).ncEdit))),Fe(" "+ee(t.$t("title.updateSelectedRows")),1)])),[[Qe,["a:row:update-bulk"]]])]),_:1})):B("",!0),!e(Ft)&&!e(Ge)&&t.data.some(mt=>mt.rowMeta.selected)&&!e(at)?(l(),x(Re,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50","data-testid":"nc-delete-row",onClick:e(re)},{default:C(()=>[t.data.filter(mt=>mt.rowMeta.selected).length===1?Ce((l(),A("div",Zi,[(l(),x(oo(("iconMap"in t?t.iconMap:e(_o)).delete))),Fe(" "+ee(t.$t("activity.deleteSelectedRow")),1)])),[[Qe,["a:row:delete"]]]):Ce((l(),A("div",es,[(l(),x(oo(("iconMap"in t?t.iconMap:e(_o)).delete))),Fe(" "+ee(t.$t("activity.deleteSelectedRow")),1)])),[[Qe,["a:row:delete-bulk"]]])]),_:1},8,["onClick"])):B("",!0),e(Ge)?(l(),x(Re,{key:2,class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:o[29]||(o[29]=mt=>e(dl)(e(Ge)))},{default:C(()=>[Ce((l(),A("div",ts,[T(xe,{icon:"copy"}),Fe(" "+ee(t.$t("general.copy")),1)])),[[Qe,["a:row:copy"]]])]),_:1})):B("",!0),e(Ge)&&e(Ae)&&!e(at)?(l(),x(Re,{key:3,class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(jo),onClick:e(Fo)},{default:C(()=>[Ce((l(),A("div",os,[T(xe,{icon:"paste"}),Fe(" "+ee(t.$t("general.paste")),1)])),[[Qe,["a:row:paste"]]])]),_:1},8,["disabled","onClick"])):B("",!0),e(Ge)&&e(Ae)&&e(fe).isSingleCell()&&(e(ya)(e(f)[e(Ge).col])||!((Je=e(ia)[0])!=null&&Je[e(Ge).col].isVirtualCol))&&!e(at)?(l(),x(Re,{key:4,class:"nc-base-menu-item",disabled:e(jo),"data-testid":"context-menu-item-clear",onClick:o[30]||(o[30]=mt=>Aa(e(Ge)))},{default:C(()=>[Ce((l(),A("div",as,[T(xe,{icon:"close"}),Fe(" "+ee(t.$t("general.clear")),1)])),[[Qe,["a:row:clear"]]])]),_:1},8,["disabled"])):e(Ge)&&e(Ae)&&!e(at)?(l(),x(Re,{key:5,class:"nc-base-menu-item",disabled:e(jo),"data-testid":"context-menu-item-clear",onClick:o[31]||(o[31]=mt=>Ba())},{default:C(()=>[Ce((l(),A("div",ns,[T(xe,{icon:"closeBox",class:"text-gray-500"}),Fe(" "+ee(t.$t("general.clear")),1)])),[[Qe,["a:row:clear-range"]]])]),_:1},8,["disabled"])):B("",!0),e(Ge)&&e(fe).isSingleCell()&&e(At)("commentEdit")&&!e(i)?(l(),A(qe,{key:6},[T(on),T(Re,{class:"nc-base-menu-item",onClick:o[32]||(o[32]=mt=>vl(e(Ge).row))},{default:C(()=>[Ce((l(),A("div",ls,[T(xl,{class:"h-4 w-4"}),Fe(" "+ee(t.$t("general.comment")),1)])),[[Qe,["a:row:comment"]]])]),_:1})],64)):B("",!0),e(Ae)&&!e(at)?(l(),A(qe,{key:7},[!e(Ft)&&!e(Ge)&&t.data.some(mt=>mt.rowMeta.selected)?B("",!0):(l(),x(on,{key:0})),e(Ge)&&(e(fe).isSingleCell()||e(fe).isSingleRow())?(l(),x(Re,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:o[33]||(o[33]=mt=>fl(e(Ge).row))},{default:C(()=>[Ce((l(),A("div",rs,[T(xe,{icon:"delete"}),Fe(" "+ee(t.$t("activity.deleteRow")),1)])),[[Qe,["a:row:delete"]]])]),_:1})):e(Ge)&&e(ge)?(l(),x(Re,{key:2,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:ml},{default:C(()=>[Ce((l(),A("div",is,[T(xe,{icon:"delete",class:"text-gray-500 text-red-600"}),Fe(" "+ee(t.$t("activity.deleteRows")),1)])),[[Qe,["a:row:delete"]]])]),_:1})):B("",!0)],64)):B("",!0)]}),_:1})]),default:C(()=>{var Je,mt,pn;return[k("div",null,[k("table",{class:Ee(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white sticky top-0 z-5 bg-white",{mobile:e(i),desktop:!e(i)}]),style:We({transform:`translateX(${e(eo)}px)`})},[Ce(k("thead",{ref_key:"tableHeadEl",ref:N},[e(rt)?(l(),A("tr",yi,[(l(!0),A(qe,null,Ut(e(Ca),(R,S)=>(l(),A("td",{key:S,class:Ee(["!bg-gray-50 h-full border-b-1 border-r-1",{"min-w-45":S!==0,"min-w-16":S===0}])},[T(D,{active:!0,title:!0,paragraph:!1,class:Ee(["ml-2 -mt-2",{"max-w-32":S!==0,"max-w-5 !ml-3.5":S===0}])},null,8,["class"])],2))),128))])):B("",!0),Ce(k("tr",_i,[k("th",{class:"w-[64px] min-w-[64px]","data-testid":"grid-id-column",style:We({left:`-${e(eo)}px`})},[k("div",bi,[!e(Se)&&!t.hideCheckbox?(l(),A(qe,{key:0},[k("div",{class:Ee(["nc-no-label text-gray-500",{hidden:e(G)}])},"#",2),k("div",{class:Ee([{hidden:!e(G),flex:e(G)},"nc-check-all w-full items-center"])},[T(Ve,{checked:e(G),"onUpdate:checked":o[0]||(o[0]=R=>Lt(G)?G.value=R:null)},null,8,["checked"]),ki],2)],64)):(l(),A("div",xi,"#"))])],4),e(f)[0]&&e(f)[0].id?Ce((l(),A("th",{key:0,"data-col":e(f)[0].id,"data-title":e(f)[0].title,style:We({"min-width":((Je=e(J)[e(f)[0].id])==null?void 0:Je.width)||"180px","max-width":((mt=e(J)[e(f)[0].id])==null?void 0:mt.width)||"180px",width:((pn=e(J)[e(f)[0].id])==null?void 0:pn.width)||"180px",...e(eo)>0?{left:`-${e(eo)-64}px`}:{}}),class:Ee(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(O)===e(f)[0].id}]),onXcstartresizing:o[4]||(o[4]=R=>Wa(e(f)[0].id,R)),onXcresize:o[5]||(o[5]=R=>Ha(e(f)[0].id,R)),onXcresizing:o[6]||(o[6]=R=>Ya(e(f)[0].id,R)),onClick:o[7]||(o[7]=R=>Ga(e(f)[0].id))},[k("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:"false",onDragstart:o[1]||(o[1]=Et(R=>e(so)(e(f)[0].id,R),["stop"])),onDrag:o[2]||(o[2]=Et(R=>e(io)(R),["stop"])),onDragend:o[3]||(o[3]=Et(R=>e(uo)(R),["stop"]))},[e(f)[0]&&e(Jt)[0].isVirtualCol?(l(),x(Y,{key:0,column:e(f)[0],"hide-menu":e(Se)||!!e(i)},null,8,["column","hide-menu"])):(l(),x(_t,{key:1,column:e(f)[0],"hide-menu":e(Se)||!!e(i)},null,8,["column","hide-menu"]))],32)],46,Ri)),[[nn]]):B("",!0),(l(!0),A(qe,null,Ut(e(ja),({field:R,index:S})=>{var Ot,to,No;return Ce((l(),A("th",{key:R.id,"data-col":R.id,"data-title":R.title,style:We({"min-width":((Ot=e(J)[R.id])==null?void 0:Ot.width)||"180px","max-width":((to=e(J)[R.id])==null?void 0:to.width)||"180px",width:((No=e(J)[R.id])==null?void 0:No.width)||"180px"}),class:Ee(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(O)===R.id}]),onXcstartresizing:bt=>Wa(R.id,bt),onXcresize:bt=>Ha(R.id,bt),onXcresizing:bt=>Ya(R.id,bt),onClick:bt=>Ga(R.id)},[k("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:e(i)||S===0||e(Se)||!e(Ae)?"false":"true",onDragstart:Et(bt=>e(so)(R.id,bt),["stop"]),onDrag:o[8]||(o[8]=Et(bt=>e(io)(bt),["stop"])),onDragend:o[9]||(o[9]=Et(bt=>e(uo)(bt),["stop"]))},[e(Jt)[S].isVirtualCol?(l(),x(Y,{key:0,column:R,"hide-menu":e(Se)||!!e(i)},null,8,["column","hide-menu"])):(l(),x(_t,{key:1,column:R,"hide-menu":e(Se)||!!e(i)},null,8,["column","hide-menu"]))],40,Si)],46,$i)),[[nn]])}),128)),e(Mt)?Ce((l(),A("th",{key:1,class:"cursor-pointer !border-0 relative !xs:hidden",style:{borderWidth:"0px !important"},onClick:o[20]||(o[20]=Et(R=>we.value=!0,["stop"]))},[k("div",Di,[T(Bt,{visible:e(we),"onUpdate:visible":o[18]||(o[18]=R=>Lt(we)?we.value=R:null),trigger:["click"],"overlay-class-name":"nc-dropdown-grid-add-column",onVisibleChange:o[19]||(o[19]=R=>lt.value=e(He))},An({default:C(()=>[k("div",Ai,[("isEeUI"in t?t.isEeUI:e(ma))&&(e(He)||e(lt))?(l(),x(xe,{key:0,icon:"magic",class:"text-sm text-orange-400"})):B("",!0),(l(),x(oo(("iconMap"in t?t.iconMap:e(_o)).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:2},[("isEeUI"in t?t.isEeUI:e(ma))&&e(lt)?{name:"overlay",fn:C(()=>[T($t,null,{default:C(()=>{var R;return[(R=e(dt))!=null&&R.length?(l(),x(Kt,{key:"predict-column"},{title:C(()=>[k("div",Mi,[T(Be,{class:"flex h-[1rem] text-gray-500"}),k("div",Ci,ee(t.$t("activity.predictColumns")),1),T(je,{class:"text-gray-500 ml-2"})])]),expandIcon:C(()=>[]),default:C(()=>[T($t,null,{default:C(()=>[(l(!0),A(qe,null,Ut(e(dt),S=>(l(),x(Re,{key:`predict-${S.title}-${S.type}`},{default:C(()=>[k("div",{class:"flex flex-row items-center py-3",onClick:Ot=>Ka(S.title,S.type)},[k("div",Li,ee(S.title),1)],8,Ei)]),_:2},1024))),128)),T(Re,null,{default:C(()=>[k("div",{class:"flex flex-row items-center py-3",onClick:o[10]||(o[10]=(...S)=>e(ro)&&e(ro)(...S))},[k("div",Vi,[T(Ue),Fe(" Generate Again ")])])]),_:1})]),_:1})]),_:1})):(l(),x(Re,{key:1},{default:C(()=>[k("div",{class:"flex flex-row items-center py-3",onClick:o[11]||(o[11]=(...S)=>e(ro)&&e(ro)(...S))},[e(nt)?(l(),x(Ue,{key:0,class:"animate-infinite animate-spin"})):(l(),x(Be,{key:1,class:"flex h-[1rem] text-gray-500"})),k("div",Fi,ee(t.$t("activity.predictColumns")),1)])]),_:1})),e(Ao)?(l(),x(Kt,{key:"predict-formula"},{title:C(()=>[k("div",zi,[T(Nt,{class:"flex h-[1rem] text-gray-500"}),k("div",Pi,ee(t.$t("activity.predictFormulas")),1),T(je,{class:"text-gray-500 ml-2"})])]),expandIcon:C(()=>[]),default:C(()=>[T($t,null,{default:C(()=>[(l(!0),A(qe,null,Ut(e(Ao),S=>(l(),x(Re,{key:`predict-${S.title}-formula`},{default:C(()=>[k("div",{class:"flex flex-row items-center py-3",onClick:Ot=>Ka(S.title,"Formula",{formula_raw:S.formula})},[k("div",Oi,ee(S.title),1)],8,Ni)]),_:2},1024))),128))]),_:1})]),_:1})):(l(),x(Re,{key:3},{default:C(()=>[k("div",{class:"flex flex-row items-center py-3",onClick:o[12]||(o[12]=(...S)=>e(go)&&e(go)(...S))},[e(wo)?(l(),x(Ue,{key:0,class:"animate-infinite animate-spin"})):(l(),x(Nt,{key:1,class:"flex h-[1rem] text-gray-500"})),k("div",Ii,ee(t.$t("activity.predictFormulas")),1)])]),_:1}))]}),_:1})]),key:"0"}:{name:"overlay",fn:C(()=>[k("div",Ti,[e(we)?(l(),x(vt,{key:0,preload:e(Me),"column-position":e(Ne),class:Ee({hidden:e(zo)}),onSubmit:o[13]||(o[13]=R=>La(!0)),onCancel:o[14]||(o[14]=R=>La()),onClick:o[15]||(o[15]=Et(()=>{},["stop"])),onKeydown:o[16]||(o[16]=Et(()=>{},["stop"])),onMounted:o[17]||(o[17]=R=>Me.value=void 0)},null,8,["preload","column-position","class"])):B("",!0)])]),key:"1"}]),1032,["visible"])])])),[[Qe,["c:column:add"]]]):B("",!0),k("th",Gi,[k("div",{class:Ee(["absolute top-0 w-[40px]",{"left-[60px]":e(Mt),"left-0":!e(Mt)}])},"  ",2)])],512),[[Io,!e(rt)]])],512),[[Io,e(ue)!==!0]])],6),e(Co)?B("",!0):(l(),A("div",{key:0,class:Ee(["table-overlay",{"nc-grid-skeleton-loader":e(Co)}]),style:We({height:`${e(gl)}px`,width:`${e(wl)}px`})},[k("table",{ref_key:"smartTable",ref:ne,class:Ee(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white relative",{mobile:e(i),desktop:!e(i),"w-full":e(E).length===0,"pr-60 pb-12":!e(g)&&!e(De)}]),style:We({transform:`translateY(${e(yl)}px) translateX(${e(eo)}px)`}),onContextmenu:zt},[e(g)!==!0?(l(),A("tbody",{key:0,ref_key:"tableBodyEl",ref:me},[e(Co)?(l(!0),A(qe,{key:0},Ut(e(ll),(R,S)=>(l(),A("tr",{key:S},[(l(!0),A(qe,null,Ut(e(Ca),(Ot,to)=>(l(),A("td",{key:to,class:Ee(["border-b-1 border-r-1",{"min-w-45":to!==0,"min-w-16":to===0}])},null,2))),128))]))),128)):B("",!0),(l(!0),A(qe,null,Ut(e(hl),({row:R,index:S})=>(l(),x(kl,{key:S,row:R},{default:C(({state:Ot})=>{var to,No,bt,fn,vn,mn,wn,gn,hn,yn;return[Ce(k("tr",{class:Ee(["nc-grid-row !xs:h-14",{"active-row":e(w).row===S||((to=e(fe)._start)==null?void 0:to.row)===S,"mouse-down":e(qt)||e(Ia),"selected-row":R.rowMeta.selected}]),style:We({height:t.rowHeight?`${("rowHeightInPx"in t?t.rowHeightInPx:e(fo))[`${t.rowHeight}`]}px`:`${("rowHeightInPx"in t?t.rowHeightInPx:e(fo))[1]}px`}),"data-testid":`grid-row-${S}`},[k("td",{key:"row-index",class:"caption nc-grid-cell w-[64px] min-w-[64px]",style:We({left:`-${e(eo)}px`}),"data-testid":`cell-Id-${S}`,onContextmenu:o[21]||(o[21]=Q=>Ge.value=null)},[k("div",Hi,[k("div",{class:Ee(["nc-row-no sm:min-w-4 text-xs text-gray-500",{toggle:!e(Se),hidden:R.rowMeta.selected}])},ee(((((No=e(L))==null?void 0:No.page)??1)-1)*(((bt=e(L))==null?void 0:bt.pageSize)??25)+S+1),3),e(Se)?B("",!0):(l(),A("div",{key:0,class:Ee([{hidden:!R.rowMeta.selected,flex:R.rowMeta.selected},"nc-row-expand-and-checkbox"])},[T(Ve,{checked:R.rowMeta.selected,"onUpdate:checked":Q=>R.rowMeta.selected=Q},null,8,["checked","onUpdate:checked"])],2)),Yi,k("div",{class:Ee(["nc-expand",{"nc-comment":(fn=R.rowMeta)==null?void 0:fn.commentCount}]),"data-testid":`nc-expand-${S}`},[R.rowMeta.saving?(l(),x(Ct,{key:0,class:"!flex items-center","data-testid":`row-save-spinner-${S}`},null,8,["data-testid"])):B("",!0),(vn=R.rowMeta)!=null&&vn.commentCount&&e(ke)?Ce((l(),A("span",{key:1,class:"px-1 rounded-md rounded-bl-none transition-all border-1 border-brand-200 text-xs cursor-pointer font-sembold select-none leading-5 text-brand-500 bg-brand-50",onClick:Q=>ca(R,Ot)},[Fe(ee(R.rowMeta.commentCount),1)],8,Ki)),[[Qe,["c:expanded-form:open"]]]):R.rowMeta.saving?B("",!0):(l(),A("div",ji,[e(ke)?Ce((l(),x(oo(("iconMap"in t?t.iconMap:e(_o)).expand),{key:0,class:"select-none transform hover:text-black hover:scale-120 nc-row-expand",onClick:Q=>ca(R,Ot)},null,8,["onClick"])),[[Qe,["c:row-expand:open"]]]):B("",!0)]))],10,Wi)])],44,Ui),e(f)[0]?(l(),x(tn,{key:e(f)[0].id,class:Ee(["cell relative nc-grid-cell cursor-pointer",{active:e(Ho)[`${S}-0`],"active-cell":e(w).row===S&&e(w).col===0||((mn=e(fe)._start)==null?void 0:mn.row)===S&&((wn=e(fe)._start)==null?void 0:wn.col)===0,"nc-required-cell":e(ia)[S][0].isColumnRequiredAndNull&&!e(de),"align-middle":!t.rowHeight||t.rowHeight===1,"align-top":t.rowHeight&&t.rowHeight!==1,filling:e(za)[`${S}-0`],readonly:e(Jt)[0].isReadonly&&e(Ae)&&e(Ho)[`${S}-0`],"!border-r-blue-400 !border-r-3":e(O)===e(f)[0].id}]),style:We({"min-width":((gn=e(J)[e(f)[0].id])==null?void 0:gn.width)||"180px","max-width":((hn=e(J)[e(f)[0].id])==null?void 0:hn.width)||"180px",width:((yn=e(J)[e(f)[0].id])==null?void 0:yn.width)||"180px",...e(eo)>0?{left:`-${e(eo)-64}px`}:{}}),"data-testid":`cell-${e(f)[0].title}-${S}`,"data-key":`data-key-${S}-${e(f)[0].id}`,"data-col":e(f)[0].id,"data-title":e(f)[0].title,"data-row-index":S,"data-col-index":0,onMousedown:Q=>e(Pa)(Q,S,0),onMouseover:Q=>e(Na)(Q,S,0),onClick:Q=>Ja(Q,S,0),onDblclick:Q=>ra(R,e(f)[0]),onContextmenu:Q=>zt(Q,{row:S,col:0})},{default:C(()=>[e(Z)?B("",!0):(l(),A("div",Xi,[e(f)[0]&&e(Jt)[0].isVirtualCol&&e(f)[0].title?(l(),x(Za,{key:0,modelValue:R.row[e(f)[0].title],"onUpdate:modelValue":Q=>R.row[e(f)[0].title]=Q,column:e(f)[0],active:e(w).col===0&&e(w).row===S,row:R,"read-only":!e(Ae),onNavigate:Wo,onSave:Q=>{var Xe;return(Xe=e(y))==null?void 0:Xe(R,"",Ot)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):e(f)[0]&&e(f)[0].title?(l(),x(en,{key:1,modelValue:R.row[e(f)[0].title],"onUpdate:modelValue":Q=>R.row[e(f)[0].title]=Q,column:e(f)[0],"edit-enabled":!!e(Ae)&&!!e(H)&&e(w).col===0&&e(w).row===S,"row-index":S,active:e(w).col===0&&e(w).row===S,"read-only":!e(Ae),"onUpdate:editEnabled":o[22]||(o[22]=Q=>H.value=Q),onSave:Q=>{var Xe;return(Xe=e(y))==null?void 0:Xe(R,e(f)[0].title,Ot)},onNavigate:Wo,onCancel:o[23]||(o[23]=Q=>H.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):B("",!0)]))]),_:2},1032,["class","style","data-testid","data-key","data-col","data-title","data-row-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])):B("",!0),(l(!0),A(qe,null,Ut(e(ja),({field:Q,index:Xe})=>{var _n,bn,kn,xn,Rn;return l(),x(tn,{key:`cell-${Xe}-${S}`,class:Ee(["cell relative nc-grid-cell cursor-pointer",{active:e(Ho)[`${S}-${Xe}`],"active-cell":e(w).row===S&&e(w).col===Xe||((_n=e(fe)._start)==null?void 0:_n.row)===S&&((bn=e(fe)._start)==null?void 0:bn.col)===Xe,"nc-required-cell":e(ia)[S][Xe].isColumnRequiredAndNull&&!e(de),"align-middle":!t.rowHeight||t.rowHeight===1,"align-top":t.rowHeight&&t.rowHeight!==1,filling:e(za)[`${S}-${Xe}`],readonly:e(Jt)[Xe].isReadonly&&e(Ae)&&e(Ho)[`${S}-${Xe}`],"!border-r-blue-400 !border-r-3":e(O)===Q.id}]),style:We({"min-width":((kn=e(J)[Q.id])==null?void 0:kn.width)||"180px","max-width":((xn=e(J)[Q.id])==null?void 0:xn.width)||"180px",width:((Rn=e(J)[Q.id])==null?void 0:Rn.width)||"180px"}),"data-testid":`cell-${Q.title}-${S}`,"data-key":`data-key-${S}-${Q.id}`,"data-col":Q.id,"data-title":Q.title,"data-row-index":S,"data-col-index":Xe,onMousedown:ct=>e(Pa)(ct,S,Xe),onMouseover:ct=>e(Na)(ct,S,Xe),onClick:ct=>Ja(ct,S,Xe),onDblclick:ct=>ra(R,Q),onContextmenu:ct=>zt(ct,{row:S,col:Xe})},{default:C(()=>[e(Z)?B("",!0):(l(),A("div",qi,[e(Jt)[Xe].isVirtualCol&&Q.title?(l(),x(Za,{key:0,modelValue:R.row[Q.title],"onUpdate:modelValue":ct=>R.row[Q.title]=ct,column:Q,active:e(w).col===Xe&&e(w).row===S,row:R,"read-only":!e(Ae),onNavigate:Wo,onSave:ct=>{var Oo;return(Oo=e(y))==null?void 0:Oo(R,"",Ot)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):Q.title?(l(),x(en,{key:1,modelValue:R.row[Q.title],"onUpdate:modelValue":ct=>R.row[Q.title]=ct,column:Q,"edit-enabled":!!e(Ae)&&!!e(H)&&e(w).col===Xe&&e(w).row===S,"row-index":S,active:e(w).col===Xe&&e(w).row===S,"read-only":!e(Ae),"onUpdate:editEnabled":o[24]||(o[24]=ct=>H.value=ct),onSave:ct=>{var Oo;return(Oo=e(y))==null?void 0:Oo(R,Q.title,Ot)},onNavigate:Wo,onCancel:o[25]||(o[25]=ct=>H.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):B("",!0)]))]),_:2},1032,["class","style","data-testid","data-key","data-col","data-title","data-row-index","data-col-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128))],14,Bi),[[Io,!e(Co)]])]}),_:2},1032,["row"]))),128)),e(po)&&!e(De)?Ce((l(),A("tr",{key:1,class:Ee(["text-left nc-grid-add-new-cell cursor-pointer group relative z-3 xs:hidden",{"!border-r-2 !border-r-gray-100":e(Ma)===1}]),onMouseup:o[26]||(o[26]=Et(()=>{},["stop"])),onClick:o[27]||(o[27]=R=>Zt())},[k("div",{class:"h-8 border-b-1 border-gray-100 bg-white group-hover:bg-gray-50 absolute left-0 bottom-0 px-2 sticky z-40 w-full flex items-center text-gray-500",style:We({left:`-${e(eo)}px`})},[e(rt)?B("",!0):(l(),x(oo(("iconMap"in t?t.iconMap:e(_o)).plus),{key:0,class:"text-pint-500 text-base ml-2 mt-0 text-gray-600 group-hover:text-black"}))],4),k("td",{class:"!border-gray-100",colspan:e(Ma)},null,8,Qi)],34)),[[Qe,["c:row:add:grid-bottom"]]]):B("",!0)],512)):B("",!0)],38),Ce(k("div",{ref_key:"fillHandle",ref:_e,class:Ee(["nc-fill-handle",!e(fe).isEmpty()&&e(fe).end.col!==0||e(fe).isEmpty()&&e(w).col!==0?"z-3":"z-4"]),style:We({top:`${e(Xa)}px`,left:`${e(qa)}px`,cursor:"crosshair"})},null,6),[[Io,e(_l)]])],6))])]}),_:1},8,["visible","trigger"])],2),k("div",ss,[e(g)!==!0&&e(L)&&e(De)?(l(),x($l,{key:`nc-pagination-${e(i)}`,"pagination-data":e(L),"onUpdate:paginationData":o[38]||(o[38]=Je=>Lt(L)?L.value=Je:null),"show-api-timing":!e(De),"align-count-on-right":"","align-left":e(De),"change-page":e(z),"hide-sidebars":((un=e(Ke))==null?void 0:un.hideSidebars)===!0,"fixed-size":(dn=e(Ke))==null?void 0:dn.fixedSize,"extra-style":(cn=e(Ke))==null?void 0:cn.extraStyle,"show-size-changer":!e(De)},An({_:2},[e(po)&&!e(Co)?{name:"add-record",fn:C(()=>[k("div",us,[e(i)?Ce((l(),x(Xo,{key:0,class:"nc-grid-add-new-row",type:"secondary",disabled:e(F),onClick:o[36]||(o[36]=Je=>Eo())},{default:C(()=>[Fe(ee(t.$t("activity.newRecord")),1)]),_:1},8,["disabled"])),[[Qe,[e(K)?"c:row:add:grid":"c:row:add:form"]]]):Ce((l(),x(Rl,{key:1,class:"nc-grid-add-new-row",placement:"top",disabled:e(F),onClick:o[37]||(o[37]=Je=>e(K)?Zt():Eo())},{overlay:C(()=>{var Je;return[k("div",cs,[k("div",{class:Ee(["absolute -top-21 flex flex-col min-h-34.5 w-70 p-1.5 bg-white rounded-lg border-1 border-gray-200 justify-start overflow-hidden",{"-left-32.5":!e(K),"-left-21.5":e(K)}]),style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},[Ce((l(),A("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-grid group",onClick:Fa},[k("div",ps,[k("div",fs,[(l(),x(oo((Je=("viewIcons"in t?t.viewIcons:e(Mn))[e(Cn).GRID])==null?void 0:Je.icon),{class:"nc-view-icon text-inherit"})),Fe(" "+ee(t.$t("activity.newRecord"))+" - "+ee(t.$t("objects.viewType.grid")),1)]),e(K)?(l(),x(xe,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):B("",!0)]),k("div",vs,ee(t.$t("labels.addRowGrid")),1)])),[[Qe,["c:row:add:grid"]]]),Ce((l(),A("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-form group",onClick:Eo},[k("div",ms,[k("div",ws,[T(xe,{class:"h-4.5 w-4.5",icon:"article"}),Fe(" "+ee(t.$t("activity.newRecord"))+" - "+ee(t.$t("objects.viewType.form")),1)]),e(K)?B("",!0):(l(),x(xe,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),k("div",gs,ee(t.$t("labels.addRowForm")),1)])),[[Qe,["c:row:add:form"]]])],2)])]}),icon:C(()=>[(l(),x(oo(("iconMap"in t?t.iconMap:e(_o)).arrowUp),{class:"text-gray-600 h-4 w-4"}))]),default:C(()=>[k("div",ds,[k("span",null,[e(K)?(l(),A(qe,{key:0},[Fe(ee(t.$t("activity.newRecord")),1)],64)):(l(),A(qe,{key:1},[Fe(ee(t.$t("activity.newRecord"))+" - "+ee(t.$t("objects.viewType.form")),1)],64))])])]),_:1},8,["disabled"])),[[Qe,[e(K)?"c:row:add:grid:toggle":"c:row:add:form:toggle"]]])])]),key:"0"}:void 0]),1032,["pagination-data","show-api-timing","align-left","change-page","hide-sidebars","fixed-size","extra-style","show-size-changer"])):e(L)?(l(),x(Sl,{key:1,"pagination-data":e(L),"onUpdate:paginationData":o[39]||(o[39]=Je=>Lt(L)?L.value=Je:null),"change-page":e(z),"show-size-changer":!e(De),"scroll-left":e(Ua)},null,8,["pagination-data","change-page","show-size-changer","scroll-left"])):B("",!0)]),e(g)!==!0&&e(L)&&!e(De)?(l(),A("div",hs,[e(po)&&!e(Co)?(l(),x(an,{key:0},{overlay:C(()=>[T($t,null,{default:C(()=>[Ce((l(),x(Re,{class:"nc-new-record-with-grid group",onClick:Fa},{default:C(()=>{var Je;return[k("div",ks,[(l(),x(oo((Je=("viewIcons"in t?t.viewIcons:e(Mn))[e(Cn).GRID])==null?void 0:Je.icon),{class:"nc-view-icon text-inherit"})),Fe(" "+ee(t.$t("activity.newRecord"))+" - "+ee(t.$t("objects.viewType.grid")),1)]),e(K)?(l(),x(xe,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):B("",!0)]}),_:1})),[[Qe,["c:row:add:grid"]]]),Ce((l(),x(Re,{class:"nc-new-record-with-form group",onClick:Eo},{default:C(()=>[k("div",xs,[T(xe,{class:"h-4.5 w-4.5",icon:"article"}),Fe(" "+ee(t.$t("activity.newRecord"))+" - "+ee(t.$t("objects.viewType.form")),1)]),e(K)?B("",!0):(l(),x(xe,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),_:1})),[[Qe,["c:row:add:form"]]])]),_:1})]),default:C(()=>[k("div",ys,[e(i)?Ce((l(),x(Xo,{key:0,disabled:e(F),class:"!rounded-r-none !border-r-0 nc-grid-add-new-row",size:"small",type:"secondary",onClick:o[40]||(o[40]=Et(Je=>Eo(),["stop"]))},{default:C(()=>[k("div",_s,[T(xe,{icon:"plus"}),Fe(" New Record ")])]),_:1},8,["disabled"])),[[Qe,[e(K)?"c:row:add:grid":"c:row:add:form"]]]):B("",!0),Ce((l(),x(Xo,{disabled:e(F),class:"!rounded-r-none !border-r-0 nc-grid-add-new-row",size:"small",type:"secondary",onClick:o[41]||(o[41]=Et(Je=>e(K)?Zt():Eo(),["stop"]))},{default:C(()=>[k("div",bs,[T(xe,{icon:"plus"}),e(K)?(l(),A(qe,{key:0},[Fe(ee(t.$t("activity.newRecord")),1)],64)):(l(),A(qe,{key:1},[Fe(ee(t.$t("activity.newRecord"))+" - "+ee(t.$t("objects.viewType.form")),1)],64))])]),_:1},8,["disabled"])),[[Qe,[e(K)?"c:row:add:grid":"c:row:add:form"]]]),e(i)?B("",!0):(l(),x(Xo,{key:1,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary"},{default:C(()=>[T(xe,{icon:"arrowUp"})]),_:1}))])]),_:1})):B("",!0)])):B("",!0)],2)}}}),Da=Xn(Rs,[["__scopeId","data-v-6e021d12"]]),$s=So({__name:"Aggregation",props:{group:{},maxDepth:{},scrollLeft:{}},setup(v){return(h,s)=>(l(),A("div"))}}),Ss=wt(()=>gt(()=>import("./BfyDMjkl.js"),__vite__mapDeps([81,1,2,75,76,82,83,84,77,78,24,85,86,87,88,89,90,91,92,93,16,17,18,19,20,21,22,94,95,96,43,60,61,3,62,4,97,98,99,100,101,102,103,12,13,104,71,70,105]),import.meta.url).then(v=>v.default||v)),Ds=So({__name:"GroupByTable",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},depth:{},maxDepth:{},rowHeight:{},paginationFixedSize:{},paginationHideSidebars:{type:Boolean},scrollLeft:{},viewWidth:{},scrollable:{}},emits:["update:paginationData"],setup(v,{emit:h}){const s=v,n=xa(s,"group",h),{t:G}=Bo(),L=qn(),E=Ie(aa,_()),Ke=Ie(Ra,_()),g=Ie(ta,_(!1)),ue=_(!1),p=Ie(na,Ro()),{eventBus:le}=Uo(),te=U(()=>$e.value.query),$e=L.currentRoute,I=_(!1),z=_(),m=_(),y=U({get(){return!!te.value.rowId},set(b){b||(L.push({query:{...te.value,rowId:void 0}}),z.value={},m.value={})}});function W(b,F,P=!1){var ve;const X=pt(b.row,(ve=E.value)==null?void 0:ve.columns);m.value=F,X&&!g.value?L.push({query:{...te.value,rowId:X}}):(z.value=b,I.value=!0,ue.value=!P)}const ke=b=>{le.emit(Wt.CLEAR_NEW_ROW,b)};function re(b,F,P=E.value){if(b.nested||!b.rows)return;F=F??b.rows.length;const X=b.nestedIn.reduce((ve,q)=>(q.key!=="__nc_null__"&&!ya(q.column_uidt)&&![$.Rollup,$.Lookup,$.Formula,$.Barcode,$.QrCode].includes(q.column_uidt)&&(ve[q.title]=q.key,q.column_uidt===$.Checkbox&&(ve[q.title]=ve[q.title]===xo.TRUE?!0:ve[q.title]===xo.FALSE?!1:!!ve[q.title])),ve),{});return b.count=b.count+1,b.rows.splice(F,0,{row:{...wr(P==null?void 0:P.columns),...X},oldRow:{},rowMeta:{new:!0}}),b.rows[F]}const ge=U(()=>!n.value.nested&&n.value.rows?n.value.rows:[]),{deleteRow:ie,deleteSelectedRows:pe,deleteRangeOfRows:j,updateOrSaveRow:be,bulkUpdateRows:f,selectedAllRecords:Se,removeRowIfNew:Ze}=fr({meta:E,viewMeta:Ke,formattedData:ge,paginationData:_(n.value.paginationData),callbacks:{changePage:b=>s.loadGroupPage(n.value,b),loadData:()=>s.loadGroupData(n.value,!0),globalCallback:()=>{var b;return(b=s.redistributeRows)==null?void 0:b.call(s)}}}),de=async b=>{n.value.count=n.value.count-1,await ie(b)},De=async b=>{await s.loadGroupData(n.value,!0,{...(b==null?void 0:b.offset)!==void 0?{offset:b.offset}:{}})};$a(async()=>{p==null||p.off(De)}),p==null||p.on(De),St(Yn,_(!0));const et=U(()=>({fixedSize:s.paginationFixedSize?s.paginationFixedSize-2:void 0,hideSidebars:s.paginationHideSidebars,extraStyle:"background: transparent !important; border-top: 0px;"}));function he(){return ge.value.findIndex(b=>{var F;return te.value.rowId===pt(b.row,(F=E.value)==null?void 0:F.columns)})}const Te=async b=>{var q,tt,xt,It,Vt;let P=he()+(b===vo.NEXT?1:-1);for(;(tt=(q=ge.value[P])==null?void 0:q.rowMeta)!=null&&tt.new;)P=P+(b===vo.NEXT?1:-1);const X=((xt=n.value.paginationData)==null?void 0:xt.page)||1;if(P<0){if(X===1)return ze.info(G("msg.info.noMoreRecords"));await s.loadGroupPage(n.value,X-1),P=ge.value.length-1}else if(P>=ge.value.length){if((It=n.value.paginationData)!=null&&It.isLastPage)return ze.info(G("msg.info.noMoreRecords"));await s.loadGroupPage(n.value,X+1),P=0}const ve=pt(ge.value[P].row,(Vt=E.value)==null?void 0:Vt.columns);ve&&await L.push({query:{...te.value,rowId:ve}})},i=async()=>{var F,P,X,ve;const b=he();if(!((F=n.value.paginationData)!=null&&F.isLastPage)&&b===((P=n.value.paginationData)==null?void 0:P.pageSize)){const q=(X=n.value.paginationData)!=null&&X.page?((ve=n.value.paginationData)==null?void 0:ve.page)+1:1;await s.loadGroupPage(n.value,q)}Te(vo.NEXT)},se=async()=>{var F,P,X;const b=he();if(!((F=n.value.paginationData)!=null&&F.isFirstPage)&&b===1){const ve=(P=n.value.paginationData)!=null&&P.page?((X=n.value.paginationData)==null?void 0:X.page)-1:1;await s.loadGroupPage(n.value,ve)}Te(vo.PREV)},a=U(()=>{var F;const b=he();return((F=n.value.paginationData)==null?void 0:F.isLastPage)&&b===ge.value.length-1}),V=U(()=>{var F;const b=he();return((F=n.value.paginationData)==null?void 0:F.isFirstPage)&&b===0});async function oe(){pe&&(await pe(),await De({shouldShowLoading:!0}))}return le.on(b=>{(b===Wt.GROUP_BY_RELOAD||b===Wt.DATA_RELOAD)&&(p==null||p.trigger())}),(b,F)=>{var ve;const P=Ss,X=Qn;return l(),A(qe,null,[e(n).rows?(l(),x(Da,{key:0,"selected-all-records":e(Se),"onUpdate:selectedAllRecords":F[0]||(F[0]=q=>Lt(Se)?Se.value=q:null),class:"nc-group-table",data:e(n).rows,"pagination-data":e(n).paginationData,"load-data":async()=>{},"change-page":q=>s.loadGroupPage(e(n),q),"call-add-empty-row":q=>re(e(n),q),"expand-form":W,"row-height":b.rowHeight,"delete-row":de,"delete-selected-rows":oe,"delete-range-of-rows":e(j),"update-or-save-row":e(be),"remove-row-if-new":e(Ze),"bulk-update-rows":e(f),"hide-header":!0,pagination:e(et),"disable-skeleton":!0,"disable-virtual-y":!0},null,8,["selected-all-records","data","pagination-data","change-page","call-add-empty-row","row-height","delete-range-of-rows","update-or-save-row","remove-row-if-new","bulk-update-rows","pagination"])):B("",!0),(l(),x(_a,null,{default:C(()=>[e(z)&&e(I)?(l(),x(P,{key:0,modelValue:e(I),"onUpdate:modelValue":[F[1]||(F[1]=q=>Lt(I)?I.value=q:null),F[2]||(F[2]=q=>ke(e(z)))],"load-row":!e(g),row:e(z),state:e(m),meta:e(E),view:e(Ke)},null,8,["modelValue","load-row","row","state","meta","view"])):B("",!0)]),_:1})),e(y)&&((ve=e(E))!=null&&ve.id)?(l(),x(X,{key:1,modelValue:e(y),"onUpdate:modelValue":F[3]||(F[3]=q=>Lt(y)?y.value=q:null),row:e(z)??{row:{},oldRow:{},rowMeta:{}},meta:e(E),"load-row":!e(g),state:e(m),"row-id":e(te).rowId,view:e(Ke),"show-next-prev-icons":"","first-row":e(V),"last-row":e(a),"expand-form":W,onNext:i,onPrev:se},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):B("",!0)],64)}}}),As=wt(()=>gt(()=>import("./B7f52wKv.js"),__vite__mapDeps([57,1,2,3,8,58]),import.meta.url).then(v=>v.default||v)),Ms=wt(()=>gt(()=>import("./Dtgb-V7U.js"),__vite__mapDeps([59,1,2,60,43,61,3,62,4,8,63]),import.meta.url).then(v=>v.default||v)),Cs=wt(()=>gt(()=>import("./BlhRk6zn.js"),__vite__mapDeps([64,60,43,1,2,61,3,62,4]),import.meta.url).then(v=>v.default||v)),Es={class:"pointer-events-none"},Ls=So({__name:"GroupByLabel",props:{column:{},modelValue:{}},setup(v){return St(Hn,_(!0)),St(nr,_(!0)),(h,s)=>{const M=As,n=Ms,G=Cs;return l(),A("div",Es,[T(G,{row:{row:{[h.column.title]:h.modelValue},rowMeta:{}}},{default:C(()=>[e(jt)(h.column)?(l(),x(M,{key:0,"model-value":h.modelValue,class:"!text-gray-600",column:h.column,"read-only":!0},null,8,["model-value","column"])):(l(),x(n,{key:1,"model-value":h.modelValue,class:"!text-gray-600",column:h.column,"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"]))]),_:1},8,["row"])])}}}),Vs=wt(()=>gt(()=>import("./Bc4ZV0ZA.js"),__vite__mapDeps([74,1,2,75,76,77,78,24,79,80,47,68,69,70,71,72,81,82,83,84,85,86,87,88,89,90,91,92,93,16,17,18,19,20,21,22,94,95,96,43,60,61,3,62,4,97,98,99,100,101,102,103,12,13,104,105,42,106,107,30,108,8,109,110,50,111,112,113]),import.meta.url).then(v=>v.default||v)),Fs=wt(()=>gt(()=>import("./DlZ1svvA.js"),__vite__mapDeps([65,66,1,2,37,28,18,38,20,19,67,68,69,70,71,72,16,17,21,22,73]),import.meta.url).then(v=>v.default||v)),zs={key:0,class:"flex sticky top-0 z-5"},Ps={class:"flex items-center"},Ns={class:"flex"},Os={key:1,class:"flex min-w-[100px] flex-wrap"},Is={key:1,class:"text-gray-400"},Ts={class:"text-xs group-hover:hidden text-gray-500 nc-group-row-count"},Gs={class:"text-[#374151] ml-2"},Bs=So({__name:"GroupBy",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},loadGroupAggregation:{type:Function},redistributeRows:{type:Function},viewWidth:{},scrollLeft:{},fullPage:{type:Boolean},depth:{},maxDepth:{},rowHeight:{},expandForm:{type:Function}},emits:["update:paginationData"],setup(v,{emit:h}){const s=v,n=xa(s,"group",h),G=Ie(aa,_()),L=Ie(ea,_()),E=ao(s,"scrollLeft"),{isViewDataLoading:Ke,isPaginationLoading:g}=$o(oa()),{gridViewCols:ue}=la(),p=Ie(zn,Ro()),le=U(()=>{var a,V;return(V=(a=G.value)==null?void 0:a.columns)==null?void 0:V.find(oe=>oe.pv)}),te=U(()=>!le.value||!le.value.id?{width:"100px"}:ue.value[le.value.id]),$e=Ie(na,Ro());p==null||p.on(async a=>{var V;if((V=L.value)!=null&&V.length&&((!a||!(a!=null&&a.fields.length))&&await s.loadGroupAggregation(n.value),a!=null&&a.fields)){const oe=a.fields.reduce((b,F)=>{const P=L.value.find(X=>X.title===F.title);return P!=null&&P.id&&(b[P.id]=F.aggregation??ue.value[P.id].aggregation??Pn.None),b},{});await s.loadGroupAggregation(n.value,Object.entries(oe).map(([b,F])=>({field:b,type:F})))}});const I=async(a,V,oe)=>{Ke.value=!0,g.value=!0,await s.loadGroupData(a,V,oe),Ke.value=!1,g.value=!1},z=s.depth??0,m=_(),y=_(),W=_(),ke=U(()=>{var a;return s.fullPage??(((a=W.value)==null?void 0:a.offsetWidth)??0)>(s.viewWidth??0)}),re=_(),ge=U(()=>re.value?Array.isArray(re.value)?re.value.map(a=>a.replace("group-panel-","")):[re.value.replace("group-panel-","")]:[]),ie=_([]),pe=a=>{var V,oe,b;if(a=Array.isArray(a)?a:[a],a.length>0&&n.value.children&&!ie.value.includes(a[a.length-1])){const F=a[a.length-1].replace("group-panel-",""),P=n.value.children.find(X=>`${X.key}`===F);P&&(P.nested?(V=P.children)!=null&&V.length||s.loadGroups({},P):(!((oe=P.rows)!=null&&oe.length)||P.count!==((b=P.rows)==null?void 0:b.length))&&I(P))}ie.value=a},j=a=>{n.value.nested?(s.loadGroups({...(a==null?void 0:a.offset)!==void 0?{offset:a.offset}:{}},n.value),s.loadGroupAggregation(n.value)):(I(n.value,!0,{...(a==null?void 0:a.offset)!==void 0?{offset:a.offset}:{}}),s.loadGroupAggregation(n.value))};Zo(async()=>{$e==null||$e.on(j)}),$a(async()=>{$e==null||$e.off(j)}),ko([()=>n.value.key],async(a,V)=>{a!==V&&(n.value.nested?n.value.nested&&await s.loadGroups({},n.value):await I(n.value,!0))}),Zo(async()=>{n.value.root===!0&&await s.loadGroups({},n.value)}),n.value.root===!0&&St(Wn,m);const be=_(),f=U(()=>{if(n.value.root===!0)return be.value??0;if(s.scrollLeft&&s.viewWidth&&y.value){const a=y.value.scrollWidth+12+12;return s.scrollLeft+s.viewWidth+20>a?a-s.viewWidth-20:Math.max(Math.min(a-s.viewWidth,(s.scrollLeft??0)-12),0)}return 0}),Se=a=>{n.value.root&&(be.value=a.target.scrollLeft)},Ze=a=>{var oe,b,F,P,X,ve,q,tt,xt;let V=a.key.toString();if(V&&((oe=a.column)==null?void 0:oe.uidt)===$.Lookup||((b=a.column)==null?void 0:b.uidt)===$.LinkToAnotherRecord)try{V=JSON.parse(V)}catch{return V.split("___")}if(V&&((F=a.column)==null?void 0:F.uidt)===$.DateTime)return[En(V,`${((X=Ht((P=a.column)==null?void 0:P.meta))==null?void 0:X.date_format)??Un[0]} ${((q=Ht((ve=a.column)==null?void 0:ve.meta))==null?void 0:q.time_format)??ha[0]}`)];if(V&&((tt=a.column)==null?void 0:tt.uidt)===$.Time)return[En(V,ha[0],!1)];if(V&&[$.User,$.CreatedBy,$.LastModifiedBy].includes((xt=a.column)==null?void 0:xt.uidt))try{return[JSON.parse(V)]}catch{return null}return[V]},de=a=>[$.Lookup,$.Attachment,$.Barcode,$.QrCode,$.Links,$.User,$.DateTime,$.CreatedTime,$.LastModifiedTime,$.CreatedBy,$.LongText,$.LastModifiedBy].includes(a==null?void 0:a.uidt),De=a=>{Array.isArray(re.value)?re.value.push(`group-panel-${a}`):re.value=[`group-panel-${a}`],pe(`group-panel-${a}`)},et=a=>{Array.isArray(re.value)?re.value=re.value.filter(V=>V!==`group-panel-${a}`):re.value=[]},he=()=>{re.value=[]},Te=()=>{var a;re.value=((a=n.value.children)==null?void 0:a.map(V=>`group-panel-${V.key}`))??[],n.value.children&&n.value.children.forEach(V=>{pe(`group-panel-${V.key}`)})},i=U(()=>{var F;const a=Number((((F=te.value)==null?void 0:F.width)??"").replace("px",""))+55+s.maxDepth*9,V=s.maxDepth??1,oe=n.value.root?be.value??0:E.value??0,b=P=>{switch(P){case 3:return`${a-18}px`;case 2:return`${a-9}px`;case 1:default:return`${a}px`}};return z===0?oe<29?`${a+oe-(.02*(oe*oe)+1.07*oe)}px`:b(V):z===1?oe<30?`${a+oe-9-23/20*oe}px`:b(V):z===2?oe<=14?`${a+oe-18-oe}px`:b(V):`${a}px`}),se=U(()=>{if(s.maxDepth===3)switch(z){case 2:return"#F9F9FA";case 1:return"#F4F4F5";default:return"#F1F1F1"}if(s.maxDepth===2)switch(z){case 1:return"#F9F9FA";default:return"#F4F4F5"}return s.maxDepth===1,"#F9F9FA"});return(a,V)=>{const oe=Kn,b=jn,F=Mr,P=Zn,X=el,ve=tl,q=$s,tt=Cr,xt=Er,It=Vs,Vt=Fs;return l(),A(qe,null,[k("div",{ref_key:"wrapper",ref:m,class:Ee([{"overflow-y-auto":e(n).root===!0},"h-full"]),style:We(`${!e(n).root&&e(n).nested?"padding-left: 8px; padding-right: 8px;":""}`),onScroll:Se},[k("div",{ref_key:"scrollable",ref:y,style:We(`${e(n).root===!0?"width: fit-content":"width: 100%"}`)},[e(n).root===!0?(l(),A("div",zs,[k("div",{class:"border-b-1 border-gray-200 mb-2",style:We([{"background-color":"#f4f4f5"},{"padding-left":`${(a.maxDepth||1)*9}px`}])},null,4),T(Da,{ref_key:"tableHeader",ref:W,class:"mb-2",data:[],"hide-checkbox":!0,"header-only":!0},null,512)])):B("",!0),k("div",{class:Ee({"pl-2":e(n).root===!0})},[T(xt,{activeKey:e(re),"onUpdate:activeKey":V[1]||(V[1]=J=>Lt(re)?re.value=J:null),class:"nc-group-wrapper !rounded-lg",bordered:!1,onChange:pe},{default:C(()=>{var J;return[(l(!0),A(qe,null,Ut(Object.entries(((J=e(n))==null?void 0:J.children)??[]),([Do,ae])=>(l(),x(tt,{key:`group-panel-${ae.key}`,class:"!border-1 border-gray-300 nc-group rounded-[8px] mb-2",style:We(`background: ${e(se)};`),"show-arrow":!1},{header:C(()=>[k("div",{class:Ee([{"!rounded-b-none":e(ge).includes(ae.key.toString()),"!border-b-1":e(z)===(a.maxDepth??1)-1&&e(ge).includes(ae.key.toString())},"flex !sticky w-full items-center rounded-b-lg select-none transition-all !rounded-t-[8px] !h-10"])},[k("div",{class:Ee([{"!rounded-bl-[8px]":!e(ge).includes(ae.key.toString())},"!sticky flex z-10 justify-between !h-9.8 border-r-1 !rounded-tl-[8px] group pr-2 border-gray-300 overflow-clip items-center !left-0"]),style:We(`width:${e(i)};background: ${e(se)};`)},[k("div",Ps,[T(b,{class:"!border-0 !shadow-none !bg-transparent !hover:bg-transparent",type:"secondary",size:"small"},{default:C(()=>[T(oe,{icon:"chevronDown",class:"transition-all",style:We(`${e(ge).includes(ae.key.toString())?"transform: rotate(360deg)":"transform: rotate(270deg)"}`)},null,8,["style"])]),_:2},1024),k("div",Ns,[ae.column.uidt==="MultiSelect"?(l(!0),A(qe,{key:0},Ut(Object.entries(ae.key.split(",")),([nt,dt])=>(l(),x(F,{key:`panel-tag-${ae.column.id}-${dt}`,class:"!py-0 !px-[12px] !rounded-[12px]",color:ae.color.split(",")[+nt]},{default:C(()=>[k("span",{class:"nc-group-value",style:We({color:e(Qo).isReadable(ae.color.split(",")[+nt]||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Qo).mostReadable(ae.color.split(",")[+nt]||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},ee(dt in("GROUP_BY_VARS"in a?a.GROUP_BY_VARS:e(xo)).VAR_TITLES?("GROUP_BY_VARS"in a?a.GROUP_BY_VARS:e(xo)).VAR_TITLES[dt]:dt),5)]),_:2},1032,["color"]))),128)):!(ae.key in("GROUP_BY_VARS"in a?a.GROUP_BY_VARS:e(xo)).VAR_TITLES)&&de(ae.column)?(l(),A("div",Os,[(l(!0),A(qe,null,Ut(Ze(ae),(nt,dt)=>(l(),A(qe,{key:dt},[nt?(l(),x(Ls,{key:0,column:ae.column,"model-value":nt},null,8,["column","model-value"])):(l(),A("span",Is,"No mapped value"))],64))),128))])):(l(),x(F,{key:`panel-tag-${ae.column.id}-${ae.key}`,class:Ee(["!py-0 !px-[12px]",`${ae.column.uidt==="SingleSelect"?"!rounded-[12px]":"!rounded-[6px]"}`]),color:ae.color},{default:C(()=>{var nt;return[k("span",{class:"nc-group-value font-semibold text-[13px]",style:We({color:e(Qo).isReadable(ae.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Qo).mostReadable(ae.color||"#ccc",["#0b1d05","#fff"]).toHex8String()})},[ae.key in("GROUP_BY_VARS"in a?a.GROUP_BY_VARS:e(xo)).VAR_TITLES?(l(),A(qe,{key:0},[Fe(ee(("GROUP_BY_VARS"in a?a.GROUP_BY_VARS:e(xo)).VAR_TITLES[ae.key]),1)],64)):(l(),A(qe,{key:1},[Fe(ee((nt=Ze(ae))==null?void 0:nt.join(", ")),1)],64))],4)]}),_:2},1032,["class","color"]))])]),k("div",{style:We(`background: linear-gradient(to right, hsla(0, 0%, 97%, 0), ${e(se)} 18%);`),class:"flex !h-10 absolute right-0 pl-8 pr-2 items-center"},[k("div",Ts,[k("span",null,ee(a.$t("datatype.Count")),1),k("span",Gs,ee(ae.count),1)]),T(ve,{class:"!hidden !group-hover:block"},{overlay:C(()=>[T(X,null,{default:C(()=>[e(ge).includes(ae.key.toString())?(l(),x(P,{key:0,onClick:nt=>et(ae.key)},{default:C(()=>[T(oe,{icon:"minimize"}),Fe(" Collapse group ")]),_:2},1032,["onClick"])):(l(),x(P,{key:1,onClick:nt=>De(ae.key)},{default:C(()=>[T(oe,{icon:"maximize"}),Fe(" Expand group ")]),_:2},1032,["onClick"])),T(P,{onClick:Te},{default:C(()=>[T(oe,{icon:"maximizeAll"}),Fe(" Expand all ")]),_:1}),T(P,{onClick:he},{default:C(()=>[T(oe,{icon:"minimizeAll"}),Fe(" Collapse all ")]),_:1})]),_:2},1024)]),default:C(()=>[T(b,{size:"small",type:"text",onClick:V[0]||(V[0]=Et(()=>{},["stop"]))},{default:C(()=>[T(oe,{icon:"threeDotVertical"})]),_:1})]),_:2},1024)],4)],6),T(q,{"scroll-left":s.scrollLeft||e(be),"max-depth":a.maxDepth,group:ae,depth:e(z)},null,8,["scroll-left","max-depth","group","depth"])],2)]),default:C(()=>[!ae.nested&&ae.rows?(l(),x(Ds,{key:0,group:ae,"max-depth":a.maxDepth,depth:a.depth,"load-groups":a.loadGroups,"load-group-data":I,"load-group-page":a.loadGroupPage,"group-wrapper-change-page":a.groupWrapperChangePage,"row-height":a.rowHeight,"redistribute-rows":a.redistributeRows,"pagination-fixed-size":e(ke)?s.viewWidth:void 0,"pagination-hide-sidebars":!0,"scroll-left":s.scrollLeft||e(be),"view-width":a.viewWidth,scrollable:e(y)},null,8,["group","max-depth","depth","load-groups","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","pagination-fixed-size","scroll-left","view-width","scrollable"])):(l(),x(al,{key:1,group:ae,"load-groups":a.loadGroups,"load-group-data":I,"load-group-page":a.loadGroupPage,"group-wrapper-change-page":a.groupWrapperChangePage,"row-height":a.rowHeight,"load-group-aggregation":a.loadGroupAggregation,"redistribute-rows":a.redistributeRows,"view-width":a.viewWidth,depth:e(z)+1,"max-depth":a.maxDepth,"scroll-left":e(f),"full-page":e(ke)},null,8,["group","load-groups","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","redistribute-rows","view-width","depth","max-depth","scroll-left","full-page"]))]),_:2},1032,["style"]))),128))]}),_:1},8,["activeKey"])],2)],4)],38),e(n).root?(l(),x(It,{key:0,"pagination-data":e(n).paginationData,"onUpdate:paginationData":V[2]||(V[2]=J=>e(n).paginationData=J),"scroll-left":e(be),"custom-label":"groups",depth:a.maxDepth,"change-page":J=>a.groupWrapperChangePage(J,e(n))},null,8,["pagination-data","scroll-left","depth","change-page"])):(l(),x(Vt,{key:1,"pagination-data":e(n).paginationData,"onUpdate:paginationData":V[3]||(V[3]=J=>e(n).paginationData=J),"align-count-on-right":"","custom-label":"groups","align-left":"","show-api-timing":"","change-page":J=>a.groupWrapperChangePage(J,e(n)),"hide-sidebars":!0,style:We(`${s.depth&&s.depth>0?"border-radius: 0 0 8px 8px !important; background: transparent; border-top: 0px; height: 24px; padding-bottom: 8px;":""}`),"fixed-size":void 0},null,8,["pagination-data","change-page","style"]))],64)}}}),al=Xn(Bs,[["__scopeId","data-v-ae49194c"]]),Us=wt(()=>gt(()=>import("./BfyDMjkl.js"),__vite__mapDeps([81,1,2,75,76,82,83,84,77,78,24,85,86,87,88,89,90,91,92,93,16,17,18,19,20,21,22,94,95,96,43,60,61,3,62,4,97,98,99,100,101,102,103,12,13,104,71,70,105]),import.meta.url).then(v=>v.default||v)),Hs=wt(()=>gt(()=>import("./DM1twmVN.js"),__vite__mapDeps([114,1,2]),import.meta.url).then(v=>v.default||v)),Ys=So({__name:"index",setup(v,{expose:h}){const s=Ie(aa,_()),M=Ie(Ra,_()),n=Ie(na,Ro());Ie(ea,_([]));const G=qn(),L=G.currentRoute,{xWhere:E,eventBus:Ke}=Uo(),{t:g}=Bo(),ue=_(!1),p=U(()=>L.value.query),le=_(!1),te=_(),$e=_(),I=_();Lr(M,s,E);const{loadData:z,paginationData:m,formattedData:y,updateOrSaveRow:W,changePage:ke,addEmptyRow:re,deleteRow:ge,deleteSelectedRows:ie,selectedAllRecords:pe,removeRowIfNew:j,navigateToSiblingRow:be,getExpandedRowIndex:f,deleteRangeOfRows:Se,bulkUpdateRows:Ze,bulkUpdateView:de,optimisedQuery:De,islastRow:et,isFirstRow:he,aggCommentCount:Te}=vr(s,M,E),i=U(()=>{var Pe,r,u,c;if(((r=(Pe=M.value)==null?void 0:Pe.view)==null?void 0:r.row_height)!==void 0)switch((c=(u=M.value)==null?void 0:u.view)==null?void 0:c.row_height){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 6;default:return 1}});St(lr,_(!1)),St(rr,_(!1)),St(ir,_(!0)),St(sr,_(!1)),St(ur,i);const se=Ie(ta,_(!1));St(dr,n);const a=_(!1);function V(Pe,r,u=!1){var ne;const c=pt(Pe.row,(ne=s.value)==null?void 0:ne.columns);$e.value=r,c&&!se.value?G.push({query:{...p.value,rowId:c}}):(te.value=Pe,le.value=!0,a.value=!u)}h({loadData:z,openColumnCreate:Pe=>{var r;(r=I.value)==null||r.openColumnCreate(Pe)}});const b=U({get(){return!!p.value.rowId},set(Pe){Pe||G.push({query:{...p.value,rowId:void 0}})}}),F=Pe=>{a.value||Ke.emit(Wt.CLEAR_NEW_ROW,Pe)},P=()=>{De.value?(De.value=!1,ze.info(g("msg.optimizedQueryDisabled"))):(De.value=!0,ze.info(g("msg.optimizedQueryEnabled")))},{rootGroup:X,groupBy:ve,isGroupBy:q,loadGroups:tt,loadGroupData:xt,loadGroupPage:It,groupWrapperChangePage:Vt,redistributeRows:J,loadGroupAggregation:Do}=gr(),ae=Jn(),{windowSize:nt,leftSidebarWidth:dt}=cr(ae),wo=_(0);Ke.on(Pe=>{(Pe===Wt.GROUP_BY_RELOAD||Pe===Wt.DATA_RELOAD)&&(n==null||n.trigger())});const Ao=()=>{var r,u;const Pe=f();if(!m.value.isLastPage&&Pe===m.value.pageSize){const c=(r=m.value)!=null&&r.page?((u=m.value)==null?void 0:u.page)+1:1;ke(c)}be(vo.NEXT)},ro=()=>{var r,u;const Pe=f();if(!m.value.isFirstPage&&Pe===1){const c=(r=m.value)!=null&&r.page?((u=m.value)==null?void 0:u.page)-1:1;ke(c)}be(vo.PREV)},go=()=>{if(se.value){wo.value=nt.value;return}wo.value=nt.value-dt.value},Fo=U(()=>{switch(ve.value.length){case 1:return"#F9F9FA";case 2:return"#F4F4F5";case 3:return"#E7E7E9";default:return"#F9F9FA"}}),Mo=Pe=>{if(!p.value.rowId)return;const r=Te.value.findIndex(c=>c.row_id===p.value.rowId),u=y.value.findIndex(c=>{var ne;return pt(c.row,(ne=s.value)==null?void 0:ne.columns)===p.value.rowId});r===-1||u===-1||Number(Te.value[r].count)!==Pe&&(Te.value[r].count=Pe,y.value[u].rowMeta.commentCount=Pe)};return ko([nt,dt],go),Zo(()=>{go()}),(Pe,r)=>{var ye;const u=Us,c=Qn,ne=Hs;return l(),A("div",{class:"relative flex flex-col h-full min-h-0 w-full nc-grid-wrapper","data-testid":"nc-grid-wrapper",style:We(`background-color: ${e(q)?`${e(Fo)}`:"var(--nc-grid-bg)"};`)},[e(q)?(l(),x(al,{key:1,group:e(X),"load-groups":e(tt),"load-group-data":e(xt),"load-group-page":e(It),"group-wrapper-change-page":e(Vt),"row-height":e(i),"load-group-aggregation":e(Do),"max-depth":e(ve).length,"redistribute-rows":e(J),"view-width":e(wo)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","max-depth","redistribute-rows","view-width"])):(l(),x(Da,{key:0,ref_key:"tableRef",ref:I,"selected-all-records":e(pe),"onUpdate:selectedAllRecords":r[0]||(r[0]=N=>Lt(pe)?pe.value=N:null),data:e(y),"pagination-data":e(m),"load-data":e(z),"change-page":e(ke),"call-add-empty-row":e(re),"delete-row":e(ge),"update-or-save-row":e(W),"delete-selected-rows":e(ie),"delete-range-of-rows":e(Se),"bulk-update-rows":e(Ze),"expand-form":V,"remove-row-if-new":e(j),"row-height":e(i),onToggleOptimisedQuery:P,onBulkUpdateDlg:r[1]||(r[1]=N=>ue.value=!0)},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","bulk-update-rows","remove-row-if-new","row-height"])),e(q)?B("",!0):(l(),x(_a,{key:2},{default:C(()=>[e(te)&&e(le)?(l(),x(u,{key:0,modelValue:e(le),"onUpdate:modelValue":[r[2]||(r[2]=N=>Lt(le)?le.value=N:null),r[3]||(r[3]=N=>F(e(te)))],"load-row":!e(se),row:e(te),state:e($e),meta:e(s),view:e(M)},null,8,["modelValue","load-row","row","state","meta","view"])):B("",!0)]),_:1})),e(b)&&((ye=e(s))!=null&&ye.id)&&!e(q)?(l(),x(c,{key:3,modelValue:e(b),"onUpdate:modelValue":r[4]||(r[4]=N=>Lt(b)?b.value=N:null),row:e(te)??{row:{},oldRow:{},rowMeta:{}},meta:e(s),"load-row":!e(se),state:e($e),"row-id":e(p).rowId,view:e(M),"show-next-prev-icons":"","first-row":e(he),"last-row":e(et),"expand-form":V,onNext:r[5]||(r[5]=N=>Ao()),onPrev:r[6]||(r[6]=N=>ro()),onUpdateRowCommentCount:Mo},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):B("",!0),(l(),x(_a,null,{default:C(()=>[e(ue)?(l(),x(ne,{key:0,modelValue:e(ue),"onUpdate:modelValue":r[7]||(r[7]=N=>Lt(ue)?ue.value=N:null),"pagination-data":e(m),meta:e(s),view:e(M),"bulk-update-rows":e(Ze),"bulk-update-view":e(de),"selected-all-records":e(pe),rows:e(y).filter(N=>N.rowMeta.selected)},null,8,["modelValue","pagination-data","meta","view","bulk-update-rows","bulk-update-view","selected-all-records","rows"])):B("",!0)]),_:1}))],4)}}}),hu=Object.freeze(Object.defineProperty({__proto__:null,default:Ys},Symbol.toStringTag,{value:"Module"}));export{hu as i,Fr as u};
