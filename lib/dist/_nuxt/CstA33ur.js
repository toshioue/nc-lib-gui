import{f as Y,ai as Z,az as j,cM as ee,bN as te,r as v,g5 as ae,g as y,aA as se,N as ne,i as le,o as n,c as r,a as d,b as i,w as l,d as m,t as a,P as o,S as b,V as x,W as k,Q as ie,U,aq as oe,T as B,aj as L,ak as ce,a1 as de,aV as pe,a0 as re,d7 as me,A as ue}from"./3QBYHahY.js";import{_ as fe}from"./DRopnK1z.js";import{_ as _e}from"./CTSlxRce.js";import{_ as he}from"./5_MZ2zba.js";import"./kHOslGNR.js";import{I as ve}from"./CmN9vPg3.js";import"./Dg1gNFnz.js";import"./Ci1lK5Ee.js";import"./xnDaHwV-.js";import"./DPgYHC40.js";import"./BsWDDIqE.js";import"./BQQOEPN4.js";import"./ceYq-xax.js";const be={class:"h-full flex flex-row w-full items-center justify-center"},ye={class:"w-full h-full flex flex-col"},we={class:"flex flex-row items-center w-full mb-4 gap-2 justify-between"},ge={class:"flex"},xe={class:"flex items-center gap-2 text-gray-600 font-light"},ke={class:"flex flex-row items-center w-full gap-x-1"},$e={class:"flex"},Ce={key:1,class:"flex flex-row gap-x-2"},Ie={class:"flex"},Ne={key:0,class:"flex items-center gap-2 max-w-full"},Me={class:"min-w-5 flex items-center justify-center"},Te={key:1,class:"flex items-center gap-2 max-w-full"},Ve={class:"min-w-5 flex items-center justify-center"},je={key:2},Ue={key:0},Be={key:1},Je=Y({__name:"UIAcl",props:{sourceId:{}},setup(A){const R=A,{t:u}=Z(),{$api:$,$e:S}=ue(),{base:W}=j(ee()),z=te(ae,v()),_=y(()=>{var e;return z.value??((e=W.value)==null?void 0:e.id)}),{bases:E}=j(se()),C=y(()=>E.value.get(_.value)??{}),{includeM2M:G}=ne(),D=v(["editor","commenter","viewer"]),w=v(!1),f=v([]),h=v(""),I=y(()=>f.value.filter(e=>(e==null?void 0:e.source_id)===R.sourceId&&(typeof(e==null?void 0:e._ptn)=="string"&&e._ptn.toLowerCase().includes(h.value.toLowerCase())||typeof(e==null?void 0:e.title)=="string"&&e.title.toLowerCase().includes(h.value.toLowerCase())))),g=y(()=>D.value.reduce((e,c)=>({...e,[c]:f.value.filter(p=>p.disabled[c]).length===0}),{})),F=e=>{const c=!g.value[e];f.value.forEach(p=>{p.disabled[e]=c,p.edited=!0})};async function N(){try{if(!_.value)return;w.value=!0,f.value=await $.base.modelVisibilityList(_.value,{includeM2M:G.value})}catch(e){console.error(e)}finally{w.value=!1}}async function P(){try{if(!_.value)return;await $.base.modelVisibilitySet(_.value,f.value.filter(e=>e.edited)),L.success(u("msg.success.updatedUIACL"))}catch(e){L.error(await ce(e))}S("a:proj-meta:ui-acl")}const q=(e,c)=>{e.disabled[c]=!e.disabled[c],e.edited=!0};le(async()=>{f.value.length===0&&await N()});const H=[{key:"name",title:u("labels.tableName"),name:"Table Name",minWidth:220,padding:"0px 12px",dataIndex:"_ptn"},{key:"name",title:u("labels.viewName"),name:"View Name",minWidth:220,padding:"0px 12px",dataIndex:"title"},{key:"action",title:u("objects.roleType.editor"),name:"editor",width:120,minWidth:120,padding:"0px 12px"},{key:"action",title:u("objects.roleType.commenter"),name:"commenter",width:135,minWidth:135,padding:"0px 12px"},{key:"action",title:u("objects.roleType.viewer"),name:"viewer",width:120,minWidth:120,padding:"0px 12px"}];return(e,c)=>{const p=de,Q=ve,J=pe,K=re,M=fe,T=_e,O=me,X=he;return n(),r("div",be,[d("div",ye,[i(p,{class:"mb-4 first-letter:capital font-bold max-w-100 truncate","show-on-truncate-only":""},{title:l(()=>[m(a(o(C).title),1)]),default:l(()=>[d("span",null," UI ACL : "+a(o(C).title),1)]),_:1}),d("div",we,[i(Q,{value:o(h),"onUpdate:value":c[0]||(c[0]=s=>ie(h)?h.value=s:null),placeholder:e.$t("placeholder.searchModels"),"allow-clear":"",class:"nc-acl-search nc-input-border-on-value !w-[400px] nc-input-sm"},{prefix:l(()=>[(n(),b(x(("iconMap"in e?e.iconMap:o(k)).search),{class:"text-gray-600"}))]),_:1},8,["value","placeholder"]),d("div",ge,[i(J,{type:"text",ghost:"",class:"self-start !rounded-md nc-acl-reload",onClick:N},{default:l(()=>[d("div",xe,[(n(),b(x(("iconMap"in e?e.iconMap:o(k)).reload),{class:U({"animate-infinite animate-spin !text-success":o(w)})},null,8,["class"])),m(" "+a(e.$t("general.reload")),1)])]),_:1}),i(K,{size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:P},{default:l(()=>[d("div",ke,[(n(),b(x(("iconMap"in e?e.iconMap:o(k)).save))),d("div",$e,a(e.$t("general.save")),1)])]),_:1})])]),i(X,{columns:H,data:o(I),"row-height":"44px","header-row-height":"44px",class:"h-[calc(100%_-_88px)] w-full"},{headerCell:l(({column:s})=>[s.key==="name"?(n(),r(oe,{key:0},[m(a(s.title),1)],64)):B("",!0),s.key==="action"?(n(),r("div",Ce,[i(M,{checked:o(g)[s.name],"onUpdate:checked":t=>o(g)[s.name]=t,disabled:!o(I).length,class:"!m-0 !top-0",onChange:t=>F(s.name)},null,8,["checked","onUpdate:checked","disabled","onChange"]),d("div",Ie,a(s.title),1)])):B("",!0)]),bodyCell:l(({column:s,record:t})=>{var V;return[s.name==="Table Name"?(n(),r("div",Ne,[d("div",Me,[i(T,{meta:{meta:t.table_meta,type:t.ptype},class:"text-gray-500"},null,8,["meta"])]),i(p,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[m(a(t._ptn),1)]),default:l(()=>[m(" "+a(t._ptn),1)]),_:2},1024)])):s.name==="View Name"?(n(),r("div",Te,[d("div",Ve,[(V=t==null?void 0:t.meta)!=null&&V.icon?(n(),b(T,{key:0,meta:{meta:t.meta,type:"view"},class:"text-gray-500 !text-sm !children:w-5 !children:h-5"},null,8,["meta"])):(n(),b(O,{key:1,meta:t,class:"text-gray-500"},null,8,["meta"]))]),i(p,{class:"truncate","show-on-truncate-only":""},{title:l(()=>[m(a(t.is_default?e.$t("title.defaultView"):t.title),1)]),default:l(()=>[m(" "+a(t.is_default?e.$t("title.defaultView"):t.title),1)]),_:2},1024)])):(n(),r("div",je,[i(p,null,{title:l(()=>[t.disabled[s.name]?(n(),r("span",Ue,a(e.$t("labels.clickToMake"))+" '"+a(t.title)+"' "+a(e.$t("labels.visibleForRole"))+" "+a(s.name)+" "+a(e.$t("labels.inUI"))+" dashboard",1)):(n(),r("span",Be,a(e.$t("labels.clickToHide"))+" '"+a(t.title)+"' "+a(e.$t("labels.forRole"))+":"+a(s.name)+" "+a(e.$t("labels.inUI")),1))]),default:l(()=>[i(M,{checked:!t.disabled[s.name],class:U(`nc-acl-${t.title}-${s.name}-chkbox !ml-0.25`),onChange:Le=>q(t,s.name)},null,8,["checked","class","onChange"])]),_:2},1024)]))]}),_:1},8,["data"])])])}}});export{Je as default};
