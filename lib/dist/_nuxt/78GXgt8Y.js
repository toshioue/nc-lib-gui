import{_ as h}from"./D7hrRKCy.js";import{f as S,r as f,g as b,d6 as j,i as L,o as P,c as U,b as u,P as i,w as V,d as C,a0 as D}from"./3QBYHahY.js";import{a as N}from"./DsMESSVl.js";import"./BEpKpjF5.js";import"./CGxepfeV.js";import"./BQQOEPN4.js";import"./3ezdMRmZ.js";import"./DPgYHC40.js";import"./xnDaHwV-.js";import"./DdUr8XSo.js";import"./leimKhvx.js";import"./CyuhXrst.js";import"./PcgFfkcK.js";import"./Kma333Sh.js";import"./CSl6euFG.js";import"./BteOdwRG.js";import"./BYmqikBK.js";import"./kHOslGNR.js";import"./CmN9vPg3.js";import"./BsWDDIqE.js";import"./ceYq-xax.js";import"./C95Svpv6.js";import"./WrawXyJR.js";import"./Dwil3It4.js";import"./C3C9oN3-.js";import"./Ddy65kPJ.js";import"./2yzrrcqg.js";import"./Uiq3YTcq.js";import"./BvNTpA6D.js";import"./DsWDg2xe.js";import"./-3s5K4B9.js";import"./boyBAVNN.js";import"./C_sJ8CbE.js";import"./McwC7LnE.js";import"./B7E-dSAd.js";import"./CfxEkdGP.js";import"./DzvpY9ZV.js";import"./Bj2FvocX.js";import"./DPqnb67u.js";const R={class:"flex flex-col gap-2 p-2 border-1 rounded-lg"},ye=S({__name:"index",setup(T){const{extension:s,tables:m,getViewsForTable:w,getData:I}=N(),r=f([]),e=f({}),_=b(()=>m.value.map(t=>({label:t.title,value:t.id}))),x=b(()=>e.value.tableId?r.value.filter(t=>t.type===j.GRID).map(t=>({label:t.is_default?"Default":t.title,value:t.id}))||[]:[]),c=async()=>{e.value.tableId&&(r.value=await w(e.value.tableId))},y=async t=>{var o;e.value.tableId=t,await c(),e.value.viewId=(o=r.value.find(a=>a.is_default))==null?void 0:o.id,await s.value.kvStore.set("exportPayload",e.value)},g=async t=>{e.value.viewId=t,await s.value.kvStore.set("exportPayload",e.value)},k=async()=>{if(!e.value.tableId||!e.value.viewId)return;const t=[];I({tableId:e.value.tableId,viewId:e.value.viewId,eachPage:(o,a)=>{t.push(...o),a()},done:()=>{const o=JSON.stringify(t,null,2),a=new Blob([o],{type:"application/json"}),n=URL.createObjectURL(a),l=document.createElement("a"),v=m.value.find(d=>d.id===e.value.tableId),p=r.value.find(d=>d.id===e.value.viewId);v&&p?l.download=`${v.title} - ${p.is_default?"Default":p.title}.json`:l.download="data.json",l.href=n,l.click(),URL.revokeObjectURL(n)}})};return L(()=>{e.value=s.value.kvStore.get("exportPayload")||{},c()}),(t,o)=>{const a=h,n=D;return P(),U("div",R,[u(a,{value:i(e).tableId,"onUpdate:value":o[0]||(o[0]=l=>i(e).tableId=l),options:i(_),placeholder:"-select table-",onChange:y},null,8,["value","options"]),u(a,{value:i(e).viewId,"onUpdate:value":o[1]||(o[1]=l=>i(e).viewId=l),options:i(x),placeholder:"-select view-",onChange:g},null,8,["value","options"]),u(n,{onClick:k},{default:V(()=>[C("Export")]),_:1})])}}});export{ye as default};
