const __vite__fileDeps=["./CvksyRHS.js","./3QBYHahY.js","./entry.Ic44fwRn.css","./Df02Q_8o.js","./DPqnb67u.js","./D4iSzjWt.js","./VirtualCell.BYk4C8Tn.css","./fm4Ai8Gq.js","./T74iQZdg.js","./CSl6euFG.js","./Bj2FvocX.js","./boyBAVNN.js","./BYmqikBK.js","./Cell.DUBzJZSm.css","./e9_Ufzts.js","./VirtualCell.DaTWCMZu.css","./CjWFO-CW.js","./CtMydB5S.js","./Cell.CE2XxAOg.css","./B6kJGnpr.js","./CuAdH0Sr.js","./BSepFqtU.js","./BEpKpjF5.js","./CGxepfeV.js","./BQQOEPN4.js","./3ezdMRmZ.js","./DPgYHC40.js","./xnDaHwV-.js","./Pagination.D7qN7qzC.css","./B4uVmeYG.js","./BH8oNBwT.js","./DEVpQDRz.js","./Giw8WUI1.js","./DiVAloGI.js","./kHOslGNR.js","./CmN9vPg3.js","./BsWDDIqE.js","./ceYq-xax.js","./Pagination.Sdu4RSaT.css","./BGXIEfpz.js","./DdUr8XSo.js","./MenuItem.C7h59s4s.css","./leimKhvx.js","./CyuhXrst.js","./Divider.DqtSqZhb.css","./PcgFfkcK.js","./Menu.CQ8GNWeI.css","./Kma333Sh.js","./CmSmNSNp.js","./DivDataCell.1yCNpUg3.css","./DmzaAQYu.js","./UserIcon.DEVmGavY.css","./Wbpa_-L5.js","./DHsWytsD.js","./Badge.D0-UrqG9.css","./Bczc_1bi.js","./Cy50pBgZ.js","./links.C8uCzV-l.css","./Dwil3It4.js","./Cy5w9qev.js","./DsWDg2xe.js","./Uiq3YTcq.js","./CL-Lp6PG.js","./DkE_qgY_.js","./-3s5K4B9.js","./BteOdwRG.js","./2yzrrcqg.js","./Tabs.DaLSLYpn.css","./BkiSZLeF.js","./CJ26qO3d.js","./DeleteModal.SEMJ_gSK.css","./CsJPQclb.js","./CfxEkdGP.js","./DGM-hiY9.js","./C95Svpv6.js","./index.MCJqUXFi.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as qe,bN as I,r as c,d9 as Ge,d8 as Je,hm as We,gC as Qe,dJ as Ke,hn as Xe,dA as Ye,az as Ze,cQ as et,aB as V,aF as tt,hL as ot,hK as at,hT as nt,hJ as st,hg as lt,M as rt,u as it,N as ut,g as b,de as dt,ii as W,L as ct,l as mt,b1 as _t,ib as pt,H as ft,d6 as yt,O as vt,o as n,c as r,b as p,w as d,P as t,S as i,R as we,V as Q,W as K,d as M,t as X,T as w,a as m,U as Y,aa as wt,aq as v,av as S,co as gt,fO as Z,Q as O,dH as ge,hS as he,Z as g,a6 as h,$ as ht,a0 as kt,fs as xt,p as It,e as bt,_ as Vt}from"./3QBYHahY.js";import{_ as Rt}from"./DdUr8XSo.js";import{_ as Ct}from"./leimKhvx.js";import{_ as Dt}from"./PcgFfkcK.js";import{_ as Et}from"./Kma333Sh.js";import{a as jt}from"./BteOdwRG.js";import{a as St}from"./BxzO9ZxL.js";import{u as At}from"./BqSRViGZ.js";import{D as zt,C as ke}from"./D4iSzjWt.js";import{j as xe,e as Pt,d as Lt}from"./BYmqikBK.js";import{i as $t}from"./C00NHga8.js";import{_ as Nt}from"./DXcpq_l6.js";import{S as Tt}from"./Giw8WUI1.js";import{_ as Mt}from"./BIGB1nv-.js";import"./CyuhXrst.js";import"./CSl6euFG.js";import"./DPqnb67u.js";import"./B4uVmeYG.js";import"./DEVpQDRz.js";const Ot=g(()=>h(()=>import("./CvksyRHS.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(s=>s.default||s)),Ft=g(()=>h(()=>import("./Df02Q_8o.js"),__vite__mapDeps([3,1,2,4,5,6]),import.meta.url).then(s=>s.default||s)),Ut=g(()=>h(()=>import("./fm4Ai8Gq.js"),__vite__mapDeps([7,1,2,8,9,10,4,11,12,5,13]),import.meta.url).then(s=>s.default||s)),Bt=g(()=>h(()=>import("./e9_Ufzts.js"),__vite__mapDeps([14,1,2,4,12,15]),import.meta.url).then(s=>s.default||s)),Ht=g(()=>h(()=>import("./CjWFO-CW.js"),__vite__mapDeps([16,1,2,17,5,18]),import.meta.url).then(s=>s.default||s)),qt=g(()=>h(()=>import("./B6kJGnpr.js"),__vite__mapDeps([19,8,9,1,2,10,4,11,12]),import.meta.url).then(s=>s.default||s)),Gt=g(()=>h(()=>import("./CuAdH0Sr.js"),__vite__mapDeps([20,21,1,2,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url).then(s=>s.default||s)),Jt=g(()=>h(()=>import("./BGXIEfpz.js"),__vite__mapDeps([39,1,2,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,34,35,24,27,26,36,37,57,58,59,60,61,62,9,12,63,8,10,4,11,64,65,66,67,68,69,70,71,72,73,74,32,31,75]),import.meta.url).then(s=>s.default||s)),Ie=s=>(It("data-v-f0e4ead6"),s=s(),bt(),s),Wt={class:"flex items-center gap-2"},Qt={class:"flex items-center gap-2"},Kt={key:0,class:"flex flex-col h-full"},Xt={class:"nc-gallery-container-skeleton grid gap-3 p-3"},Yt={key:1,class:"nc-gallery-container grid gap-3 p-3"},Zt=Ie(()=>m("a",null,[m("div",null,[m("div")])],-1)),eo={class:"z-10 arrow"},to={class:"z-10 arrow"},oo={key:1,class:"h-52 w-full !flex flex-row !border-b-1 !border-gray-200 items-center justify-center"},ao=Ie(()=>m("img",{class:"object-contain w-[48px] h-[48px]",src:Nt},null,-1)),no=[ao],so={class:"flex flex-col gap-3 !children:pointer-events-none"},lo={key:0,class:"nc-card-display-value-wrapper"},ro=["onClick"],io={class:"flex flex-col rounded-lg w-full"},uo={class:"flex flex-row w-full justify-start"},co={class:"nc-card-col-header w-full !children:text-gray-500"},mo={key:0,class:"flex flex-row w-full text-gray-800 items-center justify-start min-h-7 py-1"},_o={key:1,class:"flex flex-row w-full h-7 pl-1 items-center justify-start"},po={class:"flex items-center gap-2"},fo=qe({__name:"Gallery",setup(s){const f=I(Ge,c()),A=I(Je,c()),F=I(We),z=I(Qe),R=I(Xe,Ke()),U=I(Ye,c(!1)),{isViewDataLoading:P}=Ze(et()),{isSqlView:ee,xWhere:be}=jt(),C=c(!1),D=c(),te=c(),{loadData:oe,paginationData:B,formattedData:H,loadGalleryData:ae,galleryData:q,changePage:Ve,deleteRow:Re,navigateToSiblingRow:ne}=St(f,A,be);V(tt,c(!1)),V(ot,c(!0)),V(at,c(!1)),V(nt,c(!1)),V(st,c(1));const se=I(lt,c([])),L=rt(),le=it(),{getPossibleAttachmentSrc:Ce}=At(),{isMobileMode:De}=ut(),Ee=b(()=>se.value.filter(e=>!zt(e))),y=b(()=>{var e,o;return((o=(e=f.value)==null?void 0:e.columns)==null?void 0:o.find(u=>u.pv&&se.value.includes(u)))??null}),E=b(()=>{var e,o;return(e=f.value)!=null&&e.columnsById?f.value.columnsById[(o=q.value)==null?void 0:o.fk_cover_image_col_id]:{}}),je=b(()=>{var o,u;const e=((u=dt((o=q.value)==null?void 0:o.meta))==null?void 0:u.fk_cover_image_object_fit)||W.FIT;if(e===W.FIT)return"!object-contain";if(e===W.COVER)return"!object-cover"}),{isUIAllowed:re}=ct(),Se=b(()=>re("dataEdit")),ie=c(!1),$=b({get:()=>ie.value,set:e=>{Se.value&&(ie.value=e)}}),j=c(null),Ae=(e,o)=>{ee.value||(e.preventDefault(),o&&(j.value=o))},ue=e=>{var o;if(!((o=E.value)!=null&&o.title)||!e.row[E.value.title])return[];try{const u=typeof e.row[E.value.title]=="string"?JSON.parse(e.row[E.value.title]):e.row[E.value.title];return Array.isArray(u)?u.flat().map(_=>typeof _=="string"?JSON.parse(_):_).filter(_=>_&&!Array.isArray(_)&&typeof _=="object"&&Object.keys(_).length):[]}catch{return[]}},N=(e,o)=>{const u=Pt(e.row,f.value.columns);te.value=o,u&&!U.value?(D.value=void 0,le.push({query:{...L.query,rowId:u}})):(D.value=e,C.value=!0)},de=async(e,o)=>{const u=e.target;u.closest(".arrow")||u.closest(".slick-dots")||N(o)},ce=async()=>{var e;N({row:{...Lt((e=f.value)==null?void 0:e.columns)},oldRow:{},rowMeta:{new:!0}})},ze=(e,o)=>{ke(e)&&o.stopPropagation()};R==null||R.on(ce),mt(()=>R.off(ce));const T=b({get(){return!!L.query.rowId},set(e){e||le.push({query:{...L.query,rowId:void 0}})}}),G=c(!1);return F==null||F.on(async()=>{await ae(),G.value=!0,_t(()=>{G.value=!1})}),z==null||z.on(async e=>{await oe({...(e==null?void 0:e.offset)!==void 0?{offset:e.offset}:{}})}),V(pt,z),ft(A,async e=>{P.value=!0;try{(e==null?void 0:e.type)===yt.GALLERY&&(await oe(),await ae())}finally{P.value=!1}},{immediate:!0}),(e,o)=>{const u=Rt,_=Ct,Pe=Dt,Le=Tt,me=ht,J=kt,$e=Ot,Ne=Mt,_e=Ft,pe=Ut,Te=Bt,Me=Ht,Oe=xt,Fe=qt,Ue=Et,Be=Gt,fe=Jt,ye=vt("e");return n(),r(v,null,[p(Ue,{visible:t($),"onUpdate:visible":o[3]||(o[3]=a=>O($)?$.value=a:null),trigger:t(ee)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:d(()=>[p(Pe,{onClick:o[2]||(o[2]=a=>$.value=!1)},{default:d(()=>{var a;return[t(j)?(n(),i(u,{key:0,onClick:o[0]||(o[0]=k=>N(t(j).row))},{default:d(()=>[we((n(),r("div",Wt,[(n(),i(Q(("iconMap"in e?e.iconMap:t(K)).expand),{class:"flex"})),M(" "+X(e.$t("activity.expandRecord")),1)])),[[ye,["a:row:expand-record"]]])]),_:1})):w("",!0),p(_),((a=t(j))==null?void 0:a.index)!==void 0?(n(),i(u,{key:1,class:"!text-red-600 !hover:bg-red-50",onClick:o[1]||(o[1]=k=>t(Re)(t(j).index))},{default:d(()=>[we((n(),r("div",Qt,[(n(),i(Q(("iconMap"in e?e.iconMap:t(K)).delete),{class:"flex"})),M(" "+X(e.$t("activity.deleteRow")),1)])),[[ye,["a:row:delete"]]])]),_:1})):w("",!0)]}),_:1})]),default:d(()=>[m("div",{class:Y(["flex flex-col w-full nc-gallery nc-scrollbar-md bg-gray-50",{"!overflow-hidden":t(P)}]),"data-testid":"nc-gallery-wrapper",style:wt({height:t(De)?"calc(100% - var(--topbar-height))":"calc(100% - var(--topbar-height) + 0.6rem)"})},[t(P)?(n(),r("div",Kt,[m("div",Xt,[(n(!0),r(v,null,S(Array(20),a=>(n(),i(Le,{key:a,class:"!min-w-60.5 !h-96 !rounded-md overflow-hidden"}))),128))])])):(n(),r("div",Yt,[(n(!0),r(v,null,S(t(H),(a,k)=>(n(),r("div",{key:`record-${a.row.id}`},[p(Fe,{row:a},{default:d(()=>{var ve;return[p(Oe,{class:"!rounded-xl h-full border-gray-200 border-1 group overflow-hidden break-all max-w-[450px] cursor-pointer","body-style":{padding:"16px !important"},"data-testid":`nc-gallery-card-${a.row.id}`,onClick:l=>de(l,a),onContextmenu:l=>Ae(l,{row:a,index:k})},gt({default:d(()=>[m("div",so,[t(y)?(n(),r("h2",lo,[("isRowEmpty"in e?e.isRowEmpty:t(xe))(a,t(y))?(n(),r(v,{key:1},[M(" - ")],64)):(n(),r(v,{key:0},[t(Z)(t(y))?(n(),i(_e,{key:0,modelValue:a.row[t(y).title],"onUpdate:modelValue":l=>a.row[t(y).title]=l,class:"!text-brand-500",column:t(y),row:a},null,8,["modelValue","onUpdate:modelValue","column","row"])):(n(),i(pe,{key:1,modelValue:a.row[t(y).title],"onUpdate:modelValue":l=>a.row[t(y).title]=l,class:"!text-brand-500",column:t(y),"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))],64))])):w("",!0),(n(!0),r(v,null,S(t(Ee),l=>(n(),r("div",{key:`record-${a.row.id}-${l.id}`,class:Y({"!children:pointer-events-auto":("isButton"in e?e.isButton:t(ke))(l)}),onClick:x=>ze(l,x)},[m("div",io,[m("div",uo,[m("div",co,[t(Z)(l)?(n(),i(Te,{key:0,column:l,"hide-menu":!0},null,8,["column"])):(n(),i(Me,{key:1,column:l,"hide-menu":!0},null,8,["column"]))])]),("isRowEmpty"in e?e.isRowEmpty:t(xe))(a,l)?(n(),r("div",_o,"-")):(n(),r("div",mo,[t(Z)(l)?(n(),i(_e,{key:0,modelValue:a.row[l.title],"onUpdate:modelValue":x=>a.row[l.title]=x,column:l,row:a,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column","row"])):(n(),i(pe,{key:1,modelValue:a.row[l.title],"onUpdate:modelValue":x=>a.row[l.title]=x,column:l,"edit-enabled":!1,"read-only":!0,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column"]))]))])],10,ro))),128))])]),_:2},[(ve=t(q))!=null&&ve.fk_cover_image_col_id?{name:"cover",fn:d(()=>[!t(G)&&ue(a).length?(n(),i(Ne,{key:0,class:"gallery-carousel !border-b-1 !border-gray-200 min-h-52",arrows:""},{customPaging:d(()=>[Zt]),prevArrow:d(()=>[m("div",eo,[p(J,{type:"secondary",size:"xsmall",class:"!absolute !left-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:d(()=>[p(me,{icon:"arrowLeft",class:"text-gray-700 w-4 h-4"})]),_:1})])]),nextArrow:d(()=>[m("div",to,[p(J,{type:"secondary",size:"xsmall",class:"!absolute !right-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:d(()=>[p(me,{icon:"arrowRight",class:"text-gray-700 w-4 h-4"})]),_:1})])]),default:d(()=>[(n(!0),r(v,null,S(ue(a),(l,x)=>(n(),r(v,null,[("isImage"in e?e.isImage:t($t))(l.title,l.mimetype??l.type)?(n(),i($e,{key:`carousel-${a.row.id}-${x}`,class:Y(["h-52",[`${t(je)}`]]),srcs:t(Ce)(l,"card_cover"),onClick:He=>de(He,a)},null,8,["class","srcs","onClick"])):w("",!0)],64))),256))]),_:2},1024)):(n(),r("div",oo,no))]),key:"0"}:void 0]),1032,["data-testid","onClick","onContextmenu"])]}),_:2},1032,["row"])]))),128)),t(H).length<=4?(n(!0),r(v,{key:0},S(Array(8-t(H).length),a=>(n(),r("div",{key:a,class:"nc-empty-card"}))),128)):w("",!0)]))],6)]),_:1},8,["visible","trigger"]),p(Be,{"pagination-data":t(B),"onUpdate:paginationData":o[4]||(o[4]=a=>O(B)?B.value=a:null),"align-count-on-right":"","show-api-timing":"","change-page":t(Ve),class:""},{"add-record":d(()=>[t(re)("dataInsert")?(n(),i(J,{key:0,size:"xs",type:"secondary",class:"ml-2",onClick:t(R).trigger},{default:d(()=>[m("div",po,[(n(),i(Q(("iconMap"in e?e.iconMap:t(K)).plus),{class:""})),M(" "+X(e.$t("activity.newRecord")),1)])]),_:1},8,["onClick"])):w("",!0)]),_:1},8,["pagination-data","change-page"]),(n(),i(ge,null,{default:d(()=>[t(D)&&t(C)?(n(),i(fe,{key:0,modelValue:t(C),"onUpdate:modelValue":o[5]||(o[5]=a=>O(C)?C.value=a:null),row:t(D),"load-row":!t(U),state:t(te),meta:t(f),view:t(A)},null,8,["modelValue","row","load-row","state","meta","view"])):w("",!0)]),_:1})),(n(),i(ge,null,{default:d(()=>{var a;return[t(T)&&((a=t(f))!=null&&a.id)?(n(),i(fe,{key:0,modelValue:t(T),"onUpdate:modelValue":o[6]||(o[6]=k=>O(T)?T.value=k:null),row:t(D)??{row:{},oldRow:{},rowMeta:{}},meta:t(f),"load-row":!t(U),"row-id":t(L).query.rowId,view:t(A),"show-next-prev-icons":"","expand-form":N,onNext:o[7]||(o[7]=k=>t(ne)(("NavigateDir"in e?e.NavigateDir:t(he)).NEXT)),onPrev:o[8]||(o[8]=k=>t(ne)(("NavigateDir"in e?e.NavigateDir:t(he)).PREV))},null,8,["modelValue","row","meta","load-row","row-id","view"])):w("",!0)]}),_:1}))],64)}}}),Lo=Vt(fo,[["__scopeId","data-v-f0e4ead6"]]);export{Lo as default};
