import{e as ee,L as ae,bL as d,g2 as le,r as n,hK as te,aA as se,aC as ne,h_ as ue,i2 as oe,aD as re,h5 as ie,ha as ce,ag as ve,f as E,cq as j,D as fe,ad as K,F as N,d0 as de,aE as pe,j4 as me,o as x,c as B,b as O,w as z,a as D,N as s,O as R,a7 as ye,W as M,Q as ke,R as G,S as Ye,ao as be,Y as ge,_ as Ie}from"./DZZ6t_j4.js";import{_ as $e}from"./jD721dGr.js";import{_ as Ce}from"./vK-WmZ7a.js";const we=["title"],Ve=["value","placeholder","readonly"],he={class:"w-[256px]"},_e={key:0,class:"absolute inset-0 z-90 cursor-pointer"},Ee=ee({__name:"YearPicker",props:{modelValue:{},isPk:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(I,{emit:T}){const F=T,{showNull:h,isMobileMode:U}=ae(),L=d(le,null),k=d(te,n(!1)),$=d(se,n(!1)),r=d(ne,n(!1)),Y=d(ue,n(!1)),p=d(oe,n(!1)),q=d(re,n(!1)),A=d(ie,n(!1)),b=d(ce,n(!1)),C=n(!1),i=n(),w=n(!1),{t:P}=ve(),t=n(!1),m=n(),u=E({get(){if(!I.modelValue||w.value)return;const e=j(I.modelValue.toString(),"YYYY");if(!e.isValid()){C.value=!0;return}return e},set(e){if(w.value=!1,!e){F("update:modelValue",null);return}e!=null&&e.isValid()&&F("update:modelValue",e.format("YYYY")),t.value=!1}});fe(()=>{u.value&&(m.value=u.value)});const c=`picker_${Math.floor(Math.random()*99999)}`;K(i,e=>{var a,l,o;(a=e.target)!=null&&a.closest(`.${c}, .nc-${c}`)||((o=(l=i.value)==null?void 0:l.blur)==null||o.call(l),t.value=!1)});const H=e=>{var a,l;(a=e==null?void 0:e.relatedTarget)!=null&&a.closest(`.${c}, .nc-${c}`)||(l=e==null?void 0:e.target)!=null&&l.closest(`.${c}, .nc-${c}`)||(t.value=!1)};N(t,e=>{var a,l;e?(r.value=!0,(l=(a=i.value)==null?void 0:a.focus)==null||l.call(a),K(document.querySelector(`.${c}`),o=>{var v;(v=o==null?void 0:o.target)!=null&&v.closest(`.nc-${c}`)||(t.value=!1)})):w.value=!1},{flush:"post"}),N(r,e=>{p.value&&e&&!t.value&&(t.value=!0)});const Q=E(()=>(q.value||b.value)&&!C.value||p.value&&!h.value&&!C.value&&!de(L.value)&&$.value||Y.value?"YYYY":I.modelValue===null&&h.value?P("general.null").toUpperCase():C.value?P("msg.invalidTime"):""),_=E(()=>k.value||(k.value||u.value&&I.isPk)&&!$.value&&!r.value?!1:t.value),W=()=>{k.value||t.value||(t.value=$.value||r.value)},J=(e,a)=>{var l,o,v,f,y,g,V,S;switch(e.key!=="Enter"&&e.key!=="Tab"&&e.stopPropagation(),e.key){case"Enter":e.preventDefault(),A.value&&e.stopPropagation(),u.value=m.value,t.value=!a,t.value||(r.value=!1,p.value&&!b.value&&!Y.value&&((o=(l=i.value)==null?void 0:l.blur)==null||o.call(l)));return;case"Tab":t.value=!1,p.value&&(r.value=!1,(f=(v=i.value)==null?void 0:v.blur)==null||f.call(v));return;case"Escape":a?(t.value=!1,r.value=!1,p.value&&!b.value&&!Y.value&&((g=(y=i.value)==null?void 0:y.blur)==null||g.call(y))):(r.value=!1,(S=(V=i.value)==null?void 0:V.blur)==null||S.call(V));return;default:!a&&/^[0-9a-z]$/i.test(e.key)&&(t.value=!0)}};pe(document,"keydown",e=>{if($.value&&!(e.altKey||e.shiftKey||!p.value||b.value||Y.value||me())){if(e.metaKey||e.ctrlKey)if(e.key===";")p.value&&!b.value&&!Y.value&&(u.value=j(new Date),e.preventDefault());else return;!_.value&&i.value&&/^[0-9a-z]$/i.test(e.key)&&(w.value=!0,i.value.focus(),r.value=!0,t.value=!0)}});const X=e=>{const a=e.target.value;if(!a){m.value=void 0;return}const l=j(a,"YYYY");l.isValid()&&(m.value=l)};function Z(e){m.value=e,u.value=e,t.value=!1}return(e,a)=>{const l=ge,o=$e,v=Ce;return x(),B(be,null,[O(v,{visible:s(_),"auto-close":!1,trigger:["click"],disabled:s(k),class:Ye(["nc-cell-field",[`nc-${c}`,{"nc-null":e.modelValue===null&&s(h)}]]),"overlay-class-name":`${c} nc-picker-year ${s(t)?"active":""} !min-w-[260px]`},{overlay:z(()=>[D("div",he,[O(o,{"page-date":s(m),"onUpdate:pageDate":a[4]||(a[4]=f=>R(m)?m.value=f:null),"selected-date":s(u),"onUpdate:selectedDate":a[5]||(a[5]=f=>R(u)?u.value=f:null),"is-open":s(_),"is-year-picker":"","is-cell-input-field":"",size:"medium"},null,8,["page-date","selected-date","is-open"])])]),default:z(()=>{var f,y;return[D("div",ye(e.$attrs,{title:(f=s(u))==null?void 0:f.format("YYYY"),class:"nc-year-picker flex items-center justify-between ant-picker-input relative"}),[D("input",{ref_key:"datePickerRef",ref:i,type:"text",value:((y=s(u))==null?void 0:y.format("YYYY"))??"",placeholder:s(Q),class:"nc-year-input border-none outline-none !text-current bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:s(k)||!!s(U),onBlur:H,onKeydown:a[0]||(a[0]=g=>J(g,s(t))),onMouseup:a[1]||(a[1]=M(()=>{},["stop"])),onMousedown:a[2]||(a[2]=M(()=>{},["stop"])),onClick:W,onInput:X},null,40,Ve),s(u)&&!s(k)?(x(),ke(l,{key:0,icon:"closeCircle",class:"nc-clear-year-icon nc-action-icon absolute right-0 top-[50%] transform -translate-y-1/2 invisible cursor-pointer",onClick:a[3]||(a[3]=M(g=>Z(),["stop"]))})):G("",!0)],16,we)]}),_:1},8,["visible","disabled","class","overlay-class-name"]),!s(r)&&s(p)?(x(),B("div",_e)):G("",!0)],64)}}}),Me=Ie(Ee,[["__scopeId","data-v-88bb74a9"]]);export{Me as default};
