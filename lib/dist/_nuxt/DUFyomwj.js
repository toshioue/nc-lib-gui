import{f as J,ag as Q,r as w,N as W,g as Z,iZ as x,eJ as $,P as o,o as s,U as A,c as a,b,w as _,S as c,Q as T,al as j,am as X,a as n,t as r,aC as Y,T as ee,d as N,an as te,ao as se,d4 as O,dt as ae,ak as oe,p as ne,e as ie,_ as re}from"./nEPQs079.js";import{S as le}from"./COwQxOku.js";import{_ as ce,C as pe}from"./BEsLTnUh.js";import{a as de,c as _e,_ as ue}from"./DUhkN2eB.js";import{_ as me}from"./DJpQD7nd.js";import"./C4eCLVVw.js";import"./DhnetN0h.js";import"./BUcNRxMi.js";import"./QTd5iuHu.js";import"./CFgyk-dW.js";import"./BTGvCRQH.js";import"./BQQOEPN4.js";import"./BLe4UTYD.js";import"./DKtVUO_j.js";import"./COktFmkf.js";import"./B-HMHOhf.js";const R=u=>(ne("data-v-aef46dc2"),u=u(),ie(),u),ye={key:1},fe={key:0},ve={key:1},he={key:2},ge={key:0},we={key:1},xe=R(()=>n("span",null,[N(" For additional configuration options, please refer the documentation "),n("a",{href:"https://docs.nocodb.com/developer-resources/webhooks#call-log",target:"_blank",rel:"noopener"},"here"),N(". ")],-1)),be={key:0},Re={class:"w-full cursor-pointer"},Ae={class:"font-weight-medium flex"},Oe={class:"flex-1"},Ee={key:0},Ce={key:0,class:"mx-1 px-2 py-1 text-white rounded text-xs bg-red-500"},Te={key:1,class:"mx-1 px-2 py-1 text-white rounded text-xs bg-green-500"},Ne={key:0},Fe={class:"font-weight-medium text-primary"},Ie={key:0,class:"mb-4"},Se={key:1},Ue={key:0,class:"nc-hook-log-request"},Ve=R(()=>n("div",{class:"nc-hook-pre-title"},"Request",-1)),Ke={class:"nc-hook-pre"},Be={key:1,class:"nc-hook-log-response"},Le=R(()=>n("div",{class:"nc-hook-pre-title"},"Response",-1)),Me={class:"nc-hook-pre"},Pe={key:2,class:"nc-hook-log-payload"},ke=R(()=>n("div",{class:"nc-hook-pre-title"},"Payload",-1)),ze={class:"nc-hook-pre"},Ge={key:2},qe={key:0,class:"nc-hook-log-payload"},He=R(()=>n("div",{class:"nc-hook-pre-title"},"Payload",-1)),De={class:"nc-hook-pre"},Je=J({__name:"CallLog",props:{hook:{}},setup(u){const V=u,{api:K,isLoading:B}=Q(),E=w([]),C=w(),{appInfo:d}=W(),F=w(0),m=w(1),y=w(10),I=Z(()=>!(d.value.automationLogLevel===x.OFF||d.value.automationLogLevel===x.ALL&&!d.value.ee));async function S(i=m.value,l=y.value){try{i=i||1;const{list:p,pageInfo:t}=await K.dbTableWebhookLogs.list(V.hook.id,{offset:l*(i-1),limit:l});E.value=L(p),F.value=t.totalRows??0}catch(p){te.error(await se(p))}}function L(i){var l,p;for(const t of i)t!=null&&t.response&&(t.response=O(t.response)),(p=(l=t==null?void 0:t.response)==null?void 0:l.config)!=null&&p.data&&(t.response.config.data=O(t.response.config.data)),t!=null&&t.payload&&(t.payload=O(t.payload)),t!=null&&t.notification&&(t.notification=O(t.notification));return i}return $(async()=>{I.value&&await S(m.value,y.value)}),(i,l)=>{const p=le,t=ae,M=oe,P=ce,k=pe,z=de,G=me,q=_e,H=ue;return o(B)?(s(),A(p,{key:0})):(s(),a("div",ye,[b(t,{class:"!mb-[20px]","body-style":{padding:"10px"}},{default:_(()=>[o(d).automationLogLevel===("AutomationLogLevel"in i?i.AutomationLogLevel:o(x)).OFF?(s(),a("span",fe," The NC_AUTOMATION_LOG_LEVEL is set to “OFF”, no logs will be displayed. ")):c("",!0),o(d).automationLogLevel===("AutomationLogLevel"in i?i.AutomationLogLevel:o(x)).ERROR?(s(),a("span",ve," The NC_AUTOMATION_LOG_LEVEL is set to “ERROR”, only error logs will be displayed. ")):c("",!0),o(d).automationLogLevel===("AutomationLogLevel"in i?i.AutomationLogLevel:o(x)).ALL?(s(),a("span",he,[o(d).ee?(s(),a("span",ge," The NC_AUTOMATION_LOG_LEVEL is set to “ALL”, both error and success logs will be displayed. ")):(s(),a("span",we," Upgrade to Enterprise Edition to show all the logs. "))])):c("",!0),xe]),_:1}),o(I)?(s(),a("div",be,[o(E).length?(s(),A(H,{key:1},{default:_(()=>[b(z,null,{default:_(()=>[b(k,{activeKey:o(C),"onUpdate:activeKey":l[0]||(l[0]=e=>T(C)?C.value=e:null),class:"nc-hook-log-collapse"},{default:_(()=>[(s(!0),a(j,null,X(o(E),(e,D)=>(s(),A(P,{key:D},{header:_(()=>{var f,v,h,g;return[n("div",Re,[n("div",Ae,[n("div",Oe,r(e.type)+": records."+r(e.event)+"."+r(e.operation)+" ("+r(o(Y)(e.created_at))+") ",1),e.type==="Email"?(s(),a("div",Ee,[e.error_message?(s(),a("div",Ce,"ERROR")):(s(),a("div",Te,"OK"))])):(s(),a("div",{key:1,class:ee(["mx-1 px-2 py-1 text-white rounded bg-red-500 text-xs",{"!bg-green-500":((f=e.response)==null?void 0:f.status)===200}])},r((v=e.response)==null?void 0:v.status)+" "+r(((h=e.response)==null?void 0:h.statusText)||(((g=e.response)==null?void 0:g.status)===200?"OK":"ERROR")),3))]),e.type==="URL"?(s(),a("div",Ne,[n("span",Fe,r(e.payload.method),1),N(" "+r(e.payload.path),1)])):c("",!0)])]}),default:_(()=>{var f,v,h,g,U;return[e.error_message?(s(),a("div",Ie,r(e.error_message),1)):c("",!0),e.type!=="Email"?(s(),a("div",Se,[(v=(f=e==null?void 0:e.response)==null?void 0:f.config)!=null&&v.headers?(s(),a("div",Ue,[Ve,n("pre",Ke,r(e.response.config.headers),1)])):c("",!0),(h=e==null?void 0:e.response)!=null&&h.headers?(s(),a("div",Be,[Le,n("pre",Me,r(e.response.headers),1)])):c("",!0),(U=(g=e==null?void 0:e.response)==null?void 0:g.config)!=null&&U.data?(s(),a("div",Pe,[ke,n("pre",ze,r(e.response.config.data),1)])):c("",!0)])):(s(),a("div",Ge,[e!=null&&e.payload?(s(),a("div",qe,[He,n("pre",De,r(e.payload),1)])):c("",!0)]))]}),_:2},1024))),128))]),_:1},8,["activeKey"])]),_:1}),b(q,{class:"!bg-white text-center"},{default:_(()=>[b(G,{current:o(m),"onUpdate:current":l[1]||(l[1]=e=>T(m)?m.value=e:null),"page-size":o(y),"onUpdate:pageSize":l[2]||(l[2]=e=>T(y)?y.value=e:null),total:+o(F),"show-less-items":"",onChange:S},null,8,["current","page-size","total"])]),_:1})]),_:1})):(s(),A(M,{key:0}))])):c("",!0)]))}}}),ct=re(Je,[["__scopeId","data-v-aef46dc2"]]);export{ct as default};
