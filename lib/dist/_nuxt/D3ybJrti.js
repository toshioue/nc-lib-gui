const __vite__fileDeps=["./JMRXsTyk.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./DnSVh-oD.js","./D_MsYLkT.js","./BCJFTkwv.js","./BQQOEPN4.js","./CB1aB6F1.js","./B5RRVMt5.js","./vll-Pnjv.js","./Select.C8Fy0-eI.css","./uhBJvRY2.js","./C3jLTHF4.js","./Bd2huW26.js","./BYINaHrJ.js","./dfem9Uc_.js","./D9tFZoTQ.js","./DZw_XsHm.js","./DGj1ycqW.js","./BQuyMdA-.js","./DKN1hQ6S.js","./DyDFI6NE.js","./CXD-Dj4T.js","./UsersModal.BCbkEr3A.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{o as n,c as p,a as o,e as Me,ap as Te,ag as Re,L as Ie,aq as Le,r as g,f as ee,ar as je,g as qe,b as i,w as r,t as l,N as s,O as q,Q as u,T as M,U as T,d as w,R as v,ao as V,gc as B,S as Be,X as Ne,a4 as Oe,da as Se,ah as m,ai as R,Y as De,Z as Ve,$ as Ee,hs as ze,y as Pe,_ as Ae}from"./DZZ6t_j4.js";import{_ as Ge}from"./By7kEk8u.js";import{_ as We}from"./DnSVh-oD.js";import{_ as Ye}from"./sz1d3zjm.js";import{_ as Fe}from"./TJfB7GlU.js";import{_ as He}from"./BLgccLvp.js";import{_ as Qe}from"./vK-WmZ7a.js";import{_ as Ze}from"./CY3l82lI.js";import{_ as Ke}from"./BqKQ8afS.js";import{u as Xe}from"./uhBJvRY2.js";import{u as Je}from"./YRNmwX8m.js";import"./DKN1hQ6S.js";import{I as et}from"./BQuyMdA-.js";import{S as tt}from"./D_MsYLkT.js";import{_ as st}from"./DLDZbX8i.js";import"./0azk-b-q.js";import"./DgixBgIx.js";import"./CXD-Dj4T.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./DyDFI6NE.js";import"./BCJFTkwv.js";import"./CB1aB6F1.js";import"./oyD85nwD.js";import"./B8iX-Tu_.js";const ot={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},at=o("path",{fill:"currentColor",d:"M7 21q-.825 0-1.412-.587T5 19V6q-.425 0-.712-.288T4 5t.288-.712T5 4h4q0-.425.288-.712T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zm-7 11q.425 0 .713-.288T11 16V9q0-.425-.288-.712T10 8t-.712.288T9 9v7q0 .425.288.713T10 17m4 0q.425 0 .713-.288T15 16V9q0-.425-.288-.712T14 8t-.712.288T13 9v7q0 .425.288.713T14 17M7 6v13z"},null,-1),nt=[at];function rt(x,h){return n(),p("svg",ot,[...nt])}const it={name:"material-symbols-delete-outline-rounded",render:rt},lt={class:"nc-icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em"},ct=o("path",{fill:"currentColor",d:"M232.49 215.51L185 168a92.12 92.12 0 1 0-17 17l47.53 47.54a12 12 0 0 0 17-17ZM44 112a68 68 0 1 1 68 68a68.07 68.07 0 0 1-68-68"},null,-1),dt=[ct];function ut(x,h){return n(),p("svg",lt,[...dt])}const pt={name:"ph-magnifying-glass-bold",render:ut},mt=""+new URL("invite-team.Bc8QnPYB.png",import.meta.url).href,_t=Ne(()=>Oe(()=>import("./JMRXsTyk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]),import.meta.url).then(x=>x.default||x)),vt={class:"flex flex-col","data-testid":"nc-super-user-list"},ft={"data-rec":"true"},yt={class:"nc-content-max-w p-6 h-[calc(100vh_-_100px)] flex flex-col gap-6 overflow-auto nc-scrollbar-thin"},gt={class:"h-full"},ht={class:"max-w-195 mx-auto h-full"},wt={class:"flex gap-4 items-center justify-between"},xt={class:"flex gap-3 items-center justify-center"},$t={class:"flex items-center gap-1","data-rec":"true"},bt={key:0,class:"w-full"},kt={key:0,class:"font-weight-bold","data-rec":"true"},Ut={class:"w-full"},Ct={class:"flex items-center gap-1 justify-between"},Mt={"data-rec":"true"},Tt={class:"text-gray-500 text-xs whitespace-normal","data-rec":"true"},Rt={class:"w-full"},It={class:"flex items-center gap-1 justify-between"},Lt={"data-rec":"true"},jt={class:"text-gray-500 text-xs whitespace-normal","data-rec":"true"},qt={key:2,class:"font-weight-bold","data-rec":"true"},Bt={"data-rec":"true"},Nt={"data-rec":"true"},Ot={key:0,class:"w-full pt-12 pb-4 px-2 flex flex-col items-center gap-6 text-center"},St={class:"text-2xl text-gray-800 font-bold"},Dt={class:"text-sm text-gray-700"},Vt={key:0,class:"px-4 py-2 flex items-center justify-center"},Et={class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700 mb-4"},zt={class:"text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Pt=Me({__name:"UserList",setup(x){const{api:h,isLoading:E}=Te();E.value=!0;const{$e:$}=Pe(),{t:f}=Re(),{dashboardUrl:te}=Xe(),{user:z}=Ie(),{copy:P}=Le(),{sorts:se,sortDirection:oe,loadSorts:ae,handleGetSortedData:ne,saveOrUpdate:A}=Je("Org"),I=g([]),G=ee(()=>ne(I.value,se.value)),_=g(1),N=g(10),O=g(!1),W=g(0),b=g(!1),k=g(""),U=je({total:0,pageSize:10,position:["bottomCenter"]}),y=Se(async(e=_.value,t=N.value)=>{_.value=e;try{const d=await h.orgUsers.list({query:{limit:t,offset:k.value.length===0?(e-1)*t:0,query:k.value}});if(!d)return;U.total=d.pageInfo.totalRows??0,U.pageSize=10,I.value=d.list}catch(d){m.error(await R(d))}},500);qe(()=>{y(),ae()});const re=async(e,t)=>{try{await h.orgUsers.update(e,{roles:t}),m.success(f("msg.success.roleUpdated")),I.value.forEach(d=>{d.id===e&&(d.roles=t)}),$("a:org-user:role-updated",{role:t})}catch(d){m.error(await R(d))}},L=g(null),ie=async()=>{var e;try{await h.orgUsers.delete((e=L.value)==null?void 0:e.id),m.success(f("msg.success.userDeleted")),await y(),!I.value.length&&_.value!==1&&(_.value--,y(_.value)),$("a:org-user:user-deleted")}catch(t){m.error(await R(t))}finally{b.value=!1,L.value=null}},le=async e=>{try{await h.orgUsers.resendInvite(e.id),m.success(f("msg.success.inviteEmailSent")),await y()}catch(t){m.error(await R(t))}$("a:org-user:resend-invite")},ce=async e=>{if(e.invite_token){try{await P(`${te.value}#/signup/${e.invite_token}`),m.success(f("msg.success.inviteURLCopied"))}catch(t){m.error(t.message)}$("c:user:copy-url")}},de=async e=>{try{const{reset_password_url:t}=await h.orgUsers.generatePasswordResetToken(e.id);await P(t),m.success(f("msg.success.passwordResetURLCopied")),$("c:user:copy-url")}catch(t){m.error(await R(t))}},ue=()=>{O.value=!0,W.value++},pe=e=>{L.value=e,b.value=!0},S=ee({get:()=>oe.value,set:e=>{if(Object.keys(e).length===0){A({});return}const[t,d]=Object.entries(e)[0];A({field:t,direction:d})}}),me=[{key:"email",title:f("objects.users"),minWidth:220,dataIndex:"email",showOrderBy:!0},{key:"role",title:f("general.access"),basis:"30%",minWidth:272,dataIndex:"roles",showOrderBy:!0},{key:"action",title:f("labels.actions"),width:110,minWidth:110,justify:"justify-end"}];return(e,t)=>{const d=De,_e=Ge,ve=pt,fe=et,Y=Ve,F=Ee,H=tt,ye=We,ge=ze,j=Ye,he=Fe,we=it,xe=He,$e=Qe,be=st,ke=Ze,Ue=Ke,Ce=_t;return n(),p("div",vt,[i(_e,null,{icon:r(()=>[i(d,{icon:"users",class:"flex-none text-gray-700 h-5 w-5"})]),title:r(()=>[o("span",ft,l(e.$t("title.userManagement")),1)]),_:1}),o("div",yt,[o("div",gt,[o("div",ht,[o("div",wt,[i(fe,{value:s(k),"onUpdate:value":t[0]||(t[0]=c=>q(k)?k.value=c:null),class:"!max-w-90 !rounded-md",placeholder:e.$t("title.searchMembers"),onChange:t[1]||(t[1]=c=>s(y)())},{prefix:r(()=>[i(ve,{class:"!h-3.5 text-gray-500"})]),_:1},8,["value","placeholder"]),o("div",xt,[(n(),u(M(("iconMap"in e?e.iconMap:s(T)).reload),{class:"cursor-pointer",onClick:t[2]||(t[2]=c=>s(y)(s(_),s(N)))})),i(Y,{"data-testid":"nc-super-user-invite",size:"small",type:"primary",onClick:ue},{default:r(()=>[o("div",$t,[(n(),u(M(("iconMap"in e?e.iconMap:s(T)).plus))),w(" "+l(e.$t("activity.inviteUser")),1)])]),_:1})])]),i(ke,{"order-by":s(S),"onUpdate:orderBy":t[5]||(t[5]=c=>q(S)?S.value=c:null),columns:me,data:s(G),"is-data-loading":s(E),class:"h-[calc(100%-58px)] max-w-250 mt-6"},{bodyCell:r(({column:c,record:a})=>{var Q,Z,K;return[c.key==="email"?(n(),p("div",bt,[a.display_name?(n(),u(F,{key:0,class:"truncate max-w-full"},{title:r(()=>[w(l(a.email),1)]),default:r(()=>[w(" "+l(a.display_name),1)]),_:2},1024)):(n(),u(F,{key:1,class:"truncate max-w-full","show-on-truncate-only":""},{title:r(()=>[w(l(a.email),1)]),default:r(()=>[w(" "+l(a.email),1)]),_:2},1024))])):v("",!0),c.key==="role"?(n(),p(V,{key:1},[(Q=a==null?void 0:a.roles)!=null&&Q.includes("super")?(n(),p("div",kt,l(e.$t("labels.superAdmin")),1)):a.id!==((Z=s(z))==null?void 0:Z.id)?(n(),u(ye,{key:1,value:a.roles,"onUpdate:value":C=>a.roles=C,class:"w-55 nc-user-roles","dropdown-match-select-width":!1,"dropdown-class-name":"max-w-64",onChange:C=>re(a.id,a.roles)},{default:r(()=>[i(H,{class:"nc-users-list-role-option",value:s(B).CREATOR,label:e.$t("objects.roleType.orgLevelCreator")},{default:r(()=>[o("div",Ut,[o("div",Ct,[o("div",Mt,l(e.$t("objects.roleType.orgLevelCreator")),1),(a==null?void 0:a.roles)===s(B).CREATOR?(n(),u(d,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none w-4 h-4 text-primary"})):v("",!0)]),o("div",Tt,l(e.$t("msg.info.roles.orgCreator")),1)])]),_:2},1032,["value","label"]),i(H,{class:"nc-users-list-role-option",value:s(B).VIEWER,label:e.$t("objects.roleType.orgLevelViewer")},{default:r(()=>[o("div",Rt,[o("div",It,[o("div",Lt,l(e.$t("objects.roleType.orgLevelViewer")),1),a.roles===s(B).VIEWER?(n(),u(d,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none w-4 h-4 text-primary"})):v("",!0)]),o("div",jt,l(e.$t("msg.info.roles.orgViewer")),1)])]),_:2},1032,["value","label"])]),_:2},1032,["value","onUpdate:value","onChange"])):(n(),p("div",qt,l(e.$t("objects.roleType.orgLevelCreator")),1))],64)):v("",!0),c.key==="action"?(n(),p("div",{key:2,class:Be(["flex items-center gap-2",{"opacity-0 pointer-events-none":(K=a.roles)==null?void 0:K.includes("super")}])},[i($e,{trigger:["click"]},{overlay:r(()=>[i(xe,null,{default:r(()=>{var C,X,J;return[(C=a.roles)!=null&&C.includes("super")?v("",!0):(n(),p(V,{key:0},[i(j,{onClick:D=>le(a)},{default:r(()=>[(n(),u(M(("iconMap"in e?e.iconMap:s(T)).email),{class:"flex text-gray-600"})),o("div",Bt,l(e.$t("activity.resendInvite")),1)]),_:2},1032,["onClick"]),i(j,{onClick:D=>ce(a)},{default:r(()=>[(n(),u(M(("iconMap"in e?e.iconMap:s(T)).copy),{class:"flex text-gray-600"})),o("div",Nt,l(e.$t("activity.copyInviteURL")),1)]),_:2},1032,["onClick"]),i(j,{onClick:D=>de(a)},{default:r(()=>[(n(),u(M(("iconMap"in e?e.iconMap:s(T)).copy),{class:"flex text-gray-600"})),o("div",null,l(e.$t("activity.copyPasswordResetURL")),1)]),_:2},1032,["onClick"])],64)),a.id!==((X=s(z))==null?void 0:X.id)?(n(),p(V,{key:1},[(J=a.roles)!=null&&J.includes("super")?v("",!0):(n(),u(he,{key:0})),i(j,{"data-rec":"true",class:"!text-red-500 !hover:bg-red-50",onClick:D=>pe(a)},{default:r(()=>[i(we),w(" "+l(e.$t("general.remove"))+" "+l(e.$t("objects.user")),1)]),_:2},1032,["onClick"])],64)):v("",!0)]}),_:2},1024)]),default:r(()=>[i(Y,{size:"xsmall",type:"ghost"},{default:r(()=>[i(ge,{class:"text-gray-600 h-5.5 w-5.5 rounded outline-0 p-0.5 nc-workspace-menu transform transition-transform !text-gray-400 cursor-pointer !hover:text-gray-500 hover:bg-gray-100"})]),_:1})]),_:2},1024)],2)):v("",!0)]}),extraRow:r(()=>[s(U).total===1&&s(G).length===1?(n(),p("div",Ot,[o("div",St,l(e.$t("placeholder.inviteYourTeam")),1),o("div",Dt,l(e.$t("placeholder.inviteYourTeamLabel")),1),t[8]||(t[8]=o("img",{src:mt,class:"!w-[30rem] flex-none"},null,-1))])):v("",!0)]),tableFooter:r(()=>[s(U).total>10?(n(),p("div",Vt,[i(be,{current:s(_),"onUpdate:current":t[3]||(t[3]=c=>q(_)?_.value=c:null),total:s(U).total,"show-less-items":"",onChange:t[4]||(t[4]=c=>s(y)(s(_),s(N)))},null,8,["current","total"])])):v("",!0)]),_:1},8,["order-by","data","is-data-loading"]),i(Ue,{visible:s(b),"onUpdate:visible":t[6]||(t[6]=c=>q(b)?b.value=c:null),"entity-name":"User","on-delete":()=>ie()},{"entity-preview":r(()=>{var c;return[o("span",null,[o("div",Et,[i(d,{icon:"account",class:"nc-view-icon"}),o("div",zt,l((c=s(L))==null?void 0:c.email),1)])])]}),_:1},8,["visible","on-delete"]),(n(),u(Ce,{key:s(W),show:s(O),onClosed:t[7]||(t[7]=c=>O.value=!1),onReload:s(y)},null,8,["show","onReload"]))])])])])}}}),fs=Ae(Pt,[["__scopeId","data-v-bc096004"]]);export{fs as default};
