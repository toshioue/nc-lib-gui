import H from"./hZgTYrdl.js";import J from"./37hePIet.js";import{_ as P}from"./BqKQ8afS.js";import{e as j,ab as A,bL as $,g2 as Y,r as k,d7 as R,cW as F,L as Q,cL as W,cO as Z,o as _,Q as x,w as g,N as o,c as q,f$ as X,a as c,t as r,R as G,O as K,fE as ee,g3 as te,ah as O,ai as U,y as z,ap as ae,ax as se,cP as oe,gT as le,f as ne,ac as ie,b as L,d as B,S as ce,aJ as re,c_ as N,Z as ue,hD as de}from"./DZZ6t_j4.js";import{_ as pe}from"./DgixBgIx.js";import{a as me}from"./B05h-4V9.js";import{C as fe}from"./DNgdBwTe.js";import{_ as ve}from"./0azk-b-q.js";const _e={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700 mb-4"},be={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.5",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ve=j({__name:"DeleteColumnModal",props:{visible:{type:Boolean},onDeleteColumn:{type:Function}},emits:["update:visible"],setup(D,{emit:h}){const u=D,d=A(u,"visible",h),{$api:S,$e:l}=z(),e=$(Y),p=$(R,k()),{getMeta:m}=F(),{includeM2M:T}=Q(),{loadTables:M}=W(),V=Z(),f=k(!1),E=async()=>{var s,n,i,a,t,v,C,y;if(e!=null&&e.value){f.value=!0;try{await S.dbTableColumn.delete((s=e==null?void 0:e.value)==null?void 0:s.id),await m((n=p==null?void 0:p.value)==null?void 0:n.id,!0),ee(e==null?void 0:e.value)&&((i=e.value)!=null&&i.colOptions)&&(await m(((a=e.value)==null?void 0:a.colOptions).fk_related_model_id,!0),T.value&&((t=e.value)==null?void 0:t.colOptions).type===te.MANY_TO_MANY&&M()),V.updateViewCoverImageColumnId({metaId:(v=p.value)==null?void 0:v.id,columnIds:new Set([(C=e==null?void 0:e.value)==null?void 0:C.id])}),l("a:column:delete"),d.value=!1,(y=u.onDeleteColumn)==null||y.call(u)}catch(I){O.error(await U(I))}finally{f.value=!1}}};return(s,n)=>{const i=H,a=J,t=P;return _(),x(t,{visible:o(d),"onUpdate:visible":n[0]||(n[0]=v=>K(d)?d.value=v:null),"entity-name":s.$t("objects.column"),"on-delete":E},{"entity-preview":g(()=>[o(e)?(_(),q("div",_e,[o(X)(o(e))?(_(),x(i,{key:0,class:"nc-view-icon"})):(_(),x(a,{key:1,class:"nc-view-icon"})),c("div",be,r(o(e).title),1)])):G("",!0)]),_:1},8,["visible","entity-name"])}}}),ye={class:"prose-xl font-bold self-center"},we={class:"prose-md self-center text-gray-500 mt-4"},ge={class:"text-xs p-2"},ke={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},Ee=j({__name:"ColumnDuplicate",props:{modelValue:{type:Boolean},column:{},extra:{}},emits:["update:modelValue"],setup(D,{expose:h,emit:u}){const b=D,d=u,{api:S}=ae(),l=A(b,"modelValue",d),{$e:e,$poller:p}=z();se(oe());const m=$(le),{eventBus:T}=me(),{getMeta:M}=F(),V=$(R,k()),f=k({includeData:!0}),E=ne(()=>{const{includeData:a}=f.value;return{excludeData:!a}}),s=k(!1),n=async()=>{await M(V.value.id,!0),T.emit(de.FIELD_RELOAD),m==null||m.trigger()},i=async()=>{try{s.value=!0;const a=await S.dbTable.duplicateColumn(b.column.base_id,b.column.id,{options:E.value,extra:b.extra});p.subscribe({id:a.id},async t=>{t.status!=="close"&&(t.status===N.COMPLETED?(n(),s.value=!1,l.value=!1):t.status===N.FAILED&&(O.error("There was an error duplicating the column."),n(),s.value=!1,l.value=!1))}),e("a:column:duplicate")}catch(a){O.error(await U(a)),s.value=!1,l.value=!1}};return ie("Enter",()=>{l.value&&i()}),h({duplicate:i}),(a,t)=>{const v=ve,C=fe,y=ue,I=pe;return _(),x(I,{visible:o(l),"onUpdate:visible":t[2]||(t[2]=w=>K(l)?l.value=w:null),class:ce([{active:o(l)},"!w-[30rem]"]),closable:!o(s),"mask-closable":!o(s),keyboard:!o(s),centered:"","wrap-class-name":"nc-modal-column-duplicate",footer:null,onKeydown:t[3]||(t[3]=re(w=>l.value=!1,["esc"]))},{default:g(()=>[c("div",null,[c("div",ye,r(a.$t("general.duplicate"))+" "+r(a.$t("objects.column")),1),t[4]||(t[4]=c("div",{class:"mt-4"},"Are you sure you want to duplicate the field?",-1)),c("div",we,r(a.$t("title.advancedSettings")),1),L(v,{class:"!m-0 !p-0 !my-2"}),c("div",ge,[L(C,{checked:o(f).includeData,"onUpdate:checked":t[0]||(t[0]=w=>o(f).includeData=w),disabled:o(s)},{default:g(()=>[B(r(a.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"])])]),c("div",ke,[o(s)?G("",!0):(_(),x(y,{key:"back",type:"secondary",onClick:t[1]||(t[1]=w=>l.value=!1)},{default:g(()=>[B(r(a.$t("general.cancel")),1)]),_:1})),L(y,{key:"submit",type:"primary",loading:o(s),onClick:i},{default:g(()=>[B(r(a.$t("general.confirm")),1)]),_:1},8,["loading"])])]),_:1},8,["visible","class","closable","mask-closable","keyboard"])}}});export{Ve as _,Ee as a};
