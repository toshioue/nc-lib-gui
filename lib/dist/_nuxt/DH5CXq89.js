import{f as Z,bN as ee,d9 as oe,bc as te,aA as ae,az as se,g as D,r as j,d1 as b,o as g,c as A,P as t,b as v,w as d,S as x,T as R,Q as le,d as k,t as f,a as y,co as re,U as ie,V as E,W as U,aa as G,di as O,$ as de,a0 as ne,a1 as ce,_ as pe}from"./3QBYHahY.js";import{_ as ue}from"./DmzaAQYu.js";import{D as fe}from"./Ddy65kPJ.js";import"./kHOslGNR.js";import{I as he}from"./CmN9vPg3.js";import{T as me}from"./CI9Dknfq.js";import"./DPgYHC40.js";import"./BsWDDIqE.js";import"./BQQOEPN4.js";import"./xnDaHwV-.js";import"./ceYq-xax.js";const ge={class:"w-full h-full nc-col-select-option nc-form-scrollbar"},ve={key:0},ye={key:1,class:"flex items-stretch gap-2 pr-2 pl-3 py-1.5 rounded-t-lg border-1 border-b-0 border-gray-200"},we=["data-testid"],be=["onClick"],_e={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},xe={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},ke={class:"px-0.5 py-2 text-gray-500 text-center"},Se={class:"px-0.5 py-2 text-gray-500 text-center"},$e=Z({__name:"LimitOptions",props:{modelValue:{},formFieldState:{},column:{},isRequired:{type:Boolean}},emits:["update:modelValue","update:formFieldState"],setup(Q,{emit:P}){const w=Q,M=P,z=ee(oe),{column:h,formFieldState:W}=te(w),J=ae(),{basesUser:K}=se(J),X=D(()=>z.value.base_id?K.value.get(z.value.base_id)||[]:[]),c=j(""),B=j(!1),l=D({get:()=>{var p,r;let s=1;const a=(w.modelValue||[]).reduce((i,o)=>(s<((o==null?void 0:o.order)??0)&&(s=o.order),{...i,[o.id]:o}),{})??{};if(b.User===h.value.uidt){const i=(X.value||[]).filter(o=>!(o!=null&&o.deleted)).map(o=>{var n,u;return{id:o.id,email:o.email,display_name:o.display_name,order:o.id&&a[o.id]?((n=a[o.id])==null?void 0:n.order)??o.order:s++,show:o.id&&a[o.id]?(u=a[o.id])==null?void 0:u.show:!(w.modelValue||[]).length}}).sort((o,n)=>o.order-n.order);return(w.modelValue||[]).length!==i.length&&M("update:modelValue",i.map(o=>({id:o.id,order:o.order,show:o.show}))),i}else if([b.SingleSelect,b.MultiSelect].includes(h.value.uidt)){const i=(((p=h.value.colOptions)==null?void 0:p.options)||[]).map(o=>{var n,u;return{...o,order:o.id&&a[o.id]?((n=a[o.id])==null?void 0:n.order)??o.order:s++,show:o.id&&a[o.id]?(u=a[o.id])==null?void 0:u.show:!(w.modelValue||[]).length}}).sort((o,n)=>o.order!==void 0&&n.order!==void 0?o.order-n.order:0);return(w.modelValue||[]).length!==(((r=h.value.colOptions)==null?void 0:r.options)||[]).length&&M("update:modelValue",i.map(o=>({id:o.id,order:o.order,show:o.show}))),i}return[]},set:s=>{const a=(W.value||"").split(","),p=[];M("update:modelValue",s.map(r=>(r.show||(h.value.uidt===b.User&&a.includes(r.id)?p.push(r.id):r!=null&&r.title&&a.includes(r.title)&&p.push(r.title)),{id:r.id,order:r.order,show:r.show}))),M("update:formFieldState",a.filter(r=>!p.includes(r)).join(","))}});async function Y(s){var n,u;const{moved:{newIndex:a=0,oldIndex:p=0,element:r}}=s;let i;!l.value.length||l.value.length===1?i=1:l.value.length-1===a?i=Math.max(...l.value.map(m=>(m==null?void 0:m.order)??0))+1:a===0?i=Math.min(...l.value.map(m=>(m==null?void 0:m.order)??0))/2:i=(parseFloat(String(((n=l.value[a-1])==null?void 0:n.order)??0))+parseFloat(String(((u=l.value[a+1])==null?void 0:u.order)??0)))/2;const o=isNaN(Number(i))?p:i;r.order=o,l.value=[...l.value]}const F=s=>{w.isRequired&&!s||(l.value=l.value.map(a=>({...a,show:s})))};return(s,a)=>{var m,I;const p=de,r=he,i=ne,o=ce,n=ue,u=me;return g(),A("div",ge,[t(l).length>12?(g(),A("div",ve,[v(r,{value:t(c),"onUpdate:value":a[1]||(a[1]=e=>le(c)?c.value=e:null),class:"!h-9 !px-3 !py-1 !rounded-lg mb-2",placeholder:`${s.$t("placeholder.searchOptions")}...`,name:"nc-form-field-limit-option-search-input","data-testid":"nc-form-field-limit-option-search-input"},{prefix:d(()=>[v(p,{icon:"search",class:"mr-2 h-4 w-4 text-gray-500 group-hover:text-black"})]),suffix:d(()=>[t(c).length>0?(g(),x(p,{key:0,icon:"close",class:"ml-2 h-4 w-4 text-gray-500 group-hover:text-black","data-testid":"nc-form-field-clear-search",onClick:a[0]||(a[0]=e=>c.value="")})):R("",!0)]),_:1},8,["value","placeholder"])])):R("",!0),t(l).length?(g(),A("div",ye,[v(o,{disabled:!s.isRequired},{title:d(()=>[k(f(s.$t("msg.info.preventHideAllOptions")),1)]),default:d(()=>[v(i,{type:"secondary",size:"xxsmall",class:"!border-none !px-2 !text-xs !text-gray-500 !disabled:text-gray-300",disabled:s.isRequired||t(l).filter(e=>!e.show).length===t(l).length,onClick:a[2]||(a[2]=e=>F(!1))},{default:d(()=>[k(f(s.$t("general.hideAll")),1)]),_:1},8,["disabled"])]),_:1},8,["disabled"]),y("div",null,[v(i,{type:"secondary",size:"xxsmall",class:"!border-none !px-2 !text-xs !text-gray-500 !disabled:text-gray-300",disabled:t(l).filter(e=>e.show).length===t(l).length,onClick:a[3]||(a[3]=e=>F(!0))},{default:d(()=>[k(f(s.$t("general.showAll")),1)]),_:1},8,["disabled"])])])):R("",!0),t(l).length?(g(),x(t(fe),{key:2,"model-value":t(l),"item-key":"id",handle:".nc-child-draggable-icon","ghost-class":"nc-form-field-limit-option-ghost",class:"rounded-b-lg border-1 border-gray-200 !max-h-[224px] overflow-y-auto nc-form-scrollbar",onChange:a[4]||(a[4]=e=>Y(e)),onStart:a[5]||(a[5]=e=>B.value=!0),onEnd:a[6]||(a[6]=e=>B.value=!1)},re({item:d(({element:e})=>{var S,$,C,L,N,T,q;return[(t(h).uidt===t(b).User?($=((S=e==null?void 0:e.display_name)==null?void 0:S.trim())||(e==null?void 0:e.email))!=null&&$.toLowerCase().includes(t(c).toLowerCase()):(C=e.title)!=null&&C.toLowerCase().includes(t(c).toLowerCase()))?(g(),A("div",{key:e.id,class:ie(["w-full h-10 px-2 py-1.5 flex flex-row items-center gap-3 border-b-1 last:border-none border-gray-200",[`nc-form-field-${(L=t(h).title)==null?void 0:L.replaceAll(" ","")}-limit-option-${(N=e.title)==null?void 0:N.replaceAll(" ","")}`,`${e.show?"hover:bg-gray-50":"bg-gray-100"}`]]),"data-testid":`nc-form-field-${(T=t(h).title)==null?void 0:T.replaceAll(" ","")}-limit-option-${(q=e.title)==null?void 0:q.replaceAll(" ","")}`},[(g(),x(E(("iconMap"in s?s.iconMap:t(U)).drag),{class:"nc-child-draggable-icon flex-none cursor-move !h-4 !w-4 text-gray-600"})),v(o,{disabled:!s.isRequired||!(e.show&&s.isRequired&&t(l).filter(_=>_.show).length===1)},{title:d(()=>[k(f(s.$t("msg.info.preventHideAllOptions")),1)]),default:d(()=>[y("div",{class:"!border-none !px-2",onClick:()=>{e.show&&s.isRequired&&t(l).filter(_=>_.show).length===1||(e.show=!e.show,l.value=[...t(l)])}},[(g(),x(E(e.show?("iconMap"in s?s.iconMap:t(U)).eye:("iconMap"in s?s.iconMap:t(U)).eyeSlash),{class:"flex-none cursor-pointer !h-4 !w-4 text-gray-600"}))],8,be)]),_:2},1032,["disabled"]),t(h).uidt===t(b).User?(g(),x(u,{key:0,class:"rounded-tag max-w-[calc(100%_-_70px)] !pl-0",color:"'#ccc'"},{default:d(()=>{var _,H;return[y("span",{style:G({color:t(O).isReadable("#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(O).mostReadable("#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:"flex items-stretch gap-2"},[y("div",null,[v(n,{size:"auto",name:(_=e.display_name)!=null&&_.trim()?(H=e.display_name)==null?void 0:H.trim():"",email:e.email,class:"!text-[0.65rem]"},null,8,["name","email"])]),v(o,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>{var V;return[k(f(((V=e.display_name)==null?void 0:V.trim())||(e==null?void 0:e.email)),1)]}),default:d(()=>{var V;return[y("span",_e,f(((V=e.display_name)==null?void 0:V.trim())||(e==null?void 0:e.email)),1)]}),_:2},1024)],4)]}),_:2},1024)):(g(),x(u,{key:1,class:"rounded-tag max-w-[calc(100%_-_70px)]",color:e.color},{default:d(()=>[y("span",{style:G({color:t(O).isReadable(e.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(O).mostReadable(e.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"})},[v(o,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[k(f(e.title),1)]),default:d(()=>[y("span",xe,f(e.title),1)]),_:2},1024)],4)]),_:2},1032,["color"]))],10,we)):R("",!0)]}),_:2},[t(l).length?t(l).length&&t(c)&&!((I=(m=t(l))==null?void 0:m.filter(e=>{var S,$,C;return t(h).uidt===t(b).User?($=((S=e==null?void 0:e.display_name)==null?void 0:S.trim())||(e==null?void 0:e.email))==null?void 0:$.toLowerCase().includes(t(c).toLowerCase()):(C=e.title)==null?void 0:C.toLowerCase().includes(t(c).toLowerCase())}))!=null&&I.length)?{name:"footer",fn:d(()=>[y("div",Se,f(s.$t("title.noOptionsFound"))+" with title `"+f(t(c))+"`",1)]),key:"1"}:void 0:{name:"footer",fn:d(()=>[y("div",ke,f(s.$t("title.noOptionsFound")),1)]),key:"0"}]),1032,["model-value"])):R("",!0)])}}}),Le=pe($e,[["__scopeId","data-v-831129b0"]]);export{Le as default};
