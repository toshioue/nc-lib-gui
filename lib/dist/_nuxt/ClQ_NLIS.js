import{f as R,r as k,ai as D,i as ee,P as s,o as l,c as n,b as f,a as i,U as se,T as C,t as S,w as v,aq as h,av as g,d as O,S as p,V as T,W as J,a9 as te,dr as le,hU as ae,aV as oe,a0 as re,A as ne,aj as b,ak as L}from"./3QBYHahY.js";import"./kHOslGNR.js";import{I as ie}from"./CmN9vPg3.js";import{F as pe}from"./DAKhk9t6.js";import{_ as ce}from"./ceYq-xax.js";import{_ as ue}from"./BsWDDIqE.js";import{_ as de}from"./DD1BMgnW.js";import{_ as _e}from"./Bk0xUMNV.js";import"./DPgYHC40.js";import"./BQQOEPN4.js";import"./xnDaHwV-.js";import"./wEQwkVjR.js";import"./CGxepfeV.js";const ye={key:0,class:"flex flex-row w-full justify-center items-center h-52"},fe={key:1,class:"flex flex-col"},ve={class:"w-full relative"},me={class:"flex flex-row justify-center pb-4 mb-2 border-b-1 w-full gap-x-1"},ke=["alt","src"],he={class:"font-semibold text-lg"},ge={class:"absolute -right-2 -top-0.5"},be={key:0,class:"flex flex-row justify-center"},xe={class:"text-center font-normal mb-2"},we={key:0,class:"text-red-600"},Ue={key:4,class:"absolute flex flex-col justify-start mt-2 -right-6 top-0"},Ce=["colspan"],Se={class:"flex flex-row space-x-4 justify-center mt-4"},Je=R({__name:"AppInstall",props:{id:{}},emits:["saved","close"],setup(N,{emit:E}){const $=E,{$api:x}=ne(),q=k(),{t:w}=D(),a=k(null),r=k({}),U=k(!0),y=k(null),z={labelCol:{span:14,pull:4},wrapperCol:{span:20,pull:4}},W=()=>r.value.push({}),G=async()=>{var o,u;y.value="save";try{await((o=q.value)==null?void 0:o.validateFields()),await x.plugin.update(N.id,{input:JSON.stringify(r.value),active:!0}),$("saved"),b.success(((u=a.value)==null?void 0:u.formDetails.msgOnInstall)||w("msg.success.pluginSettingsSaved"))}catch(m){b.error(await L(m))}finally{y.value=null}},H=async()=>{y.value="test";try{a.value&&(await x.plugin.test({input:JSON.stringify(r.value),title:a.value.title,category:a.value.category})?b.success(w("msg.success.pluginTested")):b.info(w("msg.info.invalidCredentials")))}catch(o){b.error(await L(o))}finally{y.value=null}},K=async o=>{switch(o){case"save":await G();break;case"test":await H();break}},Q=async()=>{try{U.value=!0;const o=await x.plugin.read(N.id),u=JSON.parse(o.input_schema??"{}"),m=u.array?[{}]:{},_=typeof o.input=="string"?JSON.parse(o.input):m;"secure"in _&&typeof _.secure=="string"&&(_.secure=_.secure==="true"),a.value={...o,formDetails:u,parsedInput:_},r.value=a.value.parsedInput}catch(o){console.log(o)}finally{U.value=!1}},X=o=>r.value.splice(o,1);return ee(async()=>{a.value||await Q()}),(o,u)=>{var A;const m=le,_=ae,M=oe,j=ce,B=ue,F=de,P=ie,V=_e,Y=re,Z=pe;return s(U)?(l(),n("div",ye,[f(m,{size:"large"})])):(l(),n("div",fe,[i("div",ve,[i("div",me,[s(a).logo?(l(),n("div",{key:0,class:se(["mr-1 flex items-center justify-center",[s(a).title==="SES"?"p-2 bg-[#242f3e]":""]])},[i("img",{alt:s(a).title||"plugin",src:s(a).logo,class:"h-6"},null,8,ke)],2)):C("",!0),i("span",he,S(s(a).formDetails.title),1)]),i("div",ge,[f(M,{type:"text",class:"!rounded-md mr-1",onClick:u[0]||(u[0]=e=>$("close"))},{icon:v(()=>[f(_,{class:"flex mx-auto"})]),_:1})])]),f(Z,te({ref_key:"formRef",ref:q},(A=s(a))!=null&&A.formDetails.array?{}:z,{model:s(r),class:"mx-4 mt-3"}),{default:v(()=>[s(a).formDetails.array?(l(),n("div",be,[i("table",null,[i("thead",null,[i("tr",null,[(l(!0),n(h,null,g(s(a).formDetails.items,(e,c)=>(l(),n("th",{key:c},[i("div",xe,[O(S(e.label)+" ",1),e.required?(l(),n("span",we,"*")):C("",!0)])]))),128))])]),i("tbody",null,[(l(!0),n(h,null,g(s(a).parsedInput,(e,c)=>(l(),n("tr",{key:c},[(l(!0),n(h,null,g(s(a).formDetails.items,(t,I)=>(l(),n("td",{key:I,class:"px-2"},[f(V,{class:"relative mb-3",name:[`${c}`,t.key],rules:[{required:t.required,message:`${t.label} is required`}]},{default:v(()=>[t.type==="Password"?(l(),p(j,{key:0,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):t.type==="LongText"?(l(),p(B,{key:1,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):t.type==="Checkbox"?(l(),p(F,{key:2,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])):(l(),p(P,{key:3,value:e[t.key],"onUpdate:value":d=>e[t.key]=d,placeholder:t.placeholder},null,8,["value","onUpdate:value","placeholder"])),c!==0&&I===s(a).formDetails.items.length-1?(l(),n("div",Ue,[(l(),p(T(("iconMap"in o?o.iconMap:s(J)).delete),{class:"hover:text-red-400 cursor-pointer",onClick:d=>X(c)},null,8,["onClick"]))])):C("",!0)]),_:2},1032,["name","rules"])]))),128))]))),128))]),i("tr",null,[i("td",{colspan:s(a).formDetails.items.length,class:"text-center"},[f(M,{type:"default",class:"!bg-gray-100 rounded-md border-none mr-1",onClick:W},{icon:v(()=>[(l(),p(T(("iconMap"in o?o.iconMap:s(J)).plus),{class:"flex mx-auto"}))]),_:1})],8,Ce)])])])):(l(!0),n(h,{key:1},g(s(a).formDetails.items,(e,c)=>(l(),p(V,{key:c,label:e.label,name:e.key,rules:[{required:e.required,message:`${e.label} is required`}]},{default:v(()=>[e.type==="Password"?(l(),p(j,{key:0,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="LongText"?(l(),p(B,{key:1,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="Checkbox"?(l(),p(F,{key:2,checked:s(r)[e.key],"onUpdate:checked":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["checked","onUpdate:checked","placeholder"])):(l(),p(P,{key:3,value:s(r)[e.key],"onUpdate:value":t=>s(r)[e.key]=t,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label","name","rules"]))),128)),i("div",Se,[(l(!0),n(h,null,g(s(a).formDetails.actions,(e,c)=>(l(),p(Y,{key:c,class:"!px-5",loading:s(y)===e.key,type:e.key==="save"?"primary":"default",disabled:!!s(y),onClick:t=>K(e.key)},{default:v(()=>[O(S(e.label),1)]),_:2},1032,["loading","type","disabled","onClick"]))),128))])]),_:1},16,["model"])]))}}});export{Je as default};
