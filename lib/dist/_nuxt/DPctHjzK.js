const __vite__fileDeps=["./CtMydB5S.js","./D4iSzjWt.js","./3QBYHahY.js","./entry.Ic44fwRn.css","./m8rA889u.js","./C9Sjn86N.js","./DPqnb67u.js","./PlainCell.DrVmydsK.css","./CzU2HVen.js","./RecordCard.BkJXt930.css","./B6kJGnpr.js","./T74iQZdg.js","./CSl6euFG.js","./Bj2FvocX.js","./boyBAVNN.js","./BYmqikBK.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as tt,r as E,L as ot,bN as ze,d9 as at,g as ne,gl as nt,hg as lt,cr as n,O as rt,P as t,o as h,c as R,a as V,aq as $,av as G,t as J,U as N,d1 as A,S as j,w as I,b as Q,d as st,V as Oe,W as Le,T as q,R as it,aa as ut,Y as dt,co as ct,Z as pe,a6 as _e,a0 as mt,A as ft,dc as vt,_ as wt}from"./3QBYHahY.js";import{_ as pt}from"./DdUr8XSo.js";import{_ as _t}from"./PcgFfkcK.js";import{_ as ht}from"./Kma333Sh.js";import{a as yt}from"./McwC7LnE.js";import{a as gt}from"./CfxEkdGP.js";import{b as Pe}from"./DgfVJyEd.js";import{j as Mt,e as le}from"./BYmqikBK.js";import"./CSl6euFG.js";import"./BteOdwRG.js";const Dt=pe(()=>_e(()=>import("./CtMydB5S.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(C=>C.default||C)),kt=pe(()=>_e(()=>import("./m8rA889u.js"),__vite__mapDeps([4,2,3,5,1,6,7]),import.meta.url).then(C=>C.default||C)),xt=pe(()=>_e(()=>import("./CzU2HVen.js"),__vite__mapDeps([8,2,3,9]),import.meta.url).then(C=>C.default||C)),bt=pe(()=>_e(()=>import("./B6kJGnpr.js"),__vite__mapDeps([10,11,12,2,3,13,6,14,15]),import.meta.url).then(C=>C.default||C)),Rt={key:0,class:"h-full prevent-select relative","data-testid":"nc-calendar-month-view"},St=["onClick","onDblclick"],Et={key:0,class:"flex justify-between p-1"},Yt={class:"flex items-center gap-1"},Ct={class:"ml-1"},Tt={key:1,class:"leading-3 p-3"},It={class:"text-xs px-1"},zt={class:"absolute inset-0 pointer-events-none mt-8 pb-7.5","data-testid":"nc-calendar-month-record-container"},Ot=["data-testid","data-unique-id","onMouseover","onMousedown"],Lt={class:"text-xs font-medium text-gray-400"},Pt=tt({__name:"MonthView",emits:["newRecord","expandRecord"],setup(C,{emit:Be}){const re=Be,{selectedDate:se,selectedMonth:he,formattedData:W,formattedSideBarData:Re,calDataType:ie,sideBarFilterOption:Ve,displayField:$e,calendarRange:B,viewMetaProperties:Ae,showSideMenu:Fe,updateRowProperty:ye,updateFormat:ee}=yt(),{$e:Se}=ft(),ge=E(!0),{isUIAllowed:z}=ot(),te=ze(at,E()),O=ne(()=>{var e;return(e=Ae.value)!=null&&e.hide_weekend?5:7}),Ne=ne(()=>{let e=[];return ge.value?e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],O.value===5&&(e=e.filter(r=>r!=="Sat"&&r!=="Sun")),e}),ue=E(),{width:qe,height:We}=nt(ue),He=e=>e.month()===he.value.month(),F=E(null),H=E(null),de=E(!1),X=E(!1),M=E(),Me=E(),De=E(),ce=E(null),me=E(),S=E(),Ue=ze(lt,E()),{fields:Ee}=gt(),je=ne(()=>Ee.value?new Map(Ee.value.map(e=>[e.fk_column_id,{underline:e.underline,bold:e.bold,italic:e.italic}])):new Map),ke=e=>je.value.get(e.id),c=ne(()=>{const e=he.value.startOf("month"),r=he.value.endOf("month"),s=e.startOf("week").add(ge.value?0:-1,"day"),i=r.endOf("week").add(ge.value?0:-1,"day").diff(s,"day")+1;let g=Math.ceil(i/7);g=Math.max(g,5);const D=[];let p=s;for(let k=0;k<g;k++){const x=[];for(let u=0;u<7;u++)x.push(p),p=p.add(1,"day");D.push(x)}return D}),fe=ne(()=>{if(!c.value||!B.value)return[];const e=qe.value/O.value,r=We.value/c.value.length,s=24,y=27,i={};if(!B.value)return[];const g=[];return B.value.forEach(D=>{const p=D.fk_from_col,k=D.fk_to_col;[...W.value].filter(u=>{if(p&&k){const a=u.row[p.title]?n(u.row[p.title]):null,d=u.row[k.title]?n(u.row[k.title]):null;return a&&d&&!d.isBefore(a)}else if(p&&!k)return!!(u.row[p.title]?n(u.row[p.title]):null);return!1}).forEach(u=>{if(!k&&p){const a=n(u.row[p.title]),d=a.format("YYYY-MM-DD");i[d]||(i[d]={overflow:!1,count:0,overflowCount:0}),i[d].count++;const o=u.rowMeta.id??Pe(),f=c.value.findIndex(Y=>Y.some(L=>n(L).isSame(a,"day"))),_=(c.value[f]??[]).findIndex(Y=>n(Y).isSame(a,"day")),l={left:`${_*e}px`,width:`${e}px`};O.value===5&&(_===5||_===6)&&(l.display="none");const b=i[d].count,m=f*r+y+(b-1)*(s+4);s*b+y+12>r?(l.display="none",i[d].overflow=!0,i[d].overflowCount++):l.top=`${m}px`,g.push({...u,rowMeta:{...u.rowMeta,style:l,position:"rounded",range:D,id:o}})}else if(p&&k){const a=n(u.row[p.title]),d=n(u.row[k.title]);let o=a.startOf("week");const f=u.rowMeta.id??Pe();for(;o.isSameOrBefore(d,"day")&&o.isBefore(c.value[c.value.length-1][6]);){const _=o.endOf("week"),l=o.isBefore(a)?a:o,b=_.isAfter(d)?d:_;if(b.isBefore(c.value[0][0])){o=o.add(1,"week");continue}let m=l.clone();for(;m.isSameOrBefore(b);){const w=m.format("YYYY-MM-DD");i[w]||(i[w]={overflow:!1,count:0,overflowCount:0}),i[w].count++,m=m.add(1,"day")}const v=Math.max(c.value.findIndex(w=>w.findIndex(Z=>n(Z).isSame(l,"day"))!==-1),0);let Y=0;for(let w=0;w<(c.value[v]??[]).length;w++){const Z=c.value[v][w],ae=n(Z).format("YYYY-MM-DD");i[ae]||(i[ae]={count:0,overflow:!1,overflowCount:0}),Y=Math.max(Y,i[ae].count)}const L=Math.max((c.value[v]??[]).findIndex(w=>n(w).isSame(l,"day")),0),oe=Math.max((c.value[v]??[]).findIndex(w=>n(w).isSame(b,"day")),0),K={left:`${L*e}px`,width:`${(oe-L+1)*e}px`},ve=v*r+y+Math.max(Y-1,0)*(s+4),we=s*Math.max(Y,0)+y+12;let P="rounded";const T=c.value[v-1]?n(c.value[v-1][0]).isBefore(a,"month"):!1;if(a.isSame(o,"week")&&d.isSame(_,"week")?P="rounded":a.isSame(l,"week")?T&&d.isSame(_,"week")?P="rounded":P="leftRounded":d.isSame(_,"week")?P="rightRounded":P="none",we>r){K.display="none";for(let w=L;w<=oe;w++){const Z=c.value[v];if(!Z)continue;const ae=Z[w],be=n(ae).format("YYYY-MM-DD");i[be]&&(i[be].overflow=!0,i[be].overflowCount++)}}else K.top=`${ve}px`;g.push({...u,rowMeta:{...u.rowMeta,position:P,style:K,range:D,id:f}}),o=o.add(1,"week")}}})}),{records:g,count:i}}),xe=(e,r,s)=>{var v,Y,L,oe,K,ve,we,P;const{top:y,height:i,width:g,left:D}=ue.value.getBoundingClientRect(),p=(e.clientY-y-window.scrollY)/i,k=(e.clientX-D-window.scrollX)/g,x=(Y=(v=M.value)==null?void 0:v.rowMeta.range)==null?void 0:Y.fk_from_col,u=(oe=(L=M.value)==null?void 0:L.rowMeta.range)==null?void 0:oe.fk_to_col;if(!x)return{newRow:null,updateProperty:[]};const a=Math.floor(p*c.value.length),d=Math.floor(k*O.value);let o=c.value[a]?n(c.value[a][d]):null;if(!o)return{newRow:null,updateProperty:[]};let f=n(M.value.row[x.title]);f.isValid()||(f=n()),o=o.add(f.hour(),"hour").add(f.minute(),"minute").add(f.second(),"second");let _;const l={...M.value,row:{...(K=M.value)==null?void 0:K.row,[x.title]:n(o).format(ee.value)}},b=[x.title];if(u){const T=(ve=M.value)!=null&&ve.row[x.title]?n(M.value.row[x.title]):null,w=(we=M.value)!=null&&we.row[u.title]?n((P=M.value)==null?void 0:P.row[u.title]):null;T&&w?_=n(o).add(w.diff(T,"day"),"day"):T&&!w?_=n(o).endOf("day"):!T&&w?_=n(o).endOf("day"):_=o.clone(),l.row[u.title]=n(_).format(ee.value),b.push(u.title)}if(M.value.row[x.title]===l.row[x.title]&&!s)return{newRow:null,updatedProperty:[]};if(!l)return{newRow:null,updateProperty:[]};const m=le(l.row,te.value.columns);return r?(W.value=[...W.value,l],Re.value=Re.value.filter(T=>le(T.row,te.value.columns)!==m)):W.value=W.value.map(T=>le(T.row,te.value.columns)===m?l:T),{newRow:l,updateProperty:b}},Ye=e=>{!z("dataEdit")||!M.value||xe(e,!1)},Xe=vt((e,r,s)=>{ye(e,r,s)},500),Ce=e=>{var l,b;if(!z("dataEdit")||!S.value)return;const{top:r,height:s,width:y,left:i}=ue.value.getBoundingClientRect(),g=(e.clientY-r-window.scrollY)/s,D=(e.clientX-i-window.scrollX)/y,p=S.value.row[S.value.rowMeta.range.fk_to_col.title],k=S.value.row[S.value.rowMeta.range.fk_from_col.title],x=(l=S.value.rowMeta.range)==null?void 0:l.fk_from_col,u=(b=S.value.rowMeta.range)==null?void 0:b.fk_to_col,a=Math.floor(g*c.value.length),d=Math.floor(D*O.value);let o=[],f;if(me.value==="right"){let m=c.value[a]?n(c.value[a][d]).endOf("day"):null;if(o=[u.title],n(m).isBefore(k)&&(m=n(k).clone().endOf("day")),!m)return;f={...S.value,row:{...S.value.row,[u.title]:n(m).format(ee.value)}}}else{let m=c.value[a]?n(c.value[a][d]):null;if(o=[x.title],n(m).isAfter(p)&&(m=n(p).clone()),!m)return;f={...S.value,row:{...S.value.row,[x.title]:n(m).format(ee.value)}}}const _=le(f.row,te.value.columns);W.value=W.value.map(m=>le(m.row,te.value.columns)===_?f:m),f&&Xe(f,o,!1)},Te=()=>{de.value=!1,me.value=void 0,S.value=void 0,document.removeEventListener("mousemove",Ce),document.removeEventListener("mouseup",Te)},Ke=(e,r,s)=>{var y;!z("dataEdit")||H.value||(y=s.rowMeta.range)!=null&&y.is_readonly||(de.value=!0,me.value=e,S.value=s,document.addEventListener("mousemove",Ce),document.addEventListener("mouseup",Te))},Ie=e=>{var i;if(clearTimeout(De.value),!z("dataEdit")||!M.value||!X.value||(i=M.value.rowMeta.range)!=null&&i.is_readonly)return;e.preventDefault(),F.value.style.boxShadow="none";const{newRow:r,updateProperty:s}=xe(e,!1,!0);document.querySelectorAll(".draggable-record").forEach(g=>{g.style.visibility="",g.style.opacity="100%"}),F.value&&(F.value.style.boxShadow="none",X.value=!1,H.value=null,F.value=null),M.value=void 0,ye(r,s,!1),ce.value=null,Se("c:calendar:month:drag-record"),document.removeEventListener("mousemove",Ye),document.removeEventListener("mouseup",Ie)},Ze=(e,r)=>{if(de.value||!r.rowMeta.id)return;let s=e.target;X.value=!1,De.value=setTimeout(()=>{var g;if(!z("dataEdit")||(g=r.rowMeta.range)!=null&&g.is_readonly)return;for(X.value=!0;!s.classList.contains("draggable-record");)s=s.parentElement;document.querySelectorAll(".draggable-record").forEach(D=>{D.getAttribute("data-unique-id").includes(r.rowMeta.id)||(D.style.opacity="30%")}),X.value=!0,F.value=s,H.value=r.rowMeta.id,M.value=r,document.addEventListener("mousemove",Ye),document.addEventListener("mouseup",Ie)},200);const y=()=>{clearTimeout(De.value),document.removeEventListener("mouseup",y),X.value||re("expandRecord",r)};document.addEventListener("mouseup",y)},Ge=e=>{var s,y;if(!z("dataEdit"))return;e.preventDefault();const r=(s=e.dataTransfer)==null?void 0:s.getData("text/plain");if(r){const{record:i,isWithoutDates:g}=JSON.parse(r);if((y=i.rowMeta.range)!=null&&y.is_readonly)return;M.value=i;const{newRow:D,updateProperty:p}=xe(e,g);F.value&&(F.value.style.boxShadow="none",F.value=null),ye(D,p,!1),Se("c:calendar:day:drag-record")}},Je=e=>{M.value=void 0,H.value=null,S.value=void 0,de.value=!1,me.value=void 0,ce.value=null,se.value=e},Qe=e=>{Ve.value="selectedDate",se.value=e,Fe.value=!0},U=e=>se.value?n(e).isSame(se.value,"day"):!1,et=e=>{if(!z("dataEdit")||!B.value)return;const r=B.value[0].fk_from_col;if(!r)return;const s={row:{[r.title]:e.format(ee.value)}};re("newRecord",s)};return(e,r)=>{const s=mt,y=pt,i=Dt,g=_t,D=ht,p=kt,k=xt,x=bt,u=rt("e");return t(B)?(h(),R("div",Rt,[V("div",{class:N(["grid",{"grid-cols-7":t(O)===7,"grid-cols-5":t(O)===5}])},[(h(!0),R($,null,G(t(Ne),(a,d)=>(h(),R("div",{key:d,class:"text-center bg-gray-50 py-1 border-r-1 last:border-r-0 border-gray-200 font-semibold leading-4 uppercase text-[10px] text-gray-500"},J(a),1))),128))],2),V("div",{ref_key:"calendarGridContainer",ref:ue,class:N([{"grid-rows-5":t(c).length===5,"grid-rows-6":t(c).length===6,"grid-rows-7":t(c).length===7},"grid"]),style:{height:"calc(100% - 1.59rem)"},onDrop:Ge},[(h(!0),R($,null,G(t(c),(a,d)=>(h(),R("div",{key:d,class:N([{"grid-cols-7":t(O)===7,"grid-cols-5":t(O)===5},"grid grow"]),"data-testid":"nc-calendar-month-week"},[(h(!0),R($,null,G(a,(o,f)=>{var _;return h(),R($,null,[t(O)!==5||o.get("day")!==0&&o.get("day")!==6?(h(),R("div",{key:`${d}-${f}`,class:N([{"border-brand-500 border-1 !border-r-1 border-b-1":U(o)||t(ce)&&t(n)(o).isSame(t(ce),"day"),"!text-gray-400":!He(o),"!bg-gray-50 !hover:bg-gray-100":o.get("day")===0||o.get("day")===6,"border-t-1":d===0},"text-right relative group last:border-r-0 transition text-sm h-full border-r-1 border-b-1 border-gray-200 font-medium hover:bg-gray-50 text-gray-800 bg-white"]),"data-testid":"nc-calendar-month-day",onClick:l=>Je(o),onDblclick:l=>et(o)},[t(z)("dataEdit")?(h(),R("div",Et,[V("span",{class:N({"block group-hover:hidden":!U(o)&&[t(A).DateTime,t(A).Date].includes(t(ie)),hidden:U(o)&&[t(A).DateTime,t(A).Date].includes(t(ie))})},null,2),t(B).length>1?(h(),j(D,{key:0,"auto-close":""},{overlay:I(()=>[Q(g,{class:"w-64"},{default:I(()=>[Q(y,null,{default:I(()=>[st(" Select date field to add ")]),_:1}),(h(!0),R($,null,G(t(B),(l,b)=>(h(),j(y,{key:b,class:"text-gray-800 font-semibold text-sm",onClick:()=>{const m={row:{[l.fk_from_col.title]:t(n)(o).format("YYYY-MM-DD HH:mm:ssZ")}};re("newRecord",m)}},{default:I(()=>[V("div",Yt,[Q(i,{"column-meta":l.fk_from_col},null,8,["column-meta"]),V("span",Ct,J(l.fk_from_col.title),1)])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),default:I(()=>[Q(s,{class:N([{"!block":U(o),"!hidden":!U(o)},"!group-hover:block rounded"]),size:"small",type:"secondary"},{default:I(()=>[(h(),j(Oe(("iconMap"in e?e.iconMap:t(Le)).plus),{class:"h-4 w-4"}))]),_:2},1032,["class"])]),_:2},1024)):[t(A).DateTime,t(A).Date].includes(t(ie))?(h(),j(s,{key:1,class:N([{"!block":U(o),"!hidden":!U(o)},"!group-hover:block !w-6 !h-6 !rounded"]),size:"xsmall",type:"secondary",onClick:()=>{const l={row:{[t(B)[0].fk_from_col.title]:o.format("YYYY-MM-DD HH:mm:ssZ")}};re("newRecord",l)}},{default:I(()=>[(h(),j(Oe(("iconMap"in e?e.iconMap:t(Le)).plus)))]),_:2},1032,["class","onClick"])):q("",!0),V("span",{class:N([{"bg-brand-50 text-brand-500 !font-bold":o.isSame(t(n)(),"date")},"px-1.3 py-1 text-sm leading-3 font-medium rounded-lg"])},J(o.format("DD")),3)])):q("",!0),t(z)("dataEdit")?q("",!0):(h(),R("div",Tt,J(t(n)(o).format("DD")),1)),t(fe).count[t(n)(o).format("YYYY-MM-DD")]&&((_=t(fe).count[t(n)(o).format("YYYY-MM-DD")])!=null&&_.overflow)&&!t(H)?it((h(),j(s,{key:2,class:"!absolute bottom-1 right-1 text-center min-w-4.5 mx-auto z-3 text-gray-500",size:"xxsmall",type:"secondary",onClick:l=>Qe(o)},{default:I(()=>{var l;return[V("span",It," + "+J((l=t(fe).count[t(n)(o).format("YYYY-MM-DD")])==null?void 0:l.overflowCount),1)]}),_:2},1032,["onClick"])),[[u,"['c:calendar:month-view-more']"]]):q("",!0)],42,St)):q("",!0)],64)}),256))],2))),128))],34),V("div",zt,[(h(!0),R($,null,G(t(fe).records,(a,d)=>{var o;return h(),R($,{key:d},[((o=a.rowMeta.style)==null?void 0:o.display)!=="none"?(h(),R("div",{key:0,"data-testid":`nc-calendar-month-record-${a.row[t($e).title]}`,"data-unique-id":a.rowMeta.id,style:ut({...a.rowMeta.style,zIndex:a.rowMeta.id===t(H)?100:0}),class:"absolute group draggable-record transition cursor-pointer pointer-events-auto",onMouseleave:r[0]||(r[0]=f=>Me.value=null),onMouseover:f=>Me.value=a.rowMeta.id,onMousedown:dt(f=>Ze(f,a),["stop"])},[Q(x,{row:a},{default:I(()=>{var f,_,l,b,m;return[Q(k,{hover:t(Me)===a.rowMeta.id||a.rowMeta.id===t(H),position:a.rowMeta.position,record:a,resize:!!((f=a.rowMeta.range)!=null&&f.fk_to_col)&&t(z)("dataEdit"),selected:((l=(_=t(M))==null?void 0:_.rowMeta)==null?void 0:l.id)===a.rowMeta.id||((m=(b=t(S))==null?void 0:b.rowMeta)==null?void 0:m.id)===a.rowMeta.id,onResizeStart:Ke},ct({default:I(()=>[(h(!0),R($,null,G(t(Ue),(v,Y)=>(h(),R($,{key:Y},[("isRowEmpty"in e?e.isRowEmpty:t(Mt))(a,v)?q("",!0):(h(),j(p,{key:0,modelValue:a.row[v.title],"onUpdate:modelValue":L=>a.row[v.title]=L,class:"text-xs",bold:ke(v).bold,column:v,italic:ke(v).italic,underline:ke(v).underline},null,8,["modelValue","onUpdate:modelValue","bold","column","italic","underline"]))],64))),128))]),_:2},[[t(A).DateTime,t(A).LastModifiedTime,t(A).CreatedTime].includes(t(ie))?{name:"time",fn:I(()=>{var v;return[V("span",Lt,J(t(n)(a.row[(v=a.rowMeta.range)==null?void 0:v.fk_from_col.title]).format("h:mma").slice(0,-1)),1)]}),key:"0"}:void 0]),1032,["hover","position","record","resize","selected"])]}),_:2},1032,["row"])],44,Ot)):q("",!0)],64)}),128))])])):q("",!0)}}}),jt=wt(Pt,[["__scopeId","data-v-d3f0cb4b"]]);export{jt as default};
