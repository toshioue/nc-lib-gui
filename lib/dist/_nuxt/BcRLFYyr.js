import Z from"./hZgTYrdl.js";import q from"./37hePIet.js";import{e as J,az as ee,r as c,i4 as ae,bL as m,d7 as te,d6 as se,dz as ne,d8 as oe,f as y,ij as le,cX as ie,F as ce,dc as j,c$ as re,M as de,N as n,o as l,Q as p,w as o,c as I,W as B,a as s,t as i,b as _,O as C,ao as ue,at as me,T as pe,R as f,d as D,P as _e,m as fe,f$ as ge,Y as ve,Z as we,$ as ke}from"./DZZ6t_j4.js";import{_ as ye}from"./CJNscGy3.js";import{_ as be}from"./vK-WmZ7a.js";import{a as he}from"./i4aLU0Nw.js";import{a as xe}from"./C4o9gerC.js";import{u as Ie}from"./BlrQG98t.js";import{S as Ce,_ as Se}from"./D_MsYLkT.js";import"./ByVBARmO.js";import"./C4K5fdHe.js";import"./CDWovrGB.js";import"./vll-Pnjv.js";import"./GMLocJHP.js";import"./B05h-4V9.js";import"./BDAIZopQ.js";import"./boyBAVNN.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";const $e={class:"nc-kanban-btn"},Ve={class:"flex items-center gap-2"},Me={key:0,class:"flex items-center gap-0.5"},Ne={class:"text-capitalize !text-sm flex items-center gap-1 text-gray-700"},je={class:"flex items-center rounded-md transition-colors duration-0.3s bg-gray-100 group-hover:bg-gray-200 px-1 min-h-5 text-gray-600 max-w-[108px]"},Be={class:"font-weight-500 text-sm truncate !leading-5"},De={class:"flex flex-col gap-2"},Fe={class:"nc-fields-list"},Te={class:"grouping-field"},Le=["title"],Ee={class:"flex items-center gap-1 max-w-[calc(100%_-_20px)]"},Oe={class:"flex items-center gap-1"},Ue={class:"text-sm text-gray-800"},ca=J({__name:"StackedBy",setup(ze){ee(ae,c(!0));const F=m(te,c()),u=m(se,c()),T=m(ne,c(!1)),L=m(oe,c(!1)),E=m(le,y(()=>!1)),{fields:O,loadViewColumns:U,metaColumnById:S}=he(),{kanbanMetaData:g,loadKanbanMeta:$,loadKanbanData:z,updateKanbanMeta:V,groupingField:K}=xe(),{addUndo:M,defineViewScope:N}=ie(),r=c(!1);Ie(r),ce(()=>{var e;return(e=u.value)==null?void 0:e.id},async(e,a)=>{e!==a&&F.value&&await U()},{immediate:!0});const b=async e=>{var a;await V({fk_grp_col_id:e}),await $(),await z(),((a=u.value)==null?void 0:a.view).fk_grp_col_id=e},v=y({get:()=>g.value.fk_grp_col_id,set:async e=>{e&&(M({undo:{fn:await b,args:[g.value.fk_grp_col_id]},redo:{fn:await b,args:[e]},scope:N({view:u.value})}),await b(e))}}),h=async e=>{var d,k;const a={...j((d=g.value)==null?void 0:d.meta),hide_empty_stack:e};await V({meta:a}),await $(),((k=u.value)==null?void 0:k.view).meta=a},x=c(null),w=y({get:()=>{var e;return j((e=g.value)==null?void 0:e.meta).hide_empty_stack||!1},set:async e=>{x.value="hideEmptyStack",M({undo:{fn:h,args:[w.value]},redo:{fn:h,args:[e]},scope:N({view:u.value})}),await h(e),x.value=null}}),P=y(()=>{var e;return(e=O.value)==null?void 0:e.filter(a=>a.fk_column_id&&S.value[a.fk_column_id].uidt===re.SingleSelect).map(a=>({value:a.fk_column_id,label:a.title}))}),G=()=>{r.value=!1},R=e=>fe(ge(e)?Z:q,{columnMeta:e});return(e,a)=>{const d=ve,k=we,A=ke,H=Ce,Q=Se,W=ye,X=be,Y=de("e");return n(T)?f("",!0):(l(),p(X,{key:0,visible:n(r),"onUpdate:visible":a[4]||(a[4]=t=>C(r)?r.value=t:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu",class:"!xs:hidden"},{overlay:o(()=>[n(r)?(l(),I("div",{key:0,class:"p-4 w-90 bg-white nc-table-toolbar-menu rounded-lg flex flex-col gap-5",onClick:a[3]||(a[3]=B(()=>{},["stop"]))},[s("div",De,[s("div",null,i(e.$t("general.groupingField")),1),s("div",Fe,[s("div",Te,[_(Q,{value:n(v),"onUpdate:value":a[0]||(a[0]=t=>C(v)?v.value=t:null),class:"nc-select-shadow w-full nc-kanban-grouping-field-select !rounded-lg","dropdown-class-name":"!rounded-lg",placeholder:"Select a Grouping Field",onChange:G,onClick:a[1]||(a[1]=B(()=>{},["stop"]))},{suffixIcon:o(()=>[_(d,{icon:"arrowDown",class:"text-gray-700"})]),default:o(()=>[(l(!0),I(ue,null,me(n(P),t=>(l(),p(H,{key:t.value,value:t.value},{default:o(()=>[s("div",{class:"w-full flex gap-2 items-center justify-between",title:t.label},[s("div",Ee,[t.value?(l(),p(pe(R(n(S)[t.value])),{key:0,class:"!w-3.5 !h-3.5 !text-gray-700 !ml-0"})):f("",!0),_(A,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:o(()=>[D(i(t.label),1)]),default:o(()=>[D(i(t.label),1)]),_:2},1024)]),n(v)===t.value?(l(),p(d,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):f("",!0)],8,Le)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),s("div",Oe,[_(W,{checked:n(w),"onUpdate:checked":a[2]||(a[2]=t=>C(w)?w.value=t:null),size:"small",class:"nc-switch",loading:n(x)==="hideEmptyStack"},{default:o(()=>[s("div",Ue,i(e.$t("general.hide"))+" "+i(e.$t("general.empty").toLowerCase())+" "+i(e.$t("general.stack").toLowerCase()),1)]),_:1},8,["checked","loading"])])])):f("",!0)]),default:o(()=>[s("div",$e,[_e((l(),p(k,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn !border-0 !h-7 group",size:"small",type:"secondary",disabled:n(L)},{default:o(()=>[s("div",Ve,[_(d,{icon:"settings",class:"h-4 w-4"}),n(E)?f("",!0):(l(),I("div",Me,[s("span",Ne,i(e.$t("activity.kanban.stackedBy")),1),s("div",je,[s("span",Be,i(n(K)),1)])]))])]),_:1},8,["disabled"])),[[Y,["c:kanban:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{ca as default};
