import{ah as N,r,ai as C,g as c,aj as l,ak as v,B as J,A as M}from"./Cgw6cdOy.js";var T=(a=>(a.Save="save",a.Test="test",a))(T||{});const[$,k]=N(()=>{const a=r([]),{$api:u,$e:w}=M(),{t:p}=C(),s=r(null),g=r({}),f=r(!1),i=r(null),y=r(!1),S=c(()=>a.value.filter(e=>e.category==="Email")),m=c(()=>a.value.filter(e=>e.category==="Storage")),h=c(()=>S.value.find(e=>e.active)),A=c(()=>m.value.find(e=>e.active)),P=r(!1),D=r(!1),I=c(()=>a.value.reduce((e,t)=>{const n=t.category.toLowerCase();return e[n]||(e[n]=[]),e[n].push(t),e},{})),d=async()=>{try{const e=(await u.plugin.list()).list??[];a.value=e.map(t=>({...t,tags:t.tags?t.tags.split(","):[],parsedInput:t.input&&JSON.parse(t.input)}))}catch(e){l.error(await v(e))}};return{apps:a,emailApps:S,storageApps:m,loadSetupApps:d,categorizeApps:I,activePlugin:s,readPluginDetails:async e=>{try{f.value=!0;const t=await u.plugin.read(e),n=JSON.parse(t.input_schema??"{}"),O=n.array?[{}]:{},o=typeof t.input=="string"?JSON.parse(t.input):O;"secure"in o&&typeof o.secure=="string"&&(o.secure=o.secure==="true"),s.value={...t,formDetails:n,parsedInput:o},g.value=s.value.parsedInput}catch(t){console.log(t)}finally{f.value=!1}},activePluginFormData:g,isLoading:f,testSettings:async()=>{i.value="test";try{s.value&&(await u.plugin.test({input:JSON.stringify(g.value),title:s.value.title,category:s.value.category})?l.success(p("msg.success.pluginTested")):l.info(p("msg.info.invalidCredentials")))}catch(e){l.error(await v(e))}finally{i.value=null}},saveSettings:async()=>{var e,t;i.value="save";try{await u.plugin.update((e=s.value)==null?void 0:e.id,{input:JSON.stringify(g.value),active:!0}),l.success(((t=s.value)==null?void 0:t.formDetails.msgOnInstall)||p("msg.success.pluginSettingsSaved")),d().catch(console.error),J("/account/setup")}catch(n){l.error(await v(n))}finally{i.value=null}},loadingAction:i,emailConfigured:h,storageConfigured:A,listModalDlg:P,configModalDlg:D,showPluginUninstallModal:y,resetPlugin:async()=>{try{await u.plugin.update(s.value.id,{input:null,active:!1}),l.success(p("msg.success.pluginUninstalled")),y.value=!1,await d()}catch(e){l.error(await v(e))}w("a:appstore:reset",{app:s.value.title})}}});function z(){const a=k();if(a==null)throw new Error("Please call `useProvideAccountSetupStore` on the appropriate parent component");return a}export{T as A,z as a,$ as u};
