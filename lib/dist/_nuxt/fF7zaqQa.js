const __vite__fileDeps=["./m8rA889u.js","./3QBYHahY.js","./entry.Ic44fwRn.css","./C9Sjn86N.js","./D4iSzjWt.js","./DPqnb67u.js","./PlainCell.DrVmydsK.css","./DDZjUaby.js","./B6kJGnpr.js","./T74iQZdg.js","./CSl6euFG.js","./Bj2FvocX.js","./boyBAVNN.js","./BYmqikBK.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as rt,r as B,gl as nt,bN as ye,dA as lt,L as st,d9 as it,hg as dt,g as J,cr as r,i as ut,gE as ct,cB as ft,j6 as mt,H as vt,O as wt,o as b,c as R,P as y,aa as Be,a as A,t as Z,T as se,aq as V,av as j,U as ie,R as pt,S as ze,w as de,Y as Le,b as Ae,Z as ge,a6 as he,a0 as yt,p as gt,e as ht,A as _t,dc as Mt,_ as xt}from"./3QBYHahY.js";import{a as bt}from"./McwC7LnE.js";import{a as kt}from"./CfxEkdGP.js";import{b as Dt}from"./DgfVJyEd.js";import{j as It,e as K}from"./BYmqikBK.js";import"./CSl6euFG.js";import"./BteOdwRG.js";const Rt=ge(()=>he(()=>import("./m8rA889u.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(C=>C.default||C)),St=ge(()=>he(()=>import("./DDZjUaby.js"),__vite__mapDeps([7,1,2]),import.meta.url).then(C=>C.default||C)),Ct=ge(()=>he(()=>import("./B6kJGnpr.js"),__vite__mapDeps([8,9,10,1,2,11,5,12,13]),import.meta.url).then(C=>C.default||C)),Et=C=>(gt("data-v-b1a58a1c"),C=C(),ht(),C),Ot={class:"flex w-full items-center"},Tt=Et(()=>A("div",{class:"flex-1 border-b-1 border-brand-500"},null,-1)),Bt={class:"flex sticky h-6 z-1 top-0 pl-16 bg-gray-50 w-full"},zt={class:"absolute bg-white w-16 z-1"},Lt=["onDblclick","onClick"],At={class:"text-xs"},Pt={class:"absolute pointer-events-none inset-0 overflow-hidden !mt-5.95","data-testid":"nc-calendar-week-record-container"},Ht=["data-testid","data-unique-id","onMousedown","onMouseover"],Vt={class:"text-xs font-medium text-gray-400"},$t=rt({__name:"DateTimeField",emits:["expandRecord","newRecord"],setup(C,{emit:Pe}){const _e=Pe,{selectedDateRange:z,formattedData:P,formattedSideBarData:Me,calendarRange:Q,selectedDate:He,displayField:Ve,viewMetaProperties:$e,selectedTime:ee,updateRowProperty:ue,sideBarFilterOption:Fe,showSideMenu:Ne,updateFormat:Y}=bt(),{$e:xe}=_t(),S=B(null),$=B(null),{width:te}=nt(S),je=ye(lt,B(!1)),{isUIAllowed:H}=st(),q=ye(it,B()),Ye=ye(dt,B()),{fields:be}=kt(),qe=J(()=>be.value?new Map(be.value.map(e=>[e.fk_column_id,{underline:e.underline,bold:e.bold,italic:e.italic}])):new Map),U=e=>{let t=e.day()-1;return t===-1&&(t=6),t},D=J(()=>{var e;return(e=$e.value)!=null&&e.hide_weekend?5:7}),oe=B(r()),Ue=J(()=>{if(!te.value)return{top:0,left:0};const e=te.value/D.value*U(oe.value),t=oe.value.hour()*60+oe.value.minute(),a=52/60*t;return{width:`${te.value/D.value}px`,top:`${a}px`,left:`${e}px`}});ut(()=>{const e=ct(()=>{oe.value=r()},1e4);ft(()=>{clearInterval(e)})});const ce=e=>qe.value.get(e.id),ae=mt(({startDate:e,endDate:t,scheduleStart:a,scheduleEnd:u})=>(t!=null&&t.isValid()||(t=e.clone().add(15,"minutes")),e.isBefore(a,"minutes")&&(e=a.clone()),t.isAfter(u,"minutes")&&(t=u.clone()),{startDate:e,endDate:t})),X=J(()=>{const e=[];let t=r(z.value.start)??r().startOf("week"),a=r(z.value.end)??r().endOf("week");for(D.value===5&&(a=a.subtract(2,"day"));t.isSameOrBefore(a);){const u=[];for(let f=0;f<24;f++)u.push(r().hour(f).minute(0).second(0).millisecond(0).year(t.year()).month(t.month()).date(t.date()));e.push(u),t=t.add(1,"day")}return e}),ke=(e,t=!1)=>{const a=e.hour()*60+e.minute();return t?Math.ceil(a):Math.floor(a)},Xe=(e,t)=>({from:ke(e,!1),to:ke(t,!0)-1,dayIndex:U(e)}),We=(e,t)=>{var f,d;const{fromDate:a,toDate:u}=t;if(!a||!u)return!1;for(const g of e){const n=(f=g.rowMeta.range)==null?void 0:f.fk_from_col,c=(d=g.rowMeta.range)==null?void 0:d.fk_to_col;if(!n)return!1;const{startDate:l,endDate:v}=ae({startDate:r(g.row[n.title]),endDate:c?r(g.row[c.title]):r(g.row[n.title]).add(1,"hour").subtract(1,"minute"),scheduleStart:r(z.value.start).startOf("day"),scheduleEnd:r(z.value.end).endOf("day")});if(a.isBetween(l,v,null,"[]")||u.isBetween(l,v,null,"[]"))return!1}return!0},Ge=({row:e,columnArray:t,graph:a})=>{const u=e.rowMeta.id,f=new Set,d=e.rowMeta.dayIndex,g=t[d].findIndex(v=>v.findIndex(h=>h.rowMeta.id===u)!==-1)+1,n=v=>{f.add(v);let h=1;const O=a.get(v);if(O)for(const T of O){if(h>=t[d].length)return h;f.has(T)||(h=Math.min(Math.max(h,n(T)+1),t[d].length))}return h};let c=1;a.has(u)&&n(u);const l=[];return t[d].flat().filter(v=>f.has(v.rowMeta.id)).forEach(v=>{l.push(v.rowMeta.overLapIteration)}),c=Math.max(...l),{maxOverlaps:c,dayIndex:d,overlapIndex:g}},W=J(()=>{if(!P.value||!Q.value||!S.value||!$.value)return{records:[],gridTimeMap:new Map};const e=te.value/D.value,t=52,a=r(z.value.start).startOf("day");let u=r(z.value.end).endOf("day");D.value===5&&(u=u.subtract(2,"day"));const f=[[[]]],d=new Map,g=[];return Q.value.forEach(n=>{var O,T,I;const c=n.fk_from_col,l=n.fk_to_col,v=[...P.value].filter(o=>{const w=o.row[c.title]?r(o.row[c.title]):null;if(c&&l){const i=o.row[c.title]?r(o.row[c.title]):null,m=o.row[l.title]?r(o.row[l.title]):null;return i&&m&&!m.isBefore(i)}else if(c&&!l)return!!w;return!1}).sort((o,w)=>{const i=r(o.row[c.title]),m=r(w.row[c.title]);return i.isBefore(m)?1:-1});for(const o of v){const w=o.rowMeta.id??Dt();if(c&&l){const{startDate:i,endDate:m}=ae({startDate:r(o.row[c.title]),endDate:r(o.row[l.title]),scheduleStart:a,scheduleEnd:u});let p=i.clone();for(;p.isSameOrBefore(m,"day");){const _=p.clone().endOf("day"),s=_.isSame(i,"day")?i:p,x=_.isSame(m,"day")?m:_,k=U(s),F=Math.max((X.value[k]??[]).findIndex(L=>L.format("HH:mm")===s.format("HH:mm")),0),ne=Math.max((X.value[k]??[]).findIndex(L=>L.format("HH:mm")===(x==null?void 0:x.startOf("hour").format("HH:mm"))),0);let N="rounded";const le=L=>L.isSame(p,"day"),Oe=L=>L.isBefore(p,"day"),Te=L=>L.isAfter(p,"day");le(i)&&le(m)?N="rounded":Oe(i)&&Te(m)?N="none":le(i)&&Te(m)?N="topRounded":Oe(i)&&le(m)?N="bottomRounded":N="none";let pe={};const tt=ne-F+1,ot=F*t,at=(ne-F+1)*t-tt-5;pe={...pe,top:`${ot}px`,height:`${at}px`},g.push({...o,rowMeta:{...o.rowMeta,id:w,style:pe,range:n,position:N,dayIndex:k}}),p=p.add(1,"day").hour(0).minute(0)}}else if(c){const{startDate:i}=ae({startDate:r(o.row[c.title]),endDate:r(o.row[c.title]).add(1,"hour").subtract(1,"minute"),scheduleStart:a,scheduleEnd:u});let m={};const p=U(i),_=(i.minute()/60+i.hour())*t;m={...m,top:`${_+1}px`,height:`${t-2}px`},g.push({...o,rowMeta:{...o.rowMeta,id:w,position:"rounded",style:m,range:n,dayIndex:p}})}}g.sort((o,w)=>{var p,_;const i=(p=o.rowMeta.range)==null?void 0:p.fk_from_col,m=(_=w.rowMeta.range)==null?void 0:_.fk_from_col;return!i||!m?0:r(o.row[i.title]).isBefore(r(w.row[m.title]))?-1:1});for(const o of g){const w=(O=o.rowMeta.range)==null?void 0:O.fk_from_col,i=(T=o.rowMeta.range)==null?void 0:T.fk_to_col;if(!w)continue;const{startDate:m,endDate:p}=ae({startDate:r(o.row[w.title]),endDate:i?r(o.row[i.title]):r(o.row[w.title]).add(1,"hour").subtract(1,"minute"),scheduleStart:a,scheduleEnd:u}),_=Xe(m,p),s=o.rowMeta.dayIndex??_.dayIndex;for(let k=_.from;k<=_.to;k++){d.has(s)||d.set(s,new Map),(I=d.get(s))!=null&&I.has(k)||d.set(s,(d.get(s)??new Map).set(k,{count:0,id:[]}));const F=d.get(s).get(k).id;F.push(o.rowMeta.id);const ne=d.get(s).get(k).count+1;d.set(s,(d.get(s)??new Map).set(k,{count:ne,id:F}))}let x=!1;f[s]||(f[s]=[]);for(const k in f[s])if(We(f[s][k],{fromDate:m,toDate:p})){f[s][k].push(o),x=!0;break}x||f[s].push([o])}const h=new Map;for(const o of d.keys()){h.has(o)||h.set(o,new Map);for(const[w,{id:i}]of d.get(o))for(const m of i){h.get(o).has(m)||h.get(o).set(m,new Set);for(const p of i)m!==p&&(h.get(o).get(m).has(p)||h.get(o).get(m).add(p))}}for(const o in f)for(const w in f[o])for(const i of f[o][w])i.rowMeta.overLapIteration=parseInt(w)+1;for(const o of g){const{maxOverlaps:w,overlapIndex:i,dayIndex:m}=Ge({row:o,columnArray:f,graph:h.get(o.rowMeta.dayIndex)??new Map}),p=o.rowMeta.dayIndex??m;let _="block";D.value===5&&(p===5||p===6)&&(_="none"),o.rowMeta.numberOfOverlaps=w;let s=0,x=100;const k=p*e;o.rowMeta.overLapIteration-1>2?_="none":(s=100/Math.min(w,3)/D.value,x=s*(i-1)),o.rowMeta.style={...o.rowMeta.style,left:`calc(${k}px + ${x}%)`,width:`calc(${s}%)`,display:_}}}),{records:g,gridTimeMap:d}}),fe=B(!1),me=B(),ve=B(),re=B(),E=B(),G=B(!1),M=B(),Je=Mt((e,t,a)=>{ue(e,t,a)},500),De=e=>{var m,p,_;if(!H("dataEdit")||!S.value||!E.value||!$.value||(m=E.value.rowMeta.range)!=null&&m.is_readonly)return;const{width:t,left:a,top:u,bottom:f}=S.value.getBoundingClientRect(),{scrollHeight:d}=S.value;e.clientY>f-20?S.value.scrollTop+=10:e.clientY<u+20&&(S.value.scrollTop-=10);const g=(e.clientX-a-window.scrollX)/t,n=(e.clientY-u+S.value.scrollTop)/d,c=(p=E.value.rowMeta.range)==null?void 0:p.fk_from_col,l=(_=E.value.rowMeta.range)==null?void 0:_.fk_to_col;if(!c||!l)return;const v=r(E.value.row[l.title]),h=r(E.value.row[c.title]),O=Math.floor(g*D.value),T=Math.floor(n*23),I=Math.round(n*24*60%60);let o=[],w=E.value;if(re.value==="right"){let s=r(z.value.start).add(O,"day").add(T,"hour").add(I,"minute");if(o=[l.title],r(s).isBefore(h,"day")&&(s=h.clone()),!s.isValid())return;w={...E.value,row:{...E.value.row,[l.title]:s.format(Y.value)}}}else if(re.value==="left"){let s=r(z.value.start).add(O,"day").add(T,"hour").add(I,"minute");if(o=[c.title],r(s).isAfter(v)&&(s=r(r(v)).clone()),!s)return;w={...E.value,row:{...E.value.row,[c.title]:r(s).format(Y.value)}}}const i=K(w.row,q.value.columns);P.value=P.value.map(s=>K(s.row,q.value.columns)===i?w:s),Je(w,o,!1)},Ie=()=>{fe.value=!1,re.value=null,E.value=null,document.removeEventListener("mousemove",De),document.removeEventListener("mouseup",Ie)},Ze=(e,t,a)=>{var u;H("dataEdit")&&((u=a.rowMeta.range)!=null&&u.is_readonly||(fe.value=!0,re.value=e,E.value=a,document.addEventListener("mousemove",De),document.addEventListener("mouseup",Ie)))},we=(e,t,a)=>{var p,_;const{width:u,left:f,top:d}=S.value.getBoundingClientRect(),{scrollHeight:g}=S.value,n=(e.clientX-f-window.scrollX)/u,c=(e.clientY-d+S.value.scrollTop-36.8)/g,l=(p=M.value.rowMeta.range)==null?void 0:p.fk_from_col,v=(_=M.value.rowMeta.range)==null?void 0:_.fk_to_col;if(!l)return{newRow:null,updatedProperty:[]};const h=Math.max(0,Math.min(6,Math.floor(n*D.value))),O=Math.max(0,Math.min(23,Math.floor(c*24))),T=Math.round(c*24*60%60/15)*15,I=r(z.value.start).add(h,"day").add(O,"hour").add(T,"minute");if(!I)return{newRow:null,updatedProperty:[]};let o;const w=[l.title],i={...M.value,row:{...M.value.row,[l.title]:r(I).format(Y.value)}};if(v){const s=M.value.row[l.title]?r(M.value.row[l.title]):null,x=M.value.row[v.title]?r(M.value.row[v.title]):null;s&&x?o=r(I).add(x.diff(s,"day"),"day"):s&&!x?o=r(I).endOf("day"):!s&&x?o=r(I).endOf("day"):o=I.clone(),i.row[v.title]=r(o).format(Y.value),w.push(v.title)}if(M.value.row[l.title]===i.row[l.title]&&!a)return{newRow:null,updatedProperty:[]};if(!i)return{newRow:null,updatedProperty:[]};const m=K(i.row,q.value.columns);return t?(P.value=[...P.value,i],Me.value=Me.value.filter(s=>K(s.row,q.value.columns)!==m)):(P.value=P.value.map(s=>K(s.row,q.value.columns)===m?i:s),M.value={...M.value,row:i.row}),{newRow:i,updatedProperty:w}},Re=e=>{if(!H("dataEdit")||!$.value||!M.value)return;const t=$.value.getBoundingClientRect(),a=20;e.clientY>t.bottom-a?$.value.scrollTop+=20:e.clientY<t.top+a&&($.value.scrollTop-=20),we(e)},Se=e=>{if(!H("dataEdit")||!G.value||!S.value||!M.value)return;e.preventDefault(),clearTimeout(me.value);const{newRow:t,updatedProperty:a}=we(e,!1,!0);document.querySelectorAll(".draggable-record").forEach(f=>{f.style.visibility="",f.style.opacity="100%"}),t&&ue(t,a,!1),xe("c:calendar:week:drag-record"),document.removeEventListener("mousemove",Re),document.removeEventListener("mouseup",Se)},Ke=(e,t)=>{if(fe.value)return;let a=e.target;G.value=!1,me.value=setTimeout(()=>{var d;if(!H("dataEdit")||(d=t.rowMeta.range)!=null&&d.is_readonly)return;for(G.value=!0;!a.classList.contains("draggable-record");)a=a.parentElement;document.querySelectorAll(".draggable-record").forEach(g=>{g.getAttribute("data-unique-id").includes(t.rowMeta.id)||(g.style.opacity="30%")}),G.value=!0,M.value=t,document.addEventListener("mousemove",Re),document.addEventListener("mouseup",Se)},200);const u=()=>{clearTimeout(me.value),document.removeEventListener("mouseup",u),G.value||_e("expandRecord",t)};document.addEventListener("mouseup",u)},Qe=e=>{var a,u;if(!H("dataEdit")||!S.value)return;e.preventDefault();const t=(a=e.dataTransfer)==null?void 0:a.getData("text/plain");if(t){const{record:f}=JSON.parse(t);if((u=f.rowMeta.range)!=null&&u.is_readonly)return;M.value=f;const{newRow:d,updatedProperty:g}=we(e,!0);d&&(ue(d,g,!1),xe("c:calendar:day:drag-record"))}},et=e=>{Fe.value="selectedHours",ee.value=e,Ne.value=!0},Ce=e=>{var g,n;if(!W.value||!W.value.gridTimeMap)return{isOverflow:!1,overflowCount:0};const{gridTimeMap:t}=W.value,a=U(e),u=e.hour()*60+e.minute(),f=e.hour()*60+e.minute()+59;let d=0;for(let c=u;c<=f;c++){const l=((n=(g=t.get(a))==null?void 0:g.get(c))==null?void 0:n.count)??0;d=Math.max(d,l)}return{isOverflow:d-3>0,overflowCount:d-3}},Ee=e=>{if(!H("dataEdit")||!Q.value)return;const t=Q.value[0].fk_from_col;if(!t)return;const a={row:{[t.title]:e.format(Y.value)}};_e("newRecord",a)};return vt(()=>W.value,()=>{var t,a;if(M.value)return;const e=document.querySelectorAll(".draggable-record");e.length?(t=e.item(0))==null||t.scrollIntoView({behavior:"smooth",block:"center"}):(a=document.querySelectorAll(".nc-calendar-day-hour").item(9))==null||a.scrollIntoView({behavior:"smooth",block:"center"})},{immediate:!0}),(e,t)=>{const a=yt,u=Rt,f=St,d=Ct,g=wt("e");return b(),R("div",{ref_key:"scrollContainer",ref:$,class:"h-[calc(100vh-5.4rem)] prevent-select relative flex w-full overflow-y-auto nc-scrollbar-md","data-testid":"nc-calendar-week-view",onDrop:Qe},[!y(je)&&y(r)().isBetween(y(z).start,y(z).end)?(b(),R("div",{key:0,class:"absolute ml-16 mt-7 pointer-events-none z-4",style:Be(y(Ue))},[A("div",Ot,[A("span",{class:"text-brand-500 rounded-md text-xs border-1 pointer-events-auto px-0.5 border-brand-200 cursor-pointer bg-brand-50",onClick:t[0]||(t[0]=n=>Ee(y(r)()))},Z(y(r)().format("hh:mm A")),1),Tt])],4)):se("",!0),A("div",Bt,[(b(!0),R(V,null,j(y(X),n=>(b(),R("div",{key:n[0].toISOString(),class:ie([{"text-brand-500":n[0].isSame(y(r)(),"date"),"w-1/5":y(D)===5,"w-1/7":y(D)===7},"text-center text-[10px] font-semibold leading-4 flex items-center justify-center uppercase text-gray-500 w-full py-1 border-gray-200 last:border-r-0 border-b-1 border-l-1 border-r-0 bg-gray-50"])},Z(y(r)(n[0]).format("DD ddd")),3))),128))]),A("div",zt,[(b(!0),R(V,null,j(y(X)[0],(n,c)=>(b(),R("div",{key:c,class:"h-13 first:mt-0 pt-7.1 nc-calendar-day-hour text-right pr-2 font-semibold text-xs text-gray-400 py-1"},Z(n.format("hh a")),1))),128))]),A("div",{ref_key:"container",ref:S,class:"absolute ml-16 flex w-[calc(100%-64px)]"},[(b(!0),R(V,null,j(y(X),(n,c)=>(b(),R("div",{key:c,class:ie([{"w-1/5":y(D)===5,"w-1/7":y(D)===7},"h-full mt-5.95"]),"data-testid":"nc-calendar-week-day"},[(b(!0),R(V,null,j(n,(l,v)=>(b(),R("div",{key:v,class:ie([{"border-1 !border-brand-500 !bg-gray-100":l.isSame(y(ee),"hour")&&(l.get("day")===6||l.get("day")===0),"border-1 !border-brand-500 bg-gray-50":l.isSame(y(ee),"hour"),"bg-gray-50 hover:bg-gray-100":l.get("day")===0||l.get("day")===6,"hover:bg-gray-50":l.get("day")!==0&&l.get("day")!==6},"text-center relative transition h-13 text-sm text-gray-500 w-full py-1 border-transparent border-1 border-x-gray-100 border-t-gray-100 border-l-gray-200"]),"data-testid":"nc-calendar-week-hour",onDblclick:h=>Ee(l),onClick:()=>{He.value=l,ee.value=l,M.value=void 0}},[Ce(l).isOverflow?pt((b(),ze(a,{key:0,class:"!absolute bottom-1 text-center w-15 ml-auto inset-x-0 z-3 text-gray-500",size:"xxsmall",type:"secondary",onClick:h=>et(l)},{default:de(()=>[A("span",At," + "+Z(Ce(l).overflowCount)+" more ",1)]),_:2},1032,["onClick"])),[[g,"['c:calendar:week-view-more']"]]):se("",!0)],42,Lt))),128))],2))),128)),A("div",Pt,[(b(!0),R(V,null,j(y(W).records,(n,c)=>{var l;return b(),R(V,{key:c},[((l=n.rowMeta.style)==null?void 0:l.display)!=="none"?(b(),R("div",{key:0,"data-testid":`nc-calendar-week-record-${n.row[y(Ve).title]}`,"data-unique-id":n.rowMeta.id,style:Be(n.rowMeta.style),class:ie([{"w-1/5":y(D)===5,"w-1/7":y(D)===7},"absolute transition draggable-record group cursor-pointer pointer-events-auto"]),onMousedown:Le(v=>Ke(v,n),["stop"]),onMouseleave:t[1]||(t[1]=v=>ve.value=null),onMouseover:v=>ve.value=n.rowMeta.id,onDragover:t[2]||(t[2]=Le(()=>{},["prevent"]))},[Ae(d,{row:n},{default:de(()=>{var v,h,O,T,I;return[Ae(f,{hover:y(ve)===n.rowMeta.id||n.rowMeta.id===((h=(v=y(M))==null?void 0:v.rowMeta)==null?void 0:h.id),position:n.rowMeta.position,resize:!!((O=n.rowMeta.range)!=null&&O.fk_to_col)&&y(H)("dataEdit"),record:n,color:"blue",selected:n.rowMeta.id===((I=(T=y(M))==null?void 0:T.rowMeta)==null?void 0:I.id),onResizeStart:Ze},{time:de(()=>{var o;return[A("div",Vt,Z(y(r)(n.row[(o=n.rowMeta.range)==null?void 0:o.fk_from_col.title]).format("h:mm a")),1)]}),default:de(()=>[(b(!0),R(V,null,j(y(Ye),(o,w)=>(b(),R(V,{key:w},[("isRowEmpty"in e?e.isRowEmpty:y(It))(n,o)?se("",!0):(b(),ze(u,{key:0,modelValue:n.row[o.title],"onUpdate:modelValue":i=>n.row[o.title]=i,class:"text-xs",bold:ce(o).bold,column:o,italic:ce(o).italic,underline:ce(o).underline},null,8,["modelValue","onUpdate:modelValue","bold","column","italic","underline"]))],64))),128))]),_:2},1032,["hover","position","resize","record","selected"])]}),_:2},1032,["row"])],46,Ht)):se("",!0)],64)}),128))])],512)],544)}}}),Wt=xt($t,[["__scopeId","data-v-b1a58a1c"]]);export{Wt as default};
