const __vite__fileDeps=["./CRNALu61.js","./DKhUGBot.js","./entry.B8GgT5QA.css","./C9Sjn86N.js","./DFT4Rrrq.js","./lyxpGZoZ.js","./PlainCell.BhW7NMdh.css","./CmSnWlOw.js","./RecordCard.BkJXt930.css","./XWOJXlJc.js","./DrSobHNn.js","./DGy9VVU7.js","./DO1hNe_j.js","./boyBAVNN.js","./Ce4Hnuew.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as Se,g as O,r as b,gI as Ce,L as Ye,bL as de,d0 as Le,h5 as Pe,ce as r,d2 as ze,o as h,c as R,a as W,al as P,am as T,T as ce,P as v,t as Ve,a8 as Ie,Y as fe,b as ve,w as me,U as Be,S as we,Z as J,a5 as G,_ as Ae}from"./DKhUGBot.js";import{a as Oe}from"./6zAE39KB.js";import{a as Te}from"./BMlI7u7p.js";import{b as pe}from"./DZMsOWET.js";import{j as He,e as I}from"./Ce4Hnuew.js";import"./DGy9VVU7.js";import"./D-d1Vlq3.js";const Fe=J(()=>G(()=>import("./CRNALu61.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(M=>M.default||M)),je=J(()=>G(()=>import("./CmSnWlOw.js"),__vite__mapDeps([7,1,2,8]),import.meta.url).then(M=>M.default||M)),Ne=J(()=>G(()=>import("./XWOJXlJc.js"),__vite__mapDeps([9,10,11,1,2,12,5,13,14]),import.meta.url).then(M=>M.default||M)),Ue={class:"flex h-6"},Xe=["onClick","onDblclick"],Ze=["onClick","onDblclick"],qe={class:"absolute nc-scrollbar-md overflow-y-auto mt-9 pointer-events-none inset-0","data-testid":"nc-calendar-week-record-container"},We=["data-testid","data-unique-id","onMouseover","onMousedown"],Je=Se({__name:"DateField",emits:["expandRecord","newRecord"],setup(M,{emit:ye}){const H=ye,{selectedDateRange:_,formattedData:k,formattedSideBarData:K,calendarRange:B,selectedDate:F,displayField:_e,updateRowProperty:j,viewMetaProperties:De}=Oe(),E=O(()=>{var e;return(e=De.value)!=null&&e.hide_weekend?5:7}),C=b(null),{width:ge}=Ce(C),{isUIAllowed:S}=Ye(),z=de(Le,b()),be=de(Pe,b()),{fields:Q}=Te(),he=O(()=>Q.value?new Map(Q.value.map(e=>[e.fk_column_id,{underline:e.underline,bold:e.bold,italic:e.italic}])):new Map),N=e=>he.value.get(e.id),ee=O(()=>{let e=r(_.value.start),o=r(_.value.end);E.value===5&&(o=o.subtract(2,"day"));const a=[];for(;e.isBefore(o)||e.isSame(o,"day");)a.push(r(e)),e=e.add(1,"day");return a}),te=(e,o,a)=>{let c=0;for(;;){let i=!0;for(let t=0;t<a;t++){const l=o+t;if(e[l]||(e[l]={}),e[l][c]){i=!1;break}}if(i)return c;c++}},ae=e=>e&&e.isBetween(r(_.value.start).startOf("day"),r(_.value.end).endOf("day"),"day","[]"),Re=O(()=>{if(!k.value||!B.value)return[];const e={0:{},1:{},2:{},3:{},4:{},5:{},6:{}},o=[],a=ge.value/E.value;return B.value.forEach(c=>{const i=c.fk_from_col,t=c.fk_to_col;if(i&&t)for(const l of[...k.value].filter(m=>{const n=r(m.row[i.title]),d=r(m.row[t.title]);return!n.isValid()||!d.isValid()?!1:!d.isBefore(n)})){const m=l.rowMeta.id??pe();let n=r(l.row[i.title]);const d=n.clone(),s=r(l.row[t.title]);n.isBefore(_.value.start)&&(n=r(_.value.start));const D=n.diff(_.value.start,"day");let p=Math.max(Math.min(s.diff(n,"day"),6)+1,1);s.isAfter(n,"month")&&(p=7-D),D>0&&(p=Math.min(p,7-D));const y=`calc(max(${p} * ${a}px, ${a}px))`;let u=-1;for(let L=0;L<p;L++){const V=D+L;e[V]||(e[V]={}),u===-1&&(u=te(e,V,p))}for(let L=0;L<p;L++){const V=D+L;e[V][u]=!0}let f="none";const x=ae(d),ue=ae(s);x&&ue?f="rounded":n&&s&&n.isBefore(_.value.start)&&s.isAfter(_.value.end)||n&&s&&(n.isAfter(_.value.end)||s.isBefore(_.value.start))?f="none":x?f="leftRounded":ue&&(f="rightRounded"),o.push({...l,rowMeta:{...l.rowMeta,range:c,position:f,id:m,style:{width:y,left:`${D*a}px`,top:`${u*28}px`}}})}else if(i)for(const l of k.value){const m=l.rowMeta.id??pe(),n=r(l.row[i.title]),d=Math.max(n.diff(_.value.start,"day"),0),s=te(e,d,1);e[d][s]=!0,o.push({...l,rowMeta:{...l.rowMeta,range:c,id:m,position:"rounded",style:{width:`calc(${a}px)`,left:`${d*a}px`,top:`${s*28}px`}}})}}),o}),Y=b(null),U=b(!1),X=b(),$=b(!1),w=b(),A=b(),g=b(null),Z=b(),Me=ze((e,o,a)=>{j(e,o,a)},500),oe=e=>{var p,y;if(!S("dataEdit")||!C.value||!g.value)return;const{width:o,left:a}=C.value.getBoundingClientRect(),c=(e.clientX-a-window.scrollX)/o,i=(p=g.value.rowMeta.range)==null?void 0:p.fk_from_col,t=(y=g.value.rowMeta.range)==null?void 0:y.fk_to_col;if(!i||!t)return;const l=r(g.value.row[t.title]),m=r(g.value.row[i.title]),n=Math.floor(c*E.value);let d=[],s;if(A.value==="right"){let u=r(_.value.start).add(n,"day");if(d=[t.title],r(u).isBefore(m,"day")&&(u=m.clone()),!u.isValid())return;s={...g.value,row:{...g.value.row,[t.title]:u.format("YYYY-MM-DD HH:mm:ssZ")}}}else if(A.value==="left"){let u=r(_.value.start).add(n,"day");if(d=[i.title],r(u).isAfter(l)&&(u=r(r(l)).clone()),!u)return;s={...g.value,row:{...g.value.row,[i.title]:r(u).format("YYYY-MM-DD HH:mm:ssZ")}}}const D=I(s.row,z.value.columns);k.value=k.value.map(u=>I(u.row,z.value.columns)===D?s:u),Me(s,d,!1)},ne=()=>{U.value=!1,A.value=null,g.value=null,document.removeEventListener("mousemove",oe),document.removeEventListener("mouseup",ne)},ke=(e,o,a)=>{S("dataEdit")&&(U.value=!0,A.value=e,g.value=a,document.addEventListener("mousemove",oe),document.addEventListener("mouseup",ne))},q=(e,o)=>{var y,u;const{width:a,left:c}=C.value.getBoundingClientRect(),i=(e.clientX-c-window.scrollX)/a,t=(y=w.value.rowMeta.range)==null?void 0:y.fk_from_col,l=(u=w.value.rowMeta.range)==null?void 0:u.fk_to_col;if(!t)return{updatedProperty:[],newRow:null};const m=Math.floor(i*E.value),n=r(_.value.start).add(m,"day");if(!n)return{updatedProperty:[],newRow:null};let d;const s={...w.value,row:{...w.value.row,[t.title]:r(n).format("YYYY-MM-DD HH:mm:ssZ")}},D=[t.title];if(l){const f=w.value.row[t.title]?r(w.value.row[t.title]):null,x=w.value.row[l.title]?r(w.value.row[l.title]):null;f&&x?d=r(n).add(x.diff(f,"day"),"day"):f&&!x?d=r(n).endOf("day"):!f&&x?d=r(n).endOf("day"):d=n.clone(),s.row[l.title]=r(d).format("YYYY-MM-DD HH:mm:ssZ"),D.push(l.title)}const p=I(s.row,z.value.columns);return o?(k.value=[...k.value,s],K.value=K.value.filter(f=>I(f.row,z.value.columns)!==p)):k.value=k.value.map(f=>I(f.row,z.value.columns)===p?s:f),{updateProperty:D,newRow:s}},re=e=>{S("dataEdit")&&(!C.value||!w.value||q(e,!1))},le=e=>{if(e.preventDefault(),clearTimeout(X.value),!S("dataEdit")||!$.value||!C.value||!w.value)return;const{updateProperty:o,newRow:a}=q(e);if(!a)return;document.querySelectorAll(".draggable-record").forEach(i=>{i.style.visibility="",i.style.opacity="100%"}),Y.value&&(Y.value.style.boxShadow="none",Y.value=null),w.value=void 0,j(a,o,!1),document.removeEventListener("mousemove",re),document.removeEventListener("mouseup",le)},xe=(e,o)=>{if(U.value)return;let a=e.target;$.value=!1,X.value=setTimeout(()=>{if(!S("dataEdit"))return;for($.value=!0;!a.classList.contains("draggable-record");)a=a.parentElement;document.querySelectorAll(".draggable-record").forEach(t=>{t.getAttribute("data-unique-id").includes(o.rowMeta.id)||(t.style.opacity="30%")}),$.value=!0,Y.value=a,w.value=o,document.addEventListener("mousemove",re),document.addEventListener("mouseup",le)},200);const c=()=>{clearTimeout(X.value),document.removeEventListener("mouseup",c),$.value||H("expandRecord",o)};document.addEventListener("mouseup",c)},Ee=e=>{var a;if(!S("dataEdit"))return;e.preventDefault();const o=(a=e.dataTransfer)==null?void 0:a.getData("text/plain");if(o){const{record:c}=JSON.parse(o);w.value=c;const{updateProperty:i,newRow:t}=q(e,!0);Y.value&&(Y.value.style.boxShadow="none",Y.value=null),j(t,i,!1),$e("c:calendar:day:drag-record")}},se=e=>{F.value=e,w.value=void 0},ie=e=>{if(!S("dataEdit")||!B.value)return;const o=B.value[0].fk_from_col;if(!o)return;const a={row:{[o.title]:e.format("YYYY-MM-DD HH:mm:ssZ")}};H("newRecord",a)};return(e,o)=>{const a=Fe,c=je,i=Ne;return h(),R("div",{class:"flex relative flex-col prevent-select","data-testid":"nc-calendar-week-view",onDrop:Ee},[W("div",Ue,[(h(!0),R(P,null,T(v(ee),(t,l)=>(h(),R("div",{key:l,class:ce([{"!border-brand-500 !border-b-gray-200":v(r)(t).isSame(v(F),"day"),"w-1/5":v(E)===5,"w-1/7":v(E)===7},"cursor-pointer text-center text-[10px] font-semibold leading-4 flex items-center justify-center uppercase text-gray-500 w-full py-1 border-gray-200 border-l-gray-50 border-t-gray-50 last:border-r-0 border-1 bg-gray-50"]),onClick:m=>se(t),onDblclick:m=>ie(t)},Ve(v(r)(t).format("DD ddd")),43,Xe))),128))]),W("div",{ref_key:"container",ref:C,class:"flex h-[calc(100vh-11.6rem)]"},[(h(!0),R(P,null,T(v(ee),(t,l)=>(h(),R("div",{key:l,class:ce([{"!border-1 !border-t-0 border-brand-500":v(r)(t).isSame(v(F),"day"),"!bg-gray-50":t.get("day")===0||t.get("day")===6,"w-1/5":v(E)===5,"w-1/7":v(E)===7},"flex cursor-pointer flex-col border-r-1 min-h-[100vh] last:border-r-0 items-center"]),"data-testid":"nc-calendar-week-day",onClick:m=>se(t),onDblclick:m=>ie(t)},null,42,Ze))),128))],512),W("div",qe,[(h(!0),R(P,null,T(v(Re),(t,l)=>{var m;return h(),R(P,{key:l},[((m=t.rowMeta.style)==null?void 0:m.display)!=="none"?(h(),R("div",{key:0,"data-testid":`nc-calendar-week-record-${t.row[v(_e).title]}`,"data-unique-id":t.rowMeta.id,style:Ie({...t.rowMeta.style}),class:"absolute group draggable-record pointer-events-auto nc-calendar-week-record-card",onMouseleave:o[0]||(o[0]=n=>Z.value=null),onMouseover:n=>Z.value=t.rowMeta.id,onMousedown:fe(n=>xe(n,t),["stop"])},[ve(i,{row:t},{default:me(()=>{var n,d,s,D,p;return[ve(c,{hover:v(Z)===t.rowMeta.id||t.rowMeta.id===((d=(n=v(w))==null?void 0:n.rowMeta)==null?void 0:d.id),position:t.rowMeta.position,record:t,resize:!!((s=t.rowMeta.range)!=null&&s.fk_to_col)&&v(S)("dataEdit"),selected:((p=(D=v(w))==null?void 0:D.rowMeta)==null?void 0:p.id)===t.rowMeta.id,color:"blue",onDblclick:fe(y=>H("expandRecord",t),["stop"]),onResizeStart:ke},{default:me(()=>[(h(!0),R(P,null,T(v(be),(y,u)=>(h(),R(P,{key:u},[("isRowEmpty"in e?e.isRowEmpty:v(He))(t,y)?we("",!0):(h(),Be(a,{key:0,modelValue:t.row[y.title],"onUpdate:modelValue":f=>t.row[y.title]=f,class:"text-xs",bold:N(y).bold,column:y,italic:N(y).italic,underline:N(y).underline},null,8,["modelValue","onUpdate:modelValue","bold","column","italic","underline"]))],64))),128))]),_:2},1032,["hover","position","record","resize","selected","onDblclick"])]}),_:2},1032,["row"])],44,We)):we("",!0)],64)}),128))])],32)}}}),nt=Ae(Je,[["__scopeId","data-v-435f895a"]]);export{nt as default};
