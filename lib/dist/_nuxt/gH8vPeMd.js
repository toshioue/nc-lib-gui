import{f as ye,N as ge,bN as y,fQ as _e,hr as he,r as p,aE as ke,aC as be,aF as xe,g as k,hN as Se,dB as Ce,hH as Oe,gQ as Ie,cZ as $e,L as Me,cN as Ee,df as B,H as Ae,hv as ee,aj as Re,ak as Ke,aG as Ne,o as f,c as S,P as e,b as $,w as d,aq as T,av as te,S as M,U as E,a as g,aa as q,dj as A,d as P,t as _,Q as le,Y as D,T as z,V as je,W as Be,aL as Pe,A as Ve,a1 as Le,du as Fe,_ as Te}from"./Cgw6cdOy.js";import{_ as qe}from"./CJBRTPd8.js";import{u as De}from"./CnN16FGu.js";import{T as ze}from"./BBFld1ZO.js";import{R as He,_ as Ue}from"./BttyO-T4.js";import{S as Qe}from"./D8rpj5Lr.js";import"./CitraFSq.js";import"./hvq8FVej.js";import"./BcZAlRJW.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";const Ge=["onKeydown"],We={key:0,class:"w-full max-w-full"},Ye={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ze={key:0,class:"w-full"},Je={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Xe={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},et={class:"flex gap-2 text-gray-500 items-center h-full"},tt={class:"text-xs whitespace-normal"},lt=ye({__name:"SingleSelect",props:{modelValue:{},rowIndex:{},disableOptionCreation:{type:Boolean}},emits:["update:modelValue"],setup(H,{emit:ae}){const se=ae,{isMobileMode:U}=ge(),n=y(_e),N=y(he),V=y(ke,p(!1)),Q=y(be,p(!1)),C=y(xe,p(!1)),b=k(()=>Q.value||V.value||C.value),O=p(),c=p(!1),j=y(Se,p(!1)),G=y(Ce,p(!1)),W=y(Oe,p(!1)),oe=y(Ie,p(!1)),{$api:ne}=Ve(),x=p(),{getMeta:ie}=$e(),{isUIAllowed:Y,isMetaReadOnly:re}=Me(),{isPg:Z,isMysql:ce}=Ee(),R=p(),L=p(!1),J=k(()=>!G.value&&!H.disableOptionCreation&&Y("fieldEdit")&&!re.value),m=k(()=>{var t,l,i;if(n!=null&&n.value.colOptions){const o=n.value.colOptions?n.value.colOptions.options.filter(a=>a.title!=="")||[]:[];for(const a of o.filter(r=>r.order===null))a.title=a.title.replace(/^'/,"").replace(/'$/,"");let w=1;const v=(((t=B(n.value.meta))==null?void 0:t.limitOptions)||[]).reduce((a,r)=>(w<((r==null?void 0:r.order)??0)&&(w=r.order),{...a,[r.id]:r}),{})??{};return!W.value&&C.value&&((l=B(n.value.meta))!=null&&l.isLimitOption)&&(((i=B(n.value.meta))==null?void 0:i.limitOptions)||[]).length?o.filter(a=>{var r,K;return((r=v[a.id])==null?void 0:r.show)!==void 0?(K=v[a.id])==null?void 0:K.show:!1}).map(a=>{var r;return{...a,value:a.title,order:a.id&&v[a.id]?(r=v[a.id])==null?void 0:r.order:w++}}).sort((a,r)=>a.order-r.order):o.map(a=>({...a,value:a.title}))}return[]}),ue=k(()=>(m.value??[]).every(t=>t.title!==x.value)),F=k(()=>Y("dataEdit")||C.value),h=k(()=>(F.value||C.value)&&b.value),u=k({get:()=>R.value??H.modelValue,set:t=>{if(t&&J.value&&(m.value??[]).every(l=>l.title!==t))return R.value=t,de();se("update:modelValue",t||null)}});Ae(c,(t,l)=>{var i,o,w,v,a,r;h.value&&(t?(r=(a=(v=O.value)==null?void 0:v.$el)==null?void 0:a.querySelector("input"))==null||r.focus():(w=(o=(i=O.value)==null?void 0:i.$el)==null?void 0:o.querySelector("input"))==null||w.blur())}),De(Q,t=>{var l;switch(t.key){case"Escape":c.value=!1;break;case"Enter":h.value&&b.value&&!c.value&&(c.value=!0);break;case" ":break;default:if(!h.value){t.preventDefault();break}!(t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)&&((l=t.key)==null?void 0:l.length)===1&&!Fe()&&(t.stopPropagation(),c.value=!0);break}});async function de(){var l,i;if(!R.value||G.value)return!1;const t=R.value;if(x.value="",R.value=void 0,t&&!m.value.some(o=>o.title===t))try{m.value.push({title:t,value:t,color:ee.light[(m.value.length+1)%ee.light.length]}),n.value.colOptions={options:m.value.map(({value:w,...v})=>v)};const o={...n.value};o.cdf&&(Z(n.value.source_id)&&(o.cdf=o.cdf.substring(o.cdf.indexOf("'")+1,o.cdf.lastIndexOf("'"))),!ce(n.value.source_id)&&!Z(n.value.source_id)&&(o.cdf=o.cdf.replace(/''/g,"'"))),await ne.dbTableColumn.update(((l=n.value)==null?void 0:l.fk_column_id)||((i=n.value)==null?void 0:i.id),o),u.value=t,await ie(n.value.fk_model_id,!0)}catch(o){console.log(o),Re.error(await Ke(o))}}const fe=()=>{var t,l,i;U.value||(x.value=(i=(l=(t=O.value)==null?void 0:t.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:i.value)},pe=t=>{c.value&&b.value&&t.stopPropagation(),t.key==="Enter"&&t.stopPropagation(),t.key==="Escape"&&(c.value=!1)},ve=t=>{switch(t.key){case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":t.stopPropagation();break}},me=()=>{c.value=!1,V.value=!1},X=t=>{var l,i;if((l=t.target)!=null&&l.classList.contains("ant-select-clear")||(i=t.target)!=null&&i.closest(".ant-select-clear"))return u.value="",t.stopPropagation();L.value||(c.value=h.value&&!c.value)};Ne(document,"click",t=>{c.value&&O.value&&!O.value.$el.contains(t.target)&&(c.value=!1)},!0);const I=k(()=>m.value.find(t=>{var l,i;return t.value===u.value||t.value===((i=(l=u.value)==null?void 0:l.toString())==null?void 0:i.trim())})),we=()=>{L.value=!0,setTimeout(()=>{L.value=!1},250),!(oe.value&&u.value)&&(c.value=!0)};return(t,l)=>{var K;const i=Le,o=ze,w=He,v=Ue,a=Qe,r=qe;return f(),S("div",{class:E(["nc-cell-field h-full w-full flex items-center nc-single-select focus:outline-transparent",{"read-only":e(N),"max-w-full":e(C)}]),onClick:X,onKeydown:Pe(D(X,["stop","prevent"]),["enter"])},[!e(W)&&e(C)&&((K=("parseProp"in t?t.parseProp:e(B))(e(n).meta))!=null&&K.isList)?(f(),S("div",We,[$(v,{value:e(u),"onUpdate:value":l[0]||(l[0]=s=>le(u)?u.value=s:null),disabled:e(N)||!e(h),class:"nc-field-layout-list",onKeydown:ve,onClick:l[1]||(l[1]=D(()=>{},["stop"]))},{default:d(()=>[(f(!0),S(T,null,te(e(m),s=>(f(),M(w,{key:s.title,value:s.title,"data-testid":`select-option-${e(n).title}-${t.rowIndex}`,class:E(`nc-select-option-${e(n).title}-${s.title}`)},{default:d(()=>[$(o,{class:"rounded-tag max-w-full",color:s.color},{default:d(()=>[g("span",{style:q({color:e(A).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(A).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-small"},[$(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[P(_(s.title),1)]),default:d(()=>[g("span",Ye,_(s.title),1)]),_:2},1024)],4)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128))]),_:1},8,["value","disabled"]),e(u)?(f(),S("div",{key:0,class:"inline-block px-2 pt-2 cursor-pointer text-xs text-gray-500 hover:text-gray-800",onClick:l[2]||(l[2]=s=>u.value="")},_(t.$t("labels.clearSelection")),1)):z("",!0)])):(f(),S(T,{key:1},[e(b)||e(V)?(f(),M(r,{key:1,ref_key:"aselect",ref:O,value:e(u),"onUpdate:value":l[4]||(l[4]=s=>le(u)?u.value=s:null),class:E(["w-full overflow-hidden",{"caret-transparent":!e(F)}]),"allow-clear":!e(n).rqd&&e(h),bordered:!1,open:e(c)&&e(h),disabled:e(N)||!e(h),"show-search":!e(U)&&e(c)&&e(b),"show-arrow":e(F)&&!e(N)&&e(b)&&(e(u)===null||e(u)===void 0),"dropdown-class-name":`nc-dropdown-single-select-cell !min-w-156px ${e(c)&&e(b)?"active":""}`,"dropdown-match-select-width":!0,onSelect:me,onKeydown:l[5]||(l[5]=s=>pe(s)),onSearch:fe,onBlur:l[6]||(l[6]=s=>c.value=!1),onFocus:we},{default:d(()=>[(f(!0),S(T,null,te(e(m),s=>(f(),M(a,{key:s.title,value:s.title,"data-testid":`select-option-${e(n).title}-${t.rowIndex}`,class:E(`nc-select-option-${e(n).title}-${s.title}`),onClick:l[3]||(l[3]=D(()=>{},["stop"]))},{default:d(()=>[$(o,{class:"rounded-tag max-w-full",color:s.color},{default:d(()=>[g("span",{style:q({color:e(A).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(A).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:E({"text-sm":e(j),"text-small":!e(j)})},[$(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[P(_(s.title),1)]),default:d(()=>[g("span",Xe,_(s.title),1)]),_:2},1024)],6)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128)),e(x)&&e(ue)&&e(J)?(f(),M(a,{key:e(x),value:e(x)},{default:d(()=>[g("div",et,[(f(),M(je(("iconMap"in t?t.iconMap:e(Be)).plusThick),{class:"min-w-4"})),g("div",tt,[P(_(t.$t("msg.selectOption.createNewOptionNamed"))+" ",1),g("strong",null,_(e(x)),1)])])]),_:1},8,["value"])):z("",!0)]),_:1},8,["value","class","allow-clear","open","disabled","show-search","show-arrow","dropdown-class-name"])):(f(),S("div",Ze,[e(I)?(f(),M(o,{key:0,class:"rounded-tag max-w-full",color:e(I).color},{default:d(()=>[g("span",{style:q({color:e(A).isReadable(e(I).color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(A).mostReadable(e(I).color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:E({"text-sm":e(j),"text-small":!e(j)})},[$(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[P(_(e(I).title),1)]),default:d(()=>[g("span",Je,_(e(I).title),1)]),_:1})],6)]),_:1},8,["color"])):z("",!0)]))],64))],42,Ge)}}}),wt=Te(lt,[["__scopeId","data-v-49ed29a2"]]);export{wt as default};
