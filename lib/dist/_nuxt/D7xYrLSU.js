const __vite__fileDeps=["./BB8CxuQU.js","./nEPQs079.js","./entry.B8GgT5QA.css","./EmojiPicker.B3qwzTNG.css","./DpXEfBz-.js","./CbdMPhrK.js","./BdTvFMnI.js","./Overlay.xLwTZrd0.css","./BfnA8LRy.js","./Dmq5P-i4.js","./COktFmkf.js","./View.B2EG4bUV.css","./z4KLlFmH.js","./C5BYtyuB.js","./CUBk7c72.js","./dOGNuwQe.js","./BMD-JIxU.js","./MenuItem.C7h59s4s.css","./COUq3J8q.js","./C5mABW8R.js","./Divider.DqtSqZhb.css","./C6cwFr3C.js","./Menu.CQ8GNWeI.css","./CNqbIxb7.js","./B4uVmeYG.js","./DLssrORw.js","./BThhIoag.js","./BDH4PFIz.js","./Tabs.DaLSLYpn.css","./CbkeA9B5.js","./Menu.CgrqNPiu.css","./BL1VErEj.js","./C9YMvA38.js","./PSQ-jHmz.js","./DVn-P6yh.js","./CZJAloFU.js","./BzWD3wIg.js","./5fs2TD9N.js","./BTGvCRQH.js","./DYYbRAhI.js","./BdIpmjdG.js","./ByzT15Y-.js","./BQQOEPN4.js","./DKtVUO_j.js","./DzMAdbS0.js","./QHUCxglU.js","./aeo6qQdl.js","./B_JbMc-D.js","./kFoqhian.js","./Nsvr85os.js","./BLe4UTYD.js","./CXv9SGY2.js","./CFgyk-dW.js","./BaseLogo.BjMH04Ym.css","./CF0GO8gh.js","./Gr6cVSxP.js","./DeleteModal.SEMJ_gSK.css","./B00EKCmm.js","./DQ9lOBun.js","./Crc5Dj5L.js","./BEhsxILe.js","./zSHtI0ZS.js","./DUhkN2eB.js","./QTd5iuHu.js","./Modal.BNzTaDgC.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as Ge,o as t,c as M,cF as $s,f as pe,as as st,at as ee,cG as Re,cH as ke,N as Ce,g as oe,O as je,P as e,b as s,w as o,d as q,t as w,R as Q,U as u,a as v,T as te,S as L,$ as Je,a2 as Ne,ap as Rt,cI as Qe,ai as Jt,ac as Ye,cJ as Aa,cK as yt,au as We,r as I,cL as qt,H as Ae,a_ as Ut,Q as le,an as ue,ao as Se,aH as ra,aI as Wa,L as ze,cB as qe,a6 as ca,cM as Qt,cN as At,cO as Is,cP as wt,cQ as qa,aj as Ja,F as Qa,cR as Ts,cS as Ds,aF as pt,A as Me,ag as zt,ad as Yt,aB as Ya,cT as gt,cU as la,i as xt,ba as Cs,ab as He,cV as Ss,n as De,cW as Vs,B as mt,bL as Oe,cX as da,cY as Gt,Y as me,cZ as xe,c_ as Xa,aG as ua,p as Za,e as es,av as vt,c$ as js,d0 as Ms,d1 as Ps,d2 as Ns,a9 as Es,Z as kt,a5 as ht,al as ye,am as pa,d3 as Bs,d4 as _t,aa as Ls,M as Os,ah as ts,d5 as as,d6 as ma,V as ss,W as Us,d7 as Rs,d8 as za,d9 as As,X as at,da as zs,bT as Gs,u as va,db as os,dc as Fs,cd as Ks,dd as Ga,de as Fa,df as Hs,dg as Ws,dh as qs,di as Js,aS as Qs,aA as Ka,dj as Ys,dk as Xs,cp as Zs,dl as eo,a3 as to,a4 as ao}from"./nEPQs079.js";import{_ as so}from"./ErW9827P.js";import{u as Xt}from"./DQ9lOBun.js";import{S as ns}from"./DhnetN0h.js";import"./COwQxOku.js";import{b as oo,a as no}from"./CZJAloFU.js";import"./BdIpmjdG.js";import{I as fa}from"./ByzT15Y-.js";import{F as ia}from"./BzWD3wIg.js";import{_ as ls}from"./5fs2TD9N.js";import{u as $t}from"./PSQ-jHmz.js";import{_ as lo,a as io,u as Ha,b as is,c as ro}from"./C9YMvA38.js";import{_ as It}from"./Gr6cVSxP.js";import{_ as ba}from"./C5mABW8R.js";import{C as _a}from"./BfnA8LRy.js";import{_ as co}from"./CbdMPhrK.js";import{_ as uo,u as po}from"./BKreNVWd.js";import{_ as Ft}from"./BMD-JIxU.js";import{_ as ya}from"./COUq3J8q.js";import{_ as mo}from"./Dwjx2BnM.js";import{u as Ue}from"./qMO8t_Go.js";import{_ as Zt}from"./C6cwFr3C.js";import{_ as Kt}from"./CNqbIxb7.js";import{S as rs}from"./C0-Qcoum.js";import{_ as vo}from"./B-1vRibT.js";import{_ as cs}from"./CF0GO8gh.js";import{_ as ds,a as fo,b as bo}from"./CbcaYvFy.js";import{_ as _o,C as yo}from"./BEsLTnUh.js";import{I as go}from"./4IZzm4r4.js";import{D as wo}from"./Crc5Dj5L.js";import{_ as xo}from"./DEj7mPxe.js";import{_ as ko}from"./BsAGBmQo.js";import{_ as ho}from"./Ds61NkMB.js";import{_ as $o}from"./BLh6tVRa.js";import{u as us}from"./C6tBkhoe.js";import"./C4eCLVVw.js";import"./BUcNRxMi.js";import"./DKtVUO_j.js";import"./DzMAdbS0.js";import"./BQQOEPN4.js";import"./COktFmkf.js";import"./QHUCxglU.js";import"./DYYbRAhI.js";import"./BTGvCRQH.js";import"./DVn-P6yh.js";import"./aeo6qQdl.js";import"./B_JbMc-D.js";import"./kFoqhian.js";import"./Nsvr85os.js";import"./BLe4UTYD.js";import"./CXv9SGY2.js";import"./CFgyk-dW.js";import"./Dmq5P-i4.js";import"./BdTvFMnI.js";import"./BkeU_HAH.js";import"./BThhIoag.js";import"./q2KABjd6.js";import"./CBZqTOye.js";import"./BQDKbNwe.js";import"./-QMWbHL6.js";import"./C3R8onno.js";const Io={},To={class:"flex flex-row flex-grow pl-0.5 pr-1 py-0.5 rounded-md w-full",style:{"max-width":"calc(100% - 2.5rem)"}},Do=$s('<div class="flex-grow min-w-20" data-v-144435fb><div data-testid="nc-workspace-menu" class="flex items-center nc-workspace-menu overflow-hidden py-1.25 pr-0.25 justify-center w-full ml-2" data-v-144435fb><a class="transition-all duration-200 transform w-24 min-w-10" href="#" target="_blank" rel="noopener noreferrer" data-v-144435fb><img alt="NocoDB" src="'+so+'" data-v-144435fb></a><div class="flex flex-grow" data-v-144435fb></div></div></div>',1),Co=[Do];function So(p,S){return t(),M("div",To,Co)}const Vo=Ge(Io,[["render",So],["__scopeId","data-v-144435fb"]]),jo=["data-workspace-title"],Mo={key:0,class:"flex flex-row items-center w-full"},Po=v("div",{class:"flex flex-grow min-w-1"},null,-1),No={class:"flex items-center text-inherit"},Eo={key:1,class:"flex flex-row items-center w-full mt-0.25 ml-2.5 gap-x-3"},Bo=pe({__name:"Header",setup(p){const S=st(),{isLeftSidebarOpen:c}=ee(Xt()),{activeWorkspace:i,isWorkspaceLoading:n}=ee(S),{activeViewTitleOrId:g}=ee(Re()),{activeTableId:B}=ee(ke()),{isMobileMode:R}=Ce(),V=oe(()=>!(R.value&&!g.value&&!B.value));return(y,a)=>{var D;const h=Vo,f=Je,b=Ne,N=Rt,E=ns,r=je("e");return t(),M("div",{class:"flex items-center nc-sidebar-header w-full border-b-1 border-gray-200 group md:px-2 md:py-1.2 xs:px-1 xs:py-1","data-workspace-title":(D=e(i))==null?void 0:D.title,style:{height:"var(--topbar-height)"}},[e(n)?(t(),M("div",Eo,[s(E,{active:!0,class:"!w-6 !h-6 !rounded overflow-hidden"}),s(E,{active:!0,class:"!w-40 !h-6 !rounded overflow-hidden"})])):(t(),M("div",Mo,[s(h),Po,s(N,{class:te(["flex",{"!opacity-100":!e(c)}]),placement:"bottom","hide-on-click":""},{title:o(()=>[q(w(e(c)?`${y.$t("title.hideSidebar")}`:`${y.$t("title.showSidebar")}`),1)]),default:o(()=>[e(V)?Q((t(),u(b,{key:0,type:e(R)?"secondary":"text",size:e(R)?"medium":"small",class:"nc-sidebar-left-toggle-icon !text-gray-700 !hover:text-gray-800 !xs:h-10.5 !xs:max-h-10.5 !xs:max-w-10.5 !md:hover:bg-gray-200",onClick:a[0]||(a[0]=l=>c.value=!e(c))},{default:o(()=>[v("div",No,[e(R)?(t(),u(f,{key:0,icon:"close"})):(t(),u(f,{key:1,icon:"doubleLeftArrow",class:te(["duration-150 transition-all !text-lg -mt-0.5 !text-gray-500/75",{"transform rotate-180":!e(c)}])},null,8,["class"]))])]),_:1},8,["type","size"])),[[r,["c:leftSidebar:hideToggle"]]]):L("",!0)]),_:1},8,["class"])]))],8,jo)}}}),Lo={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Oo=v("path",{fill:"currentColor",d:"m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"},null,-1),Uo=[Oo];function Ro(p,S){return t(),M("svg",Lo,[...Uo])}const Ao={name:"material-symbols-search",render:Ro},zo={class:"flex items-center gap-2"},Go=v("div",{class:"inline-flex gap-1 justify-center text-xs px-[8px] py-[1px] uppercase border-1 border-gray-300 rounded-md bg-slate-150 text-gray-500"},[v("kbd",{class:"text-[16px] mt-[0.5px]"},"âŒ˜"),v("kbd",{class:"!leading-4"},"K")],-1),Fo=pe({__name:"Header",setup(p){const{commandPalette:S}=Qe();return(c,i)=>{const n=Ao,g=Ne,B=je("e");return Q((t(),u(g,{type:"text",size:"xsmall",class:"nc-sidebar-top-button w-full !hover:bg-gray-200 !rounded-md !xs:hidden !h-7 my-0.5","data-testid":"nc-sidebar-search-btn",centered:!1,onClick:i[0]||(i[0]=R=>{var V;return(V=e(S))==null?void 0:V.open()})},{default:o(()=>[v("div",zo,[s(n,{class:"!h-3.9"}),q(" Quick Actions "),Go])]),_:1})),[[B,["c:quick-actions"]]])}}}),Ko={class:"flex flex-row items-center text-base text-gray-800"},Ho={class:"mt-1"},Wo={class:"flex flex-row justify-end mt-5 gap-x-2"},qo=pe({__name:"CreateProjectDlg",props:{modelValue:{type:Boolean},type:{}},emits:["update:modelValue"],setup(p,{emit:S}){const c=p,i=S,{t:n}=Jt(),g=Ye(c,"modelValue",i),B=Aa(()=>c.type??yt.DB),R=We(),{createProject:V}=R,{navigateToProject:y}=Ce(),{refreshCommandPalette:a}=Qe(),h=[{required:!0,message:n("msg.info.dbNameRequired")},oo],f=I(),b=I({title:"",meta:{iconColor:qt[Math.floor(Math.random()*1e3)%qt.length]}}),N=I(!1),E=async()=>{b.value.title&&(b.value.title=b.value.title.trim()),N.value=!0;try{const l=await V({type:B.value,title:b.value.title,meta:b.value.meta});y({baseId:l.id,type:B.value,workspaceId:"nc"}),g.value=!1}catch(l){ue.error(await Se(l))}finally{setTimeout(()=>{N.value=!1},500),a()}},r=I();Ae(g,async(l,d)=>{l===d&&!l||setTimeout(async()=>{var x,U,$,z,P;(x=f.value)==null||x.resetFields(),b.value={title:"Base",meta:{iconColor:qt[Math.floor(Math.random()*1e3)%qt.length]}},await Ut(),($=(U=r.value)==null?void 0:U.$el)==null||$.focus(),(P=(z=r.value)==null?void 0:z.$el)==null||P.select()},5)});const D=Aa(()=>{switch(B.value){case yt.DB:default:return"Base"}});return(l,d)=>{const x=ra,U=fa,$=ls,z=ia,P=Ne,H=Wa,O=je("e");return t(),u(H,{visible:e(g),"onUpdate:visible":d[2]||(d[2]=k=>le(g)?g.value=k:null),size:"small","show-separator":!1},{header:o(()=>[v("div",Ko,[s(x,{color:e(b).meta.iconColor,type:e(B),class:"mr-2.5 !text-lg !h-4"},null,8,["color","type"]),q(" "+w(l.$t("general.createEntity",{entity:e(D)})),1)])]),default:o(()=>[v("div",Ho,[s(z,{ref_key:"form",ref:f,model:e(b),name:"basic",layout:"vertical",class:"w-full !mx-auto","no-style":"",autocomplete:"off",onFinish:E},{default:o(()=>[s($,{name:"title",rules:h,class:"!mb-0"},{default:o(()=>[s(U,{ref_key:"input",ref:r,value:e(b).title,"onUpdate:value":d[0]||(d[0]=k=>e(b).title=k),name:"title",class:"nc-metadb-base-name nc-input-sm nc-input-shadow",placeholder:"Title"},null,8,["value"])]),_:1})]),_:1},8,["model"]),v("div",Wo,[s(P,{type:"secondary",size:"small",onClick:d[1]||(d[1]=k=>g.value=!1)},{default:o(()=>[q(w(l.$t("general.cancel")),1)]),_:1}),Q((t(),u(P,{"data-testid":"docs-create-proj-dlg-create-btn",loading:e(N),type:"primary",size:"small",label:`${l.$t("general.create")} ${e(D)}`,"loading-label":`${l.$t("general.creating")} ${e(D)}`,onClick:E},{loading:o(()=>[q(w(l.$t("general.creatingEntity",{entity:e(D)})),1)]),default:o(()=>[q(w(l.$t("general.createEntity",{entity:e(D)}))+" ",1)]),_:1},8,["loading","label","loading-label"])),[[O,["a:base:create"]]])])])]),_:1},8,["visible"])}}}),ga=Ge(qo,[["__scopeId","data-v-8f24b62a"]]),Jo=pe({__name:"CreateProjectBtn",props:{activeWorkspaceId:{},modal:{type:Boolean},type:{},isOpen:{type:Boolean},size:{},centered:{type:Boolean}},setup(p){const S=p,{isUIAllowed:c}=ze(),{orgRoles:i,workspaceRoles:n}=ze(),g=qe(),{isSharedBase:B}=ee(g),R=st();ee(R);const V=I(!1),y=oe(()=>S.size||"small"),a=oe(()=>S.centered??!0);return(h,f)=>{const b=ga,N=Ne,E=je("e");return e(c)("baseCreate",{roles:e(n)??e(i)})&&!e(B)?Q((t(),u(N,{key:0,type:"text",size:e(y),centered:e(a),onClick:f[1]||(f[1]=r=>V.value=!0)},{default:o(()=>[ca(h.$slots,"default"),s(b,{modelValue:e(V),"onUpdate:modelValue":f[0]||(f[0]=r=>le(V)?V.value=r:null)},null,8,["modelValue"])]),_:3},8,["size","centered"])),[[E,["c:base:create"]]]):L("",!0)}}}),Qo={key:0,class:"flex flex-col w-full gap-y-3.75 ml-3 mt-3.75"},Yo={key:0,class:"flex flex-row items-center w-full gap-x-3"},Xo={class:"flex flex-row items-center w-full gap-x-3"},Zo={class:"flex flex-row items-center w-full gap-x-3"},en={key:1,class:"xs:hidden flex flex-col p-1 mt-0.25 mb-0.5 truncate"},tn={class:"gap-x-2 flex flex-row w-full items-center !font-normal"},an={class:"flex"},sn=pe({__name:"TopSection",setup(p){const S=st(),c=qe(),{isUIAllowed:i}=ze(),{appInfo:n}=Ce(),{meta:g,control:B}=Qt(),{isWorkspaceLoading:R,isWorkspaceSettingsPageOpened:V}=ee(S),{navigateToWorkspaceSettings:y}=S,{isSharedBase:a}=ee(c),h=I(!1),f=()=>{const b=At()?g.value:B.value;y("",b)};return(b,N)=>{const E=ns,r=Fo,D=Je,l=Ne,d=Jo,x=je("e");return e(R)?(t(),M("div",Qo,[e(n).ee?(t(),M("div",Yo,[s(E,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),s(E,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})])):L("",!0),v("div",Xo,[s(E,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),s(E,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})]),v("div",Zo,[s(E,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),s(E,{active:!0,class:"!w-40 !h-4 !rounded overflow-hidden"})])])):e(a)?L("",!0):(t(),M("div",en,[s(r),e(i)("workspaceSettings")?Q((t(),u(l,{key:0,type:"text",size:"xsmall",class:te(["nc-sidebar-top-button !xs:hidden my-0.5 !h-7",{"!text-brand-600 !bg-brand-50 !hover:bg-brand-50":e(V),"!hover:bg-gray-200 !hover:text-gray-700":!e(V)}]),"data-testid":"nc-sidebar-team-settings-btn",centered:!1,onClick:f},{default:o(()=>[v("div",{class:te(["flex items-center gap-2",{"font-semibold":e(V)}])},[s(D,{icon:"settings",class:"!h-4"}),v("div",null,w(b.$t("title.teamAndSettings")),1)],2)]),_:1},8,["class"])),[[x,["c:team:settings"]]]):L("",!0),s(d,{"is-open":e(h),"onUpdate:isOpen":N[0]||(N[0]=U=>le(h)?h.value=U:null),modal:"",type:"text",class:"nc-sidebar-top-button !hover:bg-gray-200 !hover:text-gray-700 !xs:hidden !h-7 my-0.5","data-testid":"nc-sidebar-create-base-btn"},{default:o(()=>[v("div",tn,[s(D,{icon:"plus"}),v("div",an,w(b.$t("title.createBase")),1)])]),_:1},8,["is-open"])]))}}}),on=Ge(sn,[["__scopeId","data-v-dd22f8df"]]),nn={class:"flex flex-row items-center gap-x-2"},ln={class:"mt-1"},rn={class:"flex flex-row justify-end gap-x-2 mt-5"},cn=pe({__name:"TableRename",props:{modelValue:{type:Boolean},tableMeta:{},sourceId:{}},emits:["update:modelValue","updated"],setup(p,{emit:S}){const c=Is(p,["tableMeta","sourceId"]),i=S,{$e:n,$api:g}=Me(),{setMeta:B}=wt(),R=Ye(c,"modelValue",i),{updateTab:V}=$t(),{loadProjectTables:y}=ke(),a=qe(),{loadTables:h,isMysql:f,isMssql:b,isPg:N}=a,{tables:E,base:r}=ee(a),{allRecentViews:D}=ee(Re()),{refreshCommandPalette:l}=Qe(),{addUndo:d,defineProjectScope:x}=qa(),U=I(),$=I(!1),z=ia.useForm,P=Ja({title:""}),H=oe(()=>({title:[no,{validator:(T,j)=>new Promise((A,G)=>{var Y;let re=255;if(f(p.sourceId)?re=64:N(p.sourceId)?re=63:b(p.sourceId)&&(re=128),((((Y=r==null?void 0:r.value)==null?void 0:Y.prefix)||"")+j).length>re)return G(new Error(`Table name exceeds ${re} characters`));A()})},{validator:(T,j)=>new Promise((A,G)=>{if(!((E==null?void 0:E.value)||[]).every(re=>re.id===p.tableMeta.id||re.title.toLowerCase()!==((j==null?void 0:j.trim())||"").toLowerCase()))return G(new Error("Duplicate table alias"));A()})}]})),{validateInfos:O}=z(P,H);Qa(()=>{var T;(T=p.tableMeta)!=null&&T.title&&(P.title=`${p.tableMeta.title}`),Ut(()=>{var A;const j=(A=U.value)==null?void 0:A.$el;j&&(j.setSelectionRange(0,P.title.length),j.focus())})},{flush:"post"});const k=async(T=!1,j)=>{if(p.tableMeta&&(P.title&&(P.title=P.title.trim()),!(P.title===p.tableMeta.title&&!j))){$.value=!0;try{await g.dbTable.update(p.tableMeta.id,{base_id:p.tableMeta.base_id,table_name:P.title,title:P.title}),R.value=!1,await y(p.tableMeta.base_id,!0),T||d({redo:{fn:G=>{P.title=G,k(!0,!0)},args:[P.title]},undo:{fn:G=>{P.title=G,k(!0,!0)},args:[p.tableMeta.title]},scope:x({model:p.tableMeta})}),await h(),D.value=D.value.map(G=>(G.tableID===p.tableMeta.id&&(G.isDefault&&(G.viewName=P.title),G.tableName=P.title),G));const A=await g.dbTable.read(p.tableMeta.id);await B(A),V({id:p.tableMeta.id},{title:A.title}),l(),n("a:table:rename"),R.value=!1}catch(A){ue.error(await Se(A))}$.value=!1}};return(T,j)=>{const A=Je,G=fa,re=ls,K=ia,Y=Ne,ce=Wa;return t(),u(ce,{visible:e(R),"onUpdate:visible":j[4]||(j[4]=fe=>le(R)?R.value=fe:null),size:"small","show-separator":!1},{header:o(()=>[v("div",nn,[s(A,{icon:"rename"}),q(" "+w(T.$t("activity.renameTable")),1)])]),default:o(()=>{var fe;return[v("div",ln,[s(K,{model:e(P),name:"create-new-table-form"},{default:o(()=>[s(re,Ts(Ds(e(O).title)),{default:o(()=>[s(G,{ref_key:"inputEl",ref:U,value:e(P).title,"onUpdate:value":j[0]||(j[0]=he=>e(P).title=he),class:"nc-input-sm nc-input-shadow","hide-details":"",size:"small",placeholder:T.$t("msg.info.enterTableName"),onKeydown:j[1]||(j[1]=pt(()=>k(),["enter"]))},null,8,["value","placeholder"])]),_:1},16)]),_:1},8,["model"]),v("div",rn,[s(Y,{type:"secondary",size:"small",onClick:j[2]||(j[2]=he=>R.value=!1)},{default:o(()=>[q(w(T.$t("general.cancel")),1)]),_:1}),s(Y,{key:"submit",type:"primary",size:"small",disabled:e(O).title.validateStatus==="error"||((fe=e(P).title)==null?void 0:fe.trim())===T.tableMeta.title,label:"Rename Table","loading-label":"Renaming Table",loading:e($),onClick:j[3]||(j[3]=()=>k())},{loading:o(()=>[q(w(T.$t("title.renamingTable")),1)]),default:o(()=>[q(w(T.$t("title.renameTable"))+" ",1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),dn={class:"mt-5"},un={class:"prose-md self-center text-gray-500 mt-4"},pn={class:"text-xs p-2"},mn={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},vn=pe({__name:"TableDuplicate",props:{modelValue:{type:Boolean},table:{}},emits:["update:modelValue"],setup(p,{emit:S}){const c=p,i=S,{api:n}=zt(),g=Ye(c,"modelValue",i),{addTab:B}=$t(),{$e:R,$poller:V}=Me();We();const{openTable:y}=ke(),a=qe(),{loadTables:h}=a,{tables:f}=ee(a),{getMeta:b}=wt(),{t:N}=Jt();ee(ke());const{refreshCommandPalette:E}=Qe(),r=I({includeData:!0,includeViews:!0,includeHooks:!0}),D=oe(()=>{const{includeData:U,includeViews:$,includeHooks:z}=r.value;return{excludeData:!U,excludeViews:!$,excludeHooks:!z}}),l=I(!1),d=async()=>{try{l.value=!0;const U=await n.dbTable.duplicate(c.table.base_id,c.table.id,{options:D.value});V.subscribe({id:U.id},async $=>{var z;if($.status!=="close")if($.status===gt.COMPLETED){const P=await b(c.table.id);if(P){for(const O of P.columns||[])if([la.Links,la.LinkToAnotherRecord].includes(O.uidt)&&O&&O.colOptions){const k=(z=O.colOptions)==null?void 0:z.fk_related_model_id;k&&await b(k,!0)}}await h(),E();const H=f.value.find(O=>{var k,T;return O.id===((T=(k=$==null?void 0:$.data)==null?void 0:k.result)==null?void 0:T.id)});H&&B({title:H.title,id:H.id,type:H.type}),y(H),l.value=!1,g.value=!1}else $.status===gt.FAILED&&(ue.error(N("msg.error.failedToDuplicateTable")),await h(),l.value=!1,g.value=!1)}),R("a:table:duplicate")}catch(U){ue.error(await Se(U)),l.value=!1,g.value=!1}};Yt("Enter",()=>{g.value&&d()});const x=I(!1);return(U,$)=>{const z=ba,P=_a,H=Ne,O=It,k=je("e");return t(),u(O,{visible:e(g),"onUpdate:visible":$[5]||($[5]=T=>le(g)?g.value=T:null),class:te([{active:e(g)},"!w-[30rem]"]),"mask-closable":!e(l),keyboard:!e(l),centered:"","wrap-class-name":"nc-modal-table-duplicate",footer:null,onKeydown:$[6]||($[6]=pt(T=>g.value=!1,["esc"]))},{default:o(()=>[v("div",null,[v("div",{class:"font-medium text-lg text-gray-800 self-center",onDblclick:$[0]||($[0]=T=>x.value=!e(x))},w(U.$t("general.duplicate"))+" "+w(U.$t("objects.table")),33),v("div",dn,w(U.$t("msg.warning.duplicateTable")),1),v("div",un,w(U.$t("title.advancedSettings")),1),s(z,{class:"!m-0 !p-0 !my-2"}),v("div",pn,[s(P,{checked:e(r).includeData,"onUpdate:checked":$[1]||($[1]=T=>e(r).includeData=T),disabled:e(l)},{default:o(()=>[q(w(U.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"]),s(P,{checked:e(r).includeViews,"onUpdate:checked":$[2]||($[2]=T=>e(r).includeViews=T),disabled:e(l)},{default:o(()=>[q(w(U.$t("labels.includeView")),1)]),_:1},8,["checked","disabled"]),Q(s(P,{checked:e(r).includeHooks,"onUpdate:checked":$[3]||($[3]=T=>e(r).includeHooks=T),disabled:e(l)},{default:o(()=>[q(w(U.$t("labels.includeWebhook")),1)]),_:1},8,["checked","disabled"]),[[Ya,e(x)]])])]),v("div",mn,[e(l)?L("",!0):(t(),u(H,{key:"back",type:"secondary",size:"small",onClick:$[4]||($[4]=T=>g.value=!1)},{default:o(()=>[q(w(U.$t("general.cancel")),1)]),_:1})),Q((t(),u(H,{key:"submit",type:"primary",size:"small",loading:e(l),onClick:d},{default:o(()=>[q(w(U.$t("general.confirm")),1)]),_:1},8,["loading"])),[[k,["a:table:duplicate"]]])])]),_:1},8,["visible","class","mask-closable","keyboard"])}}}),fn={class:"h-[80vh]"},bn=pe({__name:"ProjectErd",props:{baseId:{},sourceId:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(p,{emit:S}){const c=p,n=Ye(c,"modelValue",S),g=oe(()=>c.sourceId),{openedProject:B}=ee(We()),{baseTables:R}=ee(ke()),{loadProjectTables:V}=ke(),y=I(!0),{getMeta:a}=wt(),h=oe(()=>{var f;return c.baseId||((f=B.value)==null?void 0:f.id)});return xt(async()=>{if(h.value&&R.value.get(h.value))return y.value=!1;try{await V(h.value),await Promise.all(R.value.get(h.value).map(async f=>{await a(f.id,!1,!1,h.value)}))}catch(f){console.error(f)}finally{y.value=!1}}),(f,b)=>{const N=co,E=It;return t(),u(E,{visible:e(n),"onUpdate:visible":b[0]||(b[0]=r=>le(n)?n.value=r:null),size:"large"},{default:o(()=>[v("div",fn,[e(y)?L("",!0):(t(),u(N,{key:0,"source-id":e(g),"base-id":e(h),"show-all-columns":!1},null,8,["source-id","base-id"]))])]),_:1},8,["visible"])}}}),_n={class:"p-6 h-full"},yn=pe({__name:"ProjectAudit",props:{workspaceId:{},baseId:{},sourceId:{},modelValue:{type:Boolean},bordered:{type:Boolean}},emits:["update:modelValue"],setup(p,{emit:S}){const c=p,n=Ye(c,"modelValue",S),{workspaceId:g,sourceId:B,bordered:R}=Cs(c),{openedProject:V}=ee(We()),{baseTables:y}=ee(ke()),{loadProjectTables:a}=ke(),h=I(!0),{getMeta:f}=wt(),b=oe(()=>{var N;return c.baseId||((N=V.value)==null?void 0:N.id)});return xt(async()=>{if(b.value&&y.value.get(b.value))return h.value=!1;try{await a(b.value),await Promise.all(y.value.get(b.value).map(async N=>{await f(N.id,!1,!1,b.value)}))}catch(N){ue.error("Failed to load tables/bases. Please try again later."),console.error(N)}finally{h.value=!1}}),(N,E)=>{const r=uo,D=It;return t(),u(D,{visible:e(n),"onUpdate:visible":E[0]||(E[0]=l=>le(n)?n.value=l:null),size:"xl",class:"!top-[5vh] lg:!max-w-[calc(100vw_-_64px)]",width:"96.95rem"},{default:o(()=>[v("div",_n,[e(h)?L("",!0):(t(),u(r,{key:0,"workspace-id":e(g),"source-id":e(B),"base-id":e(b),bordered:e(R)},null,8,["workspace-id","source-id","base-id","bordered"]))])]),_:1},8,["visible"])}}}),gn={class:"flex gap-2 items-center"},wn={class:"ml-0.5"},xn={class:"flex gap-2 items-center"},kn={class:"flex gap-2 items-center"},hn={class:"flex gap-2 items-center"},$n=pe({__name:"BaseOptions",props:{source:{},base:{}},setup(p){const S=p,c=He(S,"source"),i=He(S,"base"),{isUIAllowed:n}=ze(),g=oe(()=>i.value.project_role||i.value.workspace_role),{$e:B}=Me();function R(y,a){if(!y||!a)return;B("a:actions:import-airtable");const h=I(!0),{close:f}=Ue(lo,{modelValue:h,baseId:y,sourceId:a,"onUpdate:modelValue":b});function b(){h.value=!1,f(1e3)}}function V(y){var b;if(!((b=c.value)!=null&&b.id)||!c.value.base_id)return;B(`a:actions:import-${y}`);const a=I(!0),{close:h}=Ue(io,{modelValue:a,importType:y,baseId:c.value.base_id,sourceId:c.value.id,"onUpdate:modelValue":f});function f(){a.value=!1,h(1e3)}}return(y,a)=>{const h=Je,f=Ft,b=mo,N=je("e");return t(),u(b,{class:"py-0","data-testid":"nc-sidebar-base-import"},{title:o(()=>[s(h,{icon:"download"}),q(" "+w(y.$t("labels.importData")),1)]),expandIcon:o(()=>[]),default:o(()=>[e(n)("airtableImport",{roles:e(g),source:e(c)})?(t(),u(f,{key:"quick-import-airtable",onClick:a[0]||(a[0]=E=>R(e(c).base_id,e(c).id))},{default:o(()=>[Q((t(),M("div",gn,[s(h,{icon:"airtable",class:"max-w-3.75 group-hover:text-black"}),v("div",wn,w(y.$t("labels.airtable")),1)])),[[N,["c:import:airtable"]]])]),_:1})):L("",!0),e(n)("csvImport",{roles:e(g),source:e(c)})?(t(),u(f,{key:"quick-import-csv",onClick:a[1]||(a[1]=E=>V("csv"))},{default:o(()=>[Q((t(),M("div",xn,[s(h,{icon:"csv",class:"w-4 group-hover:text-black"}),q(" "+w(y.$t("labels.csvFile")),1)])),[[N,["c:import:csv"]]])]),_:1})):L("",!0),e(n)("jsonImport",{roles:e(g),source:e(c)})?(t(),u(f,{key:"quick-import-json",onClick:a[2]||(a[2]=E=>V("json"))},{default:o(()=>[Q((t(),M("div",kn,[s(h,{icon:"code",class:"w-4 group-hover:text-black"}),q(" "+w(y.$t("labels.jsonFile")),1)])),[[N,["c:import:json"]]])]),_:1})):L("",!0),e(n)("excelImport",{roles:e(g),source:e(c)})?(t(),u(f,{key:"quick-import-excel",onClick:a[3]||(a[3]=E=>V("excel"))},{default:o(()=>[Q((t(),M("div",hn,[s(h,{icon:"excel",class:"max-w-4 group-hover:text-black"}),q(" "+w(y.$t("labels.microsoftExcel")),1)])),[[N,["c:import:excel"]]])]),_:1})):L("",!0)]),_:1})}}}),In={key:0,class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700"},Tn={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},ps=pe({__name:"TableDelete",props:{visible:{type:Boolean},tableId:{},baseId:{}},emits:["update:visible"],setup(p,{emit:S}){const c=p,n=Ye(c,"visible",S),{$e:g,$api:B}=Me(),{closeTab:R}=$t(),{getMeta:V,removeMeta:y}=wt(),{loadTables:a,baseUrl:h,isXcdbBase:f}=qe(),{refreshCommandPalette:b}=Qe(),{removeFromRecentViews:N}=Re(),{baseTables:E,activeTable:r}=ee(ke()),{openTable:D}=ke(),l=oe(()=>E.value.get(c.baseId)??[]),d=oe(()=>l.value.find($=>$.id===c.tableId)),x=I(!1),U=async()=>{var P,H;if(!d.value)return;const $=JSON.parse(JSON.stringify(d.value)),z=(P=r.value)==null?void 0:P.id;x.value=!0;try{const O=await V($.id,!0),k=(H=O==null?void 0:O.columns)==null?void 0:H.filter(j=>j.uidt===la.LinkToAnotherRecord&&!Ss(j));if(k!=null&&k.length&&!f($.source_id)){const j=await Promise.all(k.map(async(A,G)=>{var K;const re=await V((K=A==null?void 0:A.colOptions)==null?void 0:K.fk_related_model_id);return`${G+1}. ${A.title} is a LinkToAnotherRecord of ${re&&re.title||A.title}`}));ue.info(De("div",{innerHTML:`<div style="padding:10px 4px">Unable to delete tables because of the following.
              <br><br>${j.join("<br>")}<br><br>
              Delete them & try again</div>`}));return}if(await B.dbTable.delete($.id),await R({type:Vs.TABLE,id:$.id,title:$.title}),await a(),N({baseId:c.baseId,tableId:$.id}),y($.id),b(),g("a:table:delete"),z===$.id){const j=l.value.filter(A=>A.source_id===$.source_id);j.length===0?await mt(h({id:c.baseId,type:"database"})):await D(j[0])}const T=l.value.findIndex(j=>j.id===$.id);T>-1&&l.value.splice(T,1),n.value=!1}catch(O){ue.error(await Se(O))}finally{x.value=!1}};return($,z)=>{const P=vo,H=cs;return t(),u(H,{visible:e(n),"onUpdate:visible":z[0]||(z[0]=O=>le(n)?n.value=O:null),"entity-name":$.$t("objects.table"),"on-delete":U},{"entity-preview":o(()=>[e(d)?(t(),M("div",In,[s(P,{meta:e(d),class:"nc-view-icon"},null,8,["meta"]),v("div",Tn,w(e(d).title),1)])):L("",!0)]),_:1},8,["visible","entity-name"])}}}),ea=p=>(Za("data-v-15851779"),p=p(),es(),p),Dn={class:"item","data-testid":"sidebar-view-create-grid"},Cn={class:"item-inner"},Sn=ea(()=>v("div",null,"Grid",-1)),Vn={class:"item","data-testid":"sidebar-view-create-form"},jn={class:"item-inner"},Mn=ea(()=>v("div",null,"Form",-1)),Pn={class:"item","data-testid":"sidebar-view-create-gallery"},Nn={class:"item-inner"},En=ea(()=>v("div",null,"Gallery",-1)),Bn={class:"item"},Ln={class:"item-inner"},On=ea(()=>v("div",null,"Kanban",-1)),Un={class:"item"},Rn={class:"item-inner"},An=pe({__name:"CreateViewBtn",props:{alignLeftLevel:{},source:{}},setup(p){const S=p,{$e:c}=Me(),i=He(S,"alignLeftLevel"),{refreshCommandPalette:n}=Qe(),g=Re(),{loadViews:B,navigateToView:R}=g,V=Oe(da),y=Oe(Gt),a=I(!1),h=I(),f=I(!1),b=oe(()=>i.value===1?"nc-view-create-dropdown nc-view-create-dropdown-left-1":i.value===2?"nc-view-create-dropdown nc-view-create-dropdown-left-2":"nc-view-create-dropdown");async function N({title:E="",type:r,copyViewId:D,groupingFieldColumnId:l,calendarRange:d,coverImageColumnId:x}){if(a.value)return;h.value=r,a.value=!0,await B({tableId:V.value.id}),f.value=!1,a.value=!1;const U=I(!0),{close:$}=Ue(ds,{modelValue:U,title:E,type:r,tableId:V.value.id,selectedViewId:D,calendarRange:d,groupingFieldColumnId:l,coverImageColumnId:x,"onUpdate:modelValue":z,onCreated:async P=>{z(),n(),await B({tableId:V.value.id,force:!0}),V.value.meta={...V.value.meta,hasNonDefaultViews:!0},R({view:P,tableId:V.value.id,baseId:y.value.id,doNotSwitchTab:!0}),c("a:view:create",{view:P.type})}});function z(){f.value=!1,U.value=!1,$(1e3)}}return(E,r)=>{const D=Xa,l=ua,d=Je,x=Ft,U=Zt,$=Kt;return t(),u($,{visible:e(f),"onUpdate:visible":r[5]||(r[5]=z=>le(f)?f.value=z:null),"overlay-class-name":e(b),"destroy-popup-on-hide":"",onClick:r[6]||(r[6]=me(z=>f.value=!0,["stop"]))},{overlay:o(()=>[s(U,{class:"max-w-48"},{default:o(()=>[s(x,{onClick:r[0]||(r[0]=me(z=>N({type:e(xe).GRID}),["stop"]))},{default:o(()=>[v("div",Dn,[v("div",Cn,[s(D,{meta:{type:e(xe).GRID}},null,8,["meta"]),Sn]),e(h)===e(xe).GRID&&e(a)?(t(),u(l,{key:0})):(t(),u(d,{key:1,class:"plus",icon:"plus"}))])]),_:1}),E.source.is_schema_readonly?L("",!0):(t(),u(x,{key:0,onClick:r[1]||(r[1]=z=>N({type:e(xe).FORM}))},{default:o(()=>[v("div",Vn,[v("div",jn,[s(D,{meta:{type:e(xe).FORM}},null,8,["meta"]),Mn]),e(h)===e(xe).FORM&&e(a)?(t(),u(l,{key:0})):(t(),u(d,{key:1,class:"plus",icon:"plus"}))])]),_:1})),s(x,{onClick:r[2]||(r[2]=z=>N({type:e(xe).GALLERY}))},{default:o(()=>[v("div",Pn,[v("div",Nn,[s(D,{meta:{type:e(xe).GALLERY}},null,8,["meta"]),En]),e(h)===e(xe).GALLERY&&e(a)?(t(),u(l,{key:0})):(t(),u(d,{key:1,class:"plus",icon:"plus"}))])]),_:1}),s(x,{"data-testid":"sidebar-view-create-kanban",onClick:r[3]||(r[3]=z=>N({type:e(xe).KANBAN}))},{default:o(()=>[v("div",Bn,[v("div",Ln,[s(D,{meta:{type:e(xe).KANBAN}},null,8,["meta"]),On]),e(h)===e(xe).KANBAN&&e(a)?(t(),u(l,{key:0})):(t(),u(d,{key:1,class:"plus",icon:"plus"}))])]),_:1}),s(x,{"data-testid":"sidebar-view-create-calendar",onClick:r[4]||(r[4]=z=>N({type:e(xe).CALENDAR}))},{default:o(()=>[v("div",Un,[v("div",Rn,[s(D,{meta:{type:e(xe).CALENDAR},class:"!w-4 !h-4"},null,8,["meta"]),v("div",null,w(E.$t("objects.viewType.calendar")),1)]),e(h)===e(xe).CALENDAR&&e(a)?(t(),u(l,{key:0})):(t(),u(d,{key:1,class:"plus",icon:"plus"}))])]),_:1})]),_:1})]),default:o(()=>[ca(E.$slots,"default",{},void 0,!0)]),_:3},8,["visible","overlay-class-name"])}}}),zn=Ge(An,[["__scopeId","data-v-15851779"]]),ms=p=>p.is_meta,Gn=kt(()=>ht(()=>import("./BB8CxuQU.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(p=>p.default||p)),Fn={class:"text-sm flex items-center w-full gap-1","data-testid":"view-item"},Kn=["data-testid"],Hn=pe({__name:"ViewsNode",props:{view:{},table:{},onValidate:{type:Function}},emits:["update:view","selectIcon","changeView","rename","delete","openModal"],setup(p,{emit:S}){const c=p,i=S,n=Ye(c,"view",i),{$e:g}=Me(),{isMobileMode:B}=Ce(),{isUIAllowed:R}=ze(),V=Oe(Gt,I()),{activeView:y}=ee(Re()),{getMeta:a}=wt(),{meta:h,control:f}=Qt(),b=oe(()=>c.table),N=I(b.value);vt(js,n),vt(Ms,N);const E=Oe(Ps,I(!1)),r=oe(()=>{var Y,ce,fe,he;if(((ce=(Y=V.value)==null?void 0:Y.sources)==null?void 0:ce.length)===1)return!0;const K=(he=(fe=V.value)==null?void 0:fe.sources)==null?void 0:he.find(Ve=>Ve.id===n.value.source_id);return K?ms(K):!1}),D=I(!1),l=I(!1),d=I(!1),x=I(),U=Ns(()=>{i("changeView",n.value)},250),$=()=>{if(l.value||d.value)return;(At()?h.value:f.value)?i("changeView",n.value):U()};function z(){var K;B.value||R("viewCreateOrEdit")&&(l.value||(l.value=!0,x.value=n.value.title,g("c:view:rename",{view:(K=n.value)==null?void 0:K.type})))}function P(K){K.key==="Escape"?O(K):K.key==="Enter"&&H(K)}function H(K){K.stopImmediatePropagation(),K.preventDefault(),j()}function O(K){K.stopImmediatePropagation(),K.preventDefault(),A()}Yt("Enter",K=>{l.value&&H(K)});const k=()=>{var K;B.value||!R("viewCreateOrEdit")||l.value||(l.value=!0,x.value=n.value.title,g("c:view:rename",{view:(K=n.value)==null?void 0:K.type}))},T=K=>K==null?void 0:K.focus();async function j(){if(D.value=!1,!l.value)return;x.value&&(x.value=x.value.trim());const K=c.onValidate({...n.value,title:x.value});if(K!==!0){ue.error(K),A();return}if(n.value.title===""||n.value.title===x.value){A();return}const Y=n.value.title;n.value.title=x.value||"",i("rename",n.value,Y),G()}function A(){l.value&&G()}function G(){d.value=!0,l.value=!1,x.value="",setTimeout(()=>{d.value=!1},250)}const re=()=>{D.value=!1,i("delete",n.value)};return Ae(D,async()=>{D.value&&(N.value=await a(b.value.id))}),(K,Y)=>{const ce=Xa,fe=Gn,he=fa,Ve=Rt,ot=Je,C=Ne,X=fo,ae=Kt,Z=Es,ve=je("e");return t(),u(Z,{class:te(["nc-sidebar-node !min-h-7 !max-h-7 !my-0.5 select-none group text-gray-700 !flex !items-center !hover:bg-gray-200 !hover:text-gray-700 cursor-pointer",{"!pl-13.5 !xs:pl-12":e(r),"!pl-19 ":!e(r)}]),"data-testid":`view-sidebar-view-${e(n).alias||e(n).title}`,onDblclick:me(z,["stop"]),onClick:me($,["prevent"])},{default:o(()=>{var be,ne,W;return[Q((t(),M("div",Fn,[Q((t(),M("div",{class:"flex min-w-6","data-testid":`view-sidebar-drag-handle-${e(n).alias||e(n).title}`},[s(fe,{class:"nc-table-icon",emoji:(ne=(be=c.view)==null?void 0:be.meta)==null?void 0:ne.icon,size:"small",clearable:!0,readonly:e(B)||!e(R)("viewCreateOrEdit"),onEmojiSelected:Y[0]||(Y[0]=F=>i("selectIcon",F))},{default:o(()=>[s(ce,{meta:c.view,class:"nc-view-icon w-4 !text-[16px]"},null,8,["meta"])]),_:1},8,["emoji","readonly"])],8,Kn)),[[ve,["c:view:emoji-picker"]]]),e(l)?(t(),u(he,{key:0,ref:T,value:e(x),"onUpdate:value":Y[1]||(Y[1]=F=>le(x)?x.value=F:null),class:te(["!bg-transparent !border-0 !ring-0 !outline-transparent !border-transparent !pl-0 !flex-1 mr-4",{"font-medium !text-brand-600":((W=e(y))==null?void 0:W.id)===e(n).id}]),onBlur:j,onKeydown:Y[2]||(Y[2]=me(F=>P(F),["stop"]))},null,8,["value","class"])):(t(),u(Ve,{key:1,class:"nc-sidebar-node-title text-ellipsis overflow-hidden select-none w-full","show-on-truncate-only":""},{title:o(()=>[q(w(e(n).alias||e(n).title),1)]),default:o(()=>{var F;return[v("div",{"data-testid":"sidebar-view-title",class:te({"font-medium text-brand-600":((F=e(y))==null?void 0:F.id)===e(n).id}),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},w(e(n).alias||e(n).title),3)]}),_:1})),!e(l)&&!e(E)?(t(),u(ae,{key:2,visible:e(D),"onUpdate:visible":Y[6]||(Y[6]=F=>le(D)?D.value=F:null),"overlay-class-name":"!rounded-lg"},{overlay:o(()=>[s(X,{"data-testid":`view-sidebar-view-actions-${e(n).alias||e(n).title}`,view:e(n),table:e(b),"in-sidebar":"",onCloseModal:Y[5]||(Y[5]=F=>D.value=!1),onRename:k,onDelete:re},null,8,["data-testid","view","table"])]),default:o(()=>[Q((t(),u(C,{type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn invisible !group-hover:visible !group-hover:opacity-100 nc-sidebar-view-node-context-btn",{"!visible !opacity-100":e(D)}]),onClick:Y[3]||(Y[3]=me(F=>D.value=!e(D),["stop"])),onDblclick:Y[4]||(Y[4]=me(()=>{},["stop"]))},{default:o(()=>[s(ot,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:1},8,["class"])),[[ve,["c:view:option"]]])]),_:1},8,["visible"])):L("",!0)])),[[ve,["a:view:open",{view:e(n).type}]]])]}),_:1},8,["class","data-testid"])}}}),Wn={class:"flex flex-row items-center pl-1.25 !py-1.5 text-inherit"},qn={class:"pl-1.75"},Jn=pe({__name:"ViewsList",emits:["openModal","deleted"],setup(p,{emit:S}){const c=S,i=Oe(Gt),n=Oe(da),{isLeftSidebarOpen:g}=ee(Xt()),{activeTableId:B}=ee(ke()),{isUIAllowed:R}=ze(),{isMobileMode:V}=Ce(),{$e:y}=Me(),{t:a}=Jt(),{viewsByTable:h,activeView:f,allRecentViews:b}=ee(Re()),{navigateToTable:N}=ke(),E=oe(()=>{var C;return((C=h.value.get(n.value.id))==null?void 0:C.filter(X=>!X.is_default))??[]}),{api:r}=zt(),{refreshCommandPalette:D}=Qe(),{addUndo:l,defineModelScope:d}=qa(),{navigateToView:x,loadViews:U,removeFromRecentViews:$}=Re(),z=I([]),P=I(!1),H=I(),O=I(!1);Ae(f,C=>{C&&C.id&&(z.value=[C.id])});function k(C){O.value=C,setTimeout(()=>{O.value=!1},300)}const T=oe(()=>{var C,X;return(X=(C=i.value)==null?void 0:C.sources)==null?void 0:X.find(ae=>ae.id===n.value.source_id)}),j=oe(()=>{var C,X;return((X=(C=i.value)==null?void 0:C.sources)==null?void 0:X.length)===1?!0:T.value?ms(T.value):!1});function A(C){return!C.title||C.title.trim().length<0?a("msg.error.viewNameRequired"):E.value.some(X=>X.title===C.title&&X.id!==C.id)?a("msg.error.viewNameDuplicate"):!0}let G;function re(C){C.stopImmediatePropagation(),C.preventDefault(),P.value=!0}async function K(C,X=!1){if(X||(C.stopImmediatePropagation(),C.preventDefault(),P.value=!1),E.value.length<2)return;let{newIndex:ae=0,oldIndex:Z=0}=C;if(ae=ae-1,Z=Z-1,ae===Z)return;X||l({redo:{fn:async()=>{const ge=G.toArray(),nt=ge.splice(Z,1);ge.splice(ae,0,nt[0]),G.sort(ge),await K(C,!0)},args:[]},undo:{fn:async()=>{const ge=G.toArray(),nt=ge.splice(ae,1);ge.splice(Z,0,nt[0]),G.sort(ge),await K({...C,oldIndex:ae,newIndex:Z},!0)},args:[]},scope:d({view:f.value})});const ve=Array.from(C.to.children);ve.shift();const be=ve[ae-1],ne=ve[ae+1],W=E.value.find(ge=>ge.id===C.item.id);if(!W||!W.id)return;const F=be?E.value.find(ge=>ge.id===be.id)??{order:0}:{order:0},_e=ne?E.value.find(ge=>ge.id===ne.id):{};let Pe;E.value.length-1===ae?Pe=parseFloat(String(F.order))+1:ae===0?Pe=parseFloat(String(_e.order))/2:Pe=(parseFloat(String(F.order))+parseFloat(String(_e.order)))/2;const Xe=isNaN(Number(Pe))?Z:Pe;W.order=Xe,await r.dbView.update(W.id,{order:Xe}),k(W.id),y("a:view:reorder")}const Y=C=>{G&&G.destroy(),!V.value&&(G=new rs(C,{ghostClass:"ghost",onStart:re,onEnd:K}))};xt(()=>H.value&&R("viewCreateOrEdit")&&Y(H.value.$el));async function ce(C){await x({view:C,tableId:n.value.id,baseId:i.value.id,hardReload:C.type===xe.FORM&&z.value[0]===C.id,doNotSwitchTab:!0}),V.value&&(g.value=!1)}async function fe(C,X,ae=!1){try{await r.dbView.update(C.id,{title:C.title,order:C.order}),x({view:C,tableId:n.value.id,baseId:i.value.id,hardReload:C.type===xe.FORM&&z.value[0]===C.id}),D(),ae||l({redo:{fn:(Z,ve)=>{const be=Z.title;Z.title=ve,fe(Z,be,!0)},args:[C,C.title]},undo:{fn:(Z,ve)=>{const be=Z.title;Z.title=ve,fe(Z,be,!0)},args:[C,X]},scope:d({view:f.value})}),b.value=b.value.map(Z=>(Z.viewId===C.id&&Z.tableID===C.fk_model_id&&(Z.viewName=C.title),Z))}catch(Z){ue.error(await Se(Z))}}function he(C){const X=I(!0),{close:ae}=Ue(bo,{modelValue:X,view:C,"onUpdate:modelValue":Z,onDeleted:async()=>{var be,ne;Z(),c("deleted"),$({viewId:C.id,tableId:C.fk_model_id,baseId:i.value.id}),D(),((be=f.value)==null?void 0:be.id)===C.id&&N({tableId:n.value.id,baseId:i.value.id}),await U({tableId:n.value.id,force:!0});const ve=((ne=h.value.get(n.value.id))==null?void 0:ne.filter(W=>!W.is_default))??[];n.value.meta={...n.value.meta,hasNonDefaultViews:ve.length>1}}});function Z(){X.value=!1,ae(1e3)}}const Ve=async(C,X)=>{try{X.meta={..._t(X.meta),icon:C},r.dbView.update(X.id,{meta:X.meta}),y("a:view:icon:sidebar",{icon:C})}catch(ae){ue.error(await Se(ae))}};function ot({title:C="",type:X,copyViewId:ae,groupingFieldColumnId:Z,calendarRange:ve,coverImageColumnId:be}){const ne=I(!0),{close:W}=Ue(ds,{modelValue:ne,title:C,type:X,tableId:n.value.id,selectedViewId:ae,groupingFieldColumnId:Z,views:E,calendarRange:ve,coverImageColumnId:be,"onUpdate:modelValue":F,onCreated:async _e=>{F(),D(),await U({force:!0,tableId:n.value.id}),x({view:_e,tableId:n.value.id,baseId:i.value.id,hardReload:_e.type===xe.FORM&&z.value[0]===_e.id}),y("a:view:create",{view:_e.type})}});function F(){ne.value=!1,W(1e3)}}return(C,X)=>{const ae=Je,Z=zn,ve=Hn,be=Ls;return t(),u(be,{ref_key:"menuRef",ref:H,class:te([{dragging:e(P)},"nc-views-menu flex flex-col w-full !border-r-0 !bg-inherit"]),"selected-keys":e(z)},{default:o(()=>[e(R)("viewCreateOrEdit")?(t(),u(Z,{key:0,"align-left-level":e(j)?1:2,class:te({"!pl-13.3 !xs:pl-13.5":e(j),"!pl-18.6 !xs:pl-20":!e(j)}),source:e(T)},{default:o(()=>[v("div",{class:te([{"text-brand-500 hover:text-brand-600":e(B)===e(n).id,"text-gray-500 hover:text-brand-500":e(B)!==e(n).id},"nc-create-view-btn flex flex-row items-center cursor-pointer rounded-md w-full"]),role:"button"},[v("div",Wn,[s(ae,{icon:"plus"}),v("div",qn,w(C.$t("general.createEntity",{entity:C.$t("objects.view")})),1)])],2)]),_:1},8,["align-left-level","class","source"])):L("",!0),e(E).length?(t(!0),M(ye,{key:1},pa(e(E),ne=>{var W;return t(),u(ve,{id:ne.id,key:ne.id,class:te([{"bg-gray-200":e(O)===ne.id,active:((W=e(f))==null?void 0:W.id)===ne.id,[`nc-${ne.type?("viewTypeAlias"in C?C.viewTypeAlias:e(Bs))[ne.type]:ne.type}-view-item`]:!0},"nc-view-item !rounded-md !px-0.75 !py-0.5 w-full transition-all ease-in duration-100"]),"data-view-id":ne.id,"on-validate":A,table:e(n),view:ne,onDelete:he,onRename:fe,onChangeView:ce,onOpenModal:ot,onSelectIcon:F=>Ve(F,ne)},null,8,["id","class","data-view-id","table","view","onSelectIcon"])}),128)):L("",!0)]),_:1},8,["class","selected-keys"])}}}),Qn={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Yn=v("path",{fill:"currentColor",d:"M12 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5a5 5 0 0 1 5-5a5 5 0 0 1 5 5a5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"},null,-1),Xn=[Yn];function Zn(p,S){return t(),M("svg",Qn,[...Xn])}const el={name:"mdi-eye",render:Zn},tl=kt(()=>ht(()=>import("./BB8CxuQU.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(p=>p.default||p)),al=["data-order","data-id","data-table-id","data-active"],sl={class:"flex items-center py-0.5"},ol=["data-testid"],nl={class:"flex flex-row h-full items-center"},ll=["data-testid"],il=["data-testid"],rl={class:"flex text-xs font-bold text-gray-500 ml-1"},cl={class:"flex gap-2 items-center"},dl={class:"flex gap-2 items-center"},ul={class:"flex gap-2 items-center"},pl=pe({__name:"TableNode",props:{base:{},table:{},sourceIndex:{default:0}},setup(p){const S=p,c=He(S,"base"),i=He(S,"table"),n=He(S,"sourceIndex"),{openTable:g}=Ha({baseId:c.value.id}),B=Os(),{isUIAllowed:R}=ze(),{isMobileMode:V}=Ce(),y=$t(),{updateTab:a}=y,{$e:h,$api:f}=Me();Ha({baseId:c.value.id});const{meta:b,control:N}=Qt(),{copy:E}=ts(),r=Oe(as);vt(da,i);const{setMenuContext:D,openRenameTableDialog:l,duplicateTable:d}=Oe(ma),{loadViews:x}=Re(),{activeView:U,activeViewTitleOrId:$,viewsByTable:z}=ee(Re()),{isLeftSidebarOpen:P}=ee(Xt()),{baseTables:H}=ee(ke()),O=oe(()=>H.value.get(c.value.id)??[]),k=oe(()=>B.params.viewId),T=I(!1),j=I(!1),A=async(W,F)=>{try{F.meta={...F.meta||{},icon:W},O.value.splice(O.value.indexOf(F),1,{...F}),a({id:F.id},{meta:F.meta}),await f.dbTable.update(F.id,{meta:F.meta}),h("a:table:icon:navdraw",{icon:W})}catch(_e){ue.error(await Se(_e))}},{isSharedBase:G}=qe(),re=oe(()=>R("tableIconEdit",{roles:r==null?void 0:r.value})),K=I(!1),Y=I(!1),ce=I(!1),fe=async()=>{if(K.value){K.value=!1;return}Y.value=!0;try{await x({tableId:i.value.id,ignoreLoading:!0})}catch(W){ue.error(await Se(W))}finally{Y.value=!1,K.value=!0}},he=async()=>{if(At()?b.value:N.value){await g(i.value,!0);return}Y.value=!0;try{await g(i.value),V.value&&(P.value=!1)}catch(W){ue.error(await Se(W))}finally{Y.value=!1,K.value=!0}};let Ve;const ot=async()=>{Ve&&clearTimeout(Ve);try{await E(i.value.id),ce.value=!0,Ve=setTimeout(()=>{ce.value=!1,clearTimeout(Ve)},5e3)}catch(W){ue.error(W.message)}};Ae(()=>{var W;return(W=U.value)==null?void 0:W.id},()=>{var W,F;U.value&&((W=U.value)==null?void 0:W.fk_model_id)===((F=i.value)==null?void 0:F.id)&&(K.value=!0)},{immediate:!0});const C=oe(()=>{var W,F;return k.value===((W=i.value)==null?void 0:W.id)&&(((F=U.value)==null?void 0:F.is_default)||!$.value)});let X;Ae(k,()=>{var W;if(X&&clearTimeout(X),i.value.id!==k.value&&K.value){if((((W=z.value.get(i.value.id))==null?void 0:W.filter(_e=>!_e.is_default))??[]).length)return;X=setTimeout(()=>{K.value&&(K.value=!1),clearTimeout(X)},1e4)}});const ae=W=>{j.value=!1,d(W)},Z=(W,F)=>{j.value=!1,l(W,!!F)},ve=()=>{j.value=!1,T.value=!0},be=async()=>{K.value=!1,await Ut(),K.value=!0},ne=oe(()=>{var W,F;return(F=(W=c.value)==null?void 0:W.sources)==null?void 0:F[n.value]});return(W,F)=>{var Ct,St,rt,ft;const _e=ua,Pe=el,Xe=Rt,ge=tl,nt=Rs,lt=Ne,Fe=Je,Tt=ya,Dt=Ft,ta=Zt,Ht=Kt,it=ps,aa=Jn,Ee=je("e");return t(),M("div",{class:te(["nc-tree-item nc-table-node-wrapper text-sm select-none w-full",[`nc-base-tree-tbl nc-base-tree-tbl-${(Ct=e(i).title)==null?void 0:Ct.replaceAll(" ","")}`]]),"data-order":e(i).order,"data-id":e(i).id,"data-table-id":e(i).id,"data-active":e(k)===e(i).id},[v("div",sl,[Q((t(),M("div",{class:te(["flex-none flex-1 table-context flex items-center gap-1 h-full nc-tree-item-inner nc-sidebar-node pr-0.75 mb-0.25 rounded-md h-7 w-full group cursor-pointer hover:bg-gray-200",{"hover:bg-gray-200":e(k)!==e(i).id,"pl-13.5":e(n)!==0,"pl-7.5 xs:pl-6":e(n)===0,"!bg-primary-selected":e(C)}]),"data-testid":`nc-tbl-side-node-${e(i).title}`,onContextmenu:F[7]||(F[7]=Be=>e(D)("table",e(i))),onClick:he},[v("div",nl,[v("div",{class:"flex w-auto","data-testid":`tree-view-table-draggable-handle-${e(i).title}`},[e(i).isViewsLoading?(t(),u(_e,{key:0,class:"flex items-center w-6 h-full !text-gray-600"})):Q((t(),M("div",{key:1,class:te(["flex items-center nc-table-icon",{"pointer-events-none":!e(re)}]),onClick:F[1]||(F[1]=me(()=>{},["stop"]))},[(t(),u(ge,{key:(St=e(i).meta)==null?void 0:St.icon,emoji:(rt=e(i).meta)==null?void 0:rt.icon,size:"small",readonly:!e(re)||e(V),onEmojiSelected:F[0]||(F[0]=Be=>A(Be,e(i)))},{default:o(()=>[s(Xe,{class:"flex",placement:"topLeft","hide-on-click":"",disabled:!e(re)},{title:o(()=>[q(w(W.$t("general.changeIcon")),1)]),default:o(()=>[e(i).type==="table"?(t(),u(ss(("iconMap"in W?W.iconMap:e(Us)).table),{key:0,class:te(["w-4 text-sm",e(C)?"!text-brand-600/85":"!text-gray-600/75"])},null,8,["class"])):(t(),u(Pe,{key:1,class:te(["flex w-5 text-sm",e(C)?"!text-brand-600":"!text-gray-600"])},null,8,["class"]))]),_:1},8,["disabled"])]),_:1},8,["emoji","readonly"]))],2)),[[Ee,["c:table:emoji-picker"]]])],8,ll)]),s(Xe,{class:"nc-tbl-title nc-sidebar-node-title text-ellipsis overflow-hidden select-none !flex-1","show-on-truncate-only":""},{title:o(()=>[q(w(e(i).title),1)]),default:o(()=>[v("span",{class:te(e(C)?"text-brand-600 !font-medium":"text-gray-600"),"data-testid":`nc-tbl-title-${e(i).title}`,style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},w(e(i).title),11,il)]),_:1}),s(Ht,{visible:e(j),"onUpdate:visible":F[5]||(F[5]=Be=>le(j)?j.value=Be:null),trigger:["click"],onClick:F[6]||(F[6]=me(()=>{},["stop"]))},{overlay:o(()=>[s(ta,{class:"!min-w-62.5","data-testid":`sidebar-table-context-menu-list-${e(i).title}`},{default:o(()=>{var Be;return[s(Xe,null,{title:o(()=>[q(w(W.$t("labels.clickToCopyTableID")),1)]),default:o(()=>{var bt;return[v("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:me(ot,["stop"])},[v("div",rl,w(W.$t("labels.tableIdColon",{tableId:(bt=e(i))==null?void 0:bt.id})),1),s(lt,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(ce)?(t(),u(Fe,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(t(),u(Fe,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),!e(G)&&(e(R)("tableRename",{roles:e(r),source:e(ne)})||e(R)("tableDelete",{roles:e(r),source:e(ne)}))?(t(),M(ye,{key:0},[s(Tt),e(R)("tableRename",{roles:e(r),source:e(ne)})?(t(),u(Dt,{key:0,"data-testid":`sidebar-table-rename-${e(i).title}`,class:"nc-table-rename",onClick:F[3]||(F[3]=bt=>Z(e(i),e(ne).id))},{default:o(()=>[Q((t(),M("div",cl,[s(Fe,{icon:"rename",class:"text-gray-700"}),q(" "+w(W.$t("general.rename"))+" "+w(W.$t("objects.table")),1)])),[[Ee,["c:table:rename"]]])]),_:1},8,["data-testid"])):L("",!0),e(R)("tableDuplicate",{source:e(ne)})&&((Be=e(c).sources)!=null&&Be[e(n)])&&(e(ne).is_meta||e(ne).is_local)?(t(),u(Dt,{key:1,"data-testid":`sidebar-table-duplicate-${e(i).title}`,onClick:F[4]||(F[4]=bt=>ae(e(i)))},{default:o(()=>[Q((t(),M("div",dl,[s(Fe,{icon:"duplicate",class:"text-gray-700"}),q(" "+w(W.$t("general.duplicate"))+" "+w(W.$t("objects.table")),1)])),[[Ee,["c:table:duplicate"]]])]),_:1},8,["data-testid"])):L("",!0),s(Tt),e(R)("tableDelete",{roles:e(r),source:e(ne)})?(t(),u(Dt,{key:2,"data-testid":`sidebar-table-delete-${e(i).title}`,class:"!text-red-500 !hover:bg-red-50 nc-table-delete",onClick:ve},{default:o(()=>[Q((t(),M("div",ul,[s(Fe,{icon:"delete"}),q(" "+w(W.$t("general.delete"))+" "+w(W.$t("objects.table")),1)])),[[Ee,["c:table:delete"]]])]),_:1},8,["data-testid"])):L("",!0)],64)):L("",!0)]}),_:1},8,["data-testid"])]),default:o(()=>[Q((t(),u(lt,{class:te(["nc-sidebar-node-btn nc-tbl-context-menu text-gray-700 hover:text-gray-800",{"!opacity-100 !inline-block":e(j)}]),"data-testid":"nc-sidebar-table-context-menu",type:"text",size:"xxsmall",onClick:F[2]||(F[2]=me(()=>{},["stop"]))},{default:o(()=>[s(nt,{class:"!text-current"})]),_:1},8,["class"])),[[Ee,["c:table:option"]]])]),_:1},8,["visible"]),Q((t(),u(lt,{type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn nc-sidebar-expand text-gray-700 hover:text-gray-800",{"!opacity-100 !visible":e(j)}]),onClick:me(fe,["stop"])},{default:o(()=>[s(Fe,{icon:"chevronRight",class:te(["nc-sidebar-source-node-btns cursor-pointer transform transition-transform duration-200 !text-current text-[20px]",{"!rotate-90":e(K)}])},null,8,["class"])]),_:1},8,["class"])),[[Ee,["c:table:toggle-expand"]]])],42,ol)),[[Ee,["a:table:open"]]])]),e(i).id&&((ft=e(c))!=null&&ft.id)?(t(),u(it,{key:0,visible:e(T),"onUpdate:visible":F[8]||(F[8]=Be=>le(T)?T.value=Be:null),"table-id":e(i).id,"base-id":e(c).id},null,8,["visible","table-id","base-id"])):L("",!0),e(K)?(t(),u(aa,{key:1,"table-id":e(i).id,"base-id":e(c).id,onDeleted:be},null,8,["table-id","base-id"])):L("",!0)],10,al)}}}),ml=Ge(pl,[["__scopeId","data-v-33f77e34"]]),vl={class:"border-none sortable-list"},fl=["nc-source"],bl=pe({__name:"TableList",props:{base:{},sourceIndex:{default:0}},setup(p){const S=p,c=He(S,"base"),i=He(S,"sourceIndex"),n=oe(()=>{var r,D;return(D=(r=c.value)==null?void 0:r.sources)==null?void 0:D[i.value]}),{isMobileMode:g}=Ce(),{isUIAllowed:B}=ze(),{baseTables:R}=ee(ke()),V=oe(()=>R.value.get(c.value.id)??[]),{$api:y}=Me(),a=oe(()=>V.value.reduce((r,D)=>(r[D.id]=D,r),{})),h=I({}),f=I(),b={},N=r=>{const D=r.getAttribute("nc-source");D&&(g.value||(b[D]&&b[D].destroy(),rs.create(r,{onEnd:async l=>{var j,A;const d=V.value.findIndex(G=>G.source_id===D),{newIndex:x=0,oldIndex:U=0}=l;if(x===U)return;const $=l.item,z=a.value[$.dataset.id],P=l.to.children;if(P.length<2)return;const H=P[x-1],O=P[x+1],k=H&&a.value[H.dataset.id],T=O&&a.value[O.dataset.id];P.length-1===l.newIndex?z.order=k.order+1:x===0?z.order=T.order/2:z.order=(k.order+T.order)/2,(A=V.value)==null||A.splice(x+d,0,...(j=V.value)==null?void 0:j.splice(U+d,1)),h.value[D]?h.value[D]=h.value[D]+1:h.value[D]=1,await y.dbTable.reorder(z.id,{order:z.order})},animation:150,setData(l,d){l.setData("text/json",JSON.stringify({id:d.dataset.id,title:d.dataset.title,type:d.dataset.type,sourceId:d.dataset.sourceId}))},revertOnSpill:!0})))};Qa(()=>{f.value&&B("viewCreateOrEdit")&&(f.value instanceof HTMLElement?N(f.value):f.value.forEach(r=>N(r)))});const E=oe(()=>V.value.filter(r=>{var D,l;return r.source_id===((l=(D=c.value)==null?void 0:D.sources)==null?void 0:l[i.value].id)}));return(r,D)=>{var l,d,x,U,$,z;return t(),M("div",vl,[e(c)?(t(),M(ye,{key:0},[e(E).length===0?(t(),M("div",{key:0,class:te(["py-0.5 text-gray-500",{"ml-8.5":e(i)===0,"ml-14.5 xs:ml-15.25":e(i)!==0}])},w(r.$t("general.empty")),3)):L("",!0),(l=e(c).sources)!=null&&l[e(i)]&&e(c).sources[e(i)].enabled?(t(),M("div",{ref_key:"menuRefs",ref:f,key:`sortable-${(d=e(n))==null?void 0:d.id}-${(x=e(n))!=null&&x.id&&((U=e(n))==null?void 0:U.id)in e(h)?e(h)[($=e(n))==null?void 0:$.id]:"0"}`,"nc-source":(z=e(n))==null?void 0:z.id},[(t(!0),M(ye,null,pa(e(E),P=>{var H;return t(),u(ml,{key:P.id,class:"nc-tree-item text-sm","data-order":P.order,"data-id":P.id,table:P,base:e(c),"source-index":e(i),"data-title":P.title,"data-source-id":(H=e(n))==null?void 0:H.id,"data-type":P.type},null,8,["data-order","data-id","table","base","source-index","data-title","data-source-id","data-type"])}),128))],8,fl)):L("",!0)],64)):L("",!0)])}}}),_l={key:0,class:"flex flex-row items-center py-2 px-2.25 bg-gray-50 rounded-lg text-gray-700"},yl={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},gl=pe({__name:"ProjectDelete",props:{visible:{type:Boolean},baseId:{}},emits:["update:visible"],setup(p,{emit:S}){const c=p,n=Ye(c,"visible",S),{closeTab:g}=$t(),B=We(),{deleteProject:R,navigateToFirstProjectOrHome:V}=B,{bases:y}=ee(B),{removeFromRecentViews:a}=Re(),{refreshCommandPalette:h}=Qe(),f=oe(()=>y.value.get(c.baseId)),b=I(!1),N=async()=>{if(!f.value)return;const E=JSON.parse(JSON.stringify(f.value));b.value=!0;try{await R(E.id),await g(E.id),h(),n.value=!1,E.id===B.activeProjectId&&await V()}catch(r){ue.error(await Se(r))}finally{b.value=!1,a({baseId:E.id})}};return(E,r)=>{const D=ra,l=cs;return t(),u(l,{visible:e(n),"onUpdate:visible":r[0]||(r[0]=d=>le(n)?n.value=d:null),"entity-name":E.$t("objects.project"),"on-delete":N},{"entity-preview":o(()=>[e(f)?(t(),M("div",_l,[s(D,{color:("parseProp"in E?E.parseProp:e(_t))(e(f).meta).iconColor,type:e(f).type,class:"nc-view-icon w-6 h-6 mx-1"},null,8,["color","type"]),v("div",yl,w(e(f).title),1)])):L("",!0)]),_:1},8,["visible","entity-name"])}}}),wl={class:"mt-5"},xl={class:"prose-md self-center text-gray-500 mt-4"},kl={class:"text-xs p-2"},hl={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},$l=pe({__name:"ProjectDuplicate",props:{modelValue:{type:Boolean},base:{}},emits:["update:modelValue"],setup(p,{emit:S}){const c=p,i=S,{refreshCommandPalette:n}=Qe(),{api:g}=zt(),{$e:B,$poller:R}=Me(),V=We(),{loadProjects:y,createProject:a}=V,{bases:h}=ee(V),{navigateToProject:f}=Ce(),b=Ye(c,"modelValue",i),N=I({includeData:!0,includeViews:!0,includeHooks:!0}),E=oe(()=>{const{includeData:d,includeViews:x,includeHooks:U}=N.value;return{excludeData:!d,excludeViews:!x,excludeHooks:!U}}),r=I(!1),D=async()=>{try{r.value=!0;const d=za[Math.floor(Math.random()*1e3)%za.length],U=As(d).complement(),$=await g.base.duplicate(c.base.id,{options:E.value,base:{fk_workspace_id:c.base.fk_workspace_id,type:c.base.type,color:d,meta:JSON.stringify({theme:{primaryColor:d,accentColor:U.toHex8String()},iconColor:_t(c.base.meta).iconColor})}});R.subscribe({id:$.id},async z=>{if(z.status!=="close")if(z.status===gt.COMPLETED){await y("workspace");const P=h.value.get($.base_id);P&&await f({workspaceId:at?P.fk_workspace_id:void 0,baseId:P.id,type:P.type}),n(),r.value=!1,b.value=!1}else z.status===gt.FAILED&&(ue.error("Failed to duplicate project"),await y("workspace"),n(),r.value=!1,b.value=!1)}),B("a:base:duplicate")}catch(d){ue.error(await Se(d)),r.value=!1,b.value=!1}};Yt("Enter",()=>{b.value&&D()});const l=I(!1);return(d,x)=>{const U=ba,$=_a,z=Ne,P=It,H=je("e");return d.base?(t(),u(P,{key:0,visible:e(b),"onUpdate:visible":x[5]||(x[5]=O=>le(b)?b.value=O:null),"mask-closable":!e(r),keyboard:!e(r),class:"!w-[30rem]","wrap-class-name":"nc-modal-base-duplicate"},{default:o(()=>[v("div",null,[v("div",{class:"font-medium text-lg text-gray-800 self-center",onDblclick:x[0]||(x[0]=O=>l.value=!e(l))},w(d.$t("general.duplicate"))+" "+w(d.$t("objects.project")),33),v("div",wl,w(d.$t("msg.warning.duplicateProject")),1),v("div",xl,w(d.$t("title.advancedSettings")),1),s(U,{class:"!m-0 !p-0 !my-2"}),v("div",kl,[s($,{checked:e(N).includeData,"onUpdate:checked":x[1]||(x[1]=O=>e(N).includeData=O),disabled:e(r)},{default:o(()=>[q(w(d.$t("labels.includeData")),1)]),_:1},8,["checked","disabled"]),s($,{checked:e(N).includeViews,"onUpdate:checked":x[2]||(x[2]=O=>e(N).includeViews=O),disabled:e(r)},{default:o(()=>[q(w(d.$t("labels.includeView")),1)]),_:1},8,["checked","disabled"]),Q(s($,{checked:e(N).includeHooks,"onUpdate:checked":x[3]||(x[3]=O=>e(N).includeHooks=O),disabled:e(r)},{default:o(()=>[q(w(d.$t("labels.includeWebhook")),1)]),_:1},8,["checked","disabled"]),[[Ya,e(l)]])])]),v("div",hl,[e(r)?L("",!0):(t(),u(z,{key:"back",type:"secondary",size:"small",onClick:x[4]||(x[4]=O=>b.value=!1)},{default:o(()=>[q(w(d.$t("general.cancel")),1)]),_:1})),Q((t(),u(z,{key:"submit",size:"small",loading:e(r),onClick:D},{default:o(()=>[q(w(d.$t("general.confirm")),1)]),_:1},8,["loading"])),[[H,["a:base:duplicate"]]])])]),_:1},8,["visible","mask-closable","keyboard"])):L("",!0)}}}),Il=p=>p.is_schema_readonly&&p.is_data_readonly?"#278bff":p.is_schema_readonly?"#df830f":"#de0062",Tl=p=>{var c,i;const S=`Connection type is ${((c=zs.find(n=>n.value===p.type))==null?void 0:c.text)||((i=p.type)==null?void 0:i.toUpperCase())}.`;return p.is_schema_readonly&&p.is_data_readonly?De("div",{className:"w-max"},[S,De("br"),"Both data and schema editing are disabled.",De("br"),"These settings are ideal for read-only use cases of your data.",De("br"),De("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"Learn more")]):p.is_schema_readonly?De("div",{className:"max-w-90"},[S,De("br"),"Data editing is allowed and Schema edit is not allowed.",De("br"),"An ideal settings for administrative users who need to change data directly on database.",De("br"),De("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"Learn more")]):De("div",{className:"max-w-90"},[S,De("br"),"Both Data and Schema Editing are enabled.",De("br"),"We highly recommend ",De("a",{className:"!text-current",href:"https://docs.nocodb.com/data-sources/connect-to-data-source#configuring-permissions",target:"_blank"},"disabling schema editing")," to maintain data integrity and avoid potential issues."])},Dl=kt(()=>ht(()=>import("./DpXEfBz-.js"),__vite__mapDeps([4,5,1,2,6,7,8,9,10,11]),import.meta.url).then(p=>p.default||p)),Cl=["data-testid","data-base-id"],Sl=["data-testid"],Vl={class:"flex items-center select-none w-6 h-full"},jl={key:1},Ml={class:"flex gap-2 items-center"},Pl={class:"flex gap-2 items-center"},Nl={class:"flex gap-2 items-center"},El={class:"flex gap-2 items-center"},Bl={class:"flex gap-2 items-center"},Ll={class:"flex gap-2 items-center"},Ol={class:"flex gap-2 items-center"},Ul={key:0,class:"flex-1"},Rl={class:"transition-height duration-200"},Al={key:1,class:"transition-height duration-200"},zl={class:"border-none sortable-list"},Gl={class:"nc-sidebar-node min-w-20 w-full h-full flex flex-row group py-0.5 pr-6.5 !mr-0"},Fl=["onContextmenu"],Kl=["onContextmenu"],Hl=["onUpdate:modelValue","data-source-rename-input-id","onKeyup","onBlur"],Wl=["data-testid"],ql={class:"flex flex-row items-center gap-x-0.25"},Jl={class:"flex gap-2 items-center"},Ql=["nc-source"],Yl={class:"flex text-xs font-bold text-gray-500 ml-1"},Xl={class:"nc-base-option-item flex gap-2 items-center"},Zl={class:"nc-base-option-item flex gap-2 items-center"},ei={class:"nc-base-option-item flex gap-2 items-center text-red-600"},ti={class:"h-[80vh]"},ai=pe({__name:"ProjectNode",setup(p,{expose:S}){const c=De(Gs,{class:"!text-gray-400",style:{fontSize:"0.85rem"},spin:!0}),n=va().currentRoute,{isSharedBase:g}=ee(qe()),{setMenuContext:B,openRenameTableDialog:R,duplicateTable:V,contextMenuTarget:y}=Oe(ma),a=Oe(Gt),h=We(),{isMobileMode:f}=Ce(),{api:b}=zt(),{auditLogsQuery:N,auditCurrentPage:E}=ee(st()),{createProject:r,updateProject:D,getProjectMetaInfo:l,loadProject:d}=h,{bases:x}=ee(h),{loadProjectTables:U}=ke(),{activeTable:$}=ee(ke()),{appInfo:z}=Ce(),{orgRoles:P,isUIAllowed:H}=ze();$t();const{meta:O,control:k}=Qt(),{refreshCommandPalette:T}=Qe(),j=I(!1),A=I(""),G=I({}),re=I(""),K=I(!1),{t:Y}=Jt(),ce=I(),fe=oe(()=>a.value.project_role||a.value.workspace_role),{activeProjectId:he}=ee(We()),{baseUrl:Ve}=qe(),ot=Oe(os,()=>{}),{$e:C}=Me(),X=I(!1),ae=I({}),Z=I([]),[ve]=Fs(),be=I(""),ne=I({}),W=I(!1),F=I(!1),{refreshViewTabTitle:_e}=Re(),Pe=oe(()=>{var se;const _=String((se=n.value)==null?void 0:se.name).split("baseId-index-index");if(_.length<=1)return!1;const m=_[_.length-1];return m.split("-").length===2||m.split("-").length===1}),Xe=_=>["airtableImport","csvImport","jsonImport","excelImport"].some(m=>H(m,{source:_})),ge=()=>{j.value=!0,A.value=a.value.title,Ut(()=>{var _,m,se;(_=ce.value)==null||_.focus(),(m=ce.value)==null||m.select(),(se=ce.value)==null||se.scrollIntoView()})},nt=_=>{var se;const m=(se=a.value.sources)==null?void 0:se.find(ie=>ie.id===_);m!=null&&m.id&&(G.value[m.id]={editMode:!0,tempTitle:m.alias||""},Ut(()=>{const ie=document.querySelector(`[data-source-rename-input-id="${_}"]`);ie&&(ie==null||ie.focus(),ie==null||ie.select(),ie==null||ie.scrollIntoView())}))},lt=async _=>{var se;const m=(se=a.value.sources)==null?void 0:se.find(ie=>ie.id===_);if(!(!(m!=null&&m.id)||!G.value[m.id])&&(G.value[m.id].tempTitle&&(G.value[m.id].tempTitle=G.value[m.id].tempTitle.trim()),!!G.value[m.id].tempTitle))try{await b.source.update(m.base_id,m.id,{alias:G.value[m.id].tempTitle}),await d(m.base_id,!0),delete G.value[m.id],C("a:source:rename"),_e==null||_e()}catch(ie){ue.error(await Se(ie))}finally{T()}},Fe=async()=>{if(A.value&&(A.value=A.value.trim()),!!A.value)try{await D(a.value.id,{title:A.value}),j.value=!1,A.value="",C("a:base:rename"),_e==null||_e()}catch(_){ue.error(await Se(_))}},{copy:Tt}=ts(!0),Dt=async()=>{try{await Tt(Object.entries(await l(a.value.id)).map(([_,m])=>`${_}: **${m}**`).join(`
`))&&ue.info(Y("msg.info.copiedToClipboard"))}catch(_){console.error(_),ue.error(_.message)}};S({enableEditMode:ge});const ta=async(_,m)=>{try{const se={..._t(m.meta),iconColor:_};h.updateProject(m.id,{meta:JSON.stringify(se)}),C("a:base:icon:color:navdraw",{iconColor:_})}catch(se){ue.error(await Se(se))}finally{T()}};function Ht(_){var de,Ke,$e;const m=I(!0);let se=(de=a.value.sources)==null?void 0:de[0].id;if(typeof _=="number"&&(se=(Ke=a.value.sources)==null?void 0:Ke[_].id),!se||!(($e=a.value)!=null&&$e.id))return;const{close:ie}=Ue(is,{modelValue:m,sourceId:se,baseId:a.value.id,onCreate:Le,"onUpdate:modelValue":()=>Le()});function Le(Ze){m.value=!1,Ze&&(a.value.isExpanded=!0,(!Z.value||!Z.value.includes(`collapse-${se}`))&&Z.value.push(`collapse-${se}`),setTimeout(()=>{const ct=document.querySelector(`[data-table-id="${Ze.id}"]`);ct&&(ct==null||ct.scrollIntoView({behavior:"smooth",block:"nearest"}))},1e3),ie(1e3))}}const it=I(!1);async function aa(){if(it.value)return;it.value=!0,!h.isProjectPopulated(a.value.id)&&a.value.type===yt.DB&&U(a.value.id);try{Ht(),!a.value.isExpanded&&a.value.type!==yt.DB&&(a.value.isExpanded=!0)}finally{it.value=!1}}const Ee=async(_,m,se)=>{if(!_)return;const ie=At()?O.value:k.value;if(!se&&!ie&&C("c:base:open"),m=f.value||m,se=f.value||se,ie&&!m){await mt(`${ie?"#":""}${Ve({id:_.id,type:"database",isSharedBase:g.value})}`,ie?{open:Ws}:void 0);return}se?_.isExpanded=!_.isExpanded:_.isExpanded=!0;const Le=h.isProjectPopulated(_.id);if(Le||(_.isLoading=!0),m||await mt(Ve({id:_.id,type:"database",isSharedBase:g.value})),Le||await U(_.id),!Le){_.isLoading=!1;const de=x.value.get(_.id);de.isLoading=!1}};function Ct(_){C("c:project:relation");const m=I(!0),{close:se}=Ue(bn,{modelValue:m,sourceId:_.id,"onUpdate:modelValue":()=>ie(),baseId:a.value.id});function ie(){m.value=!1,se(1e3)}}const St=oe(()=>{var _,m;if(y.type==="source")return y.value;if(y.type==="table"){const se=(m=(_=a.value)==null?void 0:_.sources)==null?void 0:m.find(ie=>ie.id===y.value.source_id);if(se)return se}return null});Ae(()=>{var _;return(_=$.value)==null?void 0:_.id},async()=>{if(!$.value)return;const _=$.value.source_id;_&&(Z.value.includes(`collapse-${_}`)||Z.value.push(`collapse-${_}`))},{immediate:!0}),Yt("Escape",()=>{X.value&&(X.value=!1);for(const _ of Object.keys(ae.value))ae.value[_]=!1});const rt=I(!1),ft=I(),Be=_=>{ft.value=_,rt.value=!0},bt=()=>{W.value=!0,C("c:table:delete")},vs=()=>{F.value=!0,C("c:project:delete")},sa=I(!1);let Wt;const fs=async()=>{Wt&&clearTimeout(Wt);try{await Tt(y.value.id),sa.value=!0,Wt=setTimeout(()=>{sa.value=!1,clearTimeout(Wt)},5e3)}catch(_){ue.error(_.message)}},Vt=_=>{var m;return(m=a.value.sources)==null?void 0:m.find(se=>se.id===_)};async function bs(_){C("c:project:audit"),E.value=1,N.value={...N.value,orderBy:{created_at:"desc",user:void 0}};const m=I(!0),{close:se}=Ue(yn,{modelValue:m,sourceId:_.id,"onUpdate:modelValue":()=>ie(),baseId:a.value.id,bordered:!0});function ie(){m.value=!1,se(1e3)}}return(_,m)=>{var ka,ha,$a,Ia,Ta;const se=qs,ie=Js,Le=Rt,de=Je,Ke=Ne,$e=Ft,Ze=ya,ct=$n,oa=Zt,na=Kt,wa=bl,xa=ro,_s=_o,ys=yo,gs=ps,ws=gl,xs=$l,ks=Dl,hs=It,Ie=je("e");return t(),M(ye,null,[s(na,{trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-tree-view-context-menu"},Ks({default:o(()=>{var Te,jt,Mt,Pt,Nt,Et,Bt,dt,Da,Ca,Sa,Va,ja,Ma,Pa;return[v("div",{class:te(["mx-1 nc-base-sub-menu rounded-md",{active:e(a).isExpanded}]),"data-testid":`nc-sidebar-base-${e(a).title}`,"data-base-id":e(a).id},[v("div",{class:"flex items-center gap-0.75 py-0.5 cursor-pointer",onContextmenu:m[15]||(m[15]=J=>e(B)("base",e(a)))},[v("div",{ref:"baseNodeRefs",class:te([{"bg-primary-selected active":e(he)===e(a).id&&e(Pe)&&!e(f),"hover:bg-gray-200":!(e(he)===e(a).id&&e(Pe))},"nc-sidebar-node base-title-node h-7 flex-grow rounded-md group flex items-center w-full pr-1 pl-1.5"]),"data-testid":`nc-sidebar-base-title-${e(a).title}`},[v("div",{class:"flex items-center mr-1",onClick:m[1]||(m[1]=J=>Ee(e(a)))},[v("div",Vl,[e(a).isLoading?(t(),u(se,{key:0,class:"!ml-1.25 !flex !flex-row !items-center !my-0.5 w-8",indicator:e(c)},null,8,["indicator"])):(t(),M("div",jl,[(t(),u(ie,{key:`${e(a).id}_${("parseProp"in _?_.parseProp:e(_t))(e(a).meta).iconColor}`,type:(Te=e(a))==null?void 0:Te.type,"model-value":("parseProp"in _?_.parseProp:e(_t))(e(a).meta).iconColor,size:"small",readonly:((jt=e(a))==null?void 0:jt.type)&&((Mt=e(a))==null?void 0:Mt.type)!=="database"||!e(H)("baseRename"),"onUpdate:modelValue":m[0]||(m[0]=J=>ta(J,e(a)))},null,8,["type","model-value","readonly"]))]))])]),e(j)?Q((t(),M("input",{key:0,ref_key:"input",ref:ce,"onUpdate:modelValue":m[2]||(m[2]=J=>le(A)?A.value=J:null),class:te(["flex-grow leading-1 outline-0 ring-none capitalize !text-inherit !bg-transparent flex-1 mr-4",e(he)===e(a).id&&e(Pe)?"!text-brand-600 !font-semibold":"!text-gray-700"]),onClick:m[3]||(m[3]=me(()=>{},["stop"])),onKeyup:[pt(Fe,["enter"]),pt(Fe,["esc"])],onBlur:Fe},null,34)),[[Ga,e(A)]]):(t(),u(Le,{key:1,class:te(["nc-sidebar-node-title capitalize text-ellipsis overflow-hidden select-none flex-1",e(he)===e(a).id&&e(Pe)?"text-brand-600 font-semibold":"text-gray-700"]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},"show-on-truncate-only":"",onClick:m[4]||(m[4]=J=>Ee(e(a)))},{title:o(()=>[q(w(e(a).title),1)]),default:o(()=>[v("span",null,w(e(a).title),1)]),_:1},8,["class"])),e(j)?L("",!0):(t(),M(ye,{key:2},[e(g)?L("",!0):(t(),u(na,{key:0,visible:e(X),"onUpdate:visible":m[13]||(m[13]=J=>le(X)?X.value=J:null),trigger:["click"]},{overlay:o(()=>[s(oa,{class:"nc-scrollbar-md",style:{maxHeight:"70vh",overflow:"overlay"},"data-testid":`nc-sidebar-base-${e(a).title}-options`,onClick:m[12]||(m[12]=J=>X.value=!1)},{default:o(()=>{var J,ut,et,we,Na,Ea,Ba,La,Oa,Ua,Ra;return[e(g)?L("",!0):(t(),M(ye,{key:0},[e(H)("baseRename")?(t(),u($e,{key:0,"data-testid":"nc-sidebar-project-rename",onClick:ge},{default:o(()=>[Q((t(),M("div",Ml,[s(de,{icon:"rename",class:"group-hover:text-black"}),q(" "+w(_.$t("general.rename")),1)])),[[Ie,["c:base:rename"]]])]),_:1})):L("",!0),e(H)("baseDuplicate",{roles:[e(Fa)(e(P)),e(fe)].join()})?(t(),u($e,{key:1,"data-testid":"nc-sidebar-base-duplicate",onClick:m[6]||(m[6]=tt=>Be(e(a)))},{default:o(()=>[Q((t(),M("div",Pl,[s(de,{icon:"duplicate",class:"text-gray-700"}),q(" "+w(_.$t("general.duplicate")),1)])),[[Ie,["c:base:duplicate"]]])]),_:1})):L("",!0),["baseDuplicate","baseRename"].some(tt=>e(H)(tt))?(t(),u(Ze,{key:2})):L("",!0),("isEeUI"in _?_.isEeUI:e(at))?L("",!0):(t(),u($e,{key:"copy","data-testid":"nc-sidebar-base-copy-base-info",onClick:me(Dt,["stop"])},{default:o(()=>[Q((t(),M("div",Nl,[s(de,{icon:"copy",class:"group-hover:text-black"}),q(" "+w(_.$t("activity.account.projInfo")),1)])),[[Ie,["c:base:copy-proj-info"]]])]),_:1})),(et=(ut=(J=e(a))==null?void 0:J.sources)==null?void 0:ut[0])!=null&&et.enabled?(t(),u($e,{key:"erd","data-testid":"nc-sidebar-base-relations",onClick:m[7]||(m[7]=tt=>{var Lt,Ot;return Ct((Ot=(Lt=e(a))==null?void 0:Lt.sources)==null?void 0:Ot[0])})},{default:o(()=>[Q((t(),M("div",El,[s(de,{icon:"erd"}),q(" "+w(_.$t("title.relations")),1)])),[[Ie,["c:base:erd"]]])]),_:1})):L("",!0),e(H)("baseAuditList")&&((Ea=(Na=(we=e(a))==null?void 0:we.sources)==null?void 0:Na[0])!=null&&Ea.enabled)?(t(),u($e,{key:"audit","data-testid":"nc-sidebar-base-audit",onClick:m[8]||(m[8]=tt=>{var Lt,Ot;return bs((Ot=(Lt=e(a))==null?void 0:Lt.sources)==null?void 0:Ot[0])})},{default:o(()=>[s(de,{icon:"audit",class:"group-hover:text-black"}),q(" "+w(_.$t("title.audit")),1)]),_:1})):L("",!0),e(H)("apiDocs")?(t(),u($e,{key:"api","data-testid":"nc-sidebar-base-rest-apis",onClick:m[9]||(m[9]=me(()=>{e(C)("c:base:api-docs"),("openLink"in _?_.openLink:e(Hs))(`/api/v2/meta/bases/${e(a).id}/swagger`,e(z).ncSiteUrl)},["stop"]))},{default:o(()=>[Q((t(),M("div",Bl,[s(de,{icon:"snippet",class:"group-hover:text-black !max-w-3.9"}),q(" "+w(_.$t("activity.account.swagger")),1)])),[[Ie,["c:base:api-docs"]]])]),_:1})):L("",!0)],64)),(Oa=(La=(Ba=e(a))==null?void 0:Ba.sources)==null?void 0:La[0])!=null&&Oa.enabled&&Xe((Ra=(Ua=e(a))==null?void 0:Ua.sources)==null?void 0:Ra[0])?(t(),M(ye,{key:1},[s(Ze),s(ct,{base:e(a),"onUpdate:base":m[10]||(m[10]=tt=>le(a)?a.value=tt:null),source:e(a).sources[0]},null,8,["base","source"])],64)):L("",!0),["baseMiscSettings","baseDelete"].some(tt=>e(H)(tt))?(t(),u(Ze,{key:2})):L("",!0),e(H)("baseMiscSettings")?(t(),u($e,{key:"teamAndSettings","data-testid":"nc-sidebar-base-settings",class:"nc-sidebar-base-base-settings",onClick:m[11]||(m[11]=tt=>e(ot)(!0,"teamAndAuth",void 0,e(a).id))},{default:o(()=>[Q((t(),M("div",Ll,[s(de,{icon:"settings",class:"group-hover:text-black"}),q(" "+w(_.$t("activity.settings")),1)])),[[Ie,["c:base:settings"]]])]),_:1})):L("",!0),e(H)("baseDelete",{roles:[e(Fa)(e(P)),e(fe)].join()})?(t(),u($e,{key:4,"data-testid":"nc-sidebar-base-delete",class:"!text-red-500 !hover:bg-red-50",onClick:vs},{default:o(()=>[v("div",Ol,[s(de,{icon:"delete",class:"w-4"}),q(" "+w(_.$t("general.delete")),1)])]),_:1})):L("",!0)]}),_:1},8,["data-testid"])]),default:o(()=>[Q((t(),u(Ke,{class:te(["nc-sidebar-node-btn",{"!text-black !opacity-100 !inline-block":e(X)}]),"data-testid":"nc-sidebar-context-menu",type:"text",size:"xxsmall",onClick:m[5]||(m[5]=me(()=>{},["stop"]))},{default:o(()=>[s(de,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:1},8,["class"])),[[Ie,["c:base:options"]]])]),_:1},8,["visible"])),e(H)("tableCreate",{roles:e(fe),source:(Nt=(Pt=e(a))==null?void 0:Pt.sources)==null?void 0:Nt[0]})?Q((t(),u(Ke,{key:1,disabled:!((dt=(Bt=(Et=e(a))==null?void 0:Et.sources)==null?void 0:Bt[0])!=null&&dt.enabled),class:te(["nc-sidebar-node-btn",{"!text-black !inline-block !opacity-100":e(it),"!inline-block !opacity-100":e(X)}]),size:"xxsmall",type:"text","data-testid":"nc-sidebar-add-base-entity",loading:e(it),onClick:me(aa,["stop"])},{default:o(()=>[s(de,{icon:"plus",class:"text-xl leading-5",style:{"-webkit-text-stroke":"0.15px"}})]),_:1},8,["disabled","class","loading"])),[[Ie,["c:base:create-table"]]]):L("",!0),Q((t(),u(Ke,{type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn nc-sidebar-expand !xs:opacity-100 !mr-0 mt-0.5",{"!opacity-100":e(X)}]),onClick:m[14]||(m[14]=J=>Ee(e(a),!0,!0))},{default:o(()=>[s(de,{icon:"chevronRight",class:te(["group-hover:visible cursor-pointer transform transition-transform duration-200 text-[20px]",{"!rotate-90":e(a).isExpanded}])},null,8,["class"])]),_:1},8,["class"])),[[Ie,["c:base:expand"]]])],64))],10,Sl)],32),e(a).id&&!e(a).isLoading?(t(),M("div",{key:"g1",class:te(["overflow-x-hidden transition-max-height",{"max-h-0":!e(a).isExpanded}])},[e(a)&&((Da=e(a))!=null&&Da.sources)?(t(),M("div",{key:0,class:te(["flex-1 overflow-y-auto overflow-x-hidden flex flex-col",{"mb-[20px]":e(g)}])},[(Va=(Sa=(Ca=e(a))==null?void 0:Ca.sources)==null?void 0:Sa[0])!=null&&Va.enabled?(t(),M("div",Ul,[v("div",Rl,[s(wa,{base:e(a),"source-index":0},null,8,["base"])])])):L("",!0),(Pa=(Ma=(ja=e(a))==null?void 0:ja.sources)==null?void 0:Ma.slice(1).filter(J=>J.enabled))!=null&&Pa.length?(t(),M("div",Al,[v("div",zl,[(t(!0),M(ye,null,pa(e(a).sources,(J,ut)=>(t(),M("div",{key:`source-${J.id}`},[ut===0?(t(),M(ye,{key:0},[],64)):J&&J.enabled?Q((t(),u(ys,{key:1,activeKey:e(Z),"onUpdate:activeKey":m[19]||(m[19]=et=>le(Z)?Z.value=et:null),class:te(["!mx-0 !px-0 nc-sidebar-source-node",[{hidden:e(ve)&&!!e(be)}]]),"expand-icon-position":"left",bordered:!1,ghost:""},{expandIcon:o(({isActive:et})=>[Q((t(),u(Ke,{type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn nc-sidebar-expand !xs:opacity-100 !mr-0 mt-0.5",{"!opacity-100 !inline-block":e(ae)[J.id]}])},{default:o(()=>[s(de,{icon:"chevronDown",class:te(["flex-none cursor-pointer transform transition-transform duration-500 rotate-270",{"!rotate-180":et}])},null,8,["class"])]),_:2},1032,["class"])),[[Ie,["c:external:base:expand"]]])]),default:o(()=>[(t(),u(_s,{key:`collapse-${J.id}`},{header:o(()=>{var et;return[v("div",Gl,[ut===0?(t(),M("div",{key:0,class:"source-context flex items-center gap-2 text-gray-800 nc-sidebar-node-title",onContextmenu:we=>e(B)("source",J)},[s(xa,{class:"flex-none min-w-4 !xs:min-w-4.25 !xs:w-4.25 !xs:text-sm"}),q(" "+w(_.$t("general.default")),1)],40,Fl)):(t(),M("div",{key:1,class:"source-context flex flex-grow items-center gap-1.75 text-gray-800 min-w-1/20 max-w-full",onContextmenu:we=>e(B)("source",J)},[s(Le,{"tooltip-style":{"min-width":"max-content"},"overlay-inner-style":{"min-width":"max-content"},"mouse-leave-delay":.3,placement:"topLeft",trigger:"hover",class:"flex items-center"},{title:o(()=>[(t(),u(ss(("getSourceTooltip"in _?_.getSourceTooltip:e(Tl))(J))))]),default:o(()=>[s(xa,{color:("getSourceIconColor"in _?_.getSourceIconColor:e(Il))(J),class:"flex-none min-w-4 !xs:min-w-4.25 !xs:w-4.25 !xs:text-sm"},null,8,["color"])]),_:2},1024),J.id&&((et=e(G)[J.id])!=null&&et.editMode)?Q((t(),M("input",{key:0,ref_for:!0,ref_key:"input",ref:ce,"onUpdate:modelValue":we=>e(G)[J.id].tempTitle=we,class:"flex-grow leading-1 outline-0 ring-none capitalize !text-inherit !bg-transparent flex-1 mr-4 !text-gray-700","data-source-rename-input-id":J.id,onClick:m[16]||(m[16]=me(()=>{},["stop"])),onKeydown:m[17]||(m[17]=pt(me(()=>{},["stop","prevent"]),["enter"])),onKeyup:[pt(we=>lt(J.id),["enter"]),pt(we=>lt(J.id),["esc"])],onBlur:we=>lt(J.id)},null,40,Hl)),[[Ga,e(G)[J.id].tempTitle]]):(t(),u(Le,{key:1,class:"nc-sidebar-node-title capitalize text-ellipsis overflow-hidden select-none text-gray-700",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},"show-on-truncate-only":""},{title:o(()=>[q(w(J.alias||""),1)]),default:o(()=>[v("span",{"data-testid":`nc-sidebar-base-${J.alias}`},w(J.alias||""),9,Wl)]),_:2},1024))],40,Kl)),v("div",ql,[s(na,{visible:e(ae)[J.id],trigger:["click"],"onUpdate:visible":we=>e(ae)[J.id]=we},{overlay:o(()=>[s(oa,{class:"nc-scrollbar-md",style:{maxHeight:"70vh",overflow:"overlay"},onClick:we=>e(ae)[J.id]=!1},{default:o(()=>[e(H)("baseRename")?(t(),u($e,{key:0,"data-testid":"nc-sidebar-source-rename",onClick:we=>nt(J.id)},{default:o(()=>[s(de,{icon:"rename",class:"group-hover:text-black"}),q(" "+w(_.$t("general.rename")),1)]),_:2},1032,["onClick"])):L("",!0),s(Ze),s($e,{key:"erd",onClick:we=>Ct(J)},{default:o(()=>[Q((t(),M("div",Jl,[s(de,{icon:"erd"}),q(" "+w(_.$t("title.relations")),1)])),[[Ie,["c:source:erd"]]])]),_:2},1032,["onClick"]),Xe(J)?(t(),u(ct,{key:1,base:e(a),"onUpdate:base":m[18]||(m[18]=we=>le(a)?a.value=we:null),source:J},null,8,["base","source"])):L("",!0)]),_:2},1032,["onClick"])]),default:o(()=>[Q((t(),u(Ke,{class:te(["nc-sidebar-node-btn",{"!text-black !opacity-100 !inline-block":e(ae)[J.id]}]),type:"text",size:"xxsmall",onClick:me(we=>e(ae)[J.id]=!e(ae)[J.id],["stop"])},{default:o(()=>[s(de,{icon:"threeDotHorizontal",class:"text-xl w-4.75"})]),_:2},1032,["class","onClick"])),[[Ie,["c:source:options"]]])]),_:2},1032,["visible","onUpdate:visible"]),e(H)("tableCreate",{roles:e(fe),source:J})?Q((t(),u(Ke,{key:0,type:"text",size:"xxsmall",class:te(["nc-sidebar-node-btn",{"!opacity-100 !inline-block":e(ae)[J.id]}]),onClick:me(we=>Ht(ut),["stop"])},{default:o(()=>[s(de,{icon:"plus",class:"text-xl leading-5",style:{"-webkit-text-stroke":"0.15px"}})]),_:2},1032,["class","onClick"])),[[Ie,["c:source:add-table"]]]):L("",!0)])])]}),default:o(()=>[(t(),M("div",{ref_for:!0,ref:"menuRefs",key:`sortable-${J.id}-${J.id&&J.id in e(ne)?e(ne)[J.id]:"0"}`,"nc-source":J.id},[s(wa,{base:e(a),"source-index":ut},null,8,["base","source-index"])],8,Ql))]),_:2},1024))]),_:2},1032,["activeKey","class"])),[[Ie,["c:source:toggle-expand"]]]):L("",!0)]))),128))])])):L("",!0)],2)):L("",!0)],2)):L("",!0)],10,Cl)]}),_:2},[e(g)?void 0:{name:"overlay",fn:o(()=>[s(oa,{class:te(["!py-0 rounded text-sm",{"!min-w-62.5":e(y).type==="table"}])},{default:o(()=>{var Te,jt,Mt,Pt,Nt,Et,Bt;return[e(y).type==="base"&&e(a).type==="database"?(t(),M(ye,{key:0},[],64)):e(y).type==="source"?(t(),M(ye,{key:1},[],64)):e(y).type==="table"?(t(),M(ye,{key:2},[s(Le,null,{title:o(()=>[q(w(_.$t("labels.clickToCopyTableID")),1)]),default:o(()=>{var dt;return[v("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:me(fs,["stop"])},[v("div",Yl,w(_.$t("labels.tableIdColon",{tableId:(dt=e(y).value)==null?void 0:dt.id})),1),s(Ke,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(sa)?(t(),u(de,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(t(),u(de,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),e(H)("tableRename",{source:Vt((Te=e(y).value)==null?void 0:Te.source_id)})||e(H)("tableDelete",{source:Vt((jt=e(y).value)==null?void 0:jt.source_id)})?(t(),M(ye,{key:0},[s(Ze),e(H)("tableRename",{source:Vt((Mt=e(y).value)==null?void 0:Mt.source_id)})?(t(),u($e,{key:0,onClick:m[20]||(m[20]=dt=>e(R)(e(y).value,!0))},{default:o(()=>[Q((t(),M("div",Xl,[s(de,{icon:"rename",class:"text-gray-700"}),q(" "+w(_.$t("general.rename"))+" "+w(_.$t("objects.table")),1)])),[[Ie,["c:table:rename"]]])]),_:1})):L("",!0),e(H)("tableDuplicate",{source:Vt((Pt=e(y).value)==null?void 0:Pt.source_id)})&&((Nt=e(St))!=null&&Nt.is_meta||(Et=e(St))!=null&&Et.is_local)?(t(),u($e,{key:1,onClick:m[21]||(m[21]=dt=>e(V)(e(y).value))},{default:o(()=>[Q((t(),M("div",Zl,[s(de,{icon:"duplicate",class:"text-gray-700"}),q(" "+w(_.$t("general.duplicate"))+" "+w(_.$t("objects.table")),1)])),[[Ie,["c:table:duplicate"]]])]),_:1})):L("",!0),s(Ze),e(H)("tableDelete",{source:Vt((Bt=e(y).value)==null?void 0:Bt.source_id)})?(t(),u($e,{key:2,class:"!hover:bg-red-50",onClick:bt},{default:o(()=>[v("div",ei,[s(de,{icon:"delete"}),q(" "+w(_.$t("general.delete"))+" "+w(_.$t("objects.table")),1)])]),_:1})):L("",!0)],64)):L("",!0)],64)):L("",!0)]}),_:1},8,["class"])]),key:"0"}]),1024),(ka=e(y).value)!=null&&ka.id&&((ha=e(a))!=null&&ha.id)?(t(),u(gs,{key:0,visible:e(W),"onUpdate:visible":m[22]||(m[22]=Te=>le(W)?W.value=Te:null),"table-id":($a=e(y).value)==null?void 0:$a.id,"base-id":(Ia=e(a))==null?void 0:Ia.id},null,8,["visible","table-id","base-id"])):L("",!0),s(ws,{visible:e(F),"onUpdate:visible":m[23]||(m[23]=Te=>le(F)?F.value=Te:null),"base-id":(Ta=e(a))==null?void 0:Ta.id},null,8,["visible","base-id"]),e(ft)?(t(),u(xs,{key:1,modelValue:e(rt),"onUpdate:modelValue":m[24]||(m[24]=Te=>le(rt)?rt.value=Te:null),base:e(ft)},null,8,["modelValue","base"])):L("",!0),s(hs,{visible:e(K),"onUpdate:visible":m[25]||(m[25]=Te=>le(K)?K.value=Te:null),size:"large"},{default:o(()=>{var Te;return[v("div",ti,[s(ks,{"base-id":(Te=e(a))==null?void 0:Te.id,"source-id":e(re)},null,8,["base-id","source-id"])])]}),_:1},8,["visible"])],64)}}}),si=Ge(ai,[["__scopeId","data-v-d858d216"]]),oi={class:"flex items-center justify-center mt-8"},ni={class:"flex flex-col gap-4 items-center text-gray-500"},li=v("div",{class:"font-weight-medium"},"No Projects",-1),ii=v("div",{class:"text-xs"},"Create Base",-1),ri={class:"flex gap-2 justify mt-1"},ci={class:"flex gap-2 items-center justify-center text-xs"},di=pe({__name:"EmptyPlaceholder",props:{buttons:{type:Boolean}},setup(p){const S=p,c=I(!1),i=I(),n=g=>{i.value=g,c.value=!0};return(g,B)=>{const R=go,V=ra,y=Qs,a=ga;return t(),M("div",oi,[v("div",ni,[s(R),li,S.buttons?(t(),M(ye,{key:0},[ii,v("div",ri,[s(y,{class:"flex-1 nc-btn",onClick:B[0]||(B[0]=h=>n(("NcProjectType"in g?g.NcProjectType:e(yt)).DB))},{default:o(()=>[v("div",ci,[s(V,{type:("NcProjectType"in g?g.NcProjectType:e(yt)).DB,class:"text-[#2824FB] text-lg"},null,8,["type"]),q(" New Database Base ")])]),_:1})]),s(a,{modelValue:e(c),"onUpdate:modelValue":B[1]||(B[1]=h=>le(c)?c.value=h:null),type:e(i)},null,8,["modelValue","type"])],64)):L("",!0)])])}}}),ui=p=>!!(p.offsetWidth||p.offsetHeight||p.getClientRects().length),pi=pe({__name:"ProjectWrapper",props:{baseRole:{default:""},base:{}},setup(p){const S=p,c=He(S,"baseRole"),i=He(S,"base");return vt(as,c),vt(Gt,i),(n,g)=>ca(n.$slots,"default")}}),mi={class:"nc-treeview-container flex flex-col justify-between select-none"},vi={key:0,class:"text-gray-500 font-medium pl-3.5 mb-1"},fi={mode:"inline",class:"nc-treeview pb-0.5 flex-grow min-h-50 overflow-x-hidden"},bi={key:0},_i=pe({__name:"index",setup(p){const{isUIAllowed:S}=ze(),{$e:c}=Me(),i=va(),n=i.currentRoute,g=We(),{createProject:B,updateProject:R}=g,{bases:V,basesList:y,activeProjectId:a}=ee(g),{isWorkspaceLoading:h}=ee(st()),f=I(!1),b=qe(),{isSharedBase:N,base:E}=ee(b),{activeTable:r}=ee(ke()),{isMobileMode:D}=Ce(),l=Ja({}),d=(k,T)=>{l.type=k,l.value=T};function x(k,T=!1){if(!k||!k.source_id)return;c("c:table:rename");const j=I(!0),{close:A}=Ue(cn,{modelValue:j,tableMeta:k,sourceId:k.source_id,"onUpdate:modelValue":G});function G(){j.value=!1,A(1e3)}}function U(k,T){if(!k&&!(T||y.value[0].id))return;c("c:table:create:navdraw");const j=I(!0),{close:A}=Ue(is,{modelValue:j,sourceId:k,baseId:T||y.value[0].id,"onUpdate:modelValue":G});function G(){j.value=!1,A(1e3)}}const $=async k=>{if(!k||!k.id||!k.base_id)return;const T=I(!0);c("c:table:duplicate");const{close:j}=Ue(vn,{modelValue:T,table:k,"onUpdate:modelValue":A});function A(){T.value=!1,j(1e3)}},z=oe(()=>{var k,T,j,A;return((T=(k=E.value)==null?void 0:k.sources)==null?void 0:T[0])&&S("tableCreate",{source:(A=(j=E.value)==null?void 0:j.sources)==null?void 0:A[0]})&&n.value.name!=="index"&&n.value.name!=="index-index"&&n.value.name!=="index-index-create"&&n.value.name!=="index-index-create-external"&&n.value.name!=="index-user-index"});Ka(document,"keydown",async k=>{var j;const T=At()?k.metaKey:k.ctrlKey;if(k.altKey&&!k.shiftKey&&!T)switch(k.keyCode){case 84:{if(z.value&&!Ys()){k.preventDefault(),c("c:shortcut",{key:"ALT + T"});const A=a.value,G=A?V.value.get(A):void 0;if(!G)return;A&&U((j=G.sources)==null?void 0:j[0].id,A)}break}case 76:{n.value.params.baseId&&i.push({query:{...n.value.query,clear:n.value.query.clear==="1"?void 0:"1"}});break}case 68:{k.stopPropagation(),f.value=!0;break}}});const P=k=>{var T;(T=document.querySelector(".source-context, .table-context"))!=null&&T.contains(k.target)||d("main")};vt(ma,{setMenuContext:d,duplicateTable:$,openRenameTableDialog:x,contextMenuTarget:l}),Ka(document,"contextmenu",P,!0);const H=()=>{var T;const k=document.querySelector(`.nc-treeview [data-table-id="${(T=r.value)==null?void 0:T.id}"]`);k&&(k==null||k.scrollIntoView({behavior:"smooth",block:"nearest"}))},O=async k=>{var K,Y;const{moved:{newIndex:T=0,oldIndex:j=0,element:A}}=k;if(!(A!=null&&A.id))return;let G;y.value.length-1===T?G=Math.max(...y.value.map(ce=>(ce==null?void 0:ce.order)??0))+1:T===0?G=Math.min(...y.value.map(ce=>(ce==null?void 0:ce.order)??0))/2:G=(parseFloat(String(((K=y.value[T-1])==null?void 0:K.order)??0))+parseFloat(String(((Y=y.value[T+1])==null?void 0:Y.order)??0)))/2;const re=isNaN(Number(G))?j:G;await R(A.id,{order:re}),c("a:base:reorder")};return Ae(()=>{var k;return(k=r.value)==null?void 0:k.id},()=>{var k;(k=r.value)!=null&&k.id&&setTimeout(()=>{H()},1e3)},{immediate:!0}),Ae(a,()=>{const k=document.querySelector(`.nc-treeview [data-base-id="${a.value}"]`);k&&ui(k)&&(k==null||k.scrollIntoView({behavior:"smooth"}))},{immediate:!0}),(k,T)=>{var re,K;const j=si,A=di,G=ga;return t(),M("div",mi,[e(N)?L("",!0):(t(),M("div",vi,w(k.$t("objects.projects")),1)),v("div",fi,[(re=e(y))!=null&&re.length?(t(),M("div",bi,[s(e(wo),{"model-value":e(y),disabled:e(D)||!e(S)("baseReorder")||((K=e(y))==null?void 0:K.length)<2,"item-key":"id",handle:".base-title-node","ghost-class":"ghost",onChange:T[0]||(T[0]=Y=>O(Y))},{item:o(({element:Y})=>[(t(),M("div",{key:Y.id},[s(pi,{"base-role":Y.project_role,base:Y},{default:o(()=>[s(j)]),_:2},1032,["base-role","base"])]))]),_:1},8,["model-value","disabled"])])):e(h)?L("",!0):(t(),u(A,{key:1}))]),s(G,{modelValue:e(f),"onUpdate:modelValue":T[1]||(T[1]=Y=>le(f)?f.value=Y:null)},null,8,["modelValue"])])}}}),yi=Ge(_i,[["__scopeId","data-v-787048f5"]]),gi={};function wi(p,S){return t(),M("span")}const xi=Ge(gi,[["render",wi]]),ki={};function hi(p,S){return t(),M("span")}const $i=Ge(ki,[["render",hi]]),Ii=kt(()=>ht(()=>import("./z4KLlFmH.js"),__vite__mapDeps([12,13,1,2]),import.meta.url).then(p=>p.default||p)),Ti=kt(()=>ht(()=>import("./CUBk7c72.js"),__vite__mapDeps([14,15,1,2,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]),import.meta.url).then(p=>p.default||p)),Di=p=>(Za("data-v-00e845c1"),p=p(),es(),p),Ci={class:"flex w-full flex-col py-0.9 px-1 border-gray-200 gap-y-1"},Si={class:"flex items-center pr-2 justify-between"},Vi={class:"flex flex-row py-1 px-3 gap-x-2 items-center hover:bg-gray-200 rounded-lg cursor-pointer h-8","data-testid":"nc-sidebar-userinfo"},ji={class:"flex max-w-32 truncate"},Mi={class:"flex gap-2 items-center"},Pi={class:"menu-btn"},Ni={class:"flex gap-2 items-center"},Ei={class:"flex items-center text-gray-400 text-xs"},Bi=Di(()=>v("div",{class:"flex-1"},null,-1)),Li={class:"bg-white max-h-50vh scrollbar-thin-dull min-w-64 !overflow-auto"},Oi={href:"https://docs.nocodb.com",target:"_blank",class:"!underline-transparent",rel:"noopener"},Ui={class:"menu-btn"},Ri=pe({__name:"UserInfo",setup(p){const{user:S,signOut:c,appInfo:i}=Ce();po();const{leftSidebarState:n}=ee(Xt()),g=oe(()=>{var f,b;return(b=(f=S.value)==null?void 0:f.display_name)==null?void 0:b.trim()}),B=I(!1),R=I(!1),V=I(!1),{isMobileMode:y}=Ce(),a=async()=>{var f;V.value=!0;try{const b=!!((f=S==null?void 0:S.value)!=null&&f.sso_client_id);await c(!1),await mt(b?"/sso":"/signin")}catch(b){console.error(b)}finally{V.value=!1}};Ae(B,()=>{R.value&&(R.value=!1)}),Ae(n,()=>{n.value==="peekCloseEnd"&&(B.value=!1)});const h=I(!1);return xt(()=>{h.value=!0}),(f,b)=>{const N=xo,E=Rt,r=Je,D=ua,l=Ft,d=ya,x=Xs,U=Ii,$=ho,z=$i,P=ko,H=Zt,O=Kt,k=Ti,T=je("e");return t(),M("div",Ci,[v("div",Si,[s(O,{visible:e(B),"onUpdate:visible":b[0]||(b[0]=j=>le(B)?B.value=j:null),placement:"topLeft","overlay-class-name":"!min-w-64"},{overlay:o(()=>[s(H,{"data-testid":"nc-sidebar-userinfo"},{default:o(()=>[s(l,{"data-testid":"nc-sidebar-user-logout",onClick:a},{default:o(()=>[Q((t(),M("div",Mi,[e(V)?(t(),u(D,{key:0,class:"!ml-0.5 !mr-0.5 !max-h-4.5 !-mt-0.5"})):(t(),u(r,{key:1,icon:"signout",class:"menu-icon"})),v("span",Pi,w(f.$t("general.logout")),1)])),[[T,["c:user:logout"]]])]),_:1}),s(d),e(i).ee?L("",!0):(t(),M(ye,{key:0},[s(d),s($,{key:"language",class:"lang-menu !py-1.5",placement:"rightBottom"},{content:o(()=>[v("div",Li,[s(U)])]),default:o(()=>[s(l,null,{default:o(()=>[Q((t(),M("div",Ni,[s(r,{icon:"translate",class:"group-hover:text-black nc-language ml-0.25 menu-icon"}),q(" "+w(f.$t("labels.language"))+" ",1),v("div",Ei,w(f.$t("labels.community.communityTranslated")),1),Bi,s(x,{class:"transform group-hover:scale-115 group-hover:text-accent text-xl text-gray-400"})])),[[T,["c:translate:open"]]])]),_:1})]),_:1})],64)),e(y)?L("",!0):(t(),M(ye,{key:1},[s(d),Q((t(),M("a",Oi,[s(l,null,{default:o(()=>[s(r,{icon:"file",class:"menu-icon mt-0.5"}),v("span",Ui,w(f.$t("title.docs")),1)]),_:1})])),[[T,["c:nocodb:docs-open"]]]),s(d),("isEeUI"in f?f.isEeUI:e(at))?(t(),u(z,{key:0})):L("",!0),Q((t(),u(P,{class:"!no-underline",to:"/account/profile"},{default:o(()=>[s(l,null,{default:o(()=>[s(r,{icon:"ncSettings",class:"menu-icon"}),q(" "+w(f.$t("title.accountSettings")),1)]),_:1})]),_:1})),[[T,["c:user:settings"]]])],64))]),_:1})]),default:o(()=>{var j,A;return[v("div",Vi,[s(N,{email:(j=e(S))==null?void 0:j.email,size:"auto",name:(A=e(S))==null?void 0:A.display_name},null,8,["email","name"]),s(E,null,{title:o(()=>{var G;return[v("span",null,w(e(g)?e(g):(G=e(S))==null?void 0:G.email),1)]}),default:o(()=>{var G;return[v("div",ji,w(e(g)?e(g):(G=e(S))==null?void 0:G.email),1)]}),_:1}),s(r,{icon:"chevronDown",class:"flex-none !min-w-5 transform rotate-180 !text-gray-500"})])]}),_:1},8,["visible"]),s(k)]),e(y)||e(i).ee?(t(),M(ye,{key:0},[],64)):L("",!0)])}}}),Ai=Ge(Ri,[["__scopeId","data-v-00e845c1"]]),zi={class:"nc-sidebar flex flex-col bg-gray-50 outline-r-1 outline-gray-100 select-none w-full h-full",style:{outlineWidth:"1px"}},Gi={class:"flex flex-col"},Fi={key:0,class:"border-t-1"},Ki=pe({__name:"Sidebar",setup(p){const S=st(),{isWorkspaceLoading:c}=ee(S),{isSharedBase:i}=ee(qe()),{isMobileMode:n}=Ce(),g=I(),B=I(!1),R=()=>{if(!n.value)return g.value&&(g.value.scrollTop>0?B.value=!0:B.value=!1),!1};return xt(()=>{var V;(V=g.value)==null||V.addEventListener("scroll",R)}),Zs(()=>{var V;(V=g.value)==null||V.removeEventListener("scroll",R)}),(V,y)=>{const a=Bo,h=on,f=yi,b=xi,N=Ai;return t(),M("div",zi,[v("div",Gi,[s(a),e(i)?L("",!0):(t(),u(h,{key:0}))]),v("div",{ref_key:"treeViewDom",ref:g,class:te(["flex flex-col nc-scrollbar-dark-md flex-grow xs:border-transparent xs:pt-2 xs:pr-2",{"border-t-1":!e(i),"border-transparent":!e(B),"pt-0.25":e(i)}])},[e(c)?L("",!0):(t(),u(f,{key:0}))],2),e(i)?L("",!0):(t(),M("div",Fi,[s(b),s(N)]))])}}}),Hi=Ge(Ki,[["__scopeId","data-v-bef420bb"]]),Wi={class:"prose-xl font-bold self-center"},qi=v("div",{class:"my-4"},"Select workspace to duplicate shared base to:",-1),Ji={class:"prose-md self-center text-gray-500 mt-4"},Qi={class:"text-xs p-2"},Yi={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},Xi=pe({__name:"SharedBaseDuplicate",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(p,{emit:S}){const c=p,i=S,{api:n}=zt(),{sharedBaseId:g}=us(),B=st(),{populateWorkspace:R}=B,{workspacesList:V}=ee(B),{ncNavigateTo:y}=Ce(),a=Ye(c,"modelValue",i),h=I({includeData:!0,includeViews:!0}),f=oe(()=>{const{includeData:l,includeViews:d}=h.value;return{excludeData:!l,excludeViews:!d}}),b=I(!1),N=I(),{$e:E,$poller:r}=Me(),D=async()=>{if(!(!N.value&&at))try{b.value=!0;const l=await n.base.duplicateShared(N.value??"nc",g.value,{options:f.value,base:at?{fk_workspace_id:N.value,type:eo.DATABASE}:{}});g.value=null,r.subscribe({id:l.id},async d=>{d.status!=="close"&&(d.status===gt.COMPLETED?(console.log("job completed",l),await y({...at?{workspaceId:l.fk_workspace_id}:{},baseId:l.base_id}),b.value=!1,a.value=!1):d.status===gt.FAILED&&(ue.error("Failed to duplicate shared base"),await R(),b.value=!1,a.value=!1))}),E("a:base:duplicate-shared-base")}catch(l){ue.error(await Se(l)),b.value=!1,a.value=!1}};return(l,d)=>{const x=$o,U=ba,$=_a,z=Ne,P=It,H=je("e");return t(),u(P,{visible:e(a),"onUpdate:visible":d[4]||(d[4]=O=>le(a)?a.value=O:null),class:"!w-[30rem]","wrap-class-name":"nc-modal-project-duplicate"},{default:o(()=>[v("div",null,[v("div",Wi,w(l.$t("general.duplicate"))+" "+w(l.$t("labels.sharedBase")),1),("isEeUI"in l?l.isEeUI:e(at))?(t(),M(ye,{key:0},[qi,s(x,{value:e(N),"onUpdate:value":d[0]||(d[0]=O=>le(N)?N.value=O:null),class:"w-full",options:e(V).map(O=>({label:`${O.title[0].toUpperCase()}${O.title.slice(1)}`,value:O.id})),placeholder:"Select Workspace"},null,8,["value","options"])],64)):L("",!0),v("div",Ji,w(l.$t("title.advancedSettings")),1),s(U,{class:"!m-0 !p-0 !my-2"}),v("div",Qi,[s($,{checked:e(h).includeData,"onUpdate:checked":d[1]||(d[1]=O=>e(h).includeData=O)},{default:o(()=>[q(w(l.$t("labels.includeData")),1)]),_:1},8,["checked"]),s($,{checked:e(h).includeViews,"onUpdate:checked":d[2]||(d[2]=O=>e(h).includeViews=O)},{default:o(()=>[q(w(l.$t("labels.includeView")),1)]),_:1},8,["checked"])])]),v("div",Yi,[s(z,{key:"back",type:"secondary",onClick:d[3]||(d[3]=O=>a.value=!1)},{default:o(()=>[q(w(l.$t("general.cancel")),1)]),_:1}),Q((t(),u(z,{key:"submit",loading:e(b),disabled:!e(N)&&("isEeUI"in l?l.isEeUI:e(at)),onClick:D},{default:o(()=>[q(w(l.$t("general.confirm")),1)]),_:1},8,["loading","disabled"])),[[H,["a:shared-base:duplicate"]]])])]),_:1},8,["visible"])}}}),Zi=kt(()=>ht(()=>import("./BL1VErEj.js"),__vite__mapDeps([31,1,2,8,9,10,27,28,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,19,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64]),import.meta.url).then(p=>p.default||p)),ic=pe({__name:"index",setup(p){const S=I(!1),c=I(""),i=I(""),n=I(),g=We(),{populateWorkspace:B}=st(),{signedIn:R}=Ce(),{isUIAllowed:V}=ze(),a=va().currentRoute,{basesList:h}=ee(g),f=async()=>{const d=a.value.name;d!=="index-typeOrId"&&d!=="index"||await g.navigateToProject({baseId:h.value[0].id})},b=oe(()=>{const d=a.value.name||"";return!d.startsWith("index-typeOrId-baseId-")&&!["index","index-typeOrId"].includes(d)}),N=oe(()=>(a.value.name||"").startsWith("index-typeOrId-form-viewId")),{sharedBaseId:E}=us(),r=I(!1);async function D(){if(!b.value){if(a.value.params.typeOrId==="base"){await B();return}if(!R.value){mt("/signIn");return}await B(),!a.value.params.baseId&&h.value.length>0&&await f()}}Ae(()=>a.value.params.typeOrId,()=>{D()}),xt(()=>{var d;if((d=a.value.query)!=null&&d.continueAfterSignIn)return localStorage.removeItem("continueAfterSignIn"),mt(a.value.query.continueAfterSignIn);{const x=localStorage.getItem("continueAfterSignIn");if(localStorage.removeItem("continueAfterSignIn"),x)return mt({path:x,query:a.value.query})}D().then(()=>{if(E.value){if(!V("baseDuplicate")){ue.error("You are not allowed to create base");return}r.value=!0}})});function l(d,x,U,$){S.value=d??!S.value,c.value=x||"",i.value=U||"",n.value=$||""}return vt(os,l),(d,x)=>{const U=to,$=ao,z=Hi,P=Zi,H=Xi;return t(),M("div",null,[e(N)?(t(),u($,{key:0},{default:o(()=>[s(U)]),_:1})):e(b)?(t(),u($,{key:1,name:"shared-view"},{default:o(()=>[s(U)]),_:1})):(t(),u($,{key:2,name:"dashboard"},{sidebar:o(()=>[s(z)]),content:o(()=>[s(U)]),_:1})),s(P,{"model-value":e(S),"onUpdate:modelValue":x[0]||(x[0]=O=>le(S)?S.value=O:null),"open-key":e(c),"onUpdate:openKey":x[1]||(x[1]=O=>le(c)?c.value=O:null),"data-sources-state":e(i),"onUpdate:dataSourcesState":x[2]||(x[2]=O=>le(i)?i.value=O:null),"base-id":e(n)},null,8,["model-value","open-key","data-sources-state","base-id"]),e(V)("baseDuplicate")?(t(),u(H,{key:3,modelValue:e(r),"onUpdate:modelValue":x[3]||(x[3]=O=>le(r)?r.value=O:null)},null,8,["modelValue"])):L("",!0)])}}});export{ic as default};
