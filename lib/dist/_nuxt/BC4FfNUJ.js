import{e as ye,L as ge,bL as y,g2 as _e,hK as he,r as p,aC as be,aA as ke,aD as xe,f as b,i4 as Se,dz as Oe,h_ as Ce,h5 as $e,cW as Ie,J as Me,cL as Ee,dc as N,F as Ae,hO as ee,ah as Re,ai as Ke,aE as Be,o as f,c as S,N as e,b as I,w as d,ao as T,at as te,Q as M,S as E,a as g,a8 as D,dg as A,d as P,t as _,O as le,W as z,R as q,T as Le,U as Ne,aJ as Pe,y as je,$ as Ve,ds as Fe,_ as Te}from"./DZZ6t_j4.js";import{_ as De}from"./DnSVh-oD.js";import{u as ze}from"./EqBqqo9-.js";import{T as qe}from"./DKoVb009.js";import{R as Ue,_ as He}from"./CFvUUxCy.js";import{S as Je}from"./D_MsYLkT.js";import"./eX8_g88K.js";import"./vll-Pnjv.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";const We=["onKeydown"],Ge={key:0,class:"w-full max-w-full"},Qe={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Xe={key:0,class:"w-full"},Ye={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ze={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},et={class:"flex gap-2 text-gray-500 items-center h-full"},tt={class:"text-xs whitespace-normal"},lt=ye({__name:"SingleSelect",props:{modelValue:{},rowIndex:{},disableOptionCreation:{type:Boolean}},emits:["update:modelValue"],setup(U,{emit:ae}){const se=ae,{isMobileMode:H}=ge(),n=y(_e),B=y(he),j=y(be,p(!1)),J=y(ke,p(!1)),O=y(xe,p(!1)),k=b(()=>J.value||j.value||O.value),C=p(),c=p(!1),L=y(Se,p(!1)),W=y(Oe,p(!1)),G=y(Ce,p(!1)),oe=y($e,p(!1)),{$api:ne}=je(),x=p(),{getMeta:ie}=Ie(),{isUIAllowed:Q,isMetaReadOnly:re}=Me(),{isPg:X,isMysql:ce}=Ee(),R=p(),V=p(!1),Y=b(()=>!W.value&&!U.disableOptionCreation&&Q("fieldEdit")&&!re.value),m=b(()=>{var t,l,i;if(n!=null&&n.value.colOptions){const o=n.value.colOptions?n.value.colOptions.options.filter(a=>a.title!=="")||[]:[];for(const a of o.filter(r=>r.order===null))a.title=a.title.replace(/^'/,"").replace(/'$/,"");let w=1;const v=(((t=N(n.value.meta))==null?void 0:t.limitOptions)||[]).reduce((a,r)=>(w<((r==null?void 0:r.order)??0)&&(w=r.order),{...a,[r.id]:r}),{})??{};return!G.value&&O.value&&((l=N(n.value.meta))!=null&&l.isLimitOption)&&(((i=N(n.value.meta))==null?void 0:i.limitOptions)||[]).length?o.filter(a=>{var r,K;return((r=v[a.id])==null?void 0:r.show)!==void 0?(K=v[a.id])==null?void 0:K.show:!1}).map(a=>{var r;return{...a,value:a.title,order:a.id&&v[a.id]?(r=v[a.id])==null?void 0:r.order:w++}}).sort((a,r)=>a.order-r.order):o.map(a=>({...a,value:a.title}))}return[]}),ue=b(()=>(m.value??[]).every(t=>t.title!==x.value)),F=b(()=>Q("dataEdit")||O.value),h=b(()=>(F.value||O.value)&&k.value),u=b({get:()=>R.value??U.modelValue,set:t=>{if(t&&Y.value&&(m.value??[]).every(l=>l.title!==t))return R.value=t,de();se("update:modelValue",t||null)}});Ae(c,(t,l)=>{var i,o,w,v,a,r;h.value&&(t?(r=(a=(v=C.value)==null?void 0:v.$el)==null?void 0:a.querySelector("input"))==null||r.focus():(w=(o=(i=C.value)==null?void 0:i.$el)==null?void 0:o.querySelector("input"))==null||w.blur())}),ze(J,t=>{var l;switch(t.key){case"Escape":c.value=!1;break;case"Enter":h.value&&k.value&&!c.value&&(c.value=!0);break;case" ":break;default:if(!h.value){t.preventDefault();break}!(t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)&&((l=t.key)==null?void 0:l.length)===1&&!Fe()&&(t.stopPropagation(),c.value=!0);break}});async function de(){var l,i;if(!R.value||W.value)return!1;const t=R.value;if(x.value="",R.value=void 0,t&&!m.value.some(o=>o.title===t))try{m.value.push({title:t,value:t,color:ee.light[(m.value.length+1)%ee.light.length]}),n.value.colOptions={options:m.value.map(({value:w,...v})=>v)};const o={...n.value};o.cdf&&(X(n.value.source_id)&&(o.cdf=o.cdf.substring(o.cdf.indexOf("'")+1,o.cdf.lastIndexOf("'"))),!ce(n.value.source_id)&&!X(n.value.source_id)&&(o.cdf=o.cdf.replace(/''/g,"'"))),await ne.dbTableColumn.update(((l=n.value)==null?void 0:l.fk_column_id)||((i=n.value)==null?void 0:i.id),o),u.value=t,await ie(n.value.fk_model_id,!0)}catch(o){console.log(o),Re.error(await Ke(o))}}const fe=()=>{var t,l,i;H.value||(x.value=(i=(l=(t=C.value)==null?void 0:t.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:i.value)},pe=t=>{c.value&&k.value&&t.stopPropagation(),t.key==="Enter"&&t.stopPropagation(),t.key==="Escape"&&(c.value=!1)},ve=t=>{switch(t.key){case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":t.stopPropagation();break}},me=()=>{c.value=!1,j.value=!1},Z=t=>{var l,i;if((l=t.target)!=null&&l.classList.contains("ant-select-clear")||(i=t.target)!=null&&i.closest(".ant-select-clear"))return u.value="",t.stopPropagation();V.value||(c.value=h.value&&!c.value)};Be(document,"click",t=>{c.value&&C.value&&!C.value.$el.contains(t.target)&&(c.value=!1)},!0);const $=b(()=>m.value.find(t=>{var l,i;return t.value===u.value||t.value===((i=(l=u.value)==null?void 0:l.toString())==null?void 0:i.trim())})),we=()=>{V.value=!0,setTimeout(()=>{V.value=!1},250),!(oe.value&&u.value)&&(c.value=!0)};return(t,l)=>{var K;const i=Ve,o=qe,w=Ue,v=He,a=Je,r=De;return f(),S("div",{class:E(["nc-cell-field h-full w-full flex items-center nc-single-select focus:outline-transparent",{"read-only":e(B),"max-w-full":e(O)}]),onClick:Z,onKeydown:Pe(z(Z,["stop","prevent"]),["enter"])},[!e(G)&&e(O)&&((K=("parseProp"in t?t.parseProp:e(N))(e(n).meta))!=null&&K.isList)?(f(),S("div",Ge,[I(v,{value:e(u),"onUpdate:value":l[0]||(l[0]=s=>le(u)?u.value=s:null),disabled:e(B)||!e(h),class:"nc-field-layout-list",onKeydown:ve,onClick:l[1]||(l[1]=z(()=>{},["stop"]))},{default:d(()=>[(f(!0),S(T,null,te(e(m),s=>(f(),M(w,{key:s.title,value:s.title,"data-testid":`select-option-${e(n).title}-${t.rowIndex}`,class:E(`nc-select-option-${e(n).title}-${s.title}`)},{default:d(()=>[I(o,{class:"rounded-tag max-w-full",color:s.color},{default:d(()=>[g("span",{style:D({color:e(A).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(A).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-small"},[I(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[P(_(s.title),1)]),default:d(()=>[g("span",Qe,_(s.title),1)]),_:2},1024)],4)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128))]),_:1},8,["value","disabled"]),e(u)?(f(),S("div",{key:0,class:"inline-block px-2 pt-2 cursor-pointer text-xs text-gray-500 hover:text-gray-800",onClick:l[2]||(l[2]=s=>u.value="")},_(t.$t("labels.clearSelection")),1)):q("",!0)])):(f(),S(T,{key:1},[e(k)||e(j)?(f(),M(r,{key:1,ref_key:"aselect",ref:C,value:e(u),"onUpdate:value":l[4]||(l[4]=s=>le(u)?u.value=s:null),class:E(["w-full overflow-hidden",{"caret-transparent":!e(F)}]),"allow-clear":!e(n).rqd&&e(h),bordered:!1,open:e(c)&&e(h),disabled:e(B)||!e(h),"show-search":!e(H)&&e(c)&&e(k),"show-arrow":e(F)&&!e(B)&&e(k)&&(e(u)===null||e(u)===void 0),"dropdown-class-name":`nc-dropdown-single-select-cell !min-w-156px ${e(c)&&e(k)?"active":""}`,"dropdown-match-select-width":!0,onSelect:me,onKeydown:l[5]||(l[5]=s=>pe(s)),onSearch:fe,onBlur:l[6]||(l[6]=s=>c.value=!1),onFocus:we},{default:d(()=>[(f(!0),S(T,null,te(e(m),s=>(f(),M(a,{key:s.title,value:s.title,class:E(["gap-2",`nc-select-option-${e(n).title}-${s.title}`]),"data-testid":`select-option-${e(n).title}-${t.rowIndex}`,onClick:l[3]||(l[3]=z(()=>{},["stop"]))},{default:d(()=>[I(o,{class:"rounded-tag max-w-full",color:s.color},{default:d(()=>[g("span",{style:D({color:e(A).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(A).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:E({"text-sm":e(L),"text-small":!e(L)})},[I(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[P(_(s.title),1)]),default:d(()=>[g("span",Ze,_(s.title),1)]),_:2},1024)],6)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128)),e(x)&&e(ue)&&e(Y)?(f(),M(a,{key:e(x),value:e(x)},{default:d(()=>[g("div",et,[(f(),M(Le(("iconMap"in t?t.iconMap:e(Ne)).plusThick),{class:"min-w-4"})),g("div",tt,[P(_(t.$t("msg.selectOption.createNewOptionNamed"))+" ",1),g("strong",null,_(e(x)),1)])])]),_:1},8,["value"])):q("",!0)]),_:1},8,["value","class","allow-clear","open","disabled","show-search","show-arrow","dropdown-class-name"])):(f(),S("div",Xe,[e($)?(f(),M(o,{key:0,class:"rounded-tag max-w-full",color:e($).color},{default:d(()=>[g("span",{style:D({color:e(A).isReadable(e($).color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(A).mostReadable(e($).color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:E({"text-sm":e(L),"text-small":!e(L)})},[I(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[P(_(e($).title),1)]),default:d(()=>[g("span",Ye,_(e($).title),1)]),_:1})],6)]),_:1},8,["color"])):q("",!0)]))],64))],42,We)}}}),wt=Te(lt,[["__scopeId","data-v-d8b993db"]]);export{wt as default};
