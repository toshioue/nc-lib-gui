import{f as se,ai as le,at as A,cB as ne,bL as ie,r as _,gT as oe,g as $,au as ce,N as re,i as me,o as s,c as r,a as l,b as i,w as n,d as b,t as a,P as o,U as y,V as C,W as I,Q as ue,T as R,al as S,ak as U,S as M,am as de,an as z,ao as pe,n as _e,ap as fe,aS as ve,a2 as he,c_ as be,A as ye}from"./B2hUoZAs.js";import{_ as we}from"./7Oy5igNS.js";import{_ as ge}from"./CSOC84UF.js";import"./BWYzyVlv.js";import{I as ke}from"./CwHJfKcC.js";import{_ as xe}from"./C2KHbrGk.js";import"./DMylWvyY.js";import"./Coz9Ftud.js";import"./C9qKCFvP.js";import"./BGKYJ52S.js";import"./i4toF4kp.js";import"./BQQOEPN4.js";import"./kd0F6MQ0.js";import"./U6IX4jMM.js";import"./CvDoTMIT.js";import"./fmNfCaCg.js";import"./CaxUP45y.js";import"./1orNHd0L.js";import"./R1pHeCcp.js";import"./DRJOl617.js";import"./CRF-CdV7.js";import"./Df48od_3.js";const $e={class:"h-full flex flex-row w-full items-center justify-center"},Ce={class:"h-full flex flex-col"},Ie={class:"flex flex-row items-center w-full mb-4 gap-2 justify-between"},Me={class:"flex"},Te={class:"flex items-center gap-2 text-gray-600 font-light"},Ne={class:"flex flex-row items-center w-full gap-x-1"},je={class:"flex"},Le={class:"h-auto max-h-[calc(100%_-_102px)] overflow-y-auto nc-scrollbar-thin"},Ve={key:0,class:"flex flex-row gap-x-1"},Be={class:"flex capitalize"},Ee={key:0},Ae={class:"flex items-center gap-1"},Re={class:"min-w-5 flex items-center justify-center"},Se={key:1},Ue={class:"flex items-center gap-1"},ze={class:"min-w-5 flex items-center justify-center"},De={key:0},Ge={key:0},Pe={key:1},dt=se({__name:"UIAcl",props:{sourceId:{}},setup(D){const G=D,{t:d}=le(),{$api:T,$e:P}=ye(),{base:F}=A(ne()),H=ie(oe,_()),f=$(()=>{var e;return H.value??((e=F.value)==null?void 0:e.id)}),{bases:Q}=A(ce()),N=$(()=>Q.value.get(f.value)??{}),{includeM2M:W}=re(),j=_(["editor","commenter","viewer"]),w=_(!1),g=_([]),v=_(""),p=_({editor:!1,commenter:!1,viewer:!1}),k=$(()=>g.value.filter(e=>(e==null?void 0:e.source_id)===G.sourceId&&(typeof(e==null?void 0:e._ptn)=="string"&&e._ptn.toLowerCase().includes(v.value.toLowerCase())||typeof(e==null?void 0:e.title)=="string"&&e.title.toLowerCase().includes(v.value.toLowerCase()))));async function L(){try{if(!f.value)return;w.value=!0,g.value=await T.base.modelVisibilityList(f.value,{includeM2M:W.value})}catch(e){console.error(e)}finally{w.value=!1}}async function q(){try{if(!f.value)return;await T.base.modelVisibilitySet(f.value,g.value.filter(e=>e.edited)),z.success(d("msg.success.updatedUIACL"))}catch(e){z.error(await pe(e))}P("a:proj-meta:ui-acl")}const J=(e,c)=>{e.disabled[c]=!e.disabled[c],e.edited=!0,p.value[c]=k.value.every(m=>!m.disabled[c])};me(async()=>{g.value.length===0&&await L();for(const e of j.value)p.value[e]=k.value.every(c=>!c.disabled[e])});const h=e=>()=>_e("div",{class:"text-gray-500"},e),K=[{title:h(d("labels.tableName")),name:"Table Name"},{title:h(d("labels.viewName")),name:"View Name"},{title:h(d("objects.roleType.editor")),name:"editor",width:120},{title:h(d("objects.roleType.commenter")),name:"commenter",width:120},{title:h(d("objects.roleType.viewer")),name:"viewer",width:120}],O=e=>{p.value[e]=!p.value[e];const c=p.value[e];k.value.forEach(m=>{m.disabled[e]=!c,m.edited=!0})};return(e,c)=>{const m=fe,X=ke,Y=ve,Z=he,V=we,ee=U,B=ge,te=be,ae=xe;return s(),r("div",$e,[l("div",Ce,[i(m,{class:"mb-4 first-letter:capital font-bold max-w-100 truncate","show-on-truncate-only":""},{title:n(()=>[b(a(o(N).title),1)]),default:n(()=>[l("span",null," UI ACL : "+a(o(N).title),1)]),_:1}),l("div",Ie,[i(X,{value:o(v),"onUpdate:value":c[0]||(c[0]=t=>ue(v)?v.value=t:null),placeholder:e.$t("placeholder.searchModels"),class:"nc-acl-search !w-[400px]"},{prefix:n(()=>[(s(),y(C(("iconMap"in e?e.iconMap:o(I)).search)))]),_:1},8,["value","placeholder"]),l("div",Me,[i(Y,{type:"text",ghost:"",class:"self-start !rounded-md nc-acl-reload",onClick:L},{default:n(()=>[l("div",Te,[(s(),y(C(("iconMap"in e?e.iconMap:o(I)).reload),{class:R({"animate-infinite animate-spin !text-success":o(w)})},null,8,["class"])),b(" "+a(e.$t("general.reload")),1)])]),_:1}),i(Z,{size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:q},{default:n(()=>[l("div",Ne,[(s(),y(C(("iconMap"in e?e.iconMap:o(I)).save))),l("div",je,a(e.$t("general.save")),1)])]),_:1})])]),l("div",Le,[i(ae,{class:"w-full",size:"small","data-source":o(k),columns:K,pagination:!1,loading:o(w),sticky:"",bordered:"","custom-row":t=>({class:`nc-acl-table-row nc-acl-table-row-${t.title}`})},{headerCell:n(({column:t})=>[["editor","commenter","viewer"].includes(t.name)?(s(),r("div",Ve,[i(V,{checked:o(p)[t.name],onChange:()=>O(t.name)},null,8,["checked","onChange"]),l("div",Be,a(t.name),1)])):(s(),r(S,{key:1},[b(a(t.name),1)],64))]),emptyText:n(()=>[i(ee,{image:("Empty"in e?e.Empty:o(U)).PRESENTED_IMAGE_SIMPLE,description:e.$t("labels.noData")},null,8,["image","description"])]),bodyCell:n(({record:t,column:x})=>{var E;return[x.name==="Table Name"?(s(),r("div",Ee,[l("div",Ae,[l("div",Re,[i(B,{meta:{meta:t.table_meta,type:t.ptype},class:"text-gray-500"},null,8,["meta"])]),i(m,{class:"overflow-ellipsis min-w-0 shrink-1 truncate","show-on-truncate-only":""},{title:n(()=>[b(a(t._ptn),1)]),default:n(()=>[l("span",null,a(t._ptn),1)]),_:2},1024)])])):M("",!0),x.name==="View Name"?(s(),r("div",Se,[l("div",Ue,[l("div",ze,[(E=t==null?void 0:t.meta)!=null&&E.icon?(s(),y(B,{key:0,meta:{meta:t.meta,type:"view"},class:"text-gray-500 !text-sm !children:w-5 !children:h-5"},null,8,["meta"])):(s(),y(te,{key:1,meta:t,class:"text-gray-500"},null,8,["meta"]))]),i(m,{class:"overflow-ellipsis min-w-0 shrink-1 truncate","show-on-truncate-only":""},{title:n(()=>[b(a(t.is_default?e.$t("title.defaultView"):t.title),1)]),default:n(()=>[l("span",null,a(t.is_default?e.$t("title.defaultView"):t.title),1)]),_:2},1024)])])):M("",!0),(s(!0),r(S,null,de(o(j),u=>(s(),r("div",{key:u},[x.name===u?(s(),r("div",De,[i(m,null,{title:n(()=>[t.disabled[u]?(s(),r("span",Ge,a(e.$t("labels.clickToMake"))+" '"+a(t.title)+"' "+a(e.$t("labels.visibleForRole"))+" "+a(u)+" "+a(e.$t("labels.inUI"))+" dashboard",1)):(s(),r("span",Pe,a(e.$t("labels.clickToHide"))+" '"+a(t.title)+"' "+a(e.$t("labels.forRole"))+":"+a(u)+" "+a(e.$t("labels.inUI")),1))]),default:n(()=>[i(V,{checked:!t.disabled[u],class:R(`nc-acl-${t.title}-${u}-chkbox !ml-0.25`),onChange:Fe=>J(t,u)},null,8,["checked","class","onChange"])]),_:2},1024)])):M("",!0)]))),128))]}),_:1},8,["data-source","loading","custom-row"])])])])}}});export{dt as default};
