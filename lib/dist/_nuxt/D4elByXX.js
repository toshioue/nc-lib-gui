import{fh as _,f as X,bN as A,r as k,dB as H,hh as I,cN as q,az as C,da as J,d9 as G,cR as P,O as W,o as m,c as L,a as z,t as R,b as B,w as V,R as N,Y as K,P as c,hi as w,S as j,V as O,W as T,d as $,aq as Y,gA as Q,aj as Z,ak as ee,aN as te,ab as oe,A as ne}from"./Cgw6cdOy.js";import{read as ae,writeFile as se}from"./C2piJvdv.js";var U={exports:{}};(function(F,M){(function(E,d){d()})(_,function(){function E(o,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function d(o,t,s){var e=new XMLHttpRequest;e.open("GET",o),e.responseType="blob",e.onload=function(){u(e.response,t,s)},e.onerror=function(){console.error("could not download file")},e.send()}function S(o){var t=new XMLHttpRequest;t.open("HEAD",o,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function y(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(t)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof _=="object"&&_.global===_?_:void 0,b=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!b?function(o,t,s){var e=a.URL||a.webkitURL,n=document.createElement("a");t=t||o.name||"download",n.download=t,n.rel="noopener",typeof o=="string"?(n.href=o,n.origin===location.origin?y(n):S(n.href)?d(o,t,s):y(n,n.target="_blank")):(n.href=e.createObjectURL(o),setTimeout(function(){e.revokeObjectURL(n.href)},4e4),setTimeout(function(){y(n)},0))}:"msSaveOrOpenBlob"in navigator?function(o,t,s){if(t=t||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(E(o,s),t);else if(S(o))d(o,t,s);else{var e=document.createElement("a");e.href=o,e.target="_blank",setTimeout(function(){y(e)})}}:function(o,t,s,e){if(e=e||open("","_blank"),e&&(e.document.title=e.document.body.innerText="downloading..."),typeof o=="string")return d(o,t,s);var n=o.type==="application/octet-stream",p=/constructor/i.test(a.HTMLElement)||a.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent);if((r||n&&p||b)&&typeof FileReader<"u"){var i=new FileReader;i.onloadend=function(){var l=i.result;l=r?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"),e?e.location.href=l:location=l,e=null},i.readAsDataURL(o)}else{var f=a.URL||a.webkitURL,x=f.createObjectURL(o);e?e.location=x:location.href=x,e=null,setTimeout(function(){f.revokeObjectURL(x)},4e4)}});a.saveAs=u.saveAs=u,F.exports=u})})(U);var ie=U.exports;const re={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},de=X({__name:"ExportSubActions",setup(F){const M=A(H,k(!1)),E=A(I,k([])),d=q(),{base:S}=C(d),{$api:y}=ne(),a=A(J,k()),b=A(G),{activeNestedFilters:u,activeSorts:o}=C(P()),t=k(void 0),s=async e=>{var i,f,x,l;let n=0,p=1;const r=e===w.EXCEL?"base64":"blob";t.value=e;try{for(;!isNaN(n)&&n>-1;){let h;if(M.value){const{exportFile:v}=Q();h=await v(E.value,n,e,r,{sortsArr:o.value,filtersArr:u.value})}else h=await y.dbViewRow.export("noco",(i=S.value)==null?void 0:i.id,(f=a.value)==null?void 0:f.id,b==null?void 0:b.value.id,e,{responseType:r,query:{fields:E.value.map(v=>v.title),offset:n,sortArrJson:JSON.stringify(o.value),filterArrJson:JSON.stringify(u.value)}});const{data:g,headers:D}=h;if(e===w.EXCEL){const v=ae(g,{type:"base64"});se(v,`${(x=a.value)==null?void 0:x.title}_exported_${p++}.xlsx`)}else if(e===w.CSV){const v=new Blob([g],{type:"text/plain;charset=utf-8"});ie.saveAs(v,`${(l=a.value)==null?void 0:l.title}_exported_${p++}.csv`)}n=+D["nc-export-offset"],setTimeout(()=>{t.value=void 0},200)}}catch(h){t.value=void 0,Z.error(await ee(h))}};return(e,n)=>{const p=te,r=oe,i=W("e");return m(),L(Y,null,[z("div",re,R(e.$t("labels.downloadData")),1),B(r,{class:"!mx-1 !py-2 !rounded-md"},{default:V(()=>[N((m(),L("div",{class:"flex flex-row items-center nc-base-menu-item !py-0",onClick:n[0]||(n[0]=K(f=>s(c(w).CSV),["stop"]))},[c(t)===c(w).CSV?(m(),j(p,{key:0,class:"!max-h-4.5 !-mt-1 !mr-0.7"})):(m(),j(O(("iconMap"in e?e.iconMap:c(T)).csv),{key:1})),$(" "+R(e.$t("activity.downloadCSV")),1)])),[[i,["a:download:csv"]]])]),_:1}),B(r,{class:"!mx-1 !py-2 !rounded-md"},{default:V(()=>[N((m(),L("div",{class:"flex flex-row items-center nc-base-menu-item !py-0",onClick:n[1]||(n[1]=f=>s(c(w).EXCEL))},[c(t)===c(w).EXCEL?(m(),j(p,{key:0,class:"!max-h-4.5 !-mt-1 !mr-0.7"})):(m(),j(O(("iconMap"in e?e.iconMap:c(T)).excel),{key:1})),$(" "+R(e.$t("activity.downloadExcel")),1)])),[[i,["a:download:excel"]]])]),_:1})],64)}}});export{de as default};
