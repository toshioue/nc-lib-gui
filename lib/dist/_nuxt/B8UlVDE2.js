const __vite__fileDeps=["./DXof0zKo.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as ce,L as re,r as V,iM as pe,fM as de,at as me,aG as ue,o as l,S as c,w as a,a as n,t as r,P as e,b as i,d as m,T as h,V as y,W as M,c as D,U as F,aq as fe,av as _e,Y as E,Q as P,Z as he,a6 as ve,H as ge,$ as xe,a0 as ye,a1 as be,ft as ke}from"./Cgw6cdOy.js";import{_ as we}from"./C6pnOEba.js";import{_ as Ce}from"./WttlrBnq.js";import{_ as $e}from"./ahvdY77A.js";import{a as Me}from"./DFiWgQ57.js";import{u as De}from"./BcWX645D.js";import{i as Fe}from"./C00NHga8.js";import{u as Ie,a as Se,_ as ze,b as Ae}from"./DWwIKYJw.js";import{S as Re}from"./JRGWYtLw.js";import"./KNudlHpk.js";import"./CitraFSq.js";import"./hvq8FVej.js";import"./S1x-kZdE.js";import"./CpJUN2HL.js";import"./CO8XXsKl.js";import"./zKWQxcjd.js";import"./r2PN1Hfg.js";import"./vIgbYHAs.js";import"./DpDIhxXu.js";import"./boyBAVNN.js";import"./D7yS5JAk.js";import"./BtFqRdSP.js";import"./CnN16FGu.js";import"./BBXMuneh.js";import"./DbRkwnd8.js";import"./Bcy-XIkn.js";import"./DPaOlBFV.js";import"./BQQOEPN4.js";import"./C8c9012h.js";import"./BIsWr_mR.js";import"./BZz6iAla.js";import"./DpYA1Dpy.js";import"./dmcxUY_0.js";import"./BcZAlRJW.js";import"./LSbsNkd9.js";import"./C0-Qcoum.js";import"./CHLXm8Ls.js";const Ve=he(()=>ve(()=>import("./DXof0zKo.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(I=>I.default||I)),Ee={class:"flex justify-between pb-6 gap-4"},Ne={class:"font-semibold text-xl"},je={class:"flex items-center gap-2"},Oe={class:"flex gap-2 items-center"},Be={class:"flex gap-2 items-center"},Le={key:0,class:"text-white absolute inset-0 bg-white flex flex-col items-center justify-center gap-2 border-dashed border-1 border-gray-700"},Pe={class:"text-gray-800 text-3xl"},Te=["title"],Ue={class:"flex-none hide-ui transition-all transition-ease-in-out !h-5 gap-0.5 flex items-center bg-white"},Ze={key:0,class:"flex flex-col gap-1"},Ge={class:"nc-attachment h-full w-full flex items-center justify-center"},qe={class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700 mb-4"},He={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},zt=ce({__name:"Modal",setup(I){const{isUIAllowed:S}=re(),{open:T,isLoading:U,isPublic:z,isReadonly:v,visibleItems:N,modalVisible:p,column:Z,FileIcon:G,removeFile:q,onDrop:j,downloadAttachment:H,updateModelValue:K,selectedFile:O,selectedVisibleItems:b,bulkDownloadAttachments:Q,renameFile:W}=Ie(),A=V(),B=V(),{dragging:k}=Se(B,N,K,v),{isOverDropZone:L}=pe(A,j),{isSharedForm:w}=Me(),{getPossibleAttachmentSrc:Y}=De();de("Escape",()=>{p.value=!1,L.value=!1});function R(t){O.value=t,p.value=!1;const s=ge(O,x=>{x||(setTimeout(()=>{p.value=!0},50),s==null||s())})}const g=V(!1),u=me({title:"",i:0});function J(t,s){g.value=!0,u.i=s,u.title=t}ue(A,"paste",t=>{var s;(s=t.clipboardData)!=null&&s.files&&j(t.clipboardData.files)});const X=t=>{q(t),g.value=!1,u.i=0,u.title=""};return(t,s)=>{const x=xe,f=ye,ee=ze,te=we,oe=Ve,ae=Ae,C=be,le=Re,se=ke,ne=Ce,ie=$e;return l(),c(ie,{visible:e(p),"onUpdate:visible":s[2]||(s[2]=$=>P(p)?p.value=$:null),"wrap-class-name":"nc-modal-attachment-expand-cell",class:F(["nc-attachment-modal",{active:e(p)}]),width:"80%"},{default:a(()=>{var $;return[n("div",Ee,[n("div",Ne,r(($=e(Z))==null?void 0:$.title),1),n("div",je,[e(b).length>0?(l(),c(f,{key:0,size:"small",onClick:e(Q)},{default:a(()=>[n("div",Oe,[i(x,{icon:"download"}),m(" "+r(t.$t("activity.bulkDownload")),1)])]),_:1},8,["onClick"])):h("",!0),e(w)||!e(v)&&e(S)("dataEdit")&&!e(z)?(l(),c(f,{key:1,class:"nc-attach-file group",size:"small","data-testid":"attachment-expand-file-picker-button",onClick:e(T)},{default:a(()=>[n("div",Be,[(l(),c(y(("iconMap"in t?t.iconMap:e(M)).cellAttachment),{class:"w-4 h-4"})),m(" "+r(t.$t("activity.attachFile")),1)])]),_:1},8,["onClick"])):h("",!0),i(f,{type:"secondary",size:"small",onClick:s[0]||(s[0]=o=>p.value=!1)},{default:a(()=>[i(x,{icon:"close"})]),_:1})])]),n("div",{ref_key:"dropZoneRef",ref:A,tabindex:"0",class:"relative"},[e(w)||!e(v)&&!e(k)&&e(L)?(l(),D("div",Le,[i(ee,{class:"text-accent",height:"35",width:"35"}),n("div",Pe,r(t.$t("labels.dropHere")),1)])):h("",!0),n("div",{ref_key:"sortableRef",ref:B,class:F([{dragging:e(k)},"grid max-h-140 overflow-auto nc-scrollbar-md md:grid-cols-3 xl:grid-cols-5 gap-y-8 gap-x-4 relative"])},[(l(!0),D(fe,null,_e(e(N),(o,_)=>(l(),D("div",{key:`${o==null?void 0:o.title}-${_}`,class:"nc-attachment-item group gap-1 flex border-1 rounded-md border-gray-200 flex-col relative"},[i(te,{checked:e(b)[_],"onUpdate:checked":d=>e(b)[_]=d,class:F(["nc-attachment-checkbox absolute top-2 left-2 group-hover:opacity-100",{"!opacity-100":e(b)[_]}])},null,8,["checked","onUpdate:checked","class"]),n("div",{class:F([{"cursor-move":e(k),"cursor-pointer":!e(k)},"nc-attachment h-full flex justify-center items-center overflow-hidden"])},[("isImage"in t?t.isImage:e(Fe))(o.title,o.mimetype)?(l(),c(oe,{key:0,srcs:e(Y)(o,"card_cover"),"object-fit":"cover",class:"!w-full object-cover !m-0 rounded-t-[5px] justify-center",onClick:E(d=>R(o),["stop"])},null,8,["srcs","onClick"])):o.icon?(l(),c(y(e(G)(o.icon)),{key:1,height:45,width:45,onClick:E(d=>R(o),["stop"])},null,8,["onClick"])):(l(),c(ae,{key:2,height:45,width:45,onClick:E(d=>R(o),["stop"])},null,8,["onClick"]))],2),n("div",{class:"relative px-1 pb-1 items-center flex",title:o.title},[i(C,{"show-on-truncate-only":"",class:"flex-auto truncate w-full text-[12px] items-center text-gray-700 text-sm line-height-4"},{title:a(()=>[m(r(o.title),1)]),default:a(()=>[m(r(o.title)+" ",1)]),_:2},1024),n("div",Ue,[i(C,{placement:"bottom"},{title:a(()=>[m(r(t.$t("title.downloadFile")),1)]),default:a(()=>[i(f,{class:"!p-0 !w-5 !h-5 text-gray-500 !min-w-[fit-content]",size:"xsmall",type:"text",onClick:d=>e(H)(o)},{default:a(()=>[(l(),c(y(("iconMap"in t?t.iconMap:e(M)).download),{class:"!text-xs h-13px w-13px"}))]),_:2},1032,["onClick"])]),_:2},1024),!e(w)||!e(v)&&e(S)("dataEdit")&&!e(z)?(l(),c(C,{key:0,placement:"bottom"},{title:a(()=>[m(r(t.$t("title.renameFile")),1)]),default:a(()=>[i(f,{size:"xsmall",class:"!p-0 nc-attachment-rename !h-5 !w-5 !text-gray-500 !min-w-[fit-content] gap-2",type:"text",onClick:d=>e(W)(o,_)},{default:a(()=>[(l(),c(y(("iconMap"in t?t.iconMap:e(M)).rename),{class:"text-xs h-13px w-13px"}))]),_:2},1032,["onClick"])]),_:2},1024)):h("",!0),e(w)||!e(v)&&e(S)("dataEdit")&&!e(z)?(l(),c(C,{key:1,placement:"bottom"},{title:a(()=>[m(r(t.$t("title.removeFile")),1)]),default:a(()=>[i(f,{class:"!p-0 !h-4 !w-4 !text-red-500 nc-attachment-remove !min-w-[fit-content]",size:"xsmall",type:"text",onClick:d=>J(o.title,_)},{default:a(()=>[(l(),c(y(("iconMap"in t?t.iconMap:e(M)).delete),{class:"text-xs h-13px w-13px"}))]),_:2},1032,["onClick"])]),_:2},1024)):h("",!0)])],8,Te)]))),128)),e(U)?(l(),D("div",Ze,[i(se,{class:"nc-attachment-item group"},{default:a(()=>[n("div",Ge,[i(le,{class:""})])]),_:1})])):h("",!0)],2)],512),i(ne,{visible:e(g),"onUpdate:visible":s[1]||(s[1]=o=>P(g)?g.value=o:null),"entity-name":"File","on-delete":()=>X(e(u).i)},{"entity-preview":a(()=>[n("span",null,[n("div",qe,[i(x,{icon:"file",class:"nc-view-icon"}),n("div",He,r(e(u).title),1)])])]),_:1},8,["visible","on-delete"])]}),_:1},8,["visible","class"])}}});export{zt as default};
