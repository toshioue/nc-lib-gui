const __vite__fileDeps=["./Co32XBKZ.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./ByVBARmO.js","./BDAIZopQ.js","./VirtualCell.Dgszrgh-.css","./Dby8gS7l.js","./37hePIet.js","./C4K5fdHe.js","./Cell.CE2XxAOg.css","./T8gL-mZl.js","./CvFIzJau.js","./DgixBgIx.js","./DeleteModal.SEMJ_gSK.css","./YB9ISZhn.js","./BVrX6sNU.js","./DKN1hQ6S.js","./BQuyMdA-.js","./BQQOEPN4.js","./vll-Pnjv.js","./B5RRVMt5.js","./DGj1ycqW.js","./DyDFI6NE.js","./hZgTYrdl.js","./d-K880gs.js","./vK-WmZ7a.js","./C3jLTHF4.js","./BYINaHrJ.js","./dfem9Uc_.js","./BCJFTkwv.js","./D9tFZoTQ.js","./3mkq4YHx.js","./Dg0-TbNo.js","./t0mbNaqp.js","./9ZvwAtsX.js","./SelectOptions.JaHDUZhn.css","./CwK0k4WN.js","./toggleHighContrast.wojAGmRG.css","./amsYJsUh.js","./DLDZbX8i.js","./oyD85nwD.js","./D_MsYLkT.js","./CB1aB6F1.js","./B8iX-Tu_.js","./Cz_1GoV3.js","./CJNscGy3.js","./CDWovrGB.js","./Switch.CEh6YzqD.css","./CFvUUxCy.js","./eX8_g88K.js","./Ck-cgwga.js","./Tabs.DaLSLYpn.css","./i4aLU0Nw.js","./GMLocJHP.js","./C9Sjn86N.js","./CXD-Dj4T.js","./CynerQ2m.js","./DnSVh-oD.js","./Select.C8Fy0-eI.css","./CR5b0rlC.js","./ListWithSearch.PmKyjXoQ.css","./B4ZLG6hR.js","./CyRMlOXW.js","./Bdv7ru7D.js","./index.E0_BHHK8.css","./0azk-b-q.js","./BJrIHEse.js","./C3XbZq4f.js","./EditOrAddProvider.4Uf-_8RE.css","./BIhr-Z4C.js","./VirtualCell.BYk4C8Tn.css","./DG2ZH8TR.js","./CA74dF2b.js","./qW2V2r_p.js","./boyBAVNN.js","./Cell.DUBzJZSm.css","./Tryc0omP.js","./Fr_cZ1zf.js","./QHHXY-Ma.js","./Pagination.D7qN7qzC.css","./uskrw1rV.js","./DXQuLwNn.js","./BmtvKY7O.js","./BLzs_b5A.js","./Pagination.Sdu4RSaT.css","./DkmQdKZ4.js","./sz1d3zjm.js","./MenuItem.C7h59s4s.css","./BLgccLvp.js","./Menu.CQ8GNWeI.css","./C8YpY8qO.js","./SubMenu.wOiIU45B.css","./DRXTVn8w.js","./CRPCEw5j.js","./TJfB7GlU.js","./Divider.DqtSqZhb.css","./B9n4-CGo.js","./DivDataCell.1yCNpUg3.css","./DnwRMKX3.js","./UserIcon.DEVmGavY.css","./B6xrG0q8.js","./B89oU1M4.js","./Badge.D0-UrqG9.css","./BmNyaTYf.js","./Cy50pBgZ.js","./links.C8uCzV-l.css","./Dwil3It4.js","./uhBJvRY2.js","./DS_HXCWn.js","./CMIIcM5i.js","./Bgw0NQgX.js","./2FgppHLC.js","./C4o9gerC.js","./B05h-4V9.js","./BqKQ8afS.js","./EqBqqo9-.js","./index.XURKHfTB.css","./Bvfp7LPc.js","./BIg_TdrP.js","./CXKU6jgO.js","./BO2leIU3.js","./D_PA3yCW.js","./DNgdBwTe.js","./DKoVb009.js","./CbjHV4v2.js","./PaginationV2.DYFSvB0K.css","./n-vjrPcC.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var Vl=Object.defineProperty;var Fl=(f,y,i)=>y in f?Vl(f,y,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[y]=i;var ma=(f,y,i)=>(Fl(f,typeof y!="symbol"?y+"":y,i),i);import{bL as Ge,r as h,hA as oa,dz as aa,J as xa,gO as zl,hJ as Gn,f as j,hN as Hn,c$ as $,ik as Ln,ga as na,d4 as ha,ah as Ve,gx as Pl,y as Un,e as So,az as Et,il as Nl,hb as Ol,o as n,c as M,a6 as Il,N as e,dJ as Lo,ag as Ho,dc as Lt,hR as Tl,im as Wn,cq as St,hz as Bl,fO as Gl,aq as Hl,cW as Yn,L as Ra,cL as Vn,ax as Vo,ap as jn,cX as $a,ar as va,aE as Jt,co as xo,aK as Bo,ds as Go,ai as Ul,g$ as Wl,h0 as Yl,f$ as qt,d0 as ya,cr as Kn,cs as _a,a as _,cO as Sa,dw as jl,hD as co,ab as Da,a5 as io,d7 as la,d6 as Aa,hK as Xn,d8 as Kl,io as qn,K as Xl,gT as Ma,hH as ql,ip as Jn,gC as Jl,iq as Ql,ad as Zl,F as Ro,g as ta,k as Qn,cp as er,ir as tr,ac as Qo,M as Fn,a8 as Ye,R as Q,S as De,P as Se,aF as To,b as Y,w as L,V as wa,Q as k,T as ro,U as bo,d as Le,t as J,fE as ba,ao as Xe,at as Ut,O as Ot,W as $t,cm as zn,is as Pn,X as ht,a4 as yt,i8 as or,i9 as ar,a$ as Eo,ia as wo,aL as nr,Y as Zn,a0 as lr,ae as rr,dp as ir,Z as el,it as sr,_ as tl,u as ol,dH as ka,hP as $o,iu as ur,dg as Zo,iv as Nn,aD as dr,i3 as cr,i2 as pr,ib as fr,i1 as mr,iw as vr,ba as wr}from"./DZZ6t_j4.js";import al from"./CRPCEw5j.js";import{a as Uo}from"./B05h-4V9.js";import{u as gr}from"./GMLocJHP.js";import{a as ra}from"./i4aLU0Nw.js";import{u as hr,a as yr}from"./Bvfp7LPc.js";import{a as On,e as ct,c as _r,d as In,f as br}from"./BDAIZopQ.js";import{a as kr}from"./BIg_TdrP.js";import{u as nl}from"./CMIIcM5i.js";import{_ as ll}from"./sz1d3zjm.js";import{_ as rl}from"./BLgccLvp.js";import{_ as xr}from"./TJfB7GlU.js";import{_ as il}from"./vK-WmZ7a.js";import{u as Rr}from"./DS_HXCWn.js";import{u as $r}from"./3mkq4YHx.js";import{a as Sr}from"./qW2V2r_p.js";import{u as Dr}from"./CXKU6jgO.js";import{c as so,d as uo,e as go,i as Ar,a as Mr,g as Cr}from"./ByVBARmO.js";import{H as vo,C as Er}from"./C4K5fdHe.js";import{p as Lr}from"./BO2leIU3.js";import{_ as Vr}from"./D_PA3yCW.js";import{S as Fr}from"./uskrw1rV.js";import{C as zr}from"./DNgdBwTe.js";import{T as Pr}from"./DKoVb009.js";import{_ as Nr,C as Or}from"./CbjHV4v2.js";const[Ir,Tr]=gr((f,y,i)=>{const{$api:V}=Un(),a=Ge(oa,h([])),K=Ge(aa,h(!1)),{gridViewCols:P,updateGridViewColumn:F}=ra(),{nestedFilters:qe}=Uo(),{isUIAllowed:x}=xa(),{fetchAggregatedData:Ne}=zl(),m=h({}),te=Ge(Gn),Z=j(()=>a.value.map((E,ce)=>({field:E,index:ce})).filter(E=>E.index!==0).map(E=>{const ce=P.value[E.field.id];return ce?{value:m.value[E.field.title]??null,field:ce,column:E.field,index:E.index,width:`${Number((ce.width??"").replace("px",""))}px`||"180px"}:{field:null,index:E.index}})),xe=j(()=>{var A;return!((A=a.value)!=null&&A.length)||!P.value?{field:null,width:"180px"}:{value:m.value[a.value[0].title]??null,column:a.value[0],field:P.value[a.value[0].id],width:`${Number((P.value[a.value[0].id].width??"").replace("px",""))+64}px`||"244px"}}),H=A=>{var E,ce;return A.uidt===$.Formula&&((ce=(E=A.colOptions)==null?void 0:E.parsed_tree)!=null&&ce.dataType)?Ln(A.uidt,A.colOptions.parsed_tree):Ln(A.uidt)},W=async A=>{await na(()=>!!y.value).toBeTruthy({timeout:1e4}).then(async()=>{var E,ce;if(!(!((E=f.value)!=null&&E.type)||((ce=f.value)==null?void 0:ce.type)!==ha.GRID))try{const le=K.value?await Ne({where:i==null?void 0:i.value,filtersArr:qe.value,...A?{aggregation:A}:{}}):await V.dbDataTableAggregate.dbDataTableAggregate(y.value.id,{viewId:f.value.id,where:i==null?void 0:i.value,...x("filterSync")?{}:{filterArrJson:JSON.stringify(qe.value)},...A?{aggregation:A}:{}});Object.assign(m.value,le)}catch(le){console.log(le),Ve.error(await Pl(le))}})},b=async(A,E)=>{var ce;await(te==null?void 0:te.trigger({fields:[{title:((ce=a.value.find(le=>le.id===A))==null?void 0:ce.title)??"",aggregation:E}]})),await F(A,{aggregation:E})};return te==null||te.on(async A=>{if((!A||!(A!=null&&A.fields.length))&&await W(),A!=null&&A.fields){const E=A.fields.reduce((ce,le)=>{const X=a.value.find(oe=>oe.title===le.title);return X!=null&&X.id&&(ce[X.id]=le.aggregation??P.value[X.id].aggregation??Hn.None),ce},{});await W(Object.entries(E).map(([ce,le])=>({field:ce,type:le})))}}),{loadViewAggregate:W,isPublic:K,updateAggregate:b,getAggregations:H,displayFieldComputed:xe,visibleFieldsComputed:Z}});function Br(){const f=Tr();if(f==null)throw new Error("Please call `useProvideViewAggregate` on the appropriate parent component");return f}const Gr=So({__name:"TableDataCell",setup(f){const y=h(),i=Lo();return Et(Nl,i),Et(Ol,y),(V,a)=>(n(),M("td",{ref_key:"el",ref:y,class:"select-none",onClick:a[0]||(a[0]=K=>e(i).trigger(K))},[Il(V.$slots,"default")],512))}}),Hr=()=>{const{t:f}=Ho();return{paste:async()=>{try{if(!navigator.clipboard)throw new Error(f("msg.error.pasteFromClipboardError"));const i=await navigator.clipboard.readText(),V=new Event("paste",{bubbles:!1,cancelable:!0});return Object.defineProperty(V,"clipboardData",{value:{getData:()=>i||""}}),document.dispatchEvent(V),!0}catch{return Ve.error(f("msg.error.pasteFromClipboardError")),!1}}}};class Tn{constructor(y=null,i=null){ma(this,"_start");ma(this,"_end");this._start=y,this._end=i??this._start}isEmpty(){return this._start==null||this._end==null}isSingleCell(){var y,i,V,a;return!this.isEmpty()&&((y=this._start)==null?void 0:y.col)===((i=this._end)==null?void 0:i.col)&&((V=this._start)==null?void 0:V.row)===((a=this._end)==null?void 0:a.row)}isSingleRow(){var y,i;return!this.isEmpty()&&((y=this._start)==null?void 0:y.row)===((i=this._end)==null?void 0:i.row)}isCellInRange(y){return!this.isEmpty()&&y.row>=this.start.row&&y.row<=this.end.row&&y.col>=this.start.col&&y.col<=this.end.col}isRowInRange(y){return!this.isEmpty()&&y>=this.start.row&&y<=this.end.row}isColInRange(y){return!this.isEmpty()&&y>=this.start.col&&y<=this.end.col}get start(){var y,i,V,a;return{row:Math.min(((y=this._start)==null?void 0:y.row)??NaN,((i=this._end)==null?void 0:i.row)??NaN),col:Math.min(((V=this._start)==null?void 0:V.col)??NaN,((a=this._end)==null?void 0:a.col)??NaN)}}get end(){var y,i,V,a;return{row:Math.max(((y=this._start)==null?void 0:y.row)??NaN,((i=this._end)==null?void 0:i.row)??NaN),col:Math.max(((V=this._start)==null?void 0:V.col)??NaN,((a=this._end)==null?void 0:a.col)??NaN)}}startRange(y){this._start=y,this._end=y}endRange(y){this._end=y}clear(){this._start=null,this._end=null}}function ko(f,y=!1,i=!1){var x,Ne;const{to:V,value:a,column:K,files:P=[],oldValue:F}=f,qe=y?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";if(a===""&&V!==$.Attachment)return null;switch(V){case $.SingleLineText:case $.LongText:return a.match(/^".*"$/)?a.slice(1,-1):a;case $.Number:{const m=Number(a);if(isNaN(m)){if(i)return null;throw new TypeError(`Cannot convert '${a}' to number`)}return m}case $.Rating:{const m=Number(a??0);if(isNaN(m)){if(i)return null;throw new TypeError(`Cannot convert '${a}' to rating`)}return m}case $.Checkbox:if(typeof a=="boolean")return a;if(typeof a=="string"){const m=a.trim().toLowerCase();if(m==="true"||m==="1")return!0;if(m==="false"||m==="0"||m==="")return!1}return null;case $.Date:case $.DateTime:{let m=St(a,Bl(a));if(m.isValid()||(m=St(a,Gl(a))),!m.isValid()){if(i)return null;throw new Error(`Not a valid '${V}' value`)}return V===$.Date?m.format("YYYY-MM-DD"):m.utc().format("YYYY-MM-DD HH:mm:ssZ")}case $.Time:{let m=St(a);if(m.isValid()||(m=St(a,"HH:mm:ss")),m.isValid()||(m=St(`1999-01-01 ${a}`)),!m.isValid()){if(i)return null;throw new Error("Not a valid time value")}return m.format(qe)}case $.Year:{if(/^\d+$/.test(a))return+a;const m=St(a);if(m.isValid())return m.format("YYYY");if(i)return null;throw new Error("Not a valid year value")}case $.Attachment:{const m=Lt(F),te=m&&Array.isArray(m)?m:[];if(!a&&!P.length)return te.length?void 0:null;let Z=[];if(a){try{Z=Lt(a),Z=Array.isArray(Z)?Z:typeof Z=="object"&&Object.keys(Z).length?[Z]:[]}catch{if(i)return null;throw new Error("Invalid attachment data")}if(Z.some(b=>b&&!(b.url||b.data||b.path)))return null}const H={...{...f.appInfo.ee&&{maxNumberOfAttachments:Math.max(1,+f.appInfo.ncMaxAttachmentsAllowed||50)||50,maxAttachmentSize:Math.max(1,+f.appInfo.ncAttachmentFieldSize||20)||20,supportedAttachmentMimeTypes:["*"]}},...Lt(K==null?void 0:K.meta)},W=[];for(const b of a?Z:P){if(f.appInfo.ee){if(Z.length>H.maxNumberOfAttachments){Ve.error(`You can only upload at most ${H.maxNumberOfAttachments} file${H.maxNumberOfAttachments>1?"s":""} to this cell.`);return}if(b.size>H.maxAttachmentSize*1024*1024){Ve.error(`The size of ${b.name} exceeds the maximum file size ${H.maxAttachmentSize} MB.`);continue}if(!H.supportedAttachmentMimeTypes.includes("*")&&!H.supportedAttachmentMimeTypes.includes(b.type)&&!H.supportedAttachmentMimeTypes.includes(b.type.split("/")[0])){Ve.error(`${b.name} has the mime type ${b.type} which is not allowed in this column.`);continue}}W.push(b)}if(te.length&&!W.length)return;if(a&&W.length){const b=[];for(const A of W)b.push({...A,title:Wn(A==null?void 0:A.title,[...te,...b].map(E=>(E==null?void 0:E.title)||(E==null?void 0:E.fileName)),A==null?void 0:A.mimetype)});return JSON.stringify([...te,...b])}else return P.length&&W.length?W:null}case $.SingleSelect:case $.MultiSelect:{if(a==="")return null;const m=(((x=K.colOptions)==null?void 0:x.options)||[]).map(xe=>xe.title),Z=a.split(",").filter(xe=>m.includes(xe));return Z.length===0?null:Z.join(",")}case $.User:case $.CreatedBy:case $.LastModifiedBy:{let m;try{try{m=typeof a=="string"?JSON.parse(a):a}catch{m=a}}catch{if(i)return null;throw new Error("Invalid user data")}return m||a}case $.LinkToAnotherRecord:{if(i)return;if(uo(K)||go(K)){const m=typeof a=="string"?JSON.parse(a):a;if(!(m&&typeof m=="object"&&!Array.isArray(m)&&Object.keys(m))||(m==null?void 0:m.fk_related_model_id)!==((Ne=K.colOptions)==null?void 0:Ne.fk_related_model_id))throw new Error(`Unsupported conversion for ${V}`);return m}else throw new Error(`Unsupported conversion for ${V}`)}case $.Links:{if(i)return;if(so(K)){const m=typeof a=="string"?JSON.parse(a):a;if(!(m&&typeof m=="object"&&!Array.isArray(m)&&["rowId","columnId","fk_related_model_id","value"].every(te=>m.hasOwnProperty(te)))||(m==null?void 0:m.fk_related_model_id)!==K.colOptions.fk_related_model_id)throw new Error(`Unsupported conversion for ${V}`);return m}else throw new Error(`Unsupported conversion for ${V}`)}case $.Email:return Lt(K.meta).validate&&Tl(a)||a;case $.Lookup:case $.Rollup:case $.Formula:case $.QrCode:{if(i)return;throw new Error(`Unsupported conversion for ${V}`)}default:return a}}const ga=0;function Ur(f,y,i,V,a,K,P,F,qe,x,Ne,m,te,Z,xe,H,W){const b=h(f),{t:A}=Ho(),{copy:E}=Hl(),{getMeta:ce}=Yn(),{appInfo:le}=Ra(),{isMysql:X,isPg:oe}=Vn(),{base:ve}=Vo(Vn()),{api:ie}=jn(),{addUndo:fe,clone:re,defineViewScope:v}=$a(),{isDataReadOnly:we}=xa(),se=h(V),Re=h(!1),_e=h(!1),$e=h(xe),He=h(H),u=va(new Tn),T=va(new Tn),c=va({row:null,col:null}),r=j(()=>{var l;return(l=e(y))==null?void 0:l.length}),C=j(()=>!(c.row===null||c.col===null||isNaN(c.row)||isNaN(c.col)));function g(l,d){c.row===l&&c.col===d||(se.value=!1,c.row=l,c.col=d)}function N(l){const d=B(l),p=I(l);return`${d} ${p}`}function B(l){var d;return((d=Lt(l==null?void 0:l.meta))==null?void 0:d.date_format)??Kn[0]}function I(l){var d;return((d=Lt(l==null?void 0:l.meta))==null?void 0:d.time_format)??_a[0]}const ae=(l,d)=>{var ue,Fe;let p=d.title&&l.row[d.title]||"";if(d.uidt===$.Checkbox&&(p=!!p),[$.User,$.CreatedBy,$.LastModifiedBy].includes(d.uidt)&&p&&(p=Array.isArray(p)?p:[p].map(O=>O.email).join(", ")),(uo(d)||go(d))&&(p={fk_related_model_id:d.colOptions.fk_related_model_id,value:p||null}),so(d)&&(p={rowId:ct(l.row,(ue=b.value)==null?void 0:ue.columns),columnId:d.id,fk_related_model_id:d.colOptions.fk_related_model_id,value:isNaN(+p)?0:+p}),typeof p=="object"?p=JSON.stringify(p):p=p.toString(),d.uidt===$.Formula&&(p=p.replace(/\b(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}[+-]\d{2}:\d{2})\b/g,O=>St(O).utc().local().format("YYYY-MM-DD HH:mm"))),[$.DateTime,$.CreatedTime,$.LastModifiedTime].includes(d.uidt)){p=p.replace(/["']/g,"");const O=X(d.source_id);let ge=St(p);if(ge.isValid()||(ge=St(p,O?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),p=ge.format(N(d)),!ge.isValid())return""}if(d.uidt===$.Date){const O=(Fe=Lt(d.meta))==null?void 0:Fe.date_format;O&&Yl(O)?p=St(p,O).format(O):p=St(p,"YYYY-MM-DD").format(O)}if(d.uidt===$.Time){p=p.replace(/["']/g,"");const O=X(d.source_id),ge=oe(d.source_id);let me=St(p);if(me.isValid()||(me=St(p,O?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),me.isValid()||(me=O||ge?St(p,"HH:mm:ss"):St(p)),!me.isValid())return"";p=me.format(I(d))}return d.uidt===$.LongText&&(p=`"${p.replace(/"/g,'\\"')}"`),p},q=(l,d)=>{let p="<table>",ue="";const Fe=[];return l.forEach((O,ge)=>{let me="<tr>";const lt=[];d.forEach((Ft,ut)=>{const pt=ae(O,Ft);me+=`<td>${pt}</td>`,ue=`${ue}${pt}${d.length-1!==ut?"	":""}`,lt.push(pt)}),p+=`${me}</tr>`,l.length-1!==ge&&(ue=`${ue}
`),Fe.push(lt)}),p+="</table>",{html:p,text:ue,json:Fe}},Je=async(l,d)=>{var ge;const{html:p,text:ue}=q(l,d),Fe=new Blob([p],{type:"text/html"}),O=new Blob([ue],{type:"text/plain"});return((ge=navigator.clipboard)==null?void 0:ge.write([new ClipboardItem({[Fe.type]:Fe,[O.type]:O})]))??E(ue)};async function _t(l){try{if(u.start!==null&&u.end!==null&&!u.isSingleCell()){const d=e(i).slice(u.start.row,u.end.row+1),p=e(y).slice(u.start.col,u.end.col+1);await Je(d,p),Ve.success(A("msg.info.copiedToClipboard"))}else{const d=(l==null?void 0:l.row)??c.row,p=(l==null?void 0:l.col)??c.col;if(d!=null&&p!=null){const ue=e(i)[d],Fe=e(y)[p],O=ae(ue,Fe);await E(O),Ve.success(A("msg.info.copiedToClipboard"))}}}catch{Ve.error(A("msg.error.copyToClipboardError"))}}const Vt=j(()=>{const l={};if(T._start===null||T._end===null)return l;for(let d=T.start.row;d<=T.end.row;d++)for(let p=T.start.col;p<=T.end.col;p++)l[`${d}-${p}`]=!0;return l}),tt=j(()=>{const l={};if(c.row!==null&&c.col!==null&&(l[`${c.row}-${c.col}`]=!0),u._start===null||u._end===null)return l;for(let d=u.start.row;d<=u.end.row;d++)for(let p=u.start.col;p<=u.end.col;p++)l[`${d}-${p}`]=!0;return l}),Wt=(l,d,p=!1)=>!l||!d?(p&&Ve.info("Please select a cell to paste"),!1):qt(d)||ya(d)?(p&&Ve.info(A("msg.info.pasteNotSupported")),!1):d.ai?(p&&Ve.info(A("msg.info.autoIncFieldNotEditable")),!1):d.pk&&!l.rowMeta.new?(p&&Ve.info(A("msg.info.editingPKnotSupported")),!1):!0;function st(l,d,p){if(_e.value){const ue=e(i)[d];if(!u._start||!u._end||ue.rowMeta.new)return;T.endRange({row:d,col:u._end.col}),x==null||x(d,p);return}Re.value&&(u.endRange({row:d,col:p}),x==null||x(d,p),l.preventDefault())}function Do(l,d,p){if(!(((l==null?void 0:l.button)!==ga||(l==null?void 0:l.button)===ga&&l.ctrlKey)&&tt.value[`${d}-${p}`])){if(se.value||(Re.value=!0),K.value=!1,l.preventDefault(),l.shiftKey){(c.col===null||c.row===null)&&u.startRange({row:d,col:p}),u.endRange({row:d,col:p});return}u.startRange({row:d,col:p}),(c.row!==d||c.col!==p)&&(c.row=null,c.col=null)}}const z=(l,d,p)=>{(!l.shiftKey||c.col===null||c.row===null)&&g(d,p),x==null||x(d,p)},it=l=>{var d;if(_e.value){if(_e.value=!1,T._start===null||T._end===null)return;if(u._start!==null&&u._end!==null){const p={row:u._start.row,col:u._start.col},ue=e(i).slice(u.start.row,u.end.row+1),Fe=e(y).slice(u.start.col,u.end.col+1),O=q(ue,Fe).json,ge=T._start.row<=T._end.row?1:-1;let me=ge===1?0:O.length-1;const lt=[],Ft=[];for(let ut=T._start.row;ge===1?ut<=T._end.row:ut>=T._end.row;ut+=ge){if(tt.value[`${ut}-${u.start.col}`])continue;const pt=e(i)[ut];let Gt=0;for(let jt=T.start.col;jt<=T.end.col;jt++){const ft=e(y)[jt];if(!Wt(pt,ft)){Gt++;continue}Ft.push(ft.title);const zt=ko({value:O[me][Gt],to:ft.uidt,column:ft,appInfo:e(le)},X((d=b.value)==null?void 0:d.source_id),!0);zt!==void 0&&(pt.row[ft.title]=zt,lt.push(pt)),Gt++}ge===1?me=me<O.length-1?me+1:0:me=me>=1?me-1:O.length-1}te==null||te(lt,Ft).then(()=>{T._start===null||T._end===null||(u.startRange(p),u.endRange(T._end),g(p.row,p.col),T.clear())})}else T.clear();return}Re.value&&(Re.value=!1,setTimeout(()=>{u._start&&(c.row!==u._start.row||c.col!==u._start.col)&&g(u._start.row,u._start.col)},0))},Dt=async l=>{var p,ue,Fe,O,ge,me,lt,Ft,ut,pt,Gt,jt,ft,zt,Qt,mt,Ue,Kt,po,de,G,rt,Ae,ot,bt,Oe,at,vt,ze,Me,nt,Ce;if(await(Ne==null?void 0:Ne(l)))return!0;if(xo()||!C.value||c.row===null||c.col===null)return;const d=Bo()?l.metaKey:l.ctrlKey;switch(l.key){case"Tab":l.preventDefault(),u.clear(),l.shiftKey?c.col>0?(c.col--,se.value=!1):c.row>0&&(c.row--,c.col=e(r.value)-1,se.value=!1):c.col<e(r.value)-1?(c.col++,se.value=!1):c.row<e(i).length-1&&(c.row++,c.col=0,se.value=!1),x==null||x();break;case"Enter":l.preventDefault(),u.clear(),qe(e(i)[c.row],e(y)[c.col]);break;case"Delete":case"Backspace":if(l.preventDefault(),we.value)return;u.isSingleCell()?(u.clear(),await P(c)):await F();break;case"ArrowRight":l.preventDefault(),l.shiftKey?d?(se.value=!1,u.endRange({row:((p=u._end)==null?void 0:p.row)??c.row,col:e(r.value)-1}),x==null||x((ue=u._end)==null?void 0:ue.row,(Fe=u._end)==null?void 0:Fe.col)):(((O=u._end)==null?void 0:O.col)??c.col)<e(r.value)-1&&(se.value=!1,u.endRange({row:((ge=u._end)==null?void 0:ge.row)??c.row,col:(((me=u._end)==null?void 0:me.col)??c.col)+1}),x==null||x((lt=u._end)==null?void 0:lt.row,(Ft=u._end)==null?void 0:Ft.col)):(u.clear(),c.col<e(r.value)-1&&(c.col++,u.startRange({row:c.row,col:c.col}),x==null||x(),se.value=!1));break;case"ArrowLeft":l.preventDefault(),l.shiftKey?d?(se.value=!1,u.endRange({row:((ut=u._end)==null?void 0:ut.row)??c.row,col:0}),x==null||x((pt=u._end)==null?void 0:pt.row,(Gt=u._end)==null?void 0:Gt.col)):(((jt=u._end)==null?void 0:jt.col)??c.col)>0&&(se.value=!1,u.endRange({row:((ft=u._end)==null?void 0:ft.row)??c.row,col:(((zt=u._end)==null?void 0:zt.col)??c.col)-1}),x==null||x((Qt=u._end)==null?void 0:Qt.row,(mt=u._end)==null?void 0:mt.col)):(u.clear(),c.col>0&&(c.col--,u.startRange({row:c.row,col:c.col}),x==null||x(),se.value=!1));break;case"ArrowUp":l.preventDefault(),l.shiftKey?d?(se.value=!1,u.endRange({row:0,col:((Ue=u._end)==null?void 0:Ue.col)??c.col}),x==null||x((Kt=u._end)==null?void 0:Kt.row,(po=u._end)==null?void 0:po.col)):(((de=u._end)==null?void 0:de.row)??c.row)>0&&(se.value=!1,u.endRange({row:(((G=u._end)==null?void 0:G.row)??c.row)-1,col:((rt=u._end)==null?void 0:rt.col)??c.col}),x==null||x((Ae=u._end)==null?void 0:Ae.row,(ot=u._end)==null?void 0:ot.col)):(u.clear(),c.row>0&&(c.row--,u.startRange({row:c.row,col:c.col}),x==null||x(),se.value=!1));break;case"ArrowDown":l.preventDefault(),l.shiftKey?d?(se.value=!1,u.endRange({row:e(i).length-1,col:((bt=u._end)==null?void 0:bt.col)??c.col}),x==null||x((Oe=u._end)==null?void 0:Oe.row,(at=u._end)==null?void 0:at.col)):(((vt=u._end)==null?void 0:vt.row)??c.row)<e(i).length-1&&(se.value=!1,u.endRange({row:(((ze=u._end)==null?void 0:ze.row)??c.row)+1,col:((Me=u._end)==null?void 0:Me.col)??c.col}),x==null||x((nt=u._end)==null?void 0:nt.row,(Ce=u._end)==null?void 0:Ce.col)):(u.clear(),c.row<e(i).length-1&&(c.row++,u.startRange({row:c.row,col:c.col}),x==null||x(),se.value=!1));break;default:{const U=e(i)[c.row],ke=e(y)[c.col];if((!e(se)||!On(ke))&&!Go()&&(Bo()?l.metaKey:l.ctrlKey))switch(l.keyCode){case 67:await _t();break;case 65:u.startRange({row:0,col:0}),u.endRange({row:e(i).length-1,col:e(r.value)-1});break}if(e(se)||l.ctrlKey||l.altKey||l.metaKey)return!0;if(l.key.length===1){if(!e(a)&&!U.rowMeta.new)return Ve.info(A("msg.info.updateNotAllowedWithoutPK"));On(ke)&&qe(U,ke)&&ke.title&&(ke.uidt===$.LongText?U.row[ke.title]==="<br />"?U.row[ke.title]=l.key:Lt(ke.meta).richMode&&(U.row[ke.title]=U.row[ke.title]?U.row[ke.title]+l.key:l.key):U.row[ke.title]="")}}break}},Fo=()=>u.clear(),zo=u.clear.bind(u),Yt=async l=>{var p,ue,Fe,O,ge,me,lt,Ft,ut,pt,Gt,jt,ft,zt,Qt,mt,Ue,Kt,po;if(we.value||Go()||xo()||!C.value||e(se)||c.row===null||c.row===void 0||c.col===null||c.col===void 0)return;l.preventDefault();let d=((p=l.clipboardData)==null?void 0:p.getData("text/plain"))||"";d!=null&&d.endsWith(`
`)&&(d=d.replace(/\n$/,""));try{if(d!=null&&d.includes(`
`)||d!=null&&d.includes("	")){const de=Lr.parse(d,{delimiter:"	",escapeChar:"\\"});if(de.errors.length>0)throw new Error(de.errors[0].message);const G=de.data,rt=Math.max(G.length,u.end.row-u.start.row+1),Ae=rt,ot=G[0].length,bt=e(y).slice(c.col,c.col+ot),Oe=e(i).slice(c.row,c.row+rt),at=[];let vt=0,ze=!1;for(let Me=0;Me<Ae;Me++){const nt=Oe[Me];if(!nt||nt.rowMeta.new)break;vt++;for(let Ce=0;Ce<ot;Ce++){const U=bt[Ce];if(!Wt(nt,U)){(uo(U)||go(U)||so(U))&&!ze&&(Ve.info(A("msg.info.groupPasteIsNotSupportedOnLinksColumn")),ze=!0);continue}at.push(U.title);const ke=ko({value:G[Me%G.length][Ce],to:U.uidt,column:U,appInfo:e(le),oldValue:U.uidt===$.Attachment?nt.row[U.title]:void 0},X((ue=b.value)==null?void 0:ue.source_id),!0);ke!==void 0&&(nt.row[U.title]=ke)}}await(te==null?void 0:te(Oe,at)),vt>0&&(u.startRange({row:c.row,col:c.col}),u.endRange({row:c.row+vt-1,col:c.col+ot-1}))}else if(u.isSingleCell()){const de=e(i)[c.row],G=e(y)[c.col];if(uo(G)&&!((Fe=G.meta)!=null&&Fe.custom)){const Ae=ko({value:d,to:G.uidt,column:G,appInfo:e(le)},X((O=b.value)==null?void 0:O.source_id));if(Ae===void 0)return;const ot=(me=(ge=b.value)==null?void 0:ge.columns)==null?void 0:me.find(Oe=>{var at;return Oe.id===((at=G.colOptions)==null?void 0:at.fk_child_column_id)});if(!ot)return;const bt=await ce(G.colOptions.fk_related_model_id);return de.oldRow[G.title]=de.row[G.title],de.oldRow[ot.title]=de.row[G.title]?ct(de.row[G.title],bt.columns):null,de.row[G.title]=Ae==null?void 0:Ae.value,de.row[ot.title]=Ae!=null&&Ae.value?ct(Ae.value,bt.columns):null,await(m==null?void 0:m({...c,updatedColumnTitle:ot.title}))}if(so(G)){const Ae=ko({value:d,to:G.uidt,column:G,appInfo:e(le)},X((lt=b.value)==null?void 0:lt.source_id));if(Ae===void 0)return;const ot=ct(de.row,(Ft=b.value)==null?void 0:Ft.columns);if(!ot)return;const bt=de.row[G.title];de.row[G.title]=Ae.value;let Oe;try{Oe=await ie.dbDataTableRow.nestedListCopyPasteOrDeleteAll((ut=b.value)==null?void 0:ut.id,G.id,[{operation:"copy",rowId:Ae.rowId,columnId:Ae.columnId,fk_related_model_id:Ae.fk_related_model_id},{operation:"paste",rowId:ot,columnId:G.id,fk_related_model_id:G.colOptions.fk_related_model_id||Ae.fk_related_model_id}],{viewId:(pt=$e==null?void 0:$e.value)==null?void 0:pt.id})}catch{de.row[G.title]=bt;return}if(Oe&&(Oe!=null&&Oe.link)&&(Oe!=null&&Oe.unlink)&&Array.isArray(Oe.link)&&Array.isArray(Oe.unlink)){if(!Oe.link.length&&!Oe.unlink.length){de.row[G.title]=bt;return}fe({redo:{fn:async(at,vt,ze,Me,nt,Ce)=>{var U,ke,Pt,Zt,Pe,eo,to,At;if(((U=He.value)==null?void 0:U.pageSize)===(Me==null?void 0:Me.pageSize)){((ke=He.value)==null?void 0:ke.page)!==(Me==null?void 0:Me.page)&&await(W==null?void 0:W(Me==null?void 0:Me.page));const Mt=ct(ze.row,(Pt=b.value)==null?void 0:Pt.columns),Qe=e(i)[at.row],fo=e(y)[at.col];if(Mt===ct(Qe.row,(Zt=b.value)==null?void 0:Zt.columns)&&fo.id===vt.id)await Promise.all([Ce.link.length&&ie.dbDataTableRow.nestedLink((Pe=b.value)==null?void 0:Pe.id,fo.id,encodeURIComponent(Mt),Ce.link,{viewId:(eo=$e==null?void 0:$e.value)==null?void 0:eo.id}),Ce.unlink.length&&ie.dbDataTableRow.nestedUnlink((to=b.value)==null?void 0:to.id,fo.id,encodeURIComponent(Mt),Ce.unlink,{viewId:(At=$e==null?void 0:$e.value)==null?void 0:At.id})]),Qe.row[fo.title]=nt,await(m==null?void 0:m(at));else throw new Error(A("msg.recordCouldNotBeFound"))}else throw new Error(A("msg.pageSizeChanged"))},args:[re(c),re(G),re(de),re(He.value),re(Ae.value),Oe]},undo:{fn:async(at,vt,ze,Me,nt,Ce)=>{var U,ke,Pt,Zt,Pe,eo;if(((U=He.value)==null?void 0:U.pageSize)===Me.pageSize){((ke=He.value)==null?void 0:ke.page)!==Me.page&&await(W==null?void 0:W(Me.page));const to=ct(ze.row,(Pt=b.value)==null?void 0:Pt.columns),At=e(i)[at.row],Mt=e(y)[at.col];if(to===ct(At.row,(Zt=b.value)==null?void 0:Zt.columns)&&Mt.id===vt.id)await Promise.all([Ce.unlink.length&&ie.dbDataTableRow.nestedLink((Pe=b.value)==null?void 0:Pe.id,Mt.id,encodeURIComponent(to),Ce.unlink),Ce.link.length&&ie.dbDataTableRow.nestedUnlink((eo=b.value)==null?void 0:eo.id,Mt.id,encodeURIComponent(to),Ce.link)]),At.row[Mt.title]=nt,await(m==null?void 0:m(at));else throw new Error(A("msg.recordCouldNotBeFound"))}else throw new Error(A("msg.pageSizeChanged"))},args:[re(c),re(G),re(de),re(He.value),re(bt),Oe]},scope:v({view:$e==null?void 0:$e.value})})}return await(m==null?void 0:m(c))}if(!Wt(de,G,!0))return;const rt=ko({value:d,to:G.uidt,column:G,appInfo:e(le),files:G.uidt===$.Attachment&&((jt=(Gt=l.clipboardData)==null?void 0:Gt.files)!=null&&jt.length)?(ft=l.clipboardData)==null?void 0:ft.files:void 0,oldValue:de.row[G.title]},X((zt=b.value)==null?void 0:zt.source_id));if(G.uidt===$.Attachment&&((mt=(Qt=l.clipboardData)==null?void 0:Qt.files)!=null&&mt.length)&&(rt!=null&&rt.length)){const Ae=await ho(rt,G.id,de.row[G.title]);de.row[G.title]=Ae?JSON.stringify(Ae):null}else rt!==void 0&&(de.row[G.title]=rt);await(m==null?void 0:m(c))}else{const de=u.start,G=u.end,rt=Math.min(de.row,G.row),Ae=Math.max(de.row,G.row),ot=Math.min(de.col,G.col),bt=Math.max(de.col,G.col),Oe=e(y).slice(ot,bt+1),at=e(i).slice(rt,Ae+1),vt=[];let ze,Me=!1;const nt=(Ue=l.clipboardData)==null?void 0:Ue.files;for(const Ce of at)if(!(!Ce||Ce.rowMeta.new))for(const U of Oe){if(!U.title||!Wt(Ce,U)){(uo(U)||go(U)||so(U))&&!Me&&(Ve.info(A("msg.info.groupPasteIsNotSupportedOnLinksColumn")),Me=!0);continue}if(nt!=null&&nt.length){if(U.uidt!==$.Attachment)continue;if(ze===void 0){const ke=ko({value:"",to:U.uidt,column:U,appInfo:e(le),files:nt,oldValue:Ce.row[U.title]},X((Kt=b.value)==null?void 0:Kt.source_id),!0);if(ke!=null&&ke.length){const Pt=await ho(ke,U.id,Ce.row[U.title]);ze=Pt?JSON.stringify(Pt):null}}}else ze=ko({value:d,to:U.uidt,column:U,appInfo:e(le),oldValue:Ce.row[U.title]},X((po=b.value)==null?void 0:po.source_id),!0);vt.push(U.title),ze!==void 0&&(Ce.row[U.title]=ze)}if(!vt.length)return;await(te==null?void 0:te(at,vt))}}catch(de){console.error(de),Ve.error(await Ul(de))}};function Po(l){var d,p;(l==null?void 0:l.button)===ga&&(_e.value=!0,u._start&&u._end&&(T.startRange({row:(d=u._start)==null?void 0:d.row,col:u._start.col}),T.endRange({row:(p=u._end)==null?void 0:p.row,col:u._end.col})),l.preventDefault())}async function ho(l,d,p){var Fe;const ue=[];try{const O=await ie.storage.upload({path:[Wl,ve.value.id,(Fe=b.value)==null?void 0:Fe.id,d].join("/")},{files:l});for(const ge of O)ue.push({...ge,title:Wn(ge==null?void 0:ge.title,[...be(p),...ue].map(me=>(me==null?void 0:me.title)||(me==null?void 0:me.fileName)),ge==null?void 0:ge.mimetype)});return ue}catch(O){Ve.error(O.message||A("msg.error.internalError"))}}function be(l){const d=Lt(l);return d&&Array.isArray(d)?d:[]}return Jt(document,"keydown",Dt),Jt(document,"mouseup",it),Jt(document,"paste",Yt),Jt(Z,"mousedown",Po),{isCellActive:C,handleMouseDown:Do,handleMouseOver:st,clearSelectedRange:zo,copyValue:_t,activeCell:c,handleCellClick:z,resetSelectedRange:Fo,selectedRange:u,makeActive:g,isMouseDown:Re,isFillMode:_e,selectRangeMap:tt,fillRangeMap:Vt}}const Wr={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Yr=_("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 14H5.2L4 17.2V4h16z"},null,-1),jr=[Yr];function Kr(f,y){return n(),M("svg",Wr,[...jr])}const Xr={name:"mdi-message-outline",render:Kr},qr={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Jr=_("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 4.1L14.1 6l1.4 1.4L16.9 6L18 7.1l-1.4 1.4L18 9.9L16.9 11l-1.4-1.4l-1.4 1.4L13 9.9l1.4-1.4zm-6.8.6h5v1.5h-5zm5.3 8.3h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2zm6.5 1.2h-5v-1.5h5zm0-2.4h-5v-1.5h5z"},null,-1),Qr=[Jr];function Zr(f,y){return n(),M("svg",qr,[...Qr])}const ei={name:"mdi-calculator-variant",render:Zr},ti={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},oi=_("path",{fill:"currentColor",d:"M2 12a9 9 0 0 0 9 9c2.39 0 4.68-.94 6.4-2.6l-1.5-1.5A6.7 6.7 0 0 1 11 19c-6.24 0-9.36-7.54-4.95-11.95S18 5.77 18 12h-3l4 4h.1l3.9-4h-3a9 9 0 0 0-18 0"},null,-1),ai=[oi];function ni(f,y){return n(),M("svg",ti,[...ai])}const li={name:"mdi-reload",render:ni},ri={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ii=_("path",{fill:"currentColor",d:"M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2zm-7 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm11 7h3V8h2v3h3v2h-3v3h-2v-3h-3z"},null,-1),si=[ii];function ui(f,y){return n(),M("svg",ri,[...si])}const di={name:"mdi-table-column-plus-after",render:ui},ci=({fields:f,tableBodyEl:y,gridWrapper:i})=>{const{eventBus:V,isDefaultView:a,meta:K}=Uo(),{addUndo:P,defineViewScope:F}=$a(),{activeView:qe}=Vo(Sa()),{gridViewCols:x,updateGridViewColumn:Ne}=ra(),{leftSidebarWidth:m}=Vo(nl()),{width:te}=jl(),Z=h(!1),xe=h(null),H=h(null),W=h(null),b=(oe,ve)=>{var fe,re,v,we,se;if(!((fe=K.value)!=null&&fe.columns))return;const ie=K.value.columns.findIndex(Re=>Re.id===oe);ie!==-1&&(K.value.columns[ie].meta={...Lt(((re=K.value.columns[ie])==null?void 0:re.meta)||{}),defaultViewColOrder:ve},K.value.columns=(K.value.columns||[]).map(Re=>(Re.id!==oe||(Re.meta={...Lt(Re.meta||{}),defaultViewColOrder:ve}),Re))),(we=(v=K.value)==null?void 0:v.columnsById)!=null&&we[oe]&&(K.value.columnsById[oe].meta={...Lt((se=K.value.columns[ie])==null?void 0:se.meta),defaultViewColOrder:ve})},A=async(oe,ve)=>{const ie=x.value[oe],fe=x.value[ve];if(!ie||!fe)return;const re=f.value.findIndex(He=>He.id===ve),v=re<f.value.length-1?f.value[re+1]:null,we=v?x.value[v.id]:null,se=f.value[f.value.length-1],Re=x.value[se.id];if(we===null&&Re===null)return;const _e=we?fe.order+(we.order-fe.order)/2:Re.order+1,$e=ie.order;ie.order=_e,a.value&&ie.fk_column_id&&b(ie.fk_column_id,_e),P({undo:{fn:async()=>{f.value&&(ie.order=$e,a.value&&b(ie.fk_column_id,$e),await Ne(oe,{order:$e}),V.emit(co.FIELD_RELOAD))},args:[]},redo:{fn:async()=>{f.value&&(ie.order=_e,a.value&&b(ie.fk_column_id,_e),await Ne(oe,{order:_e}),V.emit(co.FIELD_RELOAD))},args:[]},scope:F({view:qe.value})}),await Ne(oe,{order:_e},!0),V.emit(co.FIELD_RELOAD)},E=async()=>{Z.value=!0;try{if(!H.value)return;H.value.style.left="0px",H.value.style.height="0px",await A(xe.value.id,W.value)}catch(oe){console.error("Failed to reorder column: ",oe)}finally{Z.value=!1}xe.value=null,W.value=null};return{onDrag:oe=>{if(oe.preventDefault(),!oe.dataTransfer||!xe.value||!H.value)return;if(oe.clientX===0){E();return}const ve=H.value.getBoundingClientRect().top,fe=document.elementsFromPoint(oe.clientX,ve).find(we=>we.classList.contains("nc-grid-column-header"));fe&&(W.value=(fe==null?void 0:fe.getAttribute("data-col"))??null);const re=oe.clientX-m.value;re>=0&&(H.value.style.left=`${re.toString()}px`);const v=parseFloat(getComputedStyle(document.documentElement).fontSize);re<m.value+1*v?setTimeout(()=>{i.value.scrollLeft-=2.5},250):te.value-re-m.value<15*v&&setTimeout(()=>{i.value.scrollLeft+=2.5},250)},onDragStart:(oe,ve)=>{var we;if(!ve.dataTransfer)return;const ie=document.querySelector('[data-testid="drag-icon-placeholder"]');if(!ie||!H.value)return;ve.dataTransfer.dropEffect="none",ve.dataTransfer.effectAllowed="none",ve.dataTransfer.setDragImage(ie,10,10),ve.dataTransfer.clearData(),ve.dataTransfer.setData("text/plain",oe),xe.value=f.value.find(se=>se.id===oe)??null;const fe=parseFloat(getComputedStyle(document.documentElement).fontSize),re=((we=y.value)==null?void 0:we.getBoundingClientRect().height)??6.1*fe;H.value.style.height=`${re}px`;const v=ve.clientX-m.value;v>=0&&H.value&&(H.value.style.left=`${v.toString()}px`)},onDragEnd:async oe=>{oe.preventDefault(),await na(()=>!Z.value).toBeTruthy(),!(!oe.dataTransfer||!xe.value||!W.value)&&E()},draggedCol:xe,dragColPlaceholderDomRef:H,toBeDroppedColId:W}},pi=ht(()=>yt(()=>import("./Co32XBKZ.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(f=>f.default||f)),fi=ht(()=>yt(()=>import("./Dby8gS7l.js"),__vite__mapDeps([6,1,2,7,8,9]),import.meta.url).then(f=>f.default||f)),mi=ht(()=>yt(()=>import("./T8gL-mZl.js"),__vite__mapDeps([10,11,1,2,12,13,14,15,16,17,18,19,20,21,22,23,3,7,8,24,25,26,27,28,29,30,31,32,33,34,35,4,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68]),import.meta.url).then(f=>f.default||f)),vi=ht(()=>yt(()=>import("./BIhr-Z4C.js"),__vite__mapDeps([69,1,2,3,8,70]),import.meta.url).then(f=>f.default||f)),wi=ht(()=>yt(()=>import("./DG2ZH8TR.js"),__vite__mapDeps([71,1,2,72,53,73,3,74,4,8,75]),import.meta.url).then(f=>f.default||f)),gi=ht(()=>yt(()=>import("./Tryc0omP.js"),__vite__mapDeps([76,72,53,1,2,73,3,74,4]),import.meta.url).then(f=>f.default||f)),hi=ht(()=>yt(()=>import("./Fr_cZ1zf.js"),__vite__mapDeps([77,78,1,2,41,29,18,42,20,19,79,80,81,82,83,16,17,21,22,84]),import.meta.url).then(f=>f.default||f)),yi=ht(()=>yt(()=>import("./DkmQdKZ4.js"),__vite__mapDeps([85,1,2,86,87,88,89,25,90,91,92,54,80,81,82,83,93,94,65,95,96,97,98,99,100,101,102,103,104,16,17,18,19,20,21,22,105,106,107,108,109,110,53,4,111,72,73,3,74,112,113,50,51,114,12,13,55,52,115,63,116,117,118,31,119,8,120,121,122,49,123,124,125]),import.meta.url).then(f=>f.default||f)),_i={class:"flex items-center justify-center bg-white/80 absolute l-0 t-0 w-full h-full z-10 pb-10 pointer-events-none"},bi={class:"flex flex-col items-center justify-center gap-2"},ki=["innerHTML"],xi={key:0},Ri={class:"nc-grid-header"},$i={class:"w-full h-full flex pl-2 pr-1 items-center","data-testid":"nc-check-all"},Si={key:1,class:"text-gray-500"},Di=["data-col","data-title"],Ai=["data-col","data-title","onXcstartresizing","onXcresize","onXcresizing","onClick"],Mi=["draggable","onDragstart"],Ci={class:"absolute top-0 left-0 h-8 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},Ei={class:"h-full w-[60px] flex items-center justify-center"},Li={class:"flex flex-row items-center py-3"},Vi={class:"text-xs pl-2"},Fi=["onClick"],zi={class:"text-xs pl-2"},Pi={class:"text-red-500 text-xs pl-2"},Ni={class:"text-xs pl-2"},Oi={class:"flex flex-row items-center py-3"},Ii={class:"text-xs pl-2"},Ti=["onClick"],Bi={class:"text-xs pl-2"},Gi={class:"text-xs pl-2"},Hi={class:"nc-edit-or-add-provider-wrapper"},Ui={class:"!border-0 relative !xs:hidden",style:{borderWidth:"0px !important"}},Wi=["data-testid"],Yi=["data-testid"],ji={class:"w-[60px] pl-2 pr-1 items-center flex gap-1"},Ki=["data-testid"],Xi=["onClick"],qi={key:2,class:"cursor-pointer flex items-center border-1 border-gray-100 active:ring rounded p-1 hover:bg-gray-50"},Ji={key:0,class:"w-full"},Qi={key:0,class:"w-full"},Zi=["colspan"],es={class:"flex gap-2 items-center"},ts={key:0,class:"flex gap-2 items-center"},os={key:1,class:"flex gap-2 items-center"},as={class:"flex gap-2 items-center"},ns={class:"flex gap-2 items-center"},ls={class:"flex gap-2 items-center"},rs={class:"flex gap-2 items-center"},is={class:"flex gap-2 items-center"},ss={class:"flex gap-2 items-center"},us={class:"flex gap-2 items-center"},ds={class:"relative"},cs={class:"flex ml-1"},ps={"data-testid":"nc-pagination-add-record",class:"flex items-center px-2 text-gray-600 hover:text-black"},fs={class:"relative overflow-visible min-h-17 w-10"},ms={class:"flex flex-row items-center justify-between w-full"},vs={class:"flex flex-row items-center justify-start gap-x-3"},ws={class:"flex flex-row text-xs text-gray-400 ml-7.25"},gs={class:"flex flex-row items-center justify-between w-full"},hs={class:"flex flex-row items-center justify-start gap-x-2.5"},ys={class:"flex flex-row text-xs text-gray-400 ml-7.05"},_s={key:0,class:"absolute bottom-12 left-2"},bs={class:"flex"},ks={class:"flex items-center gap-2"},xs={"data-testid":"nc-pagination-add-record",class:"flex items-center gap-2"},Rs={class:"flex flex-row items-center justify-start gap-x-3"},$s={class:"flex flex-row items-center justify-start gap-x-3"},Bn=!1,ea=10,Ss=So({__name:"Table",props:{data:{},vGroup:{},paginationData:{},loadData:{type:Function},changePage:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},selectedAllRecords:{type:Boolean},deleteRangeOfRows:{type:Function},rowHeight:{},expandForm:{type:Function},deleteSelectedRows:{type:Function},removeRowIfNew:{type:Function},bulkUpdateRows:{type:Function},headerOnly:{type:Boolean},hideHeader:{type:Boolean},hideCheckbox:{type:Boolean},pagination:{},disableSkeleton:{type:Boolean},disableVirtualX:{type:Boolean},disableVirtualY:{type:Boolean}},emits:["update:selectedAllRecords","bulkUpdateDlg","toggleOptimisedQuery"],setup(f,{expose:y,emit:i}){const V=f,a=i,K=Da(V,"selectedAllRecords",a),P=io(V,"paginationData"),F=io(V,"data"),qe=io(V,"pagination"),x=io(V,"headerOnly"),Ne=io(V,"hideHeader"),m=io(V,"disableSkeleton"),te=io(V,"disableVirtualX"),Z=io(V,"disableVirtualY"),{api:xe}=jn(),{vGroup:H,loadData:W,changePage:b,callAddEmptyRow:A,updateOrSaveRow:E,deleteRow:ce,expandForm:le,deleteSelectedRows:X,deleteRangeOfRows:oe,removeRowIfNew:ve,bulkUpdateRows:ie}=V,fe=Ge(la,h()),re=Ge(Aa,h()),v=Ge(oa,h([])),we=Ge(Xn,h(!1)),se=Ge(Kl,h(!1)),Re=Ge(aa,h(!1)),_e=Ge(qn,h(!1)),$e=Xl(),He=Ge(Ma,Lo()),u=Ge(ql,Lo()),{isMobileMode:T,isAddNewRecordGridMode:c,setAddNewRecordGridMode:r}=Ra(),C=Ge(Jn,h()),{isPkAvail:g,isSqlView:N,eventBus:B}=Uo(),{isViewDataLoading:I,isPaginationLoading:ae}=Vo(Sa()),{$e:q}=Un(),{t:Je}=Ho(),{getMeta:_t}=Yn(),{addUndo:Vt,clone:tt,defineViewScope:Wt}=$a(),{isViewColumnsLoading:st,updateGridViewColumn:Do,gridViewCols:z,metaColumnById:it,resizingColOldWith:Dt}=ra(),{isExpandedFormCommentMode:Fo}=Vo(Rr()),{predictingNextColumn:zo,predictedNextColumn:Yt,predictingNextFormulas:Po,predictedNextFormulas:ho,predictNextColumn:be,predictNextFormulas:l}=$r().table,{paste:d}=Hr(),{addLTARRef:p,syncLTARRefs:ue,clearLTARCell:Fe,cleaMMCell:O}=Sr(),{loadViewAggregate:ge}=Br(),me=h(null),lt=h(),Ft=h(),ut=h(),pt=h(),{height:Gt,width:jt}=Jl(Ft),ft=j(()=>st.value||!fe.value),zt=h(!1),{isUIAllowed:Qt,isDataReadOnly:mt}=xa(),Ue=j(()=>Qt("dataEdit")),Kt=j(()=>!we.value&&!se.value&&Qt("fieldAdd")&&!N.value),{onDrag:po,onDragStart:de,onDragEnd:G,draggedCol:rt,dragColPlaceholderDomRef:Ae,toBeDroppedColId:ot}=ci({fields:v,tableBodyEl:ut,gridWrapper:lt}),{onLeft:bt,onRight:Oe,onUp:at,onDown:vt}=Dr({paginationDataRef:P,changePage:b,isViewDataLoading:I}),ze=h(!1),Me=h(!1),nt=h(!1),Ce=h(!1),U=h(),ke=h(!1),Pt=h(!1),Zt=h(null),Pe=h(!1),eo=h(!1),to=h(!1),At=j({get:()=>{var t;return(t=V.data)!=null&&t.some(o=>o.rowMeta.selected)&&mt.value?!1:to.value},set:t=>{to.value=t}}),Mt=h(!1),Qe=h(null),fo=(t,o)=>{N.value||(t.preventDefault(),o&&(Qe.value=o))},Ea=h(!1);Et(Ql,Ea);const Wo=h(!1);async function La(t,o=!1){if(mt.value||!t||!Ue.value||!ba(v.value[t.col])&&qt(v.value[t.col])||oo.value[t.col].isReadonly)return;const s=F.value[t.row],R=v.value[t.col];if(qt(R)){let Ee;so(R)&&s&&(Ee=await O(s,R)),Vt({undo:{fn:async(ee,xt,he,Te,je)=>{var ye,Be,Ct,Xt,Tt;if(((ye=P.value)==null?void 0:ye.pageSize)===Te.pageSize){((Be=P.value)==null?void 0:Be.page)!==Te.page&&await(b==null?void 0:b(Te.page));const wt=ct(he.row,(Ct=fe.value)==null?void 0:Ct.columns),Ht=F.value[ee.row],Nt=v.value[ee.col];if(Nt.title&&wt===ct(Ht.row,(Xt=fe.value)==null?void 0:Xt.columns)&&Nt.id===xt.id)uo(Nt)||go(Nt)?(Ht.row[Nt.title]=he.row[Nt.title],await p(Ht,Ht.row[Nt.title],Nt),await ue(Ht,Ht.row)):so(Nt)&&(await xe.dbDataTableRow.nestedLink((Tt=fe.value)==null?void 0:Tt.id,Nt.id,encodeURIComponent(wt),je),Ht.row[Nt.title]=je!=null&&je.length?je==null?void 0:je.length:null),w.col=ee.col,w.row=ee.row,Ie==null||Ie();else throw new Error(Je("msg.recordCouldNotBeFound"))}else throw new Error(Je("msg.pageSizeChanged"))},args:[tt(t),tt(R),tt(s),tt(P.value),Ee]},redo:{fn:async(ee,xt,he,Te)=>{var je,ye,Be,Ct;if(((je=P.value)==null?void 0:je.pageSize)===Te.pageSize){((ye=P.value)==null?void 0:ye.page)!==Te.page&&await(b==null?void 0:b(Te.page));const Xt=ct(he.row,(Be=fe.value)==null?void 0:Be.columns),Tt=F.value[ee.row],wt=v.value[ee.col];if(Xt===ct(Tt.row,(Ct=fe.value)==null?void 0:Ct.columns)&&wt.id===xt.id)uo(wt)||go(wt)?await Fe(Tt,wt):so(wt)&&await O(Tt,wt),w.col=ee.col,w.row=ee.row,Ie==null||Ie();else throw new Error(Je("msg.recordCouldNotBeFound"))}else throw new Error(Je("msg.pageSizeChanged"))},args:[tt(t),tt(R),tt(s),tt(P.value)]},scope:Wt({view:re.value})}),(uo(R)||go(R))&&await Fe(s,R);return}if(R.title)switch(R.uidt){case $.Checkbox:s.row[R.title]=!1;break;case $.Rating:s.row[R.title]=0;break;default:s.row[R.title]=null;break}o||await(E==null?void 0:E(s,R.title))}function ia(t,o){if(!(!Ue.value||Pe.value||Bn||we.value||ya(o))){if(!g.value&&!t.rowMeta.new){Ve.info(Je("msg.info.updateNotAllowedWithoutPK"));return}if(o.ai){Ve.info(Je("msg.info.autoIncFieldNotEditable"));return}if(o.pk&&!t.rowMeta.new){Ve.info(Je("msg.info.editingPKnotSupported"));return}if(![$.SingleSelect,$.MultiSelect].includes(o.uidt))return Pe.value=!0}}const mo=j(()=>!Bn&&Ue.value&&!N.value&&!Re.value),Va=j(()=>{var t;return(t=v.value)==null?void 0:t.length}),ul=j(()=>{const t=[];return x.value!==!0?C.value||t.push("nc-scrollbar-x-lg !overflow-auto"):t.push("overflow-visible"),I.value&&t.push("!overflow-hidden"),t.join(" ")}),Fa=j(()=>{var o;let t=((o=v.value)==null?void 0:o.length)??40;return t=t||40,Array.from({length:t+1}).map(()=>({}))}),dl=j(()=>Array.from({length:40}).map(()=>({}))),Ao=j(()=>m.value!==!0&&(I.value||ae.value||ft.value)||!fe.value),sa=j(()=>F.value.map(t=>v.value.map(o=>({isColumnRequiredAndNull:_r(o,t.row)})))),za=t=>ya(t)||Ar(t)||Mr(t)||Cr(t)||Er(t)||qt(t)||or(t)||ar(t),oo=j(()=>v.value.map(t=>({isVirtualCol:qt(t),isReadonly:za(t)})));function cl(t){fa("smooth"),setTimeout(()=>{ze.value=!0,U.value=t},500)}const Pa=(t=!1)=>{Zt.value=null,ze.value=!1,U.value={},t&&setTimeout(()=>{fa("smooth")},200)};async function Na(t){if(t&&t!==(H==null?void 0:H.key))return;const o=ao(F.value.length,!0);o&&(le==null||le(o,void 0,!0,t))}const pl=()=>{u.trigger(H==null?void 0:H.key)},Oa=()=>{r(!0),ao()},Mo=()=>{r(!1),pl()},fl=(t,o,s)=>{var ye,Be;const R=o.getBoundingClientRect(),Ee=15,ee=((ye=o.querySelector("thead th:nth-child(1)"))==null?void 0:ye.getBoundingClientRect().width)??0,xt=((Be=o.querySelector("thead th:nth-child(2)"))==null?void 0:Be.getBoundingClientRect().width)??0,he=ee+xt,Te={right:t.right+ee-R.width-o.scrollLeft,left:t.left+ee-o.scrollLeft-he,bottom:t.bottom-R.height-o.scrollTop,top:t.top-o.scrollTop},je={top:0,left:0};return je.left=Te.right+((s==null?void 0:s.right)||0)>0?o.scrollLeft+Te.right+((s==null?void 0:s.right)||0)+Ee:Te.left-((s==null?void 0:s.left)||0)<0?o.scrollLeft+Te.left-((s==null?void 0:s.left)||0)-Ee:o.scrollLeft,je.top=Te.bottom+((s==null?void 0:s.bottom)||0)>0?o.scrollTop+Te.bottom+((s==null?void 0:s.bottom)||0)+Ee:Te.top-((s==null?void 0:s.top)||0)<0?o.scrollTop+Te.top-((s==null?void 0:s.top)||0)-Ee:o.scrollTop,je},{selectRangeMap:Yo,fillRangeMap:Ia,activeCell:w,handleMouseDown:Ta,handleMouseOver:Ba,handleCellClick:ml,clearSelectedRange:It,copyValue:vl,isCellActive:Ga,resetSelectedRange:wl,makeActive:jo,selectedRange:pe,isFillMode:Ha}=Ur(fe,v,F,Pe,g,At,La,Ya,ia,Ie,async t=>{var Ee,ee,xt,he,Te,je,ye,Be,Ct,Xt,Tt;if(document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"))return t.preventDefault(),!0;if(xo())return;if(Go())return!0;const s=Bo()?t.metaKey:t.ctrlKey,R=t.altKey;if(t.key===" "){const wt=xo();if(Ga.value&&!Pe.value&&Ue.value&&w.row!==null&&!wt){t.preventDefault();const Ht=F.value[w.row];return le==null||le(Ht),!0}}else if(t.key==="Escape"){if(Pe.value)return Pe.value=!1,!0}else if(t.key==="Enter"){if(t.shiftKey)return!0;if(Pe.value)return Pe.value=!1,!0}else if(t.key==="Tab"){if(t.shiftKey&&w.row===0&&w.col===0&&!((Ee=P.value)!=null&&Ee.isFirstPage))return t.preventDefault(),await No((((ee=P.value)==null?void 0:ee.pageSize)??25)-1,((xt=v.value)==null?void 0:xt.length)-1,-1),!0;if(!t.shiftKey&&w.row===F.value.length-1&&w.col===((he=v.value)==null?void 0:he.length)-1){if(t.preventDefault(),(Te=P.value)!=null&&Te.isLastPage&&mo.value)return Wo.value=!0,!0;if(!((je=P.value)!=null&&je.isLastPage))return await No(0,0,1),!0}}else if(!s&&!t.shiftKey&&t.key==="ArrowUp"){if(w.row===0&&!((ye=P.value)!=null&&ye.isFirstPage))return t.preventDefault(),await No((((Be=P.value)==null?void 0:Be.pageSize)??25)-1,w.col,-1),!0}else if(!s&&!t.shiftKey&&t.key==="ArrowDown"&&w.row===F.value.length-1){if(t.preventDefault(),(Ct=P.value)!=null&&Ct.isLastPage&&mo.value)return Wo.value=!0,!0;if(!((Xt=P.value)!=null&&Xt.isLastPage))return await No(0,w.col,1),!0}if(s){if(!Ga.value||t.shiftKey)return;switch(t.key){case"ArrowUp":return t.preventDefault(),It(),w.row=0,w.col=w.col??0,Ie==null||Ie(),Pe.value=!1,!0;case"ArrowDown":return t.preventDefault(),It(),w.row=F.value.length-1,w.col=w.col??0,Ie==null||Ie(),Pe.value=!1,!0;case"ArrowRight":return t.preventDefault(),It(),w.row=w.row??0,w.col=((Tt=v.value)==null?void 0:Tt.length)-1,Ie==null||Ie(),Pe.value=!1,!0;case"ArrowLeft":return t.preventDefault(),It(),w.row=w.row??0,w.col=0,Ie==null||Ie(),Pe.value=!1,!0}}if(R)switch(t.keyCode){case 82:{mo.value&&(q("c:shortcut",{key:"ALT + R"}),ao(),w.row=F.value.length-1,w.col=0,wl(),Eo(()=>{var wt;(wt=document.querySelector("td.cell.active"))==null||wt.scrollIntoView({behavior:"smooth"})}));break}case 67:{Kt.value&&(q("c:shortcut",{key:"ALT + C"}),fa(void 0),setTimeout(()=>{ze.value=!0},250));break}}},async t=>{const o=F.value[t.row],s=t.col!==void 0?v.value[t.col]:null;!o||!s||!t.updatedColumnTitle&&qt(s)||(F.value[t.row].rowMeta.isUpdatedFromCopyNPaste={...F.value[t.row].rowMeta.isUpdatedFromCopyNPaste,[t.updatedColumnTitle||s.title]:!0},await(E==null?void 0:E(o,t.updatedColumnTitle||s.title)))},ie,pt,re,P,b);function Ua(t){It(),jo(t??F.value.length-1,0),pe.startRange({row:w.row,col:w.col}),Ie==null||Ie()}async function gl(t){await(E==null?void 0:E(t))}function ao(t,o=!1){const s=A==null?void 0:A(t);return!o&&s&&gl(s),Eo().then(()=>{Ua(t??F.value.length-1)}),s}const hl=t=>{try{ce==null||ce(t),pe.isRowInRange(t)&&It(),w.row===t&&(w.row=null,w.col=null)}catch(o){Ve.error(o.message)}},yl=t=>{try{Fo.value=!0;const o=F.value[t];le&&le(o),w.row=null,w.col=null,pe.clear()}catch(o){Ve.error(o.message)}},_l=()=>{oe==null||oe(pe).then(()=>{It(),w.row=null,w.col=null})},Wa=t=>{if(zt.value){zt.value=!1;return}const o=v.value.findIndex(s=>s.id===t);o!==-1&&(jo(0,o),pe.startRange({row:0,col:o}),pe.endRange({row:F.value.length-1,col:o}))};Zl(ut,t=>{if(ke.value||zt.value||At.value||w.row===null||w.col===null||xo())return;const s=v.value[w.col];if(Pe.value&&(qt(s)||s.uidt===$.JSON)||Ha.value)return;const R=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-dropdown-user-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active,.nc-link-dropdown-root");t.target&&R&&(R===t.target||R!=null&&R.contains(t.target))||Go()||(It(),w.row=null,w.col=null)});const Ko=t=>{if(!(w.row===null||w.col===null)){switch(Pe.value=!1,It(),t){case wo.NEXT:w.row<F.value.length-1||ao(),w.row++;break;case wo.PREV:w.row>0&&w.row--;break}Eo(()=>{Ie()})}};async function Ya(){if(!Ue.value||mt.value)return;const t=pe.start,o=pe.end,s=Math.min(t.row,o.row),R=Math.max(t.row,o.row),Ee=Math.min(t.col,o.col),ee=Math.max(t.col,o.col),xt=v.value.slice(Ee,ee+1),he=F.value.slice(s,R+1),Te=[];let je=!1;for(const ye of he)for(const Be of xt)if(!(!ye||!Be||!Be.title)){if(qt(Be)){(uo(Be)||go(Be)||so(Be))&&!je&&(Ve.info(Je("msg.info.groupClearIsNotSupportedOnLinksColumn")),je=!0);continue}za(Be)||(ye.row[Be.title]=null,Te.push(Be.title))}await(ie==null?void 0:ie(he,Te))}const kt=j(()=>v.value.filter(t=>t.id&&z.value[t.id]&&z.value[t.id].width&&z.value[t.id].show).map(t=>+z.value[t.id].width.replace("px","")||200).reduce((t,o,s)=>(t.push(t[s]+o),t),[0])),We=j(()=>C.value||lt.value),ja=h();function Ie(t,o){if(t=t??w.row,o=o??w.col,t!==null&&o!==null&&We.value){const s={top:t*vo[`${V.rowHeight}`],left:kt.value[o],right:o===v.value.length-1?kt.value[kt.value.length-1]+200:kt.value[o+1],bottom:(t+1)*vo[`${V.rowHeight}`]},R=fl(s,We.value,{top:9,bottom:(Gt.value||40)+9,right:9});if(_e.value&&(R.top=We.value.scrollTop),o===0&&(R.left=0),t===F.value.length-1){We.value.scrollTo({top:_e.value?We.value.scrollTop:We.value.scrollHeight,left:o===v.value.length-1?We.value.scrollWidth:R.left,behavior:"smooth"});return}if(o===v.value.length-1){We.value.scrollTo({top:R.top,left:We.value.scrollWidth,behavior:"smooth"});return}We.value.scrollTo({top:R.top,left:R.left,behavior:"smooth"})}}async function No(t,o,s){var R;It(),s!==void 0&&((R=P.value)!=null&&R.page)?(await(b==null?void 0:b(P.value.page+s)),await Eo(),jo(t,o)):(jo(t,o),await Eo()),Ie==null||Ie()}const Xo=h([]),ua=async(t={})=>{var o;for(const s of t.data||F.value)if(!s.rowMeta.fromExpandedForm){if(s.rowMeta.new){const R=tt(s);await(E==null?void 0:E(s,"",s.rowMeta.ltarState||{},t))?s.rowMeta.changed=!1:t.keepNewRecords&&R.rowMeta.new&&Object.keys(R.row).length&&Xo.value.push(R);continue}if(s.rowMeta.changed){s.rowMeta.changed=!1;for(const R of((o=t.metaValue||fe.value)==null?void 0:o.columns)??[])qt(R)||R.uidt===$.Attachment||R.title in s.row&&s.row[R.title]!==s.oldRow[R.title]&&await(E==null?void 0:E(s,R.title,{},t))}}},Ka={[$.Attachment]:{minWidth:80,maxWidth:Number.POSITIVE_INFINITY},[$.Button]:{minWidth:100,maxWidth:320}},Xa=(t,o)=>{if(t.uidt in Ka){const{minWidth:s,maxWidth:R}=Ka[t.uidt];if(s<o&&o<R)return o;if(o<s)return s;if(o>R)return R}return o},qa=(t,o)=>{if(!t||!In(o==null?void 0:o.detail))return;const s=o.detail.split("px")[0];Do(t,{width:`${Xa(it.value[t],s)}px`})},Ja=(t,o)=>{if(!t||!In(o==null?void 0:o.detail))return;const s=o.detail.split("px")[0];z.value[t].width=`${Xa(it.value[t],s)}px`},Qa=(t,o)=>{t&&(Dt.value=o.detail,zt.value=!0)},Za=(t,o,s)=>{U.value={title:t,uidt:o,colOptions:s},nt.value=!1},en=h(),bl=()=>{var t;ze.value=!0,(t=en.value)!=null&&t.isWebHookModalOpen()||(ze.value=!1)},kl=j(()=>kt.value[kt.value.length-1]+64),xl=j(()=>F.value.length*(T.value?56:vo[`${V.rowHeight}`])),yo=h({start:0,end:0}),Co=h({start:0,end:0}),_o=()=>{if(!We.value||!lt.value){yo.value={start:0,end:0},Co.value={start:0,end:0},setTimeout(_o,100);return}let t=0;if(te.value!==!0){let o=0,s=kt.value.length-1;for(;s!==o;){const ee=Math.floor((s-o)/2+o);if(kt.value[ee]<=We.value.scrollLeft&&kt.value[ee+1]>We.value.scrollLeft){t=ee;break}if(ee===o){t=s;break}else kt.value[ee]<=We.value.scrollLeft?o=ee:s=ee}let R=0,Ee=!1;for(let ee=t;ee<kt.value.length;ee++)if(kt.value[ee]>lt.value.clientWidth+We.value.scrollLeft){R=ee,Ee=!0;break}yo.value={start:Math.max(0,t-ea),end:Ee?Math.min(v.value.length,R+ea):v.value.length}}if(Z.value!==!0){const o=vo[`${V.rowHeight}`],s=Math.max(0,Math.floor(We.value.scrollTop/o)-ea),R=Math.min(F.value.length,s+Math.ceil(lt.value.clientHeight/o)+ea);Co.value={start:s,end:R}}},tn=j(()=>te.value?v.value.map((o,s)=>({field:o,index:s})).filter(o=>o.index!==0):v.value.slice(yo.value.start,yo.value.end).map((o,s)=>({field:o,index:s+yo.value.start})).filter(o=>o.index!==0)),Rl=j(()=>Z.value?F.value.map((t,o)=>({row:t,index:o})):F.value.slice(Co.value.start,Co.value.end).map((t,o)=>({row:t,index:o+Co.value.start}))),no=j(()=>yo.value.start>0?kt.value[yo.value.start]-kt.value[1]:0),$l=j(()=>vo[`${V.rowHeight}`]*Co.value.start),on=h(),an=h(),da=()=>{Eo(()=>{const t=isNaN(pe.end.row)?w.row:pe.end.row,o=isNaN(pe.end.col)?w.col:pe.end.col;if(t!==null&&o!==null){if(!We.value||!lt.value)return;on.value=(t+1)*vo[`${V.rowHeight}`]+(Ne.value?0:32),an.value=64+kt.value[o+1]+(o===0?Math.max(0,We.value.scrollLeft-lt.value.offsetLeft):0)}})},qo=j(()=>pe.isEmpty()&&w.col&&oo.value[w.col].isReadonly||!pe.isEmpty()&&Array.from({length:pe.end.col-pe.start.col+1}).every((t,o)=>oo.value[pe.start.col+o].isReadonly)),Sl=j(()=>{var t,o;return!mt.value&&!we.value&&!Pe.value&&(!pe.isEmpty()||w.row!==null&&w.col!==null)&&!((o=(t=F.value[(isNaN(pe.end.row)?w.row:pe.end.row)??-1])==null?void 0:t.rowMeta)!=null&&o.new)&&w.col!==null&&v.value[w.col]&&!I.value&&!ae.value&&F.value.length&&!qo.value});Ro([()=>pe.end.row,()=>pe.end.col,()=>w.row,()=>w.col],([t,o,s,R],[Ee,ee,xt,he])=>{(t!==Ee||o!==ee||s!==xt||R!==he)&&(_o(),da())}),ta(()=>{const t=new ResizeObserver(()=>{var o;da(),w.row!==null&&!((o=F.value)!=null&&o[w.row])&&(It(),w.row=null,w.col=null)});me.value&&t.observe(me.value),na(We).toBeTruthy().then(()=>_o())}),B.on(async(t,o)=>{t===co.FIELD_ADD&&(Zt.value=o,ze.value=!0),t===co.CLEAR_NEW_ROW&&(It(),w.row=null,w.col=null,ve==null||ve(o))});async function nn(t){var o,s,R;if(t!=null&&t.shouldShowLoading&&(I.value=!0),(o=Yt.value)!=null&&o.length){const Ee=(R=(s=fe.value)==null?void 0:s.columns)==null?void 0:R.map(ee=>ee.title);Yt.value=Yt.value.filter(ee=>!(Ee!=null&&Ee.includes(ee.title)))}await ua({keepNewRecords:!0}),await(W==null?void 0:W({...(t==null?void 0:t.offset)!==void 0?{offset:t.offset}:{}},t==null?void 0:t.shouldShowLoading)),Xo.value.length&&(F.value.push(...Xo.value),Xo.value=[]),_o(),I.value=!1}let ca=null;Jt(We,"scroll",t=>{ja.value=t.target.scrollLeft,ca&&cancelAnimationFrame(ca),ca=requestAnimationFrame(()=>{_o(),da()})}),Jt(document,"mousedown",t=>{var o,s;(t.offsetX>((o=t.target)==null?void 0:o.clientWidth)||t.offsetY>((s=t.target)==null?void 0:s.clientHeight))&&(ke.value=!0),t.target.closest(".nc-grid-cell:not(.caption)")&&(eo.value=!0)}),Jt(document,"mouseup",()=>{eo.value=!1,setTimeout(()=>{ke.value=!1},100)}),Jt(document,"keydown",async t=>{const o=xo();t.key==="Alt"&&!o&&(Me.value=!0)}),Jt(document,"keyup",async t=>{var Ee,ee;const o=xo();t.key==="Alt"&&!o&&(Me.value=!1,Ce.value=!1);const s=document.querySelector(".nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active"),R=Bo()?t.metaKey:t.ctrlKey;Wo.value&&!o&&!s&&!Go()&&!R&&!t.shiftKey&&!t.altKey&&(t.key==="Tab"&&w.row===F.value.length-1&&w.col===((Ee=v.value)==null?void 0:Ee.length)-1||t.key==="ArrowDown"&&w.row===F.value.length-1&&((ee=P.value)!=null&&ee.isLastPage)&&mo.value)&&(ao(),await No(F.value.length-1,0),Wo.value=!1)}),Jt(document,"keydown",async t=>{const o=Bo()?t.metaKey:t.ctrlKey;if(t.altKey&&!t.shiftKey&&!o)switch(t.keyCode){case 78:{mo.value&&ao();break}}}),Qn(async()=>{const t=re.value,o=F.value;t&&_t(t.fk_model_id,!1,!0).then(s=>{const R=s;R&&ua({metaValue:R,viewMetaValue:t,data:o})}),He==null||He.off(nn),u==null||u.off(Na)}),He==null||He.on(nn),u==null||u.on(Na),Ro(At,()=>{At.value?Mt.value=!1:(Mt.value=!0,Qe.value=null)}),Ro(()=>$e.params.viewId,()=>{I.value=!0}),Ro(re,async(t,o)=>{try{if(t&&t.id!==(o==null?void 0:o.id)&&(t.fk_model_id===$e.params.viewId||Re.value)){if(Pt.value=!0,o!=null&&o.id){const s=await _t(o.fk_model_id,!1,!0);s&&await ua({viewMetaValue:o,metaValue:s,data:F.value})}I.value=!0;try{_e.value?await(W==null?void 0:W()):await Promise.allSettled([W==null?void 0:W(),ge()]),_o()}catch(s){er.isCancel(s)||(console.log(s),Ve.error(Je("msg.errorLoadingData")))}finally{I.value=!1}}}catch(s){console.log(s)}finally{Pt.value=!1}},{immediate:!0}),Ro([()=>v.value.length,()=>F.value.length],()=>{_o()}),Et(tr,Ce),y({scrollToRow:Ua,openColumnCreate:cl});const pa=(t,o)=>{le&&le(t,o),w.row=null,w.col=null,pe.clear()},ln=(t,o,s)=>{const R=F.value[o];if(T.value)return pa(R,v.value[s]);ml(t,o,s)},Dl=j(()=>{var t,o,s,R;if(ae.value)return(t=P.value)!=null&&t.totalRows&&((o=P.value)!=null&&o.pageSize)?`Loading page<br/>${P.value.page} of ${Math.ceil(((s=P.value)==null?void 0:s.totalRows)/((R=P.value)==null?void 0:R.pageSize))}`:Je("general.loading")});function fa(t){var o;We.value&&((o=We.value)==null||o.scrollTo({top:We.value.scrollTop,left:We.value.scrollWidth,behavior:t}))}return Qo("ArrowLeft",bt),Qo("ArrowRight",Oe),Qo("ArrowUp",at),Qo("ArrowDown",vt),(t,o)=>{var fn,mn,vn,wn,gn,hn;const s=nr,R=Fr,Ee=zr,ee=pi,xt=fi,he=Zn,Te=di,je=Vr,ye=ll,Be=li,Ct=rl,Xt=lr,Tt=ei,wt=mi,Ht=rr,Nt=ir,rn=vi,sn=wi,un=Gr,Al=gi,dn=xr,Ml=Xr,cn=il,Jo=el,Cl=sr,El=hi,Ll=yi,pn=Fn("xc-ver-resize"),Ze=Fn("e");return n(),M("div",{class:De(["flex flex-col",`${e(x)!==!0?"h-full w-full":""}`])},[o[47]||(o[47]=_("div",{"data-testid":"drag-icon-placeholder",class:"absolute w-1 h-1 pointer-events-none opacity-0"},null,-1)),_("div",{ref_key:"dragColPlaceholderDomRef",ref:Ae,class:De([{"hidden w-0 !h-0 left-0 !max-h-0 !max-w-0":!e(rt)},"absolute flex items-center z-40 top-0 h-full bg-gray-50 pointer-events-none opacity-60"])},[e(rt)?(n(),M("div",{key:0,style:Ye({"min-width":((fn=e(z)[e(rt).id])==null?void 0:fn.width)||"200px","max-width":((mn=e(z)[e(rt).id])==null?void 0:mn.width)||"200px",width:((vn=e(z)[e(rt).id])==null?void 0:vn.width)||"200px"}),class:"border-r-1 border-l-1 border-gray-200 h-full"},null,4)):Q("",!0)],2),_("div",{ref_key:"gridWrapper",ref:lt,class:De(["nc-grid-wrapper min-h-0 flex-1 relative",e(ul)])},[Se(_("div",_i,[_("div",bi,[Y(s,{size:"xlarge"}),_("span",{class:"text-center",innerHTML:e(Dl)},null,8,ki)])],512),[[To,e(ae)&&!e(x)]]),Y(cn,{visible:e(At),"onUpdate:visible":o[34]||(o[34]=et=>Ot(At)?At.value=et:null),trigger:e(N)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:L(()=>[Y(Ct,{class:"!rounded !py-0",onClick:o[33]||(o[33]=et=>At.value=!1)},{default:L(()=>{var et;return[("isEeUI"in t?t.isEeUI:e(wa))&&!e(Mt)&&!e(Qe)&&t.data.some(gt=>gt.rowMeta.selected)&&!e(mt)?(n(),k(ye,{key:0,onClick:o[27]||(o[27]=gt=>a("bulkUpdateDlg"))},{default:L(()=>[Se((n(),M("div",es,[(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).ncEdit))),Le(" "+J(t.$t("title.updateSelectedRows")),1)])),[[Ze,["a:row:update-bulk"]]])]),_:1})):Q("",!0),!e(Mt)&&!e(Qe)&&t.data.some(gt=>gt.rowMeta.selected)&&!e(mt)?(n(),k(ye,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50","data-testid":"nc-delete-row",onClick:e(X)},{default:L(()=>[t.data.filter(gt=>gt.rowMeta.selected).length===1?Se((n(),M("div",ts,[(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).delete))),Le(" "+J(t.$t("activity.deleteSelectedRow")),1)])),[[Ze,["a:row:delete"]]]):Se((n(),M("div",os,[(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).delete))),Le(" "+J(t.$t("activity.deleteSelectedRow")),1)])),[[Ze,["a:row:delete-bulk"]]])]),_:1},8,["onClick"])):Q("",!0),e(Qe)?(n(),k(ye,{key:2,class:"nc-base-menu-item","data-testid":"context-menu-item-copy",onClick:o[28]||(o[28]=gt=>e(vl)(e(Qe)))},{default:L(()=>[Se((n(),M("div",as,[Y(he,{icon:"copy"}),Le(" "+J(t.$t("general.copy"))+" "+J(t.$t("objects.cell").toLowerCase()),1)])),[[Ze,["a:row:copy"]]])]),_:1})):Q("",!0),e(Qe)&&e(Ue)&&!e(mt)?(n(),k(ye,{key:3,class:"nc-base-menu-item","data-testid":"context-menu-item-paste",disabled:e(qo),onClick:e(d)},{default:L(()=>[Se((n(),M("div",ns,[Y(he,{icon:"paste"}),Le(" "+J(t.$t("general.paste"))+" "+J(t.$t("objects.cell").toLowerCase()),1)])),[[Ze,["a:row:paste"]]])]),_:1},8,["disabled","onClick"])):Q("",!0),e(Qe)&&e(Ue)&&e(pe).isSingleCell()&&(e(ba)(e(v)[e(Qe).col])||!((et=e(sa)[0])!=null&&et[e(Qe).col].isVirtualCol))&&!e(mt)?(n(),k(ye,{key:4,class:"nc-base-menu-item",disabled:e(qo),"data-testid":"context-menu-item-clear",onClick:o[29]||(o[29]=gt=>La(e(Qe)))},{default:L(()=>[Se((n(),M("div",ls,[Y(he,{icon:"close"}),Le(" "+J(t.$t("general.clear"))+" "+J(t.$t("objects.cell").toLowerCase()),1)])),[[Ze,["a:row:clear"]]])]),_:1},8,["disabled"])):e(Qe)&&e(Ue)&&!e(mt)?(n(),k(ye,{key:5,class:"nc-base-menu-item",disabled:e(qo),"data-testid":"context-menu-item-clear",onClick:o[30]||(o[30]=gt=>Ya())},{default:L(()=>[Se((n(),M("div",rs,[Y(he,{icon:"closeBox",class:"text-gray-500"}),Le(" "+J(t.$t("general.clear"))+" "+J(t.$t("objects.cell").toLowerCase()),1)])),[[Ze,["a:row:clear-range"]]])]),_:1},8,["disabled"])):Q("",!0),e(Qe)&&e(pe).isSingleCell()&&e(Qt)("commentEdit")&&!e(T)?(n(),M(Xe,{key:6},[Y(dn),Y(ye,{class:"nc-base-menu-item",onClick:o[31]||(o[31]=gt=>yl(e(Qe).row))},{default:L(()=>[Se((n(),M("div",is,[Y(Ml,{class:"h-4 w-4"}),Le(" "+J(t.$t("general.add"))+" "+J(t.$t("general.comment").toLowerCase()),1)])),[[Ze,["a:row:comment"]]])]),_:1})],64)):Q("",!0),e(Ue)&&!e(mt)?(n(),M(Xe,{key:7},[!e(Mt)&&!e(Qe)&&t.data.some(gt=>gt.rowMeta.selected)?Q("",!0):(n(),k(dn,{key:0})),e(Qe)&&(e(pe).isSingleCell()||e(pe).isSingleRow())?(n(),k(ye,{key:1,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:o[32]||(o[32]=gt=>hl(e(Qe).row))},{default:L(()=>[Se((n(),M("div",ss,[Y(he,{icon:"delete"}),Le(" "+J(t.$t("activity.deleteRow")),1)])),[[Ze,["a:row:delete"]]])]),_:1})):e(Qe)&&e(oe)?(n(),k(ye,{key:2,class:"nc-base-menu-item !text-red-600 !hover:bg-red-50",onClick:_l},{default:L(()=>[Se((n(),M("div",us,[Y(he,{icon:"delete",class:"text-gray-500 text-red-600"}),Le(" "+J(t.$t("activity.deleteRows")),1)])),[[Ze,["a:row:delete"]]])]),_:1})):Q("",!0)],64)):Q("",!0)]}),_:1})]),default:L(()=>{var et,gt,yn;return[_("div",null,[_("table",{class:De(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white sticky top-0 z-5 bg-white",{mobile:e(T),desktop:!e(T)}]),style:Ye({transform:`translateX(${e(no)}px)`})},[Se(_("thead",{ref_key:"tableHeadEl",ref:Ft},[e(ft)?(n(),M("tr",xi,[(n(!0),M(Xe,null,Ut(e(Fa),(S,D)=>(n(),M("td",{key:D,class:De(["!bg-gray-50 h-full border-b-1 border-r-1",{"min-w-45":D!==0,"min-w-16":D===0}])},[Y(R,{active:!0,title:!0,paragraph:!1,class:De(["ml-2 -mt-2",{"max-w-32":D!==0,"max-w-5 !ml-3.5":D===0}])},null,8,["class"])],2))),128))])):Q("",!0),Se(_("tr",Ri,[_("th",{class:"w-[64px] min-w-[64px]","data-testid":"grid-id-column",style:Ye({left:`-${e(no)}px`})},[_("div",$i,[!e(we)&&!t.hideCheckbox?(n(),M(Xe,{key:0},[_("div",{class:De(["nc-no-label text-gray-500",{hidden:e(K)}])},"#",2),_("div",{class:De([{hidden:!e(K),flex:e(K)},"nc-check-all w-full items-center"])},[Y(Ee,{checked:e(K),"onUpdate:checked":o[0]||(o[0]=S=>Ot(K)?K.value=S:null)},null,8,["checked"]),o[41]||(o[41]=_("span",{class:"flex-1"},null,-1))],2)],64)):(n(),M("div",Si,"#"))])],4),e(v)[0]&&e(v)[0].id?Se((n(),M("th",{key:0,"data-col":e(v)[0].id,"data-title":e(v)[0].title,style:Ye({"min-width":((et=e(z)[e(v)[0].id])==null?void 0:et.width)||"180px","max-width":((gt=e(z)[e(v)[0].id])==null?void 0:gt.width)||"180px",width:((yn=e(z)[e(v)[0].id])==null?void 0:yn.width)||"180px",...e(no)>0?{left:`-${e(no)-64}px`}:{}}),class:De(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(ot)===e(v)[0].id}]),onXcstartresizing:o[4]||(o[4]=S=>Qa(e(v)[0].id,S)),onXcresize:o[5]||(o[5]=S=>qa(e(v)[0].id,S)),onXcresizing:o[6]||(o[6]=S=>Ja(e(v)[0].id,S)),onClick:o[7]||(o[7]=S=>Wa(e(v)[0].id))},[_("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:"false",onDragstart:o[1]||(o[1]=$t(S=>e(de)(e(v)[0].id,S),["stop"])),onDrag:o[2]||(o[2]=$t(S=>e(po)(S),["stop"])),onDragend:o[3]||(o[3]=$t(S=>e(G)(S),["stop"]))},[e(v)[0]&&e(oo)[0].isVirtualCol?(n(),k(ee,{key:0,column:e(v)[0],"hide-menu":e(we)||!!e(T)},null,8,["column","hide-menu"])):(n(),k(xt,{key:1,column:e(v)[0],"hide-menu":e(we)||!!e(T)},null,8,["column","hide-menu"]))],32)],46,Di)),[[pn]]):Q("",!0),(n(!0),M(Xe,null,Ut(e(tn),({field:S,index:D})=>{var Bt,lo,Oo;return Se((n(),M("th",{key:S.id,"data-col":S.id,"data-title":S.title,style:Ye({"min-width":((Bt=e(z)[S.id])==null?void 0:Bt.width)||"180px","max-width":((lo=e(z)[S.id])==null?void 0:lo.width)||"180px",width:((Oo=e(z)[S.id])==null?void 0:Oo.width)||"180px"}),class:De(["nc-grid-column-header",{"!border-r-blue-400 !border-r-3":e(ot)===S.id}]),onXcstartresizing:Rt=>Qa(S.id,Rt),onXcresize:Rt=>qa(S.id,Rt),onXcresizing:Rt=>Ja(S.id,Rt),onClick:Rt=>Wa(S.id)},[_("div",{class:"w-full h-full flex items-center text-gray-500 pl-2 pr-1",draggable:e(T)||D===0||e(we)||!e(Ue)?"false":"true",onDragstart:$t(Rt=>e(de)(S.id,Rt),["stop"]),onDrag:o[8]||(o[8]=$t(Rt=>e(po)(Rt),["stop"])),onDragend:o[9]||(o[9]=$t(Rt=>e(G)(Rt),["stop"]))},[e(oo)[D].isVirtualCol?(n(),k(ee,{key:0,column:S,"hide-menu":e(we)||!!e(T)},null,8,["column","hide-menu"])):(n(),k(xt,{key:1,column:S,"hide-menu":e(we)||!!e(T)},null,8,["column","hide-menu"]))],40,Mi)],46,Ai)),[[pn]])}),128)),e(Kt)?Se((n(),M("th",{key:1,class:"cursor-pointer !border-0 relative !xs:hidden",style:{borderWidth:"0px !important"},onClick:o[19]||(o[19]=$t(S=>ze.value=!0,["stop"]))},[_("div",Ci,[Y(Ht,{visible:e(ze),"onUpdate:visible":o[18]||(o[18]=S=>Ot(ze)?ze.value=S:null),trigger:["click"],"overlay-class-name":"nc-dropdown-grid-add-column",onVisibleChange:bl},zn({default:L(()=>[_("div",Ei,[("isEeUI"in t?t.isEeUI:e(wa))&&(e(Me)||e(nt))?(n(),k(he,{key:0,icon:"magic",class:"text-sm text-orange-400"})):Q("",!0),(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:2},[("isEeUI"in t?t.isEeUI:e(wa))&&e(nt)?{name:"overlay",fn:L(()=>[Y(Ct,null,{default:L(()=>{var S;return[(S=e(Yt))!=null&&S.length?(n(),k(Xt,{key:"predict-column"},{title:L(()=>[_("div",Li,[Y(Te,{class:"flex h-[1rem] text-gray-500"}),_("div",Vi,J(t.$t("activity.predictColumns")),1),Y(je,{class:"text-gray-500 ml-2"})])]),expandIcon:L(()=>o[42]||(o[42]=[])),default:L(()=>[Y(Ct,null,{default:L(()=>[(n(!0),M(Xe,null,Ut(e(Yt),D=>(n(),k(ye,{key:`predict-${D.title}-${D.type}`},{default:L(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:Bt=>Za(D.title,D.type)},[_("div",zi,J(D.title),1)],8,Fi)]),_:2},1024))),128)),Y(ye,null,{default:L(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:o[10]||(o[10]=(...D)=>e(be)&&e(be)(...D))},[_("div",Pi,[Y(Be),o[43]||(o[43]=Le(" Generate Again "))])])]),_:1})]),_:1})]),_:1})):(n(),k(ye,{key:1},{default:L(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:o[11]||(o[11]=(...D)=>e(be)&&e(be)(...D))},[e(zo)?(n(),k(Be,{key:0,class:"animate-infinite animate-spin"})):(n(),k(Te,{key:1,class:"flex h-[1rem] text-gray-500"})),_("div",Ni,J(t.$t("activity.predictColumns")),1)])]),_:1})),e(ho)?(n(),k(Xt,{key:"predict-formula"},{title:L(()=>[_("div",Oi,[Y(Tt,{class:"flex h-[1rem] text-gray-500"}),_("div",Ii,J(t.$t("activity.predictFormulas")),1),Y(je,{class:"text-gray-500 ml-2"})])]),expandIcon:L(()=>o[44]||(o[44]=[])),default:L(()=>[Y(Ct,null,{default:L(()=>[(n(!0),M(Xe,null,Ut(e(ho),D=>(n(),k(ye,{key:`predict-${D.title}-formula`},{default:L(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:Bt=>Za(D.title,"Formula",{formula_raw:D.formula})},[_("div",Bi,J(D.title),1)],8,Ti)]),_:2},1024))),128))]),_:1})]),_:1})):(n(),k(ye,{key:3},{default:L(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:o[12]||(o[12]=(...D)=>e(l)&&e(l)(...D))},[e(Po)?(n(),k(Be,{key:0,class:"animate-infinite animate-spin"})):(n(),k(Tt,{key:1,class:"flex h-[1rem] text-gray-500"})),_("div",Gi,J(t.$t("activity.predictFormulas")),1)])]),_:1}))]}),_:1})]),key:"0"}:{name:"overlay",fn:L(()=>[_("div",Hi,[e(ze)?(n(),k(wt,{key:0,ref_key:"editOrAddProviderRef",ref:en,preload:e(U),"column-position":e(Zt),class:De({hidden:e(Ea)}),onSubmit:o[13]||(o[13]=S=>Pa(!0)),onCancel:o[14]||(o[14]=S=>Pa()),onClick:o[15]||(o[15]=$t(()=>{},["stop"])),onKeydown:o[16]||(o[16]=$t(()=>{},["stop"])),onMounted:o[17]||(o[17]=S=>U.value=void 0)},null,8,["preload","column-position","class"])):Q("",!0)])]),key:"1"}]),1032,["visible"])])])),[[Ze,["c:column:add"]]]):Q("",!0),_("th",Ui,[_("div",{class:De(["absolute top-0 w-45",{"left-[60px]":e(Kt),"left-0":!e(Kt)}])},"  ",2)])],512),[[To,!e(ft)]])],512),[[To,e(Ne)!==!0]])],6),e(Ao)?Q("",!0):(n(),M("div",{key:0,class:De(["table-overlay",{"nc-grid-skeleton-loader":e(Ao)}]),style:Ye({height:`${e(xl)}px`,width:`${e(kl)}px`})},[_("table",{ref_key:"smartTable",ref:me,class:De(["xc-row-table nc-grid backgroundColorDefault !h-auto bg-white relative",{mobile:e(T),desktop:!e(T),"w-full":e(F).length===0,"pb-12":!e(x)&&!e(_e)}]),style:Ye({transform:`translateY(${e($l)}px) translateX(${e(no)}px)`}),onContextmenu:fo},[e(x)!==!0?(n(),M("tbody",{key:0,ref_key:"tableBodyEl",ref:ut},[e(Ao)?(n(!0),M(Xe,{key:0},Ut(e(dl),(S,D)=>(n(),M("tr",{key:D},[(n(!0),M(Xe,null,Ut(e(Fa),(Bt,lo)=>(n(),M("td",{key:lo,class:De(["border-b-1 border-r-1",{"min-w-45":lo!==0,"min-w-16":lo===0}])},null,2))),128))]))),128)):Q("",!0),(n(!0),M(Xe,null,Ut(e(Rl),({row:S,index:D})=>(n(),k(Al,{key:D,row:S},{default:L(({state:Bt})=>{var lo,Oo,Rt,_n,bn,kn,xn,Rn,$n,Sn;return[Se(_("tr",{class:De(["nc-grid-row !xs:h-14",{"active-row":e(w).row===D||((lo=e(pe)._start)==null?void 0:lo.row)===D,"mouse-down":e(eo)||e(Ha),"selected-row":S.rowMeta.selected}]),style:Ye({height:t.rowHeight?`${("rowHeightInPx"in t?t.rowHeightInPx:e(vo))[`${t.rowHeight}`]}px`:`${("rowHeightInPx"in t?t.rowHeightInPx:e(vo))[1]}px`}),"data-testid":`grid-row-${D}`},[_("td",{key:"row-index",class:"caption nc-grid-cell w-[64px] min-w-[64px]",style:Ye({left:`-${e(no)}px`}),"data-testid":`cell-Id-${D}`,onContextmenu:o[20]||(o[20]=ne=>Qe.value=null)},[_("div",ji,[_("div",{class:De(["nc-row-no sm:min-w-4 text-xs text-gray-500",{toggle:!e(we),hidden:S.rowMeta.selected}])},J(((((Oo=e(P))==null?void 0:Oo.page)??1)-1)*(((Rt=e(P))==null?void 0:Rt.pageSize)??25)+D+1),3),e(we)?Q("",!0):(n(),M("div",{key:0,class:De([{hidden:!S.rowMeta.selected,flex:S.rowMeta.selected},"nc-row-expand-and-checkbox"])},[Y(Ee,{checked:S.rowMeta.selected,"onUpdate:checked":ne=>S.rowMeta.selected=ne},null,8,["checked","onUpdate:checked"])],2)),o[45]||(o[45]=_("span",{class:"flex-1"},null,-1)),_("div",{class:De(["nc-expand",{"nc-comment":(_n=S.rowMeta)==null?void 0:_n.commentCount}]),"data-testid":`nc-expand-${D}`},[S.rowMeta.saving?(n(),k(Nt,{key:0,class:"!flex items-center","data-testid":`row-save-spinner-${D}`},null,8,["data-testid"])):Q("",!0),(bn=S.rowMeta)!=null&&bn.commentCount&&e(le)?Se((n(),M("span",{key:1,class:"px-1 rounded-md rounded-bl-none transition-all border-1 border-brand-200 text-xs cursor-pointer font-sembold select-none leading-5 text-brand-500 bg-brand-50",onClick:ne=>pa(S,Bt)},[Le(J(S.rowMeta.commentCount),1)],8,Xi)),[[Ze,["c:expanded-form:open"]]]):S.rowMeta.saving?Q("",!0):(n(),M("div",qi,[e(le)?Se((n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).expand),{key:0,class:"select-none transform hover:text-black hover:scale-120 nc-row-expand",onClick:ne=>pa(S,Bt)},null,8,["onClick"])),[[Ze,["c:row-expand:open"]]]):Q("",!0)]))],10,Ki)])],44,Yi),e(v)[0]?(n(),k(un,{key:e(v)[0].id,class:De(["cell relative nc-grid-cell cursor-pointer",{active:e(Yo)[`${D}-0`],"active-cell":e(w).row===D&&e(w).col===0||((kn=e(pe)._start)==null?void 0:kn.row)===D&&((xn=e(pe)._start)==null?void 0:xn.col)===0,"nc-required-cell":e(sa)[D][0].isColumnRequiredAndNull&&!e(Re),"align-middle":!t.rowHeight||t.rowHeight===1,"align-top":t.rowHeight&&t.rowHeight!==1,filling:e(Ia)[`${D}-0`],readonly:e(oo)[0].isReadonly&&e(Ue)&&e(Yo)[`${D}-0`],"!border-r-blue-400 !border-r-3":e(ot)===e(v)[0].id}]),style:Ye({"min-width":((Rn=e(z)[e(v)[0].id])==null?void 0:Rn.width)||"180px","max-width":(($n=e(z)[e(v)[0].id])==null?void 0:$n.width)||"180px",width:((Sn=e(z)[e(v)[0].id])==null?void 0:Sn.width)||"180px",...e(no)>0?{left:`-${e(no)-64}px`}:{}}),"data-testid":`cell-${e(v)[0].title}-${D}`,"data-key":`data-key-${D}-${e(v)[0].id}`,"data-col":e(v)[0].id,"data-title":e(v)[0].title,"data-row-index":D,"data-col-index":0,onMousedown:ne=>e(Ta)(ne,D,0),onMouseover:ne=>e(Ba)(ne,D,0),onClick:ne=>ln(ne,D,0),onDblclick:ne=>ia(S,e(v)[0]),onContextmenu:ne=>fo(ne,{row:D,col:0})},{default:L(()=>[e(Pt)?Q("",!0):(n(),M("div",Ji,[e(v)[0]&&e(oo)[0].isVirtualCol&&e(v)[0].title?(n(),k(rn,{key:0,modelValue:S.row[e(v)[0].title],"onUpdate:modelValue":ne=>S.row[e(v)[0].title]=ne,column:e(v)[0],active:e(w).col===0&&e(w).row===D,row:S,"read-only":!e(Ue),onNavigate:Ko,onSave:ne=>{var Ke;return(Ke=e(E))==null?void 0:Ke(S,"",Bt)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):e(v)[0]&&e(v)[0].title?(n(),k(sn,{key:1,modelValue:S.row[e(v)[0].title],"onUpdate:modelValue":ne=>S.row[e(v)[0].title]=ne,column:e(v)[0],"edit-enabled":!!e(Ue)&&!!e(Pe)&&e(w).col===0&&e(w).row===D,"row-index":D,active:e(w).col===0&&e(w).row===D,"read-only":!e(Ue),"onUpdate:editEnabled":o[21]||(o[21]=ne=>Pe.value=ne),onSave:ne=>{var Ke;return(Ke=e(E))==null?void 0:Ke(S,e(v)[0].title,Bt)},onNavigate:Ko,onCancel:o[22]||(o[22]=ne=>Pe.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):Q("",!0)]))]),_:2},1032,["class","style","data-testid","data-key","data-col","data-title","data-row-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])):Q("",!0),(n(!0),M(Xe,null,Ut(e(tn),({field:ne,index:Ke})=>{var Dn,An,Mn,Cn,En;return n(),k(un,{key:`cell-${Ke}-${D}`,class:De(["cell relative nc-grid-cell cursor-pointer",{active:e(Yo)[`${D}-${Ke}`],"active-cell":e(w).row===D&&e(w).col===Ke||((Dn=e(pe)._start)==null?void 0:Dn.row)===D&&((An=e(pe)._start)==null?void 0:An.col)===Ke,"nc-required-cell":e(sa)[D][Ke].isColumnRequiredAndNull&&!e(Re),"align-middle":!t.rowHeight||t.rowHeight===1,"align-top":t.rowHeight&&t.rowHeight!==1,filling:e(Ia)[`${D}-${Ke}`],readonly:e(oo)[Ke].isReadonly&&e(Ue)&&e(Yo)[`${D}-${Ke}`],"!border-r-blue-400 !border-r-3":e(ot)===ne.id}]),style:Ye({"min-width":((Mn=e(z)[ne.id])==null?void 0:Mn.width)||"180px","max-width":((Cn=e(z)[ne.id])==null?void 0:Cn.width)||"180px",width:((En=e(z)[ne.id])==null?void 0:En.width)||"180px"}),"data-testid":`cell-${ne.title}-${D}`,"data-key":`data-key-${D}-${ne.id}`,"data-col":ne.id,"data-title":ne.title,"data-row-index":D,"data-col-index":Ke,onMousedown:dt=>e(Ta)(dt,D,Ke),onMouseover:dt=>e(Ba)(dt,D,Ke),onClick:dt=>ln(dt,D,Ke),onDblclick:dt=>ia(S,ne),onContextmenu:dt=>fo(dt,{row:D,col:Ke})},{default:L(()=>[e(Pt)?Q("",!0):(n(),M("div",Qi,[e(oo)[Ke].isVirtualCol&&ne.title?(n(),k(rn,{key:0,modelValue:S.row[ne.title],"onUpdate:modelValue":dt=>S.row[ne.title]=dt,column:ne,active:e(w).col===Ke&&e(w).row===D,row:S,"read-only":!e(Ue),onNavigate:Ko,onSave:dt=>{var Io;return(Io=e(E))==null?void 0:Io(S,"",Bt)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):ne.title?(n(),k(sn,{key:1,modelValue:S.row[ne.title],"onUpdate:modelValue":dt=>S.row[ne.title]=dt,column:ne,"edit-enabled":!!e(Ue)&&!!e(Pe)&&e(w).col===Ke&&e(w).row===D,"row-index":D,active:e(w).col===Ke&&e(w).row===D,"read-only":!e(Ue),"onUpdate:editEnabled":o[23]||(o[23]=dt=>Pe.value=dt),onSave:dt=>{var Io;return(Io=e(E))==null?void 0:Io(S,ne.title,Bt)},onNavigate:Ko,onCancel:o[24]||(o[24]=dt=>Pe.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):Q("",!0)]))]),_:2},1032,["class","style","data-testid","data-key","data-col","data-title","data-row-index","data-col-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128))],14,Wi),[[To,!e(Ao)]])]}),_:2},1032,["row"]))),128)),e(mo)&&!e(_e)?Se((n(),M("tr",{key:1,class:De(["text-left nc-grid-add-new-cell cursor-pointer group relative z-3 xs:hidden",{"!border-r-2 !border-r-gray-100":e(Va)===1}]),onMouseup:o[25]||(o[25]=$t(()=>{},["stop"])),onClick:o[26]||(o[26]=S=>ao())},[_("td",{class:"nc-grid-add-new-cell-item h-8 border-b-1 border-gray-100 bg-white group-hover:bg-gray-50 absolute left-0 bottom-0 px-2 sticky z-40 w-full flex items-center text-gray-500",style:Ye({left:`-${e(no)}px`})},[e(ft)?Q("",!0):(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).plus),{key:0,class:"text-pint-500 text-base ml-2 mt-0 text-gray-600 group-hover:text-black"}))],4),_("td",{class:"!border-gray-100",colspan:e(Va)},null,8,Zi)],34)),[[Ze,["c:row:add:grid-bottom"]]]):Q("",!0)],512)):Q("",!0)],38),Se(_("div",{ref_key:"fillHandle",ref:pt,class:De(["nc-fill-handle",!e(pe).isEmpty()&&e(pe).end.col!==0||e(pe).isEmpty()&&e(w).col!==0?"z-3":"z-4"]),style:Ye({top:`${e(on)}px`,left:`${e(an)}px`,cursor:"crosshair"})},null,6),[[To,e(Sl)]])],6))])]}),_:1},8,["visible","trigger"])],2),_("div",ds,[e(x)!==!0&&e(P)&&e(_e)?(n(),k(El,{key:`nc-pagination-${e(T)}`,"pagination-data":e(P),"onUpdate:paginationData":o[37]||(o[37]=et=>Ot(P)?P.value=et:null),"show-api-timing":!e(_e),"align-count-on-right":"","align-left":e(_e),"change-page":e(b),"hide-sidebars":((wn=e(qe))==null?void 0:wn.hideSidebars)===!0,"fixed-size":(gn=e(qe))==null?void 0:gn.fixedSize,"extra-style":(hn=e(qe))==null?void 0:hn.extraStyle,"show-size-changer":!e(_e)},zn({_:2},[e(mo)&&!e(Ao)?{name:"add-record",fn:L(()=>[_("div",cs,[e(T)?Se((n(),k(Jo,{key:0,class:"nc-grid-add-new-row",type:"secondary",disabled:e(ae),onClick:o[35]||(o[35]=$t(et=>Mo(),["stop"]))},{default:L(()=>[Le(J(t.$t("activity.newRecord")),1)]),_:1},8,["disabled"])),[[Ze,[e(c)?"c:row:add:grid":"c:row:add:form"]]]):Se((n(),k(Cl,{key:1,class:"nc-grid-add-new-row",placement:"top",disabled:e(ae),onClick:o[36]||(o[36]=$t(et=>e(c)?ao():Mo(),["stop"]))},{overlay:L(()=>{var et;return[_("div",fs,[_("div",{class:De(["absolute -top-21 flex flex-col min-h-34.5 w-70 p-1.5 bg-white rounded-lg border-1 border-gray-200 justify-start overflow-hidden",{"-left-32.5":!e(c),"-left-21.5":e(c)}]),style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},[Se((n(),M("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-grid group",onClick:Oa},[_("div",ms,[_("div",vs,[(n(),k(ro((et=("viewIcons"in t?t.viewIcons:e(Pn))[e(ha).GRID])==null?void 0:et.icon),{class:"nc-view-icon text-inherit"})),Le(" "+J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.grid")),1)]),e(c)?(n(),k(he,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):Q("",!0)]),_("div",ws,J(t.$t("labels.addRowGrid")),1)])),[[Ze,["c:row:add:grid"]]]),Se((n(),M("div",{class:"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer rounded-md hover:bg-gray-100 text-gray-600 nc-new-record-with-form group",onClick:Mo},[_("div",gs,[_("div",hs,[Y(he,{class:"h-4.5 w-4.5",icon:"article"}),Le(" "+J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.form")),1)]),e(c)?Q("",!0):(n(),k(he,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),_("div",ys,J(t.$t("labels.addRowForm")),1)])),[[Ze,["c:row:add:form"]]])],2)])]}),icon:L(()=>[(n(),k(ro(("iconMap"in t?t.iconMap:e(bo)).arrowUp),{class:"text-gray-600 h-4 w-4"}))]),default:L(()=>[_("div",ps,[_("span",null,[e(c)?(n(),M(Xe,{key:0},[Le(J(t.$t("activity.newRecord")),1)],64)):(n(),M(Xe,{key:1},[Le(J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.form")),1)],64))])])]),_:1},8,["disabled"])),[[Ze,[e(c)?"c:row:add:grid:toggle":"c:row:add:form:toggle"]]])])]),key:"0"}:void 0]),1032,["pagination-data","show-api-timing","align-left","change-page","hide-sidebars","fixed-size","extra-style","show-size-changer"])):e(P)?(n(),k(Ll,{key:1,"pagination-data":e(P),"onUpdate:paginationData":o[38]||(o[38]=et=>Ot(P)?P.value=et:null),"change-page":e(b),"show-size-changer":!e(_e),"scroll-left":e(ja)},null,8,["pagination-data","change-page","show-size-changer","scroll-left"])):Q("",!0)]),e(x)!==!0&&e(P)&&!e(_e)?(n(),M("div",_s,[e(mo)&&!e(Ao)?(n(),k(cn,{key:0},{overlay:L(()=>[Y(Ct,null,{default:L(()=>[Se((n(),k(ye,{class:"nc-new-record-with-grid group",onClick:Oa},{default:L(()=>{var et;return[_("div",Rs,[(n(),k(ro((et=("viewIcons"in t?t.viewIcons:e(Pn))[e(ha).GRID])==null?void 0:et.icon),{class:"nc-view-icon text-inherit"})),Le(" "+J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.grid")),1)]),e(c)?(n(),k(he,{key:0,icon:"check",class:"w-4 h-4 text-primary"})):Q("",!0)]}),_:1})),[[Ze,["c:row:add:grid"]]]),Se((n(),k(ye,{class:"nc-new-record-with-form group",onClick:Mo},{default:L(()=>[_("div",$s,[Y(he,{class:"h-4.5 w-4.5",icon:"article"}),Le(" "+J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.form")),1)]),e(c)?Q("",!0):(n(),k(he,{key:0,icon:"check",class:"w-4 h-4 text-primary"}))]),_:1})),[[Ze,["c:row:add:form"]]])]),_:1})]),default:L(()=>[_("div",bs,[e(T)?Se((n(),k(Jo,{key:0,disabled:e(ae),class:"nc-grid-add-new-row",size:"small",type:"secondary",onClick:o[39]||(o[39]=$t(et=>Mo(),["stop"]))},{default:L(()=>[_("div",ks,[Y(he,{icon:"plus"}),o[46]||(o[46]=Le(" New Record "))])]),_:1},8,["disabled"])),[[Ze,[e(c)?"c:row:add:grid":"c:row:add:form"]]]):Se((n(),k(Jo,{key:1,disabled:e(ae),class:"!rounded-r-none !border-r-0 nc-grid-add-new-row",size:"small",type:"secondary",onClick:o[40]||(o[40]=$t(et=>e(c)?ao():Mo(),["stop"]))},{default:L(()=>[_("div",xs,[Y(he,{icon:"plus"}),e(c)?(n(),M(Xe,{key:0},[Le(J(t.$t("activity.newRecord")),1)],64)):(n(),M(Xe,{key:1},[Le(J(t.$t("activity.newRecord"))+" - "+J(t.$t("objects.viewType.form")),1)],64))])]),_:1},8,["disabled"])),[[Ze,[e(c)?"c:row:add:grid":"c:row:add:form"]]]),e(T)?Q("",!0):(n(),k(Jo,{key:2,size:"small",class:"!rounded-l-none nc-add-record-more-info",type:"secondary"},{default:L(()=>[Y(he,{icon:"arrowUp"})]),_:1}))])]),_:1})):Q("",!0)])):Q("",!0)],2)}}}),Ca=tl(Ss,[["__scopeId","data-v-ea5e2b37"]]),Ds=So({__name:"Aggregation",props:{group:{},maxDepth:{},scrollLeft:{}},setup(f){return(y,i)=>(n(),M("div"))}}),As=ht(()=>yt(()=>import("./CRPCEw5j.js"),__vite__mapDeps([93,1,2,86,87,94,65,95,88,89,25,96,97,98,99,100,101,102,103,104,16,17,18,19,20,21,22,105,106,107,108,109,110,53,4,111,72,73,3,74,112,113,50,51,114,12,13,55,52,115,63,82,81,116]),import.meta.url).then(f=>f.default||f)),Ms=So({__name:"GroupByTable",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},depth:{},maxDepth:{},rowHeight:{},paginationFixedSize:{},paginationHideSidebars:{type:Boolean},scrollLeft:{},viewWidth:{},scrollable:{}},emits:["update:paginationData"],setup(f,{emit:y}){const i=f,a=Da(i,"group",y),{t:K}=Ho(),P=ol(),F=Ge(la,h()),qe=Ge(Aa,h()),x=Ge(aa,h(!1)),Ne=h(!1),{eventBus:m}=Uo(),te=P.currentRoute,Z=j(()=>te.value.query),xe=h(!1),H=h(),W=h(),b=j(()=>Z.value.group),A=j({get(){return!!Z.value.rowId},set(g){g||(P.push({query:{...Z.value,rowId:void 0,group:void 0}}),H.value={},W.value={})}});function E(g,N,B=!1,I){var q;const ae=ct(g.row,(q=F.value)==null?void 0:q.columns);if(W.value=N,ae&&!x.value)P.push({query:{...Z.value,group:a.value.key,rowId:ae}});else{if(I&&I!==a.value.key)return;H.value=g,xe.value=!0,Ne.value=!B}}const ce=g=>{m.emit(co.CLEAR_NEW_ROW,g)};function le(g,N,B=F.value){if(g.nested||!g.rows)return;N=N??g.rows.length;const I=g.nestedIn.reduce((ae,q)=>(q.key!=="__nc_null__"&&!ba(q.column_uidt)&&![$.Rollup,$.Lookup,$.Formula,$.Barcode,$.QrCode].includes(q.column_uidt)&&(ae[q.title]=q.key,q.column_uidt===$.Checkbox&&(ae[q.title]=ae[q.title]===$o.TRUE?!0:ae[q.title]===$o.FALSE?!1:!!ae[q.title])),ae),{});return g.count=g.count+1,g.rows.splice(N,0,{row:{...br(B==null?void 0:B.columns),...I},oldRow:{},rowMeta:{new:!0}}),g.rows[N]}const X=j(()=>!a.value.nested&&a.value.rows?a.value.rows:[]),{deleteRow:oe,deleteSelectedRows:ve,deleteRangeOfRows:ie,updateOrSaveRow:fe,bulkUpdateRows:re,selectedAllRecords:v,removeRowIfNew:we}=hr({meta:F,viewMeta:qe,formattedData:X,paginationData:h(a.value.paginationData),callbacks:{changePage:g=>i.loadGroupPage(a.value,g),loadData:()=>i.loadGroupData(a.value,!0),globalCallback:()=>{var g;return(g=i.redistributeRows)==null?void 0:g.call(i)}}}),se=async g=>{a.value.count=a.value.count-1,await oe(g)},Re=async g=>{await i.loadGroupData(a.value,!0,{...(g==null?void 0:g.offset)!==void 0?{offset:g.offset}:{}})};Et(qn,h(!0));const _e=j(()=>({fixedSize:i.paginationFixedSize?i.paginationFixedSize-2:void 0,hideSidebars:i.paginationHideSidebars,extraStyle:"background: transparent !important; border-top: 0px;"}));function $e(){return X.value.findIndex(g=>{var N;return Z.value.rowId===ct(g.row,(N=F.value)==null?void 0:N.columns)})}const He=async g=>{var q,Je,_t,Vt,tt;let B=$e()+(g===wo.NEXT?1:-1);for(;(Je=(q=X.value[B])==null?void 0:q.rowMeta)!=null&&Je.new;)B=B+(g===wo.NEXT?1:-1);const I=((_t=a.value.paginationData)==null?void 0:_t.page)||1;if(B<0){if(I===1)return Ve.info(K("msg.info.noMoreRecords"));await i.loadGroupPage(a.value,I-1),B=X.value.length-1}else if(B>=X.value.length){if((Vt=a.value.paginationData)!=null&&Vt.isLastPage)return Ve.info(K("msg.info.noMoreRecords"));await i.loadGroupPage(a.value,I+1),B=0}const ae=ct(X.value[B].row,(tt=F.value)==null?void 0:tt.columns);ae&&await P.push({query:{...Z.value,rowId:ae}})},u=async()=>{var N,B,I,ae;const g=$e();if(!((N=a.value.paginationData)!=null&&N.isLastPage)&&g===((B=a.value.paginationData)==null?void 0:B.pageSize)){const q=(I=a.value.paginationData)!=null&&I.page?((ae=a.value.paginationData)==null?void 0:ae.page)+1:1;await i.loadGroupPage(a.value,q)}He(wo.NEXT)},T=async()=>{var N,B,I;const g=$e();if(!((N=a.value.paginationData)!=null&&N.isFirstPage)&&g===1){const ae=(B=a.value.paginationData)!=null&&B.page?((I=a.value.paginationData)==null?void 0:I.page)-1:1;await i.loadGroupPage(a.value,ae)}He(wo.PREV)},c=j(()=>{var N;const g=$e();return((N=a.value.paginationData)==null?void 0:N.isLastPage)&&g===X.value.length-1}),r=j(()=>{var N;const g=$e();return((N=a.value.paginationData)==null?void 0:N.isFirstPage)&&g===0});async function C(){ve&&(await ve(),await Re({shouldShowLoading:!1}))}return(g,N)=>{var ae;const B=As,I=al;return n(),M(Xe,null,[e(a).rows?(n(),k(Ca,{key:0,"selected-all-records":e(v),"onUpdate:selectedAllRecords":N[0]||(N[0]=q=>Ot(v)?v.value=q:null),class:"nc-group-table",data:e(a).rows,"v-group":e(a),"pagination-data":e(a).paginationData,"load-data":async()=>{},"change-page":q=>i.loadGroupPage(e(a),q),"call-add-empty-row":q=>le(e(a),q),"expand-form":E,"row-height":g.rowHeight,"delete-row":se,"delete-selected-rows":C,"delete-range-of-rows":e(ie),"update-or-save-row":e(fe),"remove-row-if-new":e(we),"bulk-update-rows":e(re),"hide-header":!0,pagination:e(_e),"disable-skeleton":!0,"disable-virtual-y":!0},null,8,["selected-all-records","data","v-group","pagination-data","change-page","call-add-empty-row","row-height","delete-range-of-rows","update-or-save-row","remove-row-if-new","bulk-update-rows","pagination"])):Q("",!0),(n(),k(ka,null,{default:L(()=>[e(H)&&e(xe)?(n(),k(B,{key:0,modelValue:e(xe),"onUpdate:modelValue":[N[1]||(N[1]=q=>Ot(xe)?xe.value=q:null),N[2]||(N[2]=q=>ce(e(H)))],"load-row":!e(x),row:e(H),state:e(W),meta:e(F),view:e(qe)},null,8,["modelValue","load-row","row","state","meta","view"])):Q("",!0)]),_:1})),e(A)&&((ae=e(F))!=null&&ae.id)&&e(b)===e(a).key?(n(),k(I,{key:1,modelValue:e(A),"onUpdate:modelValue":N[3]||(N[3]=q=>Ot(A)?A.value=q:null),row:e(H)??{row:{},oldRow:{},rowMeta:{}},meta:e(F),"load-row":!e(x),state:e(W),"row-id":e(Z).rowId,view:e(qe),"show-next-prev-icons":"","first-row":e(r),"last-row":e(c),"expand-form":E,onNext:u,onPrev:T},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):Q("",!0)],64)}}}),Cs=ht(()=>yt(()=>import("./BIhr-Z4C.js"),__vite__mapDeps([69,1,2,3,8,70]),import.meta.url).then(f=>f.default||f)),Es=ht(()=>yt(()=>import("./DG2ZH8TR.js"),__vite__mapDeps([71,1,2,72,53,73,3,74,4,8,75]),import.meta.url).then(f=>f.default||f)),Ls=ht(()=>yt(()=>import("./Tryc0omP.js"),__vite__mapDeps([76,72,53,1,2,73,3,74,4]),import.meta.url).then(f=>f.default||f)),Vs={class:"pointer-events-none"},Fs=So({__name:"GroupByLabel",props:{column:{},modelValue:{}},setup(f){return Et(Xn,h(!0)),Et(ur,h(!0)),(y,i)=>{const V=Cs,a=Es,K=Ls;return n(),M("div",Vs,[Y(K,{row:{row:{[y.column.title]:y.modelValue},rowMeta:{}}},{default:L(()=>[e(qt)(y.column)?(n(),k(V,{key:0,"model-value":y.modelValue,class:"!text-gray-600",column:y.column,"read-only":!0},null,8,["model-value","column"])):(n(),k(a,{key:1,"model-value":y.modelValue,class:"!text-gray-600",column:y.column,"edit-enabled":!1,"read-only":!0},null,8,["model-value","column"]))]),_:1},8,["row"])])}}}),zs=ht(()=>yt(()=>import("./DkmQdKZ4.js"),__vite__mapDeps([85,1,2,86,87,88,89,25,90,91,92,54,80,81,82,83,93,94,65,95,96,97,98,99,100,101,102,103,104,16,17,18,19,20,21,22,105,106,107,108,109,110,53,4,111,72,73,3,74,112,113,50,51,114,12,13,55,52,115,63,116,117,118,31,119,8,120,121,122,49,123,124,125]),import.meta.url).then(f=>f.default||f)),Ps=ht(()=>yt(()=>import("./Fr_cZ1zf.js"),__vite__mapDeps([77,78,1,2,41,29,18,42,20,19,79,80,81,82,83,16,17,21,22,84]),import.meta.url).then(f=>f.default||f)),Ns={key:0,class:"flex sticky top-0 z-5"},Os={class:"flex items-center"},Is={class:"flex"},Ts={key:1,class:"flex min-w-[100px] flex-wrap"},Bs={key:1,class:"text-gray-400"},Gs={class:"text-xs group-hover:hidden text-gray-500 nc-group-row-count"},Hs={class:"text-[#374151] ml-2"},Us=So({__name:"GroupBy",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},loadGroupAggregation:{type:Function},redistributeRows:{type:Function},viewWidth:{},scrollLeft:{},fullPage:{type:Boolean},depth:{},maxDepth:{},rowHeight:{},expandForm:{type:Function}},emits:["update:paginationData"],setup(f,{emit:y}){const i=f,a=Da(i,"group",y),K=Ge(la,h()),P=Ge(oa,h()),{gridViewPageSize:F}=Ra(),qe=io(i,"scrollLeft"),{isViewDataLoading:x,isPaginationLoading:Ne}=Vo(Sa()),{gridViewCols:m}=ra(),te=Ge(Gn,Lo()),Z=j(()=>{var r,C;return(C=(r=K.value)==null?void 0:r.columns)==null?void 0:C.find(g=>g.pv)}),xe=j(()=>!Z.value||!Z.value.id?{width:"100px"}:m.value[Z.value.id]),H=Ge(Ma,Lo());te==null||te.on(async r=>{var C;if((C=P.value)!=null&&C.length&&((!r||!(r!=null&&r.fields.length))&&await i.loadGroupAggregation(a.value),r!=null&&r.fields)){const g=r.fields.reduce((N,B)=>{const I=P.value.find(ae=>ae.title===B.title);return I!=null&&I.id&&(N[I.id]=B.aggregation??m.value[I.id].aggregation??Hn.None),N},{});await i.loadGroupAggregation(a.value,Object.entries(g).map(([N,B])=>({field:N,type:B})))}});const W=async(r,C,g)=>{x.value=!0,Ne.value=!0,await i.loadGroupData(r,C,g),x.value=!1,Ne.value=!1},b=i.depth??0,A=h(),E=h(),ce=h(),le=j(()=>{var r;return i.fullPage??(((r=ce.value)==null?void 0:r.offsetWidth)??0)>(i.viewWidth??0)}),X=h(),oe=j(()=>X.value?Array.isArray(X.value)?X.value.map(r=>r.replace("group-panel-","")):[X.value.replace("group-panel-","")]:[]),ve=h([]),ie=async r=>{var C,g;if(r=Array.isArray(r)?r:[r],r.length>0&&a.value.children&&!ve.value.includes(r[r.length-1])){await na(()=>{var I;return((I=a.value.children)==null?void 0:I.length)>0}).toBeTruthy({timeout:1e4});const N=r[r.length-1].replace("group-panel-",""),B=a.value.children.find(I=>`${I.key}`===N);B&&(B.nested?(C=B.children[0].children)!=null&&C.length||i.loadGroups({},B,{triggerChildOnly:!0}):(g=B.rows)!=null&&g.length||W(B))}ve.value=r},fe=r=>{a.value.nested?i.loadGroups({...(r==null?void 0:r.offset)!==void 0?{offset:r.offset}:{}},a.value):(W(a.value,!0,{...(r==null?void 0:r.offset)!==void 0?{offset:r.offset}:{}}),i.loadGroupAggregation(a.value))};ta(async()=>{H==null||H.on(fe)}),Qn(async()=>{H==null||H.off(fe)}),Ro([()=>a.value.key],async(r,C)=>{r!==C&&(a.value.nested?a.value.nested&&await i.loadGroups({},a.value):await W(a.value,!0))}),ta(async()=>{var r,C;a.value.root===!0&&!((C=(r=a.value)==null?void 0:r.children)!=null&&C.length)&&await i.loadGroups({limit:F.value},a.value)}),a.value.root===!0&&Et(Jn,A);const re=h(),v=j(()=>{if(a.value.root===!0)return re.value??0;if(i.scrollLeft&&i.viewWidth&&E.value){const r=E.value.scrollWidth+12+12;return i.scrollLeft+i.viewWidth+20>r?r-i.viewWidth-20:Math.max(Math.min(r-i.viewWidth,(i.scrollLeft??0)-12),0)}return 0}),we=r=>{a.value.root&&(re.value=r.target.scrollLeft)},se=r=>{var g,N,B,I,ae,q,Je,_t,Vt;let C=r.key.toString();if(C&&((g=r.column)==null?void 0:g.uidt)===$.Lookup||((N=r.column)==null?void 0:N.uidt)===$.LinkToAnotherRecord)try{C=JSON.parse(C)}catch{return C.split("___")}if(C&&((B=r.column)==null?void 0:B.uidt)===$.DateTime)return[Nn(C,`${((ae=Lt((I=r.column)==null?void 0:I.meta))==null?void 0:ae.date_format)??Kn[0]} ${((Je=Lt((q=r.column)==null?void 0:q.meta))==null?void 0:Je.time_format)??_a[0]}`)];if(C&&((_t=r.column)==null?void 0:_t.uidt)===$.Time)return[Nn(C,_a[0],!1)];if(C&&[$.User,$.CreatedBy,$.LastModifiedBy].includes((Vt=r.column)==null?void 0:Vt.uidt))try{return[JSON.parse(C)]}catch{return null}return[C]},Re=r=>[$.Lookup,$.Attachment,$.Barcode,$.QrCode,$.Links,$.User,$.DateTime,$.CreatedTime,$.LastModifiedTime,$.CreatedBy,$.LongText,$.LastModifiedBy].includes(r==null?void 0:r.uidt),_e=async r=>{Array.isArray(X.value)?X.value.push(`group-panel-${r}`):X.value=[`group-panel-${r}`],await ie(`group-panel-${r}`)},$e=r=>{Array.isArray(X.value)?X.value=X.value.filter(C=>C!==`group-panel-${r}`):X.value=[]},He=()=>{X.value=[]},u=async()=>{var r;X.value=((r=a.value.children)==null?void 0:r.map(C=>`group-panel-${C.key}`))??[],a.value.children&&await Promise.all(a.value.children.map(C=>ie(`group-panel-${C.key}`)))},T=j(()=>{var B;const r=Number((((B=xe.value)==null?void 0:B.width)??"").replace("px",""))+55+i.maxDepth*9,C=i.maxDepth??1,g=a.value.root?re.value??0:qe.value??0,N=I=>{switch(I){case 3:return`${r-18}px`;case 2:return`${r-9}px`;case 1:default:return`${r}px`}};return b===0?g<29?`${r+g-(.02*(g*g)+1.07*g)}px`:N(C):b===1?g<30?`${r+g-9-23/20*g}px`:N(C):b===2?g<=14?`${r+g-18-g}px`:N(C):`${r}px`}),c=j(()=>{if(i.maxDepth===3)switch(b){case 2:return"#F9F9FA";case 1:return"#F4F4F5";default:return"#F1F1F1"}if(i.maxDepth===2)switch(b){case 1:return"#F9F9FA";default:return"#F4F4F5"}return i.maxDepth===1,"#F9F9FA"});return(r,C)=>{const g=Zn,N=el,B=Pr,I=ll,ae=rl,q=il,Je=Ds,_t=Nr,Vt=Or,tt=zs,Wt=Ps;return n(),M(Xe,null,[_("div",{ref_key:"wrapper",ref:A,class:De([{"overflow-y-auto":e(a).root===!0},"h-full"]),style:Ye(`${!e(a).root&&e(a).nested?"padding-left: 8px; padding-right: 8px;":""}`),onScroll:we},[_("div",{ref_key:"scrollable",ref:E,style:Ye(`${e(a).root===!0?"width: fit-content":"width: 100%"}`)},[e(a).root===!0?(n(),M("div",Ns,[_("div",{class:"border-b-1 border-gray-200 mb-2",style:Ye([{"background-color":"#f4f4f5"},{"padding-left":`${(r.maxDepth||1)*9}px`}])},null,4),Y(Ca,{ref_key:"tableHeader",ref:ce,class:"mb-2",data:[],"hide-checkbox":!0,"header-only":!0},null,512)])):Q("",!0),_("div",{class:De({"pl-2":e(a).root===!0})},[Y(Vt,{activeKey:e(X),"onUpdate:activeKey":C[1]||(C[1]=st=>Ot(X)?X.value=st:null),class:"nc-group-wrapper !rounded-lg",bordered:!1,onChange:ie},{default:L(()=>{var st;return[(n(!0),M(Xe,null,Ut(Object.entries(((st=e(a))==null?void 0:st.children)??[]),([Do,z])=>(n(),k(_t,{key:`group-panel-${z.key}`,class:"!border-1 border-gray-300 nc-group rounded-[8px] mb-2",style:Ye(`background: ${e(c)};`),"show-arrow":!1},{header:L(()=>[_("div",{class:De([{"!rounded-b-none":e(oe).includes(z.key.toString()),"!border-b-1":e(b)===(r.maxDepth??1)-1&&e(oe).includes(z.key.toString())},"flex !sticky w-full items-center rounded-b-lg select-none transition-all !rounded-t-[8px] !h-10"])},[_("div",{class:De([{"!rounded-bl-[8px]":!e(oe).includes(z.key.toString())},"!sticky flex z-10 justify-between !h-9.8 border-r-1 !rounded-tl-[8px] group pr-2 border-gray-300 overflow-clip items-center !left-0"]),style:Ye(`width:${e(T)};background: ${e(c)};`)},[_("div",Os,[Y(N,{class:"!border-0 !shadow-none !bg-transparent !hover:bg-transparent",type:"secondary",size:"small"},{default:L(()=>[Y(g,{icon:"chevronDown",class:"transition-all",style:Ye(`${e(oe).includes(z.key.toString())?"transform: rotate(360deg)":"transform: rotate(270deg)"}`)},null,8,["style"])]),_:2},1024),_("div",Is,[z.column.uidt==="MultiSelect"?(n(!0),M(Xe,{key:0},Ut(Object.entries(z.key.split(",")),([it,Dt])=>(n(),k(B,{key:`panel-tag-${z.column.id}-${Dt}`,class:"!py-0 !px-[12px] !rounded-[12px]",color:z.color.split(",")[+it]},{default:L(()=>[_("span",{class:"nc-group-value",style:Ye({color:e(Zo).isReadable(z.color.split(",")[+it]||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Zo).mostReadable(z.color.split(",")[+it]||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},J(Dt in("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES?("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES[Dt]:Dt),5)]),_:2},1032,["color"]))),128)):!(z.key in("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES)&&Re(z.column)?(n(),M("div",Ts,[(n(!0),M(Xe,null,Ut(se(z),(it,Dt)=>(n(),M(Xe,{key:Dt},[it?(n(),k(Fs,{key:0,column:z.column,"model-value":it},null,8,["column","model-value"])):(n(),M("span",Bs,"No mapped value"))],64))),128))])):(n(),k(B,{key:`panel-tag-${z.column.id}-${z.key}`,class:De(["!py-0 !px-[12px]",`${z.column.uidt==="SingleSelect"?"!rounded-[12px]":"!rounded-[6px]"}`]),color:z.color},{default:L(()=>{var it;return[_("span",{class:"nc-group-value font-semibold text-[13px]",style:Ye({color:e(Zo).isReadable(z.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Zo).mostReadable(z.color||"#ccc",["#0b1d05","#fff"]).toHex8String()})},[z.key in("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES?(n(),M(Xe,{key:0},[Le(J(("GROUP_BY_VARS"in r?r.GROUP_BY_VARS:e($o)).VAR_TITLES[z.key]),1)],64)):(n(),M(Xe,{key:1},[Le(J((it=se(z))==null?void 0:it.join(", ")),1)],64))],4)]}),_:2},1032,["class","color"]))])]),_("div",{style:Ye(`background: linear-gradient(to right, hsla(0, 0%, 97%, 0), ${e(c)} 18%);`),class:"flex !h-10 absolute right-0 pl-8 pr-2 items-center"},[_("div",Gs,[_("span",null,J(r.$t("datatype.Count")),1),_("span",Hs,J(z.count),1)]),Y(q,{class:"!hidden !group-hover:block"},{overlay:L(()=>[Y(ae,null,{default:L(()=>[e(oe).includes(z.key.toString())?(n(),k(I,{key:0,onClick:it=>$e(z.key)},{default:L(()=>[Y(g,{icon:"minimize"}),C[4]||(C[4]=Le(" Collapse group "))]),_:2},1032,["onClick"])):(n(),k(I,{key:1,onClick:it=>_e(z.key)},{default:L(()=>[Y(g,{icon:"maximize"}),C[5]||(C[5]=Le(" Expand group "))]),_:2},1032,["onClick"])),Y(I,{onClick:u},{default:L(()=>[Y(g,{icon:"maximizeAll"}),C[6]||(C[6]=Le(" Expand all "))]),_:1}),Y(I,{onClick:He},{default:L(()=>[Y(g,{icon:"minimizeAll"}),C[7]||(C[7]=Le(" Collapse all "))]),_:1})]),_:2},1024)]),default:L(()=>[Y(N,{size:"small",type:"text",onClick:C[0]||(C[0]=$t(()=>{},["stop"]))},{default:L(()=>[Y(g,{icon:"threeDotVertical"})]),_:1})]),_:2},1024)],4)],6),Y(Je,{"scroll-left":i.scrollLeft||e(re),"max-depth":r.maxDepth,group:z,depth:e(b)},null,8,["scroll-left","max-depth","group","depth"])],2)]),default:L(()=>[!z.nested&&z.rows?(n(),k(Ms,{key:0,group:z,"max-depth":r.maxDepth,depth:r.depth,"load-groups":r.loadGroups,"load-group-data":W,"load-group-page":r.loadGroupPage,"group-wrapper-change-page":r.groupWrapperChangePage,"row-height":r.rowHeight,"redistribute-rows":r.redistributeRows,"pagination-fixed-size":e(le)?i.viewWidth:void 0,"pagination-hide-sidebars":!0,"scroll-left":i.scrollLeft||e(re),"view-width":r.viewWidth,scrollable:e(E)},null,8,["group","max-depth","depth","load-groups","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","pagination-fixed-size","scroll-left","view-width","scrollable"])):(n(),k(sl,{key:1,group:z,"load-groups":r.loadGroups,"load-group-data":W,"load-group-page":r.loadGroupPage,"group-wrapper-change-page":r.groupWrapperChangePage,"row-height":r.rowHeight,"load-group-aggregation":r.loadGroupAggregation,"redistribute-rows":r.redistributeRows,"view-width":r.viewWidth,depth:e(b)+1,"max-depth":r.maxDepth,"scroll-left":e(v),"full-page":e(le)},null,8,["group","load-groups","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","redistribute-rows","view-width","depth","max-depth","scroll-left","full-page"]))]),_:2},1032,["style"]))),128))]}),_:1},8,["activeKey"])],2)],4)],38),e(a).root?(n(),k(tt,{key:0,"pagination-data":e(a).paginationData,"onUpdate:paginationData":C[2]||(C[2]=st=>e(a).paginationData=st),"show-size-changer":!0,"scroll-left":e(re),"custom-label":"groups",depth:r.maxDepth,"change-page":st=>r.groupWrapperChangePage(st,e(a))},null,8,["pagination-data","scroll-left","depth","change-page"])):(n(),k(Wt,{key:1,"pagination-data":e(a).paginationData,"onUpdate:paginationData":C[3]||(C[3]=st=>e(a).paginationData=st),"align-count-on-right":"","custom-label":"groups","align-left":"","show-api-timing":"","change-page":st=>r.groupWrapperChangePage(st,e(a)),"hide-sidebars":!0,style:Ye(`${i.depth&&i.depth>0?"border-radius: 0 0 8px 8px !important; background: transparent; border-top: 0px; height: 24px; padding-bottom: 8px;":""}`),"fixed-size":void 0},null,8,["pagination-data","change-page","style"]))],64)}}}),sl=tl(Us,[["__scopeId","data-v-1b50c32d"]]),Ws=ht(()=>yt(()=>import("./CRPCEw5j.js"),__vite__mapDeps([93,1,2,86,87,94,65,95,88,89,25,96,97,98,99,100,101,102,103,104,16,17,18,19,20,21,22,105,106,107,108,109,110,53,4,111,72,73,3,74,112,113,50,51,114,12,13,55,52,115,63,82,81,116]),import.meta.url).then(f=>f.default||f)),Ys=ht(()=>yt(()=>import("./n-vjrPcC.js"),__vite__mapDeps([126,1,2]),import.meta.url).then(f=>f.default||f)),js=So({__name:"index",setup(f,{expose:y}){const i=Ge(la,h()),V=Ge(Aa,h()),a=Ge(Ma,Lo());Ge(oa,h([]));const K=ol(),P=K.currentRoute,{xWhere:F,eventBus:qe}=Uo(),{t:x}=Ho(),Ne=h(!1),m=j(()=>P.value.query),te=h(!1),Z=h(),xe=h(),H=h();Ir(V,i,F);const{loadData:W,paginationData:b,formattedData:A,updateOrSaveRow:E,changePage:ce,addEmptyRow:le,deleteRow:X,deleteSelectedRows:oe,selectedAllRecords:ve,removeRowIfNew:ie,navigateToSiblingRow:fe,getExpandedRowIndex:re,deleteRangeOfRows:v,bulkUpdateRows:we,bulkUpdateView:se,optimisedQuery:Re,islastRow:_e,isFirstRow:$e,aggCommentCount:He}=yr(i,V,F),u=j(()=>{var be,l,d,p;if(((l=(be=V.value)==null?void 0:be.view)==null?void 0:l.row_height)!==void 0)switch((p=(d=V.value)==null?void 0:d.view)==null?void 0:p.row_height){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 6;default:return 1}});Et(dr,h(!1)),Et(cr,h(!1)),Et(pr,h(!0)),Et(fr,h(!1)),Et(mr,u);const T=Ge(aa,h(!1));Et(vr,a);const c=h(!1);function r(be,l,d=!1){var ue;const p=ct(be.row,(ue=i.value)==null?void 0:ue.columns);xe.value=l,p&&!T.value?(Z.value=void 0,K.push({query:{...m.value,rowId:p}})):(Z.value=be,te.value=!0,c.value=!d)}y({loadData:W,openColumnCreate:be=>{var l;(l=H.value)==null||l.openColumnCreate(be)}});const g=j({get(){return!!m.value.rowId},set(be){be||K.push({query:{...m.value,rowId:void 0}})}}),N=be=>{c.value||qe.emit(co.CLEAR_NEW_ROW,be)},B=()=>{Re.value?(Re.value=!1,Ve.info(x("msg.optimizedQueryDisabled"))):(Re.value=!0,Ve.info(x("msg.optimizedQueryEnabled")))},{rootGroup:I,groupBy:ae,isGroupBy:q,loadGroups:Je,loadGroupData:_t,loadGroupPage:Vt,groupWrapperChangePage:tt,redistributeRows:Wt,loadGroupAggregation:st}=kr(),Do=nl(),{windowSize:z,leftSidebarWidth:it}=wr(Do),Dt=h(0);qe.on(be=>{(be===co.GROUP_BY_RELOAD||be===co.DATA_RELOAD)&&(a==null||a.trigger())});const Fo=()=>{var l,d;const be=re();if(!b.value.isLastPage&&be===b.value.pageSize){const p=(l=b.value)!=null&&l.page?((d=b.value)==null?void 0:d.page)+1:1;ce(p)}fe(wo.NEXT)},zo=()=>{var l,d;const be=re();if(!b.value.isFirstPage&&be===1){const p=(l=b.value)!=null&&l.page?((d=b.value)==null?void 0:d.page)-1:1;ce(p)}fe(wo.PREV)},Yt=()=>{if(T.value){Dt.value=z.value;return}Dt.value=z.value-it.value},Po=j(()=>{switch(ae.value.length){case 1:return"#F9F9FA";case 2:return"#F4F4F5";case 3:return"#E7E7E9";default:return"#F9F9FA"}}),ho=be=>{if(!m.value.rowId)return;const l=He.value.findIndex(p=>p.row_id===m.value.rowId),d=A.value.findIndex(p=>{var ue;return ct(p.row,(ue=i.value)==null?void 0:ue.columns)===m.value.rowId});l===-1||d===-1||Number(He.value[l].count)!==be&&(He.value[l].count=be,A.value[d].rowMeta.commentCount=be)};return Ro([z,it],Yt),ta(()=>{Yt()}),(be,l)=>{var Fe;const d=Ws,p=al,ue=Ys;return n(),M("div",{class:"relative flex flex-col h-full min-h-0 w-full nc-grid-wrapper","data-testid":"nc-grid-wrapper",style:Ye(`background-color: ${e(q)?`${e(Po)}`:"var(--nc-grid-bg)"};`)},[e(q)?(n(),k(sl,{key:1,group:e(I),"load-groups":e(Je),"load-group-data":e(_t),"load-group-page":e(Vt),"group-wrapper-change-page":e(tt),"row-height":e(u),"load-group-aggregation":e(st),"max-depth":e(ae).length,"redistribute-rows":e(Wt),"view-width":e(Dt)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","load-group-aggregation","max-depth","redistribute-rows","view-width"])):(n(),k(Ca,{key:0,ref_key:"tableRef",ref:H,"selected-all-records":e(ve),"onUpdate:selectedAllRecords":l[0]||(l[0]=O=>Ot(ve)?ve.value=O:null),data:e(A),"pagination-data":e(b),"load-data":e(W),"change-page":e(ce),"call-add-empty-row":e(le),"delete-row":e(X),"update-or-save-row":e(E),"delete-selected-rows":e(oe),"delete-range-of-rows":e(v),"bulk-update-rows":e(we),"expand-form":r,"remove-row-if-new":e(ie),"row-height":e(u),onToggleOptimisedQuery:B,onBulkUpdateDlg:l[1]||(l[1]=O=>Ne.value=!0)},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","bulk-update-rows","remove-row-if-new","row-height"])),e(q)?Q("",!0):(n(),k(ka,{key:2},{default:L(()=>[e(Z)&&e(te)?(n(),k(d,{key:0,modelValue:e(te),"onUpdate:modelValue":[l[2]||(l[2]=O=>Ot(te)?te.value=O:null),l[3]||(l[3]=O=>N(e(Z)))],"load-row":!e(T),row:e(Z),state:e(xe),meta:e(i),view:e(V)},null,8,["modelValue","load-row","row","state","meta","view"])):Q("",!0)]),_:1})),e(g)&&((Fe=e(i))!=null&&Fe.id)&&!e(q)?(n(),k(p,{key:3,modelValue:e(g),"onUpdate:modelValue":l[4]||(l[4]=O=>Ot(g)?g.value=O:null),row:e(Z)??{row:{},oldRow:{},rowMeta:{}},meta:e(i),"load-row":!e(T),state:e(xe),"row-id":e(m).rowId,view:e(V),"show-next-prev-icons":"","first-row":e($e),"last-row":e(_e),"expand-form":r,onNext:l[5]||(l[5]=O=>Fo()),onPrev:l[6]||(l[6]=O=>zo()),onUpdateRowCommentCount:ho},null,8,["modelValue","row","meta","load-row","state","row-id","view","first-row","last-row"])):Q("",!0),(n(),k(ka,null,{default:L(()=>[e(Ne)?(n(),k(ue,{key:0,modelValue:e(Ne),"onUpdate:modelValue":l[7]||(l[7]=O=>Ot(Ne)?Ne.value=O:null),"pagination-data":e(b),meta:e(i),view:e(V),"bulk-update-rows":e(we),"bulk-update-view":e(se),"selected-all-records":e(ve),rows:e(A).filter(O=>O.rowMeta.selected)},null,8,["modelValue","pagination-data","meta","view","bulk-update-rows","bulk-update-view","selected-all-records","rows"])):Q("",!0)]),_:1}))],4)}}}),_u=Object.freeze(Object.defineProperty({__proto__:null,default:js},Symbol.toStringTag,{value:"Module"}));export{_u as i,Br as u};
