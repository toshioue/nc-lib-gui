import{f as z,cB as V,at as D,ai as L,r,N as P,i as j,n as c,aC as U,a1 as $,o as p,c as x,P as e,S as w,a as u,t as I,b as m,w as k,U as G,V as H,W as Q,T as W,d as q,ak as A,Q as B,aS as F,A as J,_ as K}from"./nEPQs079.js";import{_ as O}from"./BntE2T_9.js";import{_ as X}from"./DJpQD7nd.js";import"./4x_dpF5A.js";import"./BTGvCRQH.js";import"./CFgyk-dW.js";import"./BQQOEPN4.js";import"./BLe4UTYD.js";import"./DKtVUO_j.js";import"./COktFmkf.js";import"./DRxh3NGE.js";import"./BfnA8LRy.js";import"./Dmq5P-i4.js";import"./C9R3Q-Om.js";import"./BdIpmjdG.js";import"./ByzT15Y-.js";import"./DzMAdbS0.js";import"./QHUCxglU.js";import"./B-HMHOhf.js";import"./QTd5iuHu.js";const Y={class:"h-full flex flex-col gap-4 w-full"},Z={key:0,class:"text-red-500"},tt={class:"flex flex-row justify-between items-center"},et={class:"mb-4 first-letter:capital font-bold"},at={class:"flex items-center gap-2 text-gray-600 font-light"},st={class:"h-[calc(100%_-_102px)] overflow-y-auto nc-scrollbar-thin"},ot={key:1,class:"flex flex-row justify-center items-center"},nt=z({__name:"BaseAudit",props:{sourceId:{}},setup(R){const v=R,S=V(),{base:h}=D(S),{$api:C}=J(),{t:o}=L(),d=r(!1),_=r(null),f=r(0),n=r(1),s=r(25),{appInfo:E}=P();async function b(t=n.value,a=s.value){try{if(!v.sourceId)return;d.value=!0;const{list:l,pageInfo:y}=await C.base.auditList(h.value.id,{offset:a*(t-1),limit:a,sourceId:v.sourceId});_.value=l,f.value=y.totalRows??0}catch(l){console.error(l)}finally{d.value=!1}}j(async()=>{_.value===null&&await b(n.value,s.value)});const i=t=>()=>c("div",{class:"text-gray-500"},t),N=[{title:i(o("labels.operationType")),dataIndex:"op_type",key:"op_type",width:120},{title:i(o("labels.operationSubType")),dataIndex:"op_sub_type",key:"op_sub_type",width:160},{title:i(o("labels.description")),dataIndex:"description",key:"description",customRender:t=>c("pre",{},t.text),width:350},{title:i(o("objects.user")),dataIndex:"user",key:"user",customRender:t=>c("div",{},t.text||"Shared base"),width:200},{title:i(o("labels.created")),dataIndex:"created_at",key:"created_at",sort:"desc",customRender:t=>c($,{placement:"bottom",title:c("span",{},t.text)},()=>U(t.text)),width:"13%"}];return(t,a)=>{const l=F,y=A,T=O,M=X;return p(),x("div",Y,[e(E).auditEnabled?w("",!0):(p(),x("div",Z,"Audit logs are currently disabled by administrators.")),u("div",tt,[u("h6",et,"Audit : "+I(e(h).title),1),m(l,{class:"self-start !rounded-md",onClick:b},{default:k(()=>[u("div",at,[(p(),G(H(("iconMap"in t?t.iconMap:e(Q)).reload),{class:W({"animate-infinite animate-spin !text-success":e(d)})},null,8,["class"])),q(" "+I(t.$t("general.reload")),1)])]),_:1})]),u("div",st,[m(T,{class:"nc-audit-table w-full",size:"small","data-source":e(_)??[],columns:N,pagination:!1,loading:e(d),"data-testid":"audit-tab-table",sticky:"",bordered:""},{emptyText:k(()=>[m(y,{image:e(A).PRESENTED_IMAGE_SIMPLE,description:t.$t("labels.noData")},null,8,["image","description"])]),_:1},8,["data-source","loading"])]),+e(f)>e(s)?(p(),x("div",ot,[m(M,{current:e(n),"onUpdate:current":a[0]||(a[0]=g=>B(n)?n.value=g:null),"page-size":e(s),"onUpdate:pageSize":a[1]||(a[1]=g=>B(s)?s.value=g:null),total:+e(f),"show-less-items":"",class:"pagination",onChange:b},null,8,["current","page-size","total"])])):w("",!0)])}}}),Bt=K(nt,[["__scopeId","data-v-7e1a7caf"]]);export{Bt as default};
