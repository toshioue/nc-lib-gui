import{e as Y,ba as fe,bL as m,r as f,d6 as ee,d7 as te,f as L,c$ as d,d0 as se,hM as ve,fE as oe,g3 as V,o as n,c as p,b as U,N as s,d8 as _e,gT as be,dz as Se,L as he,aw as ye,ib as ge,ij as ke,hD as we,F as Ce,g as Oe,M as Me,Q as r,w as u,a as _,W as k,ao as x,at as Z,P as O,t as M,T as I,U as T,R as N,O as J,V as Ie,jd as Te,d as K,S as X,ji as Le,Z as $e,_ as De}from"./DZZ6t_j4.js";import{_ as Ee}from"./CzKSHp3Z.js";import{a as ne}from"./i4aLU0Nw.js";import{u as ae}from"./CS2EbUee.js";import{_ as xe}from"./BtLb9F6G.js";import{_ as Ne}from"./DnSVh-oD.js";import{_ as Ue}from"./vK-WmZ7a.js";import{a as Ve}from"./B05h-4V9.js";import{u as Be}from"./BlrQG98t.js";import{g as je}from"./EMCYuzyZ.js";import{S as Re}from"./D_MsYLkT.js";import"./DC_VdAC1.js";import"./hZgTYrdl.js";import"./ByVBARmO.js";import"./37hePIet.js";import"./C4K5fdHe.js";import"./CR5b0rlC.js";import"./BVrX6sNU.js";import"./DKN1hQ6S.js";import"./BQuyMdA-.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";import"./GMLocJHP.js";import"./BCJFTkwv.js";import"./CB1aB6F1.js";const Fe={class:"nc-sort-create-modal"},ze=Y({__name:"CreateSort",props:{isParentOpen:{type:Boolean}},emits:["created"],setup(A,{emit:$}){const B=A,j=$,{isParentOpen:w}=fe(B),R=m(ee,f()),D=m(te,f()),{showSystemFields:l,metaColumnById:b}=ne(),{sorts:E}=ae(R),F=L(()=>{var v,S;return((S=(v=D.value)==null?void 0:v.columns)==null?void 0:S.filter(o=>{var g;return o.uidt===d.Links?!0:se((g=b==null?void 0:b.value)==null?void 0:g[o.id])?ve(o,D.value)?!1:l.value:o.uidt===d.QrCode||o.uidt===d.Barcode||o.uidt===d.ID||o.uidt===d.Button?!1:!(oe(o)&&![V.BELONGS_TO,V.ONE_TO_ONE].includes(o.colOptions.type))}).filter(o=>!E.value.find(g=>g.fk_column_id===o.id)))??[]}),z=v=>{j("created",v)};return(v,S)=>{const o=Ee;return n(),p("div",Fe,[U(o,{"is-parent-open":s(w),"search-input-placeholder":v.$t("msg.selectFieldToSort"),options:s(F),"toolbar-menu":"sort",onSelected:z},null,8,["is-parent-open","search-input-placeholder","options"])])}}}),Pe={class:"flex items-center gap-1"},Ae={class:"flex items-center gap-2"},Ge={key:0,class:"text-capitalize !text-[13px] font-medium"},Qe={key:0,class:"bg-brand-50 text-brand-500 py-1 px-2 text-md rounded-md"},We={key:1,class:"pt-2 pb-2 pl-4 nc-filter-list max-h-[max(80vh,30rem)] min-w-102","data-testid":"nc-sorts-menu"},qe={class:"w-full flex items-center justify-between gap-2"},He={class:"truncate flex-1"},Ze={class:"flex gap-1 items-center"},Je={key:1},Ke={class:"flex gap-1 items-center"},Xe=Y({__name:"SortListMenu",setup(A){const $=m(te,f()),B=m(ee,f()),j=m(_e,f(!1)),w=m(be),R=m(Se,f(!1)),{eventBus:D}=Ve(),{sorts:l,saveOrUpdate:b,loadSorts:E,addSort:F,deleteSort:z}=ae(B,()=>w==null?void 0:w.trigger()),{showSystemFields:v,metaColumnById:S}=ne(),o=f(!1),{isMobileMode:g}=he(),{getPlanLimit:ie}=ye(),G=m(ge,f(!1)),re=m(ke,L(()=>!1));D.on(e=>{e===we.SORT_RELOAD&&E()});const P=L(()=>{var e;return((e=$.value)==null?void 0:e.columns)||[]}),Q=L(()=>P.value.reduce((e,t)=>(e[t.id]=t,e),{})),le=L(()=>{var e;return(e=P.value)==null?void 0:e.filter(t=>{var i;return t.uidt===d.Links?!0:se((i=S==null?void 0:S.value)==null?void 0:i[t.id])?v.value:t.uidt===d.QrCode||t.uidt===d.Barcode||t.uidt===d.ID||t.uidt===d.Button?!1:!(oe(t)&&![V.BELONGS_TO,V.ONE_TO_ONE].includes(t.colOptions.type))}).filter(t=>!l.value.find(i=>i.fk_column_id===t.id))}),de=e=>{if(!e||!Q.value[e])return"";const t=Q.value[e];let i=t.uidt;return t.uidt===d.Formula&&(i=Le({formulaColumn:t})||i),i||""},h=f(!1);Be(h);const W=e=>{F(!0,e);const t=l.value[l.value.length-1];b(t,l.value.length-1),o.value=!1};return Ce(h,()=>{h.value||(o.value=!1)}),Oe(()=>{E()}),(e,t)=>{const i=$e,q=ze,ce=xe,ue=Re,pe=Ne,H=Ue,C=Me("e");return n(),r(H,{visible:s(h),"onUpdate:visible":t[6]||(t[6]=a=>J(h)?h.value=a:null),trigger:["click"],class:"!xs:hidden","overlay-class-name":"nc-dropdown-sort-menu nc-toolbar-dropdown"},{overlay:u(()=>[s(l).length?(n(),p("div",We,[_("div",{class:"sort-grid max-h-120 nc-scrollbar-thin pr-4 my-2 py-1",onClick:t[2]||(t[2]=k(()=>{},["stop"]))},[(n(!0),p(x,null,Z(s(l),(a,y)=>(n(),p(x,{key:y},[U(ce,{modelValue:a.fk_column_id,"onUpdate:modelValue":[c=>a.fk_column_id=c,c=>s(b)(a,y)],class:"flex caption nc-sort-field-select w-44 flex-grow",columns:s(P),"is-sort":"",meta:s($),onClick:t[0]||(t[0]=k(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns","meta"]),U(pe,{value:a.direction,"onUpdate:value":c=>a.direction=c,class:"shrink grow-0 nc-sort-dir-select",label:e.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir !rounded-lg",onClick:t[1]||(t[1]=k(()=>{},["stop"])),onSelect:c=>s(b)(a,y)},{default:u(()=>[(n(!0),p(x,null,Z(("getSortDirectionOptions"in e?e.getSortDirectionOptions:s(je))(de(a.fk_column_id)),(c,me)=>O((n(),r(ue,{key:me,value:c.value},{default:u(()=>[_("div",qe,[_("div",He,M(c.text),1),a.direction===c.value?(n(),r(I(("iconMap"in e?e.iconMap:s(T)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary w-4 h-4"})):N("",!0)])]),_:2},1032,["value"])),[[C,["c:sort:operation:select"]]])),128))]),_:2},1032,["value","onUpdate:value","label","onSelect"]),O((n(),r(i,{type:"text",size:"small",class:"nc-sort-item-remove-btn !max-w-8",onClick:k(c=>s(z)(a,y),["stop"])},{default:u(()=>[(n(),r(I(("iconMap"in e?e.iconMap:s(T)).deleteListItem)))]),_:2},1032,["onClick"])),[[C,["c:sort:delete"]]])],64))),128))]),s(le).length?(n(),r(H,{key:0,visible:s(o),"onUpdate:visible":t[5]||(t[5]=a=>J(o)?o.value=a:null),trigger:["click"],"overlay-class-name":"nc-toolbar-dropdown"},{overlay:u(()=>[U(q,{"is-parent-open":s(o),onCreated:W},null,8,["is-parent-open"])]),default:u(()=>[("isEeUI"in e?e.isEeUI:s(Ie))&&!s(R)?(n(),p(x,{key:0},[s(l).length<s(ie)(s(Te).SORT_LIMIT)?O((n(),r(i,{key:0,class:"!text-brand-500 mt-1 mb-2",type:"text",size:"small",onClick:t[3]||(t[3]=k(a=>o.value=!0,["stop"]))},{default:u(()=>[_("div",Ze,[(n(),r(I(("iconMap"in e?e.iconMap:s(T)).plus))),K(" "+M(e.$t("activity.addSort")),1)])]),_:1})),[[C,["c:sort:add"]]]):(n(),p("span",Je))],64)):O((n(),r(i,{key:1,class:"!text-brand-500 mt-1 mb-2",type:"text",size:"small",onClick:t[4]||(t[4]=k(a=>o.value=!0,["stop"]))},{default:u(()=>[_("div",Ke,[(n(),r(I(("iconMap"in e?e.iconMap:s(T)).plus))),K(" "+M(e.$t("activity.addSort")),1)])]),_:1})),[[C,["c:sort:add"]]])]),_:1},8,["visible"])):N("",!0)])):(n(),r(q,{key:0,"is-parent-open":s(h),onCreated:W},null,8,["is-parent-open"]))]),default:u(()=>{var a;return[_("div",{class:X({"nc-active-btn":(a=s(l))==null?void 0:a.length})},[O((n(),r(i,{class:X([{"!border-1 !rounded-md":s(G),"!border-0":!s(G)},"nc-sort-menu-btn nc-toolbar-btn !h-7"]),disabled:s(j),size:"small",type:"secondary"},{default:u(()=>{var y;return[_("div",Pe,[_("div",Ae,[(n(),r(I(("iconMap"in e?e.iconMap:s(T)).sort),{class:"h-4 w-4 text-inherit"})),!s(g)&&!s(re)?(n(),p("span",Ge,M(e.$t("activity.sort")),1)):N("",!0)]),(y=s(l))!=null&&y.length?(n(),p("span",Qe,M(s(l).length),1)):N("",!0)])]}),_:1},8,["class","disabled"])),[[C,["c:sort"]]])],2)]}),_:1},8,["visible"])}}}),It=De(Xe,[["__scopeId","data-v-12294cc2"]]);export{It as default};
