import{f as lt,ai as it,cY as ot,bN as at,r as A,da as st,cQ as nt,az as rt,id as dt,g as te,d2 as ut,L as ct,d1 as x,aG as pt,aM as ye,fL as le,cW as ft,ip as Le,H as Se,i as mt,fZ as vt,io as Ne,o as v,c as W,a as h,P as i,b as c,aq as he,w as d,S as b,T as B,Q as _t,d as F,t as y,co as gt,U as E,V as De,W as Ve,Y as ce,fO as yt,aL as Ee,cg as ht,A as kt,hX as bt,hY as wt,aj as Q,b1 as xt,fr as Ct,$ as Ft,a0 as $t,a1 as Ot,h0 as It,p as Tt,e as At,_ as Lt}from"./3QBYHahY.js";import{_ as St}from"./DRopnK1z.js";import Nt from"./BV5EkxN-.js";import Dt from"./CtMydB5S.js";import{_ as Vt}from"./DHsWytsD.js";import{_ as Et}from"./DdUr8XSo.js";import{_ as Mt}from"./PcgFfkcK.js";import{_ as jt}from"./Kma333Sh.js";import{c as Me,_ as Rt}from"./CKo3fFqv.js";import{a as Ut}from"./BteOdwRG.js";import{a as zt}from"./CfxEkdGP.js";import{k as Bt}from"./BYmqikBK.js";import{_ as Kt}from"./Cst4YF69.js";import{d as je}from"./G4Pt-Lbf.js";import{D as Ht}from"./Ddy65kPJ.js";import{S as qt}from"./Giw8WUI1.js";import"./kHOslGNR.js";import{I as Pt}from"./CmN9vPg3.js";import"./Dg1gNFnz.js";import"./Ci1lK5Ee.js";import"./xnDaHwV-.js";import"./DPqnb67u.js";import"./D4iSzjWt.js";import"./CJ26qO3d.js";import"./DiJvWPjA.js";import"./WrawXyJR.js";import"./xWA_7i9p.js";import"./CWtzMcwx.js";import"./DAKhk9t6.js";import"./Bk0xUMNV.js";import"./CGxepfeV.js";import"./wEQwkVjR.js";import"./DvDgJkhr.js";import"./ChSCnN6E.js";import"./BHEjdcp1.js";import"./CfC0eoFh.js";import"./BITed4Cc.js";import"./DiZ67kIC.js";import"./BEpKpjF5.js";import"./BQQOEPN4.js";import"./3ezdMRmZ.js";import"./DPgYHC40.js";import"./B6ykf4kl.js";import"./og6cBSyd.js";import"./4uOUlFJU.js";import"./DD1BMgnW.js";import"./0DGTjfkJ.js";import"./2yzrrcqg.js";import"./C9Sjn86N.js";import"./CsJPQclb.js";import"./CTSlxRce.js";import"./D7hrRKCy.js";import"./BLIqcdwb.js";import"./CtQJu3r-.js";import"./DHn6lT7K.js";import"./C95Svpv6.js";import"./BsWDDIqE.js";import"./CyuhXrst.js";import"./D_owt2V3.js";import"./BVQBF9Vn.js";import"./CSl6euFG.js";import"./DEVpQDRz.js";import"./ceYq-xax.js";const Wt=""+new URL("multi-field-editor.DjOPELNE.png",import.meta.url).href,Qt=ie=>(Tt("data-v-d4e79286"),ie=ie(),At(),ie),Xt={class:"nc-fields-wrapper w-full p-4"},Yt={class:"max-w-250 h-full w-full mx-auto"},Gt={key:0,class:"flex flex-row justify-between mt-2"},Zt={class:"flex flex-row gap-x-4"},Jt={class:"flex w-full justify-between py-2"},el={class:"flex gap-2"},tl={class:"flex items-center gap-2"},ll={class:"flex flex-row rounded-lg border-1 overflow-clip border-gray-200"},il=["data-testid","onClick"],ol={class:"flex items-center flex-1 py-2.5 gap-1 w-2/6"},al={"data-testid":"nc-field-title"},sl={class:"flex items-center justify-end gap-1"},nl={class:"nc-field-status-wrapper flex items-center"},rl={class:"flex items-center text-xs gap-1"},dl=["onClick"],ul={class:"flex flex-row text-gray-500 text-xs items-baseline gap-x-1 font-bold","data-testid":"nc-field-item-id"},cl={class:"text-red-500"},pl=["data-testid"],fl={class:"flex items-center flex-1 py-2.5 gap-1 w-2/6"},ml={"data-testid":"nc-field-title"},vl={class:"flex items-center justify-end gap-1"},_l={class:"flex items-center"},gl={class:"flex items-center text-xs gap-1"},yl={class:"flex flex-row text-gray-500 text-xs items-baseline gap-x-1 font-bold","data-testid":"nc-field-item-id"},hl={key:1,class:"w-[25rem] flex flex-col justify-center p-4 items-center"},kl=Qt(()=>h("img",{src:Wt,class:"!w-[18rem]"},null,-1)),bl={class:"text-2xl text-gray-600 font-bold text-center pt-6"},wl={class:"text-center text-sm px-2 text-gray-500 pt-6"},xl=lt({__name:"Fields",setup(ie){const{t:P}=it(),{$api:oe}=kt(),{getMeta:Re}=ot(),{meta:I,view:Y}=Ut(),$=at(st,A(!1)),ke=nt(),{openedViewsTab:ae}=rt(ke),H=A([]),D=A([]),R=A([]),se=A(),{copy:Ue}=dt(),{fields:pe,toggleFieldVisibility:ze,loadViewColumns:Be,isViewColumnsLoading:Ke}=zt(),q=A(!1),ne=A(),K=A([]),re=A(!1),u=(e,t)=>e!=null&&e.id&&(t!=null&&t.id)?e.id===t.id:e!=null&&e.temp_id&&(t!=null&&t.temp_id)?e.temp_id===t.temp_id:!1,de=te(()=>{const e={};if(pe.value)for(const t of pe.value)t.fk_column_id&&(e[t.fk_column_id]=t);return e}),G=e=>{if(!e)return-1;const t=D.value.find(l=>u(l.column,e));if(t)return t.order;if(e.id){const l=de.value[e.id];if(l)return l.order}return-1},_=te({get:()=>(H.value??[]).filter(t=>!t.fk_column_id&&!ut(t)).concat(K.value).map(t=>Ye(t)).sort((t,l)=>G(t)-G(l)),set:e=>{var t;H.value=(t=H.value)==null?void 0:t.map(l=>{const o=e.find(m=>u(m,l));return o||l})}}),n=A(),X=A(""),fe=(e,t=!1)=>{if(!pe.value)return-1;if(e<=0){const w=_.value.find(V=>V.pv);return w?w.order||0:-1}if(e>=_.value.length-1){const w=_.value.map(V=>G(V));return Math.max(...w)+1}let l=-1,o=-1;const m=_.value[e+(t?-1:0)],s=_.value[e+(t?0:1)];return m&&(l=G(m)),s&&(o=G(s),o===-1&&(o=l+1)),(l+o)/2},p=A([]),He=A(0),me=A(!1),Z=A(),ue=A(),qe=(e,t=!1)=>{const l=_.value.findIndex(o=>u(o,e));l!==-1&&(Z.value=t?l:l+1)},{isMetaReadOnly:Pe}=ct(),be=e=>!(Pe.value&&!bt.includes(e==null?void 0:e.uidt)&&!wt.includes(e==null?void 0:e.uidt)),L=(e,t)=>{if(e!=null&&e.id&&(e!=null&&e.uidt)&&!be(e))return Q.info(P("msg.info.schemaReadOnly"));if(e&&(e!=null&&e.pk)){Q.info(P("msg.info.editingPKnotSupported"));return}t&&t.target instanceof HTMLElement&&t.target.closest(".no-action")||u(e,n.value)||e===void 0&&n.value===void 0||(me.value=!0,xt(()=>{n.value=e,me.value=!1}))},J=(e,t=!1)=>{e&&qe(e,t),L({}),setTimeout(()=>{!e&&!t&&se.value&&(se.value.scrollTop=se.value.scrollHeight)},100)},k=te(()=>{if(H.value)return H.value.find(e=>e.pv)}),We=async e=>{var o,m;if(!H.value)return;const t=Bt(`${e.title}_copy`,H.value);let l={};switch(e.uidt){case x.LinkToAnotherRecord:case x.Links:case x.Lookup:case x.Rollup:case x.Formula:case x.Button:return Q.info(P("msg.info.notAvailableAtTheMoment"));case x.SingleSelect:case x.MultiSelect:l={...e,title:t,column_name:t,id:void 0,order:void 0,pv:!1,colOptions:{options:((m=(o=e.colOptions)==null?void 0:o.options)==null?void 0:m.map(s=>({...s,id:void 0})))??[]}};break;default:l={...e,title:t,column_name:t,id:void 0,colOptions:void 0,order:void 0,pv:!1};break}J(e),ue.value=l},we=e=>{for(const t of e)if(t.status||t.is_group&&we(t.children||[]))return!0},ve=(e,t=!1)=>{var s,C,w,V,z,T;const l=_.value.find(r=>u(r,e));if(!l)return;e.colOptions&&[x.SingleSelect,x.MultiSelect].includes(l.uidt)&&(e={...e,colOptions:{...e.colOptions||{},options:(((s=e.colOptions)==null?void 0:s.options)||[]).map(r=>((r==null?void 0:r.index)!==void 0&&delete r.index,r))}});const o=je(l,e),m=Object.fromEntries(Object.entries(o).filter(([r,S])=>S!==void 0));if(Object.keys(m).length===0||Object.keys(m).length===1&&"altered"in m)p.value=p.value.filter(r=>r.op==="add"||!u(r.column,e));else{const r=p.value.find(f=>u(f.column,e)),S=D.value.find(f=>u(f.column,e));if(K.value.find(f=>u(f,e))){K.value=K.value.map(f=>u(f,e)?(p.value=p.value.filter(N=>N.op==="add"&&!u(N.column,e)),p.value.push({op:"add",column:e}),e):f);return}r||r&&S?r.column=e:Ct(e)&&!t?(["title","column_name","meta"].some(f=>f in m)||"childViewId"in m&&m.childViewId!==((C=l.colOptions)==null?void 0:C.fk_target_view_id)||we(m.filters||[]))&&p.value.push({op:"update",column:e}):p.value.push({op:"update",column:e}),n.value&&Object.keys(n.value).length&&(e!=null&&e.id&&((w=n.value)!=null&&w.id)&&(e==null?void 0:e.id)===((V=n.value)==null?void 0:V.id)||e!=null&&e.temp_id&&((z=n.value)!=null&&z.temp_id)&&(e==null?void 0:e.temp_id)===((T=n.value)==null?void 0:T.temp_id))&&(n.value=e)}},_e=e=>{const t=p.value.find(l=>u(l.column,e));t?t.op==="delete"?p.value=p.value.filter(l=>l.column.id!==e.id):t.op==="add"?(n.value&&u(n.value,e)&&L(),p.value=p.value.filter(l=>l.column.temp_id!==e.temp_id),K.value=K.value.filter(l=>l.temp_id!==e.temp_id)):(t.op="delete",t.column=e):p.value.push({op:"delete",column:e})},Qe=e=>{var t;ue.value&&(e=ue.value,ue.value=void 0),e.temp_id=`temp_${++He.value}`,e.view_id=(t=Y.value)==null?void 0:t.id,p.value.push({op:"add",column:e}),K.value.push(e),Z.value?(D.value.push({op:"move",column:e,index:Z.value,order:fe(Z.value)}),Z.value=void 0):D.value.push({op:"move",column:e,index:_.value.length,order:fe(_.value.length)}),L(e)},Xe=e=>{var s,C;const t=_.value[e.moved.oldIndex],l=fe(e.moved.newIndex,e.moved.newIndex<e.moved.oldIndex),o=p.value.find(w=>u(w.column,t));if((o==null?void 0:o.op)==="update"){const w=je(o.column,t);if(!(Object.keys(w).length===1&&"column_order"in w)){Q.warning(P("msg.warning.multiField.moveEditedField"));return}}if((o==null?void 0:o.op)==="delete"){Q.warning(P("msg.warning.multiField.moveDeletedField"));return}const m=D.value.find(w=>u(w.column,_.value[e.moved.oldIndex]));m?(m.index=e.moved.newIndex,m.order=l):D.value.push({op:"move",column:_.value[e.moved.oldIndex],index:e.moved.newIndex,order:l}),ve(o?{...o.column,column_order:{order:l,view_id:(s=Y.value)==null?void 0:s.id}}:{...t,column_order:{order:l,view_id:(C=Y.value)==null?void 0:C.id}},!0)},ee=e=>{var o,m;const t=p.value.find(s=>u(e,s.column)&&s.op==="delete"),l=p.value.find(s=>u(e,s.column)&&s.op==="add");return t?!0:!(!e.title&&!l||(e.uidt===x.Links||e.uidt===x.LinkToAnotherRecord)&&l&&(!e.childColumn||!e.childTable||!e.childId)&&(!((o=e.custom)!=null&&o.ref_model_id)||!((m=e.custom)!=null&&m.ref_column_id))||e.uidt===x.Lookup&&l&&(!e.fk_relation_column_id||!e.fk_lookup_column_id)||e.uidt===x.Rollup&&l&&(!e.fk_relation_column_id||!e.fk_rollup_column_id||!e.rollup_function)||e.uidt===x.Formula&&l&&!e.formula_raw||e.uidt===x.Button&&l&&(e.type==="url"&&!e.formula_raw||e.type==="webhook"&&!e.fk_webhook_id))};function Ye(e){var t,l,o,m,s,C,w,V,z,T;if(e.uidt===x.QrCode&&((t=e.colOptions)!=null&&t.fk_qr_value_column_id)&&(e!=null&&e.fk_qr_value_column_id||(e.fk_qr_value_column_id=e.colOptions.fk_qr_value_column_id)),e.uidt===x.Barcode&&((l=e.colOptions)!=null&&l.fk_barcode_value_column_id)&&(e!=null&&e.fk_barcode_value_column_id||(e.fk_barcode_value_column_id=e.colOptions.fk_barcode_value_column_id)),e.uidt===x.Lookup&&((o=e==null?void 0:e.colOptions)!=null&&o.fk_lookup_column_id)&&((m=e==null?void 0:e.colOptions)!=null&&m.fk_relation_column_id)&&(e!=null&&e.fk_lookup_column_id||(e.fk_lookup_column_id=e.colOptions.fk_lookup_column_id),e!=null&&e.fk_relation_column_id||(e.fk_relation_column_id=e.colOptions.fk_relation_column_id)),e.uidt===x.Rollup&&((s=e==null?void 0:e.colOptions)!=null&&s.fk_relation_column_id)&&((C=e==null?void 0:e.colOptions)!=null&&C.fk_rollup_column_id)&&((w=e==null?void 0:e.colOptions)!=null&&w.rollup_function)&&(e!=null&&e.fk_relation_column_id||(e.fk_relation_column_id=e.colOptions.fk_relation_column_id),e!=null&&e.fk_rollup_column_id||(e.fk_rollup_column_id=e.colOptions.fk_rollup_column_id),e!=null&&e.rollup_function||(e.rollup_function=e.colOptions.rollup_function)),e.uidt===x.Formula&&((V=e.colOptions)!=null&&V.formula_raw)&&!(e!=null&&e.formula_raw)&&(e.formula_raw=(z=e.colOptions)==null?void 0:z.formula_raw),e.uidt===x.Button){const r=e.colOptions;e.type=r==null?void 0:r.type,e.theme=r==null?void 0:r.theme,e.label=r==null?void 0:r.label,e.color=r==null?void 0:r.color,e.fk_webhook_id=r==null?void 0:r.fk_webhook_id,e.icon=r==null?void 0:r.icon,e.formula_raw=(T=e.colOptions)==null?void 0:T.formula_raw}return e}const xe=e=>{const t=p.value.find(l=>u(l.column,e));t&&(t.op==="delete"?p.value=p.value.filter(l=>!u(l.column,e)):t.op==="update"&&(p.value=p.value.filter(l=>!u(l.column,e)),D.value=D.value.filter(l=>!u(l.column,e))),n.value=null,L(_.value.filter(l=>l.id===e.id)[0]))},U=e=>{const t=_.value.find(l=>u(l,e));if(t){const l=p.value.find(o=>u(o.column,t));if(l)return l.column}return null},Ce=te(()=>{const e={};for(const t of p.value)t.op==="add"?t.column.temp_id&&(e[t.column.temp_id]="add"):t.op==="update"?t.column.id&&(e[t.column.id]="update"):t.op==="delete"&&t.column.id&&(e[t.column.id]="delete");return e}),M=e=>{const t=(e==null?void 0:e.id)||(e==null?void 0:e.temp_id);return t?Ce.value[t]:""},Ge=()=>{p.value=[],D.value=[],K.value=[],R.value=[],L()},Fe=te(()=>_.value.every(e=>ee(e))),$e=()=>{var e,t;H.value=(t=(e=I.value)==null?void 0:e.columns)==null?void 0:t.map(l=>(l.uidt&&l.uidt in Me&&(l.meta||(l.meta={}),l.meta={...Me[l.uidt],...l.meta||{}}),{...l}))},ge=async()=>{var e,t,l,o,m,s,C,w,V,z;if(Fe.value){if(!q.value&&p.value.length<1&&D.value.length<1&&R.value.length<1)return}else{Q.error(P("msg.error.multiFieldSaveValidation"));return}try{if(!((e=I.value)!=null&&e.id))return;q.value=!0;const T=[];for(const g of D.value){const f=p.value.find(N=>u(N.column,g.column));if(f&&f.op==="add"){if(!((t=f.column)!=null&&t.userHasChangedTitle)&&!f.column.title){const N=Ne({formState:f.column,tableExplorerColumns:_.value||[],metaColumns:((l=I.value)==null?void 0:l.columns)||[],newFieldTitles:T});T.push(N),f.column.title=N,f.column.column_name=N}f.column.column_order={order:g.order,view_id:(o=Y.value)==null?void 0:o.id}}f&&f.op==="update"&&(f.column.column_order={order:g.order,view_id:(m=Y.value)==null?void 0:m.id})}const r=new Set;for(const g of p.value)if(g.op==="add")n.value&&u(n.value,g.column)&&L();else if(g.op==="delete")r.add(g.column.id),n.value&&u(n.value,g.column)&&L();else if(g.op==="update"){const f=(C=(s=I.value)==null?void 0:s.columns)==null?void 0:C.find(N=>N.id===g.column.id);(f==null?void 0:f.uidt)===x.Attachment&&(f==null?void 0:f.uidt)!==g.column.uidt&&r.add(g.column.id)}for(const g of R.value)await ze(g.visible,{...g.column,show:g.visible});const S=await oe.dbTableColumn.bulk((w=I.value)==null?void 0:w.id,{hash:ne.value,ops:p.value});await Be(),S&&(p.value=S.failedOps&&((V=S.failedOps)!=null&&V.length)?S.failedOps.map(({error:g,...f})=>f):[],K.value=K.value.filter(g=>!!(S.failedOps&&S.failedOps.find(N=>N.column.temp_id===g.temp_id))),D.value=[]);for(const g of p.value)r.has(g.column.id)&&(g.op==="delete"||g.op==="update")&&r.delete(g.column.id);await Re(I.value.id,!0),$e(),ke.updateViewCoverImageColumnId({metaId:I.value.id,columnIds:r}),ne.value=(await oe.dbTableColumn.hash((z=I.value)==null?void 0:z.id)).hash,R.value=[]}catch{Q.error(P("msg.error.somethingWentWrong"))}finally{q.value=!1}},Ze=async(e,t)=>{if(t.fk_column_id&&Ce.value[t.fk_column_id]){Q.warning(P("msg.warning.multiField.fieldVisibility"));return}if(R.value.find(l=>l.column.fk_column_id===t.fk_column_id)){R.value=R.value.filter(l=>l.column.fk_column_id!==t.fk_column_id);return}R.value.push({visible:e,column:t})};pt(document,"keydown",async e=>{const t=ye()?e.metaKey:e.ctrlKey;if(!$.value){if(t&&e.key.toLowerCase()==="s"){if(ae.value!=="field")return;e.preventDefault();return}if(e.altKey&&e.key.toLowerCase()==="c"||e.altKey&&e.code==="KeyC"){if(ae.value!=="field")return;e.preventDefault(),J()}}});const Je=()=>ye()?"⌘":"Ctrl",et=()=>ye()?"⌥":"ALT";le("ArrowDown",()=>{const e=_.value.findIndex(t=>u(t,n.value));e===-1||e===_.value.length-1?L(_.value[0]):L(_.value[e+1])}),le("ArrowUp",()=>{const e=_.value.findIndex(t=>u(t,n.value));L(e===-1?_.value[0]:e===0?_.value[_.value.length-1]:_.value[e-1])}),le("Delete",()=>{var t,l,o;if($.value||((t=document.activeElement)==null?void 0:t.tagName)==="INPUT"||((l=document.activeElement)==null?void 0:l.tagName)==="TEXTAREA"||(o=document.activeElement)!=null&&o.getAttribute("contenteditable"))return;!(M(n.value)==="delete")&&n.value&&_e(n.value)}),le("Backspace",()=>{var t,l,o;if($.value||((t=document.activeElement)==null?void 0:t.tagName)==="INPUT"||((l=document.activeElement)==null?void 0:l.tagName)==="TEXTAREA"||(o=document.activeElement)!=null&&o.getAttribute("contenteditable"))return;!(M(n.value)==="delete")&&n.value&&_e(n.value)}),le("ArrowRight",()=>{var e;if(((e=document.activeElement)==null?void 0:e.tagName)!=="TEXTAREA"&&n.value){const t=document.querySelector(".nc-fields-input");t&&t.focus()}});const Oe=async e=>{await Ue(e.id),re.value=!0},Ie=ft();Le(Ie.meta_s,()=>{var e;$.value||(e=I.value)!=null&&e.id&&ae.value==="field"&&ge()}),Le(Ie.ctrl_s,()=>{var e;$.value||(e=I.value)!=null&&e.id&&ae.value==="field"&&ge()}),Se(I,async e=>{e!=null&&e.id&&(ne.value=(await oe.dbTableColumn.hash(e.id)).hash)},{deep:!0}),mt(async()=>{await vt(()=>{var e,t;return!!((e=I.value)!=null&&e.id&&((t=I.value)!=null&&t.columns))}).toBeTruthy(),I.value&&I.value.id&&(ne.value=(await oe.dbTableColumn.hash(I.value.id)).hash),$e()});const Te=()=>{setTimeout(()=>{re.value=!1},200)};return Se(()=>{var e;return(e=n.value)==null?void 0:e.temp_id},(e,t)=>{if(!t)return;const l=_.value.find(s=>s.temp_id===t);if(!l||l&&(l.title||!p.value.find(s=>s.op==="add"&&s.column.temp_id===l.temp_id)||l!=null&&l.userHasChangedTitle||!ee(l)))return;const o=p.value.filter(s=>s.op==="add"&&s.column.title).map(s=>s.column.title).filter(s=>s),m=Ne({formState:l,tableExplorerColumns:_.value||[],metaColumns:H.value||[],newFieldTitles:o});l.title=m,l.column_name=m}),(e,t)=>{const l=qt,o=Ft,m=Pt,s=$t,C=Ot,w=St,V=Nt,z=Dt,T=Vt,r=It,S=Et,g=Mt,f=jt,N=Kt,tt=Rt;return v(),W("div",Xt,[h("div",Yt,[i(Ke)?(v(),W("div",Gt,[c(l,{class:"!h-8 !w-68 !rounded !overflow-hidden",active:"",size:"small"}),h("div",Zt,[c(l,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"}),c(l,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"}),c(l,{class:"!h-8 !w-22 !rounded !overflow-hidden",active:"",size:"small"})])])):(v(),W(he,{key:1},[h("div",Jt,[c(m,{value:i(X),"onUpdate:value":t[1]||(t[1]=a=>_t(X)?X.value=a:null),"data-testid":"nc-field-search-input",class:"!h-8 !px-1 !rounded-lg !w-72",placeholder:e.$t("placeholder.searchFields")},{prefix:d(()=>[c(o,{icon:"search",class:"mx-1 h-3.5 w-3.5 text-gray-500 group-hover:text-black"})]),suffix:d(()=>[i(X).length>0?(v(),b(o,{key:0,icon:"close",class:"mx-1 h-3.5 w-3.5 text-gray-500 group-hover:text-black","data-testid":"nc-field-clear-search",onClick:t[0]||(t[0]=a=>X.value="")})):B("",!0)]),_:1},8,["value","placeholder"]),h("div",el,[c(C,{disabled:i($)},{title:d(()=>[F(y(`${et()} + C`),1)]),default:d(()=>[c(s,{"data-testid":"nc-field-add-new",type:"secondary",size:"small",class:"mr-1",disabled:i(q)||i($),onClick:t[2]||(t[2]=a=>J())},{default:d(()=>[h("div",tl,[c(o,{icon:"plus",class:"w-3"}),F(" "+y(e.$t("labels.multiField.newField")),1)])]),_:1},8,["disabled"])]),_:1},8,["disabled"]),c(s,{"data-testid":"nc-field-reset",type:"secondary",size:"small",disabled:!i(q)&&i(p).length<1&&i(D).length<1&&i(R).length<1||i($),onClick:t[3]||(t[3]=a=>Ge())},{default:d(()=>[F(y(e.$t("general.reset")),1)]),_:1},8,["disabled"]),c(C,{disabled:i($)},{title:d(()=>[F(y(`${Je()} + S`),1)]),default:d(()=>[c(s,{"data-testid":"nc-field-save-changes",type:"primary",size:"small",loading:i(q),disabled:(i(Fe)?!i(q)&&i(p).length<1&&i(D).length<1&&i(R).length<1:!0)||i($),onClick:t[4]||(t[4]=a=>ge())},{default:d(()=>[F(y(e.$t("labels.multiField.saveChanges")),1)]),_:1},8,["loading","disabled"])]),_:1},8,["disabled"])])]),h("div",ll,[h("div",{ref_key:"fieldsListWrapperDomRef",ref:se,class:"nc-scrollbar-md !overflow-auto flex-1 flex-grow-1 nc-fields-height"},[c(i(Ht),{"model-value":i(_),disabled:i($),"item-key":"id","data-testid":"nc-field-list-wrapper",onChange:t[10]||(t[10]=a=>Xe(a))},gt({item:d(({element:a})=>{var j,Ae;return[a.title.toLowerCase().includes(i(X).toLowerCase())&&!a.pv?(v(),W("div",{key:0,class:E(["flex px-2 hover:bg-gray-100 first:rounded-t-lg border-b-1 last:rounded-b-none border-gray-200 pl-5 group",{selected:u(a,i(n)),"cursor-not-allowed":!be(a)}]),"data-testid":`nc-field-item-${((j=U(a))==null?void 0:j.title)||a.title}`,onClick:O=>L(a,O)},[h("div",ol,[(v(),b(De(("iconMap"in e?e.iconMap:i(Ve)).drag),{class:E(["cursor-move !h-3.75 text-gray-600 mr-1",{"opacity-0 !cursor-default":i($)}])},null,8,["class"])),a.id&&i(de)[a.id]?(v(),b(w,{key:0,disabled:i($),checked:((Ae=i(R).find(O=>O.column.fk_column_id===a.id))==null?void 0:Ae.visible)??i(de)[a.id].show,"data-testid":"nc-field-visibility-checkbox",onChange:O=>{Ze(O.target.checked,i(de)[a.id])}},null,8,["disabled","checked","onChange"])):(v(),b(w,{key:1,disabled:!0,class:"opacity-0",checked:!0})),a&&i(yt)(U(a)||a)?(v(),b(V,{key:2,"column-meta":U(a)||a,class:E({"text-brand-500":u(a,i(n))})},null,8,["column-meta","class"])):(v(),b(z,{key:3,"column-meta":U(a)||a,class:E({"text-brand-500":u(a,i(n))})},null,8,["column-meta","class"])),c(C,{class:E([{"text-brand-500":u(a,i(n))},"truncate flex-1"]),"show-on-truncate-only":""},{title:d(()=>{var O;return[F(y(((O=U(a))==null?void 0:O.title)||a.title),1)]}),default:d(()=>{var O;return[h("span",al,y(((O=U(a))==null?void 0:O.title)||a.title),1)]}),_:2},1032,["class"])]),h("div",sl,[h("div",nl,[M(a)==="delete"?(v(),b(T,{key:0,color:"red",border:!1,class:"bg-red-50 text-red-700","data-testid":"nc-field-status-deleted-field"},{default:d(()=>[F(y(e.$t("labels.multiField.deletedField")),1)]),_:1})):ee(a)&&M(a)==="add"?(v(),b(T,{key:1,color:"orange",border:!1,class:"bg-green-50 text-green-700","data-testid":"nc-field-status-new-field"},{default:d(()=>[F(y(e.$t("labels.multiField.newField")),1)]),_:1})):M(a)==="update"?(v(),b(T,{key:2,color:"orange",border:!1,class:"bg-orange-50 text-orange-700","data-testid":"nc-field-status-updated-field"},{default:d(()=>[F(y(e.$t("labels.multiField.updatedField")),1)]),_:1})):B("",!0),ee(a)?B("",!0):(v(),b(T,{key:3,color:"yellow",border:!1,class:"ml-1 bg-yellow-50 text-yellow-700","data-testid":"nc-field-status-incomplete-configuration"},{default:d(()=>[F(y(e.$t("labels.multiField.incompleteConfiguration")),1)]),_:1}))]),M(a)==="delete"||M(a)==="update"?(v(),b(s,{key:0,type:"secondary",size:"small",class:"no-action mr-2",disabled:i(q),"data-testid":"nc-field-restore-changes",onClick:O=>xe(a)},{default:d(()=>[h("div",rl,[c(o,{icon:"reload"}),F(" "+y(e.$t("general.restore")),1)])]),_:2},1032,["disabled","onClick"])):(v(),b(f,{key:1,trigger:["click"],"overlay-class-name":"nc-field-item-action-dropdown nc-dropdown-table-explorer","onUpdate:visible":Te,onClick:t[5]||(t[5]=ce(()=>{},["stop"]))},{overlay:d(()=>[c(g,{style:{"padding-top":"0.45rem !important"}},{default:d(()=>[M(a)!=="add"?(v(),W(he,{key:0},[c(C,{placement:"top"},{title:d(()=>[F(y(e.$t("msg.clickToCopyFieldId")),1)]),default:d(()=>[h("div",{class:"flex flex-row gap-2 w-[calc(100%_-_12px)] p-2 mx-1.5 rounded-md justify-between items-center group hover:bg-gray-100 cursor-pointer","data-testid":"nc-field-item-action-copy-id",onClick:O=>Oe(a)},[h("div",ul,y(e.$t("labels.idColon",{fieldId:a.id})),1),c(s,{size:"xsmall",type:"secondary",class:"!group-hover:bg-gray-100"},{default:d(()=>[i(re)?(v(),b(o,{key:0,icon:"check"})):(v(),b(o,{key:1,icon:"copy"}))]),_:1})],8,dl)]),_:2},1024),i($)?B("",!0):(v(),b(r,{key:0,class:"my-1.5"}))],64)):B("",!0),i($)?B("",!0):(v(),W(he,{key:1},[c(S,{key:"table-explorer-duplicate","data-testid":"nc-field-item-action-duplicate",onClick:O=>We(a)},{default:d(()=>[c(o,{icon:"duplicate",class:"text-gray-800"}),h("span",null,y(e.$t("general.duplicate"))+" "+y(e.$t("objects.field").toLowerCase()),1)]),_:2},1032,["onClick"]),a.pv?B("",!0):(v(),b(S,{key:"table-explorer-insert-above","data-testid":"nc-field-item-action-insert-above",onClick:O=>J(a,!0)},{default:d(()=>[c(o,{icon:"ncArrowUp",class:"text-gray-800"}),h("span",null,y(e.$t("general.insertAbove")),1)]),_:2},1032,["onClick"])),c(S,{key:"table-explorer-insert-below","data-testid":"nc-field-item-action-insert-below",onClick:O=>J(a)},{default:d(()=>[c(o,{icon:"ncArrowDown",class:"text-gray-800"}),h("span",null,y(e.$t("general.insertBelow")),1)]),_:2},1032,["onClick"]),c(r,{class:"my-1.5"}),c(S,{key:"table-explorer-delete",class:"!hover:bg-red-50","data-testid":"nc-field-item-action-delete",onClick:O=>_e(a)},{default:d(()=>[h("div",cl,[c(o,{icon:"delete",class:"group-hover:text-accent -ml-0.25 -mt-0.75 mr-0.5"}),F(" "+y(e.$t("general.delete"))+" "+y(e.$t("objects.field").toLowerCase()),1)])]),_:2},1032,["onClick"])],64))]),_:2},1024)]),default:d(()=>[c(s,{size:"xsmall",type:"text",class:E(["!opacity-0 !group-hover:opacity-100",{"!hover:text-brand-700 !hover:bg-brand-100 !group-hover:text-brand-500":u(a,i(n)),"!hover:text-gray-700 !hover:bg-gray-200 !group-hover:text-gray-500":!u(a,i(n))}]),"data-testid":"nc-field-item-action-button"},{default:d(()=>[c(o,{icon:"threeDotVertical",class:"no-action text-inherit"})]),_:2},1032,["class"])]),_:2},1024)),c(N,{class:E(["text-brand-500 opacity-0",{"opacity-100":u(a,i(n))}])},null,8,["class"])])],10,il)):B("",!0)]}),_:2},[i(k)&&i(k).title&&i(k).title.toLowerCase().includes(i(X).toLowerCase())?{name:"header",fn:d(()=>{var a;return[h("div",{class:E(["flex px-2 bg-white hover:bg-gray-100 border-b-1 border-gray-200 first:rounded-tl-lg last:border-b-1 pl-5 group",` ${u(i(k),i(n))?"selected":""}`]),"data-testid":`nc-field-item-${((a=U(i(k)))==null?void 0:a.title)||i(k).title}`,onClick:t[9]||(t[9]=j=>L(i(k),j))},[h("div",fl,[(v(),b(De(("iconMap"in e?e.iconMap:i(Ve)).drag),{class:E(["cursor-move !h-3.75 text-gray-200 mr-1",{"opacity-0 !cursor-default":i($)}])},null,8,["class"])),c(w,{disabled:!0,checked:!0,"data-testid":"nc-field-visibility-checkbox"}),i(k)?(v(),b(z,{key:0,"column-meta":U(i(k))||i(k),class:E({"text-brand-500":u(i(k),i(n))})},null,8,["column-meta","class"])):B("",!0),c(C,{class:E(["truncate flex-1",{"text-brand-500":u(i(k),i(n))}]),"show-on-truncate-only":""},{title:d(()=>{var j;return[F(y(((j=U(i(k)))==null?void 0:j.title)||i(k).title),1)]}),default:d(()=>{var j;return[h("span",ml,y(((j=U(i(k)))==null?void 0:j.title)||i(k).title),1)]}),_:1},8,["class"])]),h("div",vl,[h("div",_l,[M(i(k))==="delete"?(v(),b(T,{key:0,color:"red",border:!1,class:"bg-red-50 text-red-700","data-testid":"nc-field-status-deleted-field"},{default:d(()=>[F(y(e.$t("labels.multiField.deletedField")),1)]),_:1})):M(i(k))==="update"?(v(),b(T,{key:1,color:"orange",border:!1,class:"bg-orange-50 text-orange-700","data-testid":"nc-field-status-updated-field"},{default:d(()=>[F(y(e.$t("labels.multiField.updatedField")),1)]),_:1})):B("",!0)]),M(i(k))==="delete"||M(i(k))==="update"?(v(),b(s,{key:0,type:"secondary",size:"small",class:"no-action mr-2",disabled:i(q),"data-testid":"nc-field-restore-changes",onClick:t[6]||(t[6]=j=>xe(i(k)))},{default:d(()=>[h("div",gl,[c(o,{icon:"reload"}),F(" "+y(e.$t("general.restore")),1)])]),_:1},8,["disabled"])):(v(),b(f,{key:1,trigger:["click"],"overlay-class-name":"nc-field-item-action-dropdown-display-column nc-dropdown-table-explorer-display-column","onUpdate:visible":Te,onClick:t[8]||(t[8]=ce(()=>{},["stop"]))},{overlay:d(()=>[c(g,null,{default:d(()=>[c(C,{placement:"top"},{title:d(()=>[F(y(e.$t("msg.clickToCopyFieldId")),1)]),default:d(()=>[h("div",{class:"flex flex-row gap-2 w-[calc(100%_-_12px)] p-2 mx-1.5 rounded-md justify-between items-center group hover:bg-gray-100 cursor-pointer","data-testid":"nc-field-item-action-copy-id",onClick:t[7]||(t[7]=j=>Oe(i(k)))},[h("div",yl,y(e.$t("labels.idColon",{fieldId:i(k).id})),1),c(s,{size:"xsmall",type:"secondary",class:"!group-hover:bg-gray-100"},{default:d(()=>[i(re)?(v(),b(o,{key:0,icon:"check"})):(v(),b(o,{key:1,icon:"copy"}))]),_:1})])]),_:1})]),_:1})]),default:d(()=>[c(s,{size:"xsmall",type:"text",class:E(["!opacity-0 !group-hover:opacity-100",{"!hover:text-brand-700 !hover:bg-brand-100 !group-hover:text-brand-500":u(i(k),i(n)),"!hover:text-gray-700 !hover:bg-gray-200 !group-hover:text-gray-500":!u(i(k),i(n))}]),"data-testid":"nc-field-item-action-button"},{default:d(()=>[c(o,{icon:"threeDotVertical",class:"no-action text-inherit"})]),_:1},8,["class"])]),_:1})),c(N,{class:E(["text-brand-500 opacity-0",{"opacity-100":u(i(k),i(n))}])},null,8,["class"])])],10,pl)]}),key:"0"}:void 0]),1032,["model-value","disabled"])],512),c(ht,{name:"slide-fade"},{default:d(()=>[i(me)?B("",!0):(v(),W("div",{key:0,class:"border-gray-200 border-l-1 nc-scrollbar-md nc-fields-height !overflow-y-auto",onKeydown:[t[11]||(t[11]=Ee(ce(()=>{},["stop"]),["up"])),t[12]||(t[12]=Ee(ce(()=>{},["stop"]),["down"]))]},[i(n)?(v(),b(tt,{key:0,class:"p-4 w-[25rem]",column:i(n),preload:U(i(n)),"table-explorer-columns":i(_),"is-column-valid":ee,"embed-mode":"",readonly:i($),"from-table-explorer":"",onUpdate:ve,onAdd:Qe},null,8,["column","preload","table-explorer-columns","readonly"])):(v(),W("div",hl,[kl,h("div",bl,y(e.$t("labels.multiField.selectField")),1),h("div",wl,y(e.$t("labels.multiField.selectFieldLabel")),1)]))],32))]),_:1})])],64))])])}}}),Ni=Lt(xl,[["__scopeId","data-v-d4e79286"]]);export{Ni as default};
