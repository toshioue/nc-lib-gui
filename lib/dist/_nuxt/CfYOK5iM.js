import{_ as Ie}from"./CpvPgywS.js";import{_ as Pe}from"./E4a38j7M.js";import{_ as je}from"./BaHXy0hV.js";import{f as Ee,cg as Y,cB as Se,N as Te,bL as w,r as c,hf as Ne,aw as Ue,ay as Be,ht as Ke,az as He,gs as Ae,ai as Oe,hp as Re,gx as ze,fH as Ge,g as k,d4 as x,cf as ye,ce as n,F as Le,cV as be,ae as ge,H as $e,hO as qe,i as Xe,cp as Qe,aA as We,iy as Ze,o as A,c as we,a as P,b as Je,w as xe,T as O,P as t,U as ee,Q as _e,Y as j,S as Me,a7 as ea,al as aa,$ as ta,_ as la}from"./BLdk6lRf.js";import"./CTexHzUv.js";import"./oMo3eZSU.js";const sa=["title"],oa=["value","placeholder","readonly"],ua=["value","placeholder","readonly"],na={key:0,class:"absolute inset-0 z-90 cursor-pointer"},ra=Ee({__name:"DateTimePicker",props:{modelValue:{},isPk:{type:Boolean},isUpdatedFromCopyNPaste:{}},emits:["update:modelValue"],setup(d,{emit:ke}){const ae=ke,te={[Y[0]]:"hh:mm A",[Y[1]]:"hh:mm:ss A",[Y[2]]:"hh:mm:ss.SSS A"},{isMssql:Ve,isXcdbBase:Ye}=Se(),{showNull:J,isMobileMode:le}=Te(),U=w(Ne,c(!1)),R=w(Ue,c(!1)),p=w(Be,c(!1)),F=w(Ke,c(!1)),E=w(He,c(!1)),Fe=w(Ae,c(!1)),{t:se}=Oe(),B=w(Re,c(!1)),K=w(ze,c(!1)),s=w(Ge),z=c(!1),y=c(),M=c(),oe=k(()=>{var l,o,f,i;const a=((o=x((l=s==null?void 0:s.value)==null?void 0:l.meta))==null?void 0:o.date_format)??ye[0],e=((i=x((f=s==null?void 0:s.value)==null?void 0:f.meta))==null?void 0:i.time_format)??Y[0];return`${a} ${e}`}),_=k(()=>{var a,e;return((e=x((a=s==null?void 0:s.value)==null?void 0:a.meta))==null?void 0:e.date_format)??ye[0]}),$=k(()=>{var a,e;return((e=x((a=s==null?void 0:s.value)==null?void 0:a.meta))==null?void 0:e.time_format)??Y[0]});let S=d.modelValue?n(d.modelValue).utc().local():void 0;const G=c(!1),r=c(!1),m=c(),b=c(!0),u=k({get(){var e;if(!d.modelValue||G.value)return;if(!n(d.modelValue).isValid()){z.value=!0;return}const a=Ye(s.value.source_id);if(s.value.title in(d.isUpdatedFromCopyNPaste??{}))return S=n(d.modelValue).utc().local(),S;if(!a)return/^\d+$/.test(d.modelValue)?n(+d.modelValue):n(d.modelValue);if(Ve(s.value.source_id))return n(d.modelValue);if((e=s==null?void 0:s.value)!=null&&e.cdf)return n(d.modelValue).utc().local();if(S){const l=S;return S=void 0,l}return n(d.modelValue).utc().local()},set(a){if(G.value=!1,!a){ae("update:modelValue",null);return}a.isValid()&&(S=n(a),ae("update:modelValue",n(a).utc().format("YYYY-MM-DD HH:mm:ssZ")))}});Le(()=>{u.value&&(m.value=u.value)});const V=k(()=>be(s.value)||U.value||u.value&&d.isPk),D=k(()=>U.value||V.value||U.value||u.value&&d.isPk?!1:r.value&&(R.value||p.value)),T=`picker_${Math.floor(Math.random()*99999)}`;ge(y,a=>{var e,l,o,f,i;(e=a.target)!=null&&e.closest(`.${T}, .nc-${T}`)||((o=(l=y.value)==null?void 0:l.blur)==null||o.call(l),(i=(f=M.value)==null?void 0:f.blur)==null||i.call(f),r.value=!1)});const ue=a=>{b.value=a,r.value=!0};$e(r,a=>{var e,l,o,f;a?(p.value=!0,b.value?(l=(e=y.value)==null?void 0:e.focus)==null||l.call(e):(f=(o=M.value)==null?void 0:o.focus)==null||f.call(o),ge(document.querySelector(`.${T}`),i=>{var g;(g=i==null?void 0:i.target)!=null&&g.closest(`.nc-${T}`)||(r.value=!1)})):G.value=!1},{flush:"post"});const N=k(()=>(E.value||K.value)&&!z.value||F.value&&!J.value&&!z.value&&!be(s.value)&&R.value||B.value?{dateTime:oe.value,date:_.value,time:x(s.value.meta).is12hrFormat?`${$.value} AM`:$.value}:d.modelValue===null&&J.value?se("general.null").toUpperCase():z.value?se("msg.invalidDate"):""),h=w(qe,null),L=()=>{U.value||r.value||(r.value=R.value||p.value)};Xe(()=>{h==null||h.on(L)}),Qe(()=>{h==null||h.on(L)});const ne=(a,e=!1)=>{b.value=e,!h&&L()},re=(a,e,l=!1)=>{var o,f,i,g,C,H,I,v,q,de,X,me,Q,fe,W,ce,Z,pe;switch(a.key!=="Enter"&&a.stopPropagation(),a.key){case"Enter":a.preventDefault(),Fe.value&&a.stopPropagation(),u.value=m.value,l?((H=(C=y.value)==null?void 0:C.blur)==null||H.call(C),r.value=!1,p.value=!1):(a.stopPropagation(),(f=(o=M.value)==null?void 0:o.blur)==null||f.call(o),b.value=!1,(g=(i=y.value)==null?void 0:i.focus)==null||g.call(i),L());return;case"Escape":e?(r.value=!1,p.value=!1,F.value&&!K.value&&!B.value&&(l?(v=(I=y.value)==null?void 0:I.blur)==null||v.call(I):(de=(q=M.value)==null?void 0:q.blur)==null||de.call(q))):(p.value=!1,l?(me=(X=y.value)==null?void 0:X.blur)==null||me.call(X):(fe=(Q=M.value)==null?void 0:Q.blur)==null||fe.call(Q));return;case"Tab":r.value=!1,F.value&&!K.value&&!B.value&&(l?(ce=(W=y.value)==null?void 0:W.blur)==null||ce.call(W):(pe=(Z=M.value)==null?void 0:Z.blur)==null||pe.call(Z),a.shiftKey&&l||!a.shiftKey&&!l?p.value=!1:a.stopPropagation());return;default:!e&&/^[0-9a-z]$/i.test(a.key)&&(r.value=!0)}};We(document,"keydown",a=>{var e,l;if(R.value&&!(a.altKey||a.ctrlKey||a.shiftKey||a.metaKey||!F.value||K.value||B.value||Ze()))switch(a.key){case";":u.value=n(new Date),a.preventDefault();break;default:!D.value&&(y.value||M.value)&&/^[0-9a-z]$/i.test(a.key)&&(G.value=!0,b.value?(e=y.value)==null||e.focus():(l=M.value)==null||l.focus(),p.value=!0,r.value=!0)}}),$e(p,a=>{F.value&&a&&!r.value&&(b.value=!0,r.value=!0)});const ie=(a,e)=>{let l=a.target.value;if(e){if(!l){m.value=void 0;return}const o=n(l,_.value);o.isValid()&&(u.value?m.value=n(`${o.format("YYYY-MM-DD")} ${u.value.format($.value)}`):m.value=o)}if(!e){if(!l){m.value=n(n().format("YYYY-MM-DD"));return}l=x(s.value.meta).is12hrFormat?l.trim().toUpperCase().replace(/(AM|PM)$/," $1").replace(/\s+/g," "):l.trim();const o=n(l,x(s.value.meta).is12hrFormat?te[$.value]:$.value);o.isValid()&&(m.value=n(`${(m.value??n()).format("YYYY-MM-DD")} ${o.format($.value)}`))}};function ve(a){if(a&&u.value){const e=n(`${a.format("YYYY-MM-DD")} ${u.value.format($.value)}`);m.value=e,u.value=e}else m.value=a,u.value=a;r.value=!1}function De(a){if(a.isValid()){if(u.value){const e=n(`${u.value.format("YYYY-MM-DD")} ${a.format("HH:mm")}:00`);m.value=e,u.value=e}else{const e=n(`${n().format("YYYY-MM-DD")} ${a.format("HH:mm")}:00`);m.value=e,u.value=e}r.value=!1}}const he=k(()=>({[Y[0]]:{12:"max-w-[85px]",24:"max-w-[65px]"},[Y[1]]:{12:"max-w-[100px]",24:"max-w-[80px]"},[Y[2]]:{12:"max-w-[130px]",24:"max-w-[110px]"}})[$.value][x(s.value.meta).is12hrFormat?12:24]),Ce=k(()=>{var a;return((a=u.value)==null?void 0:a.format(x(s.value.meta).is12hrFormat?te[$.value]:$.value))??""});return(a,e)=>{const l=Ie,o=Pe,f=je,i=ta;return A(),we(aa,null,[P("div",ea(a.$attrs,{class:"nc-cell-field relative"}),[Je(f,{visible:t(D),placement:t(b)?"bottomLeft":"bottomRight","auto-close":!1,trigger:["click"],class:O(["nc-cell-picker-datetime",[`nc-${T}`,{"nc-null":a.modelValue===null&&t(J)}]]),"overlay-class-name":`${T} nc-picker-datetime ${t(r)?"active":""} !min-w-[0] overflow-hidden`},{overlay:xe(()=>[P("div",{class:O(["min-w-[72px]",{"w-[256px]":t(b)}])},[t(b)?(A(),ee(l,{key:0,"page-date":t(m),"onUpdate:pageDate":e[12]||(e[12]=g=>_e(m)?m.value=g:null),"selected-date":t(u),"is-open":t(D),type:"date",size:"medium","onUpdate:selectedDate":ve},null,8,["page-date","selected-date","is-open"])):(A(),ee(o,{key:1,"selected-date":t(u),"min-granularity":30,"is-min-granularity-picker":"","is12hr-format":!!("parseProp"in a?a.parseProp:t(x))(t(s).meta).is12hrFormat,"is-open":t(D),"onUpdate:selectedDate":De},null,8,["selected-date","is12hr-format","is-open"]))],2)]),default:xe(()=>{var g,C,H,I;return[P("div",{title:(g=t(u))==null?void 0:g.format(t(oe)),class:O(["nc-date-picker ant-picker-input flex relative !w-auto gap-2",{"justify-between":!t(V)}])},[P("div",{class:O(["flex-none rounded-md box-border w-[60%] max-w-[110px]",{"py-0":t(E),"py-0.5":!t(E)&&!t(V),"bg-gray-100":t(b)&&t(D),"hover:bg-gray-100 px-1":!t(V)}])},[P("input",{ref_key:"datePickerRef",ref:y,value:((C=t(u))==null?void 0:C.format(t(_)))??"",placeholder:typeof t(N)=="string"?t(N):(H=t(N))==null?void 0:H.date,class:"nc-date-input w-full !truncate border-transparent outline-none !text-current !bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:!!t(le)||t(V),onFocus:e[0]||(e[0]=v=>ue(!0)),onKeydown:e[1]||(e[1]=v=>re(v,t(D),!0)),onMouseup:e[2]||(e[2]=j(()=>{},["stop"])),onMousedown:e[3]||(e[3]=j(()=>{},["stop"])),onClick:e[4]||(e[4]=j(v=>ne(v,!0),["stop"])),onInput:e[5]||(e[5]=v=>ie(v,!0))},null,40,oa)],2),P("div",{class:O(["flex-none rounded-md box-border flex-1",[`${t(he)}`,{"py-0":t(E),"py-0.5":!t(E)&&!t(V),"bg-gray-100":!t(b)&&t(D),"hover:bg-gray-100 px-1":!t(V)}]])},[P("input",{ref_key:"timePickerRef",ref:M,value:t(Ce),placeholder:typeof t(N)=="string"?t(N):(I=t(N))==null?void 0:I.time,class:"nc-time-input w-full !truncate border-transparent outline-none !text-current !bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:!!t(le)||t(V),onFocus:e[6]||(e[6]=v=>ue(!1)),onKeydown:e[7]||(e[7]=v=>re(v,t(r))),onMouseup:e[8]||(e[8]=j(()=>{},["stop"])),onMousedown:e[9]||(e[9]=j(()=>{},["stop"])),onClick:e[10]||(e[10]=j(v=>ne(v,!1),["stop"])),onInput:e[11]||(e[11]=v=>ie(v,!1))},null,40,ua)],2)],10,sa)]}),_:1},8,["visible","placement","class","overlay-class-name"]),t(u)&&(t(K)||t(E)||!t(F)||t(B))&&!t(U)?(A(),ee(i,{key:0,icon:"closeCircle",class:"nc-clear-date-time-icon nc-action-icon h-4 w-4 absolute right-0 top-[50%] transform -translate-y-1/2 invisible cursor-pointer",onClick:e[13]||(e[13]=j(g=>ve(),["stop"]))})):Me("",!0)],16),!t(p)&&t(F)?(A(),we("div",na)):Me("",!0)],64)}}}),pa=la(ra,[["__scopeId","data-v-208e302a"]]);export{pa as default};
