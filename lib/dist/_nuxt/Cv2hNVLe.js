import{b as ae,a as te,_ as oe}from"./BGk5IibS.js";import{e as se,ax as g,cP as C,L as le,cL as ne,gO as ie,ag as re,cS as ue,cO as $,r as i,F as D,M as ce,N as a,o as _,c as me,P as M,dk as ve,a as x,O as S,S as O,aJ as U,Q as y,w as m,d as de,t as pe,b as h,R as P,Y as fe,$ as _e,Z as we,y as be}from"./DZZ6t_j4.js";import{_ as Ve}from"./vK-WmZ7a.js";import{u as A}from"./C3XbZq4f.js";import"./Bdv7ru7D.js";import"./BYINaHrJ.js";import"./dfem9Uc_.js";import"./BCJFTkwv.js";import"./vll-Pnjv.js";import"./D9tFZoTQ.js";import"./DGj1ycqW.js";import"./BQuyMdA-.js";import"./BQQOEPN4.js";import"./DKN1hQ6S.js";import"./B5RRVMt5.js";import"./DyDFI6NE.js";import"./BqKQ8afS.js";import"./DgixBgIx.js";import"./CXD-Dj4T.js";import"./TJfB7GlU.js";import"./0azk-b-q.js";import"./sz1d3zjm.js";import"./C8YpY8qO.js";import"./BLgccLvp.js";const ge={class:"flex items-center gap-0.5"},Je=se({__name:"OpenedViewAction",setup(De){const{activeTable:u}=g(C()),{isMobileMode:N}=le(),{isSharedBase:T,base:I}=g(ne()),{sharedView:L}=ie(),{t:w}=re(),{$api:z,$e:F}=be(),{refreshCommandPalette:G}=ue(),{activeView:e,views:K,viewsByTable:q}=g($()),{loadViews:E,removeFromRecentViews:J}=$(),{navigateToTable:Q}=C(),n=i(!1),Y=i(!1),v=i(!1),c=i(),o=i(""),s=i(),Z=async()=>{if(!e.value||!e.value.id)return;F("c:view:description");const t=i(!0);n.value=!1;const{close:l}=A(ae,{modelValue:t,view:e.value,"onUpdate:modelValue":r});function r(){t.value=!1,l(1e3)}},j=()=>{v.value=!0,n.value=!1,o.value=e.value.title,setTimeout(()=>{c.value.focus()})};D(c,()=>{var t;(t=c.value)==null||t.focus()});const R=async()=>{var t;H()?(e.value.title=o.value,v.value=!1,s.value=void 0,await z.dbView.update(e.value.id,{title:o.value})):(t=c.value)==null||t.focus()};function H(){return!o.value||o.value.trim().length<0?(s.value=w("msg.error.viewNameRequired"),!1):o.value.trim().length>255?(s.value=w("msg.error.nameMaxLength256"),!1):K.value.some(t=>t.title===o.value&&t.id!==e.value.id)?(s.value=w("msg.error.viewNameDuplicate"),!1):!0}D(o,()=>{s.value&&(s.value=void 0)}),D(n,()=>{setTimeout(()=>{Y.value=!1},250)});const W=()=>{o.value=e.value.title,v.value=!1};function X(){const t=i(!0);n.value=!1;const{close:l}=A(te,{modelValue:t,view:e.value,"onUpdate:modelValue":r,onDeleted:async()=>{var d,p;r(),J({viewId:e.value.id,tableId:e.value.fk_model_id,baseId:I.value.id}),G(),((d=e.value)==null?void 0:d.id)===e.value.id&&Q({tableId:u.value.id,baseId:I.value.id}),await E({tableId:u.value.id,force:!0});const b=((p=q.value.get(u.value.id))==null?void 0:p.filter(V=>!V.is_default))??[];u.value.meta={...u.value.meta,hasNonDefaultViews:b.length>1}}});function r(){t.value=!1,l(1e3)}}return(t,l)=>{var k,B;const r=fe,b=_e,d=we,p=oe,V=Ve,ee=ce("e");return a(v)?(_(),me("div",{key:0,class:O(["h-6 relative",{"max-w-2/5":!a(T)&&!a(N)&&((k=a(e))==null?void 0:k.is_default),"max-w-3/5":!a(T)&&!a(N)&&!((B=a(e))!=null&&B.is_default)}])},[M(x("input",{ref_key:"renameInputDom",ref:c,"onUpdate:modelValue":l[0]||(l[0]=f=>S(o)?o.value=f:null),class:O(["ml-0.25 w-full px-1 py-0.5 rounded-md font-medium text-gray-800",{"outline-brand-500":!a(s),"outline-red-500 pr-6":a(s)}]),onBlur:R,onKeydown:[U(R,["enter"]),U(W,["esc"])]},null,34),[[ve,a(o)]]),a(s)?(_(),y(b,{key:0,class:"absolute top-0.25 right-0.5 bg-white rounded-lg"},{title:m(()=>[de(pe(a(s)),1)]),default:m(()=>[h(r,{icon:"info",class:"cursor-pointer"})]),_:1})):P("",!0)],2)):a(L)?P("",!0):(_(),y(V,{key:1,visible:a(n),"onUpdate:visible":l[2]||(l[2]=f=>S(n)?n.value=f:null),class:"!xs:pointer-events-none nc-actions-menu-btn nc-view-context-btn","overlay-class-name":"nc-dropdown-actions-menu"},{overlay:m(()=>[h(p,{table:a(u),view:a(e),onCloseModal:l[1]||(l[1]=f=>n.value=!1),onRename:j,onDelete:X,onDescriptionUpdate:Z},null,8,["table","view"])]),default:m(()=>[x("div",null,[M((_(),y(d,{class:"nc-view-action-menu-btn nc-toolbar-btn !border-0 !h-7 !px-1.5 !min-w-7",size:"small",type:"secondary"},{default:m(()=>[x("div",ge,[h(r,{icon:"threeDotVertical",class:"!h-4 !w-4"})])]),_:1})),[[ee,["c:toolbar:view-actions"]]])])]),_:1},8,["visible"]))}}});export{Je as default};
