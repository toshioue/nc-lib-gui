import{e as ne,bL as h,r as f,d7 as oe,d6 as se,d8 as ie,dz as le,f as k,ij as re,c$ as s,f_ as ce,F as N,M as de,N as n,o,Q as g,w as r,c as v,W as ue,ao as S,at as V,a as c,t as y,b,d as R,T as j,U,R as x,O as B,P as me,ah as F,Z as _e,$ as pe,Y as fe,y as ve,_ as we}from"./DZZ6t_j4.js";import{_ as he}from"./DC_VdAC1.js";import{_ as ke}from"./DnSVh-oD.js";import{_ as ge}from"./CJNscGy3.js";import{_ as ye}from"./vK-WmZ7a.js";import{a as be}from"./i4aLU0Nw.js";import{a as xe}from"./DWT0yQl9.js";import{S as Te}from"./D_MsYLkT.js";import"./hZgTYrdl.js";import"./ByVBARmO.js";import"./37hePIet.js";import"./C4K5fdHe.js";import"./CDWovrGB.js";import"./vll-Pnjv.js";import"./GMLocJHP.js";import"./B05h-4V9.js";import"./BDAIZopQ.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";const Ce={class:"nc-calendar-btn"},De={class:"flex items-center gap-2"},Me={key:0,class:"text-capitalize !group-hover:text-brand-500 !text-[13px] font-medium"},Ie={class:"flex w-full gap-2 justify-between items-center"},$e={class:"flex items-center"},Ne={key:0,class:"flex items-center gap-2 !mt-2"},Se={class:"text-gray-800"},Ve=ne({__name:"Range",setup(Re){const C=h(oe,f()),{$api:L}=ve(),l=h(se,f()),O=h(ie,f(!1)),P=h(le,f(!1)),A=h(re,k(()=>!1)),{loadViewColumns:z}=be(),{loadCalendarMeta:E,loadCalendarData:W,loadSidebarData:q,fetchActiveDates:G,updateCalendarMeta:H,viewMetaProperties:Q}=xe(),d=f(!1),T=k({get:()=>{var e;return((e=Q.value)==null?void 0:e.hide_weekend)??!1},set:e=>{H({meta:{hide_weekend:e}})}}),D=k(()=>{var e,a;return(((a=(e=C.value)==null?void 0:e.columns)==null?void 0:a.filter(t=>{var p,u;return[s.DateTime,s.Date,s.CreatedTime,s.LastModifiedTime].includes(t.uidt)||t.uidt===s.Formula&&((u=(p=t.colOptions)==null?void 0:p.parsed_tree)==null?void 0:u.dataType)===ce.DATE}).map(t=>({label:t.title,value:t.id,uidt:t.uidt})))??[]).sort((t,p)=>{const u={[s.DateTime]:1,[s.Date]:2,[s.Formula]:3,[s.CreatedTime]:4,[s.LastModifiedTime]:5};return(u[t.uidt]||6)-(u[p.uidt]||6)})});N(()=>{var e;return(e=l.value)==null?void 0:e.id},async(e,a)=>{e!==a&&C.value&&await z()},{immediate:!0});const M=k(()=>{var a;const e=[];return!l.value||!l.value.view||(a=l.value.view.calendar_range)==null||a.forEach(t=>{e.push({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id})}),e}),_=f(M.value),I=k(()=>_.value.length>0&&_.value[0].fk_from_column_id);N(d,e=>{!e&&!I.value&&(d.value=!0,_.value.length===0&&_.value.push({fk_from_column_id:void 0,fk_to_column_id:null}))},{immediate:!0});const Y=async()=>{var e;if(l.value)try{const a=_.value.filter(t=>t.fk_from_column_id).map(t=>({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id}));await L.dbView.calendarUpdate((e=l.value)==null?void 0:e.id,{calendar_range:a}),l.value.view&&(l.value.view.calendar_range=a),await E(),await Promise.all([W(),q(),G()]),d.value=!1}catch(a){console.log(a),F.error("There was an error while updating view!")}else F.error("Please select a view first")};return(e,a)=>{const t=_e,p=he,u=pe,Z=Te,J=ke,K=fe,X=ge,ee=ye,ae=de("e");return n(P)?x("",!0):(o(),g(ee,{key:0,visible:n(d),"onUpdate:visible":a[2]||(a[2]=m=>B(d)?d.value=m:null),trigger:["click"],class:"!xs:hidden"},{overlay:r(()=>[n(d)?(o(),v("div",{key:0,class:"w-98 space-y-6 rounded-2xl p-6","data-testid":"nc-calendar-range-menu",onClick:a[1]||(a[1]=ue(()=>{},["stop"]))},[(o(!0),v(S,null,V(n(_),(m,$)=>(o(),v("div",{key:$,class:"flex w-full gap-2 mb-2 items-center","data-testid":"nc-calendar-range-option"},[c("span",null,y(e.$t("labels.organiseBy")),1),b(J,{value:m.fk_from_column_id,"onUpdate:value":i=>m.fk_from_column_id=i,placeholder:e.$t("placeholder.notSelected"),"data-testid":"nc-calendar-range-from-field-select",onChange:Y},{default:r(()=>[(o(!0),v(S,null,V([...n(D)??[]].filter(i=>{if($===0)return!0;const w=(n(D)??[]).find(te=>te.value===n(M)[0].fk_from_column_id);return(w==null?void 0:w.uidt)===i.uidt}),(i,w)=>(o(),g(Z,{key:w,class:"w-40",value:i.value},{default:r(()=>[c("div",Ie,[c("div",$e,[b(p,{column:i},null,8,["column"]),b(u,{class:"truncate flex-1 max-w-18",placement:"top","show-on-truncate-only":""},{title:r(()=>[R(y(i.label),1)]),default:r(()=>[R(" "+y(i.label),1)]),_:2},1024)]),i.value===m.fk_from_column_id?(o(),g(j(("iconMap"in e?e.iconMap:n(U)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary min-w-4 h-4"})):x("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]))),128)),n(I)?x("",!0):(o(),v("div",Ne,[b(K,{icon:"warning",class:"text-sm mt-0.5 text-orange-500"}),a[3]||(a[3]=c("span",{class:"text-sm text-gray-500"}," Date field is required! ",-1))])),c("div",null,[b(X,{checked:n(T),"onUpdate:checked":a[0]||(a[0]=m=>B(T)?T.value=m:null)},{default:r(()=>[c("span",Se,y(e.$t("activity.hideWeekends")),1)]),_:1},8,["checked"])])])):x("",!0)]),default:r(()=>[c("div",Ce,[me((o(),g(t,{disabled:n(O),class:"nc-toolbar-btn !border-0 group !h-6",size:"small",type:"secondary","data-testid":"nc-calendar-range-btn"},{default:r(()=>[c("div",De,[(o(),g(j(("iconMap"in e?e.iconMap:n(U)).calendar),{class:"h-4 w-4 transition-all group-hover:text-brand-500"})),n(A)?x("",!0):(o(),v("span",Me,y(e.$t("activity.settings")),1))])]),_:1},8,["disabled"])),[[ae,["c:calendar:change-calendar-range"]]])])]),_:1},8,["visible"]))}}}),aa=we(Ve,[["__scopeId","data-v-ee02aaa7"]]);export{aa as default};
