const __vite__fileDeps=["./CJFB-Lev.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./Header.x-GI6b6n.css","./BpL0I7vq.js","./RXURfzjs.js","./C00NHga8.js","./BDAIZopQ.js","./CVMW45vd.js","./ListItem.-o3YFXe-.css","./CRPCEw5j.js","./sz1d3zjm.js","./MenuItem.C7h59s4s.css","./TJfB7GlU.js","./0azk-b-q.js","./Divider.DqtSqZhb.css","./BLgccLvp.js","./Menu.CQ8GNWeI.css","./vK-WmZ7a.js","./B9n4-CGo.js","./DivDataCell.1yCNpUg3.css","./DnwRMKX3.js","./UserIcon.DEVmGavY.css","./B6xrG0q8.js","./B89oU1M4.js","./Badge.D0-UrqG9.css","./BmNyaTYf.js","./Cy50pBgZ.js","./DKN1hQ6S.js","./BQuyMdA-.js","./BQQOEPN4.js","./vll-Pnjv.js","./B5RRVMt5.js","./DGj1ycqW.js","./DyDFI6NE.js","./links.C8uCzV-l.css","./Dwil3It4.js","./uhBJvRY2.js","./DS_HXCWn.js","./CMIIcM5i.js","./Bgw0NQgX.js","./GMLocJHP.js","./2FgppHLC.js","./CA74dF2b.js","./qW2V2r_p.js","./ByVBARmO.js","./boyBAVNN.js","./C4o9gerC.js","./B05h-4V9.js","./Ck-cgwga.js","./Tabs.DaLSLYpn.css","./BqKQ8afS.js","./DgixBgIx.js","./DeleteModal.SEMJ_gSK.css","./CXD-Dj4T.js","./i4aLU0Nw.js","./EqBqqo9-.js","./Bdv7ru7D.js","./BmtvKY7O.js","./DXQuLwNn.js","./index.XURKHfTB.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as tt,ab as ot,L as at,bL as E,g2 as st,ax as nt,cL as lt,r as L,ag as rt,J as it,dz as dt,aD as ut,i7 as ct,dJ as Ie,iw as pt,gT as mt,f as q,F as V,fE as Ee,g3 as P,iz as Se,g as ft,cA as vt,M as _t,o as n,c as p,a as v,b as h,R as C,w as H,N as o,W as D,ao as F,at as K,Q as N,aJ as Q,t as G,P as yt,d as ht,O as kt,dH as wt,S as gt,X as W,a4 as X,m as J,ah as xt,Y as bt,Z as Lt,hA as Ce,d0 as Rt,y as It,_ as Et}from"./DZZ6t_j4.js";import{_ as St}from"./QHHXY-Ma.js";import{a as Ct}from"./Dzpuh1ae.js";import{a as Nt}from"./CA74dF2b.js";import{i as Ne,D as Ot}from"./C4K5fdHe.js";import{e as zt}from"./BDAIZopQ.js";import{_ as At}from"./Cy6_Pye2.js";import{I as Tt}from"./DRJOThhQ.js";import"./DKN1hQ6S.js";import{I as Vt}from"./BQuyMdA-.js";import{S as Pt}from"./BLzs_b5A.js";import{S as Dt}from"./BmtvKY7O.js";import"./D_MsYLkT.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";import"./vll-Pnjv.js";import"./GMLocJHP.js";import"./bNr_om_C.js";import"./qW2V2r_p.js";import"./ByVBARmO.js";import"./boyBAVNN.js";import"./BCU2uY6p.js";import"./C3jLTHF4.js";import"./BYINaHrJ.js";import"./dfem9Uc_.js";import"./D9tFZoTQ.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";import"./DXQuLwNn.js";const Ft=W(()=>X(()=>import("./CJFB-Lev.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(_=>_.default||_)),Bt=W(()=>X(()=>import("./BpL0I7vq.js"),__vite__mapDeps([4,1,2,5,6,7,8,9]),import.meta.url).then(_=>_.default||_)),Mt=W(()=>X(()=>import("./CRPCEw5j.js"),__vite__mapDeps([10,1,2,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,7,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]),import.meta.url).then(_=>_.default||_)),Ut={class:"flex flex-col h-full"},$t={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},jt={class:"flex-1 gap-2 flex items-center"},Yt={class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center py-0.5 rounded-md"},qt={class:"flex-1 overflow-auto nc-scrollbar-thin"},Ht={class:"flex items-center"},Kt={class:"flex flex-col gap-2 flex-grow justify-center"},Qt={class:"flex flex-row gap-6 w-10/12"},Gt={key:1,class:"h-full my-auto py-2 flex flex-col gap-3 items-center justify-center text-gray-500"},Jt={key:0},Wt={key:1},Xt={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between min-h-11"},Zt={class:"flex"},eo={class:"flex items-center gap-1"},to={key:0,class:"flex items-center"},oo={key:1,class:"flex items-center"},ao=tt({__name:"UnLinkedItems",props:{modelValue:{type:Boolean},column:{},hideBackBtn:{type:Boolean}},emits:["update:modelValue","addNewRecord","attachLinkedRecord"],setup(_,{emit:Oe}){const ze=_,Z=Oe,O=ot(ze,"modelValue",Z),{isMobileMode:B}=at(),i=E(st),{isSharedBase:Ae}=nt(lt()),R=L(),{t:ee}=rt(),{$e:te}=It(),{isDataReadOnly:Te}=it(),{childrenExcludedList:I,isChildrenExcludedListLinked:x,childrenExcludedOffsetCount:Ve,childrenListOffsetCount:Pe,isChildrenExcludedListLoading:De,isChildrenExcludedLoading:oe,childrenListCount:Fe,loadChildrenExcludedList:ae,loadChildrenList:se,childrenExcludedListPagination:l,relatedTableDisplayValueProp:ne,displayValueTypeAndFormatProp:Be,link:Me,relatedTableMeta:m,meta:le,unlink:Ue,row:k,resetChildrenExcludedOffsetCount:M}=Ct(),{addLTARRef:re,isNew:z,removeLTARRef:$e,state:A}=Nt(),ie=E(dt,L(!1)),T=L(!1);oe.value=!0;const U=E(ut,L(!1)),de=E(ct,()=>{}),$=E(pt,Ie()),j=E(mt,Ie()),b=q(()=>{var t,e;return(e=(t=i.value)==null?void 0:t.colOptions)==null?void 0:e.type}),je=async(t,e)=>{z.value?(re(t,i==null?void 0:i.value),b.value==="oo"||b.value==="bt"?x.value.forEach((s,r)=>{s&&(x.value[r]=!1),e===r&&(x.value[r]=!0)}):x.value[e]=!0,de(),te("a:links:link")):await Me(t,{},!1,e)},Ye=async(t,e)=>{z.value?($e(t,i==null?void 0:i.value),x.value[e]=!1,de(),te("a:links:unlink")):await Ue(t,{},!1,e)};V(O,(t,e)=>{t&&!e&&(l.query="",l.page=1,U.value||se(),ae(A.value,!0)),t||M()},{immediate:!0});const w=L(!1),S=L({}),qe=q(()=>{var r,u,y,f;if(z.value)return{};const t=(r=i==null?void 0:i.value)==null?void 0:r.colOptions,e=(y=(u=m==null?void 0:m.value)==null?void 0:u.columns)==null?void 0:y.find(g=>{if(!Ee(g))return!1;const d=g==null?void 0:g.colOptions;return(d==null?void 0:d.fk_related_model_id)!==le.value.id?!1:t.type===P.MANY_TO_MANY&&(d==null?void 0:d.type)===P.MANY_TO_MANY?t.fk_parent_column_id===d.fk_child_column_id&&t.fk_child_column_id===d.fk_parent_column_id:t.fk_parent_column_id===d.fk_parent_column_id&&t.fk_child_column_id===d.fk_child_column_id});if(!e)return{};const s=e==null?void 0:e.colOptions;return s?s.type===P.BELONGS_TO||s.type===P.ONE_TO_ONE?{[e.title]:(f=k==null?void 0:k.value)==null?void 0:f.row}:{[e.title]:(k==null?void 0:k.value)&&[k.value.row]}:{}}),He=Se(Ce,t=>(m.value.columns??[]).filter(e=>Ne(e))[0]),Ke=Se(Ce,t=>(m.value.columns??[]).filter(e=>!Rt(e)&&!Ot(e)&&!Ee(e)&&!Ne(e)).sort((e,s)=>{var r,u;return(((r=e.meta)==null?void 0:r.defaultViewColOrder)??1/0)-(((u=s.meta)==null?void 0:u.defaultViewColOrder)??1/0)}).slice(0,B.value?1:3)),Qe=q(()=>{var t,e,s,r,u,y,f,g,d;return U.value||z.value?b.value==="bt"||b.value==="oo"?(e=A.value)!=null&&e[(t=i.value)==null?void 0:t.title]?1:0:((u=(r=A.value)==null?void 0:r[(s=i.value)==null?void 0:s.title])==null?void 0:u.length)??0:b.value==="bt"?(f=k.value)!=null&&f.row[(y=m.value)==null?void 0:y.title]?1:0:b.value==="oo"?(d=k.value)!=null&&d.row[(g=i.value)==null?void 0:g.title]?1:0:Fe.value??0});V(w,()=>{w.value||(T.value=!1,U.value||se(),ae(A.value)),Ve.value=0,Pe.value=0}),V(R,()=>{var t;(t=R.value)==null||t.focus()});const Y=(t,e)=>{Ae.value||(x.value[Number.parseInt(e)]?Ye(t,Number.parseInt(e)):je(t,Number.parseInt(e)))},Ge=()=>{S.value={},w.value=!0,T.value=!0},Je=t=>{var s;re(t,i==null?void 0:i.value),$==null||$.trigger({shouldShowLoading:!1}),j==null||j.trigger({shouldShowLoading:!1});const e=J("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[J("span",{class:"font-semibold"},ee("activity.recordCreatedLinked")),J("span",{class:"text-gray-500"},ee("activity.gotSavedLinkedSuccessfully",{tableName:(s=m.value)==null?void 0:s.title,recordTitle:t[ne.value]}))]);xt.success(e),O.value=!1},ue=t=>{var e,s,r,u,y;if(t.key==="Escape")O.value=!1;else if(t.key==="ArrowDown"){t.preventDefault();try{(s=(e=t.target)==null?void 0:e.nextElementSibling)==null||s.focus()}catch{}}else if(t.key==="ArrowUp"){t.preventDefault();try{(u=(r=t.target)==null?void 0:r.previousElementSibling)==null||u.focus()}catch{}}else if(!w.value&&t.key!=="Tab"&&t.key!=="Shift"&&t.key!=="Enter"&&t.key!==" ")try{(y=R.value)==null||y.focus()}catch{}},ce=L();V(l,()=>{var t;(t=ce.value)==null||t.scrollTo({top:0,behavior:"smooth"})}),ft(()=>{window.addEventListener("keydown",ue),setTimeout(()=>{var t;(t=R.value)==null||t.focus()},100)}),vt(()=>{M(),l.query="",window.removeEventListener("keydown",ue)});const We=()=>{l.page=1,M()};return(t,e)=>{var me,fe,ve,_e,ye,he,ke,we,ge,xe,be,Le;const s=bt,r=Vt,u=Ft,y=Pt,f=Dt,g=Bt,d=At,Xe=Lt,pe=St,Ze=Mt,et=_t("e");return n(),p("div",{class:gt(["nc-modal-link-record h-full w-full overflow-hidden",{active:o(O)}]),onKeydown:e[8]||(e[8]=Q(D(()=>{},["stop"]),["enter"]))},[v("div",Ut,[v("div",$t,[v("div",jt,[t.hideBackBtn?C("",!0):(n(),p("button",{key:0,class:"!text-brand-500 hover:!text-brand-700 p-1.5 flex",onClick:e[0]||(e[0]=a=>Z("attachLinkedRecord"))},[h(s,{icon:"ncArrowLeft",class:"flex-none h-4 w-4"})])),v("div",Yt,[h(r,{ref_key:"filterQueryRef",ref:R,value:o(l).query,"onUpdate:value":e[1]||(e[1]=a=>o(l).query=a),bordered:!1,placeholder:"Search records to link...",class:"w-full nc-excluded-search min-h-4 !pl-0",size:"small",onChange:We,onKeydownCapture:e[2]||(e[2]=D(a=>{var c;a.key==="Escape"&&((c=o(R))==null||c.blur())},["stop"]))},{prefix:H(()=>[h(s,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"])])]),h(u,{"data-testid":"nc-link-count-info","linked-records":o(Qe),"related-table-title":(me=o(m))==null?void 0:me.title,relation:o(b),"table-title":(fe=o(le))==null?void 0:fe.title},null,8,["linked-records","related-table-title","relation","table-title"])]),v("div",qt,[(_e=(ve=o(I))==null?void 0:ve.pageInfo)!=null&&_e.totalRows?(n(),p("div",{key:0,ref_key:"childrenExcludedListRef",ref:ce},[o(oe)?(n(!0),p(F,{key:0},K(Array.from({length:10}),(a,c)=>(n(),p("div",{key:c,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:bg-gray-50"},[v("div",Ht,[h(y,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),v("div",Kt,[h(f,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),v("div",Qt,[(n(),p(F,null,K([1,2,3],Re=>h(f,{key:Re,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(n(!0),p(F,{key:1},K(((ye=o(I))==null?void 0:ye.list)??[],(a,c)=>(n(),N(g,{key:c,attachment:o(He),"display-value-type-and-format-prop":o(Be),fields:o(Ke),"is-linked":o(x)[Number.parseInt(c)],"is-loading":o(De)[Number.parseInt(c)],"related-table-display-value-prop":o(ne),row:a,"data-testid":"nc-excluded-list-item",onLinkOrUnlink:Re=>Y(a,c),onExpand:()=>{S.value=a,w.value=!0},onKeydown:[Q(D(()=>Y(a,c),["prevent","stop"]),["space"]),Q(D(()=>Y(a,c),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"]))),128))],512)):(n(),p("div",Gt,[h(o(Tt),{class:"w-16 h-16 mx-auto"}),o(l).query?(n(),p("p",Jt,G(t.$t("msg.noRecordsMatchYourSearchQuery")),1)):(n(),p("p",Wt,G(t.$t("msg.noRecordsAvailForLinking")),1))]))]),v("div",Xt,[v("div",Zt,[!o(ie)&&!o(Te)?yt((n(),N(Xe,{key:0,size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",onClick:Ge},{default:H(()=>[v("div",eo,[o(B)?C("",!0):(n(),N(d,{key:0})),ht(" "+G(t.$t("activity.newRecord")),1)])]),_:1})),[[et,["c:row-expand:open"]]]):C("",!0)]),(he=o(I))!=null&&he.pageInfo&&+((we=(ke=o(I))==null?void 0:ke.pageInfo)==null?void 0:we.totalRows)>o(l).size?(n(),p(F,{key:0},[o(B)?(n(),p("div",to,[h(pe,{current:o(l).page,"onUpdate:current":e[3]||(e[3]=a=>o(l).page=a),"page-size":o(l).size,"onUpdate:pageSize":e[4]||(e[4]=a=>o(l).size=a),total:+((xe=(ge=o(I))==null?void 0:ge.pageInfo)==null?void 0:xe.totalRows),"entity-name":"links-excluded-list"},null,8,["current","page-size","total"])])):(n(),p("div",oo,[h(pe,{current:o(l).page,"onUpdate:current":e[5]||(e[5]=a=>o(l).page=a),"page-size":o(l).size,"onUpdate:pageSize":e[6]||(e[6]=a=>o(l).size=a),total:+((Le=(be=o(I))==null?void 0:be.pageInfo)==null?void 0:Le.totalRows),"entity-name":"links-excluded-list",mode:"simple"},null,8,["current","page-size","total"])]))],64)):C("",!0)])]),(n(),N(wt,null,{default:H(()=>{var a;return[o(w)?(n(),N(Ze,{key:0,modelValue:o(w),"onUpdate:modelValue":e[7]||(e[7]=c=>kt(w)?w.value=c:null),"load-row":!o(ie),"close-after-save":o(T),meta:o(m),"new-record-header":o(T)?t.$t("activity.tableNameCreateNewRecord",{tableName:(a=o(m))==null?void 0:a.title}):void 0,row:{row:o(S),oldRow:{},rowMeta:Object.keys(o(S)).length>0?{}:{new:!0}},"row-id":("extractPkFromRow"in t?t.extractPkFromRow:o(zt))(o(S),o(m).columns),state:o(qe),"use-meta-fields":"","maintain-default-view-order":"","skip-reload":!0,"new-record-submit-btn-text":"Create & Link",onCreatedRecord:Je},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","row-id","state"])):C("",!0)]}),_:1}))],34)}}}),Po=Et(ao,[["__scopeId","data-v-94dad90b"]]);export{Po as default};
