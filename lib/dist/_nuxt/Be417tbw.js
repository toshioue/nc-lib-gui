import{_ as S}from"./DnSVh-oD.js";import{e as V,r as f,f as b,d4 as j,g as L,o as U,Q as h,w,a as B,b as m,N as r,d as C,Z as D}from"./DZZ6t_j4.js";import{_ as E}from"./jk15w8bt.js";import{a as P}from"./20waaH4V.js";import"./D_MsYLkT.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";import"./vll-Pnjv.js";import"./sz1d3zjm.js";import"./TJfB7GlU.js";import"./0azk-b-q.js";import"./BLgccLvp.js";import"./vK-WmZ7a.js";import"./GMLocJHP.js";import"./B05h-4V9.js";import"./BDAIZopQ.js";import"./DKN1hQ6S.js";import"./BQuyMdA-.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";import"./0QUe8GCE.js";import"./Bdv7ru7D.js";import"./BVrX6sNU.js";import"./Dwil3It4.js";import"./B0udi9ji.js";import"./Dg0-TbNo.js";import"./t0mbNaqp.js";import"./Ck-cgwga.js";import"./CMIIcM5i.js";import"./9kNwGLxE.js";import"./DS_HXCWn.js";import"./C4o9gerC.js";import"./boyBAVNN.js";import"./BhreHRvP.js";import"./DWT0yQl9.js";import"./Cyxyb8KW.js";import"./i4aLU0Nw.js";import"./BIg_TdrP.js";import"./qW2V2r_p.js";import"./ByVBARmO.js";const R={class:"flex flex-col gap-2 p-2 border-1 rounded-lg"},Ve=V({__name:"index",setup(T){const{extension:p,tables:c,getViewsForTable:_,getData:I}=P(),n=f([]),e=f({}),x=b(()=>c.value.map(t=>({label:t.title,value:t.id}))),y=b(()=>e.value.tableId?n.value.filter(t=>t.type===j.GRID).map(t=>({label:t.is_default?"Default":t.title,value:t.id}))||[]:[]),v=async()=>{e.value.tableId&&(n.value=await _(e.value.tableId))},g=async t=>{var o;e.value.tableId=t,await v(),e.value.viewId=(o=n.value.find(a=>a.is_default))==null?void 0:o.id,await p.value.kvStore.set("exportPayload",e.value)},k=async t=>{e.value.viewId=t,await p.value.kvStore.set("exportPayload",e.value)},N=async()=>{if(!e.value.tableId||!e.value.viewId)return;const t=[];I({tableId:e.value.tableId,viewId:e.value.viewId,eachPage:(o,a)=>{t.push(...o),a()},done:()=>{const o=JSON.stringify(t,null,2),a=new Blob([o],{type:"application/json"}),s=URL.createObjectURL(a),l=document.createElement("a"),i=c.value.find(u=>u.id===e.value.tableId),d=n.value.find(u=>u.id===e.value.viewId);i&&d?l.download=`${i.title} - ${d.is_default?"Default":d.title}.json`:l.download="data.json",l.href=s,l.click(),URL.revokeObjectURL(s)}})};return L(()=>{e.value=p.value.kvStore.get("exportPayload")||{},v()}),(t,o)=>{const a=S,s=D,l=E;return U(),h(l,null,{default:w(()=>[B("div",R,[m(a,{value:r(e).tableId,"onUpdate:value":o[0]||(o[0]=i=>r(e).tableId=i),options:r(x),placeholder:"-select table-",onChange:g},null,8,["value","options"]),m(a,{value:r(e).viewId,"onUpdate:value":o[1]||(o[1]=i=>r(e).viewId=i),options:r(y),placeholder:"-select view-",onChange:k},null,8,["value","options"]),m(s,{onClick:N},{default:w(()=>o[2]||(o[2]=[C("Export")])),_:1})])]),_:1})}}});export{Ve as default};
