import{f as ne,bL as b,r as f,d0 as oe,c$ as se,d1 as ie,fC as le,g as x,cU as o,fB as re,H as V,O as ce,P as n,o as s,U as h,w as c,c as w,Y as de,al as N,am as R,a as l,t as k,b as g,d as U,V as B,W as j,S as C,Q as L,R as ue,an as O,a2 as me,ap as _e,$ as pe,p as fe,e as ve,A as he,_ as we}from"./BLdk6lRf.js";import{_ as ke}from"./CU4s23lZ.js";import{_ as ge}from"./iRN6wbuV.js";import{_ as ye}from"./CeUmvK4L.js";import{_ as be}from"./BaHXy0hV.js";import{a as xe}from"./KocR1J4Z.js";import{a as Ce}from"./rkXympsO.js";import{S as De}from"./BrF0EXdL.js";import"./DehHWxa3.js";import"./CSxPNiqH.js";import"./CKK7YKGi.js";import"./DV47GYLy.js";import"./yAvBJhn8.js";import"./BD_L_KCX.js";import"./DTl_5Njz.js";import"./BtPl72f0.js";import"./CwqgNcWF.js";import"./CBNgcPSC.js";import"./BQQOEPN4.js";import"./DTv03lbO.js";import"./C-Z2v8Hi.js";const Te=y=>(fe("data-v-e5afd6ee"),y=y(),ve(),y),Ie={class:"nc-calendar-btn"},Se={class:"flex items-center gap-2"},$e={class:"text-capitalize !group-hover:text-brand-500 !text-[13px] font-medium"},Me={class:"flex w-full gap-2 justify-between items-center"},Ve={class:"flex items-center"},Ne={key:0,class:"flex items-center gap-2 !mt-2"},Re=Te(()=>l("span",{class:"text-sm text-gray-500"}," Date field is required! ",-1)),Ue={class:"text-gray-800"},Be=ne({__name:"Range",setup(y){const T=b(oe,f()),{$api:P}=he(),r=b(se,f()),A=b(ie,f(!1)),F=b(le,f(!1)),{loadViewColumns:E}=xe(),{loadCalendarMeta:W,loadCalendarData:z,loadSidebarData:H,fetchActiveDates:q,updateCalendarMeta:G,viewMetaProperties:Q}=Ce(),d=f(!1),D=x({get:()=>{var e;return((e=Q.value)==null?void 0:e.hide_weekend)??!1},set:e=>{G({meta:{hide_weekend:e}})}}),I=x(()=>{var e,a;return(((a=(e=T.value)==null?void 0:e.columns)==null?void 0:a.filter(t=>{var p,u;return[o.DateTime,o.Date,o.CreatedTime,o.LastModifiedTime].includes(t.uidt)||t.uidt===o.Formula&&((u=(p=t.colOptions)==null?void 0:p.parsed_tree)==null?void 0:u.dataType)===re.DATE}).map(t=>({label:t.title,value:t.id,uidt:t.uidt})))??[]).sort((t,p)=>{const u={[o.DateTime]:1,[o.Date]:2,[o.Formula]:3,[o.CreatedTime]:4,[o.LastModifiedTime]:5};return(u[t.uidt]||6)-(u[p.uidt]||6)})});V(()=>{var e;return(e=r.value)==null?void 0:e.id},async(e,a)=>{e!==a&&T.value&&await E()},{immediate:!0});const S=x(()=>{var a;const e=[];return!r.value||!r.value.view||(a=r.value.view.calendar_range)==null||a.forEach(t=>{e.push({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id})}),e}),_=f(S.value),$=x(()=>_.value.length>0&&_.value[0].fk_from_column_id);V(d,e=>{!e&&!$.value&&(d.value=!0,_.value.length===0&&_.value.push({fk_from_column_id:void 0,fk_to_column_id:null}))},{immediate:!0});const Y=async()=>{var e;if(r.value)try{const a=_.value.filter(t=>t.fk_from_column_id).map(t=>({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id}));await P.dbView.calendarUpdate((e=r.value)==null?void 0:e.id,{calendar_range:a}),r.value.view&&(r.value.view.calendar_range=a),await W(),await Promise.all([z(),H(),q()]),d.value=!1}catch(a){console.log(a),O.error("There was an error while updating view!")}else O.error("Please select a view first")};return(e,a)=>{const t=me,p=ke,u=_e,J=De,K=ge,X=pe,Z=ye,ee=be,ae=ce("e");return n(F)?C("",!0):(s(),h(ee,{key:0,visible:n(d),"onUpdate:visible":a[2]||(a[2]=m=>L(d)?d.value=m:null),trigger:["click"],class:"!xs:hidden"},{overlay:c(()=>[n(d)?(s(),w("div",{key:0,class:"w-98 space-y-6 rounded-2xl p-6","data-testid":"nc-calendar-range-menu",onClick:a[1]||(a[1]=de(()=>{},["stop"]))},[(s(!0),w(N,null,R(n(_),(m,M)=>(s(),w("div",{key:M,class:"flex w-full gap-2 mb-2 items-center","data-testid":"nc-calendar-range-option"},[l("span",null,k(e.$t("labels.organiseBy")),1),g(K,{value:m.fk_from_column_id,"onUpdate:value":i=>m.fk_from_column_id=i,placeholder:e.$t("placeholder.notSelected"),"data-testid":"nc-calendar-range-from-field-select",onChange:Y},{default:c(()=>[(s(!0),w(N,null,R([...n(I)??[]].filter(i=>{if(M===0)return!0;const v=(n(I)??[]).find(te=>te.value===n(S)[0].fk_from_column_id);return(v==null?void 0:v.uidt)===i.uidt}),(i,v)=>(s(),h(J,{key:v,class:"w-40",value:i.value},{default:c(()=>[l("div",Me,[l("div",Ve,[g(p,{column:i},null,8,["column"]),g(u,{class:"truncate flex-1 max-w-18",placement:"top","show-on-truncate-only":""},{title:c(()=>[U(k(i.label),1)]),default:c(()=>[U(" "+k(i.label),1)]),_:2},1024)]),i.value===m.fk_from_column_id?(s(),h(B(("iconMap"in e?e.iconMap:n(j)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary min-w-4 h-4"})):C("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]))),128)),n($)?C("",!0):(s(),w("div",Ne,[g(X,{icon:"warning",class:"text-sm mt-0.5 text-orange-500"}),Re])),l("div",null,[g(Z,{checked:n(D),"onUpdate:checked":a[0]||(a[0]=m=>L(D)?D.value=m:null)},{default:c(()=>[l("span",Ue,k(e.$t("activity.hideWeekends")),1)]),_:1},8,["checked"])])])):C("",!0)]),default:c(()=>[l("div",Ie,[ue((s(),h(t,{disabled:n(A),class:"nc-toolbar-btn !border-0 group !h-6",size:"small",type:"secondary","data-testid":"nc-calendar-range-btn"},{default:c(()=>[l("div",Se,[(s(),h(B(("iconMap"in e?e.iconMap:n(j)).calendar),{class:"h-4 w-4 transition-all group-hover:text-brand-500"})),l("span",$e,k(e.$t("activity.settings")),1)])]),_:1},8,["disabled"])),[[ae,["c:calendar:change-calendar-range"]]])])]),_:1},8,["visible"]))}}}),na=we(Be,[["__scopeId","data-v-e5afd6ee"]]);export{na as default};
