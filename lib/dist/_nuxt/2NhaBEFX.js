import{f as oe,cB as re,N as ue,bL as f,r as o,hf as ie,aw as ce,ay as me,hp as ve,ht as fe,az as de,gs as pe,gx as ye,fH as he,ai as ke,g as D,ce as u,F as $e,ae as A,H as K,cV as ge,d4 as V,aA as He,iy as be,o as E,c as z,b as O,w as U,a as P,P as s,a7 as Me,Y as _,U as Ve,S as G,T as Ye,al as Ie,a_ as we,$ as Ce,_ as De}from"./nEPQs079.js";import{_ as Fe}from"./DYhgEkYp.js";import{_ as Ee}from"./CNqbIxb7.js";const Pe=["title"],_e=["value","placeholder","readonly"],Te={class:"min-w-[72px]"},je={key:0,class:"absolute inset-0 z-90 cursor-pointer"},xe=oe({__name:"TimePicker",props:{modelValue:{},isPk:{type:Boolean}},emits:["update:modelValue"],setup(k,{emit:R}){const T=R,{isMysql:q}=re(),{showNull:F,isMobileMode:L}=ue(),$=f(ie,o(!1)),Y=f(ce,o(!1)),i=f(me,o(!1)),g=f(ve,o(!1)),d=f(fe,o(!1)),Z=f(de,o(!1)),J=f(pe,o(!1)),H=f(ye,o(!1)),p=f(he),Q=q(p.value.source_id)?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ",I=o(!1),c=o(),w=o(!1),{t:j}=ke(),l=o(!1),y=o(),n=D({get(){if(!k.modelValue||w.value)return;let e=u(k.modelValue);if(e.isValid()||(e=u(k.modelValue,"HH:mm:ss")),e.isValid()||(e=u(`1999-01-01 ${k.modelValue}`)),!e.isValid()){I.value=!0;return}return e},set(e){if(w.value=!1,!e){T("update:modelValue",null);return}if(e.isValid()){const a=e.format("HH:mm"),t=u(`1999-01-01 ${a}:00`);T("update:modelValue",t.format(Q))}}});$e(()=>{n.value&&(y.value=n.value)});const m=`picker_${Math.floor(Math.random()*99999)}`;A(c,e=>{var a,t,r;(a=e.target)!=null&&a.closest(`.${m}, .nc-${m}`)||((r=(t=c.value)==null?void 0:t.blur)==null||r.call(t),l.value=!1)});const W=e=>{var a,t;(a=e==null?void 0:e.relatedTarget)!=null&&a.closest(`.${m}, .nc-${m}`)||(t=e==null?void 0:e.target)!=null&&t.closest(`.${m}, .nc-${m}`)||(l.value=!1)},X=()=>{l.value=!0};K(l,e=>{var a,t;e?(i.value=!0,(t=(a=c.value)==null?void 0:a.focus)==null||t.call(a),A(document.querySelector(`.${m}`),r=>{var v;(v=r==null?void 0:r.target)!=null&&v.closest(`.nc-${m}`)||(l.value=!1)})):w.value=!1},{flush:"post"}),K(i,e=>{d.value&&e&&!l.value&&(l.value=!0)});const ee=D(()=>(Z.value||H.value)&&!I.value||d.value&&!F.value&&!I.value&&!ge(p.value)&&Y.value||g.value?V(p.value.meta).is12hrFormat?"hh:mm AM":"HH:mm":k.modelValue===null&&F.value?j("general.null").toUpperCase():I.value?j("msg.invalidTime"):""),b=D(()=>$.value||($.value||n.value&&k.isPk)&&!Y.value&&!i.value?!1:l.value),ae=()=>{$.value||l.value||(l.value=Y.value||i.value)},te=(e,a)=>{var t,r,v,M,h,B,C,S;switch(e.key!=="Enter"&&e.stopPropagation(),e.key){case"Enter":e.preventDefault(),J.value&&e.stopPropagation(),n.value=y.value,l.value=!a,l.value||d.value&&!H.value&&!g.value&&(i.value=!1,(r=(t=c.value)==null?void 0:t.blur)==null||r.call(t));return;case"Tab":l.value=!1,d.value&&!H.value&&!g.value&&(i.value=!1,(M=(v=c.value)==null?void 0:v.blur)==null||M.call(v));return;case"Escape":a?(l.value=!1,d.value&&!H.value&&!g.value&&(i.value=!1,(B=(h=c.value)==null?void 0:h.blur)==null||B.call(h))):(i.value=!1,(S=(C=c.value)==null?void 0:C.blur)==null||S.call(C));return;default:if(!a&&/^[0-9a-z]$/i.test(e.key)){l.value=!0;const N=e.target,ne=N.value;we(()=>{N.value=ne})}}};He(document,"keydown",e=>{if(Y.value&&!(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||!d.value||H.value||g.value||be()))switch(e.key){case";":n.value=u(new Date),e.preventDefault();break;default:!b.value&&c.value&&/^[0-9a-z]$/i.test(e.key)&&(w.value=!0,c.value.focus(),i.value=!0,l.value=!0)}});const le=e=>{let a=e.target.value;if(!a){y.value=void 0;return}a=V(p.value.meta).is12hrFormat?a.trim().toUpperCase().replace(/(AM|PM)$/," $1").replace(/\s+/g," "):a.trim();const t=u(a,V(p.value.meta).is12hrFormat?"hh:mm A":"HH:mm");t.isValid()&&(y.value=u(`${u().format("YYYY-MM-DD")} ${t.format("HH:mm")}`))};function x(e){if(e||(y.value=void 0,n.value=void 0),!!(e!=null&&e.isValid())){if(n.value){const a=u(`${n.value.format("YYYY-MM-DD")} ${e.format("HH:mm")}:00`);y.value=a,n.value=a}else{const a=u(`${u().format("YYYY-MM-DD")} ${e.format("HH:mm")}:00`);y.value=a,n.value=a}l.value=!1}}const se=D(()=>{var e;return((e=n.value)==null?void 0:e.format(V(p.value.meta).is12hrFormat?"hh:mm A":"HH:mm"))??""});return(e,a)=>{const t=Ce,r=Fe,v=Ee;return E(),z(Ie,null,[O(v,{visible:s(b),"auto-close":!1,trigger:["click"],class:Ye(["nc-cell-field",[`nc-${m}`,{"nc-null":e.modelValue===null&&s(F)}]]),"overlay-class-name":`${m} nc-picker-time ${s(b)?"active":""} !min-w-[0]`},{overlay:U(()=>[P("div",Te,[O(r,{"selected-date":s(n),"min-granularity":30,"is-min-granularity-picker":"","is12hr-format":!!("parseProp"in e?e.parseProp:s(V))(s(p).meta).is12hrFormat,"is-open":s(b),"onUpdate:selectedDate":x},null,8,["selected-date","is12hr-format","is-open"])])]),default:U(()=>{var M;return[P("div",Me(e.$attrs,{title:(M=s(n))==null?void 0:M.format("HH:mm"),class:"nc-time-picker h-full flex items-center justify-between ant-picker-input relative"}),[P("input",{ref_key:"datePickerRef",ref:c,type:"text",value:s(se),placeholder:s(ee),class:"nc-time-input border-none outline-none !text-current bg-transparent !focus:border-none !focus:outline-none !focus:ring-transparent",readonly:s($)||!!s(L),onBlur:W,onFocus:X,onKeydown:a[0]||(a[0]=h=>te(h,s(b))),onMouseup:a[1]||(a[1]=_(()=>{},["stop"])),onMousedown:a[2]||(a[2]=_(()=>{},["stop"])),onClick:ae,onInput:le},null,40,_e),s(n)&&!s($)?(E(),Ve(t,{key:0,icon:"closeCircle",class:"nc-clear-time-icon nc-action-icon absolute right-0 top-[50%] transform -translate-y-1/2 invisible cursor-pointer",onClick:a[3]||(a[3]=_(h=>x(),["stop"]))})):G("",!0)],16,Pe)]}),_:1},8,["visible","class","overlay-class-name"]),!s(i)&&s(d)?(E(),z("div",je)):G("",!0)],64)}}}),Ae=De(xe,[["__scopeId","data-v-b407be0a"]]);export{Ae as default};
