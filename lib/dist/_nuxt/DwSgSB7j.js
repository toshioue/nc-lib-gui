const __vite__fileDeps=["./DiWlI-Tv.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css","./Header.x-GI6b6n.css","./CM0ap5yD.js","./BcWX645D.js","./C00NHga8.js","./D7yS5JAk.js","./SnuQkHMZ.js","./ListItem.-o3YFXe-.css","./C1WkfNyL.js","./DBOeGHNL.js","./MenuItem.C7h59s4s.css","./C6pQ4eSP.js","./VVwMOds3.js","./Divider.DqtSqZhb.css","./Bxm040c6.js","./Menu.CQ8GNWeI.css","./CiTH7PYd.js","./H9SMaBKT.js","./DivDataCell.1yCNpUg3.css","./Do1LnTan.js","./UserIcon.DEVmGavY.css","./DRVKgtZT.js","./Cw6_lRNR.js","./Badge.D0-UrqG9.css","./DGBAbsZ-.js","./Cy50pBgZ.js","./Bcy-XIkn.js","./DPaOlBFV.js","./BQQOEPN4.js","./hvq8FVej.js","./C8c9012h.js","./BIsWr_mR.js","./BZz6iAla.js","./links.C8uCzV-l.css","./Dwil3It4.js","./DgdUBGGc.js","./DzMG5wJt.js","./DvfxijkH.js","./BtFqRdSP.js","./CO8XXsKl.js","./BPivYv4D.js","./r2PN1Hfg.js","./vIgbYHAs.js","./DpDIhxXu.js","./boyBAVNN.js","./BK3iCpwL.js","./DFiWgQ57.js","./CAuyt8bq.js","./Tabs.DaLSLYpn.css","./WttlrBnq.js","./S1x-kZdE.js","./DeleteModal.SEMJ_gSK.css","./CpJUN2HL.js","./BcpeJQoi.js","./CnN16FGu.js","./ahvdY77A.js","./cCmEAZwU.js","./CHLXm8Ls.js","./index.MCJqUXFi.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as et,ad as tt,N as st,ai as ot,bN as U,r as y,aF as at,dB as nt,fQ as lt,hr as it,L as rt,az as dt,cN as ct,H as F,ig as Ce,g as O,fs as Ie,fR as J,i as ut,cC as mt,O as pt,o as a,c as _,a as l,P as t,b as k,w as P,Y as j,aq as W,av as ee,S as C,aL as te,t as $,R as se,d as oe,T as S,Q as ft,dI as _t,U as vt,Z as ne,a6 as le,n as ae,aj as ht,$ as yt,a0 as kt,hh as Te,d3 as wt,_ as gt}from"./Cgw6cdOy.js";import{_ as xt}from"./CZSp73nk.js";import{a as bt}from"./BStsc-2E.js";import{a as Lt}from"./r2PN1Hfg.js";import{i as Oe,D as Rt}from"./BBXMuneh.js";import{e as Ct}from"./D7yS5JAk.js";import{_ as It}from"./BS-JicVa.js";import"./Bcy-XIkn.js";import{I as Tt}from"./DPaOlBFV.js";import{S as Ot}from"./JRGWYtLw.js";import"./BR5dm4Ez.js";import{S as St}from"./cCmEAZwU.js";import"./D8rpj5Lr.js";import"./BcZAlRJW.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";import"./hvq8FVej.js";import"./CO8XXsKl.js";import"./MA4kh5_N.js";import"./vIgbYHAs.js";import"./DpDIhxXu.js";import"./boyBAVNN.js";import"./B1jnz4_u.js";import"./DCaZaUH5.js";import"./DpYA1Dpy.js";import"./dmcxUY_0.js";import"./LSbsNkd9.js";import"./BIsWr_mR.js";import"./BZz6iAla.js";import"./CHLXm8Ls.js";const Nt=""+new URL("link-records.BXQG6er6.png",import.meta.url).href,Et=ne(()=>le(()=>import("./DiWlI-Tv.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(m=>m.default||m)),Vt=ne(()=>le(()=>import("./CM0ap5yD.js"),__vite__mapDeps([4,1,2,5,6,7,8,9]),import.meta.url).then(m=>m.default||m)),zt=ne(()=>le(()=>import("./C1WkfNyL.js"),__vite__mapDeps([10,1,2,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,7,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]),import.meta.url).then(m=>m.default||m)),At={class:"flex flex-col h-full"},Ft={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},Pt={key:0,class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center py-0.5 rounded-md"},$t={key:1},Dt={key:0},Mt={class:"cursor-pointer"},Bt={class:"flex items-center"},Ut={class:"flex flex-col gap-2 flex-grow justify-center"},jt={class:"flex flex-row gap-6 w-10/12"},Kt={key:1,class:"h-full flex flex-col gap-2 my-auto items-center justify-center text-gray-500 text-center"},Qt=["alt"],Yt={class:"text-base text-gray-700 font-bold"},qt={class:"text-gray-700"},Gt={class:"flex items-center gap-1"},Ht={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between gap-3 min-h-11"},Xt={class:"flex items-center gap-2"},Zt={class:"flex items-center gap-1"},Jt={class:"flex items-center gap-1"},Wt={key:0,class:"flex justify-center items-center"},es=et({__name:"LinkedItems",props:{modelValue:{type:Boolean},cellValue:{},column:{},items:{}},emits:["update:modelValue","attachRecord"],setup(m,{emit:Se}){const N=m,K=Se,Q=tt(N,"modelValue",K),{isMobileMode:Y}=st(),{t:ie}=ot(),E=U(at,y(!1)),D=U(nt,y(!1)),M=y(!1),u=U(lt,y()),V=U(it,y(!1)),I=y(),{isDataReadOnly:Ne}=rt(),{isSharedBase:Ee}=dt(ct()),{childrenList:w,childrenListCount:x,loadChildrenList:re,childrenListPagination:i,childrenExcludedOffsetCount:Ve,childrenListOffsetCount:ze,relatedTableDisplayValueProp:de,displayValueTypeAndFormatProp:Ae,unlink:Fe,isChildrenListLoading:Pe,isChildrenListLinked:ce,isChildrenLoading:q,relatedTableMeta:p,link:$e,meta:ue,row:b,resetChildrenListOffsetCount:G}=bt(),{isNew:v,state:z,removeLTARRef:De,addLTARRef:Me}=Lt();F([Q,E],e=>{(e[0]||e[1])&&!v.value&&re(!0),e[0]||G()},{immediate:!0});const Be=async(e,s)=>{v.value?await De(e,u==null?void 0:u.value):await Fe(e,{},!1,s)},Ue=async(e,s)=>{v.value?await Me(e,u==null?void 0:u.value):await $e(e,{},!1,s)},je=Ce(Te,e=>(p.value.columns??[]).filter(s=>Oe(s))[0]),Ke=Ce(Te,e=>(p.value.columns??[]).filter(s=>!wt(s)&&!Rt(s)&&!Ie(s)&&!Oe(s)).sort((s,n)=>{var r,f;return(((r=s.meta)==null?void 0:r.defaultViewColOrder)??1/0)-(((f=n.meta)==null?void 0:f.defaultViewColOrder)??1/0)}).slice(0,Y.value?1:3)),h=y(!1),L=y({}),Qe=O(()=>{var r,f,R,g;if(v.value)return{};const e=(r=u==null?void 0:u.value)==null?void 0:r.colOptions,s=(R=(f=p==null?void 0:p.value)==null?void 0:f.columns)==null?void 0:R.find(T=>{if(!Ie(T))return!1;const d=T==null?void 0:T.colOptions;return(d==null?void 0:d.fk_related_model_id)!==ue.value.id?!1:e.type===J.MANY_TO_MANY&&(d==null?void 0:d.type)===J.MANY_TO_MANY?e.fk_parent_column_id===d.fk_child_column_id&&e.fk_child_column_id===d.fk_parent_column_id:e.fk_parent_column_id===d.fk_parent_column_id&&e.fk_child_column_id===d.fk_child_column_id});if(!s)return{};const n=s==null?void 0:s.colOptions;return n?n.type===J.BELONGS_TO?{[s.title]:(g=b==null?void 0:b.value)==null?void 0:g.row}:{[s.title]:(b==null?void 0:b.value)&&[b.value.row]}:{}}),A=O(()=>{var e;return((e=u.value)==null?void 0:e.title)||""}),me=e=>{V.value||E.value||(L.value=e,h.value=!0)},Ye=()=>{L.value={},h.value=!0,M.value=!0},qe=e=>{var n;const s=ae("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[ae("span",{class:"font-semibold"},ie("activity.recordCreatedLinked")),ae("span",{class:"text-gray-500"},ie("activity.gotSavedLinkedSuccessfully",{tableName:(n=p.value)==null?void 0:n.title,recordTitle:e[de.value]}))]);ht.success(s)},Ge=O(()=>{var e,s;return(s=(e=u.value)==null?void 0:e.colOptions)==null?void 0:s.type});F(()=>N.cellValue,()=>{v.value&&re()}),F(h,()=>{h.value||(M.value=!1),Ve.value=0,ze.value=0});const He=O(()=>N.items<10&&i.page===1?N.items:x.value<10&&i.page===1?x.value||10:Math.ceil(x.value/10)===i.page?x.value%10:10),Xe=O(()=>{var e,s;return E.value||v.value?(s=(e=z.value)==null?void 0:e[A.value])==null?void 0:s.length:q.value?N.items:x.value}),H=O(()=>{var e,s,n,r;return((s=(e=w.value)==null?void 0:e.pageInfo)==null?void 0:s.totalRows)||v.value&&((r=(n=z.value)==null?void 0:n[A.value])==null?void 0:r.length)}),pe=(e,s)=>{Ee.value||V.value||D.value&&!E.value||(v.value||ce.value[parseInt(s)]?Be(e,parseInt(s)):Ue(e,parseInt(s)))};F([I,H],()=>{var e;(!(V.value||D.value)||H.value)&&((e=I.value)==null||e.focus())});const fe=e=>{var s,n,r,f,R;if(e.key==="Escape")Q.value=!1;else if(e.key==="ArrowDown"){e.preventDefault();try{(n=(s=e.target)==null?void 0:s.nextElementSibling)==null||n.focus()}catch{}}else if(e.key==="ArrowUp"){e.preventDefault();try{(f=(r=e.target)==null?void 0:r.previousElementSibling)==null||f.focus()}catch{}}else if(!h.value&&e.key!=="Tab"&&e.key!=="Shift"&&e.key!=="Enter"&&e.key!==" ")try{(R=I.value)==null||R.focus()}catch{}};ut(()=>{window.addEventListener("keydown",fe),setTimeout(()=>{var e;(e=I.value)==null||e.focus()},100)});const _e=y();F(i,()=>{var e;(e=_e.value)==null||e.scrollTo({top:0,behavior:"smooth"})}),mt(()=>{G(),i.query="",window.removeEventListener("keydown",fe)});const Ze=()=>{i.page=1,G()};return(e,s)=>{var ve,he,ye,ke,we,ge,xe,be,Le;const n=yt,r=Tt,f=Et,R=Ot,g=St,T=Vt,d=It,X=kt,Je=xt,We=zt,Z=pt("e");return a(),_("div",{class:vt(["nc-modal-child-list h-full w-full",{active:t(Q)}]),onKeydown:s[7]||(s[7]=te(j(()=>{},["stop"]),["enter"]))},[l("div",At,[l("div",Ft,[t(E)?(a(),_("div",$t,"Â ")):(a(),_("div",Pt,[k(r,{ref_key:"filterQueryRef",ref:I,value:t(i).query,"onUpdate:value":s[0]||(s[0]=o=>t(i).query=o),bordered:!1,placeholder:"Search linked records...",class:"w-full min-h-4 !pl-0",size:"small",onChange:Ze,onKeydownCapture:s[1]||(s[1]=j(o=>{var c;o.key==="Escape"&&((c=t(I))==null||c.blur())},["stop"]))},{prefix:P(()=>[k(n,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"])])),k(f,{"data-testid":"nc-link-count-info","linked-records":t(Xe),"related-table-title":(ve=t(p))==null?void 0:ve.title,relation:t(Ge),"table-title":(he=t(ue))==null?void 0:he.title},null,8,["linked-records","related-table-title","relation","table-title"])]),l("div",{ref_key:"childrenListRef",ref:_e,class:"flex-1 overflow-auto nc-scrollbar-thin"},[t(H)||t(q)?(a(),_("div",Dt,[l("div",Mt,[t(q)?(a(!0),_(W,{key:0},ee(Array.from({length:t(He)}),(o,c)=>(a(),_("div",{key:c,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:bg-gray-50"},[l("div",Bt,[k(R,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),l("div",Ut,[k(g,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),l("div",jt,[(a(),_(W,null,ee([1,2,3],B=>k(g,{key:B,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(a(!0),_(W,{key:1},ee(((ye=t(w))==null?void 0:ye.list)??((ke=t(z))==null?void 0:ke[t(A)])??[],(o,c)=>{var B;return a(),C(T,{key:c,attachment:t(je),"display-value-type-and-format-prop":t(Ae),fields:t(Ke),"is-linked":(B=t(w))!=null&&B.list?t(ce)[Number.parseInt(c)]:!0,"is-loading":t(Pe)[Number.parseInt(c)],"related-table-display-value-prop":t(de),row:o,"data-testid":"nc-child-list-item",onLinkOrUnlink:Re=>pe(o,c),onExpand:Re=>me(o),onKeydown:[te(j(Re=>pe(o,c),["prevent","stop"]),["space"]),te(j(()=>me(o),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"])}),128))])])):(a(),_("div",Kt,[l("img",{alt:e.$t("msg.clickLinkRecordsToAddLinkFromTable"),class:"!w-[158px] flex-none",src:Nt},null,8,Qt),l("div",Yt,$(e.$t("msg.noLinkedRecords")),1),l("div",qt,$(e.$t("msg.clickLinkRecordsToAddLinkFromTable")),1),!t(V)&&(t(x)<1||(((we=t(w))==null?void 0:we.list)??((ge=t(z))==null?void 0:ge[t(A)])??[]).length>0)?se((a(),C(X,{key:0,"data-testid":"nc-child-list-button-link-to",size:"small",onClick:s[2]||(s[2]=o=>K("attachRecord"))},{default:P(()=>[l("div",Gt,[k(d),oe(" "+$(e.$t("title.linkRecords")),1)])]),_:1})),[[Z,["c:links:link"]]]):S("",!0)]))],512),l("div",Ht,[l("div",Xt,[!t(D)&&!t(Ne)?se((a(),C(X,{key:0,size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",onClick:Ye},{default:P(()=>[l("div",Zt,[t(Y)?S("",!0):(a(),C(d,{key:0,class:"h-4 w-4"})),oe(" "+$(e.$t("activity.newRecord")),1)])]),_:1})),[[Z,["c:row-expand:open"]]]):S("",!0),!t(V)&&(t(x)>0||(((xe=t(w))==null?void 0:xe.list)??((be=t(z))==null?void 0:be[t(A)])??[]).length>0)?se((a(),C(X,{key:1,"data-testid":"nc-child-list-button-link-to",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",size:"small",type:"secondary",onClick:s[3]||(s[3]=o=>K("attachRecord"))},{default:P(()=>[l("div",Jt,[k(n,{icon:"link2",class:"!xs:hidden h-4 w-4"}),oe(" "+$(t(Y)?e.$t("title.linkMore"):e.$t("title.linkMoreRecords")),1)])]),_:1})),[[Z,["c:links:link"]]]):S("",!0)]),!t(v)&&((Le=t(w))!=null&&Le.pageInfo)&&+t(w).pageInfo.totalRows>t(i).size?(a(),_("div",Wt,[k(Je,{current:t(i).page,"onUpdate:current":s[4]||(s[4]=o=>t(i).page=o),"page-size":t(i).size,"onUpdate:pageSize":s[5]||(s[5]=o=>t(i).size=o),total:+t(w).pageInfo.totalRows,mode:"simple"},null,8,["current","page-size","total"])])):S("",!0)])]),(a(),C(_t,null,{default:P(()=>{var o;return[t(L)&&t(h)?(a(),C(We,{key:0,modelValue:t(h),"onUpdate:modelValue":s[6]||(s[6]=c=>ft(h)?h.value=c:null),"load-row":!t(D),"close-after-save":t(M),meta:t(p),"new-record-header":t(M)?e.$t("activity.tableNameCreateNewRecord",{tableName:(o=t(p))==null?void 0:o.title}):void 0,row:{row:t(L),oldRow:t(L),rowMeta:Object.keys(t(L)).length>0?{}:{new:!0}},state:t(Qe),"row-id":("extractPkFromRow"in e?e.extractPkFromRow:t(Ct))(t(L),t(p).columns),"use-meta-fields":"","maintain-default-view-order":"","new-record-submit-btn-text":"Create & Link",onCreatedRecord:qe},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","state","row-id"])):S("",!0)]}),_:1}))],34)}}}),Es=gt(es,[["__scopeId","data-v-472d13ab"]]);export{Es as default};
