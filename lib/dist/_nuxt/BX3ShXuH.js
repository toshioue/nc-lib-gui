const __vite__fileDeps=["./DwvYIORx.js","./nEPQs079.js","./entry.B8GgT5QA.css","./CAANIJCe.js","./BQDKbNwe.js","./C3R8onno.js","./VirtualCell.CZh3Dt_h.css","./gBj2Viq1.js","./DVCdQBfZ.js","./-Hb63wRq.js","./DlJISsR5.js","./boyBAVNN.js","./DAFLhYLz.js","./Cell.DV_4HH8i.css","./Dj2YYI3r.js","./VirtualCell.BsQKIqYj.css","./BVVlkhGF.js","./-QMWbHL6.js","./Cell.CYBwEWH5.css","./DeHkXimq.js","./BNhB6NcQ.js","./BkeU_HAH.js","./CFgyk-dW.js","./BTGvCRQH.js","./BQQOEPN4.js","./BLe4UTYD.js","./DKtVUO_j.js","./COktFmkf.js","./Pagination.D7qN7qzC.css","./B4uVmeYG.js","./COwQxOku.js","./C4eCLVVw.js","./DhnetN0h.js","./BUcNRxMi.js","./BdIpmjdG.js","./ByzT15Y-.js","./DzMAdbS0.js","./QHUCxglU.js","./Pagination.Sdu4RSaT.css","./BhhdTVvF.js","./BMD-JIxU.js","./MenuItem.C7h59s4s.css","./COUq3J8q.js","./C5mABW8R.js","./Divider.DqtSqZhb.css","./C6cwFr3C.js","./Menu.CQ8GNWeI.css","./CNqbIxb7.js","./CsDrjaMN.js","./DivDataCell.1yCNpUg3.css","./DEj7mPxe.js","./UserIcon.JKLzA6N5.css","./CigpOy_T.js","./PYX8IZJE.js","./Badge.D0-UrqG9.css","./CINLm5KA.js","./Cy50pBgZ.js","./links.C8uCzV-l.css","./BDH4PFIz.js","./Tabs.DaLSLYpn.css","./uUEzSIs0.js","./vKaAFL5T.js","./B00EKCmm.js","./DQ9lOBun.js","./eSDe9FnP.js","./BThhIoag.js","./CF0GO8gh.js","./Gr6cVSxP.js","./DeleteModal.SEMJ_gSK.css","./B_7Ene6-.js","./index.BSNjFO1V.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as Ge,bL as k,r as c,d0 as Be,c$ as He,hb as qe,g6 as We,dS as Je,hc as Qe,fC as Ze,at as Xe,cG as Ye,av as b,az as Ke,hu as et,ht as tt,hC as ot,hs as at,h6 as nt,M as lt,u as st,N as rt,g as I,d4 as it,i5 as J,L as ut,l as dt,a_ as ct,h$ as mt,H as _t,cZ as pt,O as ft,o as a,c as r,b as p,w as d,P as e,U as i,R as ve,V as Q,W as Z,d as T,t as X,S as w,a as m,T as we,a8 as yt,al as v,am as j,cd as vt,fG as Y,Q as O,dQ as ge,hB as he,Z as g,a5 as h,$ as wt,a2 as gt,dt as ht,p as xt,e as kt,_ as It}from"./nEPQs079.js";import{_ as bt}from"./BMD-JIxU.js";import{_ as Vt}from"./COUq3J8q.js";import{_ as Rt}from"./C6cwFr3C.js";import{_ as Ct}from"./CNqbIxb7.js";import{a as Dt}from"./vKaAFL5T.js";import{a as Et}from"./DhcNqbF_.js";import{u as jt}from"./D8Zaht4D.js";import{C as St}from"./C3R8onno.js";import{j as xe,e as zt,d as At}from"./DAFLhYLz.js";import{i as $t}from"./BNDnQ_SZ.js";import{_ as Lt}from"./Be456SY3.js";import{S as Pt}from"./DhnetN0h.js";import{_ as Nt}from"./BGiMKGQu.js";import"./C5mABW8R.js";import"./-Hb63wRq.js";import"./BQDKbNwe.js";import"./B4uVmeYG.js";import"./C4eCLVVw.js";const Mt=g(()=>h(()=>import("./DwvYIORx.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(l=>l.default||l)),Tt=g(()=>h(()=>import("./CAANIJCe.js"),__vite__mapDeps([3,1,2,4,5,6]),import.meta.url).then(l=>l.default||l)),Ot=g(()=>h(()=>import("./gBj2Viq1.js"),__vite__mapDeps([7,1,2,8,9,10,4,11,12,5,13]),import.meta.url).then(l=>l.default||l)),Ft=g(()=>h(()=>import("./Dj2YYI3r.js"),__vite__mapDeps([14,1,2,4,12,15]),import.meta.url).then(l=>l.default||l)),Ut=g(()=>h(()=>import("./BVVlkhGF.js"),__vite__mapDeps([16,1,2,17,5,18]),import.meta.url).then(l=>l.default||l)),Gt=g(()=>h(()=>import("./DeHkXimq.js"),__vite__mapDeps([19,8,9,1,2,10,4,11,12]),import.meta.url).then(l=>l.default||l)),Bt=g(()=>h(()=>import("./BNhB6NcQ.js"),__vite__mapDeps([20,21,1,2,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]),import.meta.url).then(l=>l.default||l)),Ht=g(()=>h(()=>import("./BhhdTVvF.js"),__vite__mapDeps([39,1,2,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,34,35,24,27,26,36,37,57,58,59,9,8,10,4,11,12,60,61,62,63,64,65,66,67,68,69,32,31,70]),import.meta.url).then(l=>l.default||l)),ke=l=>(xt("data-v-6ea186a5"),l=l(),kt(),l),qt={class:"flex items-center gap-2"},Wt={class:"flex items-center gap-2"},Jt={key:0,class:"flex flex-col h-full"},Qt={class:"nc-gallery-container-skeleton grid gap-3 p-3"},Zt={key:1,class:"nc-gallery-container grid gap-3 p-3"},Xt=ke(()=>m("a",null,[m("div",null,[m("div")])],-1)),Yt={class:"z-10 arrow"},Kt={class:"z-10 arrow"},eo={key:1,class:"h-52 w-full !flex flex-row !border-b-1 !border-gray-200 items-center justify-center"},to=ke(()=>m("img",{class:"object-contain w-[48px] h-[48px]",src:Lt},null,-1)),oo=[to],ao={class:"flex flex-col gap-3 !children:pointer-events-none"},no={key:0,class:"nc-card-display-value-wrapper"},lo={class:"flex flex-col rounded-lg w-full"},so={class:"flex flex-row w-full justify-start"},ro={class:"nc-card-col-header w-full !children:text-gray-500"},io={key:0,class:"flex flex-row w-full text-gray-800 items-center justify-start min-h-7 py-1"},uo={key:1,class:"flex flex-row w-full h-7 pl-1 items-center justify-start"},co={class:"flex items-center gap-2"},mo=Ge({__name:"Gallery",setup(l){const f=k(Be,c()),S=k(He,c()),F=k(qe),z=k(We),V=k(Qe,Je()),U=k(Ze,c(!1)),{isViewDataLoading:A}=Xe(Ye()),{isSqlView:K,xWhere:Ie}=Dt(),R=c(!1),$=c(),ee=c(),{loadData:te,paginationData:G,formattedData:B,loadGalleryData:oe,galleryData:H,changePage:be,deleteRow:Ve,navigateToSiblingRow:ae}=Et(f,S,Ie);b(Ke,c(!1)),b(et,c(!0)),b(tt,c(!1)),b(ot,c(!1)),b(at,c(1));const ne=k(nt,c([])),L=lt(),le=st(),{getPossibleAttachmentSrc:Re}=jt(),{isMobileMode:Ce}=rt(),De=I(()=>ne.value.filter(t=>!St(t))),y=I(()=>{var t,n;return((n=(t=f.value)==null?void 0:t.columns)==null?void 0:n.find(u=>u.pv&&ne.value.includes(u)))??null}),C=I(()=>{var t,n;return(t=f.value)!=null&&t.columnsById?f.value.columnsById[(n=H.value)==null?void 0:n.fk_cover_image_col_id]:{}}),Ee=I(()=>{var n,u;const t=((u=it((n=H.value)==null?void 0:n.meta))==null?void 0:u.fk_cover_image_object_fit)||J.FIT;if(t===J.FIT)return"!object-contain";if(t===J.COVER)return"!object-cover"}),{isUIAllowed:se}=ut(),je=I(()=>se("dataEdit")),re=c(!1),P=I({get:()=>re.value,set:t=>{je.value&&(re.value=t)}}),D=c(null),Se=(t,n)=>{K.value||(t.preventDefault(),n&&(D.value=n))},ie=t=>{var n;if(!((n=C.value)!=null&&n.title)||!t.row[C.value.title])return[];try{const u=typeof t.row[C.value.title]=="string"?JSON.parse(t.row[C.value.title]):t.row[C.value.title];return Array.isArray(u)?u.flat().map(_=>typeof _=="string"?JSON.parse(_):_).filter(_=>_&&!Array.isArray(_)&&typeof _=="object"&&Object.keys(_).length):[]}catch{return[]}},N=(t,n)=>{const u=zt(t.row,f.value.columns);ee.value=n,u&&!U.value?le.push({query:{...L.query,rowId:u}}):($.value=t,R.value=!0)},ue=async(t,n)=>{const u=t.target;u.closest(".arrow")||u.closest(".slick-dots")||N(n)},de=async()=>{var t;N({row:{...At((t=f.value)==null?void 0:t.columns)},oldRow:{},rowMeta:{new:!0}})};V==null||V.on(de),dt(()=>V.off(de));const M=I({get(){return!!L.query.rowId},set(t){t||le.push({query:{...L.query,rowId:void 0}})}}),q=c(!1);return F==null||F.on(async()=>{await oe(),q.value=!0,ct(()=>{q.value=!1})}),z==null||z.on(async t=>{await te({...(t==null?void 0:t.offset)!==void 0?{offset:t.offset}:{}})}),b(mt,z),_t(S,async t=>{A.value=!0;try{(t==null?void 0:t.type)===pt.GALLERY&&(await te(),await oe())}finally{A.value=!1}},{immediate:!0}),(t,n)=>{const u=bt,_=Vt,ze=Rt,Ae=Pt,ce=wt,W=gt,$e=Mt,Le=Nt,me=Tt,_e=Ot,Pe=Ft,Ne=Ut,Me=ht,Te=Gt,Oe=Ct,Fe=Bt,pe=Ht,fe=ft("e");return a(),r(v,null,[p(Oe,{visible:e(P),"onUpdate:visible":n[3]||(n[3]=o=>O(P)?P.value=o:null),trigger:e(K)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},{overlay:d(()=>[p(ze,{onClick:n[2]||(n[2]=o=>P.value=!1)},{default:d(()=>{var o;return[e(D)?(a(),i(u,{key:0,onClick:n[0]||(n[0]=x=>N(e(D).row))},{default:d(()=>[ve((a(),r("div",qt,[(a(),i(Q(("iconMap"in t?t.iconMap:e(Z)).expand),{class:"flex"})),T(" "+X(t.$t("activity.expandRecord")),1)])),[[fe,["a:row:expand-record"]]])]),_:1})):w("",!0),p(_),((o=e(D))==null?void 0:o.index)!==void 0?(a(),i(u,{key:1,class:"!text-red-600 !hover:bg-red-50",onClick:n[1]||(n[1]=x=>e(Ve)(e(D).index))},{default:d(()=>[ve((a(),r("div",Wt,[(a(),i(Q(("iconMap"in t?t.iconMap:e(Z)).delete),{class:"flex"})),T(" "+X(t.$t("activity.deleteRow")),1)])),[[fe,["a:row:delete"]]])]),_:1})):w("",!0)]}),_:1})]),default:d(()=>[m("div",{class:we(["flex flex-col w-full nc-gallery nc-scrollbar-md bg-gray-50",{"!overflow-hidden":e(A)}]),"data-testid":"nc-gallery-wrapper",style:yt({height:e(Ce)?"calc(100% - var(--topbar-height))":"calc(100% - var(--topbar-height) + 0.6rem)"})},[e(A)?(a(),r("div",Jt,[m("div",Qt,[(a(!0),r(v,null,j(Array(20),o=>(a(),i(Ae,{key:o,class:"!min-w-60.5 !h-96 !rounded-md overflow-hidden"}))),128))])])):(a(),r("div",Zt,[(a(!0),r(v,null,j(e(B),(o,x)=>(a(),r("div",{key:`record-${o.row.id}`},[p(Te,{row:o},{default:d(()=>{var ye;return[p(Me,{class:"!rounded-xl h-full border-gray-200 border-1 group overflow-hidden break-all max-w-[450px] cursor-pointer","body-style":{padding:"16px !important"},"data-testid":`nc-gallery-card-${o.row.id}`,onClick:s=>ue(s,o),onContextmenu:s=>Se(s,{row:o,index:x})},vt({default:d(()=>[m("div",ao,[e(y)?(a(),r("h2",no,[("isRowEmpty"in t?t.isRowEmpty:e(xe))(o,e(y))?(a(),r(v,{key:1},[T(" - ")],64)):(a(),r(v,{key:0},[e(Y)(e(y))?(a(),i(me,{key:0,modelValue:o.row[e(y).title],"onUpdate:modelValue":s=>o.row[e(y).title]=s,class:"!text-brand-500",column:e(y),row:o},null,8,["modelValue","onUpdate:modelValue","column","row"])):(a(),i(_e,{key:1,modelValue:o.row[e(y).title],"onUpdate:modelValue":s=>o.row[e(y).title]=s,class:"!text-brand-500",column:e(y),"edit-enabled":!1,"read-only":!0},null,8,["modelValue","onUpdate:modelValue","column"]))],64))])):w("",!0),(a(!0),r(v,null,j(e(De),s=>(a(),r("div",{key:`record-${o.row.id}-${s.id}`},[m("div",lo,[m("div",so,[m("div",ro,[e(Y)(s)?(a(),i(Pe,{key:0,column:s,"hide-menu":!0},null,8,["column"])):(a(),i(Ne,{key:1,column:s,"hide-menu":!0},null,8,["column"]))])]),("isRowEmpty"in t?t.isRowEmpty:e(xe))(o,s)?(a(),r("div",uo,"-")):(a(),r("div",io,[e(Y)(s)?(a(),i(me,{key:0,modelValue:o.row[s.title],"onUpdate:modelValue":E=>o.row[s.title]=E,column:s,row:o,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column","row"])):(a(),i(_e,{key:1,modelValue:o.row[s.title],"onUpdate:modelValue":E=>o.row[s.title]=E,column:s,"edit-enabled":!1,"read-only":!0,class:"!text-gray-800"},null,8,["modelValue","onUpdate:modelValue","column"]))]))])]))),128))])]),_:2},[(ye=e(H))!=null&&ye.fk_cover_image_col_id?{name:"cover",fn:d(()=>[!e(q)&&ie(o).length?(a(),i(Le,{key:0,class:"gallery-carousel !border-b-1 !border-gray-200 min-h-52",arrows:""},{customPaging:d(()=>[Xt]),prevArrow:d(()=>[m("div",Yt,[p(W,{type:"secondary",size:"xsmall",class:"!absolute !left-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:d(()=>[p(ce,{icon:"arrowLeft",class:"text-gray-700 w-4 h-4"})]),_:1})])]),nextArrow:d(()=>[m("div",Kt,[p(W,{type:"secondary",size:"xsmall",class:"!absolute !right-1.5 !bottom-[-90px] !opacity-0 !group-hover:opacity-100 !rounded-lg cursor-pointer"},{default:d(()=>[p(ce,{icon:"arrowRight",class:"text-gray-700 w-4 h-4"})]),_:1})])]),default:d(()=>[(a(!0),r(v,null,j(ie(o),(s,E)=>(a(),r(v,null,[("isImage"in t?t.isImage:e($t))(s.title,s.mimetype??s.type)?(a(),i($e,{key:`carousel-${o.row.id}-${E}`,class:we(["h-52",[`${e(Ee)}`]]),srcs:e(Re)(s),onClick:Ue=>ue(Ue,o)},null,8,["class","srcs","onClick"])):w("",!0)],64))),256))]),_:2},1024)):(a(),r("div",eo,oo))]),key:"0"}:void 0]),1032,["data-testid","onClick","onContextmenu"])]}),_:2},1032,["row"])]))),128)),e(B).length<=4?(a(!0),r(v,{key:0},j(Array(8-e(B).length),o=>(a(),r("div",{key:o,class:"nc-empty-card"}))),128)):w("",!0)]))],6)]),_:1},8,["visible","trigger"]),p(Fe,{"pagination-data":e(G),"onUpdate:paginationData":n[4]||(n[4]=o=>O(G)?G.value=o:null),"align-count-on-right":"","show-api-timing":"","change-page":e(be),class:""},{"add-record":d(()=>[e(se)("dataInsert")?(a(),i(W,{key:0,size:"xs",type:"secondary",class:"ml-2",onClick:e(V).trigger},{default:d(()=>[m("div",co,[(a(),i(Q(("iconMap"in t?t.iconMap:e(Z)).plus),{class:""})),T(" "+X(t.$t("activity.newRecord")),1)])]),_:1},8,["onClick"])):w("",!0)]),_:1},8,["pagination-data","change-page"]),(a(),i(ge,null,{default:d(()=>[e($)&&e(R)?(a(),i(pe,{key:0,modelValue:e(R),"onUpdate:modelValue":n[5]||(n[5]=o=>O(R)?R.value=o:null),row:e($),"load-row":!e(U),state:e(ee),meta:e(f),view:e(S)},null,8,["modelValue","row","load-row","state","meta","view"])):w("",!0)]),_:1})),(a(),i(ge,null,{default:d(()=>{var o;return[e(M)&&((o=e(f))!=null&&o.id)?(a(),i(pe,{key:0,modelValue:e(M),"onUpdate:modelValue":n[6]||(n[6]=x=>O(M)?M.value=x:null),row:e($)??{row:{},oldRow:{},rowMeta:{}},meta:e(f),"load-row":!e(U),"row-id":e(L).query.rowId,view:e(S),"show-next-prev-icons":"","expand-form":N,onNext:n[7]||(n[7]=x=>e(ae)(("NavigateDir"in t?t.NavigateDir:e(he)).NEXT)),onPrev:n[8]||(n[8]=x=>e(ae)(("NavigateDir"in t?t.NavigateDir:e(he)).PREV))},null,8,["modelValue","row","meta","load-row","row-id","view"])):w("",!0)]}),_:1}))],64)}}}),zo=It(mo,[["__scopeId","data-v-6ea186a5"]]);export{zo as default};
