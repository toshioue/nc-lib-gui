const __vite__fileDeps=["./DL47xb_5.js","./DFT4Rrrq.js","./DKhUGBot.js","./entry.B8GgT5QA.css","./CRNALu61.js","./C9Sjn86N.js","./lyxpGZoZ.js","./PlainCell.BhW7NMdh.css","./CmSnWlOw.js","./RecordCard.BkJXt930.css","./XWOJXlJc.js","./DrSobHNn.js","./DGy9VVU7.js","./DO1hNe_j.js","./boyBAVNN.js","./Ce4Hnuew.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as et,r as S,L as tt,bL as Te,d0 as ot,g as oe,gI as at,h5 as nt,ce as n,d2 as lt,O as rt,P as a,o as _,c as x,a as B,al as V,am as K,t as G,T as A,U as W,w as T,b as J,d as st,V as ze,W as Oe,S as q,R as it,a8 as ut,Y as dt,cd as ct,cU as Ye,Z as fe,a5 as ve,a2 as mt,A as ft,_ as vt}from"./DKhUGBot.js";import{_ as wt}from"./Cx8swDhG.js";import{_ as pt}from"./CyGutrdy.js";import{_ as _t}from"./B5mlyM8k.js";import{a as ht}from"./6zAE39KB.js";import{a as yt}from"./BMlI7u7p.js";import{b as He}from"./DZMsOWET.js";import{j as gt,e as ae}from"./Ce4Hnuew.js";import"./DGy9VVU7.js";import"./D-d1Vlq3.js";const Mt=fe(()=>ve(()=>import("./DL47xb_5.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(C=>C.default||C)),Dt=fe(()=>ve(()=>import("./CRNALu61.js"),__vite__mapDeps([4,2,3,5,1,6,7]),import.meta.url).then(C=>C.default||C)),kt=fe(()=>ve(()=>import("./CmSnWlOw.js"),__vite__mapDeps([8,2,3,9]),import.meta.url).then(C=>C.default||C)),Yt=fe(()=>ve(()=>import("./XWOJXlJc.js"),__vite__mapDeps([10,11,12,2,3,13,6,14,15]),import.meta.url).then(C=>C.default||C)),xt={key:0,class:"h-full prevent-select relative","data-testid":"nc-calendar-month-view"},bt=["onClick","onDblclick"],Rt={key:0,class:"flex justify-between p-1"},St={class:"flex items-center gap-1"},Et={class:"ml-1"},Ct={key:1,class:"leading-3 p-3"},It={class:"text-xs px-1"},Tt={class:"absolute inset-0 pointer-events-none mt-8 pb-7.5","data-testid":"nc-calendar-month-record-container"},zt=["data-testid","data-unique-id","onMouseover","onMousedown"],Ot={class:"text-xs font-medium text-gray-400"},Ht=et({__name:"MonthView",emits:["newRecord","expandRecord"],setup(C,{emit:Le}){const ne=Le,{selectedDate:le,selectedMonth:we,formattedData:F,formattedSideBarData:xe,calDataType:pe,sideBarFilterOption:Pe,displayField:Be,calendarRange:P,viewMetaProperties:Ve,showSideMenu:$e,updateRowProperty:_e}=ht(),{$e:be}=ft(),he=S(!0),{isUIAllowed:z}=tt(),Q=Te(ot,S()),O=oe(()=>{var e;return(e=Ve.value)!=null&&e.hide_weekend?5:7}),Ae=oe(()=>{let e=[];return he.value?e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]:e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],O.value===5&&(e=e.filter(r=>r!=="Sat"&&r!=="Sun")),e}),re=S(),{width:Fe,height:Ne}=at(re),Ze=e=>e.month()===we.value.month(),$=S(null),N=S(null),se=S(!1),U=S(!1),M=S(),ye=S(),ge=S(),ie=S(null),ue=S(),b=S(),We=Te(nt,S()),{fields:Re}=yt(),qe=oe(()=>Re.value?new Map(Re.value.map(e=>[e.fk_column_id,{underline:e.underline,bold:e.bold,italic:e.italic}])):new Map),Me=e=>qe.value.get(e.id),c=oe(()=>{const e=we.value.startOf("month"),r=we.value.endOf("month"),s=e.startOf("week").add(he.value?0:-1,"day"),i=r.endOf("week").add(he.value?0:-1,"day").diff(s,"day")+1;let g=Math.ceil(i/7);g=Math.max(g,5);const R=[];let h=s;for(let D=0;D<g;D++){const k=[];for(let u=0;u<7;u++)k.push(h),h=h.add(1,"day");R.push(k)}return R}),de=oe(()=>{if(!c.value||!P.value)return[];const e=Fe.value/O.value,r=Ne.value/c.value.length,s=24,y=27,i={};if(!P.value)return[];const g=[];return P.value.forEach(R=>{const h=R.fk_from_col,D=R.fk_to_col;[...F.value].filter(u=>{if(h&&D){const o=u.row[h.title]?n(u.row[h.title]):null,d=u.row[D.title]?n(u.row[D.title]):null;return o&&d&&!d.isBefore(o)}else if(h&&!D)return!!(u.row[h.title]?n(u.row[h.title]):null);return!1}).forEach(u=>{if(!D&&h){const o=n(u.row[h.title]),d=o.format("YYYY-MM-DD");i[d]||(i[d]={overflow:!1,count:0,overflowCount:0}),i[d].count++;const t=u.rowMeta.id??He(),f=c.value.findIndex(E=>E.some(H=>n(H).isSame(o,"day"))),v=(c.value[f]??[]).findIndex(E=>n(E).isSame(o,"day")),l={left:`${v*e}px`,width:`${e}px`};O.value===5&&(v===5||v===6)&&(l.display="none");const Y=i[d].count,m=f*r+y+(Y-1)*(s+4);s*Y+y+12>r?(l.display="none",i[d].overflow=!0,i[d].overflowCount++):l.top=`${m}px`,g.push({...u,rowMeta:{...u.rowMeta,style:l,position:"rounded",range:R,id:t}})}else if(h&&D){const o=n(u.row[h.title]),d=n(u.row[D.title]);let t=o.startOf("week");const f=u.rowMeta.id??He();for(;t.isSameOrBefore(d,"day")&&t.isBefore(c.value[c.value.length-1][6]);){const v=t.endOf("week"),l=t.isBefore(o)?o:t,Y=v.isAfter(d)?d:v;if(Y.isBefore(c.value[0][0])){t=t.add(1,"week");continue}let m=l.clone();for(;m.isSameOrBefore(Y);){const p=m.format("YYYY-MM-DD");i[p]||(i[p]={overflow:!1,count:0,overflowCount:0}),i[p].count++,m=m.add(1,"day")}const w=Math.max(c.value.findIndex(p=>p.findIndex(X=>n(X).isSame(l,"day"))!==-1),0);let E=0;for(let p=0;p<(c.value[w]??[]).length;p++){const X=c.value[w][p],te=n(X).format("YYYY-MM-DD");i[te]||(i[te]={count:0,overflow:!1,overflowCount:0}),E=Math.max(E,i[te].count)}const H=Math.max((c.value[w]??[]).findIndex(p=>n(p).isSame(l,"day")),0),ee=Math.max((c.value[w]??[]).findIndex(p=>n(p).isSame(Y,"day")),0),j={left:`${H*e}px`,width:`${(ee-H+1)*e}px`},ce=w*r+y+Math.max(E-1,0)*(s+4),me=s*Math.max(E,0)+y+12;let L="rounded";const I=c.value[w-1]?n(c.value[w-1][0]).isBefore(o,"month"):!1;if(o.isSame(t,"week")&&d.isSame(v,"week")?L="rounded":o.isSame(l,"week")?I&&d.isSame(v,"week")?L="rounded":L="leftRounded":d.isSame(v,"week")?L="rightRounded":L="none",me>r){j.display="none";for(let p=H;p<=ee;p++){const X=c.value[w];if(!X)continue;const te=X[p],ke=n(te).format("YYYY-MM-DD");i[ke]&&(i[ke].overflow=!0,i[ke].overflowCount++)}}else j.top=`${ce}px`;g.push({...u,rowMeta:{...u.rowMeta,position:L,style:j,range:R,id:f}}),t=t.add(1,"week")}}})}),{records:g,count:i}}),De=(e,r,s)=>{var w,E,H,ee,j,ce,me,L;const{top:y,height:i,width:g,left:R}=re.value.getBoundingClientRect(),h=(e.clientY-y-window.scrollY)/i,D=(e.clientX-R-window.scrollX)/g,k=(E=(w=M.value)==null?void 0:w.rowMeta.range)==null?void 0:E.fk_from_col,u=(ee=(H=M.value)==null?void 0:H.rowMeta.range)==null?void 0:ee.fk_to_col;if(!k)return{newRow:null,updateProperty:[]};const o=Math.floor(h*c.value.length),d=Math.floor(D*O.value);let t=c.value[o]?n(c.value[o][d]):null;if(!t)return{newRow:null,updateProperty:[]};let f=n(M.value.row[k.title]);f.isValid()||(f=n()),t=t.add(f.hour(),"hour").add(f.minute(),"minute").add(f.second(),"second");let v;const l={...M.value,row:{...(j=M.value)==null?void 0:j.row,[k.title]:pe.value===Ye.Date?n(t).format("YYYY-MM-DD HH:mm:ssZ"):n(t).utc().format("YYYY-MM-DD HH:mm:ssZ")}},Y=[k.title];if(u){const I=(ce=M.value)!=null&&ce.row[k.title]?n(M.value.row[k.title]):null,p=(me=M.value)!=null&&me.row[u.title]?n((L=M.value)==null?void 0:L.row[u.title]):null;I&&p?v=n(t).add(p.diff(I,"day"),"day"):I&&!p?v=n(t).endOf("day"):!I&&p?v=n(t).endOf("day"):v=t.clone(),l.row[u.title]=pe.value===Ye.Date?n(v).format("YYYY-MM-DD HH:mm:ssZ"):n(v).utc().format("YYYY-MM-DD HH:mm:ssZ"),Y.push(u.title)}if(M.value.row[k.title]===l.row[k.title]&&!s)return{newRow:null,updatedProperty:[]};if(!l)return{newRow:null,updateProperty:[]};const m=ae(l.row,Q.value.columns);return r?(F.value=[...F.value,l],xe.value=xe.value.filter(I=>ae(I.row,Q.value.columns)!==m)):F.value=F.value.map(I=>ae(I.row,Q.value.columns)===m?l:I),{newRow:l,updateProperty:Y}},Se=e=>{!z("dataEdit")||!M.value||De(e,!1)},Ue=lt((e,r,s)=>{_e(e,r,s)},500),Ee=e=>{var l,Y;if(!z("dataEdit")||!b.value)return;const{top:r,height:s,width:y,left:i}=re.value.getBoundingClientRect(),g=(e.clientY-r-window.scrollY)/s,R=(e.clientX-i-window.scrollX)/y,h=b.value.row[b.value.rowMeta.range.fk_to_col.title],D=b.value.row[b.value.rowMeta.range.fk_from_col.title],k=(l=b.value.rowMeta.range)==null?void 0:l.fk_from_col,u=(Y=b.value.rowMeta.range)==null?void 0:Y.fk_to_col,o=Math.floor(g*c.value.length),d=Math.floor(R*O.value);let t=[],f;if(ue.value==="right"){let m=c.value[o]?n(c.value[o][d]).endOf("day"):null;if(t=[u.title],n(m).isBefore(D)&&(m=n(D).clone().endOf("day")),!m)return;f={...b.value,row:{...b.value.row,[u.title]:n(m).format("YYYY-MM-DD HH:mm:ssZ")}}}else{let m=c.value[o]?n(c.value[o][d]):null;if(t=[k.title],n(m).isAfter(h)&&(m=n(h).clone()),!m)return;f={...b.value,row:{...b.value.row,[k.title]:n(m).format("YYYY-MM-DD HH:mm:ssZ")}}}const v=ae(f.row,Q.value.columns);F.value=F.value.map(m=>ae(m.row,Q.value.columns)===v?f:m),f&&Ue(f,t,!1)},Ce=()=>{se.value=!1,ue.value=void 0,b.value=void 0,document.removeEventListener("mousemove",Ee),document.removeEventListener("mouseup",Ce)},je=(e,r,s)=>{!z("dataEdit")||N.value||(se.value=!0,ue.value=e,b.value=s,document.addEventListener("mousemove",Ee),document.addEventListener("mouseup",Ce))},Ie=e=>{if(clearTimeout(ge.value),!z("dataEdit")||!M.value||!U.value)return;e.preventDefault(),$.value.style.boxShadow="none";const{newRow:r,updateProperty:s}=De(e,!1,!0);document.querySelectorAll(".draggable-record").forEach(i=>{i.style.visibility="",i.style.opacity="100%"}),$.value&&($.value.style.boxShadow="none",U.value=!1,N.value=null,$.value=null),M.value=void 0,_e(r,s,!1),ie.value=null,be("c:calendar:month:drag-record"),document.removeEventListener("mousemove",Se),document.removeEventListener("mouseup",Ie)},Xe=(e,r)=>{if(se.value||!r.rowMeta.id)return;let s=e.target;U.value=!1,ge.value=setTimeout(()=>{if(!z("dataEdit"))return;for(U.value=!0;!s.classList.contains("draggable-record");)s=s.parentElement;document.querySelectorAll(".draggable-record").forEach(g=>{g.getAttribute("data-unique-id").includes(r.rowMeta.id)||(g.style.opacity="30%")}),U.value=!0,$.value=s,N.value=r.rowMeta.id,M.value=r,document.addEventListener("mousemove",Se),document.addEventListener("mouseup",Ie)},200);const y=()=>{clearTimeout(ge.value),document.removeEventListener("mouseup",y),U.value||ne("expandRecord",r)};document.addEventListener("mouseup",y)},Ke=e=>{var s;if(!z("dataEdit"))return;e.preventDefault();const r=(s=e.dataTransfer)==null?void 0:s.getData("text/plain");if(r){const{record:y,isWithoutDates:i}=JSON.parse(r);M.value=y;const{newRow:g,updateProperty:R}=De(e,i);$.value&&($.value.style.boxShadow="none",$.value=null),_e(g,R,!1),be("c:calendar:day:drag-record")}},Ge=e=>{M.value=void 0,N.value=null,b.value=void 0,se.value=!1,ue.value=void 0,ie.value=null,le.value=e},Je=e=>{Pe.value="selectedDate",le.value=e,$e.value=!0},Z=e=>le.value?n(e).isSame(le.value,"day"):!1,Qe=e=>{if(!z("dataEdit")||!P.value)return;const r=P.value[0].fk_from_col;if(!r)return;const s={row:{[r.title]:e.format("YYYY-MM-DD HH:mm:ssZ")}};ne("newRecord",s)};return(e,r)=>{const s=mt,y=wt,i=Mt,g=pt,R=_t,h=Dt,D=kt,k=Yt,u=rt("e");return a(P)?(_(),x("div",xt,[B("div",{class:A(["grid",{"grid-cols-7":a(O)===7,"grid-cols-5":a(O)===5}])},[(_(!0),x(V,null,K(a(Ae),(o,d)=>(_(),x("div",{key:d,class:"text-center bg-gray-50 py-1 border-r-1 last:border-r-0 border-gray-200 font-semibold leading-4 uppercase text-[10px] text-gray-500"},G(o),1))),128))],2),B("div",{ref_key:"calendarGridContainer",ref:re,class:A([{"grid-rows-5":a(c).length===5,"grid-rows-6":a(c).length===6,"grid-rows-7":a(c).length===7},"grid"]),style:{height:"calc(100% - 1.59rem)"},onDrop:Ke},[(_(!0),x(V,null,K(a(c),(o,d)=>(_(),x("div",{key:d,class:A([{"grid-cols-7":a(O)===7,"grid-cols-5":a(O)===5},"grid grow"]),"data-testid":"nc-calendar-month-week"},[(_(!0),x(V,null,K(o,(t,f)=>{var v;return _(),x(V,null,[a(O)!==5||t.get("day")!==0&&t.get("day")!==6?(_(),x("div",{key:`${d}-${f}`,class:A([{"border-brand-500 border-1 !border-r-1 border-b-1":Z(t)||a(ie)&&a(n)(t).isSame(a(ie),"day"),"!text-gray-400":!Ze(t),"!bg-gray-50 !hover:bg-gray-100":t.get("day")===0||t.get("day")===6,"border-t-1":d===0},"text-right relative group last:border-r-0 transition text-sm h-full border-r-1 border-b-1 border-gray-200 font-medium hover:bg-gray-50 text-gray-800 bg-white"]),"data-testid":"nc-calendar-month-day",onClick:l=>Ge(t),onDblclick:l=>Qe(t)},[a(z)("dataEdit")?(_(),x("div",Rt,[B("span",{class:A([{block:!Z(t),hidden:Z(t)},"group-hover:hidden"])},null,2),a(P).length>1?(_(),W(R,{key:0,"auto-close":""},{overlay:T(()=>[J(g,{class:"w-64"},{default:T(()=>[J(y,null,{default:T(()=>[st(" Select date field to add ")]),_:1}),(_(!0),x(V,null,K(a(P),(l,Y)=>(_(),W(y,{key:Y,class:"text-gray-800 font-semibold text-sm",onClick:()=>{const m={row:{[l.fk_from_col.title]:a(n)(t).format("YYYY-MM-DD HH:mm:ssZ")}};ne("newRecord",m)}},{default:T(()=>[B("div",St,[J(i,{"column-meta":l.fk_from_col},null,8,["column-meta"]),B("span",Et,G(l.fk_from_col.title),1)])]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),default:T(()=>[J(s,{class:A([{"!block":Z(t),"!hidden":!Z(t)},"!group-hover:block rounded"]),size:"small",type:"secondary"},{default:T(()=>[(_(),W(ze(("iconMap"in e?e.iconMap:a(Oe)).plus),{class:"h-4 w-4"}))]),_:2},1032,["class"])]),_:2},1024)):(_(),W(s,{key:1,class:A([{"!block":Z(t),"!hidden":!Z(t)},"!group-hover:block !w-6 !h-6 !rounded"]),size:"xsmall",type:"secondary",onClick:()=>{const l={row:{[a(P)[0].fk_from_col.title]:t.format("YYYY-MM-DD HH:mm:ssZ")}};ne("newRecord",l)}},{default:T(()=>[(_(),W(ze(("iconMap"in e?e.iconMap:a(Oe)).plus)))]),_:2},1032,["class","onClick"])),B("span",{class:A([{"bg-brand-50 text-brand-500 !font-bold":t.isSame(a(n)(),"date")},"px-1.3 py-1 text-sm leading-3 font-medium rounded-lg"])},G(t.format("DD")),3)])):q("",!0),a(z)("dataEdit")?q("",!0):(_(),x("div",Ct,G(a(n)(t).format("DD")),1)),a(de).count[a(n)(t).format("YYYY-MM-DD")]&&((v=a(de).count[a(n)(t).format("YYYY-MM-DD")])!=null&&v.overflow)&&!a(N)?it((_(),W(s,{key:2,class:"!absolute bottom-1 right-1 text-center min-w-4.5 mx-auto z-3 text-gray-500",size:"xxsmall",type:"secondary",onClick:l=>Je(t)},{default:T(()=>{var l;return[B("span",It," + "+G((l=a(de).count[a(n)(t).format("YYYY-MM-DD")])==null?void 0:l.overflowCount),1)]}),_:2},1032,["onClick"])),[[u,"['c:calendar:month-view-more']"]]):q("",!0)],42,bt)):q("",!0)],64)}),256))],2))),128))],34),B("div",Tt,[(_(!0),x(V,null,K(a(de).records,(o,d)=>{var t;return _(),x(V,{key:d},[((t=o.rowMeta.style)==null?void 0:t.display)!=="none"?(_(),x("div",{key:0,"data-testid":`nc-calendar-month-record-${o.row[a(Be).title]}`,"data-unique-id":o.rowMeta.id,style:ut({...o.rowMeta.style,zIndex:o.rowMeta.id===a(N)?100:0}),class:"absolute group draggable-record transition cursor-pointer pointer-events-auto",onMouseleave:r[0]||(r[0]=f=>ye.value=null),onMouseover:f=>ye.value=o.rowMeta.id,onMousedown:dt(f=>Xe(f,o),["stop"])},[J(k,{row:o},{default:T(()=>{var f,v,l,Y,m;return[J(D,{hover:a(ye)===o.rowMeta.id||o.rowMeta.id===a(N),position:o.rowMeta.position,record:o,resize:!!((f=o.rowMeta.range)!=null&&f.fk_to_col)&&a(z)("dataEdit"),selected:((l=(v=a(M))==null?void 0:v.rowMeta)==null?void 0:l.id)===o.rowMeta.id||((m=(Y=a(b))==null?void 0:Y.rowMeta)==null?void 0:m.id)===o.rowMeta.id,onResizeStart:je},ct({default:T(()=>[(_(!0),x(V,null,K(a(We),(w,E)=>(_(),x(V,{key:E},[("isRowEmpty"in e?e.isRowEmpty:a(gt))(o,w)?q("",!0):(_(),W(h,{key:0,modelValue:o.row[w.title],"onUpdate:modelValue":H=>o.row[w.title]=H,class:"text-xs",bold:Me(w).bold,column:w,italic:Me(w).italic,underline:Me(w).underline},null,8,["modelValue","onUpdate:modelValue","bold","column","italic","underline"]))],64))),128))]),_:2},[a(pe)===a(Ye).DateTime?{name:"time",fn:T(()=>{var w;return[B("span",Ot,G(a(n)(o.row[(w=o.rowMeta.range)==null?void 0:w.fk_from_col.title]).format("h:mma").slice(0,-1)),1)]}),key:"0"}:void 0]),1032,["hover","position","record","resize","selected"])]}),_:2},1032,["row"])],44,zt)):q("",!0)],64)}),128))])])):q("",!0)}}}),qt=vt(Ht,[["__scopeId","data-v-4433b108"]]);export{qt as default};
