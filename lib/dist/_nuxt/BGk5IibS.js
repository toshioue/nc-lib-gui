const __vite__fileDeps=["./CPU0bev_.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./C2piJvdv.js","./BUximLW1.js","./LockType.C1lKbPeu.css","./CxrpBWdD.js","./DA0VIM8P.js","./C3jLTHF4.js","./BYINaHrJ.js","./dfem9Uc_.js","./BCJFTkwv.js","./vll-Pnjv.js","./D9tFZoTQ.js","./DyDFI6NE.js","./BQuyMdA-.js","./BQQOEPN4.js","./DKN1hQ6S.js","./B5RRVMt5.js","./DGj1ycqW.js","./DNgdBwTe.js","./eX8_g88K.js","./0azk-b-q.js","./BO2leIU3.js","./CmWcz5yS.js","./CB1aB6F1.js","./QuickImport.CAFUap-4.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as se,cV as Le,ab as ve,cO as _e,cX as Ie,r as O,ar as Me,f as B,D as Te,a$ as Se,o as s,Q as _,w as o,a as y,b as a,t as r,N as e,a7 as De,aJ as Re,W as Ee,d as f,O as fe,ah as G,ai as ne,d5 as we,Z as ye,y as ie,_ as be,cS as ke,ap as je,c as m,R as h,J as Oe,bL as ze,dz as Pe,ag as Ue,ax as Ne,cL as Ae,dA as C,aq as Fe,M as Be,ao as L,d4 as T,P as F,aF as Ge,at as pe,S as qe,T as Qe,U as Je,Y as Ke,$ as Xe,aL as We,a9 as Ye,X as le,a4 as re}from"./DZZ6t_j4.js";import{_ as Ze}from"./Bdv7ru7D.js";import{F as me}from"./BYINaHrJ.js";import{_ as He}from"./DGj1ycqW.js";import"./DKN1hQ6S.js";import{_ as et}from"./dfem9Uc_.js";import{_ as tt}from"./BqKQ8afS.js";import{_ as ot}from"./TJfB7GlU.js";import{_ as at}from"./sz1d3zjm.js";import{_ as st}from"./C8YpY8qO.js";import{_ as nt}from"./BLgccLvp.js";const it={class:"flex flex-row items-center gap-x-2"},lt={class:"text-gray-900 font-semibold"},rt={class:"mt-1"},dt={class:"flex flex-row justify-end gap-x-2 mt-5"},ct=se({__name:"ViewDescriptionUpdate",props:{modelValue:{type:Boolean},view:{},sourceId:{}},emits:["update:modelValue","updated"],setup(l,{emit:z}){const u=Le(l,["view"]),b=z,{$e:x,$api:I}=ie(),v=ve(u,"modelValue",b),{loadViews:P}=_e(),{addUndo:S,defineProjectScope:U}=Ie(),n=O(),w=O(!1),N=me.useForm,c=Me({description:""}),A=B(()=>({description:[{validator:(d,i)=>new Promise((V,Q)=>{V()})}]})),{validateInfos:q}=N(c,A);Te(()=>{var d;(d=l.view)!=null&&d.description&&(c.description=`${l.view.description}`),Se(()=>{var V;const i=(V=n.value)==null?void 0:V.$el;i&&(i.setSelectionRange(0,c.description.length),i.focus())})},{flush:"post"});const D=async(d=!1)=>{if(l.view){c.description&&(c.description=c.description.trim()),w.value=!0;try{await I.dbView.update(l.view.id,{description:c.description}),v.value=!1,d||S({redo:{fn:i=>{c.description=i,D(!0,!0)},args:[c.description]},undo:{fn:i=>{c.description=i,D(!0,!0)},args:[l.view.description]},scope:U({view:l.view})}),await P({tableId:l.view.fk_model_id,ignoreLoading:!0,force:!0}),x("a:view:description:update"),v.value=!1}catch(i){G.error(await ne(i))}w.value=!1}};return(d,i)=>{const V=we,Q=He,H=et,J=me,R=ye,ee=Ze;return s(),_(ee,{visible:e(v),"onUpdate:visible":i[4]||(i[4]=$=>fe(v)?v.value=$:null),size:"small","show-separator":!1},{header:o(()=>{var $;return[y("div",it,[a(V,{meta:d.view,class:"mt-0.5 !text-2xl"},null,8,["meta"]),y("span",lt,r(($=d.view)==null?void 0:$.title),1)])]}),default:o(()=>{var $,E,K,X;return[y("div",rt,[a(J,{layout:"vertical",model:e(c),name:"create-new-table-form"},{default:o(()=>[a(H,De({label:d.$t("labels.description")},e(q).description),{default:o(()=>[a(Q,{ref_key:"inputEl",ref:n,value:e(c).description,"onUpdate:value":i[0]||(i[0]=W=>e(c).description=W),class:"nc-input-sm !py-2 nc-text-area !text-gray-800 nc-input-shadow","hide-details":"",size:"small",placeholder:d.$t("msg.info.enterTableDescription"),onKeydown:i[1]||(i[1]=Re(Ee(()=>D(),["exact"]),["enter"]))},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1},8,["model"]),y("div",dt,[a(R,{type:"secondary",size:"small",onClick:i[2]||(i[2]=W=>v.value=!1)},{default:o(()=>[f(r(d.$t("general.cancel")),1)]),_:1}),a(R,{key:"submit",type:"primary",size:"small",disabled:((E=($=e(q))==null?void 0:$.description)==null?void 0:E.validateStatus)==="error"||((K=e(c).description)==null?void 0:K.trim())===((X=d.view)==null?void 0:X.description),loading:e(w),onClick:i[3]||(i[3]=()=>D())},{default:o(()=>[f(r(d.$t("general.save")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),Ut=be(ct,[["__scopeId","data-v-b1252ebc"]]),ut={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700"},pt={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-3",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},mt={key:0},vt={key:1},Nt=se({__name:"ViewDelete",props:{modelValue:{type:Boolean},view:{}},emits:["update:modelValue","deleted"],setup(l,{emit:z}){const u=l,b=z,{refreshCommandPalette:x}=ke(),{view:I}=u,v=ve(u,"modelValue",b),{api:P}=je(),{$e:S}=ie();async function U(){if(u.view)try{await P.dbView.delete(u.view.id),v.value=!1,b("deleted"),S("a:view:delete",{view:u.view.type})}catch(n){G.error(await ne(n))}finally{x()}}return(n,w)=>{const N=we,c=tt;return s(),_(c,{visible:e(v),"onUpdate:visible":w[0]||(w[0]=A=>fe(v)?v.value=A:null),"entity-name":n.$t("objects.view"),"on-delete":U},{"entity-preview":o(()=>[e(I)?(s(),m("div",ut,[a(N,{meta:u.view,class:"nc-view-icon w-4 min-h-4"},null,8,["meta"]),y("div",pt,[e(I).is_default?(s(),m("span",mt,r(n.$t("labels.defaultView")),1)):(s(),m("span",vt,r(e(I).title),1))])])):h("",!0)]),_:1},8,["visible","entity-name"])}}}),_t=le(()=>re(()=>import("./CPU0bev_.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(l=>l.default||l)),ft=le(()=>re(()=>import("./BUximLW1.js"),__vite__mapDeps([4,1,2,5]),import.meta.url).then(l=>l.default||l)),wt=le(()=>re(()=>import("./CxrpBWdD.js").then(l=>l.Q),__vite__mapDeps([6,1,2,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url).then(l=>l.default||l)),yt={class:"flex text-xs font-bold text-gray-500 ml-1"},bt={class:"nc-base-menu-item group"},kt={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},$t={class:"nc-base-menu-item group nc-view-context-download-option"},gt={class:"flex flex-row items-center gap-x-3"},Ct={class:"nc-base-menu-item flex !flex-shrink group !py-1 !px-1 rounded-md bg-brand-50"},xt={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},Vt={key:1},ht=se({__name:"ViewActionMenu",props:{view:{},table:{},inSidebar:{type:Boolean,default:!1}},emits:["rename","closeModal","delete","descriptionUpdate"],setup(l,{emit:z}){const u=l,b=z,{isUIAllowed:x,isDataReadOnly:I}=Oe(),v=ze(Pe,O(!1)),{$api:P,$e:S}=ie(),{t:U}=Ue(),n=B(()=>u.view),w=B(()=>u.table),{loadViews:N,navigateToView:c,duplicateView:A}=_e(),{base:q}=Ne(Ae()),{refreshCommandPalette:D}=ke(),d=B(()=>{var t;return((t=n.value)==null?void 0:t.lock_type)||C.Collaborative}),i=O(!1),V=B(()=>{var t;return(t=w.value)==null?void 0:t.source_id}),Q=()=>{b("rename")},H=()=>{b("descriptionUpdate")},J=["csv","excel"],R=J.reduce((t,p)=>(t[p]=O(!1),t),{}),ee=t=>{d.value!==C.Locked&&(b("closeModal"),t.value=!0)};async function $(t){if(S("a:grid:lockmenu",{lockType:t,sidebar:u.inSidebar}),!!n.value){if(t==="personal")return G.info(U("msg.toast.futureRelease"));try{n.value.lock_type=t,await P.dbView.update(n.value.id,{lock_type:t}),G.success(`Successfully Switched to ${t} view`)}catch(p){G.error(await ne(p))}b("closeModal")}}const E=O(!1);async function K(){E.value=!0;const t=await A(n.value);D(),await N({force:!0,tableId:w.value.id}),t&&(c({view:t,tableId:w.value.id,baseId:q.value.id,hardReload:t.type===T.FORM}),S("a:view:create",{view:t.type,sidebar:!0})),E.value=!1,b("closeModal")}const{copy:X}=Fe(),W=async()=>{await X(n.value.id),i.value=!0},$e=async()=>{b("delete")};return(t,p)=>{const g=Ke,ge=ye,te=Xe,Y=ot,M=at,Ce=We,oe=st,xe=_t,ae=ft,de=Ye,Ve=wt,he=nt,Z=Be("e");return e(n)?(s(),_(he,{key:0,"data-testid":`view-sidebar-view-actions-${e(n).alias||e(n).title}`,class:"!min-w-70","data-id":"toolbar-actions"},{default:o(()=>{var ce,ue;return[a(te,null,{title:o(()=>[f(r(t.$t("labels.clickToCopyViewID")),1)]),default:o(()=>{var k;return[y("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:W},[y("div",yt,r(t.$t("labels.viewIdColon",{viewId:(k=e(n))==null?void 0:k.id})),1),a(ge,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(i)?(s(),_(g,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(s(),_(g,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),!((ce=e(n))!=null&&ce.is_default)&&e(x)("viewCreateOrEdit")?(s(),m(L,{key:0},[a(Y),t.inSidebar?(s(),m(L,{key:0},[e(d)!==e(C).Locked?(s(),_(M,{key:0,onClick:Q},{default:o(()=>[a(g,{icon:"rename"}),f(" "+r(t.$t("general.renameEntity",{entity:e(n).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})):(s(),_(te,{key:1},{title:o(()=>[f(r(t.$t("msg.info.disabledAsViewLocked")),1)]),default:o(()=>[a(M,{class:"!cursor-not-allowed !text-gray-400"},{default:o(()=>[a(g,{icon:"rename"}),f(" "+r(t.$t("general.renameEntity",{entity:e(n).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})]),_:1})),F(a(M,{onClick:H},{default:o(()=>[a(g,{icon:"ncAlignLeft"}),f(" "+r(t.$t("general.edit"))+" "+r(t.$t("labels.description")),1)]),_:1},512),[[Ge,e(d)!==e(C).Locked]])],64)):h("",!0),a(M,{onClick:K},{default:o(()=>[e(E)?(s(),_(Ce,{key:0,size:"regular"})):(s(),_(g,{key:1,class:"nc-view-copy-icon",icon:"duplicate"})),f(" "+r(t.$t("general.duplicateEntity",{entity:e(n).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})],64)):h("",!0),e(n).type!==e(T).FORM?(s(),m(L,{key:1},[a(Y),e(x)("csvTableImport")&&!e(v)&&!e(I)?(s(),_(oe,{key:"upload"},{title:o(()=>[F((s(),m("div",bt,[a(g,{icon:"upload"}),f(" "+r(t.$t("general.upload")),1)])),[[Z,["c:navdraw:preview-as",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>p[2]||(p[2]=[])),default:o(()=>[y("div",kt,r(t.$t("activity.uploadData")),1),(s(!0),m(L,null,pe(e(R),(k,j)=>(s(),m(L,null,[e(x)(`${j}TableImport`)&&!e(v)?(s(),_(M,{key:j,onClick:Lt=>ee(k)},{default:o(()=>[F((s(),m("div",{class:qe([{disabled:e(d)===e(C).Locked},"nc-base-menu-item"])},[(s(),_(Qe(("iconMap"in t?t.iconMap:e(Je)).cloudUpload))),f(" "+r(`${t.$t("general.upload")} ${j.toUpperCase()}`),1)],2)),[[Z,[`a:upload:${j}`,{sidebar:u.inSidebar}]]])]),_:2},1032,["onClick"])):h("",!0)],64))),256))]),_:1})):h("",!0),a(oe,{key:"download"},{title:o(()=>[F((s(),m("div",$t,[a(g,{icon:"download"}),f(" "+r(t.$t("general.download")),1)])),[[Z,["c:download",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>p[3]||(p[3]=[])),default:o(()=>[a(xe)]),_:1})],64)):h("",!0),e(x)("viewCreateOrEdit")?(s(),m(L,{key:2},[a(Y),a(oe,{key:"lock-type",class:"scrollbar-thin-dull max-h-90vh overflow-auto !py-0"},{title:o(()=>[F((s(),m("div",gt,[y("div",null,r(t.$t("labels.viewMode")),1),y("div",Ct,[a(ae,{type:e(d),class:"flex nc-view-actions-lock-type !text-brand-500 !flex-shrink","hide-tick":""},null,8,["type"])]),p[4]||(p[4]=y("div",{class:"flex flex-grow"},null,-1))])),[[Z,["c:navdraw:preview-as",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>p[5]||(p[5]=[])),default:o(()=>[y("div",xt,r(t.$t("labels.viewMode")),1),a(de,{class:"!mx-1 !py-2 !rounded-md nc-view-action-lock-subaction max-w-[100px]"},{default:o(()=>[a(ae,{type:e(C).Collaborative,onClick:p[0]||(p[0]=k=>$(e(C).Collaborative))},null,8,["type"])]),_:1}),a(de,{class:"!mx-1 !py-2 !rounded-md nc-view-action-lock-subaction"},{default:o(()=>[a(ae,{type:e(C).Locked,onClick:p[1]||(p[1]=k=>$(e(C).Locked))},null,8,["type"])]),_:1})]),_:1})],64)):h("",!0),!e(n).is_default&&e(x)("viewCreateOrEdit")?(s(),m(L,{key:3},[a(Y),e(d)===e(C).Locked?(s(),_(te,{key:0},{title:o(()=>[f(r(t.$t("msg.info.disabledAsViewLocked")),1)]),default:o(()=>[a(M,{class:"!cursor-not-allowed !text-gray-400"},{default:o(()=>[a(g,{class:"nc-view-delete-icon",icon:"delete"}),f(" "+r(t.$t("general.deleteEntity",{entity:e(n).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})]),_:1})):(s(),_(M,{key:1,class:"!hover:bg-red-50 !text-red-500",onClick:$e},{default:o(()=>[a(g,{class:"nc-view-delete-icon",icon:"delete"}),f(" "+r(t.$t("general.deleteEntity",{entity:e(n).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1}))],64)):h("",!0),(ue=e(w))!=null&&ue.base_id&&e(V)?(s(),m(L,{key:4},pe(J,k=>a(Ve,{key:k,modelValue:e(R)[k].value,"onUpdate:modelValue":j=>e(R)[k].value=j,"import-data-only":!0,"import-type":k,"base-id":e(w).base_id,"source-id":e(V)},null,8,["modelValue","onUpdate:modelValue","import-type","base-id","source-id"])),64)):h("",!0)]}),_:1},8,["data-testid"])):(s(),m("span",Vt))}}}),At=be(ht,[["__scopeId","data-v-f797dcb8"]]);export{At as _,Nt as a,Ut as b};
