import{e as C,ap as q,ag as F,L as M,r as N,ar as V,o as g,c as v,b as s,w as t,a as l,t as f,ce as k,N as r,d as R,R as B,Q as T,T as z,U as j,ah as E,Y as G,aT as I}from"./DZZ6t_j4.js";import{_ as S}from"./By7kEk8u.js";import{_ as D}from"./BeDviXlI.js";import{F as L}from"./BYINaHrJ.js";import{_ as A}from"./DyDFI6NE.js";import{_ as H}from"./dfem9Uc_.js";import"./D9tFZoTQ.js";import"./vll-Pnjv.js";import"./BQuyMdA-.js";import"./BQQOEPN4.js";import"./BCJFTkwv.js";const O={class:"flex flex-col"},Q={"data-rec":"true"},W={class:"nc-content-max-w p-6 h-[calc(100vh_-_100px)] flex flex-col gap-6 overflow-auto nc-scrollbar-thin"},Y={class:"mx-auto relative flex flex-col justify-start gap-2 w-full md:bg-white max-w-[900px]"},J={key:0,class:"mx-auto mb-4 bg-red-500 text-white rounded-lg w-3/4 p-1"},K={"data-testid":"nc-user-settings-form__error",class:"flex items-center gap-2 justify-center","data-rec":"true"},X={class:"text-right"},Z={class:"flex justify-center items-center gap-2","data-rec":"true"},ue=C({__name:"ResetPassword",setup(ee){const{api:y,error:d}=q({useGlobalInstance:!0}),{t:o}=F(),{signOut:b}=M(),h=N(),a=V({currentPassword:"",password:"",passwordRepeat:""}),p={currentPassword:[{required:!0,message:o("msg.error.signUpRules.passwdRequired")}],password:[{required:!0,message:o("msg.error.signUpRules.passwdRequired")},{min:8,message:o("msg.error.signUpRules.passwdLength")}],passwordRepeat:[{required:!0,message:o("msg.error.signUpRules.passwdRequired")},{validator:(e,n)=>new Promise((u,m)=>{if(a.password===a.passwordRepeat)return u(!0);m(new Error(o("msg.error.signUpRules.passwdMismatch")))}),message:o("msg.error.signUpRules.passwdMismatch")}]},x=async()=>{h.value.validate()&&(d.value=null,await y.auth.passwordChange({currentPassword:a.currentPassword,newPassword:a.password}),E.success(o("msg.success.passwordChanged")),await b({redirectToSignin:!0}))},c=()=>{d.value&&(d.value=null)};return(e,n)=>{const u=G,m=S,P=D,w=A,_=H,U=I,$=L;return g(),v("div",O,[s(m,null,{icon:t(()=>[s(u,{icon:"passwordChange",class:"flex-none text-gray-700 text-[20px] h-5 w-5"})]),title:t(()=>[l("span",Q,f(e.$t("activity.changePwd")),1)]),_:1}),l("div",W,[l("div",Y,[s($,{ref_key:"formValidator",ref:h,"data-testid":"nc-user-settings-form",layout:"vertical",class:"change-password lg:max-w-3/4 w-full","no-style":"",model:r(a),onFinish:x},{default:t(()=>[s(k,{name:"layout"},{default:t(()=>[r(d)?(g(),v("div",J,[l("div",K,[s(P),R(" "+f(r(d)),1)])])):B("",!0)]),_:1}),s(_,{label:e.$t("placeholder.password.current"),"data-rec":"true",name:"currentPassword",rules:p.currentPassword},{default:t(()=>[s(w,{value:r(a).currentPassword,"onUpdate:value":n[0]||(n[0]=i=>r(a).currentPassword=i),"data-testid":"nc-user-settings-form__current-password",size:"large",class:"password",placeholder:e.$t("placeholder.password.current"),onFocus:c},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),s(_,{label:e.$t("placeholder.password.new"),"data-rec":"true",name:"password",rules:p.password},{default:t(()=>[s(w,{value:r(a).password,"onUpdate:value":n[1]||(n[1]=i=>r(a).password=i),"data-testid":"nc-user-settings-form__new-password",size:"large",class:"password",placeholder:e.$t("placeholder.password.new"),onFocus:c},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),s(_,{label:e.$t("placeholder.password.confirm"),"data-rec":"true",name:"passwordRepeat",rules:p.passwordRepeat},{default:t(()=>[s(w,{value:r(a).passwordRepeat,"onUpdate:value":n[2]||(n[2]=i=>r(a).passwordRepeat=i),"data-testid":"nc-user-settings-form__new-password-repeat",size:"large",class:"password",placeholder:e.$t("placeholder.password.confirm"),onFocus:c},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),l("div",X,[s(U,{size:"middle","data-testid":"nc-user-settings-form__submit",class:"!rounded-md !h-[2.5rem]",type:"primary","html-type":"submit"},{default:t(()=>[l("div",Z,[(g(),T(z(("iconMap"in e?e.iconMap:r(j)).passwordChange))),R(" "+f(e.$t("activity.changePwd")),1)])]),_:1})])]),_:1},8,["model"])])])])}}});export{ue as default};
