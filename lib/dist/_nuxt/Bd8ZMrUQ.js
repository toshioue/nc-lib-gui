const __vite__fileDeps=["./Bcx70IOs.js","./BLdk6lRf.js","./entry.B8GgT5QA.css","./RichTextOptions.CZoe1RIi.css","./DxURyUlp.js","./C9Sjn86N.js","./DV47GYLy.js","./CSxPNiqH.js","./PlainCell.BhW7NMdh.css","./Bpv-SMS-.js","./CwqgNcWF.js","./VirtualCell.BsQKIqYj.css","./DDMaMTJB.js","./CKK7YKGi.js","./Cell.CYBwEWH5.css","./BPzsK8fx.js","./VirtualCell.CZh3Dt_h.css","./utCgnnET.js","./BPK89SF_.js","./DTl_5Njz.js","./DoWzg9_J.js","./boyBAVNN.js","./Cell.DV_4HH8i.css","./CUmqjySl.js","./DivDataCell.1yCNpUg3.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{aM as ge,aO as te,f as lt,aj as Ba,r as E,i as yt,a_ as He,H as Be,cp as oa,g as Me,h1 as Fa,aP as ft,aT as Lt,aL as Ke,b as r,aU as sa,cl as Ia,co as ja,c7 as ra,i0 as Ua,b9 as Ha,aW as ia,bL as ze,aK as Ka,dq as Ct,av as rt,gl as kt,cu as Wa,ht as Ya,cM as qa,ac as ca,aA as Yt,ae as da,O as mt,o as n,c as R,P as e,t as Y,S as q,al as je,U as T,T as ke,Y as ut,R as Se,w as p,$ as Dt,a2 as Tt,Z as Xe,a5 as Ze,ai as ua,fC as va,au as fa,at as nt,cB as Ga,g3 as Xa,cZ as it,c$ as Za,cQ as Qa,dS as ct,h$ as vt,L as At,cU as $t,ce as Ye,an as $e,ao as Ae,X as Ja,cP as en,gh as ot,u as ma,fG as qe,A as tn,a as v,i1 as pa,M as ya,N as ha,d0 as wa,am as pt,d as we,V as Te,W as Pe,Q as Ge,aF as St,fW as qt,aG as an,ap as _a,dH as nn,p as xa,e as ga,_ as ba,cG as ln,ab as at,g6 as on,hO as sn,i2 as rn,cV as Rt,hv as cn,gx as dn,ca as Gt,aB as Xt,fw as Zt,a7 as un,aI as Qt,h6 as vn,hz as fn,hA as mn,cN as pn}from"./BLdk6lRf.js";import{_ as Ca}from"./DMNHEWRT.js";import{_ as ka}from"./xXPG6Rgs.js";import{_ as $a}from"./CsKtxyeB.js";import{_ as Sa}from"./BaHXy0hV.js";import yn from"./CUmqjySl.js";import{_ as hn}from"./L5affmRm.js";import{_ as wn}from"./CQCwdY_F.js";import{T as _n,S as xn,U as gn,L as bn,P as Cn,u as kn,E as $n,a as Sn,g as Rn,_ as Mn}from"./B0DrfDji.js";import{t as En}from"./Cy50pBgZ.js";import{_ as On}from"./DrufEDWe.js";import{u as Ln}from"./DTl_5Njz.js";import{u as Dn}from"./BPK89SF_.js";import{e as Ie,p as Tn,r as An}from"./CwqgNcWF.js";import{a as Ra}from"./DtEz8rQ8.js";import{u as Ma}from"./CT2-bEeO.js";import{u as Ea}from"./CwyeWFQa.js";import{t as Mt}from"./w_fTcf7g.js";import{_ as Vn}from"./D1rFOljU.js";import{u as Nn}from"./BtPl72f0.js";import{u as Pn}from"./DoWzg9_J.js";import{u as zn}from"./CdmoJR0j.js";import{g as Et,a as Bn,j as Fn,i as In,h as jn}from"./CSxPNiqH.js";import{S as Un}from"./ByxI50E5.js";import"./9nfE2yqV.js";import"./ImiwO6hR.js";import"./JimKVLH8.js";import"./DWFLnnq8.js";import"./BQQOEPN4.js";import"./BD_L_KCX.js";import"./C-Z2v8Hi.js";import"./BTh9o-aK.js";import"./ETGzLqdt.js";import"./boyBAVNN.js";import"./DDDDo8jf.js";import"./B0-3_x1m.js";import"./L-4v1RNB.js";var Oa=function(){return{prefixCls:String,width:te.oneOfType([te.string,te.number]),height:te.oneOfType([te.string,te.number]),style:{type:Object,default:void 0},class:String,placement:{type:String},wrapperClassName:String,level:{type:[String,Array]},levelMove:{type:[Number,Function,Array]},duration:String,ease:String,showMask:{type:Boolean,default:void 0},maskClosable:{type:Boolean,default:void 0},maskStyle:{type:Object,default:void 0},afterVisibleChange:Function,keyboard:{type:Boolean,default:void 0},contentWrapperStyle:{type:Object,default:void 0},autofocus:{type:Boolean,default:void 0},open:{type:Boolean,default:void 0}}},Hn=function(){return ge(ge({},Oa()),{},{forceRender:{type:Boolean,default:void 0},getContainer:te.oneOfType([te.string,te.func,te.object,te.looseBool])})},Kn=function(){return ge(ge({},Oa()),{},{getContainer:Function,getOpenCount:Function,scrollLocker:te.any,switchScrollingEffect:Function})};function Wn(l){return Array.isArray(l)?l:[l]}var La={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend"},Yn=Object.keys(La).filter(function(l){if(typeof document>"u")return!1;var t=document.getElementsByTagName("html")[0];return l in(t?t.style:{})})[0],Jt=La[Yn];function ea(l,t,i,O){l.addEventListener?l.addEventListener(t,i,O):l.attachEvent&&l.attachEvent("on".concat(t),i)}function ta(l,t,i,O){l.removeEventListener?l.removeEventListener(t,i,O):l.attachEvent&&l.detachEvent("on".concat(t),i)}function qn(l,t){var i=typeof l=="function"?l(t):l;return Array.isArray(i)?i.length===2?i:[i[0],i[1]]:[i]}var aa=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},Ot=!(typeof window<"u"&&window.document&&window.document.createElement),Gn=function l(t,i,O,x){if(!i||i===document||i instanceof Document)return!1;if(i===t.parentNode)return!0;var de=Math.max(Math.abs(O),Math.abs(x))===Math.abs(x),Q=Math.max(Math.abs(O),Math.abs(x))===Math.abs(O),B=i.scrollHeight-i.clientHeight,A=i.scrollWidth-i.clientWidth,$=document.defaultView.getComputedStyle(i),G=$.overflowY==="auto"||$.overflowY==="scroll",I=$.overflowX==="auto"||$.overflowX==="scroll",se=B&&G,h=A&&I;return de&&(!se||se&&(i.scrollTop>=B&&x<0||i.scrollTop<=0&&x>0))||Q&&(!h||h&&(i.scrollLeft>=A&&O<0||i.scrollLeft<=0&&O>0))?l(t,i.parentNode,O,x):!1},Xn=["width","height","open","prefixCls","placement","level","levelMove","ease","duration","getContainer","onChange","afterVisibleChange","showMask","maskClosable","maskStyle","keyboard","getOpenCount","scrollLocker","contentWrapperStyle","style","class"],st={},na=lt({compatConfig:{MODE:3},inheritAttrs:!1,props:Kn(),emits:["close","handleClick","change"],setup:function(t,i){var O=i.emit,x=i.slots,de=Ba({startPos:{x:null,y:null}}),Q,B=E(),A=E(),$=E(),G=E(),I=E(),se=[],h="drawer_id_".concat(Number((Date.now()+Math.random()).toString().replace(".",Math.round(Math.random()*9).toString())).toString(16)),ue=!Ot&&ja?{passive:!1}:!1;yt(function(){He(function(){var m=t.open,o=t.getContainer,_=t.showMask,g=t.autofocus,P=o==null?void 0:o();if(ee(t),m&&(P&&P.parentNode===document.body&&(st[h]=m),K(),He(function(){g&&Re()}),_)){var W;(W=t.scrollLocker)===null||W===void 0||W.lock()}})}),Be(function(){return t.level},function(){ee(t)},{flush:"post"}),Be(function(){return t.open},function(){var m=t.open,o=t.getContainer,_=t.scrollLocker,g=t.showMask,P=t.autofocus,W=o==null?void 0:o();W&&W.parentNode===document.body&&(st[h]=!!m),K(),m?(P&&Re(),g&&(_==null||_.lock())):_==null||_.unLock()},{flush:"post"}),oa(function(){var m,o=t.open;delete st[h],o&&(pe(!1),document.body.style.touchAction=""),(m=t.scrollLocker)===null||m===void 0||m.unLock()}),Be(function(){return t.placement},function(m){m&&(I.value=null)});var Re=function(){var o,_;(o=A.value)===null||o===void 0||(_=o.focus)===null||_===void 0||_.call(o)},J=function(o){o.touches.length>1||(de.startPos={x:o.touches[0].clientX,y:o.touches[0].clientY})},oe=function(o){if(!(o.changedTouches.length>1)){var _=o.currentTarget,g=o.changedTouches[0].clientX-de.startPos.x,P=o.changedTouches[0].clientY-de.startPos.y;(_===$.value||_===G.value||_===I.value&&Gn(_,o.target,g,P))&&o.cancelable&&o.preventDefault()}},me=function m(o){var _=o.target;ta(_,Jt,m),_.style.transition=""},C=function(o){O("close",o)},Ee=function(o){o.keyCode===Ia.ESC&&(o.stopPropagation(),C(o))},s=function(o){var _=t.open,g=t.afterVisibleChange;o.target===B.value&&o.propertyName.match(/transform$/)&&(A.value.style.transition="",!_&&F()&&(document.body.style.overflowX="",$.value&&($.value.style.left="",$.value.style.width="")),g&&g(!!_))},w=Me(function(){var m=t.placement,o=m==="left"||m==="right",_="translate".concat(o?"X":"Y");return{isHorizontal:o,placementName:_}}),K=function(){var o=t.open,_=t.width,g=t.height,P=w.value,W=P.isHorizontal,j=P.placementName,re=I.value?I.value.getBoundingClientRect()[W?"width":"height"]:0,ne=(W?_:g)||re;X(o,j,ne)},pe=function(o,_,g,P){var W=t.placement,j=t.levelMove,re=t.duration,ne=t.ease,ye=t.showMask;se.forEach(function(U){U.style.transition="transform ".concat(re," ").concat(ne),ea(U,Jt,me);var be=o?g:0;if(j){var c=qn(j,{target:U,open:o});be=o?c[0]:c[1]||0}var d=typeof be=="number"?"".concat(be,"px"):be,f=W==="left"||W==="top"?d:"-".concat(d);f=ye&&W==="right"&&P?"calc(".concat(f," + ").concat(P,"px)"):f,U.style.transform=be?"".concat(_,"(").concat(f,")"):""})},X=function(o,_,g){if(!Ot){var P=document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth?Fa(!0):0;pe(o,_,g,P),L(P)}O("change",o)},L=function(o){var _=t.getContainer,g=t.showMask,P=t.open,W=_==null?void 0:_();if(W&&W.parentNode===document.body&&g){var j=["touchstart"],re=[document.body,$.value,G.value,I.value];P&&document.body.style.overflow!=="hidden"?(o&&y(o),document.body.style.touchAction="none",re.forEach(function(ne,ye){ne&&ea(ne,j[ye]||"touchmove",ye?oe:J,ue)})):F()&&(document.body.style.touchAction="",o&&u(o),re.forEach(function(ne,ye){ne&&ta(ne,j[ye]||"touchmove",ye?oe:J,ue)}))}},y=function(o){var _=t.placement,g=t.duration,P=t.ease,W="width ".concat(g," ").concat(P),j="transform ".concat(g," ").concat(P);switch(A.value.style.transition="none",_){case"right":A.value.style.transform="translateX(-".concat(o,"px)");break;case"top":case"bottom":A.value.style.width="calc(100% - ".concat(o,"px)"),A.value.style.transform="translateZ(0)";break}clearTimeout(Q),Q=setTimeout(function(){A.value&&(A.value.style.transition="".concat(j,",").concat(W),A.value.style.width="",A.value.style.transform="")})},u=function(o){var _=t.placement,g=t.duration,P=t.ease;A.value.style.transition="none";var W,j="width ".concat(g," ").concat(P),re="transform ".concat(g," ").concat(P);switch(_){case"left":{A.value.style.width="100%",j="width 0s ".concat(P," ").concat(g);break}case"right":{A.value.style.transform="translateX(".concat(o,"px)"),A.value.style.width="100%",j="width 0s ".concat(P," ").concat(g),$.value&&($.value.style.left="-".concat(o,"px"),$.value.style.width="calc(100% + ".concat(o,"px)"));break}case"top":case"bottom":{A.value.style.width="calc(100% + ".concat(o,"px)"),A.value.style.height="100%",A.value.style.transform="translateZ(0)",W="height 0s ".concat(P," ").concat(g);break}}clearTimeout(Q),Q=setTimeout(function(){A.value&&(A.value.style.transition="".concat(re,",").concat(W?"".concat(W,","):"").concat(j),A.value.style.transform="",A.value.style.width="",A.value.style.height="")})},F=function(){return!Object.keys(st).some(function(o){return st[o]})},ee=function(o){var _=o.level,g=o.getContainer;if(!Ot){var P=g==null?void 0:g(),W=P?P.parentNode:null;if(se=[],_==="all"){var j=W?Array.prototype.slice.call(W.children):[];j.forEach(function(re){re.nodeName!=="SCRIPT"&&re.nodeName!=="STYLE"&&re.nodeName!=="LINK"&&re!==P&&se.push(re)})}else _&&Wn(_).forEach(function(re){document.querySelectorAll(re).forEach(function(ne){se.push(ne)})})}},ae=function(o){O("handleClick",o)},_e=E(!1);return Be(A,function(){He(function(){_e.value=!0})}),function(){var m,o,_,g=t.width,P=t.height,W=t.open,j=t.prefixCls,re=t.placement;t.level,t.levelMove,t.ease,t.duration,t.getContainer,t.onChange,t.afterVisibleChange;var ne=t.showMask,ye=t.maskClosable,U=t.maskStyle,be=t.keyboard;t.getOpenCount,t.scrollLocker;var c=t.contentWrapperStyle,d=t.style,f=t.class,D=ft(t,Xn),k=W&&_e.value,N=Lt(j,(m={},Ke(m,"".concat(j,"-").concat(re),!0),Ke(m,"".concat(j,"-open"),k),Ke(m,f,!!f),Ke(m,"no-mask",!ne),m)),z=w.value.placementName,H=re==="left"||re==="top"?"-100%":"100%",V=k?"":"".concat(z,"(").concat(H,")");return r("div",ge(ge({},sa(D,["switchScrollingEffect","autofocus"])),{},{tabindex:-1,class:N,style:d,ref:A,onKeydown:k&&be?Ee:void 0,onTransitionend:s}),[ne&&r("div",{class:"".concat(j,"-mask"),onClick:ye?C:void 0,style:U,ref:$},null),r("div",{class:"".concat(j,"-content-wrapper"),style:ge({transform:V,msTransform:V,width:aa(g)?"".concat(g,"px"):g,height:aa(P)?"".concat(P,"px"):P},c),ref:B},[r("div",{class:"".concat(j,"-content"),ref:I},[(o=x.default)===null||o===void 0?void 0:o.call(x)]),x.handler?r("div",{onClick:ae,ref:G},[(_=x.handler)===null||_===void 0?void 0:_.call(x)]):null])])}}}),Zn=["afterVisibleChange","getContainer","wrapperClassName","forceRender"],Qn=["visible","afterClose"],Jn=lt({compatConfig:{MODE:3},inheritAttrs:!1,props:ra(Hn(),{prefixCls:"drawer",placement:"left",getContainer:"body",level:"all",duration:".3s",ease:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",afterVisibleChange:function(){},showMask:!0,maskClosable:!0,maskStyle:{},wrapperClassName:"",keyboard:!0,forceRender:!1,autofocus:!0}),emits:["handleClick","close"],slots:["handler"],setup:function(t,i){var O=i.emit,x=i.slots,de=E(null),Q=function($){O("handleClick",$)},B=function($){O("close",$)};return function(){t.afterVisibleChange;var A=t.getContainer,$=t.wrapperClassName,G=t.forceRender,I=ft(t,Zn),se=null;if(!A)return r("div",{class:$,ref:de},[r(na,ge(ge({},I),{},{open:t.open,getContainer:function(){return de.value},onClose:B,onHandleClick:Q}),x)]);var h=!!x.handler||G;return(h||t.open||de.value)&&(se=r(Ua,{visible:t.open,forceRender:h,getContainer:A,wrapperClassName:$},{default:function(Re){var J=Re.visible,oe=Re.afterClose,me=ft(Re,Qn);return r(na,ge(ge(ge({ref:de},I),me),{},{open:J!==void 0?J:t.open,afterVisibleChange:oe!==void 0?oe:t.afterVisibleChange,onClose:B,onHandleClick:Q}),x)}})),se}}}),el=["width","height","visible","placement","mask","wrapClassName","class"],tl=ia("top","right","bottom","left");ia("default","large");var la={distance:180},al=function(){return{autofocus:{type:Boolean,default:void 0},closable:{type:Boolean,default:void 0},closeIcon:te.any,destroyOnClose:{type:Boolean,default:void 0},forceRender:{type:Boolean,default:void 0},getContainer:te.any,maskClosable:{type:Boolean,default:void 0},mask:{type:Boolean,default:void 0},maskStyle:{type:Object,default:void 0},wrapStyle:{type:Object,default:void 0},style:{type:Object,default:void 0},class:te.any,wrapClassName:String,size:{type:String},drawerStyle:{type:Object,default:void 0},headerStyle:{type:Object,default:void 0},bodyStyle:{type:Object,default:void 0},contentWrapperStyle:{type:Object,default:void 0},title:te.any,visible:{type:Boolean,default:void 0},width:te.oneOfType([te.string,te.number]),height:te.oneOfType([te.string,te.number]),zIndex:Number,prefixCls:String,push:te.oneOfType([te.looseBool,{type:Object}]),placement:te.oneOf(tl),keyboard:{type:Boolean,default:void 0},extra:te.any,footer:te.any,footerStyle:{type:Object,default:void 0},level:te.any,levelMove:{type:[Number,Array,Function]},handle:te.any,afterVisibleChange:Function,onAfterVisibleChange:Function,"onUpdate:visible":Function,onClose:Function}},nl=lt({compatConfig:{MODE:3},name:"ADrawer",inheritAttrs:!1,props:ra(al(),{closable:!0,placement:"right",maskClosable:!0,mask:!0,level:null,keyboard:!0,push:la}),slots:["closeIcon","title","extra","footer","handle"],setup:function(t,i){var O=i.emit,x=i.slots,de=i.attrs,Q=E(!1),B=E(!1),A=E(null),$=ze("parentDrawerOpts",null),G=Ka("drawer",t),I=G.prefixCls;Ct(!t.afterVisibleChange,"Drawer","`afterVisibleChange` prop is deprecated, please use `@afterVisibleChange` event instead"),Ct(t.wrapStyle===void 0,"Drawer","`wrapStyle` prop is deprecated, please use `style` instead"),Ct(t.wrapClassName===void 0,"Drawer","`wrapClassName` prop is deprecated, please use `class` instead");var se=function(){Q.value=!0},h=function(){Q.value=!1,He(function(){ue()})};rt("parentDrawerOpts",{setPush:se,setPull:h}),yt(function(){var L=t.visible;L&&$&&$.setPush()}),oa(function(){$&&$.setPull()}),Be(function(){return t.visible},function(L){$&&(L?$.setPush():$.setPull())},{flush:"post"});var ue=function(){var y,u;(y=A.value)===null||y===void 0||(u=y.domFocus)===null||u===void 0||u.call(y)},Re=function(y){O("update:visible",!1),O("close",y)},J=function(y){var u;(u=t.afterVisibleChange)===null||u===void 0||u.call(t,y),O("afterVisibleChange",y)},oe=Me(function(){return t.destroyOnClose&&!t.visible}),me=function(){var y=oe.value;y&&(t.visible||(B.value=!0))},C=Me(function(){var L=t.push,y=t.placement,u;return typeof L=="boolean"?u=L?la.distance:0:u=L.distance,u=parseFloat(String(u||0)),y==="left"||y==="right"?"translateX(".concat(y==="left"?u:-u,"px)"):y==="top"||y==="bottom"?"translateY(".concat(y==="top"?u:-u,"px)"):null}),Ee=Me(function(){var L=t.visible,y=t.mask,u=t.placement,F=t.size,ee=F===void 0?"default":F,ae=t.width,_e=t.height;if(!L&&!y)return{};var m={};if(u==="left"||u==="right"){var o=ee==="large"?736:378;m.width=typeof ae>"u"?o:ae,m.width=typeof m.width=="string"?m.width:"".concat(m.width,"px")}else{var _=ee==="large"?736:378;m.height=typeof _e>"u"?_:_e,m.height=typeof m.height=="string"?m.height:"".concat(m.height,"px")}return m}),s=Me(function(){var L=t.zIndex,y=t.wrapStyle,u=t.mask,F=t.style,ee=u?{}:Ee.value;return ge(ge(ge({zIndex:L,transform:Q.value?C.value:void 0},ee),y),F)}),w=function(y){var u=t.closable,F=t.headerStyle,ee=kt(x,t,"extra"),ae=kt(x,t,"title");return!ae&&!u?null:r("div",{class:Lt("".concat(y,"-header"),Ke({},"".concat(y,"-header-close-only"),u&&!ae&&!ee)),style:F},[r("div",{class:"".concat(y,"-header-title")},[K(y),ae&&r("div",{class:"".concat(y,"-title")},[ae])]),ee&&r("div",{class:"".concat(y,"-extra")},[ee])])},K=function(y){var u,F=t.closable,ee=x.closeIcon?(u=x.closeIcon)===null||u===void 0?void 0:u.call(x):t.closeIcon;return F&&r("button",{key:"closer",onClick:Re,"aria-label":"Close",class:"".concat(y,"-close")},[ee===void 0?r(Wa,null,null):ee])},pe=function(y){var u;if(B.value&&!t.visible)return null;B.value=!1;var F=t.bodyStyle,ee=t.drawerStyle,ae={},_e=oe.value;return _e&&(ae.opacity=0,ae.transition="opacity .3s"),r("div",{class:"".concat(y,"-wrapper-body"),style:ge(ge({},ae),ee),onTransitionend:me},[w(y),r("div",{key:"body",class:"".concat(y,"-body"),style:F},[(u=x.default)===null||u===void 0?void 0:u.call(x)]),X(y)])},X=function(y){var u=kt(x,t,"footer");if(!u)return null;var F="".concat(y,"-footer");return r("div",{class:F,style:t.footerStyle},[u])};return function(){var L;t.width,t.height;var y=t.visible,u=t.placement,F=t.mask,ee=t.wrapClassName,ae=t.class,_e=ft(t,el),m=F?Ee.value:{},o=F?"":"no-mask",_=ge(ge(ge(ge({},de),sa(_e,["size","closeIcon","closable","destroyOnClose","drawerStyle","headerStyle","bodyStyle","title","push","wrapStyle","onAfterVisibleChange","onClose","onUpdate:visible"])),m),{},{onClose:Re,afterVisibleChange:J,handler:!1,prefixCls:I.value,open:y,showMask:F,placement:u,class:Lt((L={},Ke(L,ae,ae),Ke(L,ee,!!ee),Ke(L,o,!!o),L)),style:s.value,ref:A});return r(Jn,_,{handler:t.handle?function(){return t.handle}:x.handle,default:function(){return pe(I.value)}})}}});const ll=Ha(nl),ol=Xe(()=>Ze(()=>import("./Bcx70IOs.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(l=>l.default||l)),sl={key:0,class:"truncate"},rl={key:0},il={key:1,class:"flex justify-between pt-1 rich-text-bottom-bar items-center"},cl=lt({__name:"RichComment",props:{hideOptions:{type:Boolean,default:!0},value:{},readOnly:{type:Boolean},syncValueChange:{type:Boolean},autofocus:{type:Boolean},placeholder:{},renderAsText:{type:Boolean}},emits:["update:value","focus","blur","save"],setup(l,{expose:t,emit:i}){const O=l,x=i,de=ze(Ya,E(!1)),Q=E(!1),B=qa(),A=new _n({});A.addRule("lineBreak",{filter:s=>s.nodeName==="BR",replacement:()=>"<br />"}),A.addRule("strikethrough",{filter:["s"],replacement:s=>`~${s}~`}),A.keep(["u","del"]);const $=E(null),G=E(null),I=ca(O,"value",x,{defaultValue:""}),se=[xn.configure({heading:!1,codeBlock:!1,code:!1}),gn,bn,Cn.configure({emptyEditorClass:"is-editor-empty",placeholder:O.placeholder})],h=kn({extensions:se,onUpdate:({editor:s})=>{let w=A.turndown(s.getHTML().replaceAll(/<p><\/p>/g,"<br />"));((s==null?void 0:s.isActive("bulletList"))||(s==null?void 0:s.isActive("orderedList"))||(s==null?void 0:s.isActive("blockquote")))&&w.endsWith("<br />")&&(w=w.slice(0,-6)),w=w.replaceAll(/\n\n<br \/>\n\n/g,`<br>

`),I.value=w==="<br />"?"":`${w}`},editable:!O.readOnly,autofocus:O.autofocus,onFocus:()=>{Q.value=!0,x("focus"),Re()},onBlur:s=>{const w=s==null?void 0:s.event.relatedTarget;w!=null&&w.closest(".comment-bubble-menu, .nc-rich-text-comment, .tippy-box, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .nc-mention-list, .tippy-content, .nc-comment-rich-editor")||(Q.value=!1,x("blur"))}}),ue=(s,w)=>{if(!h.value)return;const K=h.value.view.state.selection,pe=s?Sn.parse(s):"<p></p>",X=Rn(pe,se);h.value.chain().setContent(X).setTextSelection(K.to).run(),setTimeout(()=>{var L;if(w){const y=h.value.state.doc.nodeSize;(L=h.value)==null||L.chain().setTextSelection(y-1).run()}h.value.state.history$.prevRanges=null,h.value.state.history$.done.eventCount=0},100)};function Re(){var s;!O.readOnly&&!B.shift.value&&((s=h.value)==null||s.chain().focus().run(),ue(I.value,!0))}O.syncValueChange&&Be([I,h],()=>{ue(I.value)}),Yt($,"focusout",s=>{var K;const w=s==null?void 0:s.relatedTarget;((K=w==null?void 0:w.classList)!=null&&K.contains("tiptap")||!(w!=null&&w.closest(".comment-bubble-menu, .nc-rich-text-comment, .tippy-box, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .nc-mention-list, .tippy-content, .nc-comment-rich-editor")))&&(Q.value=!1,x("blur"))},!0),Yt(G,"focusout",s=>{var K;const w=s==null?void 0:s.relatedTarget;!w&&((K=s.target)!=null&&K.closest(".comment-bubble-menu, .nc-comment-save-btn, .nc-mention-list, .mention, .rich-text-bottom-bar, .tippy-content, .nc-comment-rich-editor"))||w!=null&&w.closest(".comment-bubble-menu, .nc-comment-save-btn, .rich-text-bottom-bar, .mention, .tippy-content, .nc-mention-list, .nc-comment-rich-editor")||(Q.value=!1,x("blur"))},!0),da($,s=>{if(!Q.value)return;const w=s==null?void 0:s.target;w!=null&&w.closest(".tippy-content, .nc-rich-text-comment, .nc-comment-save-btn, .nc-mention-list, .rich-text-bottom-bar, .mention, .comment-bubble-menu, .nc-comment-rich-editor")||(Q.value=!1,x("blur"))});const J=E(!1),oe=s=>{h.value&&(J.value?J.value=!1:h.value.isActive("bulletList")||h.value.isActive("orderedList")||h.value.isActive("blockquote")?s.stopPropagation():x("save"))},me=s=>{var K,pe,X;((K=h.value)==null?void 0:K.isActive("bulletList"))||((pe=h.value)==null?void 0:pe.isActive("orderedList"))||((X=h.value)==null?void 0:X.isActive("blockquote"))?(J.value=!0,setTimeout(()=>{J.value=!1},1e3)):oe(s)},C=s=>{s.altKey&&s.key==="Enter"||s.shiftKey&&s.key==="Enter"?s.stopPropagation():s.key==="Enter"?me(s):s.key==="Escape"&&(Q.value=!1,x("blur"))},Ee=s=>{s.preventDefault(),s.stopPropagation(),x("save")};return t({setEditorContent:ue}),yt(()=>{O.readOnly&&setTimeout(()=>{document.querySelectorAll(".nc-rich-link-tooltip").forEach(s=>{const w=Object.values(s.attributes).find(K=>K.name==="data-tooltip");w&&En(s,{content:`<span class="tooltip">${w.value}</span>`,placement:"top",allowHTML:!0,arrow:!0,animation:"fade",duration:0})})},1e3)}),(s,w)=>{var u,F;const K=Mn,pe=ol,X=Dt,L=Tt,y=mt("e");return n(),R("div",{class:ke([{readonly:s.readOnly,"nc-rich-text-grid":e(de)},"nc-rich-text-comment flex flex-col w-full h-full"]),tabindex:1,onFocus:Re},[s.renderAsText?(n(),R("div",sl,[e(h)?(n(),R("span",rl,Y(((u=e(h))==null?void 0:u.getText())??""),1)):q("",!0)])):(n(),R(je,{key:1},[e(h)?(n(),T(K,{key:0,ref_key:"richTextLinkOptionRef",ref:G,editor:e(h),"is-comment":!0,"is-form-field":!0,onBlur:w[0]||(w[0]=ee=>Q.value=!1)},null,8,["editor"])):q("",!0),r(e($n),{ref_key:"editorDom",ref:$,editor:e(h),class:ke([{"p-1":!O.readOnly,"px-[0.25rem]":O.readOnly},"flex flex-col nc-comment-rich-editor w-full scrollbar-thin scrollbar-thumb-gray-200 nc-truncate scrollbar-track-transparent"]),onKeydown:ut(C,["stop"])},null,8,["editor","class"]),s.hideOptions?q("",!0):(n(),R("div",il,[r(pe,{editor:e(h),class:"!bg-transparent"},null,8,["editor"]),Se((n(),T(L,{disabled:!((F=e(I))!=null&&F.length),class:"!disabled:bg-gray-100 nc-comment-save-btn !h-7 !w-7 !shadow-none",size:"xsmall",onClick:Ee},{default:p(()=>[r(X,{icon:"send"})]),_:1},8,["disabled"])),[[y,["a:row-expand:comment:save"]]])]))],64))],34)}}}),[dl,ul]=Ln((l,t)=>{var ne,ye,U,be,c,d;const{$e:i,$state:O,$api:x}=tn(),{t:de}=ua(),Q=ze(va,E(!1)),B=E([]),A=E([]),$=E(!1),G=E(!1),I=E(!0),se=E(0),h=E(new Set),ue=fa(),{basesUser:Re}=nt(ue),{base:J}=nt(Ga()),oe=Me(()=>l.value.base_id?Re.value.get(l.value.base_id)||[]:[]),{sharedView:me}=Xa(),C=E(!me.value||((ne=me.value)==null?void 0:ne.type)===it.GALLERY||((ye=me.value)==null?void 0:ye.type)===it.KANBAN||(be=(U=t.value)==null?void 0:U.rowMeta)!=null&&be.new?t.value:{row:{},oldRow:{},rowMeta:{}});(d=(c=C.value)==null?void 0:c.rowMeta)!=null&&d.fromExpandedForm&&(C.value.rowMeta.fromExpandedForm=!0);const Ee=Dn(C),s=ze(Za,E()),{addUndo:w,clone:K,defineViewScope:pe}=Qa(),X=ze(vt,ct()),{isUIAllowed:L}=At(),y=Me(()=>{var f,D,k,N;if((f=C==null?void 0:C.value)!=null&&f.row){const z=(k=(D=l==null?void 0:l.value)==null?void 0:D.columns)==null?void 0:k.find(ce=>ce.pv);if(!z)return;const H=(N=C.value.row)==null?void 0:N[z.title],V=z.uidt;if(V===$t.Date)return(/^\d+$/.test(H)?Ye(+H):Ye(H)).format("YYYY-MM-DD");if(V===$t.DateTime)return(/^\d+$/.test(H)?Ye(+H):Ye(H)).format("YYYY-MM-DD HH:mm");if(V===$t.Time){let ce=Ye(H);return ce.isValid()||(ce=Ye(H,"HH:mm:ss")),ce.isValid()||(ce=Ye(`1999-01-01 ${H}`)),ce.isValid()?ce.format("HH:mm:ss"):H}return H}}),u=Me(()=>Ie(C.value.row,l.value.columns)),F=async f=>{if(!L("commentList")||!C.value&&!f)return;const D=f??Ie(C.value.row,l.value.columns);if(D)try{$.value=!0;const k=(await x.utils.commentList({row_id:D,fk_model_id:l.value.id})).list||[];B.value=k.map(N=>{const z=oe.value.find(V=>V.id===N.created_by),H=N.resolved_by?oe.value.find(V=>V.id===N.resolved_by):null;return{...N,created_display_name:(z==null?void 0:z.display_name)??((z==null?void 0:z.email)??"").split("@")[0],resolved_display_name:H?H.display_name??H.email.split("@")[0]:null}})}catch(k){$e.error(await Ae(k))}finally{$.value=!1}},ee=async f=>{if(!L("commentDelete"))return;const D=B.value.find(k=>k.id===f);try{B.value=B.value.filter(k=>k.id!==f),await x.utils.commentDelete(f),Object.assign(C.value,{...C.value,rowMeta:{...C.value.rowMeta,commentCount:(C.value.rowMeta.commentCount??1)-1}})}catch(k){$e.error(await Ae(k)),B.value=[...B.value,D]}},ae=async f=>{var k,N;if(!L("auditListRow")||Ja||!C.value&&!f)return;const D=f??Ie(C.value.row,l.value.columns);if(D)try{G.value=!0;const z=((N=(k=(await x.utils.auditList({row_id:D,fk_model_id:l.value.id})).list)==null?void 0:k.reverse)==null?void 0:N.call(k))||[];A.value=z.map(H=>{const V=oe.value.find(ce=>ce.email===H.user);return{...H,created_display_name:(V==null?void 0:V.display_name)??((V==null?void 0:V.email)??"").split("@")[0],created_by_email:V==null?void 0:V.email}})}catch(z){$e.error(await Ae(z))}finally{G.value=!1}},_e=f=>{var D,k;return((k=(D=O.user)==null?void 0:D.value)==null?void 0:k.email)===f},m=async()=>{var f;if(((f=s.value)==null?void 0:f.type)===it.KANBAN){const{loadKanbanData:D}=Ra();await D()}};return{...Ee,loadComments:F,deleteComment:ee,loadAudits:ae,comments:B,audits:A,isAuditLoading:G,resolveComment:async f=>{if(!L("commentResolve"))return;const D=B.value.find(k=>k.id===f);try{B.value=B.value.map(k=>{var N,z,H,V,ce,Ve,he,ie;return k.id===f?{...k,resolved_by:D.resolved_by?null:(z=(N=O.user)==null?void 0:N.value)==null?void 0:z.id,resolved_by_email:D.resolved_by?null:(V=(H=O.user)==null?void 0:H.value)==null?void 0:V.email,resolved_display_name:D.resolved_by?null:((Ve=(ce=O.user)==null?void 0:ce.value)==null?void 0:Ve.display_name)??((ie=(he=O.user)==null?void 0:he.value)==null?void 0:ie.email.split("@")[0])}:k}),await x.utils.commentResolve(f)}catch(k){B.value=B.value.map(N=>N.id===f?D:N),$e.error(await Ae(k))}},isCommentsLoading:$,saveComment:async f=>{var D;try{if(!C.value||!f){B.value=B.value.filter(N=>{var z;return!((z=N.id)!=null&&z.startsWith("temp-"))});return}const k=Ie(C.value.row,l.value.columns);if(!k)return;await x.utils.commentRow({fk_model_id:(D=l.value)==null?void 0:D.id,row_id:k,comment:`${f}`.replace(/(<br \/>)+$/g,"")}),Object.assign(C.value,{rowMeta:{...C.value.rowMeta,commentCount:(C.value.rowMeta.commentCount??0)+1}}),await F()}catch(k){B.value=B.value.filter(N=>!(N.id??"").startsWith("temp-")),$e.error(await Ae(k))}i("a:row-expand:comment")},isYou:_e,commentsDrawer:I,row:C,deleteRowById:async f=>{try{const D=f??Ie(C.value.row,l.value.columns),k=await x.dbTableRow.delete(ot,J.value.id,l.value.id,encodeURIComponent(D));if(k.message)return $e.info(`Record delete failed: ${`Unable to delete record with ID ${f} because of the following:
              
${k.message.join(`
`)}.

              Clear the data first & try again`})}`),!1}catch(D){$e.error(`${de("msg.error.deleteFailed")}: ${await Ae(D)}`)}},displayValue:y,save:async(f={},D=!1,{kanbanClbk:k}={})=>{var H,V,ce,Ve;if(!l.value.id)return;let N;const z=((H=C.value.rowMeta)==null?void 0:H.new)??!1;if(z){const{getMeta:he}=en(),{missingRequiredColumns:ie,insertObj:xe}=await Tn({meta:l.value,ltarState:f,getMeta:he,row:C.value.row,throwError:!0});if(ie.size)return;if(N=await x.dbTableRow.create("noco",J.value.id,l.value.id,{...xe,...f||{}}),Object.assign(C.value,{row:N,rowMeta:{...C.value.rowMeta,new:!1},oldRow:{...N}}),!D){const Oe=Ie(N,(V=l.value)==null?void 0:V.columns),ve=An(C.value.row,(ce=l.value)==null?void 0:ce.columns);w({redo:{fn:async le=>{await x.dbTableRow.create("noco",J.value.id,l.value.id,{...ve,...le}),await m(),X==null||X.trigger()},args:[K(xe)]},undo:{fn:async le=>{var S,Ce;const Qe=await x.dbViewRow.delete("noco",J.value.id,(S=l.value)==null?void 0:S.id,(Ce=s.value)==null?void 0:Ce.id,encodeURIComponent(le));if(Qe.message)throw new Error(Qe.message);await m(),X==null||X.trigger()},args:[Oe]},scope:pe({view:s.value})})}}else{const he=[...h.value].reduce((ie,xe)=>(ie[xe]=C.value.row[xe],ie),{});if(Object.keys(he).length){const ie=Ie(C.value.row,l.value.columns);if(!ie)return $e.info("Update not allowed for table which doesn't have primary Key");if(await x.dbTableRow.update(ot,J.value.id,l.value.id,encodeURIComponent(ie),he),!D){const xe=[...h.value].reduce((Oe,ve)=>(Oe[ve]=C.value.oldRow[ve],Oe),{});w({redo:{fn:async(Oe,ve)=>{await x.dbTableRow.update(ot,J.value.id,l.value.id,encodeURIComponent(Oe),ve),await m(),X==null||X.trigger()},args:[ie,K(he)]},undo:{fn:async(Oe,ve)=>{await x.dbTableRow.update(ot,J.value.id,l.value.id,encodeURIComponent(Oe),ve),await m(),X==null||X.trigger()},args:[ie,K(xe)]},scope:pe({view:s.value})})}I.value&&await Promise.all([F(),ae()])}else{$e.info(de("msg.info.noColumnsToUpdate"));return}}return((Ve=s.value)==null?void 0:Ve.type)===it.KANBAN&&k&&k(C.value,z),h.value=new Set,i("a:row-expand:add"),N},changedColumns:h,loadRow:async(f,D=!1,k=!1)=>{var H,V,ce,Ve,he,ie,xe,Oe;if((V=(H=C==null?void 0:C.value)==null?void 0:H.rowMeta)!=null&&V.new||Q.value||!((ce=l.value)!=null&&ce.id))return;const N=f??Ie(C.value.row,l.value.columns);if(!N)return;let z={};try{z=await x.dbTableRow.read(ot,(((Ve=J==null?void 0:J.value)==null?void 0:Ve.id)??((he=l.value)==null?void 0:he.base_id))||((xe=(ie=me.value)==null?void 0:ie.view)==null?void 0:xe.base_id),l.value.id,encodeURIComponent(N),{getHiddenColumn:!0})}catch(ve){if(((Oe=ve.response)==null?void 0:Oe.status)===404){const le=ma();$e.error(de("msg.noRecordFound")),le.replace({query:{}})}else $e.error(`${await Ae(ve)}`)}try{D&&(z={...C.value.row,...(l.value.columns??[]).reduce((ve,le)=>(qe(le)&&le.title&&le.title in z&&(ve[le.title]=z[le.title]),ve),{})}),k&&(z=Object.keys(z).reduce((ve,le)=>(Object.prototype.hasOwnProperty.call(C.value.row,le)?ve[le]=C.value.row[le]:ve[le]=z[le],ve),{})),Object.assign(C.value,{row:z,oldRow:{...z},rowMeta:{...C.value.rowMeta}})}catch{$e.error(`${de("msg.error.errorLoadingRecord")}`)}},primaryKey:u,saveRowAndStay:se,updateComment:async(f,D)=>{const k=B.value.find(N=>N.id===f);try{B.value=B.value.map(N=>N.id===f?{...N,...D,updated_at:new Date().toISOString()}:N),await x.utils.commentUpdate(f,D)}catch(N){B.value=B.value.map(z=>z.id===f?k:z),$e.error(await Ae(N))}},clearColumns:()=>{h.value=new Set}}},"expanded-form-store");function vl(){const l=ul();if(l==null)throw new Error("Please call `useExpandedFormStore` on the appropriate parent component");return l}const fl={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ml=v("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1),pl=[ml];function yl(l,t){return n(),R("svg",fl,[...pl])}const hl={name:"mdi-history",render:yl},ht=l=>(xa("data-v-7b264b92"),l=l(),ga(),l),wl={class:"flex flex-col bg-white !h-full w-full rounded-br-2xl overflow-hidden"},_l={class:"flex items-center gap-2"},xl=ht(()=>v("span",{class:"<lg:hidden"}," Comments ",-1)),gl={key:0,class:"flex flex-col items-center justify-center w-full h-full"},bl={key:1,class:"flex flex-col h-full"},Cl={key:0,class:"flex flex-col my-1 text-center justify-center h-full nc-scrollbar-thin"},kl={class:"text-center text-3xl text-gray-700"},$l={class:"font-medium text-center my-6 text-gray-500"},Sl={class:"flex items-start justify-between"},Rl={class:"flex h-[28px] items-center gap-3 w-[calc(100%_-_40px)]"},Ml={class:"truncate text-gray-800 font-medium !text-small !leading-[18px] overflow-hidden"},El={class:"bg-white rounded-lg"},Ol={class:"flex items-center gap-4 py-3 px-2"},Ll={class:"flex flex-col"},Dl={class:"font-semibold text-gray-800"},Tl={class:"text-xs text-gray-600"},Al={key:0,class:"px-3 rounded-b-lg !text-[13px] items-center text-gray-600 flex gap-1 bg-gray-100 py-1.5"},Vl={class:"text-xs text-gray-500"},Nl={class:"flex items-center"},Pl={class:"flex gap-2 items-center"},zl={class:"flex gap-2 items-center"},Bl={class:"flex gap-2 items-center"},Fl={key:1},Il={key:1,class:"space-y-1 pl-9"},jl={key:2,class:"px-3 pb-3 nc-comment-input !rounded-br-2xl gap-2 flex"},Ul={class:"flex items-center gap-2 text-gray-400"},Hl=ht(()=>v("span",{class:"<lg:hidden"}," Audits ",-1)),Kl={key:1,class:"flex items-center gap-2"},Wl=ht(()=>v("span",{class:"<lg:hidden"}," Audits ",-1)),Yl={class:"h-full pb-1"},ql={key:0,class:"flex flex-col items-center justify-center w-full h-full"},Gl={key:0,class:"flex flex-col text-center justify-center h-full"},Xl={class:"text-center text-3xl text-gray-600"},Zl=ht(()=>v("div",{class:"font-bold text-center my-1 text-gray-600"},"See changes to this record",-1)),Ql={class:"group gap-3 overflow-hidden px-3 py-2 hover:bg-gray-100"},Jl={class:"flex items-start justify-between"},eo={class:"flex items-start gap-3 flex-1 w-full"},to={class:"flex h-[28px] items-center gap-3 w-[calc(100%_-_40px)]"},ao={class:"truncate text-gray-800 font-medium !text-small !leading-[18px] overflow-hidden"},no={class:"bg-white rounded-lg"},lo={class:"flex items-center gap-4 py-3 px-2"},oo={class:"flex flex-col"},so={class:"font-semibold text-gray-800"},ro={class:"text-xs text-gray-600"},io={key:0,class:"px-3 rounded-b-lg !text-[13px] items-center text-gray-600 flex gap-1 bg-gray-100 py-1.5"},co={class:"text-xs text-gray-500"},uo={class:"!text-[13px] text-gray-500 !leading-5 !pl-9"},vo=lt({__name:"Comments",props:{loading:{type:Boolean},primaryKey:{}},setup(l){const t=l,{loadComments:i,deleteComment:O,comments:x,resolveComment:de,audits:Q,isAuditLoading:B,saveComment:A,updateComment:$}=vl(),{isExpandedFormCommentMode:G}=nt(Ma()),I=E(),se=E(),h=E(""),{copy:ue}=pa(),Re=ya(),{dashboardUrl:J}=Ea(),{user:oe,appInfo:me}=ha(),C=fa(),{basesUser:Ee}=nt(C),s=ze(wa,E()),w=Me(()=>{var c,d;return(c=s.value)!=null&&c.base_id?Ee.value.get((d=s.value)==null?void 0:d.base_id)||[]:[]}),K=Me(()=>t.loading),pe=E("comments"),{isUIAllowed:X}=At(),L=ma(),y=Me(()=>X("commentEdit")),u=E(),F=E(!1),ee=E(!1),ae=E(null);async function _e(){var d;if(!F.value||!((d=u.value)!=null&&d.comment))return;for(;u.value.comment.endsWith("<br />")||u.value.comment.endsWith(`
`);)u.value.comment.endsWith("<br />")?u.value.comment=u.value.comment.slice(0,-6):u.value.comment=u.value.comment.slice(0,-2);ee.value=!0;const c={...u.value};F.value=!1,u.value=void 0,await $(c.id,{comment:c.comment}),i()}function m(c){F.value&&(c.preventDefault(),c.stopPropagation(),u.value=void 0,i(),F.value=!1,u.value=void 0)}function o(c){u.value={...c},F.value=!0,He(()=>{j(c.id)})}const _=Me({get(){var c;return((c=u.value)==null?void 0:c.comment)||""},set(c){u.value&&(u.value.comment=c)}});function g(){I.value&&I.value.scrollTo({top:I.value.scrollHeight,behavior:"smooth"})}const P=async()=>{var d,f,D,k;if(!h.value.trim())return;for(;h.value.endsWith("<br />")||h.value.endsWith(`
`);)h.value.endsWith("<br />")?h.value=h.value.slice(0,-6):h.value=h.value.slice(0,-2);ee.value=!0,x.value=[...x.value,{id:`temp-${new Date().getTime()}`,comment:h.value,created_at:new Date().toISOString(),created_by:(d=oe.value)==null?void 0:d.id,created_by_email:(f=oe.value)==null?void 0:f.email,created_display_name:((D=oe.value)==null?void 0:D.display_name)??""}];const c=h.value;h.value="",(k=se==null?void 0:se.value)==null||k.setEditorContent("",!0),await He(()=>{g()});try{await A(c),await He(()=>{G.value=!0}),g()}catch(N){console.error(N)}},W=async c=>{var d;await ue(encodeURI(`${J==null?void 0:J.value}#/${Re.params.typeOrId}/${Re.params.baseId}/${(d=s.value)==null?void 0:d.id}?rowId=${t.primaryKey}&commentId=${c.id}`))};function j(c){const d=document.querySelector(`.${c}`);d&&d.scrollIntoView({behavior:"smooth",block:"center"})}Be(I,()=>{setTimeout(()=>{He(()=>{const c=L.currentRoute.value.query,d=c.commentId;d?(L.push({query:{rowId:c.rowId}}),j(d),ae.value=d,da(document.querySelector(`.${ae.value}`),be)):g()})},100)});const re=c=>{var d,f;return c.created_by===((d=oe.value)==null?void 0:d.id)?"You":(f=c.created_display_name)!=null&&f.trim()?c.created_display_name||"Shared source":c.created_by_email?c.created_by_email:"Shared source"},ne=c=>{var d,f;return c.user===((d=oe.value)==null?void 0:d.email)?"You":(f=c.created_display_name)!=null&&f.trim()?c.created_display_name||"Shared source":c.user?c.user:"Shared source"},ye=c=>{const d=w.value.find(f=>f.email===c);return d?d.roles||qt.NO_ACCESS:qt.NO_ACCESS},U=c=>c.updated_at!==c.created_at&&c.updated_at?`[(edited)](a~~~###~~~Edited_${Mt(c.updated_at).replace(" ","_")}) `:"";function be(){ae.value&&(ae.value=null)}return(c,d)=>{const f=Dt,D=an,k=hn,N=wn,z=Sa,H=Tt,V=Ca,ce=ka,Ve=$a,he=_a,ie=cl,xe=nn,Oe=hl,ve=On,le=mt("e"),Qe=mt("dompurify-html");return n(),R("div",wl,[r(ve,{activeKey:e(pe),"onUpdate:activeKey":d[5]||(d[5]=S=>Ge(pe)?pe.value=S:null),class:"h-full"},{default:p(()=>[r(xe,{key:"comments",class:"w-full h-full"},{tab:p(()=>[Se((n(),R("div",_l,[r(f,{icon:"messageCircle",class:"w-4 h-4"}),xl])),[[le,["c:row-expand:comment"]]])]),default:p(()=>[v("div",{class:ke(["h-full",{"pb-1":!e(y)}])},[e(K)?(n(),R("div",gl,[r(D,{size:"xlarge"})])):(n(),R("div",bl,[e(x).length===0?(n(),R("div",Cl,[v("div",kl,[r(f,{icon:"commentHere"})]),v("div",$l,Y(e(y)?c.$t("activity.startCommenting"):c.$t("activity.noCommentsYet")),1)])):(n(),R("div",{key:1,ref_key:"commentsWrapperEl",ref:I,class:"flex flex-col h-full py-1 nc-scrollbar-thin"},[(n(!0),R(je,null,pt(e(x),S=>{var Ce,Je,et;return n(),R("div",{key:S.id,class:ke([`${S.id}`,"nc-comment-item"]),onMouseover:be},[v("div",{class:ke([{"hover:bg-gray-100":((Ce=e(u))==null?void 0:Ce.id)!==S.id,"nc-hovered-comment bg-gray-100":e(ae)===S.id},"group gap-3 overflow-hidden px-3 py-2 transition-colors"])},[v("div",Sl,[v("div",{class:ke(["flex items-start gap-3 flex-1",{"w-[calc(100%)] group-hover:w-[calc(100%_-_50px)]":!e(me).ee,"w-[calc(100%_-_44px)] group-hover:w-[calc(100%_-_72px)]":e(me).ee&&S.resolved_by,"w-[calc(100%_-_16px)] group-hover:w-[calc(100%_-_72px)]":e(me).ee&&!S.resolved_by&&e(y),"w-[calc(100%_-_16px)] group-hover:w-[calc(100%_-_44px)]":e(me).ee&&!S.resolved_by&&!e(y)}])},[r(k,{email:S.created_by_email,name:S.created_display_name,class:"mt-0.5",size:"medium"},null,8,["email","name"]),v("div",Rl,[r(z,{placement:"topLeft",trigger:["hover"],class:"flex-none max-w-[calc(100%_-_72px)]"},{overlay:p(()=>[v("div",El,[v("div",Ol,[r(k,{class:"!w-8 !h-8 border-1 border-gray-200 rounded-full",name:S.created_display_name,email:S.created_by_email},null,8,["name","email"]),v("div",Ll,[v("div",Dl,Y(re(S)),1),v("div",Tl,Y(S.created_by_email),1)])]),e(X)("dataEdit")?(n(),R("div",Al,[we(" Has "),r(N,{size:"sm",border:!1,role:ye(S.created_by_email)},null,8,["role"]),we(" role in base ")])):q("",!0)])]),default:p(()=>[v("div",Ml,Y(re(S)),1)]),_:2},1024),v("div",Vl,Y(("timeAgo"in c?c.timeAgo:e(Mt))(S.created_at)),1)])],2),v("div",Nl,[e(u)?q("",!0):(n(),T(z,{key:0,class:"nc-comment-more-actions !hidden !group-hover:block","overlay-class-name":"!min-w-[160px]",placement:"bottomRight"},{overlay:p(()=>[r(Ve,null,{default:p(()=>[e(oe)&&S.created_by_email===e(oe).email&&e(y)?Se((n(),T(V,{key:0,class:"text-gray-700",onClick:Ne=>o(S)},{default:p(()=>[v("div",Pl,[(n(),T(Te(("iconMap"in c?c.iconMap:e(Pe)).rename),{class:"cursor-pointer"})),we(" "+Y(c.$t("general.edit")),1)])]),_:2},1032,["onClick"])),[[le,["c:comment-expand:comment:edit"]]]):q("",!0),Se((n(),T(V,{class:"text-gray-700",onClick:Ne=>W(S)},{default:p(()=>[v("div",zl,[(n(),T(Te(("iconMap"in c?c.iconMap:e(Pe)).copy),{class:"cursor-pointer"})),we(" "+Y(c.$t("general.copy"))+" URL ",1)])]),_:2},1032,["onClick"])),[[le,["c:comment-expand:comment:copy"]]]),e(oe)&&S.created_by_email===e(oe).email&&e(y)?(n(),R(je,{key:1},[r(ce),Se((n(),T(V,{class:"!text-red-500 !hover:bg-red-50",onClick:Ne=>e(O)(S.id)},{default:p(()=>[v("div",Bl,[(n(),T(Te(("iconMap"in c?c.iconMap:e(Pe)).delete),{class:"cursor-pointer"})),we(" "+Y(c.$t("general.delete")),1)])]),_:2},1032,["onClick"])),[[le,["c:row-expand:comment:delete"]]])],64)):q("",!0)]),_:2},1024)]),default:p(()=>[r(H,{class:"nc-expand-form-more-actions !hover:bg-gray-200 !w-7 !h-7 !bg-transparent",size:"xsmall",type:"text"},{default:p(()=>[r(f,{class:"text-md",icon:"threeDotVertical"})]),_:1})]),_:2},1024)),e(me).ee?(n(),R("div",Fl,[!S.resolved_by&&e(y)?(n(),T(he,{key:0},{title:p(()=>[we("Click to resolve ")]),default:p(()=>[r(H,{class:"nc-resolve-comment-btn !w-7 !h-7 !bg-transparent !hover:bg-gray-200 !hidden !group-hover:block",size:"xsmall",type:"text",onClick:Ne=>e(de)(S.id)},{default:p(()=>[r(f,{class:"text-md",icon:"checkCircle"})]),_:2},1032,["onClick"])]),_:2},1024)):S.resolved_by?(n(),T(he,{key:1},{title:p(()=>[we(Y(`Resolved by ${S.resolved_display_name}`),1)]),default:p(()=>[r(H,{class:"!h-7 !w-7 !bg-transparent !hover:bg-gray-200 text-semibold",size:"xsmall",type:"text",onClick:Ne=>e(de)(S.id)},{default:p(()=>[r(f,{class:"text-md rounded-full bg-[#17803D] text-white",icon:"checkFill"})]),_:2},1032,["onClick"])]),_:2},1024)):q("",!0)])):q("",!0)])]),v("div",{class:ke([{"mt-3":S.id===((Je=e(u))==null?void 0:Je.id)},"flex-1 flex flex-col gap-1 max-w-[calc(100%)]"])},[S.id===((et=e(u))==null?void 0:et.id)&&e(y)?(n(),T(ie,{key:0,value:e(_),"onUpdate:value":d[0]||(d[0]=Ne=>Ge(_)?_.value=Ne:null),autofocus:"","hide-options":!1,class:"expanded-form-comment-edit-input cursor-text expanded-form-comment-input !py-2 !px-2 !m-0 w-full !border-1 !border-gray-200 !rounded-lg !bg-white !text-gray-800 !text-small !leading-18px !max-h-[240px]","data-testid":"expanded-form-comment-input","sync-value-change":"",onSave:_e,onKeydown:[St(m,["esc"]),St(ut(_e,["exact","prevent"]),["enter"])],onBlur:d[1]||(d[1]=()=>{u.value=void 0,F.value=!1})},null,8,["value","onKeydown"])):(n(),R("div",Il,[r(ie,{value:`${S.comment}  ${U(S)}`,class:"!text-small !leading-18px !text-gray-800 -ml-1","read-only":"","sync-value-change":""},null,8,["value"])]))],2)],2)],34)}),128))],512)),e(y)?(n(),R("div",jl,[r(ie,{ref_key:"commentInputRef",ref:se,value:e(h),"onUpdate:value":d[2]||(d[2]=S=>Ge(h)?h.value=S:null),"hide-options":!1,placeholder:"Comment...",class:"expanded-form-comment-input !py-2 !px-2 cursor-text border-1 rounded-lg w-full bg-transparent !text-gray-800 !text-small !leading-18px !max-h-[240px]",autofocus:e(G),"data-testid":"expanded-form-comment-input",onFocus:d[3]||(d[3]=S=>G.value=!1),onKeydown:[d[4]||(d[4]=ut(()=>{},["stop"])),St(ut(P,["exact","prevent"]),["enter"])],onSave:P},null,8,["value","autofocus","onKeydown"])])):q("",!0)]))],2)]),_:1}),r(xe,{key:"audits",class:"w-full",disabled:e(me).ee},{tab:p(()=>[e(me).ee?(n(),T(he,{key:0,class:"tab flex-1"},{title:p(()=>[we(Y(c.$t("title.comingSoon")),1)]),default:p(()=>[Se((n(),R("div",Ul,[r(f,{icon:"audit",class:"w-4 h-4"}),Hl])),[[le,["c:row-expand:audit"]]])]),_:1})):Se((n(),R("div",Kl,[r(f,{icon:"audit",class:"w-4 h-4"}),Wl])),[[le,["c:row-expand:audit"]]])]),default:p(()=>[v("div",Yl,[e(K)||e(B)?(n(),R("div",ql,[r(D,{size:"xlarge"})])):(n(),R("div",{key:1,ref_key:"commentsWrapperEl",ref:I,class:"flex flex-col h-full py-1 nc-scrollbar-thin"},[e(Q).length===0?(n(),R("div",Gl,[v("div",Xl,[r(Oe)]),Zl])):q("",!0),(n(!0),R(je,null,pt(e(Q),S=>(n(),R("div",{key:S.id,class:"nc-audit-item"},[v("div",Ql,[v("div",Jl,[v("div",eo,[r(k,{email:S.created_by_email,name:S.created_display_name,class:"mt-0.5",size:"medium"},null,8,["email","name"]),v("div",to,[r(z,{placement:"topLeft",trigger:["hover"],class:"flex-none max-w-[calc(100%_-_72px)]"},{overlay:p(()=>[v("div",no,[v("div",lo,[r(k,{class:"!w-8 !h-8 border-1 border-gray-200 rounded-full",name:S.created_display_name,email:S.created_by_email},null,8,["name","email"]),v("div",oo,[v("div",so,Y(ne(S)),1),v("div",ro,Y(S.created_by_email),1)])]),e(X)("dataEdit")?(n(),R("div",io,[we(" Has "),r(N,{size:"sm",border:!1,role:ye(S.created_by_email)},null,8,["role"]),we(" role in base ")])):q("",!0)])]),default:p(()=>[v("div",ao,Y(ne(S)),1)]),_:2},1024),v("div",co,Y(("timeAgo"in c?c.timeAgo:e(Mt))(S.created_at)),1)])])]),Se(v("div",uo,null,512),[[Qe,S.details]])])]))),128))],512))])]),_:1},8,["disabled"])]),_:1},8,["activeKey"])])}}}),fo=ba(vo,[["__scopeId","data-v-7b264b92"]]),mo={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},po=v("path",{fill:"currentColor",d:"M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6z"},null,-1),yo=[po];function ho(l,t){return n(),R("svg",mo,[...yo])}const wo={name:"mdi-chevron-down",render:ho},_o=Xe(()=>Ze(()=>import("./DxURyUlp.js"),__vite__mapDeps([4,1,2,5,6,7,8]),import.meta.url).then(l=>l.default||l)),xo=Xe(()=>Ze(()=>import("./Bpv-SMS-.js"),__vite__mapDeps([9,1,2,7,10,11]),import.meta.url).then(l=>l.default||l)),go=Xe(()=>Ze(()=>import("./DDMaMTJB.js"),__vite__mapDeps([12,1,2,13,6,14]),import.meta.url).then(l=>l.default||l)),bo=Xe(()=>Ze(()=>import("./BPzsK8fx.js"),__vite__mapDeps([15,1,2,7,6,16]),import.meta.url).then(l=>l.default||l)),Co=Xe(()=>Ze(()=>import("./utCgnnET.js"),__vite__mapDeps([17,1,2,18,19,20,7,21,10,6,22]),import.meta.url).then(l=>l.default||l)),ko=Xe(()=>Ze(()=>import("./CUmqjySl.js"),__vite__mapDeps([23,1,2,24]),import.meta.url).then(l=>l.default||l)),Vt=l=>(xa("data-v-2787654f"),l=l(),ga(),l),$o={class:"h-[85vh] xs:max-h-full xs:h-full max-h-215 flex flex-col"},So={key:0,class:"flex-none h-4 flex items-center justify-center"},Ro=Vt(()=>v("div",{class:"w-[72px] h-[2px] rounded-full bg-[#49494a]"},null,-1)),Mo=[Ro],Eo={class:"flex min-h-7 flex-shrink-0 w-full items-center nc-expanded-form-header relative p-4 xs:px-2 xs:py-0 xs:min-h-[48px] justify-between"},Oo={class:"flex-1 flex gap-4 lg:w-100 <lg:max-w-[calc(100%_-_178px)] xs:max-w-[calc(100%_-_44px)]"},Lo={class:"flex gap-2"},Do={key:0,class:"flex items-center"},To={key:0,class:"flex items-center truncate font-bold text-gray-800 text-base overflow-hidden"},Ao={key:1,class:"flex items-center font-bold text-gray-800 text-base max-w-[300px] xs:w-auto xs:max-w-[calc(100%_-_82px)] overflow-hidden"},Vo={class:"truncate"},No={class:"flex gap-2"},Po={class:"xs:px-1"},zo={"data-testid":"nc-expanded-form-copy-url",class:"flex items-center"},Bo={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},Fo={"data-testid":"nc-expanded-form-copy-url",class:"flex gap-2 items-center"},Io={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-duplicate"},jo={class:"-ml-0.25"},Uo={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-delete"},Ho={class:"-ml-0.25"},Ko=["col-id","data-testid"],Wo={class:"flex items-start flex-row sm:gap-x-2 <lg:flex-col <lg:w-full nc-expanded-cell min-h-[37px]"},Yo={class:"w-45 <lg:w-full <lg:px-0 <lg:mb-1 h-[37px] xs:h-auto flex items-center rounded-lg overflow-hidden"},qo={key:0,class:"flex w-full <lg:px-1 items-center py-6"},Go=Vt(()=>v("div",{class:"flex-grow h-px mr-1 bg-gray-100"},null,-1)),Xo=Vt(()=>v("div",{class:"flex-grow h-px ml-1 bg-gray-100"},null,-1)),Zo=["data-testid"],Qo={class:"flex items-start flex-row sm:gap-x-2 <lg:flex-col <lg:w-full nc-expanded-cell min-h-[37px]"},Jo={class:"w-45 <lg:w-full <lg:px-0 h-[37px] xs:h-auto flex items-center rounded-lg overflow-hidden"},es={key:0,class:"p-2"},ts={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-reload"},as={class:"flex gap-2 items-center","data-testid":"nc-expanded-form-copy-url"},ns={"data-testid":"nc-expanded-form-delete"},ls={key:1},os={key:2,class:"p-2"},ss={class:"xs:px-1"},rs={key:1,class:"p-2"},is={class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700"},cs={class:"text-ellipsis overflow-hidden select-none w-full pl-1.75 break-keep whitespace-nowrap"},ds={class:""},us={class:"flex flex-row items-center gap-x-2 text-base font-bold"},vs={class:"flex font-medium mt-2"},fs={class:"flex flex-row justify-end gap-x-2 mt-5"},ms={name:"ExpandedForm"},ps=lt({...ms,props:{modelValue:{type:Boolean},state:{},meta:{},loadRow:{type:Boolean},useMetaFields:{type:Boolean},row:{},rowId:{},view:{},showNextPrevIcons:{type:Boolean},firstRow:{type:Boolean},lastRow:{type:Boolean},closeAfterSave:{type:Boolean},newRecordHeader:{},skipReload:{type:Boolean},newRecordSubmitBtnText:{},expandForm:{type:Function}},emits:["update:modelValue","cancel","next","prev","createdRecord","updateRowCommentCount"],setup(l,{emit:t}){const i=l,O=t,{activeView:x}=nt(ln()),de=E(0),Q=E(),{dashboardUrl:B}=Ea(),{copy:A}=pa(),{isMobileMode:$}=ha(),{t:G}=ua(),I=at(i,"rowId"),se=at(i,"row"),h=at(i,"state"),ue=at(i,"meta"),Re=at(i,"lastRow"),J=at(i,"firstRow"),oe=ya(),me=ze(va,E(!1)),C=E(!1),Ee=E(!1),s=E(!1),{isUIAllowed:w}=At(),K=Me(()=>!w("dataEdit")||me.value),pe=E(),X=ze(vt,ct()),L=ze(on,ct()),{addOrEditStackRow:y}=Ra(),{isExpandedFormCommentMode:u}=nt(Ma());rt(sn,void 0);const F=a=>{O(a),g.value=!0},ee=rn(vn,a=>i.useMetaFields?(ue.value.columns??[]).filter(b=>!Rt(b)):(a==null?void 0:a.value)??[]),ae=Me(()=>{var a,b;return((b=(a=ue.value)==null?void 0:a.columns)==null?void 0:b.find(Z=>Z.pv&&ee.value.includes(Z)))??null}),_e=Me(()=>{var a;return(((a=ue.value)==null?void 0:a.columns)??[]).filter(b=>{var Z;return!((Z=ee.value)!=null&&Z.includes(b))}).filter(b=>!Rt(b))}),m=E(!1),o=()=>{m.value=!m.value},_=ze(cn,E(!1));rt(wa,ue);const g=E(!0),P=E(!1),{commentsDrawer:W,changedColumns:j,deleteRowById:re,displayValue:ne,state:ye,isNew:U,loadRow:be,primaryKey:c,row:d,comments:f,save:D,loadComments:k,loadAudits:N,clearColumns:z}=dl(ue,se);L.on(async()=>{await be(I.value,!1,!0)});const H=E(!1);Nn(E({}),ue),Pn(ue),Be(h,()=>{h.value?ye.value=h.value:ye.value={}},{immediate:!0});const V=ca(i,"modelValue",O,{defaultValue:!1}),ce=()=>{var a,b;w("dataEdit")?j.value.size>0?xe.value=!0:((b=(a=d.value)==null?void 0:a.rowMeta)!=null&&b.new&&O("cancel"),V.value=!1):V.value=!1},Ve=()=>{H.value=!0,C.value=!0,Ee.value=!0;const a={...d.value.row};delete a.ncRecordId;const b=Object.assign({},{row:a,oldRow:{},rowMeta:{new:!0}});setTimeout(async()=>{d.value=b,H.value=!1,$e.success(G("msg.success.rowDuplicatedWithoutSavedYet"))},500)},he=async()=>{var a,b;P.value=!0;try{let Z;((a=x.value)==null?void 0:a.type)===it.KANBAN&&(Z=(fe,Le)=>{y(fe,Le)}),U.value?await D(ye.value,void 0,{kanbanClbk:Z}):(await D(void 0,void 0,{kanbanClbk:Z}),be()),i.skipReload||(X==null||X.trigger(),L==null||L.trigger()),C.value=!1,i.closeAfterSave?V.value=!1:Ee.value&&(Ie(d.value.row,ue.value.columns)!==I.value&&((b=i==null?void 0:i.expandForm)==null||b.call(i,d.value)),setTimeout(()=>{Ee.value=!1},500)),O("createdRecord",d.value.row)}catch(Z){U.value?$e.error(`Add row failed: ${await Ae(Z)}`):$e.error(`${G("msg.error.rowUpdateFailed")}: ${await Ae(Z)}`)}P.value=!1},ie=E(!1),xe=E(!1),Oe=()=>{var a,b,Z,fe;ie.value&&(F("next"),(b=(a=d.value)==null?void 0:a.rowMeta)!=null&&b.new&&O("cancel"),ie.value=!1),xe.value&&(xe.value=!1,(fe=(Z=d.value)==null?void 0:Z.rowMeta)!=null&&fe.new&&O("cancel"),V.value=!1),z()},ve=async()=>{if(j.value.size>0){ie.value=!0;return}F("next")},le=async()=>{var a;await A(encodeURI(`${B==null?void 0:B.value}#/${oe.params.typeOrId}/${oe.params.baseId}/${(a=ue.value)==null?void 0:a.id}${i.view?`/${i.view.title}`:""}?rowId=${c.value}`)),s.value=!0},Qe=async()=>{ie.value&&(C.value=!1,await he(),F("next"),ie.value=!1),xe.value&&(xe.value=!1,await he(),V.value=!1)},S=ze(vt,ct()),Ce=ct();if(Ce.on(()=>{S==null||S.trigger({shouldShowLoading:!1}),!U.value&&be(null,!0)}),rt(vt,Ce),_.value&&d.value.rowMeta.new)for(const[a,b]of Object.entries(d.value.row))b&&j.value.add(a);rt(dn,V);const Je=async a=>{await Promise.allSettled([k(a),N(a),be(a)]),g.value=!1},et=E();yt(async()=>{s.value=!1,g.value=!0;const a=!u.value;let b=!1;i.loadRow&&!i.rowId?(await Je(),b=!0):i.rowId&&i.loadRow&&!b?await Je(i.rowId):d.value=i.row,g.value=!1,a&&U.value&&setTimeout(()=>{var Z,fe,Le;(Le=(fe=(Z=et.value)==null?void 0:Z.$el)==null?void 0:fe.querySelector("input,select,textarea"))==null||Le.focus()},300)});const Ne=()=>{setTimeout(async()=>{d.value={row:{},oldRow:{},rowMeta:{new:!0}},ye.value={},de.value++,V.value=!0},500)};zn(V,async a=>{var b,Z,fe;if(a.altKey)if(a.key==="ArrowLeft")a.stopPropagation(),F("prev");else if(a.key==="ArrowRight")a.stopPropagation(),ve();else if(a.code==="KeyS"){(b=document.activeElement)==null||b.blur(),a.stopPropagation();try{U.value?(await D(ye.value),Ce==null||Ce.trigger(null)):(await he(),Ce==null||Ce.trigger(null))}catch(Le){U.value?$e.error(`Add row failed: ${await Ae(Le)}`):$e.error(`${G("msg.error.rowUpdateFailed")}: ${await Ae(Le)}`)}}else a.code==="KeyN"&&((fe=(Z=document.activeElement)==null?void 0:Z.blur)==null||fe.call(Z),j.value.size>0?Gt.confirm({title:G("msg.saveChanges"),okText:G("general.save"),cancelText:G("labels.discard"),onOk:async()=>{await he(),Ce==null||Ce.trigger(null),Ne()},onCancel:()=>{Ne()}}):U.value?Gt.confirm({title:"Do you want to save the record?",okText:G("general.save"),cancelText:G("labels.discard"),onOk:async()=>{try{await D(ye.value),Ce==null||Ce.trigger(null),Ne()}catch(Le){$e.error(`${G("msg.error.rowUpdateFailed")}: ${await Ae(Le)}`)}},onCancel:()=>{Ne()}}):Ne())},{immediate:!0});const tt=E(!1),Nt=()=>{tt.value=!0},Da=async()=>{tt.value=!1,V.value=!1,await re(c.value||void 0),$e.success(G("msg.rowDeleted")),await L.trigger({shouldShowLoading:!1}),ce(),tt.value=!1};Be(I,async a=>{await Je(a)});const wt=Me(()=>!U.value&&W.value&&w("commentList")),dt=Me({get:()=>xe.value||ie.value,set:a=>{xe.value=a}}),Ta=a=>{let b=!1;document.querySelectorAll(".ant-select-dropdown").forEach(Z=>{b=b||Z.checkVisibility()}),!b&&(j.value.size===0&&!C.value?(V.value=a,_.value&&O("cancel")):!a&&w("dataEdit")?dt.value=!0:V.value=a)},_t=a=>Bn(a)||Et(a)||Fn(a)||In(a)||jn(a)||Rt(a)||fn(a)||mn(a);Be([pe,g],()=>{if($.value)return;const a=pe.value;a&&!g.value&&(a.scrollTop=a.scrollHeight,setTimeout(()=>{a.scrollTop=0},125))});const Aa=Me(()=>$.value?{placement:"bottom"}:{}),xt=()=>pn()?"⌥":"ALT";return Be(()=>f.value.length,a=>{O("updateRowCommentCount",a)}),(a,b)=>{const Z=Dt,fe=Tt,Le=_a,gt=Un,Pt=_o,We=Ca,zt=ka,Bt=$a,Ft=Sa,It=xo,jt=go,Ut=bo,Ht=Co,Va=yn,Na=ko,Pa=fo,za=Vn,Fe=mt("e");return n(),R(je,null,[(n(),T(Te(e($)?e(ll):Qt),un({"body-style":{padding:0},class:[{active:e(V)},"nc-drawer-expanded-form"],closable:!1,footer:null,visible:e(V),width:e(W)&&e(w)("commentList")?"min(80vw,1280px)":"min(70vw,768px)",size:e($)?"medium":"small"},e(Aa),{"onUpdate:visible":Ta}),{default:p(()=>{var Ue,Kt,Wt;return[v("div",$o,[e($)?(n(),R("div",So,[v("div",{class:"flex-none h-full flex items-center justify-center cursor-pointer",onClick:ce},Mo)])):q("",!0),v("div",Eo,[v("div",Oo,[v("div",Lo,[i.showNextPrevIcons?(n(),T(Le,{key:0},{title:p(()=>[we(Y(xt())+" + ← ",1)]),default:p(()=>[r(fe,{disabled:e(J)||e(g),class:"nc-prev-arrow !w-7 !h-7 !text-gray-500 !disabled:text-gray-300",type:"text",size:"xsmall",onClick:b[0]||(b[0]=M=>F("prev"))},{default:p(()=>[r(Z,{icon:"chevronDown",class:"transform rotate-180"})]),_:1},8,["disabled"])]),_:1})):q("",!0),i.showNextPrevIcons?(n(),T(Le,{key:1},{title:p(()=>[we(Y(xt())+" + → ",1)]),default:p(()=>[r(fe,{disabled:e(Re)||e(g),class:"nc-next-arrow !w-7 !h-7 !text-gray-500 !disabled:text-gray-300",type:"text",size:"xsmall",onClick:ve},{default:p(()=>[r(Z,{icon:"chevronDown"})]),_:1},8,["disabled"])]),_:1})):q("",!0)]),e(g)?(n(),R("div",Do,[r(gt,{active:"",class:"!h-6 !sm:mr-14 !w-52 !rounded-md !overflow-hidden",size:"small"})])):(n(),R("div",{key:1,class:ke(["flex-1 flex items-center gap-3 max-w-[calc(100%_-_108px)] xs:flex-row-reverse xs:justify-end",{"xs:max-w-[calc(100%_-_52px)]":e(U),"xs:max-w-[calc(100%_-_82px)]":!e(U)}])},[(Ue=e(se).rowMeta)!=null&&Ue.new||i.newRecordHeader?(n(),R("div",To,Y(i.newRecordHeader??a.$t("activity.newRecord")),1)):e(ne)&&!((Wt=(Kt=e(se))==null?void 0:Kt.rowMeta)!=null&&Wt.new)?(n(),R("div",Ao,[v("span",Vo,[r(Pt,{modelValue:e(ne),"onUpdate:modelValue":b[1]||(b[1]=M=>Ge(ne)?ne.value=M:null),column:e(ae)},null,8,["modelValue","column"])])])):q("",!0)],2))]),v("div",No,[!e($)&&e(w)("dataEdit")?(n(),T(Le,{key:0},{title:p(()=>[we(Y(xt())+" + S ",1)]),default:p(()=>[Se((n(),T(fe,{disabled:e(j).size===0&&!e(C),loading:e(P),class:"nc-expand-form-save-btn !xs:text-base !h-7 !px-2","data-testid":"nc-expanded-form-save",type:"primary",size:"xsmall",onClick:he},{default:p(()=>[v("div",Po,Y(a.newRecordSubmitBtnText??"Save Record"),1)]),_:1},8,["disabled","loading"])),[[Fe,["c:row-expand:save"]]])]),_:1})):q("",!0),r(Le,null,{title:p(()=>[we(Y(e(s)?a.$t("labels.copiedRecordURL"):a.$t("labels.copyRecordURL")),1)]),default:p(()=>[!e(U)&&e(I)&&!e($)?(n(),T(fe,{key:0,disabled:e(g),class:"!<lg:hidden text-gray-700 !h-7 !w-7",type:"text",size:"xsmall",onClick:b[2]||(b[2]=M=>le())},{default:p(()=>[Se((n(),R("div",zo,[e(s)?(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).check),{key:0,class:"cursor-pointer nc-duplicate-row h-4 w-4"})):(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).copy),{key:1,class:"cursor-pointer nc-duplicate-row h-4 w-4"}))])),[[Fe,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):q("",!0)]),_:1}),!e(U)&&e(I)&&!e($)?(n(),T(Ft,{key:1,placement:"bottomRight"},{overlay:p(()=>[r(Bt,null,{default:p(()=>[r(We,{class:"text-gray-700",onClick:b[3]||(b[3]=M=>e(be)())},{default:p(()=>[Se((n(),R("div",Bo,[(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).reload),{class:"cursor-pointer"})),we(" "+Y(a.$t("general.reload")),1)])),[[Fe,["c:row-expand:reload"]]])]),_:1}),!e(U)&&e(I)?(n(),T(We,{key:0,type:"secondary",class:"!lg:hidden text-gray-700",disabled:e(g),onClick:b[4]||(b[4]=M=>le())},{default:p(()=>[Se((n(),R("div",Fo,[(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).copy),{class:"cursor-pointer"})),we(" "+Y(a.$t("labels.copyRecordURL")),1)])),[[Fe,["c:row-expand:copy-url"]]])]),_:1},8,["disabled"])):q("",!0),e(w)("dataEdit")?(n(),T(We,{key:1,class:"text-gray-700",onClick:b[5]||(b[5]=M=>e(U)?()=>{}:Ve())},{default:p(()=>[Se((n(),R("div",Io,[(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).duplicate),{class:"cursor-pointer nc-duplicate-row"})),v("span",jo,Y(a.$t("labels.duplicateRecord")),1)])),[[Fe,["c:row-expand:duplicate"]]])]),_:1})):q("",!0),e(w)("dataEdit")?(n(),T(zt,{key:2})):q("",!0),e(w)("dataEdit")?(n(),T(We,{key:3,class:"!text-red-500 !hover:bg-red-50",onClick:b[6]||(b[6]=M=>!e(U)&&Nt())},{default:p(()=>[Se((n(),R("div",Uo,[(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).delete),{class:"cursor-pointer nc-delete-row"})),v("span",Ho,Y(a.$t("activity.deleteRecord")),1)])),[[Fe,["c:row-expand:delete"]]])]),_:1})):q("",!0)]),_:1})]),default:p(()=>[r(fe,{type:"text",size:"xsmall",class:"nc-expand-form-more-actions !w-7 !h-7",disabled:e(g)},{default:p(()=>[r(Z,{icon:"threeDotVertical",class:ke(["text-md",e(g)?"text-gray-300":"text-gray-700"])},null,8,["class"])]),_:1},8,["disabled"])]),_:1})):q("",!0),r(fe,{class:"nc-expand-form-close-btn !w-7 !h-7","data-testid":"nc-expanded-form-close",type:"text",size:"xsmall",onClick:ce},{default:p(()=>[r(Z,{class:"text-md text-gray-700 h-4 w-4",icon:"close"})]),_:1})])]),v("div",{ref_key:"wrapper",ref:Q,class:"flex flex-grow flex-row h-[calc(100%_-_4rem)] w-full border-t-1 border-gray-200"},[v("div",{class:ke([{"w-full":!e(wt),"flex-1":e(wt)},"h-full flex xs:w-full flex-col overflow-hidden"])},[v("div",{ref_key:"expandedFormScrollWrapper",ref:pe,class:"flex flex-col flex-grow gap-6 h-full max-h-full nc-scrollbar-thin items-center w-full p-4 xs:px-4 xs:pt-4 xs:pb-2 xs:gap-6 children:max-w-[588px] <lg:children:max-w-[450px]"},[(n(!0),R(je,null,pt(e(ee),(M,bt)=>Se((n(),R("div",{key:M.title,class:ke([`nc-expand-col-${M.title}`,"nc-expanded-form-row w-full"]),"col-id":M.id,"data-testid":`nc-expand-col-${M.title}`},[v("div",Wo,[v("div",Yo,[e(qe)(M)?(n(),T(It,{key:0,column:M,class:"nc-expanded-cell-header h-full flex-none"},null,8,["column"])):(n(),T(jt,{key:1,column:M,class:"nc-expanded-cell-header flex-none"},null,8,["column"]))]),e(g)?(n(),T(gt,{key:0,active:"",class:"h-[37px] flex-none <lg:!w-full lg:flex-1 !rounded-lg !overflow-hidden",size:"small"})):(n(),R(je,{key:1},[M.title?(n(),T(Va,{key:0,ref_for:!0,ref:bt?null:De=>et.value=De,class:ke(["bg-white flex-1 <lg:w-full px-1 min-h-[37px] flex items-center relative",{" !select-text nc-system-field":_t(M),"!select-text nc-readonly-div-data-cell":e(K)}])},{default:p(()=>[e(qe)(M)?(n(),T(Ut,{key:0,modelValue:e(d).row[M.title],"onUpdate:modelValue":De=>e(d).row[M.title]=De,class:ke({"px-1":_t(M)}),column:M,"read-only":e(K),row:e(d)},null,8,["modelValue","onUpdate:modelValue","class","column","read-only","row"])):(n(),T(Ht,{key:1,modelValue:e(d).row[M.title],"onUpdate:modelValue":[De=>e(d).row[M.title]=De,De=>e(j).add(M.title)],active:!0,column:M,"edit-enabled":!0,"read-only":e(K)},null,8,["modelValue","onUpdate:modelValue","column","read-only"]))]),_:2},1032,["class"])):q("",!0)],64))])],10,Ko)),[[Xt,("isFormula"in a?a.isFormula:e(Et))(M)||!e(qe)(M)||!e(U)||e(Zt)(M)]])),128)),e(_e).length>0?(n(),R("div",qo,[Go,r(fe,{size:e($)?"medium":"small",class:"flex-shrink !text-sm overflow-hidden !text-gray-500 !font-weight-500",type:"secondary",onClick:o},{default:p(()=>[we(Y(e(m)?`Hide ${e(_e).length} hidden`:`Show ${e(_e).length} hidden`)+" "+Y(e(_e).length>1?"fields":"field")+" ",1),r(e(wo),{class:ke([e(m)?"transform rotate-180":"","ml-1"])},null,8,["class"])]),_:1},8,["size"]),Xo])):q("",!0),e(_e).length>0&&e(m)?(n(!0),R(je,{key:1},pt(e(_e),(M,bt)=>Se((n(),R("div",{key:`${M.id}-${M.title}`,class:ke([`nc-expand-col-${M.title}`,"nc-expanded-form-row w-full"]),"data-testid":`nc-expand-col-${M.title}`},[v("div",Qo,[v("div",Jo,[e(qe)(M)?(n(),T(It,{key:0,column:M,"is-hidden-col":"",class:"nc-expanded-cell-header flex-none"},null,8,["column"])):(n(),T(jt,{key:1,column:M,"is-hidden-col":"",class:"nc-expanded-cell-header flex-none"},null,8,["column"]))]),e(g)?(n(),T(gt,{key:0,active:"",class:"h-[37px] flex-none <lg:!w-full lg:flex-1 !rounded-lg !overflow-hidden",size:"small"})):(n(),R(je,{key:1},[M.title?(n(),T(Na,{key:0,ref_for:!0,ref:bt?null:De=>et.value=De,class:ke(["bg-white flex-1 <lg:w-full px-1 min-h-[37px] flex items-center relative",{"!select-text nc-system-field":_t(M),"!bg-gray-50 !select-text nc-readonly-div-data-cell":e(K)}])},{default:p(()=>[e(qe)(M)?(n(),T(Ut,{key:0,modelValue:e(d).row[M.title],"onUpdate:modelValue":De=>e(d).row[M.title]=De,column:M,"read-only":e(K),row:e(d)},null,8,["modelValue","onUpdate:modelValue","column","read-only","row"])):(n(),T(Ht,{key:1,modelValue:e(d).row[M.title],"onUpdate:modelValue":[De=>e(d).row[M.title]=De,De=>e(j).add(M.title)],active:!0,column:M,"edit-enabled":!0,"read-only":e(K)},null,8,["modelValue","onUpdate:modelValue","column","read-only"]))]),_:2},1032,["class"])):q("",!0)],64))])],10,Zo)),[[Xt,("isFormula"in a?a.isFormula:e(Et))(M)||!e(qe)(M)||!e(U)||e(Zt)(M)]])),128)):q("",!0)],512),e(w)("dataEdit")?(n(),R("div",{key:0,class:ke(["w-full flex items-center justify-end px-2 xs:p-0 xs:gap-x-4 xs:justify-between",{"xs(border-t-1 border-gray-200)":!e(U)}])},[!e(U)&&e($)?(n(),R("div",es,[r(Ft,{placement:"bottomRight",class:"p-2"},{overlay:p(()=>[r(Bt,null,{default:p(()=>[r(We,{class:"text-gray-700",onClick:b[7]||(b[7]=M=>e(be)())},{default:p(()=>[Se((n(),R("div",ts,[(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).reload),{class:"cursor-pointer"})),we(" "+Y(a.$t("general.reload")),1)])),[[Fe,["c:row-expand:reload"]]])]),_:1}),e(I)?(n(),T(We,{key:0,class:"text-gray-700",onClick:b[8]||(b[8]=M=>e(U)?()=>{}:le())},{default:p(()=>[Se((n(),R("div",as,[(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).copy),{class:"cursor-pointer nc-duplicate-row"})),we(" "+Y(a.$t("labels.copyRecordURL")),1)])),[[Fe,["c:row-expand:copy-url"]]])]),_:1})):q("",!0),r(zt),e(w)("dataEdit")&&!e(U)?Se((n(),T(We,{key:1,class:"!text-red-500 !hover:bg-red-50",onClick:b[9]||(b[9]=M=>!e(U)&&Nt())},{default:p(()=>[v("div",ns,[(n(),T(Te(("iconMap"in a?a.iconMap:e(Pe)).delete),{class:"cursor-pointer nc-delete-row"})),we(" Delete record ")])]),_:1})),[[Fe,["c:row-expand:delete"]]]):q("",!0)]),_:1})]),default:p(()=>[r(fe,{disabled:e(g),class:"nc-expand-form-more-actions",type:"secondary",size:"small"},{default:p(()=>[r(Z,{class:ke([e(g)?"text-gray-300":"text-gray-700","text-md"]),icon:"threeDotVertical"},null,8,["class"])]),_:1},8,["disabled"])]),_:1})])):q("",!0),e(U)&&e($)?(n(),R("div",ls)):q("",!0),e($)?(n(),R("div",os,[Se((n(),T(fe,{disabled:e(j).size===0&&!e(C),loading:e(P),class:ke(["nc-expand-form-save-btn !xs:text-sm !px-2",{"!h-7":!e($)}]),"data-testid":"nc-expanded-form-save",type:"primary",size:e($)?"small":"xsmall",onClick:he},{default:p(()=>[v("div",ss,Y(a.newRecordSubmitBtnText??e(U)?"Create Record":"Save Record"),1)]),_:1},8,["disabled","loading","class","size"])),[[Fe,["c:row-expand:save"]]])])):q("",!0)],2)):(n(),R("div",rs))],2),e(wt)&&!e(Ee)?(n(),R("div",{key:0,class:ke([{active:e(W)&&e(w)("commentList")},"nc-comments-drawer border-l-1 relative border-gray-200 bg-gray-50 w-1/3 max-w-[340px] min-w-0 h-full xs:hidden rounded-br-2xl"])},[r(Pa,{"primary-key":e(c),loading:e(g)},null,8,["primary-key","loading"])],2)):q("",!0)],512)])]}),_:1},16,["class","visible","width","size"])),r(za,{visible:e(tt),"onUpdate:visible":b[11]||(b[11]=Ue=>Ge(tt)?tt.value=Ue:null),"entity-name":"Record","on-delete":()=>Da()},{"entity-preview":p(()=>[v("span",null,[v("div",is,[v("div",cs,[r(Pt,{modelValue:e(ne),"onUpdate:modelValue":b[10]||(b[10]=Ue=>Ge(ne)?ne.value=Ue:null),column:e(ae)},null,8,["modelValue","column"])])])])]),_:1},8,["visible","on-delete"]),r(Qt,{visible:e(dt),"onUpdate:visible":b[12]||(b[12]=Ue=>Ge(dt)?dt.value=Ue:null),size:"small"},{default:p(()=>[v("div",ds,[v("div",us,Y(a.$t("tooltip.saveChanges")),1),v("div",vs,Y(a.$t("activity.doYouWantToSaveTheChanges")),1),v("div",fs,[r(fe,{type:"secondary",size:"small",onClick:Oe},{default:p(()=>[we(Y(a.$t("labels.discard")),1)]),_:1}),r(fe,{key:"submit",type:"primary",size:"small",loading:e(P),onClick:Qe},{default:p(()=>[we(Y(a.$t("tooltip.saveChanges")),1)]),_:1},8,["loading"])])])]),_:1},8,["visible"])],64)}}}),Js=ba(ps,[["__scopeId","data-v-2787654f"]]);export{Js as default};
