import J from"./CBZqTOye.js";import W from"./-QMWbHL6.js";import{f as X,av as Z,r as i,hv as ee,bL as w,d0 as ae,c$ as te,fC as se,d1 as ne,cQ as oe,H as le,g as x,d4 as D,cU as ie,O as ce,P as n,o as c,U as m,w as o,c as N,Y as U,a as s,t as l,b as p,Q as C,al as re,am as de,V as ue,S as k,d as j,R as me,n as pe,fG as _e,$ as fe,a2 as ge,ap as ve}from"./nEPQs079.js";import{_ as we}from"./D3hm18CN.js";import{_ as ke}from"./CNqbIxb7.js";import{a as ye}from"./BfMXOlc4.js";import{a as he}from"./uUEzSIs0.js";import{u as be}from"./BEYj_-yX.js";import{S as xe,_ as Ce}from"./CFgyk-dW.js";import"./BQDKbNwe.js";import"./C3R8onno.js";import"./BEhsxILe.js";import"./COktFmkf.js";import"./-Hb63wRq.js";import"./vKaAFL5T.js";import"./DAFLhYLz.js";import"./boyBAVNN.js";import"./BTGvCRQH.js";import"./BQQOEPN4.js";import"./BLe4UTYD.js";import"./DKtVUO_j.js";const Se={class:"nc-kanban-btn"},Ie={class:"flex items-center gap-2"},Ve={class:"flex items-center gap-0.5"},$e={class:"text-capitalize !text-sm flex items-center gap-1 text-gray-700"},Be={class:"flex items-center rounded-md transition-colors duration-0.3s bg-gray-100 group-hover:bg-gray-200 px-1 min-h-5 text-gray-600 max-w-[108px]"},De={class:"font-weight-500 text-sm truncate !leading-5"},Ne={class:"flex flex-col gap-2"},Ue={class:"nc-fields-list"},je={class:"grouping-field"},Fe=["title"],Le={class:"flex items-center gap-1 max-w-[calc(100%_-_20px)]"},Me={class:"flex items-center gap-1"},Ee={class:"text-sm text-gray-800"},la=X({__name:"StackedBy",setup(Oe){Z(ee,i(!0));const F=w(ae,i()),u=w(te,i()),L=w(se,i(!1)),M=w(ne,i(!1)),{fields:E,loadViewColumns:O,metaColumnById:S}=ye(),{kanbanMetaData:_,loadKanbanMeta:I,loadKanbanData:K,updateKanbanMeta:V,groupingField:T}=he(),{addUndo:$,defineViewScope:B}=oe(),r=i(!1);be(r),le(()=>{var e;return(e=u.value)==null?void 0:e.id},async(e,a)=>{e!==a&&F.value&&await O()},{immediate:!0});const y=async e=>{var a;await V({fk_grp_col_id:e}),await I(),await K(),((a=u.value)==null?void 0:a.view).fk_grp_col_id=e},f=x({get:()=>_.value.fk_grp_col_id,set:async e=>{e&&($({undo:{fn:await y,args:[_.value.fk_grp_col_id]},redo:{fn:await y,args:[e]},scope:B({view:u.value})}),await y(e))}}),h=async e=>{var d,v;const a={...D((d=_.value)==null?void 0:d.meta),hide_empty_stack:e};await V({meta:a}),await I(),((v=u.value)==null?void 0:v.view).meta=a},b=i(null),g=x({get:()=>{var e;return D((e=_.value)==null?void 0:e.meta).hide_empty_stack||!1},set:async e=>{b.value="hideEmptyStack",$({undo:{fn:h,args:[g.value]},redo:{fn:h,args:[e]},scope:B({view:u.value})}),await h(e),b.value=null}}),G=x(()=>{var e;return(e=E.value)==null?void 0:e.filter(a=>a.fk_column_id&&S.value[a.fk_column_id].uidt===ie.SingleSelect).map(a=>({value:a.fk_column_id,label:a.title}))}),P=()=>{r.value=!1},z=e=>pe(_e(e)?J:W,{columnMeta:e});return(e,a)=>{const d=fe,v=ge,R=ve,H=xe,Q=Ce,A=we,Y=ke,q=ce("e");return n(L)?k("",!0):(c(),m(Y,{key:0,visible:n(r),"onUpdate:visible":a[4]||(a[4]=t=>C(r)?r.value=t:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu",class:"!xs:hidden"},{overlay:o(()=>[n(r)?(c(),N("div",{key:0,class:"p-4 w-90 bg-white nc-table-toolbar-menu rounded-lg flex flex-col gap-5",onClick:a[3]||(a[3]=U(()=>{},["stop"]))},[s("div",Ne,[s("div",null,l(e.$t("general.groupingField")),1),s("div",Ue,[s("div",je,[p(Q,{value:n(f),"onUpdate:value":a[0]||(a[0]=t=>C(f)?f.value=t:null),class:"nc-select-shadow w-full nc-kanban-grouping-field-select !rounded-lg","dropdown-class-name":"!rounded-lg",placeholder:"Select a Grouping Field",onChange:P,onClick:a[1]||(a[1]=U(()=>{},["stop"]))},{suffixIcon:o(()=>[p(d,{icon:"arrowDown",class:"text-gray-700"})]),default:o(()=>[(c(!0),N(re,null,de(n(G),t=>(c(),m(H,{key:t.value,value:t.value},{default:o(()=>[s("div",{class:"w-full flex gap-2 items-center justify-between",title:t.label},[s("div",Le,[t.value?(c(),m(ue(z(n(S)[t.value])),{key:0,class:"!w-3.5 !h-3.5 !text-gray-700 !ml-0"})):k("",!0),p(R,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:o(()=>[j(l(t.label),1)]),default:o(()=>[j(l(t.label),1)]),_:2},1024)]),n(f)===t.value?(c(),m(d,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):k("",!0)],8,Fe)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),s("div",Me,[p(A,{checked:n(g),"onUpdate:checked":a[2]||(a[2]=t=>C(g)?g.value=t:null),size:"small",class:"nc-switch",loading:n(b)==="hideEmptyStack"},{default:o(()=>[s("div",Ee,l(e.$t("general.hide"))+" "+l(e.$t("general.empty").toLowerCase())+" "+l(e.$t("general.stack").toLowerCase()),1)]),_:1},8,["checked","loading"])])])):k("",!0)]),default:o(()=>[s("div",Se,[me((c(),m(v,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn !border-0 !h-7 group",size:"small",type:"secondary",disabled:n(M)},{default:o(()=>[s("div",Ie,[p(d,{icon:"settings",class:"h-4 w-4"}),s("div",Ve,[s("span",$e,l(e.$t("activity.kanban.stackedBy")),1),s("div",Be,[s("span",De,l(n(T)),1)])])])]),_:1},8,["disabled"])),[[q,["c:kanban:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{la as default};
