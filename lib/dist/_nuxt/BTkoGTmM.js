import W from"./Cj4l15BV.js";import X from"./Dqwep-0C.js";import{f as Z,aB as ee,r as c,hN as ae,bN as m,da as te,d9 as se,dB as ne,db as oe,g as y,h$ as le,c_ as ie,H as ce,df as M,d2 as re,O as de,P as n,o as l,S as p,w as o,c as I,Y as D,a as s,t as i,b as _,Q as C,aq as ue,av as me,V as pe,T as f,d as T,R as _e,n as fe,fP as ge,$ as ve,a0 as we,a1 as ke}from"./Cgw6cdOy.js";import{_ as ye}from"./DQEz7g1o.js";import{_ as be}from"./CiTH7PYd.js";import{a as he}from"./BcpeJQoi.js";import{a as xe}from"./BK3iCpwL.js";import{u as Ie}from"./LbdZxisI.js";import{S as Ce,_ as Se}from"./D8rpj5Lr.js";import"./DpDIhxXu.js";import"./BBXMuneh.js";import"./BiBN5Lxt.js";import"./hvq8FVej.js";import"./CO8XXsKl.js";import"./DFiWgQ57.js";import"./D7yS5JAk.js";import"./boyBAVNN.js";import"./BcZAlRJW.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";const Ve={class:"nc-kanban-btn"},$e={class:"flex items-center gap-2"},Be={key:0,class:"flex items-center gap-0.5"},Ne={class:"text-capitalize !text-sm flex items-center gap-1 text-gray-700"},Me={class:"flex items-center rounded-md transition-colors duration-0.3s bg-gray-100 group-hover:bg-gray-200 px-1 min-h-5 text-gray-600 max-w-[108px]"},De={class:"font-weight-500 text-sm truncate !leading-5"},Te={class:"flex flex-col gap-2"},je={class:"nc-fields-list"},Fe={class:"grouping-field"},Ee=["title"],Le={class:"flex items-center gap-1 max-w-[calc(100%_-_20px)]"},Oe={class:"flex items-center gap-1"},Ue={class:"text-sm text-gray-800"},ca=Z({__name:"StackedBy",setup(Ke){ee(ae,c(!0));const j=m(te,c()),u=m(se,c()),F=m(ne,c(!1)),E=m(oe,c(!1)),L=m(le,y(()=>!1)),{fields:O,loadViewColumns:U,metaColumnById:S}=he(),{kanbanMetaData:g,loadKanbanMeta:V,loadKanbanData:K,updateKanbanMeta:$,groupingField:P}=xe(),{addUndo:B,defineViewScope:N}=ie(),r=c(!1);Ie(r),ce(()=>{var e;return(e=u.value)==null?void 0:e.id},async(e,a)=>{e!==a&&j.value&&await U()},{immediate:!0});const b=async e=>{var a;await $({fk_grp_col_id:e}),await V(),await K(),((a=u.value)==null?void 0:a.view).fk_grp_col_id=e},v=y({get:()=>g.value.fk_grp_col_id,set:async e=>{e&&(B({undo:{fn:await b,args:[g.value.fk_grp_col_id]},redo:{fn:await b,args:[e]},scope:N({view:u.value})}),await b(e))}}),h=async e=>{var d,k;const a={...M((d=g.value)==null?void 0:d.meta),hide_empty_stack:e};await $({meta:a}),await V(),((k=u.value)==null?void 0:k.view).meta=a},x=c(null),w=y({get:()=>{var e;return M((e=g.value)==null?void 0:e.meta).hide_empty_stack||!1},set:async e=>{x.value="hideEmptyStack",B({undo:{fn:h,args:[w.value]},redo:{fn:h,args:[e]},scope:N({view:u.value})}),await h(e),x.value=null}}),z=y(()=>{var e;return(e=O.value)==null?void 0:e.filter(a=>a.fk_column_id&&S.value[a.fk_column_id].uidt===re.SingleSelect).map(a=>({value:a.fk_column_id,label:a.title}))}),G=()=>{r.value=!1},R=e=>fe(ge(e)?W:X,{columnMeta:e});return(e,a)=>{const d=ve,k=we,H=ke,q=Ce,A=Se,Q=ye,Y=be,J=de("e");return n(F)?f("",!0):(l(),p(Y,{key:0,visible:n(r),"onUpdate:visible":a[4]||(a[4]=t=>C(r)?r.value=t:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu",class:"!xs:hidden"},{overlay:o(()=>[n(r)?(l(),I("div",{key:0,class:"p-4 w-90 bg-white nc-table-toolbar-menu rounded-lg flex flex-col gap-5",onClick:a[3]||(a[3]=D(()=>{},["stop"]))},[s("div",Te,[s("div",null,i(e.$t("general.groupingField")),1),s("div",je,[s("div",Fe,[_(A,{value:n(v),"onUpdate:value":a[0]||(a[0]=t=>C(v)?v.value=t:null),class:"nc-select-shadow w-full nc-kanban-grouping-field-select !rounded-lg","dropdown-class-name":"!rounded-lg",placeholder:"Select a Grouping Field",onChange:G,onClick:a[1]||(a[1]=D(()=>{},["stop"]))},{suffixIcon:o(()=>[_(d,{icon:"arrowDown",class:"text-gray-700"})]),default:o(()=>[(l(!0),I(ue,null,me(n(z),t=>(l(),p(q,{key:t.value,value:t.value},{default:o(()=>[s("div",{class:"w-full flex gap-2 items-center justify-between",title:t.label},[s("div",Le,[t.value?(l(),p(pe(R(n(S)[t.value])),{key:0,class:"!w-3.5 !h-3.5 !text-gray-700 !ml-0"})):f("",!0),_(H,{class:"flex-1 max-w-[calc(100%_-_20px)] truncate","show-on-truncate-only":""},{title:o(()=>[T(i(t.label),1)]),default:o(()=>[T(i(t.label),1)]),_:2},1024)]),n(v)===t.value?(l(),p(d,{key:0,id:"nc-selected-item-icon",icon:"check",class:"flex-none text-primary w-4 h-4"})):f("",!0)],8,Ee)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])])]),s("div",Oe,[_(Q,{checked:n(w),"onUpdate:checked":a[2]||(a[2]=t=>C(w)?w.value=t:null),size:"small",class:"nc-switch",loading:n(x)==="hideEmptyStack"},{default:o(()=>[s("div",Ue,i(e.$t("general.hide"))+" "+i(e.$t("general.empty").toLowerCase())+" "+i(e.$t("general.stack").toLowerCase()),1)]),_:1},8,["checked","loading"])])])):f("",!0)]),default:o(()=>[s("div",Ve,[_e((l(),p(k,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn !border-0 !h-7 group",size:"small",type:"secondary",disabled:n(E)},{default:o(()=>[s("div",$e,[_(d,{icon:"settings",class:"h-4 w-4"}),n(L)?f("",!0):(l(),I("div",Be,[s("span",Ne,i(e.$t("activity.kanban.stackedBy")),1),s("div",Me,[s("span",De,i(n(P)),1)])]))])]),_:1},8,["disabled"])),[[J,["c:kanban:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{ca as default};
