const __vite__fileDeps=["./BY4I35AQ.js","./3QBYHahY.js","./entry.Ic44fwRn.css","./Header.x-GI6b6n.css","./CMiRzd51.js","./BqSRViGZ.js","./C00NHga8.js","./BYmqikBK.js","./BIGB1nv-.js","./ListItem.-o3YFXe-.css","./BGXIEfpz.js","./DdUr8XSo.js","./MenuItem.C7h59s4s.css","./leimKhvx.js","./CyuhXrst.js","./Divider.DqtSqZhb.css","./PcgFfkcK.js","./Menu.CQ8GNWeI.css","./Kma333Sh.js","./CmSmNSNp.js","./DivDataCell.1yCNpUg3.css","./DmzaAQYu.js","./UserIcon.DEVmGavY.css","./Wbpa_-L5.js","./DHsWytsD.js","./Badge.D0-UrqG9.css","./Bczc_1bi.js","./Cy50pBgZ.js","./kHOslGNR.js","./CmN9vPg3.js","./BQQOEPN4.js","./xnDaHwV-.js","./DPgYHC40.js","./BsWDDIqE.js","./ceYq-xax.js","./links.C8uCzV-l.css","./Dwil3It4.js","./Cy5w9qev.js","./DsWDg2xe.js","./Uiq3YTcq.js","./CL-Lp6PG.js","./CSl6euFG.js","./DkE_qgY_.js","./T74iQZdg.js","./Bj2FvocX.js","./DPqnb67u.js","./boyBAVNN.js","./-3s5K4B9.js","./BteOdwRG.js","./2yzrrcqg.js","./Tabs.DaLSLYpn.css","./BkiSZLeF.js","./CJ26qO3d.js","./DeleteModal.SEMJ_gSK.css","./CsJPQclb.js","./CfxEkdGP.js","./DGM-hiY9.js","./C95Svpv6.js","./Giw8WUI1.js","./DEVpQDRz.js","./index.MCJqUXFi.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as et,ad as tt,N as st,ai as ot,bN as U,r as y,aF as at,dA as nt,fP as lt,hq as it,L as rt,az as dt,cM as ct,H as P,ie as Ce,g as O,fr as Ie,fQ as J,i as ut,cB as mt,O as pt,o as a,c as _,a as l,P as t,b as k,w as F,Y as j,aq as W,av as ee,S as C,aL as te,t as $,R as se,d as oe,T as S,Q as ft,dH as _t,U as vt,Z as ne,a6 as le,n as ae,aj as ht,$ as yt,a0 as kt,hg as Te,d2 as wt,_ as gt}from"./3QBYHahY.js";import{_ as xt}from"./BSepFqtU.js";import{a as bt}from"./BxvO7O59.js";import{a as Lt}from"./T74iQZdg.js";import{i as Oe,D as Rt}from"./D4iSzjWt.js";import{e as Ct}from"./BYmqikBK.js";import{_ as It}from"./D2TOauTv.js";import"./kHOslGNR.js";import{I as Tt}from"./CmN9vPg3.js";import{S as Ot}from"./DiVAloGI.js";import"./BH8oNBwT.js";import{S as St}from"./Giw8WUI1.js";import"./BEpKpjF5.js";import"./CGxepfeV.js";import"./BQQOEPN4.js";import"./3ezdMRmZ.js";import"./DPgYHC40.js";import"./xnDaHwV-.js";import"./CSl6euFG.js";import"./DJaxC30e.js";import"./Bj2FvocX.js";import"./DPqnb67u.js";import"./boyBAVNN.js";import"./CryEDKiL.js";import"./CWtzMcwx.js";import"./DAKhk9t6.js";import"./Bk0xUMNV.js";import"./wEQwkVjR.js";import"./BsWDDIqE.js";import"./ceYq-xax.js";import"./DEVpQDRz.js";const Nt=""+new URL("link-records.BXQG6er6.png",import.meta.url).href,At=ne(()=>le(()=>import("./BY4I35AQ.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(m=>m.default||m)),Et=ne(()=>le(()=>import("./CMiRzd51.js"),__vite__mapDeps([4,1,2,5,6,7,8,9]),import.meta.url).then(m=>m.default||m)),Vt=ne(()=>le(()=>import("./BGXIEfpz.js"),__vite__mapDeps([10,1,2,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,7,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]),import.meta.url).then(m=>m.default||m)),zt={class:"flex flex-col h-full"},Pt={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},Ft={key:0,class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center py-0.5 rounded-md"},$t={key:1},Mt={key:0},Dt={class:"cursor-pointer"},Bt={class:"flex items-center"},Ut={class:"flex flex-col gap-2 flex-grow justify-center"},jt={class:"flex flex-row gap-6 w-10/12"},qt={key:1,class:"h-full flex flex-col gap-2 my-auto items-center justify-center text-gray-500 text-center"},Kt=["alt"],Qt={class:"text-base text-gray-700 font-bold"},Yt={class:"text-gray-700"},Gt={class:"flex items-center gap-1"},Ht={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between gap-3 min-h-11"},Xt={class:"flex items-center gap-2"},Zt={class:"flex items-center gap-1"},Jt={class:"flex items-center gap-1"},Wt={key:0,class:"flex justify-center items-center"},es=et({__name:"LinkedItems",props:{modelValue:{type:Boolean},cellValue:{},column:{},items:{}},emits:["update:modelValue","attachRecord"],setup(m,{emit:Se}){const N=m,q=Se,K=tt(N,"modelValue",q),{isMobileMode:Q}=st(),{t:ie}=ot(),A=U(at,y(!1)),M=U(nt,y(!1)),D=y(!1),u=U(lt,y()),E=U(it,y(!1)),I=y(),{isDataReadOnly:Ne}=rt(),{isSharedBase:Ae}=dt(ct()),{childrenList:w,childrenListCount:x,loadChildrenList:re,childrenListPagination:i,childrenExcludedOffsetCount:Ee,childrenListOffsetCount:Ve,relatedTableDisplayValueProp:de,displayValueTypeAndFormatProp:ze,unlink:Pe,isChildrenListLoading:Fe,isChildrenListLinked:ce,isChildrenLoading:Y,relatedTableMeta:p,link:$e,meta:ue,row:b,resetChildrenListOffsetCount:G}=bt(),{isNew:v,state:V,removeLTARRef:Me,addLTARRef:De}=Lt();P([K,A],e=>{(e[0]||e[1])&&!v.value&&re(!0),e[0]||G()},{immediate:!0});const Be=async(e,s)=>{v.value?await Me(e,u==null?void 0:u.value):await Pe(e,{},!1,s)},Ue=async(e,s)=>{v.value?await De(e,u==null?void 0:u.value):await $e(e,{},!1,s)},je=Ce(Te,e=>(p.value.columns??[]).filter(s=>Oe(s))[0]),qe=Ce(Te,e=>(p.value.columns??[]).filter(s=>!wt(s)&&!Rt(s)&&!Ie(s)&&!Oe(s)).sort((s,n)=>{var r,f;return(((r=s.meta)==null?void 0:r.defaultViewColOrder)??1/0)-(((f=n.meta)==null?void 0:f.defaultViewColOrder)??1/0)}).slice(0,Q.value?1:3)),h=y(!1),L=y({}),Ke=O(()=>{var r,f,R,g;if(v.value)return{};const e=(r=u==null?void 0:u.value)==null?void 0:r.colOptions,s=(R=(f=p==null?void 0:p.value)==null?void 0:f.columns)==null?void 0:R.find(T=>{if(!Ie(T))return!1;const d=T==null?void 0:T.colOptions;return(d==null?void 0:d.fk_related_model_id)!==ue.value.id?!1:e.type===J.MANY_TO_MANY&&(d==null?void 0:d.type)===J.MANY_TO_MANY?e.fk_parent_column_id===d.fk_child_column_id&&e.fk_child_column_id===d.fk_parent_column_id:e.fk_parent_column_id===d.fk_parent_column_id&&e.fk_child_column_id===d.fk_child_column_id});if(!s)return{};const n=s==null?void 0:s.colOptions;return n?n.type===J.BELONGS_TO?{[s.title]:(g=b==null?void 0:b.value)==null?void 0:g.row}:{[s.title]:(b==null?void 0:b.value)&&[b.value.row]}:{}}),z=O(()=>{var e;return((e=u.value)==null?void 0:e.title)||""}),me=e=>{E.value||A.value||(L.value=e,h.value=!0)},Qe=()=>{L.value={},h.value=!0,D.value=!0},Ye=e=>{var n;const s=ae("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[ae("span",{class:"font-semibold"},ie("activity.recordCreatedLinked")),ae("span",{class:"text-gray-500"},ie("activity.gotSavedLinkedSuccessfully",{tableName:(n=p.value)==null?void 0:n.title,recordTitle:e[de.value]}))]);ht.success(s)},Ge=O(()=>{var e,s;return(s=(e=u.value)==null?void 0:e.colOptions)==null?void 0:s.type});P(()=>N.cellValue,()=>{v.value&&re()}),P(h,()=>{h.value||(D.value=!1),Ee.value=0,Ve.value=0});const He=O(()=>N.items<10&&i.page===1?N.items:x.value<10&&i.page===1?x.value||10:Math.ceil(x.value/10)===i.page?x.value%10:10),Xe=O(()=>{var e,s;return A.value||v.value?(s=(e=V.value)==null?void 0:e[z.value])==null?void 0:s.length:Y.value?N.items:x.value}),H=O(()=>{var e,s,n,r;return((s=(e=w.value)==null?void 0:e.pageInfo)==null?void 0:s.totalRows)||v.value&&((r=(n=V.value)==null?void 0:n[z.value])==null?void 0:r.length)}),pe=(e,s)=>{Ae.value||E.value||M.value&&!A.value||(v.value||ce.value[parseInt(s)]?Be(e,parseInt(s)):Ue(e,parseInt(s)))};P([I,H],()=>{var e;(!(E.value||M.value)||H.value)&&((e=I.value)==null||e.focus())});const fe=e=>{var s,n,r,f,R;if(e.key==="Escape")K.value=!1;else if(e.key==="ArrowDown"){e.preventDefault();try{(n=(s=e.target)==null?void 0:s.nextElementSibling)==null||n.focus()}catch{}}else if(e.key==="ArrowUp"){e.preventDefault();try{(f=(r=e.target)==null?void 0:r.previousElementSibling)==null||f.focus()}catch{}}else if(!h.value&&e.key!=="Tab"&&e.key!=="Shift"&&e.key!=="Enter"&&e.key!==" ")try{(R=I.value)==null||R.focus()}catch{}};ut(()=>{window.addEventListener("keydown",fe),setTimeout(()=>{var e;(e=I.value)==null||e.focus()},100)});const _e=y();P(i,()=>{var e;(e=_e.value)==null||e.scrollTo({top:0,behavior:"smooth"})}),mt(()=>{G(),i.query="",window.removeEventListener("keydown",fe)});const Ze=()=>{i.page=1,G()};return(e,s)=>{var ve,he,ye,ke,we,ge,xe,be,Le;const n=yt,r=Tt,f=At,R=Ot,g=St,T=Et,d=It,X=kt,Je=xt,We=Vt,Z=pt("e");return a(),_("div",{class:vt(["nc-modal-child-list h-full w-full",{active:t(K)}]),onKeydown:s[7]||(s[7]=te(j(()=>{},["stop"]),["enter"]))},[l("div",zt,[l("div",Pt,[t(A)?(a(),_("div",$t,"Â ")):(a(),_("div",Ft,[k(r,{ref_key:"filterQueryRef",ref:I,value:t(i).query,"onUpdate:value":s[0]||(s[0]=o=>t(i).query=o),bordered:!1,placeholder:"Search linked records...",class:"w-full min-h-4 !pl-0",size:"small",onChange:Ze,onKeydownCapture:s[1]||(s[1]=j(o=>{var c;o.key==="Escape"&&((c=t(I))==null||c.blur())},["stop"]))},{prefix:F(()=>[k(n,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"])])),k(f,{"data-testid":"nc-link-count-info","linked-records":t(Xe),"related-table-title":(ve=t(p))==null?void 0:ve.title,relation:t(Ge),"table-title":(he=t(ue))==null?void 0:he.title},null,8,["linked-records","related-table-title","relation","table-title"])]),l("div",{ref_key:"childrenListRef",ref:_e,class:"flex-1 overflow-auto nc-scrollbar-thin"},[t(H)||t(Y)?(a(),_("div",Mt,[l("div",Dt,[t(Y)?(a(!0),_(W,{key:0},ee(Array.from({length:t(He)}),(o,c)=>(a(),_("div",{key:c,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:bg-gray-50"},[l("div",Bt,[k(R,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),l("div",Ut,[k(g,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),l("div",jt,[(a(),_(W,null,ee([1,2,3],B=>k(g,{key:B,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(a(!0),_(W,{key:1},ee(((ye=t(w))==null?void 0:ye.list)??((ke=t(V))==null?void 0:ke[t(z)])??[],(o,c)=>{var B;return a(),C(T,{key:c,attachment:t(je),"display-value-type-and-format-prop":t(ze),fields:t(qe),"is-linked":(B=t(w))!=null&&B.list?t(ce)[Number.parseInt(c)]:!0,"is-loading":t(Fe)[Number.parseInt(c)],"related-table-display-value-prop":t(de),row:o,"data-testid":"nc-child-list-item",onLinkOrUnlink:Re=>pe(o,c),onExpand:Re=>me(o),onKeydown:[te(j(Re=>pe(o,c),["prevent","stop"]),["space"]),te(j(()=>me(o),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"])}),128))])])):(a(),_("div",qt,[l("img",{alt:e.$t("msg.clickLinkRecordsToAddLinkFromTable"),class:"!w-[158px] flex-none",src:Nt},null,8,Kt),l("div",Qt,$(e.$t("msg.noLinkedRecords")),1),l("div",Yt,$(e.$t("msg.clickLinkRecordsToAddLinkFromTable")),1),!t(E)&&(t(x)<1||(((we=t(w))==null?void 0:we.list)??((ge=t(V))==null?void 0:ge[t(z)])??[]).length>0)?se((a(),C(X,{key:0,"data-testid":"nc-child-list-button-link-to",size:"small",onClick:s[2]||(s[2]=o=>q("attachRecord"))},{default:F(()=>[l("div",Gt,[k(d),oe(" "+$(e.$t("title.linkRecords")),1)])]),_:1})),[[Z,["c:links:link"]]]):S("",!0)]))],512),l("div",Ht,[l("div",Xt,[!t(M)&&!t(Ne)?se((a(),C(X,{key:0,size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",onClick:Qe},{default:F(()=>[l("div",Zt,[t(Q)?S("",!0):(a(),C(d,{key:0,class:"h-4 w-4"})),oe(" "+$(e.$t("activity.newRecord")),1)])]),_:1})),[[Z,["c:row-expand:open"]]]):S("",!0),!t(E)&&(t(x)>0||(((xe=t(w))==null?void 0:xe.list)??((be=t(V))==null?void 0:be[t(z)])??[]).length>0)?se((a(),C(X,{key:1,"data-testid":"nc-child-list-button-link-to",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",size:"small",type:"secondary",onClick:s[3]||(s[3]=o=>q("attachRecord"))},{default:F(()=>[l("div",Jt,[k(n,{icon:"link2",class:"!xs:hidden h-4 w-4"}),oe(" "+$(t(Q)?e.$t("title.linkMore"):e.$t("title.linkMoreRecords")),1)])]),_:1})),[[Z,["c:links:link"]]]):S("",!0)]),!t(v)&&((Le=t(w))!=null&&Le.pageInfo)&&+t(w).pageInfo.totalRows>t(i).size?(a(),_("div",Wt,[k(Je,{current:t(i).page,"onUpdate:current":s[4]||(s[4]=o=>t(i).page=o),"page-size":t(i).size,"onUpdate:pageSize":s[5]||(s[5]=o=>t(i).size=o),total:+t(w).pageInfo.totalRows,mode:"simple"},null,8,["current","page-size","total"])])):S("",!0)])]),(a(),C(_t,null,{default:F(()=>{var o;return[t(L)&&t(h)?(a(),C(We,{key:0,modelValue:t(h),"onUpdate:modelValue":s[6]||(s[6]=c=>ft(h)?h.value=c:null),"load-row":!t(M),"close-after-save":t(D),meta:t(p),"new-record-header":t(D)?e.$t("activity.tableNameCreateNewRecord",{tableName:(o=t(p))==null?void 0:o.title}):void 0,row:{row:t(L),oldRow:t(L),rowMeta:Object.keys(t(L)).length>0?{}:{new:!0}},state:t(Ke),"row-id":("extractPkFromRow"in e?e.extractPkFromRow:t(Ct))(t(L),t(p).columns),"use-meta-fields":"","maintain-default-view-order":"","new-record-submit-btn-text":"Create & Link",onCreatedRecord:Ye},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","state","row-id"])):S("",!0)]}),_:1}))],34)}}}),As=gt(es,[["__scopeId","data-v-472d13ab"]]);export{As as default};
