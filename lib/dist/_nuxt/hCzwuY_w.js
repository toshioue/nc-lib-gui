import{f as ne,bN as w,r as f,da as se,d9 as ie,db as le,dB as re,g as k,h$ as ce,d2 as s,fO as de,H as N,O as ue,P as o,o as n,S as g,w as r,c as v,Y as me,aq as V,av as R,a as c,t as y,b,d as j,V as B,W as O,T as x,Q as P,R as _e,aj as U,a0 as pe,a1 as fe,$ as ve,p as he,e as we,A as ke,_ as ge}from"./Cgw6cdOy.js";import{_ as ye}from"./Bw0A6WKO.js";import{_ as be}from"./CJBRTPd8.js";import{_ as xe}from"./DQEz7g1o.js";import{_ as Te}from"./CiTH7PYd.js";import{a as Ie}from"./BcpeJQoi.js";import{a as Ce}from"./CevRfOSd.js";import{S as De}from"./D8rpj5Lr.js";import"./Cj4l15BV.js";import"./DpDIhxXu.js";import"./Dqwep-0C.js";import"./BBXMuneh.js";import"./BiBN5Lxt.js";import"./hvq8FVej.js";import"./CO8XXsKl.js";import"./DFiWgQ57.js";import"./D7yS5JAk.js";import"./BcZAlRJW.js";import"./BQQOEPN4.js";import"./BohSct8s.js";import"./C8c9012h.js";const Me=T=>(he("data-v-ee02aaa7"),T=T(),we(),T),Se={class:"nc-calendar-btn"},$e={class:"flex items-center gap-2"},Ne={key:0,class:"text-capitalize !group-hover:text-brand-500 !text-[13px] font-medium"},Ve={class:"flex w-full gap-2 justify-between items-center"},Re={class:"flex items-center"},je={key:0,class:"flex items-center gap-2 !mt-2"},Be=Me(()=>c("span",{class:"text-sm text-gray-500"}," Date field is required! ",-1)),Oe={class:"text-gray-800"},Pe=ne({__name:"Range",setup(T){const C=w(se,f()),{$api:A}=ke(),l=w(ie,f()),F=w(le,f(!1)),L=w(re,f(!1)),E=w(ce,k(()=>!1)),{loadViewColumns:W}=Ie(),{loadCalendarMeta:q,loadCalendarData:z,loadSidebarData:H,fetchActiveDates:G,updateCalendarMeta:Q,viewMetaProperties:Y}=Ce(),d=f(!1),I=k({get:()=>{var e;return((e=Y.value)==null?void 0:e.hide_weekend)??!1},set:e=>{Q({meta:{hide_weekend:e}})}}),D=k(()=>{var e,a;return(((a=(e=C.value)==null?void 0:e.columns)==null?void 0:a.filter(t=>{var p,u;return[s.DateTime,s.Date,s.CreatedTime,s.LastModifiedTime].includes(t.uidt)||t.uidt===s.Formula&&((u=(p=t.colOptions)==null?void 0:p.parsed_tree)==null?void 0:u.dataType)===de.DATE}).map(t=>({label:t.title,value:t.id,uidt:t.uidt})))??[]).sort((t,p)=>{const u={[s.DateTime]:1,[s.Date]:2,[s.Formula]:3,[s.CreatedTime]:4,[s.LastModifiedTime]:5};return(u[t.uidt]||6)-(u[p.uidt]||6)})});N(()=>{var e;return(e=l.value)==null?void 0:e.id},async(e,a)=>{e!==a&&C.value&&await W()},{immediate:!0});const M=k(()=>{var a;const e=[];return!l.value||!l.value.view||(a=l.value.view.calendar_range)==null||a.forEach(t=>{e.push({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id})}),e}),_=f(M.value),S=k(()=>_.value.length>0&&_.value[0].fk_from_column_id);N(d,e=>{!e&&!S.value&&(d.value=!0,_.value.length===0&&_.value.push({fk_from_column_id:void 0,fk_to_column_id:null}))},{immediate:!0});const J=async()=>{var e;if(l.value)try{const a=_.value.filter(t=>t.fk_from_column_id).map(t=>({fk_from_column_id:t.fk_from_column_id,fk_to_column_id:t.fk_to_column_id}));await A.dbView.calendarUpdate((e=l.value)==null?void 0:e.id,{calendar_range:a}),l.value.view&&(l.value.view.calendar_range=a),await q(),await Promise.all([z(),H(),G()]),d.value=!1}catch(a){console.log(a),U.error("There was an error while updating view!")}else U.error("Please select a view first")};return(e,a)=>{const t=pe,p=ye,u=fe,K=De,X=be,Z=ve,ee=xe,ae=Te,te=ue("e");return o(L)?x("",!0):(n(),g(ae,{key:0,visible:o(d),"onUpdate:visible":a[2]||(a[2]=m=>P(d)?d.value=m:null),trigger:["click"],class:"!xs:hidden"},{overlay:r(()=>[o(d)?(n(),v("div",{key:0,class:"w-98 space-y-6 rounded-2xl p-6","data-testid":"nc-calendar-range-menu",onClick:a[1]||(a[1]=me(()=>{},["stop"]))},[(n(!0),v(V,null,R(o(_),(m,$)=>(n(),v("div",{key:$,class:"flex w-full gap-2 mb-2 items-center","data-testid":"nc-calendar-range-option"},[c("span",null,y(e.$t("labels.organiseBy")),1),b(X,{value:m.fk_from_column_id,"onUpdate:value":i=>m.fk_from_column_id=i,placeholder:e.$t("placeholder.notSelected"),"data-testid":"nc-calendar-range-from-field-select",onChange:J},{default:r(()=>[(n(!0),v(V,null,R([...o(D)??[]].filter(i=>{if($===0)return!0;const h=(o(D)??[]).find(oe=>oe.value===o(M)[0].fk_from_column_id);return(h==null?void 0:h.uidt)===i.uidt}),(i,h)=>(n(),g(K,{key:h,class:"w-40",value:i.value},{default:r(()=>[c("div",Ve,[c("div",Re,[b(p,{column:i},null,8,["column"]),b(u,{class:"truncate flex-1 max-w-18",placement:"top","show-on-truncate-only":""},{title:r(()=>[j(y(i.label),1)]),default:r(()=>[j(" "+y(i.label),1)]),_:2},1024)]),i.value===m.fk_from_column_id?(n(),g(B(("iconMap"in e?e.iconMap:o(O)).check),{key:0,id:"nc-selected-item-icon",class:"text-primary min-w-4 h-4"})):x("",!0)])]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]))),128)),o(S)?x("",!0):(n(),v("div",je,[b(Z,{icon:"warning",class:"text-sm mt-0.5 text-orange-500"}),Be])),c("div",null,[b(ee,{checked:o(I),"onUpdate:checked":a[0]||(a[0]=m=>P(I)?I.value=m:null)},{default:r(()=>[c("span",Oe,y(e.$t("activity.hideWeekends")),1)]),_:1},8,["checked"])])])):x("",!0)]),default:r(()=>[c("div",Se,[_e((n(),g(t,{disabled:o(F),class:"nc-toolbar-btn !border-0 group !h-6",size:"small",type:"secondary","data-testid":"nc-calendar-range-btn"},{default:r(()=>[c("div",$e,[(n(),g(B(("iconMap"in e?e.iconMap:o(O)).calendar),{class:"h-4 w-4 transition-all group-hover:text-brand-500"})),o(E)?x("",!0):(n(),v("span",Ne,y(e.$t("activity.settings")),1))])]),_:1},8,["disabled"])),[[te,["c:calendar:change-calendar-range"]]])])]),_:1},8,["visible"]))}}}),sa=ge(Pe,[["__scopeId","data-v-ee02aaa7"]]);export{sa as default};
