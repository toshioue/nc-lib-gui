import{e as T,r as E,gt as A,F as H,ge as Z,j3 as I,k as V,o as n,c as i,N as t,Q as x,w as m,d as r,t as s,b as h,R as M,a as p,T as D,U as z,ao as B,at as P,S as N,a8 as S,Y as O,Z as G,$ as Q}from"./DZZ6t_j4.js";import{a as W}from"./DRXTVn8w.js";import{u as Y}from"./TIQ2_Moa.js";import"./C9Sjn86N.js";import"./0QUe8GCE.js";import"./B05h-4V9.js";import"./GMLocJHP.js";import"./RXURfzjs.js";import"./CA74dF2b.js";import"./qW2V2r_p.js";import"./ByVBARmO.js";import"./boyBAVNN.js";import"./BDAIZopQ.js";import"./Bgw0NQgX.js";import"./EqBqqo9-.js";import"./C00NHga8.js";import"./C4K5fdHe.js";import"./C3XbZq4f.js";import"./DgixBgIx.js";import"./DKN1hQ6S.js";import"./BQuyMdA-.js";import"./BQQOEPN4.js";import"./vll-Pnjv.js";import"./B5RRVMt5.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";import"./BYINaHrJ.js";import"./dfem9Uc_.js";import"./BCJFTkwv.js";import"./D9tFZoTQ.js";import"./C0-Qcoum.js";const q=async v=>!v.type.startsWith("image/")&&!v.type.startsWith("video/")?null:new Promise((g,w)=>{const k=new FileReader;k.onload=function(o){var F;const _=(F=o.target)==null?void 0:F.result;if(v.type.startsWith("image/")){const a=new Image;a.onload=function(){const c=document.createElement("canvas"),f=c.getContext("2d");if(!f)return g(null);const u=200,b=u/a.width,y=a.height*b;c.width=u,c.height=y,f.drawImage(a,0,0,u,y);const $=c.toDataURL("image/png");g($)},a.onerror=function(){console.error("Error loading image"),w(null)},a.src=_}else if(v.type.startsWith("video/")){const a=document.createElement("video");a.onloadedmetadata=function(){a.currentTime=1},a.onseeked=function(){const c=document.createElement("canvas"),f=c.getContext("2d");if(!f)return g(null);const u=200,b=u/a.videoWidth,y=a.videoHeight*b;c.width=u,c.height=y,f.drawImage(a,0,0,u,y);const $=c.toDataURL("image/png");g($)},a.onerror=function(){console.error("Error loading video"),w(null)},a.src=_}else g(null)},k.onerror=function(){console.error("Error reading file"),w(null)},k.readAsDataURL(v)}),J={key:1,class:"flex w-full border-b-1 py-1 h-9.5 items-center justify-between top-0"},K={class:"text-xs"},X={class:"flex gap-1 items-center"},ee={key:0,class:"flex cursor-pointer items-center justify-center flex-col gap-4"},te={class:"font-semibold text-brand-500"},oe={class:"font-semibold"},se={class:"text-brand-500 font-bold"},ne={key:1,class:"grid overflow-y-auto flex-grow-1 nc-scrollbar-md grid-cols-4 w-full h-full items-start py-2 justify-center gap-4"},ae={key:0,style:{height:"140px"},class:"flex items-center justify-center rounded-md bg-gray-300"},le=["src"],ie={class:"relative text-[12px] font-semibold items-center text-gray-800 flex"},re={class:"flex-none hide-ui transition-all transition-ease-in-out !h-4 flex items-center bg-white"},ce={class:"flex-none text-[10px] font-semibold text-gray-500"},de={key:2,class:"flex gap-2 pt-2 bg-white w-full items-center justify-end"},Ie=T({__name:"Local",emits:["update:visible","upload"],setup(v,{emit:g}){const w=g,k=E(),o=E([]),{isLoading:_}=Y(),{files:F,open:a}=A({reset:!0});H(F,e=>{e&&Object.values(e).forEach(l=>{o.value.push(l)})});const c=(e,l)=>{o.value.push(...e),l.preventDefault(),l.stopPropagation()},f=Z(async()=>{const e=new Map;return await Promise.all(o.value.map(async l=>{const R=await q(l);R&&e.set(l,R)})),e}),u=e=>{o.value=o.value.filter(l=>l!==e)},{isOverDropZone:b}=I(k,c),y=()=>{o.value=[]},$=()=>{a()},L=()=>{w("update:visible",!1)};return V(()=>{o.value=[]}),(e,l)=>{const R=O,C=G,j=Q;return n(),i("div",{class:N([{"flex flex-col relative justify-center items-center":!t(o).length},"w-full p-2 h-full"])},[t(o).length===0?(n(),x(j,{key:0,class:"absolute top-3 right-3"},{title:m(()=>[r(s(e.$t("general.close")),1)]),default:m(()=>[h(C,{type:"text",class:"!border-0",size:"xsmall",onClick:L},{default:m(()=>[h(R,{icon:"close"})]),_:1})]),_:1})):M("",!0),t(o).length>0?(n(),i("div",J,[h(C,{type:"text",size:"small",onClick:y},{default:m(()=>[r(s(e.$t("labels.clearAllFiles")),1)]),_:1}),p("span",K,s(t(o).length)+" files, total size: "+s(("formatBytes"in e?e.formatBytes:t(W))(t(o).reduce((d,U)=>d+U.size,0),0)),1),h(C,{type:"text",size:"small",onClick:$},{default:m(()=>[p("div",X,[(n(),x(D(("iconMap"in e?e.iconMap:t(z)).plus))),r(" "+s(e.$t("labels.addMore")),1)])]),_:1})])):M("",!0),p("div",{ref_key:"dropZoneRef",ref:k,class:N([{"border-brand-500":t(b),"border-dashed border-2":!t(o).length},"flex flex-col items-center justify-center h-full w-full flex-grow-1 rounded-lg"]),"data-testid":"attachment-drop-zone",style:S(`height: ${t(o).length>0?"324px":"100%"}`),onClick:l[0]||(l[0]=d=>t(o).length>0?()=>{}:$())},[t(o).length?(n(),i("div",ne,[(n(!0),i(B,null,P(t(o),d=>(n(),i("div",{key:d.name,class:"flex gap-1.5 group min-w-34 max-w-28 pb-4 flex-col relative"},[t(f).get(d)?(n(),i("img",{key:1,src:t(f).get(d),style:{height:"140px"},alt:"thumbnail",class:"rounded-md object-cover"},null,8,le)):(n(),i("div",ae,[(n(),x(D(("iconMap"in e?e.iconMap:t(z)).file),{class:"w-16 h-16"}))])),p("div",ie,[h(j,{class:"flex-auto truncate",placement:"bottom"},{title:m(()=>[r(s(d.name),1)]),default:m(()=>[r(" "+s(d.name),1)]),_:2},1024),p("div",re,[h(j,{placement:"bottom"},{title:m(()=>[r(s(e.$t("title.removeFile")),1)]),default:m(()=>[(n(),x(D(("iconMap"in e?e.iconMap:t(z)).delete),{class:"!text-red-500 w-3 h-3 cursor-pointer",onClick:U=>u(d)},null,8,["onClick"]))]),_:2},1024)])]),p("div",ce,s(("formatBytes"in e?e.formatBytes:t(W))(d.size,0)),1)]))),128))])):(n(),i("div",ee,[t(b)?M("",!0):(n(),i(B,{key:0},[(n(),x(D(("iconMap"in e?e.iconMap:t(z)).upload),{class:"w-8 h-8 text-gray-500"})),p("h1",null,[r(s(e.$t("labels.clickTo"))+" ",1),p("span",te,s(e.$t("labels.browseFiles")),1),r(" "+s(e.$t("general.or"))+" ",1),p("span",oe,s(e.$t("labels.dragFilesHere")),1),r(" "+s(e.$t("labels.toUpload")),1)])],64)),t(b)?(n(),i(B,{key:1},[(n(),x(D(("iconMap"in e?e.iconMap:t(z)).upload),{class:"w-8 text-brand-500 h-8"})),p("h1",se,s(e.$t("labels.dropHere")),1)],64)):M("",!0)]))],6),t(o).length?(n(),i("div",de,[h(C,{disabled:t(_),type:"secondary",size:"small",onClick:L},{default:m(()=>[r(s(e.$t("labels.cancel")),1)]),_:1},8,["disabled"]),h(C,{loading:t(_),"data-testid":"nc-upload-file",size:"small",onClick:l[1]||(l[1]=d=>w("upload",t(o)))},{default:m(()=>[t(_)?(n(),i(B,{key:0},[r(s(e.$t("labels.uploading")),1)],64)):(n(),i(B,{key:1},[r(s(e.$t("general.upload"))+" "+s(t(o).length)+" "+s(e.$t("objects.files")),1)],64))]),_:1},8,["loading"])])):M("",!0)],2)}}});export{Ie as default};
