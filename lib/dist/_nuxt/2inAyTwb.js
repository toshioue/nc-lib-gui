import{_ as G}from"./yHkB3Gp4.js";import{u as I}from"./Cy5w9qev.js";import{f as M,r as v,az as P,cM as V,N as L,ay as W,g as k,i as z,O,o as h,c as _,a as u,t as B,R as S,b,P as r,Q,T as U,aj as l,ak as i,A as q}from"./3QBYHahY.js";import{_ as F}from"./DD1BMgnW.js";import"./BteOdwRG.js";import"./CSl6euFG.js";import"./0DGTjfkJ.js";import"./Ci1lK5Ee.js";import"./xnDaHwV-.js";import"./ceYq-xax.js";import"./CmN9vPg3.js";import"./BQQOEPN4.js";import"./DE41lpFj.js";import"./ChSCnN6E.js";import"./Cll3oJPn.js";import"./B6ykf4kl.js";import"./wEQwkVjR.js";import"./og6cBSyd.js";import"./B8d2yde0.js";import"./BEpKpjF5.js";import"./CGxepfeV.js";import"./3ezdMRmZ.js";import"./DPgYHC40.js";const H={class:"flex flex-col py-2 px-3 gap-2 w-full","data-testid":"nc-share-base-sub-modal"},J={class:"flex flex-col w-full p-3 border-1 border-gray-100 rounded-md"},K={class:"flex flex-row w-full justify-between"},X={class:"text-gray-900 font-medium"},Y={key:0,class:"flex flex-col w-full mt-3 border-t-1 pt-3 border-gray-100"},Z={key:0,class:"flex flex-row justify-between mt-3 bg-gray-50 px-3 py-2 rounded-md"},ee={class:"text-black"},Se=M({__name:"ShareBase",setup(ae){const{dashboardUrl:$}=I(),{$api:d,$e:g}=q(),a=v(null),{base:t}=P(V()),{getBaseUrl:R,appInfo:y}=L(),C=W(),p=k(()=>{var o;if(!a.value||!a.value.uuid)return"";const e=R(C.activeWorkspaceId);let s=$.value;return e&&(s=`${e}${(o=y.value)==null?void 0:o.dashboardPath}`),encodeURI(`${s}#/base/${a.value.uuid}`)}),D=async()=>{try{if(!t.value.id)return;const e=await d.base.sharedBaseGet(t.value.id);a.value={uuid:e.uuid,url:e.url,role:e.roles}}catch(e){l.error(await i(e))}},f=async(e="viewer")=>{try{if(!t.value.id)return;const s=await d.base.sharedBaseUpdate(t.value.id,{roles:e});a.value=s??{},a.value.role=e,t.value.uuid=s.uuid}catch(s){l.error(await i(s))}g("a:shared-base:enable",{role:e})},N=async()=>{try{if(!t.value.id)return;await d.base.sharedBaseDisable(t.value.id),a.value=null,t.value.uuid=void 0}catch(e){l.error(await i(e))}g("a:shared-base:disable")};z(()=>{a.value||D()});const m=k(()=>{var e;return!!((e=a.value)!=null&&e.uuid)}),n=v(!1),c=v(!1),T=async()=>{if(!n.value){n.value=!0;try{m.value?await N():await f()}catch(e){l.error(await i(e))}finally{n.value=!1}}},A=async()=>{if(a.value&&!c.value){c.value=!0;try{a.value.role==="viewer"?await f("editor"):await f("viewer")}catch(e){l.error(await i(e))}finally{c.value=!1}}};return(e,s)=>{var x;const o=F,j=G,w=O("e");return h(),_("div",H,[u("div",J,[u("div",K,[u("div",X,B(e.$t("activity.enablePublicAccess")),1),S(b(o,{checked:r(m),loading:r(n),class:"ml-2",onClick:T},null,8,["checked","loading"]),[[w,["c:share:base:enable:toggle"]]])]),r(m)?(h(),_("div",Y,[b(j,{url:r(p),"onUpdate:url":s[0]||(s[0]=E=>Q(p)?p.value=E:null)},null,8,["url"]),r(y).ee?U("",!0):(h(),_("div",Z,[u("div",ee,B(e.$t("activity.editingAccess")),1),S(b(o,{loading:r(c),checked:((x=r(a))==null?void 0:x.role)==="editor",class:"ml-2",onClick:A},null,8,["loading","checked"]),[[w,["c:share:base:role:toggle"]]])]))])):U("",!0)])])}}});export{Se as default};
