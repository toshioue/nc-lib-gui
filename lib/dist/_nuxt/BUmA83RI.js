import{f as ye,N as ge,bL as y,fG as _e,he,r as p,ay as ke,aw as be,az as xe,g as k,hu as Se,fB as Oe,ho as Ce,gr as Ie,cP as $e,L as Me,cB as Ae,d4 as j,H as Ee,hi as ee,an as Re,ao as Ke,aA as Be,o as f,c as S,P as e,b as $,w as d,al as T,am as te,U as M,T as A,a as g,a8 as z,d9 as E,d as N,t as _,Q as le,Y as D,S as q,V as Pe,W as je,aF as Ne,A as Ve,ap as Le,dj as Fe,_ as Te}from"./DKhUGBot.js";import{_ as ze}from"./C600yAEI.js";import{u as De}from"./BIe2oNDw.js";import{T as qe}from"./BiTIZUqU.js";import{R as Ue,_ as He}from"./G7I_n9Op.js";import{S as Ge}from"./CX4Cv_ut.js";import"./CNjr3NNT.js";import"./CUg8TjpL.js";import"./DEJjMRn_.js";import"./BQQOEPN4.js";import"./DX_5E9FR.js";import"./BOlDoh1A.js";const Qe=["onKeydown"],We={key:0,class:"w-full max-w-full"},Ye={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Je={key:0,class:"w-full"},Xe={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ze={class:"text-ellipsis overflow-hidden",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},et={class:"flex gap-2 text-gray-500 items-center h-full"},tt={class:"text-xs whitespace-normal"},lt=ye({__name:"SingleSelect",props:{modelValue:{},rowIndex:{},disableOptionCreation:{type:Boolean}},emits:["update:modelValue"],setup(U,{emit:ae}){const se=ae,{isMobileMode:H}=ge(),n=y(_e),B=y(he),V=y(ke,p(!1)),G=y(be,p(!1)),O=y(xe,p(!1)),b=k(()=>G.value||V.value||O.value),C=p(),c=p(!1),P=y(Se,p(!1)),Q=y(Oe,p(!1)),W=y(Ce,p(!1)),oe=y(Ie,p(!1)),{$api:ne}=Ve(),x=p(),{getMeta:ie}=$e(),{isUIAllowed:Y,isMetaReadOnly:re}=Me(),{isPg:J,isMysql:ce}=Ae(),R=p(),L=p(!1),X=k(()=>!Q.value&&!U.disableOptionCreation&&Y("fieldEdit")&&!re.value),m=k(()=>{var t,l,i;if(n!=null&&n.value.colOptions){const o=n.value.colOptions?n.value.colOptions.options.filter(a=>a.title!=="")||[]:[];for(const a of o.filter(r=>r.order===null))a.title=a.title.replace(/^'/,"").replace(/'$/,"");let w=1;const v=(((t=j(n.value.meta))==null?void 0:t.limitOptions)||[]).reduce((a,r)=>(w<((r==null?void 0:r.order)??0)&&(w=r.order),{...a,[r.id]:r}),{})??{};return!W.value&&O.value&&((l=j(n.value.meta))!=null&&l.isLimitOption)&&(((i=j(n.value.meta))==null?void 0:i.limitOptions)||[]).length?o.filter(a=>{var r,K;return((r=v[a.id])==null?void 0:r.show)!==void 0?(K=v[a.id])==null?void 0:K.show:!1}).map(a=>{var r;return{...a,value:a.title,order:a.id&&v[a.id]?(r=v[a.id])==null?void 0:r.order:w++}}).sort((a,r)=>a.order-r.order):o.map(a=>({...a,value:a.title}))}return[]}),ue=k(()=>(m.value??[]).every(t=>t.title!==x.value)),F=k(()=>Y("dataEdit")||O.value),h=k(()=>(F.value||O.value)&&b.value),u=k({get:()=>R.value??U.modelValue,set:t=>{if(t&&X.value&&(m.value??[]).every(l=>l.title!==t))return R.value=t,de();se("update:modelValue",t||null)}});Ee(c,(t,l)=>{var i,o,w,v,a,r;h.value&&(t?(r=(a=(v=C.value)==null?void 0:v.$el)==null?void 0:a.querySelector("input"))==null||r.focus():(w=(o=(i=C.value)==null?void 0:i.$el)==null?void 0:o.querySelector("input"))==null||w.blur())}),De(G,t=>{var l;switch(t.key){case"Escape":c.value=!1;break;case"Enter":h.value&&b.value&&!c.value&&(c.value=!0);break;case" ":break;default:if(!h.value){t.preventDefault();break}!(t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)&&((l=t.key)==null?void 0:l.length)===1&&!Fe()&&(t.stopPropagation(),c.value=!0);break}});async function de(){var l,i;if(!R.value||Q.value)return!1;const t=R.value;if(x.value="",R.value=void 0,t&&!m.value.some(o=>o.title===t))try{m.value.push({title:t,value:t,color:ee.light[(m.value.length+1)%ee.light.length]}),n.value.colOptions={options:m.value.map(({value:w,...v})=>v)};const o={...n.value};o.cdf&&(J(n.value.source_id)&&(o.cdf=o.cdf.substring(o.cdf.indexOf("'")+1,o.cdf.lastIndexOf("'"))),!ce(n.value.source_id)&&!J(n.value.source_id)&&(o.cdf=o.cdf.replace(/''/g,"'"))),await ne.dbTableColumn.update(((l=n.value)==null?void 0:l.fk_column_id)||((i=n.value)==null?void 0:i.id),o),u.value=t,await ie(n.value.fk_model_id,!0)}catch(o){console.log(o),Re.error(await Ke(o))}}const fe=()=>{var t,l,i;H.value||(x.value=(i=(l=(t=C.value)==null?void 0:t.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:i.value)},pe=t=>{c.value&&b.value&&t.stopPropagation(),t.key==="Enter"&&t.stopPropagation(),t.key==="Escape"&&(c.value=!1)},ve=t=>{switch(t.key){case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":t.stopPropagation();break}},me=()=>{c.value=!1,V.value=!1},Z=t=>{var l,i;if((l=t.target)!=null&&l.classList.contains("ant-select-clear")||(i=t.target)!=null&&i.closest(".ant-select-clear"))return u.value="",t.stopPropagation();L.value||(c.value=h.value&&!c.value)};Be(document,"click",t=>{c.value&&C.value&&!C.value.$el.contains(t.target)&&(c.value=!1)},!0);const I=k(()=>m.value.find(t=>{var l,i;return t.value===u.value||t.value===((i=(l=u.value)==null?void 0:l.toString())==null?void 0:i.trim())})),we=()=>{L.value=!0,setTimeout(()=>{L.value=!1},250),!(oe.value&&u.value)&&(c.value=!0)};return(t,l)=>{var K;const i=Le,o=qe,w=Ue,v=He,a=Ge,r=ze;return f(),S("div",{class:A(["nc-cell-field h-full w-full flex items-center nc-single-select focus:outline-transparent",{"read-only":e(B),"max-w-full":e(O)}]),onClick:Z,onKeydown:Ne(D(Z,["stop","prevent"]),["enter"])},[!e(W)&&e(O)&&((K=("parseProp"in t?t.parseProp:e(j))(e(n).meta))!=null&&K.isList)?(f(),S("div",We,[$(v,{value:e(u),"onUpdate:value":l[0]||(l[0]=s=>le(u)?u.value=s:null),disabled:e(B)||!e(h),class:"nc-field-layout-list",onKeydown:ve,onClick:l[1]||(l[1]=D(()=>{},["stop"]))},{default:d(()=>[(f(!0),S(T,null,te(e(m),s=>(f(),M(w,{key:s.title,value:s.title,"data-testid":`select-option-${e(n).title}-${t.rowIndex}`,class:A(`nc-select-option-${e(n).title}-${s.title}`)},{default:d(()=>[$(o,{class:"rounded-tag max-w-full",color:s.color},{default:d(()=>[g("span",{style:z({color:e(E).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(E).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:"text-small"},[$(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[N(_(s.title),1)]),default:d(()=>[g("span",Ye,_(s.title),1)]),_:2},1024)],4)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128))]),_:1},8,["value","disabled"]),e(u)?(f(),S("div",{key:0,class:"inline-block px-2 pt-2 cursor-pointer text-xs text-gray-500 hover:text-gray-800",onClick:l[2]||(l[2]=s=>u.value="")},_(t.$t("labels.clearSelection")),1)):q("",!0)])):(f(),S(T,{key:1},[e(b)||e(V)?(f(),M(r,{key:1,ref_key:"aselect",ref:C,value:e(u),"onUpdate:value":l[4]||(l[4]=s=>le(u)?u.value=s:null),class:A(["w-full overflow-hidden",{"caret-transparent":!e(F)}]),"allow-clear":!e(n).rqd&&e(h),bordered:!1,open:e(c)&&e(h),disabled:e(B)||!e(h),"show-search":!e(H)&&e(c)&&e(b),"show-arrow":e(F)&&!e(B)&&e(b)&&(e(u)===null||e(u)===void 0),"dropdown-class-name":`nc-dropdown-single-select-cell !min-w-156px ${e(c)&&e(b)?"active":""}`,"dropdown-match-select-width":!0,onSelect:me,onKeydown:l[5]||(l[5]=s=>pe(s)),onSearch:fe,onBlur:l[6]||(l[6]=s=>c.value=!1),onFocus:we},{default:d(()=>[(f(!0),S(T,null,te(e(m),s=>(f(),M(a,{key:s.title,value:s.title,"data-testid":`select-option-${e(n).title}-${t.rowIndex}`,class:A(`nc-select-option-${e(n).title}-${s.title}`),onClick:l[3]||(l[3]=D(()=>{},["stop"]))},{default:d(()=>[$(o,{class:"rounded-tag max-w-full",color:s.color},{default:d(()=>[g("span",{style:z({color:e(E).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(E).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:A({"text-sm":e(P),"text-small":!e(P)})},[$(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[N(_(s.title),1)]),default:d(()=>[g("span",Ze,_(s.title),1)]),_:2},1024)],6)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128)),e(x)&&e(ue)&&e(X)?(f(),M(a,{key:e(x),value:e(x)},{default:d(()=>[g("div",et,[(f(),M(Pe(("iconMap"in t?t.iconMap:e(je)).plusThick),{class:"min-w-4"})),g("div",tt,[N(_(t.$t("msg.selectOption.createNewOptionNamed"))+" ",1),g("strong",null,_(e(x)),1)])])]),_:1},8,["value"])):q("",!0)]),_:1},8,["value","class","allow-clear","open","disabled","show-search","show-arrow","dropdown-class-name"])):(f(),S("div",Je,[e(I)?(f(),M(o,{key:0,class:"rounded-tag max-w-full",color:e(I).color},{default:d(()=>[g("span",{style:z({color:e(E).isReadable(e(I).color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(E).mostReadable(e(I).color||"#ccc",["#0b1d05","#fff"]).toHex8String()}),class:A({"text-sm":e(P),"text-small":!e(P)})},[$(i,{class:"truncate max-w-full","show-on-truncate-only":""},{title:d(()=>[N(_(e(I).title),1)]),default:d(()=>[g("span",Xe,_(e(I).title),1)]),_:1})],6)]),_:1},8,["color"])):q("",!0)]))],64))],42,Qe)}}}),wt=Te(lt,[["__scopeId","data-v-49ed29a2"]]);export{wt as default};
