const __vite__fileDeps=["./D4elByXX.js","./Cgw6cdOy.js","./entry.DxI7QTvq.css","./C2piJvdv.js","./Bm9fcnRD.js","./LockType.C1lKbPeu.css","./1TGO_kFB.js","./DBXRneGc.js","./DCaZaUH5.js","./DpYA1Dpy.js","./dmcxUY_0.js","./BcZAlRJW.js","./hvq8FVej.js","./LSbsNkd9.js","./BZz6iAla.js","./DPaOlBFV.js","./BQQOEPN4.js","./Bcy-XIkn.js","./C8c9012h.js","./BIsWr_mR.js","./KNudlHpk.js","./CitraFSq.js","./VVwMOds3.js","./hzkm8p6q.js","./Cd1fRcFb.js","./BohSct8s.js","./QuickImport.nWfi1EI3.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{f as ne,cY as xe,ad as we,cR as ie,c_ as Le,r as j,at as Se,g as E,F as Te,b1 as Me,o as i,S as w,w as o,a as y,b as a,t as r,P as e,a9 as De,aL as Re,Y as Ee,d as v,Q as ye,aj as Q,ak as le,d8 as be,a0 as ke,A as re,_ as ge,cV as $e,ar as je,c as p,T as h,L as Oe,bN as Ue,dB as Ne,ai as Pe,az as _e,cN as ze,dC as $,as as Fe,O as Ae,aq as x,d7 as T,R as X,av as ve,U as Be,V as Ge,W as qe,$ as Qe,a1 as Ke,ab as Ye,Z as ce,a6 as de,p as We,e as Ze}from"./Cgw6cdOy.js";import{_ as He}from"./ahvdY77A.js";import{F as fe}from"./DpYA1Dpy.js";import{_ as Je}from"./BIsWr_mR.js";import"./Bcy-XIkn.js";import{_ as Xe}from"./dmcxUY_0.js";import{_ as et}from"./WttlrBnq.js";import{_ as tt}from"./BjDOiTMF.js";import{_ as ot}from"./C6pQ4eSP.js";import{_ as at}from"./DBOeGHNL.js";import{_ as st}from"./DAGD02vG.js";import{_ as it}from"./Bxm040c6.js";import{u as nt}from"./DbRkwnd8.js";const lt={class:"flex flex-row items-center gap-x-2"},rt={class:"text-gray-900 font-semibold"},ct={class:"mt-1"},dt={class:"flex flex-row justify-end gap-x-2 mt-5"},ut=ne({__name:"ViewDescriptionUpdate",props:{modelValue:{type:Boolean},view:{},sourceId:{}},emits:["update:modelValue","updated"],setup(n,{emit:O}){const u=xe(n,["view"]),b=O,{$e:C,$api:L}=re(),m=we(u,"modelValue",b),{loadViews:U}=ie(),{addUndo:M,defineProjectScope:N}=Le(),s=j(),_=j(!1),P=fe.useForm,d=Se({description:""}),z=E(()=>({description:[{validator:(c,l)=>new Promise((V,F)=>{V()})}]})),{validateInfos:K}=P(d,z);Te(()=>{var c;(c=n.view)!=null&&c.description&&(d.description=`${n.view.description}`),Me(()=>{var V;const l=(V=s.value)==null?void 0:V.$el;l&&(l.setSelectionRange(0,d.description.length),l.focus())})},{flush:"post"});const D=async(c=!1)=>{if(n.view){d.description&&(d.description=d.description.trim()),_.value=!0;try{await L.dbView.update(n.view.id,{description:d.description}),m.value=!1,c||M({redo:{fn:l=>{d.description=l,D(!0,!0)},args:[d.description]},undo:{fn:l=>{d.description=l,D(!0,!0)},args:[n.view.description]},scope:N({view:n.view})}),await U({tableId:n.view.fk_model_id,ignoreLoading:!0,force:!0}),C("a:view:description:update"),m.value=!1}catch(l){Q.error(await le(l))}_.value=!1}};return(c,l)=>{const V=be,F=Je,ee=Xe,te=fe,A=ke,B=He;return i(),w(B,{visible:e(m),"onUpdate:visible":l[4]||(l[4]=I=>ye(m)?m.value=I:null),size:"small","show-separator":!1},{header:o(()=>{var I;return[y("div",lt,[a(V,{meta:c.view,class:"mt-0.5 !text-2xl"},null,8,["meta"]),y("span",rt,r((I=c.view)==null?void 0:I.title),1)])]}),default:o(()=>{var I,G,Y,W;return[y("div",ct,[a(te,{layout:"vertical",model:e(d),name:"create-new-table-form"},{default:o(()=>[a(ee,De({label:c.$t("labels.description")},e(K).description),{default:o(()=>[a(F,{ref_key:"inputEl",ref:s,value:e(d).description,"onUpdate:value":l[0]||(l[0]=Z=>e(d).description=Z),class:"nc-input-sm !py-2 nc-text-area !text-gray-800 nc-input-shadow","hide-details":"",size:"small",placeholder:c.$t("msg.info.enterTableDescription"),onKeydown:l[1]||(l[1]=Re(Ee(()=>D(),["exact"]),["enter"]))},null,8,["value","placeholder"])]),_:1},16,["label"])]),_:1},8,["model"]),y("div",dt,[a(A,{type:"secondary",size:"small",onClick:l[2]||(l[2]=Z=>m.value=!1)},{default:o(()=>[v(r(c.$t("general.cancel")),1)]),_:1}),a(A,{key:"submit",type:"primary",size:"small",disabled:((G=(I=e(K))==null?void 0:I.description)==null?void 0:G.validateStatus)==="error"||((Y=e(d).description)==null?void 0:Y.trim())===((W=c.view)==null?void 0:W.description),loading:e(_),onClick:l[3]||(l[3]=()=>D())},{default:o(()=>[v(r(c.$t("general.save")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["visible"])}}}),Gt=ge(ut,[["__scopeId","data-v-b1252ebc"]]),pt={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700"},mt={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-3",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},_t={key:0},vt={key:1},qt=ne({__name:"ViewDelete",props:{modelValue:{type:Boolean},view:{}},emits:["update:modelValue","deleted"],setup(n,{emit:O}){const u=n,b=O,{refreshCommandPalette:C}=$e(),{view:L}=u,m=we(u,"modelValue",b),{api:U}=je(),{$e:M}=re();async function N(){if(u.view)try{await U.dbView.delete(u.view.id),m.value=!1,b("deleted"),M("a:view:delete",{view:u.view.type})}catch(s){Q.error(await le(s))}finally{C()}}return(s,_)=>{const P=be,d=et;return i(),w(d,{visible:e(m),"onUpdate:visible":_[0]||(_[0]=z=>ye(m)?m.value=z:null),"entity-name":s.$t("objects.view"),"on-delete":N},{"entity-preview":o(()=>[e(L)?(i(),p("div",pt,[a(P,{meta:u.view,class:"nc-view-icon w-4 min-h-4"},null,8,["meta"]),y("div",mt,[e(L).is_default?(i(),p("span",_t,r(s.$t("labels.defaultView")),1)):(i(),p("span",vt,r(e(L).title),1))])])):h("",!0)]),_:1},8,["visible","entity-name"])}}}),ft=ce(()=>de(()=>import("./D4elByXX.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(n=>n.default||n)),wt=ce(()=>de(()=>import("./Bm9fcnRD.js"),__vite__mapDeps([4,1,2,5]),import.meta.url).then(n=>n.default||n)),yt=ce(()=>de(()=>import("./1TGO_kFB.js").then(n=>n.Q),__vite__mapDeps([6,1,2,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]),import.meta.url).then(n=>n.default||n)),bt=n=>(We("data-v-391f8735"),n=n(),Ze(),n),kt={class:"flex text-xs font-bold text-gray-500 ml-1"},gt={class:"nc-base-menu-item group"},$t={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},ht={class:"nc-base-menu-item group nc-view-context-download-option"},Ct={class:"flex flex-row items-center gap-x-3"},Vt={class:"nc-base-menu-item flex !flex-shrink group !py-1 !px-1 rounded-md bg-brand-50"},It=bt(()=>y("div",{class:"flex flex-grow"},null,-1)),xt={class:"flex py-3 px-4 font-bold uppercase text-xs text-gray-500"},Lt={key:1},St=ne({__name:"ViewActionMenu",props:{view:{},table:{},inSidebar:{type:Boolean,default:!1}},emits:["rename","closeModal","delete","descriptionUpdate"],setup(n,{emit:O}){const u=n,b=O,{isUIAllowed:C,isDataReadOnly:L}=Oe(),m=Ue(Ne,j(!1)),{$api:U,$e:M}=re(),{t:N}=Pe(),s=E(()=>u.view),_=E(()=>u.table),{viewsByTable:P}=_e(ie()),{loadViews:d,navigateToView:z}=ie(),{base:K}=_e(ze()),{refreshCommandPalette:D}=$e(),c=E(()=>{var t;return((t=s.value)==null?void 0:t.lock_type)||$.Collaborative}),l=E(()=>P.value.get(_.value.id)),V=j(!1),F=E(()=>{var t;return(t=_.value)==null?void 0:t.source_id}),ee=()=>{b("rename")},te=()=>{b("descriptionUpdate")},A=["csv","excel"],B=A.reduce((t,g)=>(t[g]=j(!1),t),{}),I=t=>{c.value!==$.Locked&&(b("closeModal"),t.value=!0)};async function G(t){if(M("a:grid:lockmenu",{lockType:t,sidebar:u.inSidebar}),!!s.value){if(t==="personal")return Q.info(N("msg.toast.futureRelease"));try{s.value.lock_type=t,await U.dbView.update(s.value.id,{lock_type:t}),Q.success(`Successfully Switched to ${t} view`)}catch(g){Q.error(await le(g))}b("closeModal")}}function Y(){b("closeModal");const t=j(!0),{close:g}=nt(tt,{modelValue:t,title:s.value.title,type:s.value.type,tableId:_.value.id,selectedViewId:s.value.id,groupingFieldColumnId:s.value.view.fk_grp_col_id,views:l,description:s.value.description,calendarRange:s.value.view.calendar_range,coverImageColumnId:s.value.view.fk_cover_image_col_id,"onUpdate:modelValue":f,onCreated:async q=>{f(),D(),await d({force:!0,tableId:_.value.id}),z({view:q,tableId:_.value.id,baseId:K.value.id,hardReload:q.type===T.FORM}),M("a:view:create",{view:q.type,sidebar:u.inSidebar})}});function f(){t.value=!1,g(1e3)}}const{copy:W}=Fe(),Z=async()=>{await W(s.value.id),V.value=!0},he=async()=>{b("delete")};return(t,g)=>{const f=Qe,q=ke,oe=Ke,H=ot,S=at,ae=st,Ce=ft,se=wt,ue=Ye,Ve=yt,Ie=it,J=Ae("e");return e(s)?(i(),w(Ie,{key:0,"data-testid":`view-sidebar-view-actions-${e(s).alias||e(s).title}`,class:"!min-w-70","data-id":"toolbar-actions"},{default:o(()=>{var pe,me;return[a(oe,null,{title:o(()=>[v(r(t.$t("labels.clickToCopyViewID")),1)]),default:o(()=>{var k;return[y("div",{class:"flex items-center justify-between p-2 mx-1.5 rounded-md cursor-pointer hover:bg-gray-100 group",onClick:Z},[y("div",kt,r(t.$t("labels.viewIdColon",{viewId:(k=e(s))==null?void 0:k.id})),1),a(q,{class:"!group-hover:bg-gray-100",size:"xsmall",type:"secondary"},{default:o(()=>[e(V)?(i(),w(f,{key:0,class:"max-h-4 min-w-4",icon:"check"})):(i(),w(f,{key:1,class:"max-h-4 min-w-4",else:"",icon:"copy"}))]),_:1})])]}),_:1}),!((pe=e(s))!=null&&pe.is_default)&&e(C)("viewCreateOrEdit")?(i(),p(x,{key:0},[a(H),t.inSidebar?(i(),p(x,{key:0},[e(c)!==e($).Locked?(i(),w(S,{key:0,onClick:ee},{default:o(()=>[a(f,{icon:"rename"}),v(" "+r(t.$t("general.renameEntity",{entity:e(s).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})):(i(),w(oe,{key:1},{title:o(()=>[v(r(t.$t("msg.info.disabledAsViewLocked")),1)]),default:o(()=>[a(S,{class:"!cursor-not-allowed !text-gray-400"},{default:o(()=>[a(f,{icon:"rename"}),v(" "+r(t.$t("general.renameEntity",{entity:e(s).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})]),_:1})),e(c)!==e($).Locked?(i(),w(S,{key:2,onClick:te},{default:o(()=>[a(f,{icon:"ncAlignLeft"}),v(" "+r(t.$t("general.edit"))+" "+r(t.$t("labels.description")),1)]),_:1})):h("",!0)],64)):h("",!0),a(S,{onClick:Y},{default:o(()=>[a(f,{class:"nc-view-copy-icon",icon:"duplicate"}),v(" "+r(t.$t("general.duplicateEntity",{entity:e(s).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})],64)):h("",!0),e(s).type!==e(T).FORM?(i(),p(x,{key:1},[a(H),e(C)("csvTableImport")&&!e(m)&&!e(L)?(i(),w(ae,{key:"upload"},{title:o(()=>[X((i(),p("div",gt,[a(f,{icon:"upload"}),v(" "+r(t.$t("general.upload")),1)])),[[J,["c:navdraw:preview-as",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>[]),default:o(()=>[y("div",$t,r(t.$t("activity.uploadData")),1),(i(!0),p(x,null,ve(e(B),(k,R)=>(i(),p(x,null,[e(C)(`${R}TableImport`)&&!e(m)?(i(),w(S,{key:R,onClick:Tt=>I(k)},{default:o(()=>[X((i(),p("div",{class:Be([{disabled:e(c)===e($).Locked},"nc-base-menu-item"])},[(i(),w(Ge(("iconMap"in t?t.iconMap:e(qe)).cloudUpload))),v(" "+r(`${t.$t("general.upload")} ${R.toUpperCase()}`),1)],2)),[[J,[`a:upload:${R}`,{sidebar:u.inSidebar}]]])]),_:2},1032,["onClick"])):h("",!0)],64))),256))]),_:1})):h("",!0),a(ae,{key:"download"},{title:o(()=>[X((i(),p("div",ht,[a(f,{icon:"download"}),v(" "+r(t.$t("general.download")),1)])),[[J,["c:download",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>[]),default:o(()=>[a(Ce)]),_:1})],64)):h("",!0),e(C)("viewCreateOrEdit")?(i(),p(x,{key:2},[a(H),a(ae,{key:"lock-type",class:"scrollbar-thin-dull max-h-90vh overflow-auto !py-0"},{title:o(()=>[X((i(),p("div",Ct,[y("div",null,r(t.$t("labels.viewMode")),1),y("div",Vt,[a(se,{type:e(c),class:"flex nc-view-actions-lock-type !text-brand-500 !flex-shrink","hide-tick":""},null,8,["type"])]),It])),[[J,["c:navdraw:preview-as",{sidebar:u.inSidebar}]]])]),expandIcon:o(()=>[]),default:o(()=>[y("div",xt,r(t.$t("labels.viewMode")),1),a(ue,{class:"!mx-1 !py-2 !rounded-md nc-view-action-lock-subaction max-w-[100px]"},{default:o(()=>[a(se,{type:e($).Collaborative,onClick:g[0]||(g[0]=k=>G(e($).Collaborative))},null,8,["type"])]),_:1}),a(ue,{class:"!mx-1 !py-2 !rounded-md nc-view-action-lock-subaction"},{default:o(()=>[a(se,{type:e($).Locked,onClick:g[1]||(g[1]=k=>G(e($).Locked))},null,8,["type"])]),_:1})]),_:1})],64)):h("",!0),!e(s).is_default&&e(C)("viewCreateOrEdit")?(i(),p(x,{key:3},[a(H),e(c)===e($).Locked?(i(),w(oe,{key:0},{title:o(()=>[v(r(t.$t("msg.info.disabledAsViewLocked")),1)]),default:o(()=>[a(S,{class:"!cursor-not-allowed !text-gray-400"},{default:o(()=>[a(f,{class:"nc-view-delete-icon",icon:"delete"}),v(" "+r(t.$t("general.deleteEntity",{entity:e(s).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1})]),_:1})):(i(),w(S,{key:1,class:"!hover:bg-red-50 !text-red-500",onClick:he},{default:o(()=>[a(f,{class:"nc-view-delete-icon",icon:"delete"}),v(" "+r(t.$t("general.deleteEntity",{entity:e(s).type!==e(T).FORM?t.$t("objects.view").toLowerCase():t.$t("objects.viewType.form").toLowerCase()})),1)]),_:1}))],64)):h("",!0),(me=e(_))!=null&&me.base_id&&e(F)?(i(),p(x,{key:4},ve(A,k=>a(Ve,{key:k,modelValue:e(B)[k].value,"onUpdate:modelValue":R=>e(B)[k].value=R,"import-data-only":!0,"import-type":k,"base-id":e(_).base_id,"source-id":e(F)},null,8,["modelValue","onUpdate:modelValue","import-type","base-id","source-id"])),64)):h("",!0)]}),_:1},8,["data-testid"])):(i(),p("span",Lt))}}}),Qt=ge(St,[["__scopeId","data-v-391f8735"]]);export{Qt as _,qt as a,Gt as b};
