import{f as qe,ab as Ke,ac as Xe,bL as U,fH as Je,g6 as Ze,r as V,d0 as He,c$ as ei,d1 as ii,fC as si,gx as ti,ai as li,cP as ai,cQ as ni,L as oi,g as F,hK as se,cU as L,as as di,iL as ri,hL as ui,O as ci,o as l,c as C,P as e,U as o,w as u,b as y,T as Ce,cV as pi,a as q,V as I,W as k,d as _,t as h,S as w,R as A,al as te,fw as he,fI as ke,h9 as O,X as Me,Y as Ie,Q as le,an as Le,a_ as mi,$ as fi,aG as vi,ap as yi,af as gi,A as _i,ao as wi,_ as bi}from"./nEPQs079.js";import{_ as Ci}from"./BMD-JIxU.js";import{_ as hi}from"./C7QTvYaO.js";import{_ as ki}from"./C6cwFr3C.js";import{_ as Mi,a as Ii}from"./DLam_m52.js";import{a as Li}from"./vKaAFL5T.js";import{u as Oi}from"./B2IWgAhL.js";import{a as Ei}from"./BfMXOlc4.js";import{a as Di}from"./DLdzJuss.js";import{k as Ti}from"./DAFLhYLz.js";import{_ as Vi}from"./C5mABW8R.js";import"./CBZqTOye.js";import"./BQDKbNwe.js";import"./-QMWbHL6.js";import"./C3R8onno.js";import"./CF0GO8gh.js";import"./Gr6cVSxP.js";import"./BfnA8LRy.js";import"./Dmq5P-i4.js";import"./COktFmkf.js";import"./-Hb63wRq.js";const Fi={key:0,class:"h-[1px]"},Ai={class:"nc-column-edit nc-header-menu-item"},Bi={class:"nc-column-duplicate nc-header-menu-item"},Ri={class:"nc-column-insert-before nc-header-menu-item"},Si={class:"nc-column-set-primary nc-header-menu-item item"},$i={class:"nc-column-insert-after nc-header-menu-item"},Ui={class:"nc-column-insert-before nc-header-menu-item"},Gi={class:"nc-column-filter nc-header-menu-item"},Pi={class:"nc-column-groupby nc-header-menu-item"},Ni={class:"nc-column-duplicate nc-header-menu-item"},ji={class:"nc-column-insert-after nc-header-menu-item"},xi={class:"nc-column-insert-before nc-header-menu-item"},zi=qe({__name:"Menu",props:{virtual:{type:Boolean},isOpen:{type:Boolean},isHiddenCol:{type:Boolean}},emits:["edit","addColumn","update:isOpen"],setup(Oe,{emit:Ee}){const ae=Oe,K=Ee,De=Ke(ae,"virtual"),b=Xe(ae,"isOpen",K),{eventBus:B,allFilters:Te}=Li(),s=U(Je),p=U(Ze),d=U(He,V()),g=U(ei,V()),Ve=U(ii),ne=U(si,V(!1)),R=U(ti,V(!1)),{insertSort:Fe}=Oi(g,()=>p==null?void 0:p.trigger()),{$api:M,$e:Ae}=_i(),{t:P}=li(),{getMeta:S}=ai(),{addUndo:oe,defineModelScope:Be,defineViewScope:Re}=ni(),N=V(!1),{gridViewCols:de}=Ei(),{fieldsToGroupBy:X,groupByLimit:Se}=Di(),{isUIAllowed:j,isMetaReadOnly:x,isDataReadOnly:$e}=oi(),G=V(""),Ue=async()=>{var i,t,n,a,r;G.value="setDisplay";try{const c=(t=(i=d==null?void 0:d.value)==null?void 0:i.columns)==null?void 0:t.find(m=>m.pv);b.value=!1,await M.dbTableColumn.primaryColumnSet((n=s==null?void 0:s.value)==null?void 0:n.id),await S((a=d==null?void 0:d.value)==null?void 0:a.id,!0),B.emit(O.FIELD_RELOAD),Ae("a:column:set-primary"),oe({redo:{fn:async m=>{var f;await M.dbTableColumn.primaryColumnSet(m),await S((f=d==null?void 0:d.value)==null?void 0:f.id,!0),B.emit(O.FIELD_RELOAD)},args:[(r=s==null?void 0:s.value)==null?void 0:r.id]},undo:{fn:async m=>{var f;await M.dbTableColumn.primaryColumnSet(m),await S((f=d==null?void 0:d.value)==null?void 0:f.id,!0),B.emit(O.FIELD_RELOAD)},args:[c==null?void 0:c.id]},scope:Be({model:d.value})})}catch{Le.error(P("msg.error.primaryColumnUpdateFailed"))}finally{G.value=""}},re=async i=>{await Fe({column:s.value,direction:i,reloadDataHook:p})},z=V(!1),ue=V(),Q=V(),Ge=async()=>{var n;let i={};const t=Ti(`${s.value.title} copy`,d.value.columns);i={...s.value,...s.value.colOptions??{},title:t,column_name:t.replace(/\s/g,"_"),id:void 0,colOptions:void 0,order:void 0,system:!1};try{const a=(await M.dbViewColumn.list((n=g.value)==null?void 0:n.id)).list,r=a.findIndex(m=>m.fk_column_id===s.value.id);let c;r===a.length-1?c=a[r].order+1:c=(a[r].order+a[r+1].order)/2,await M.dbTableColumn.create(d.value.id,{...i,pv:!1,view_id:g.value.id,column_order:{order:c,view_id:g.value.id}}),await S(d.value.id,!0),B.emit(O.FIELD_RELOAD),p==null||p.trigger()}catch(a){Le.error(await wi(a))}b.value=!1},ce=async()=>{var i;if(s!=null&&s.value)if(s.value.uidt&&[L.Lookup,L.Rollup,L.CreatedTime,L.LastModifiedTime,L.CreatedBy,L.LastModifiedBy].includes(s.value.uidt))Ge();else{const t=(await M.dbViewColumn.list((i=g.value)==null?void 0:i.id)).list,n=t.findIndex(r=>r.fk_column_id===s.value.id);let a;n===t.length-1?a=t[n].order+1:a=(t[n].order+t[n+1].order)/2,ue.value={pv:!1,view_id:g.value.id,column_order:{order:a,view_id:g.value.id}},s.value.uidt===L.Formula?mi(()=>{var r;(r=Q==null?void 0:Q.value)==null||r.duplicate()}):z.value=!0,b.value=!1}},pe=async(i=!1)=>{var r,c,m,f;const t=(await M.dbViewColumn.list((r=g.value)==null?void 0:r.id)).list,n=t.findIndex(E=>E.fk_column_id===s.value.id);let a;i?n===0?a=t[n].order/2:a=(t[n].order+((c=t[n-1])==null?void 0:c.order))/2:n===t.length-1?a=t[n].order+1:a=(t[n].order+((m=t[n+1])==null?void 0:m.order))/2,K("addColumn",{column_order:{order:a,view_id:(f=g.value)==null?void 0:f.id}})},Pe=async()=>{var a,r;G.value="hideOrShow";const t=(await M.dbViewColumn.list((a=g.value)==null?void 0:a.id)).list.find(c=>c.fk_column_id===s.value.id),n=[M.dbViewColumn.update(g.value.id,t.id,{show:!t.show})];R.value&&n.push(S((r=d==null?void 0:d.value)==null?void 0:r.id,!0)),await Promise.all(n),B.emit(O.FIELD_RELOAD),t.show||p==null||p.trigger(),oe({redo:{fn:async function(m,f){var $;const E=[M.dbViewColumn.update(g.value.id,m,{show:!f})];R.value&&E.push(S(($=d==null?void 0:d.value)==null?void 0:$.id,!0)),await Promise.all(E),B.emit(O.FIELD_RELOAD),f||p==null||p.trigger()},args:[t.id,t.show]},undo:{fn:async function(m,f){var $;const E=[M.dbViewColumn.update(g.value.id,m,{show:f})];R.value&&E.push(S(($=d==null?void 0:d.value)==null?void 0:$.id,!0)),await Promise.all(E),B.emit(O.FIELD_RELOAD),p==null||p.trigger(),f&&(p==null||p.trigger())},args:[t.id,t.show]},scope:Re({view:g.value})}),G.value=""},Ne=()=>{b.value=!1,N.value=!0},je=()=>{b.value=!1,K("edit")},xe=()=>{b.value=!1,pe(!0)},ze=()=>{b.value=!1,pe()},me=F(()=>(s==null?void 0:s.value)&&!s.value.system),Y=F(()=>{var i;return(s==null?void 0:s.value)&&!s.value.system&&(!x.value&&!$e.value||se.includes((i=s.value)==null?void 0:i.uidt))}),J=F(()=>{var i;return!!(((i=d.value)==null?void 0:i.columns)||[]).find(t=>{var n;return t.id===((n=s==null?void 0:s.value)==null?void 0:n.id)&&![L.QrCode,L.Barcode].includes(t.uidt)})}),{getPlanLimit:Qe}=di(),Z=F(()=>Te.value.filter(i=>!(i.is_group||i.status==="delete")).length>=Qe(ri.FILTER_LIMIT)),W=F(()=>{var i,t;return!!((t=de.value[(i=s==null?void 0:s.value)==null?void 0:i.id])!=null&&t.group_by)}),H=F(()=>!!(X.value||[]).find(i=>{var t;return i.id===((t=s==null?void 0:s.value)==null?void 0:t.id)})),ee=F(()=>{const i=Object.values(de.value).filter(t=>t.group_by);return!(X.value.length&&X.value.length>i.length&&i.length<Se)}),fe=i=>{s!=null&&s.value&&B.emit(i,s.value),b.value=!1},ie=F(()=>{var i;return!(x.value&&!se.includes((i=s.value)==null?void 0:i.uidt))}),ve=F(()=>{var i,t;return!(x.value&&!se.includes((i=s.value)==null?void 0:i.uidt)&&!ui.includes((t=s.value)==null?void 0:t.uidt))});return(i,t)=>{const n=fi,a=Ci,r=hi,c=Vi,m=vi,f=yi,E=ki,$=gi,Ye=Mi,We=Ii,D=ci("e");return l(),C(te,null,[e(Ve)?w("",!0):(l(),o($,{key:0,visible:e(b),"onUpdate:visible":t[5]||(t[5]=T=>le(b)?b.value=T:null),trigger:["click"],placement:e(R)?"bottomLeft":"bottomRight","overlay-class-name":"nc-dropdown-column-operations !border-1 rounded-lg !shadow-xl ",onClick:t[6]||(t[6]=Ie(T=>b.value=!e(b),["stop"]))},{overlay:u(()=>[y(E,{class:Ce(["flex flex-col gap-1 border-gray-200 nc-column-options",{"min-w-[256px]":e(R)}])},{default:u(()=>{var T,ye,ge,_e,we,be;return[y(r,{message:"Field properties cannot be edited.",enabled:!e(ve)},{default:u(()=>{var v;return[e(j)("fieldAlter")?(l(),o(a,{key:0,disabled:((v=e(s))==null?void 0:v.pk)||e(pi)(e(s))||!e(ve),onClick:je},{default:u(()=>[q("div",Ai,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).ncEdit),{class:"text-gray-700"})),_(" "+h(i.$t("general.edit")),1)])]),_:1},8,["disabled"])):w("",!0)]}),_:1},8,["enabled"]),y(r,{message:"Field cannot be duplicated.",enabled:!e(Y)},{default:u(()=>{var v;return[e(j)("duplicateColumn")&&e(R)&&!((v=e(s))!=null&&v.pk)?(l(),o(a,{key:0,disabled:!e(Y),onClick:ce},{default:u(()=>[A((l(),C("div",Bi,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).duplicate),{class:"text-gray-700"})),_(" "+h(e(P)("general.duplicate")),1)])),[[D,["a:field:duplicate"]]])]),_:1},8,["disabled"])):w("",!0)]}),_:1},8,["enabled"]),e(j)("fieldAlter")&&!((T=e(s))!=null&&T.pv)?(l(),o(c,{key:0,class:"!my-0"})):w("",!0),(ye=e(s))!=null&&ye.pv?w("",!0):(l(),o(a,{key:1,onClick:Pe},{default:u(()=>[A((l(),C("div",Ri,[e(G)==="hideOrShow"?(l(),o(m,{key:0,size:"regular"})):(l(),o(I(i.isHiddenCol?("iconMap"in i?i.iconMap:e(k)).eye:("iconMap"in i?i.iconMap:e(k)).eyeSlash),{key:1,class:"text-gray-700 !w-4 !h-4"})),_(" "+h(i.isHiddenCol?i.$t("general.showField"):i.$t("general.hideField")),1)])),[[D,["a:field:hide"]]])]),_:1})),(!e(De)||((ge=e(s))==null?void 0:ge.uidt)===e(L).Formula)&&!((_e=e(s))!=null&&_e.pv)&&!i.isHiddenCol?(l(),o(a,{key:2,onClick:Ue},{default:u(()=>[q("div",Si,[e(G)==="setDisplay"?(l(),o(m,{key:0,size:"regular"})):(l(),o(n,{key:1,icon:"star",class:"text-gray-700 !w-4.25 !h-4.25"})),_(" "+h(i.$t("activity.setDisplay")),1)])]),_:1})):w("",!0),e(R)?w("",!0):(l(),C(te,{key:3},[!e(he)(e(s))||e(s).colOptions.type!==e(ke).BELONGS_TO?(l(),o(c,{key:0,class:"!my-0"})):w("",!0),!e(he)(e(s))||e(s).colOptions.type!==e(ke).BELONGS_TO?(l(),C(te,{key:1},[y(a,{onClick:t[1]||(t[1]=v=>re("asc"))},{default:u(()=>[A((l(),C("div",$i,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).sortDesc),{class:"text-gray-700 !rotate-180 !w-4.25 !h-4.25",style:{transform:"rotate(180deg)"}})),_(" "+h(i.$t("general.sortAsc")),1)])),[[D,["a:field:sort",{dir:"asc"}]]])]),_:1}),y(a,{onClick:t[2]||(t[2]=v=>re("desc"))},{default:u(()=>[A((l(),C("div",Ui,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).sortDesc),{class:"text-gray-700 !w-4.25 !h-4.25"})),_(" "+h(i.$t("general.sortDesc").trim()),1)])),[[D,["a:field:sort",{dir:"desc"}]]])]),_:1})],64)):w("",!0),y(c,{class:"!my-0"}),y(f,{disabled:e(J)&&!e(Z)},{title:u(()=>[_(h(e(J)?e(Z)?"Filter by limit exceeded":"":"This field type doesn't support filtering"),1)]),default:u(()=>[y(a,{disabled:!e(J)||e(Z),onClick:t[3]||(t[3]=v=>fe(e(O).FILTER_ADD))},{default:u(()=>[A((l(),C("div",Gi,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).filter),{class:"text-gray-700"})),_(" Filter by this field ")])),[[D,["a:field:add:filter"]]])]),_:1},8,["disabled"])]),_:1},8,["disabled"]),y(f,{disabled:e(H)&&!e(ee)||e(W)||!(("isEeUI"in i?i.isEeUI:e(Me))&&!e(ne))},{title:u(()=>[_(h(e(H)?e(ee)?"Group by limit exceeded":"":"This field type doesn't support grouping"),1)]),default:u(()=>[y(a,{disabled:("isEeUI"in i?i.isEeUI:e(Me))&&!e(ne)&&(!e(H)||e(ee))&&!e(W),onClick:t[4]||(t[4]=v=>fe(e(W)?e(O).GROUP_BY_REMOVE:e(O).GROUP_BY_ADD))},{default:u(()=>[A((l(),C("div",Pi,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).group),{class:"text-gray-700"})),_(" "+h(e(W)?"Don't group by this field":"Group by this field"),1)])),[[D,["a:field:add:groupby"]]])]),_:1},8,["disabled"])]),_:1},8,["disabled"]),y(c,{class:"!my-0"}),y(r,{message:"Field cannot be duplicated.",enabled:!e(Y)&&e(x)},{default:u(()=>{var v;return[(v=e(s))!=null&&v.pk?w("",!0):(l(),o(a,{key:0,disabled:!e(Y),onClick:ce},{default:u(()=>[A((l(),C("div",Ni,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).duplicate),{class:"text-gray-700"})),_(" "+h(e(P)("general.duplicate")),1)])),[[D,["a:field:duplicate"]]])]),_:1},8,["disabled"]))]}),_:1},8,["enabled"]),y(a,{onClick:ze},{default:u(()=>[A((l(),C("div",ji,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).colInsertAfter),{class:"text-gray-700 !w-4.5 !h-4.5"})),_(" "+h(e(P)("general.insertAfter")),1)])),[[D,["a:field:insert:after"]]])]),_:1}),(we=e(s))!=null&&we.pv?w("",!0):(l(),o(a,{key:2,onClick:xe},{default:u(()=>[A((l(),C("div",xi,[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).colInsertBefore),{class:"text-gray-600 !w-4.5 !h-4.5"})),_(" "+h(e(P)("general.insertBefore")),1)])),[[D,["a:field:insert:before"]]])]),_:1}))],64)),(be=e(s))!=null&&be.pv?w("",!0):(l(),o(c,{key:4,class:"!my-0"})),y(r,{message:"Field cannot be deleted.",enabled:!e(ie)},{default:u(()=>{var v;return[!((v=e(s))!=null&&v.pv)&&e(j)("fieldDelete")?(l(),o(a,{key:0,disabled:!e(me)||!e(ie),class:"!hover:bg-red-50",onClick:Ne},{default:u(()=>[q("div",{class:Ce(["nc-column-delete nc-header-menu-item",{" text-red-600":e(me)&&e(ie)}])},[(l(),o(I(("iconMap"in i?i.iconMap:e(k)).delete))),_(" "+h(i.$t("general.delete")),1)],2)]),_:1},8,["disabled"])):w("",!0)]}),_:1},8,["enabled"])]}),_:1},8,["class"])]),default:u(()=>[q("div",{onDblclick:t[0]||(t[0]=Ie(()=>{},["stop"]))},[e(R)?(l(),C("div",Fi,"Â ")):(l(),o(n,{key:1,icon:"arrowDown",class:"text-grey h-full text-grey nc-ui-dt-dropdown cursor-pointer outline-0 mr-2"}))],32)]),_:1},8,["visible","placement"])),y(Ye,{visible:e(N),"onUpdate:visible":t[7]||(t[7]=T=>le(N)?N.value=T:null)},null,8,["visible"]),e(s)?(l(),o(We,{key:1,ref_key:"duplicateDialogRef",ref:Q,modelValue:e(z),"onUpdate:modelValue":t[8]||(t[8]=T=>le(z)?z.value=T:null),column:e(s),extra:e(ue)},null,8,["modelValue","column","extra"])):w("",!0)],64)}}}),ps=bi(zi,[["__scopeId","data-v-aadb842b"]]);export{ps as default};
