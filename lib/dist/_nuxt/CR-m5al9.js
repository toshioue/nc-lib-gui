const __vite__fileDeps=["./CJFB-Lev.js","./DZZ6t_j4.js","./entry.DIDWwc7m.css","./Header.x-GI6b6n.css","./BpL0I7vq.js","./RXURfzjs.js","./C00NHga8.js","./BDAIZopQ.js","./CVMW45vd.js","./ListItem.-o3YFXe-.css","./CRPCEw5j.js","./sz1d3zjm.js","./MenuItem.C7h59s4s.css","./TJfB7GlU.js","./0azk-b-q.js","./Divider.DqtSqZhb.css","./BLgccLvp.js","./Menu.CQ8GNWeI.css","./vK-WmZ7a.js","./B9n4-CGo.js","./DivDataCell.1yCNpUg3.css","./DnwRMKX3.js","./UserIcon.DEVmGavY.css","./B6xrG0q8.js","./B89oU1M4.js","./Badge.D0-UrqG9.css","./BmNyaTYf.js","./Cy50pBgZ.js","./DKN1hQ6S.js","./BQuyMdA-.js","./BQQOEPN4.js","./vll-Pnjv.js","./B5RRVMt5.js","./DGj1ycqW.js","./DyDFI6NE.js","./links.C8uCzV-l.css","./Dwil3It4.js","./uhBJvRY2.js","./DS_HXCWn.js","./CMIIcM5i.js","./Bgw0NQgX.js","./GMLocJHP.js","./2FgppHLC.js","./CA74dF2b.js","./qW2V2r_p.js","./ByVBARmO.js","./boyBAVNN.js","./C4o9gerC.js","./B05h-4V9.js","./Ck-cgwga.js","./Tabs.DaLSLYpn.css","./BqKQ8afS.js","./DgixBgIx.js","./DeleteModal.SEMJ_gSK.css","./CXD-Dj4T.js","./i4aLU0Nw.js","./EqBqqo9-.js","./Bdv7ru7D.js","./BmtvKY7O.js","./DXQuLwNn.js","./index.XURKHfTB.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{e as et,ab as tt,L as st,ag as ot,bL as U,r as y,aD as at,dz as nt,g2 as lt,hK as it,J as rt,ax as dt,cL as ct,F,iz as Ce,f as O,fE as Ie,g3 as W,g as ut,cA as mt,M as pt,o as a,c as _,a as l,N as t,b as k,w as P,W as j,ao as Z,at as ee,Q as C,aJ as te,t as D,P as se,d as oe,R as S,O as ft,dH as _t,S as vt,X as ne,a4 as le,m as ae,ah as ht,Y as yt,Z as kt,hA as Te,d0 as wt,_ as gt}from"./DZZ6t_j4.js";import{_ as xt}from"./QHHXY-Ma.js";import{a as bt}from"./Dzpuh1ae.js";import{a as Lt}from"./CA74dF2b.js";import{i as Oe,D as Rt}from"./C4K5fdHe.js";import{e as Ct}from"./BDAIZopQ.js";import{_ as It}from"./Cy6_Pye2.js";import"./DKN1hQ6S.js";import{I as Tt}from"./BQuyMdA-.js";import{S as Ot}from"./BLzs_b5A.js";import"./uskrw1rV.js";import{S as St}from"./BmtvKY7O.js";import"./D_MsYLkT.js";import"./BCJFTkwv.js";import"./BQQOEPN4.js";import"./CB1aB6F1.js";import"./B5RRVMt5.js";import"./vll-Pnjv.js";import"./GMLocJHP.js";import"./bNr_om_C.js";import"./qW2V2r_p.js";import"./ByVBARmO.js";import"./boyBAVNN.js";import"./BCU2uY6p.js";import"./C3jLTHF4.js";import"./BYINaHrJ.js";import"./dfem9Uc_.js";import"./D9tFZoTQ.js";import"./DGj1ycqW.js";import"./DyDFI6NE.js";import"./DXQuLwNn.js";const At=""+new URL("link-records.BXQG6er6.png",import.meta.url).href,Et=ne(()=>le(()=>import("./CJFB-Lev.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(m=>m.default||m)),zt=ne(()=>le(()=>import("./BpL0I7vq.js"),__vite__mapDeps([4,1,2,5,6,7,8,9]),import.meta.url).then(m=>m.default||m)),Nt=ne(()=>le(()=>import("./CRPCEw5j.js"),__vite__mapDeps([10,1,2,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,7,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60]),import.meta.url).then(m=>m.default||m)),Vt={class:"flex flex-col h-full"},Ft={class:"nc-dropdown-link-record-header bg-gray-100 py-2 rounded-t-xl flex justify-between pl-3 pr-2 gap-2"},Pt={key:0,class:"flex-1 nc-dropdown-link-record-search-wrapper flex items-center py-0.5 rounded-md"},Dt={key:1},Mt={key:0},$t={class:"cursor-pointer"},Bt={class:"flex items-center"},Ut={class:"flex flex-col gap-2 flex-grow justify-center"},jt={class:"flex flex-row gap-6 w-10/12"},Kt={key:1,class:"h-full flex flex-col gap-2 my-auto items-center justify-center text-gray-500 text-center"},Yt=["alt"],Gt={class:"text-base text-gray-700 font-bold"},Qt={class:"text-gray-700"},qt={class:"flex items-center gap-1"},Ht={class:"nc-dropdown-link-record-footer bg-gray-100 p-2 rounded-b-xl flex items-center justify-between gap-3 min-h-11"},Jt={class:"flex items-center gap-2"},Xt={class:"flex items-center gap-1"},Wt={class:"flex items-center gap-1"},Zt={key:0,class:"flex justify-center items-center"},es=et({__name:"LinkedItems",props:{modelValue:{type:Boolean},cellValue:{},column:{},items:{}},emits:["update:modelValue","attachRecord"],setup(m,{emit:Se}){const A=m,K=Se,Y=tt(A,"modelValue",K),{isMobileMode:G}=st(),{t:ie}=ot(),E=U(at,y(!1)),M=U(nt,y(!1)),$=y(!1),u=U(lt,y()),z=U(it,y(!1)),I=y(),{isDataReadOnly:Ae}=rt(),{isSharedBase:Ee}=dt(ct()),{childrenList:w,childrenListCount:x,loadChildrenList:re,childrenListPagination:i,childrenExcludedOffsetCount:ze,childrenListOffsetCount:Ne,relatedTableDisplayValueProp:de,displayValueTypeAndFormatProp:Ve,unlink:Fe,isChildrenListLoading:Pe,isChildrenListLinked:ce,isChildrenLoading:Q,relatedTableMeta:p,link:De,meta:ue,row:b,resetChildrenListOffsetCount:q}=bt(),{isNew:v,state:N,removeLTARRef:Me,addLTARRef:$e}=Lt();F([Y,E],e=>{(e[0]||e[1])&&!v.value&&re(!0),e[0]||q()},{immediate:!0});const Be=async(e,s)=>{v.value?await Me(e,u==null?void 0:u.value):await Fe(e,{},!1,s)},Ue=async(e,s)=>{v.value?await $e(e,u==null?void 0:u.value):await De(e,{},!1,s)},je=Ce(Te,e=>(p.value.columns??[]).filter(s=>Oe(s))[0]),Ke=Ce(Te,e=>(p.value.columns??[]).filter(s=>!wt(s)&&!Rt(s)&&!Ie(s)&&!Oe(s)).sort((s,n)=>{var r,f;return(((r=s.meta)==null?void 0:r.defaultViewColOrder)??1/0)-(((f=n.meta)==null?void 0:f.defaultViewColOrder)??1/0)}).slice(0,G.value?1:3)),h=y(!1),L=y({}),Ye=O(()=>{var r,f,R,g;if(v.value)return{};const e=(r=u==null?void 0:u.value)==null?void 0:r.colOptions,s=(R=(f=p==null?void 0:p.value)==null?void 0:f.columns)==null?void 0:R.find(T=>{if(!Ie(T))return!1;const d=T==null?void 0:T.colOptions;return(d==null?void 0:d.fk_related_model_id)!==ue.value.id?!1:e.type===W.MANY_TO_MANY&&(d==null?void 0:d.type)===W.MANY_TO_MANY?e.fk_parent_column_id===d.fk_child_column_id&&e.fk_child_column_id===d.fk_parent_column_id:e.fk_parent_column_id===d.fk_parent_column_id&&e.fk_child_column_id===d.fk_child_column_id});if(!s)return{};const n=s==null?void 0:s.colOptions;return n?n.type===W.BELONGS_TO?{[s.title]:(g=b==null?void 0:b.value)==null?void 0:g.row}:{[s.title]:(b==null?void 0:b.value)&&[b.value.row]}:{}}),V=O(()=>{var e;return((e=u.value)==null?void 0:e.title)||""}),me=e=>{z.value||E.value||(L.value=e,h.value=!0)},Ge=()=>{L.value={},h.value=!0,$.value=!0},Qe=e=>{var n;const s=ae("div",{class:"ml-1 inline-flex flex-col gap-1 items-start"},[ae("span",{class:"font-semibold"},ie("activity.recordCreatedLinked")),ae("span",{class:"text-gray-500"},ie("activity.gotSavedLinkedSuccessfully",{tableName:(n=p.value)==null?void 0:n.title,recordTitle:e[de.value]}))]);ht.success(s)},qe=O(()=>{var e,s;return(s=(e=u.value)==null?void 0:e.colOptions)==null?void 0:s.type});F(()=>A.cellValue,()=>{v.value&&re()}),F(h,()=>{h.value||($.value=!1),ze.value=0,Ne.value=0});const He=O(()=>A.items<10&&i.page===1?A.items:x.value<10&&i.page===1?x.value||10:Math.ceil(x.value/10)===i.page?x.value%10:10),Je=O(()=>{var e,s;return E.value||v.value?(s=(e=N.value)==null?void 0:e[V.value])==null?void 0:s.length:Q.value?A.items:x.value}),H=O(()=>{var e,s,n,r;return((s=(e=w.value)==null?void 0:e.pageInfo)==null?void 0:s.totalRows)||v.value&&((r=(n=N.value)==null?void 0:n[V.value])==null?void 0:r.length)}),pe=(e,s)=>{Ee.value||z.value||M.value&&!E.value||(v.value||ce.value[parseInt(s)]?Be(e,parseInt(s)):Ue(e,parseInt(s)))};F([I,H],()=>{var e;(!(z.value||M.value)||H.value)&&((e=I.value)==null||e.focus())});const fe=e=>{var s,n,r,f,R;if(e.key==="Escape")Y.value=!1;else if(e.key==="ArrowDown"){e.preventDefault();try{(n=(s=e.target)==null?void 0:s.nextElementSibling)==null||n.focus()}catch{}}else if(e.key==="ArrowUp"){e.preventDefault();try{(f=(r=e.target)==null?void 0:r.previousElementSibling)==null||f.focus()}catch{}}else if(!h.value&&e.key!=="Tab"&&e.key!=="Shift"&&e.key!=="Enter"&&e.key!==" ")try{(R=I.value)==null||R.focus()}catch{}};ut(()=>{window.addEventListener("keydown",fe),setTimeout(()=>{var e;(e=I.value)==null||e.focus()},100)});const _e=y();F(i,()=>{var e;(e=_e.value)==null||e.scrollTo({top:0,behavior:"smooth"})}),mt(()=>{q(),i.query="",window.removeEventListener("keydown",fe)});const Xe=()=>{i.page=1,q()};return(e,s)=>{var ve,he,ye,ke,we,ge,xe,be,Le;const n=yt,r=Tt,f=Et,R=Ot,g=St,T=zt,d=It,J=kt,We=xt,Ze=Nt,X=pt("e");return a(),_("div",{class:vt(["nc-modal-child-list h-full w-full",{active:t(Y)}]),onKeydown:s[7]||(s[7]=te(j(()=>{},["stop"]),["enter"]))},[l("div",Vt,[l("div",Ft,[t(E)?(a(),_("div",Dt,"Â ")):(a(),_("div",Pt,[k(r,{ref_key:"filterQueryRef",ref:I,value:t(i).query,"onUpdate:value":s[0]||(s[0]=o=>t(i).query=o),bordered:!1,placeholder:"Search linked records...",class:"w-full min-h-4 !pl-0",size:"small",onChange:Xe,onKeydownCapture:s[1]||(s[1]=j(o=>{var c;o.key==="Escape"&&((c=t(I))==null||c.blur())},["stop"]))},{prefix:P(()=>[k(n,{icon:"search",class:"nc-search-icon mr-2 h-4 w-4 text-gray-500"})]),_:1},8,["value"])])),k(f,{"data-testid":"nc-link-count-info","linked-records":t(Je),"related-table-title":(ve=t(p))==null?void 0:ve.title,relation:t(qe),"table-title":(he=t(ue))==null?void 0:he.title},null,8,["linked-records","related-table-title","relation","table-title"])]),l("div",{ref_key:"childrenListRef",ref:_e,class:"flex-1 overflow-auto nc-scrollbar-thin"},[t(H)||t(Q)?(a(),_("div",Mt,[l("div",$t,[t(Q)?(a(!0),_(Z,{key:0},ee(Array.from({length:t(He)}),(o,c)=>(a(),_("div",{key:c,class:"flex flex-row gap-3 px-3 py-2 transition-all relative border-b-1 border-gray-200 hover:bg-gray-50"},[l("div",Bt,[k(R,{class:"!h-11 !w-11 !rounded-md overflow-hidden !children:h-full !children:w-full"})]),l("div",Ut,[k(g,{active:"",class:"h-4 !w-48 !rounded-md overflow-hidden",size:"small"}),l("div",jt,[(a(),_(Z,null,ee([1,2,3],B=>k(g,{key:B,active:"",class:"!h-3 !w-24 !rounded-md overflow-hidden",size:"small"})),64))])])]))),128)):(a(!0),_(Z,{key:1},ee(((ye=t(w))==null?void 0:ye.list)??((ke=t(N))==null?void 0:ke[t(V)])??[],(o,c)=>{var B;return a(),C(T,{key:c,attachment:t(je),"display-value-type-and-format-prop":t(Ve),fields:t(Ke),"is-linked":(B=t(w))!=null&&B.list?t(ce)[Number.parseInt(c)]:!0,"is-loading":t(Pe)[Number.parseInt(c)],"related-table-display-value-prop":t(de),row:o,"data-testid":"nc-child-list-item",onLinkOrUnlink:Re=>pe(o,c),onExpand:Re=>me(o),onKeydown:[te(j(Re=>pe(o,c),["prevent","stop"]),["space"]),te(j(()=>me(o),["prevent","stop"]),["enter"])]},null,8,["attachment","display-value-type-and-format-prop","fields","is-linked","is-loading","related-table-display-value-prop","row","onLinkOrUnlink","onExpand","onKeydown"])}),128))])])):(a(),_("div",Kt,[l("img",{alt:e.$t("msg.clickLinkRecordsToAddLinkFromTable"),class:"!w-[158px] flex-none",src:At},null,8,Yt),l("div",Gt,D(e.$t("msg.noLinkedRecords")),1),l("div",Qt,D(e.$t("msg.clickLinkRecordsToAddLinkFromTable")),1),!t(z)&&(t(x)<1||(((we=t(w))==null?void 0:we.list)??((ge=t(N))==null?void 0:ge[t(V)])??[]).length>0)?se((a(),C(J,{key:0,"data-testid":"nc-child-list-button-link-to",size:"small",onClick:s[2]||(s[2]=o=>K("attachRecord"))},{default:P(()=>[l("div",qt,[k(d),oe(" "+D(e.$t("title.linkRecords")),1)])]),_:1})),[[X,["c:links:link"]]]):S("",!0)]))],512),l("div",Ht,[l("div",Jt,[!t(M)&&!t(Ae)?se((a(),C(J,{key:0,size:"small",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",type:"secondary",onClick:Ge},{default:P(()=>[l("div",Xt,[t(G)?S("",!0):(a(),C(d,{key:0,class:"h-4 w-4"})),oe(" "+D(e.$t("activity.newRecord")),1)])]),_:1})),[[X,["c:row-expand:open"]]]):S("",!0),!t(z)&&(t(x)>0||(((xe=t(w))==null?void 0:xe.list)??((be=t(N))==null?void 0:be[t(V)])??[]).length>0)?se((a(),C(J,{key:1,"data-testid":"nc-child-list-button-link-to",class:"!hover:bg-white !hover:text-brand-500 !h-7 !text-small",size:"small",type:"secondary",onClick:s[3]||(s[3]=o=>K("attachRecord"))},{default:P(()=>[l("div",Wt,[k(n,{icon:"link2",class:"!xs:hidden h-4 w-4"}),oe(" "+D(t(G)?e.$t("title.linkMore"):e.$t("title.linkMoreRecords")),1)])]),_:1})),[[X,["c:links:link"]]]):S("",!0)]),!t(v)&&((Le=t(w))!=null&&Le.pageInfo)&&+t(w).pageInfo.totalRows>t(i).size?(a(),_("div",Zt,[k(We,{current:t(i).page,"onUpdate:current":s[4]||(s[4]=o=>t(i).page=o),"page-size":t(i).size,"onUpdate:pageSize":s[5]||(s[5]=o=>t(i).size=o),total:+t(w).pageInfo.totalRows,mode:"simple"},null,8,["current","page-size","total"])])):S("",!0)])]),(a(),C(_t,null,{default:P(()=>{var o;return[t(L)&&t(h)?(a(),C(Ze,{key:0,modelValue:t(h),"onUpdate:modelValue":s[6]||(s[6]=c=>ft(h)?h.value=c:null),"load-row":!t(M),"close-after-save":t($),meta:t(p),"new-record-header":t($)?e.$t("activity.tableNameCreateNewRecord",{tableName:(o=t(p))==null?void 0:o.title}):void 0,row:{row:t(L),oldRow:t(L),rowMeta:Object.keys(t(L)).length>0?{}:{new:!0}},state:t(Ye),"row-id":("extractPkFromRow"in e?e.extractPkFromRow:t(Ct))(t(L),t(p).columns),"use-meta-fields":"","maintain-default-view-order":"","new-record-submit-btn-text":"Create & Link",onCreatedRecord:Qe},null,8,["modelValue","load-row","close-after-save","meta","new-record-header","row","state","row-id"])):S("",!0)]}),_:1}))],34)}}}),Es=gt(es,[["__scopeId","data-v-472d13ab"]]);export{Es as default};
