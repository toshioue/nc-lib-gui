import{a as L}from"./BtPl72f0.js";import{o as l,c as b,a as t,f as z,bL as c,r as i,d0 as G,c$ as H,d1 as R,fC as Y,H as Q,g as v,h9 as W,cU as q,O as J,P as o,U as d,w as p,Y as g,t as m,b as _,Q as w,S as h,R as K,d as X,V as Z,W as ee,aS as ae,af as te}from"./BLdk6lRf.js";import{a as oe}from"./KocR1J4Z.js";import{a as se}from"./S1xLUEIg.js";import{_ as ne}from"./9nfE2yqV.js";import{_ as ie}from"./BrF0EXdL.js";import"./DTl_5Njz.js";import"./CwqgNcWF.js";import"./CBNgcPSC.js";import"./BQQOEPN4.js";import"./DTv03lbO.js";import"./C-Z2v8Hi.js";import"./BD_L_KCX.js";const le={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ce=t("path",{fill:"currentColor",d:"M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 2a8 8 0 0 1 8 8a8 8 0 0 1-8 8a8 8 0 0 1-8-8a8 8 0 0 1 8-8m-5 6l5 5l5-5z"},null,-1),re=[ce];function de(y,u){return l(),b("svg",le,[...re])}const pe={name:"mdi-arrow-down-drop-circle-outline",render:de},me={class:"nc-map-btn"},_e={class:"flex items-center gap-1"},ue={class:"text-capitalize !text-sm font-weight-normal"},fe={class:"font-bold"},ve={class:"font-bold"},ge={class:"nc-fields-list py-1"},we={class:"grouping-field"},Oe=z({__name:"MappedBy",setup(y){const{eventBus:u}=L(),M=c(G,i()),f=c(H,i()),k=c(R,i(!1)),C=c(Y,i(!1)),{fields:D,loadViewColumns:B,metaColumnById:x}=oe(),{loadMapData:I,loadMapMeta:V,updateMapMeta:S,mapMetaData:N,geoDataFieldColumn:O}=se(),n=i(!1);Q(()=>{var a;return(a=f.value)==null?void 0:a.id},async(a,e)=>{a!==e&&M.value&&await B()},{immediate:!0});const r=v({get:()=>N.value.fk_geo_data_col_id,set:async a=>{var e;a&&(await S({fk_geo_data_col_id:a}),await V(),await I(),((e=f.value)==null?void 0:e.view).fk_geo_data_col_id=a,u.emit(W.MAPPED_BY_COLUMN_CHANGE))}}),U=v(()=>{var a;return(a=D.value)==null?void 0:a.filter(e=>e.fk_column_id&&x.value[e.fk_column_id].uidt===q.GeoData).map(e=>({value:e.fk_column_id,label:e.title}))}),$=()=>{n.value=!1};return(a,e)=>{const j=pe,A=ae,F=ne,P=ie,T=te,E=J("e");return o(C)?h("",!0):(l(),d(T,{key:0,visible:o(n),"onUpdate:visible":e[3]||(e[3]=s=>w(n)?n.value=s:null),trigger:["click"],class:"!xs:hidden"},{overlay:p(()=>[o(n)?(l(),b("div",{key:0,class:"p-3 min-w-[280px] bg-gray-50 shadow-lg nc-table-toolbar-menu max-h-[max(80vh,500px)] overflow-auto !border",onClick:e[2]||(e[2]=g(()=>{},["stop"]))},[t("div",null,[t("span",ve,m(a.$t("activity.map.chooseMappingField")),1),_(F,{class:"!my-2"})]),t("div",ge,[t("div",we,[_(P,{value:o(r),"onUpdate:value":e[0]||(e[0]=s=>w(r)?r.value=s:null),class:"w-full nc-msp-grouping-field-select",options:o(U),placeholder:"Select a Mapping Field",onChange:$,onClick:e[1]||(e[1]=g(()=>{},["stop"]))},null,8,["value","options"])])])])):h("",!0)]),default:p(()=>[t("div",me,[K((l(),d(A,{class:"nc-map-stacked-by-menu-btn nc-toolbar-btn",disabled:o(k)},{default:p(()=>{var s;return[t("div",_e,[_(j),t("span",ue,[X(m(a.$t("activity.map.mappedBy"))+" ",1),t("span",fe,m((s=o(O))==null?void 0:s.title),1)]),(l(),d(Z(("iconMap"in a?a.iconMap:o(ee)).arrowDown),{class:"text-grey"}))])]}),_:1},8,["disabled"])),[[E,["c:map:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{Oe as default};
